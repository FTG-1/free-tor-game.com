<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>N effective way for creating complex forms &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077292 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077292" class="post-1077292 software type-software status-publish hentry category-software tag-forms tag-user-interface tag-wpf"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">N effective way for creating complex forms</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">forms</span><span class="mr-2 badge badge-info">user interface</span><span class="mr-2 badge badge-warning">wpf</span></p><div class="entry-content"><p>While creating a &#39;search&#39; form I&#39;ve been faced to an overwhelming complexity and I was wondering whether there is a well-known way to accomplish such task.</p><p>Fields of the form in question can be seen here: <a href="http://developer.echonest.com/docs/v4/artist.html#search">http://developer.echonest.com/docs/v4/artist.html#search</a></p><p>Here are a few issues I&#39;ve been faced to and tried to solve with simple solutions though it led to a lot of copying and pasting in the end :</p><ul><li><p>When the user can select multiple choices for a field or not, I systematically had to create a collection of them, adding a &#39;null&#39; value for the ability of ignoring that field. Also, as these are enumeration values they are not <em>user-friendly</em> to read and therefore needed an extra description field that will be shown instead on the UI. And at the end all this <em>user-friendly</em> values need to be converted back to the original object.</p></li><li><p>Selection being made by the user, these choices need to be retrieved and for this, unfortunately in my case WPF data binding shown its limits. Example : when a user chooses items from a collection, there is no way to update the target object with these selections. (Obviously this is unrealistic as the object serves as a data source)</p></li></ul><p>In the end it resumes to a lot of manual fetching from combo boxes, list boxes etc &#8230; a <em>middle-man</em> object to receive all that and to this you have to add validation as well.</p><p>A strategy therefore becomes imperative as I will have to realise a couple of these complex forms.</p><p>I&#39;ve been searching the web for solutions but beside extremely simple examples I found nothing relevant.</p><p>So the question is, is there an effective way that helps when creating complex user forms ?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I&#39;ve sorted it out and in the end it went pretty well so I&#39;ll give here my recommendations according this painful experience.</p><p>(these tips apply for WPF)</p><ul><li><p>Validation : use <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifydataerrorinfo(v=vs.110).aspx" rel="nofollow noreferrer">INotifyDataErrorInfo</a> instead of rules in XAML, your validation takes place in the object instead and even it&#39;s sort of complicate to setup it is really worth it. This interface is appropriate for validation of a complex object. Here&#39;s an excellent article showing it : <a href="http://anthymecaillard.wordpress.com/2012/03/26/wpf-4-5-validation-asynchrone/" rel="nofollow noreferrer">http://anthymecaillard.wordpress.com/2012/03/26/wpf-4-5-validation-asynchrone/</a> I&#39;d suggest you to not copy/paste it but write it manually. (I did and it took me less time than copy/paste and trying to grasp what it does later)</p></li><li><p>Updating your object whenever user inputs values : it&#39;s clearly better to do nothing during controls events such as TextChanged but to stick to validation as mentioned above. Hook to Validation.Error events of your controls for managing the logic of your API (in my case when &#39;name&#39; is set the user cannot search by &#39;familiarity&#39; so I disabled appropriate controls).</p></li><li><p>That leds to a search button that gets enabled only when all values are correct and this is actually the place where you&#39;d grab all params and your stuff, all in one place, not scattered anymore through events of controls.</p></li><li><p>Also, do not hesitate to use a <em>middle-man</em> object even though it won&#39;t contain all the fields of the original object it still proved to be helpful as that&#39;s where I implemented INotifyDataDataErrorInfo. There was absolutely no way that I modify the source object which is fine and part of a library anyway ! For multiple choices a user can do on a ListBox, I didn&#39;t use it, I just populated them and that&#39;s it. (they are all valid by nature, in my case)</p></li></ul><p>Now a few screenshots and explanations.</p><p>Here&#39;s the API, not about 2 or 3 fields but 21, when I saw it first I knew it would be a pain to implement but still I underestimated it ...</p><p><img src="../../../i.stack.imgur.com/Ix4JK.png" alt="enter image description here"/> <img src="../../../i.stack.imgur.com/JDEaf.png" alt="enter image description here"/></p><p>Here the search button gets enabled only when validation is correct,</p><p><img src="../../../i.stack.imgur.com/fdRWc.png" alt="enter image description here"/></p><p>Using an extremely simple method, luckily in my case only these 3 cases were needed.</p><pre class="lang-cs prettyprint-override"><code>    private void ToggleSearch()
    {
        var b1 = GetHasErrorPropertyValue(TextBoxArtistLocation);
        var b2 = GetHasErrorPropertyValue(TextBoxDescription);
        var b3 = GetHasErrorPropertyValue(TextBoxName);
        ButtonSearch.IsEnabled = !(b1 || b2 || b3);
    }

    private static bool GetHasErrorPropertyValue(DependencyObject dependencyObject)
    {
        if (dependencyObject == null) throw new ArgumentNullException(&#34;dependencyObject&#34;);
        return (bool)dependencyObject.GetValue(Validation.HasErrorProperty);
    }

    // Hooking to Validation.Error attached property, these boxes all point to here.
    private void TextBox_OnError(object sender, ValidationErrorEventArgs e)
    {
        ToggleSearch();
    }
</code></pre><p>Here&#39;s the output of the query, well the only bothering stuff compared to previous version is that for testing I have to search every time to see the result of the built query for which I assigned Alt-S as a time-saver. Previously I was fetching the result on each value changed in each control, while it looked simple as these were 5 lines methods it soon went to a nightmare. With the new method, I have one hand setting the fields with mouse the other pressing Alt-S and obviously a much simpler class to understand/use/debug.</p><p><img src="../../../i.stack.imgur.com/VW9ME.png" alt="enter image description here"/></p><p>Last screen : as you can see there isn&#39;t much in it, the 3 top methods each call one of the methods below, I think they are self-explanatory. The helper methods are used for setting/retrieving values from controls and to form the query.</p><p><img src="../../../i.stack.imgur.com/duMoX.png" alt="enter image description here"/></p><p>Last two samples :</p><p>Populating data :</p><pre class="lang-cs prettyprint-override"><code>    private async Task PopulateData()
    {
        string apiKey = App.GetApiKey();

        var years = GetDescribedEnum&lt;ArtistSearchYear&gt;().ToList();
        ComboBoxArtistEndYearAfter.ItemsSource = years;
        ComboBoxArtistEndYearBefore.ItemsSource = years;
        ComboBoxArtistStartYearAfter.ItemsSource = years;
        ComboBoxArtistStartYearBefore.ItemsSource = years;

        var rankTypes = GetDescribedEnum&lt;ArtistSearchRankType&gt;().ToList();
        ComboBoxRankType.ItemsSource = rankTypes;

        var results = Enumerable.Range(0, 101).Select(s =&gt; s.ToString(CultureInfo.InvariantCulture)).ToList();
        results.Insert(0, string.Empty);
        ComboBoxResults.ItemsSource = results;

        var sort = GetDescribedEnum&lt;ArtistSearchSort&gt;().OrderBy(s =&gt; s.Description).ToList();
        ComboBoxSort.ItemsSource = sort;

        var start = Enumerable.Range(0, 3).Select(s =&gt; (s * 15).ToString(CultureInfo.InvariantCulture)).ToList();
        start.Insert(0, string.Empty);
        ComboBoxStart.ItemsSource = start;

        var buckets = GetDescribedEnum&lt;ArtistSearchBucket&gt;().OrderBy(s =&gt; s.Description).ToList();
        ListBoxBuckets.ItemsSource = buckets;

        var genres = await Queries.ArtistListGenres(apiKey);
        ListBoxGenre.ItemsSource = genres.Genres.Select(s =&gt; s.Name);

        var styles = await Queries.ArtistListTerms(apiKey, ArtistListTermsType.Style);
        ListBoxStyle.ItemsSource = styles.Terms.Select(s =&gt; s.Name);

        var moods = await Queries.ArtistListTerms(apiKey, ArtistListTermsType.Mood);
        ListBoxMood.ItemsSource = moods.Terms.Select(s =&gt; s.Name);
    }
</code></pre><p>Retrieving parameters :</p><pre class="lang-cs prettyprint-override"><code>    private void RunSearch()
    {
        var parameters = new ArtistSearchParameters();

        var year = (Func&lt;ComboBox, ArtistSearchYear?&gt;)((c) =&gt;
            {
                if (c.SelectedValue == null) return null;
                var value = GetDescribedObjectValue&lt;ArtistSearchYear&gt;(c.SelectedValue);
                return value == ArtistSearchYear.Invalid ? (ArtistSearchYear?)null : value;
            });
        parameters.ArtistEndYearAfter = year(ComboBoxArtistEndYearAfter);
        parameters.ArtistEndYearBefore = year(ComboBoxArtistEndYearBefore);
        parameters.ArtistStartYearAfter = year(ComboBoxArtistStartYearAfter);
        parameters.ArtistStartYearBefore = year(ComboBoxArtistStartYearBefore);

        if (ComboBoxRankType.SelectedValue == null)
        {
            parameters.RankType = null;
        }
        else
        {
            var value = GetDescribedObjectValue&lt;ArtistSearchRankType&gt;(ComboBoxRankType.SelectedValue);
            parameters.RankType = value == ArtistSearchRankType.Invalid ? (ArtistSearchRankType?)null : value;
        }

        var selectedValue = ComboBoxSort.SelectedValue;
        if (selectedValue == null)
        {
            parameters.Sort = null;
        }
        else
        {
            var value = GetDescribedObjectValue&lt;ArtistSearchSort&gt;(selectedValue);
            parameters.Sort = value == ArtistSearchSort.Invalid ? (ArtistSearchSort?)null : value;
        }

        parameters.Start = StringToNullableInt(GetSelectorValue&lt;string&gt;(ComboBoxStart));
        parameters.Results = StringToNullableInt(GetSelectorValue&lt;string&gt;(ComboBoxResults));

        parameters.MaxFamiliarity = SliderMaxFamiliarity.Value &lt; 1.0d ? (double?)SliderMaxFamiliarity.Value : null;
        parameters.MinFamiliarity = SliderMinFamiliarity.Value &gt; 0.0d ? (double?)SliderMinFamiliarity.Value : null;
        parameters.MaxHotttnesss = SliderMaxHottness.Value &lt; 1.0d ? (double?)SliderMaxHottness.Value : null;
        parameters.MinHotttnesss = SliderMinHottness.Value &gt; 0.0d ? (double?)SliderMinHottness.Value : null;

        if (CheckBoxFuzzyMatch.IsChecked.HasValue)
            parameters.FuzzyMatch = CheckBoxFuzzyMatch.IsChecked.Value ? (bool?)true : null;
        if (CheckBoxLimit.IsChecked.HasValue)
            parameters.Limit = CheckBoxLimit.IsChecked.Value ? (bool?)true : null;

        var buckets =
            GetSelectedItems&lt;DescribedObject&lt;ArtistSearchBucket&gt;&gt;(ListBoxBuckets)
                          .OrderBy(s =&gt; s.Description)
                          .Select(s =&gt; s.Value)
                          .ToList();
        parameters.Buckets = buckets.Count &gt; 0 ? buckets : null;
        var genres = GetSelectedItems&lt;string&gt;(ListBoxGenre).OrderBy(s =&gt; s).ToList();
        parameters.Genres = genres.Count &gt; 0 ? genres : null;
        var moods = GetSelectedItems&lt;string&gt;(ListBoxMood).OrderBy(s =&gt; s).ToList();
        parameters.Moods = moods.Count &gt; 0 ? moods : null;
        var style = GetSelectedItems&lt;string&gt;(ListBoxStyle).OrderBy(s =&gt; s).ToList();
        parameters.Styles = style.Count &gt; 0 ? style : null;

        parameters.ArtistLocation = string.IsNullOrEmpty(TextBoxArtistLocation.Text)
                                        ? null
                                        : TextBoxArtistLocation.Text;
        parameters.Description = string.IsNullOrEmpty(TextBoxDescription.Text)
                                     ? null
                                     : Regex.Split(TextBoxDescription.Text, @&#34;, ?&#34;)
                                            .Where(s =&gt; !string.IsNullOrWhiteSpace(s))
                                            .ToList();
        if (string.IsNullOrEmpty(TextBoxName.Text))
        {
            parameters.Name = null;
        }
        else
        {
            parameters.Name = TextBoxName.Text;
            parameters.MaxFamiliarity = null;
            parameters.MaxHotttnesss = null;
            parameters.MinFamiliarity = null;
            parameters.MinHotttnesss = null;
        }

    }
</code></pre><p>In my case nullables were vital as they allowed me to discard values when building the query.</p><p>For building the query I cheated somehow using JSON :</p><pre class="lang-cs prettyprint-override"><code>    protected static string GetUrlParameters(string json)
    {
        if (json == null) throw new ArgumentNullException(&#34;json&#34;);
        JsonTextReader reader = new JsonTextReader(new StringReader(json));
        string path = string.Empty;
        List&lt;string&gt; list = new List&lt;string&gt;();
        while (reader.Read())
        {
            JsonToken type = reader.TokenType;
            if (type == JsonToken.PropertyName)
            {
                path = reader.Path;
            }
            else
            {
                bool b0 = type == JsonToken.Integer;
                bool b1 = type == JsonToken.Float;
                bool b2 = type == JsonToken.String;
                bool b3 = type == JsonToken.Boolean;
                if (b0 || b1 || b2 || b3)
                {
                    var value = reader.Value.ToString();
                    if (b3) value = value.ToLower();

                    string item = string.Format(&#34;{0}={1}&#34;, path, value);
                    list.Add(item);
                }
            }
        }
        return string.Join(&#34;&amp;&#34;, list);
    }
</code></pre><p>DescribedObject is a <em>middle-man</em> object that holds the desired value and the description is fetched from a value [DescriptionAttribute]</p><pre class="lang-cs prettyprint-override"><code>public class DescribedObject 
{
    private readonly string _description;
    private readonly Object _value;

    public DescribedObject() // NOTE : for design-time
    {

    }
    protected DescribedObject(Object value, string description)
    {
        _value = value;
        _description = description;
    }

    public string Description
    {
        get { return _description; }
    }

    public Object Value
    {
        get { return _value; }
    }

    public override string ToString()
    {
        return string.Format(&#34;Value: {0}, Description: {1}&#34;, _value, _description);
    }
}

public class DescribedObject&lt;T&gt; : DescribedObject
{

    public DescribedObject(T value, string description)
        : base(value, description)
    {
    }
    public new T Value
    {
        get
        {
            return (T)base.Value;
        }
    }
}
</code></pre><p>A described object :</p><pre class="lang-cs prettyprint-override"><code>[JsonConverter(typeof(PropertyEnumConverter))]
public enum ArtistSearchYear
{
    [Description(null), JsonProperty(null)]
    Invalid = 0,
    [Description(&#34;1970&#34;), JsonProperty(&#34;1970&#34;)]
    Year1970,
    [Description(&#34;1971&#34;), JsonProperty(&#34;1971&#34;)]
    Year1971
}
</code></pre><p>(PropertyEnumConverter is a simple object that will convert these values according their JsonProperty attribute.)</p><p>So as you can see, I kept it stupidly simple but it took me some time as at first I had a more complex approach, again the simplicity proven really helpful though it sounds stupid sometimes.</p><p>I haven&#39;t talked about the XAML side, briefly there&#39;s absolutely nothing in it beside controls and templates, only bindings have these two properties set for them to validate. (also, the object implements INotifyPropertyChanged)</p><pre class="lang-xml prettyprint-override"><code>&lt;TextBox x:Name=&#34;TextBoxArtistLocation&#34;
            Style=&#34;{StaticResource TextBoxInError}&#34;
            Validation.Error=&#34;TextBox_OnError&#34;
            Text=&#34;{Binding ArtistLocation, NotifyOnValidationError=True, UpdateSourceTrigger=PropertyChanged}&#34; /&gt;
</code></pre><p>I hope this answer will help someone, I&#39;ve tried to be as concise as possible but if you have any question/comment, ask below.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-model-the-dependencies-between-fields-in-very-complex-forms/'>How to model the dependencies between fields in very complex forms</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>