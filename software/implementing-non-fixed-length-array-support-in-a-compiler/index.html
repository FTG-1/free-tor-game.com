<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Implementing non-fixed length array support in a compiler &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077776 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077776" class="post-1077776 software type-software status-publish hentry category-software tag-array tag-asm tag-assembly tag-c tag-compiler"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Implementing non-fixed length array support in a compiler</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">array</span><span class="mr-2 badge badge-info">asm</span><span class="mr-2 badge badge-warning">assembly</span><span class="mr-2 badge badge-primary">c</span><span class="mr-2 badge badge-danger">compiler</span></p><div class="entry-content"><p>I&#39;m thinking of building a language for PIC microcontrollers. I want to be able to use non-fixed size arrays, like this:</p><ol><li>Declare the variable as <code>int[]</code></li><li>Wait for input from serial connection</li><li>Make the variable <em><code>input</code></em> long</li></ol><p>I think such a feature would be useful, but don&#39;t know how I should go about implementing this in a compiler which compiles to assembly. I want the arrays to be stored on consecutive register addresses, of course. Since I&#39;m working with PICs, this has to be very memory efficient.</p><p>When someone writes <code>int[]</code>, I don&#39;t think it&#39;s a good idea to reserve memory space for the variable yet, is it? Then the array would have a fixed maximum size. For example, when the array gets reserved memory address 5-100, and other variables get 4 and 101, the array has fixed borders and can&#39;t grow any bigger than 96 registers. Also, when I&#39;d reserve memory from the start, let&#39;s say <em>x</em> bytes, and I in the end only need <em>y</em> bytes, I&#39;m wasting <em>x</em> &#8211; <em>y</em> bytes. I don&#39;t want that.</p><p>That means the only option I see is initializing the array and reserving space in the microcontroller, on the fly. This will take up some memory and execution time, of course. I thought of a system like this:</p><ul><li>Initialize an array <code>int[</code><em><code>x</code></em><code>] = {int, int}</code> which holds pointers to the start and end of arrays that are not initialized from the beginning &#8211; <em><code>x</code></em> would be the maximum amount of arrays (this is a concession, but is better than a maximum length for all arrays)</li><li>Store a variable <em>c</em> = 0 to indicate the number of arrays used</li><li>Store the borders of the initialized (reserved) memory in a variable somewhere</li><li><p>When an array gets a length:</p><ul><li>Put pointers to the start (the current border) and end (the current border + the length) in the array from the first point at index <em>c</em></li><li>Increment <em>c</em></li></ul></li></ul><p>I think this would work (wouldn&#39;t it?), but there a few cons, mainly concerning memory: I need to store the array, <em>c</em> and the current memory borders as overhead.</p><p>Would there be a better way to implement non-fixed size arrays in a language for PIC microcontrollers? My requirements are:</p><ul><li>Low memory overhead</li><li>The array length does <em>not</em> have to be changed on the fly</li><li>With the system I thought up, one cannot store values in arrays that haven&#39;t been initialized yet. If there would be a system that can store values in an array of undefined length, that would be an advantage</li><li>Faster systems (at runtime, compile time doesn&#39;t matter) are preferable</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You will probably make it a lot easier on yourself and avoid a lot of user errors if you allow the declaration of variable-length arrays to be delayed until a point where the size is known. Then you don&#39;t have to invent a syntax for assigning the array size and you don&#39;t have to deal with differences in the order in which arrays are declared and in which they get their size.</p><p>If your compiler uses a stack-based allocation scheme for local variables (they are given addresses relative to the stack-frame of their function, like it is done for the &#39;big&#39; platforms), the variable-length arrays can just be carved out of the stack frame as needed. Only if there are multiple variable-length arrays in a function do you need an additional pointer to indicate where the data of each starts.</p><p>If your compiler uses a fixed allocation scheme (all variables, including locals, are given a fixed (absolute) address by the compiler/linker), I would use an &#39;array stack&#39; for carving the variable-length arrays from. As overhead, you would need a global pointer to indicate where the free space currently starts,  a pointer for each variable-length array to indicate where its data is located and, in each function using variable-length arrays, a way to restore the global pointer to the value it had when entering the function.<br/> The user would also need some way to indicate to the compiler/linker how much of a &#39;array stack&#39; he thinks will be needed. A reasonable default could be to use whatever is left after allocating all fixed-size variables and variable-length array overhead.</p><p>I think this scheme uses the least amount of overhead, both space and time-wise. The scheme you came up with is essentially a <code>malloc</code> implementation.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../the-purpose-of-arrays-in-c-when-pointers-could-have-done-the-job/'>The purpose of arrays in C, when pointers could have done the job</a></li><li class="list-group-item"><a href='../correct-for-loop-design/'>Correct For Loop Design</a></li><li class="list-group-item"><a href='../fetching-instructions-from-memory/'>Fetching instructions from memory</a></li><li class="list-group-item"><a href='../why-do-c-arrays-not-keep-track-of-their-length/'>Why do C arrays not keep track of their length</a></li><li class="list-group-item"><a href='../does-the-gcc-optimize-out-local-arrays-the-same-way-it-would-optimize-out-a-local-variable/'>Does the gcc optimize out local arrays the same way it would optimize out a local variable</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>