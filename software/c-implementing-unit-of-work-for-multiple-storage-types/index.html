<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Implementing unit-of-work for multiple storage types &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078691 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078691" class="post-1078691 software type-software status-publish hentry category-software tag-c tag-database tag-design-patterns tag-unit-of-work tag-windows-registry"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Implementing unit-of-work for multiple storage types</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">database</span><span class="mr-2 badge badge-warning">design-patterns</span><span class="mr-2 badge badge-primary">unit-of-work</span><span class="mr-2 badge badge-danger">windows-registry</span></p><div class="entry-content"><p>I&#39;m trying to implement the unit-of-work pattern for mutliple storage types like the windows registry, a database or the app.config but I cannot figure out how to do it. All examples I find use Entity Framework which already is a UoW so it doesn&#39;t help much. What I&#39;d like to store is a simple <code>Setting</code> object.</p><p>From <a href="http://martinfowler.com/eaaCatalog/unitOfWork.html" rel="nofollow noreferrer">http://martinfowler.com/eaaCatalog/unitOfWork.html</a> I understand that</p><blockquote><p>A Unit of Work keeps track of everything you do during a business transaction that can affect the database. When you&#39;re done, it figures out everything that needs to be done to alter the database as a result of your work.</p></blockquote><p>So I probably should start with a class that has two settable properties and one that tells me whether it&#39;s dirty and needs an update.</p><pre><code>class Setting
{
    private string _value;

    public Setting(string name, string value)
    {
        Name = name;
        _value = value;
    }

    public string Name { get; set; }

    public string Value
    {
        get { return _value; }
        set
        {
            _value = value;
            IsDirty = true;
        }
    }

    public bool IsDirty { get; private set; }
}
</code></pre><p>then I guess I need a base repository:</p><pre><code>abstract class SettingRepository
{
    private readonly List&lt;Setting&gt; _settings = new List&lt;Setting&gt;();

    public abstract IEnumerable&lt;Setting&gt; Get(Setting setting);

    public void Add(IEnumerable&lt;Setting&gt; settings)
    {
        _settings.AddRange(settings);
    }

    public abstract int SaveChanges();
}
</code></pre><p>and a unit-of-work as <code>SettingContext</code>:</p><pre><code>abstract class SettingContext
{
    protected SettingContext(SettingRepository settings)
    {
        Settings = settings;
    }

    public SettingRepository Settings { get; }
}
</code></pre><hr/><p>Now I&#39;m not sure where I should put all the Update/Insert/SaveChanges logic? A database would for example support transaction whereas the windows registry not.</p><p>Do I need different repositories for each storage type or do I need different unit-of-work aka contexts for each of them? I&#39;m really confused.</p><hr/><p>I don&#39;t know what exactly I should do next. Maybe I think to much Entity Framework and try to implement it in a too similar way like this:</p><pre><code>using(var context = new SettingContext(new RegistryRepository()))
{
    context.Settings.Add(new Setting(&#34;Foo&#34;, &#34;Bar&#34;)); // this should be created
    context.Settings.Add(otherSetting); // this should be updated
    context.SaveChanges();
}
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your approach is fine so far. The &#34;Unit-of-Work&#34; class should get the responsibility to keep track of the changes to your &#34;settings entity&#34; for one &#34;transaction&#34; (it could do this, for example, by keeping a list of commands or changed objects, if there would be more than one object involved), and the abstract repository should provide an abstraction for the CRUD operations (so there will be one concrete repository implementation for each type of storage, that is fine). The &#34;Commit&#34; operation of the &#34;UoW&#34; then just loops over the commands or changed objects and uses the CRUD operations of the injected repo to store the data/changes.</p><p>However, if all the data you have to manage is contained in just one settings object, and the update operation is just to write that object into the storage in one transaction, using a &#34;Unit-of-Work&#34; approach is probably overkill. UoW makes more sense if you need some kind of parentheses around a complex transaction, involving multiple objects. For your <code>Settings</code> object, a repo with methods like <code>SaveSettings</code> and <code>LoadSettings</code> is probably sufficient.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-best-way-to-load-application-settings/'>Java &#8211; Best way to load application settings</a></li><li class="list-group-item"><a href='../c-role-provider-for-multiple-applications/'>C# Role Provider for multiple applications</a></li><li class="list-group-item"><a href='../c-multi-user-configuration-settings-design/'>C# &#8211; Multi-user Configuration Settings design</a></li><li class="list-group-item"><a href='../unit-testing-mockrepository-vs-test-database-for-unit-testing/'>Unit-testing &#8211; MockRepository vs Test Database for Unit Testing</a></li><li class="list-group-item"><a href='../unit-of-work-repository-pattern-dependency-injection/'>Unit of work + repository pattern + dependency injection</a></li><li class="list-group-item"><a href='../how-to-get-orm-ef-core-entities-follow-a-ddd-style-which-is-the-best-approach/'>How to get ORM (Ef Core) Entities follow a DDD style . Which is the best approach</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>