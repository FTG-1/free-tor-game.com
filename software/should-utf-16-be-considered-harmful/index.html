<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Should UTF-16 be considered harmful &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1063025 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1063025" class="post-1063025 software type-software status-publish hentry category-software tag-unicode"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Should UTF-16 be considered harmful</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">unicode</span></p><div class="entry-content"><div><aside class="s-notice s-notice__info post-notice js-post-notice mb16" role="status"><div class="d-flex fd-column fw-nowrap"><div class="d-flex fw-nowrap"><div class="flex--item mr8"> <svg aria-hidden="true" class="svg-icon iconLock" width="18" height="18" viewBox="0 0 18 18"><path d="M16 9a2 2 0 00-2-2V6A5 5 0 004 6v1a2 2 0 00-2 2v6c0 1.1.9 2 2 2h10a2 2 0 002-2V9Zm-7 5a2 2 0 110-4 2 2 0 010 4Zm3.1-7H5.9V6a3.1 3.1 0 016.2 0v1Z"></path></svg></div><div class="flex--item wmn0 fl1 lh-lg"><div class="flex--item fl1 lh-lg"> <b>Locked</b>. This question and its answers are <a href="https://free-tor-game.com/help/locked-posts">locked</a> because the question is off-topic but has historical significance. It is not currently accepting new answers or interactions.</p></div></p></div></p></div></p></div></aside></div><p>I&#39;m going to ask what is probably quite a controversial question: &#34;Should one of the most<br /> popular encodings, UTF-16, be considered harmful?&#34;</p><p>Why do I ask this question?</p><p>How many programmers are aware of the fact that UTF-16 is actually a variable length encoding? By this I mean that there are code points that, represented as surrogate pairs, take more than one element.</p><p>I know; lots of applications, frameworks and APIs use UTF-16, such as Java&#39;s String, C#&#39;s String, Win32 APIs, Qt GUI libraries, the ICU Unicode library, etc.  However, with all of that, there are lots of basic bugs in the processing of characters out of BMP (characters that should be encoded using two UTF-16 elements).</p><p>For example, try to edit one of these characters:</p><ul><li>ùÑû (<a href="http://www.fileformat.info/info/unicode/char/1d11e/index.htm">U+1D11E</a>) <em>MUSICAL SYMBOL G CLEF</em></li><li>ùï• (<a href="http://www.fileformat.info/info/unicode/char/1d565/index.htm">U+1D565</a>) <em>MATHEMATICAL DOUBLE-STRUCK SMALL T</em></li><li>ùü∂ (<a href="http://www.fileformat.info/info/unicode/char/1d7f6/index.htm">U+1D7F6</a>) <em>MATHEMATICAL MONOSPACE DIGIT ZERO</em></li><li>†Çä (<a href="http://www.fileformat.info/info/unicode/char/2008a/index.htm">U+2008A</a>) <em>Han Character</em></li></ul><p>You may miss some, depending on what fonts you have installed.  These characters are all outside of the BMP (Basic Multilingual Plane).  If you cannot see these characters, you can also try looking at them in the <a href="http://en.wikibooks.org/wiki/Unicode/Character_reference/1D000-1DFFF">Unicode Character reference</a>.</p><p>For example, try to create file names in Windows that include these characters; try to delete these characters with a &#34;backspace&#34; to see how they behave in different applications that use UTF-16. I did some tests and the results are quite bad:</p><ul><li>Opera has problem with editing them (delete required 2 presses on backspace)</li><li>Notepad can&#39;t deal with them correctly (delete required 2 presses on backspace)</li><li>File names editing in Window dialogs in broken (delete required 2 presses on backspace)</li><li>All QT3 applications can&#39;t deal with them &#8211; show <em>two</em> empty squares instead of one symbol.</li><li>Python encodes such characters incorrectly when used directly <code>u&#39;X&#39;!=unicode(&#39;X&#39;,&#39;utf-16&#39;)</code> on some platforms when X in character outside of BMP.</li><li>Python 2.5 unicodedata fails to get properties on such characters when python compiled with UTF-16 Unicode strings.</li><li>StackOverflow seems to remove these characters from the text if edited directly in as Unicode characters (these characters are shown using HTML Unicode escapes).</li><li><a href="http://www.siao2.com/2010/12/15/10105168.aspx">WinForms TextBox may generate invalid string</a> when limited with MaxLength.</li></ul><p>It seems that such bugs are extremely easy to find in many applications that use UTF-16.</p><p>So&#8230; Do you think that UTF-16 should be considered harmful?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p><strong>This is an old answer.</strong><br/> See <a href="http://utf8everywhere.org/">UTF-8 Everywhere</a> for the latest updates.</p></blockquote><p><strong>Opinion: Yes, UTF-16 should be considered harmful</strong>. The very reason it exists is because some time ago there used to be a misguided belief that widechar is going to be what UCS-4 now is.</p><p>Despite the &#34;anglo-centrism&#34; of UTF-8, it should be considered the only useful encoding for text. One can argue that source codes of programs, web pages and XML files, OS file names and other computer-to-computer text interfaces should never have existed. But when they do, text is not only for human readers.</p><p>On the other hand, UTF-8 overhead is a small price to pay while it has significant advantages. Advantages such as compatibility with unaware code that just passes strings with <code>char*</code>. This is a great thing. There&#39;re few useful characters which are SHORTER in UTF-16 than they are in UTF-8.</p><p>I believe that all other encodings will die eventually. This involves that MS-Windows, Java, ICU, python stop using it as their favorite. After long research and discussions, the development conventions at <a href="http://www.visionmap.com/">my company</a> ban using UTF-16 anywhere except OS API calls, and this despite importance of performance in our applications and the fact that we use Windows. Conversion functions were developed to convert always-assumed-UTF8 <code>std::string</code>s to native UTF-16, which Windows itself <a href="http://www.siao2.com/2005/12/21/506248.aspx">does not support properly</a>.</p><p>To people who say &#34;<em>use what needed where it is needed</em>&#34;, I say: there&#39;s a huge advantage to using the same encoding everywhere, and I see no sufficient reason to do otherwise. In particular, I think adding <code>wchar_t</code> to C++ was a mistake, and so are the Unicode additions to C++0x. What must be demanded from STL implementations though is that every <code>std::string</code> or <code>char*</code> parameter would be considered unicode-compatible.</p><p>I am also against the &#34;<em>use what you want</em>&#34; approach. I see no reason for such liberty. There&#39;s enough confusion on the subject of text, resulting in all this broken software. Having above said, I am convinced that programmers must finally reach consensus on UTF-8 as one proper way. (I come from a non-ascii-speaking country and grew up on Windows, so I&#39;d be last expected to attack UTF-16 based on religious grounds).</p><p>I&#39;d like to share more information on how I do text on Windows, and what I recommend to everyone else for compile-time checked unicode correctness, ease of use and better multi-platformness of the code. The suggestion substantially differs from what is usually recommended as the proper way of using Unicode on windows. Yet, in depth research of these recommendations resulted in the same conclusion. So here goes:</p><ul><li>Do not use <code>wchar_t</code> or <code>std::wstring</code> in any place other than adjacent point to APIs accepting UTF-16.</li><li>Don&#39;t use <code>_T(&#34;&#34;)</code> or <code>L&#34;&#34;</code> UTF-16 literals (These should IMO be taken out of the standard, as a part of UTF-16 deprecation).</li><li>Don&#39;t use types, functions or their derivatives that are sensitive to the <code>_UNICODE</code> constant, such as <code>LPTSTR</code> or <code>CreateWindow()</code>.</li><li>Yet, <code>_UNICODE</code> always defined, to avoid passing <code>char*</code> strings to WinAPI getting silently compiled</li><li><code>std::strings</code> and <code>char*</code> anywhere in program are considered UTF-8 (if not said otherwise)</li><li>All my strings are <code>std::string</code>, though you can pass char* or string literal to <code>convert(const std::string &amp;)</code>.</li><li><p>only use Win32 functions that accept widechars (<code>LPWSTR</code>). Never those which accept <code>LPTSTR</code> or <code>LPSTR</code>. Pass parameters this way:</p><pre><code>::SetWindowTextW(Utils::convert(someStdString or &#34;string litteral&#34;).c_str())
</code></pre><p>(The policy uses conversion functions below.)</p></li><li><p>With MFC strings:</p><pre><code>CString someoneElse; // something that arrived from MFC. Converted as soon as possible, before passing any further away from the API call:

std::string s = str(boost::format(&#34;Hello %s\n&#34;) % Convert(someoneElse));
AfxMessageBox(MfcUtils::Convert(s), _T(&#34;Error&#34;), MB_OK);
</code></pre></li><li><p>Working with files, filenames and fstream on Windows:</p><ul><li>Never pass <code>std::string</code> or <code>const char*</code> filename arguments to <code>fstream</code> family. MSVC STL does not support UTF-8 arguments, but has a non-standard extension which should be used as follows:</li><li><p>Convert <code>std::string</code> arguments to <code>std::wstring</code> with <code>Utils::Convert</code>:</p><pre><code>std::ifstream ifs(Utils::Convert(&#34;hello&#34;),
                  std::ios_base::in |
                  std::ios_base::binary);
</code></pre><p>We&#39;ll have to manually remove the convert, when MSVC&#39;s attitude to <code>fstream</code> changes.</p></li><li>This code is not multi-platform and may have to be changed manually in the future</li><li>See <code>fstream</code> unicode research/discussion case 4215 for more info.</li><li>Never produce text output files with non-UTF8 content</li><li>Avoid using <code>fopen()</code> for RAII/OOD reasons. If necessary, use <code>_wfopen()</code> and WinAPI conventions above.</li></ul></li></ul><hr/><pre><code>// For interface to win32 API functions
std::string convert(const std::wstring&amp; str, unsigned int codePage /*= CP_UTF8*/)
{
    // Ask me for implementation..
    ...
}

std::wstring convert(const std::string&amp; str, unsigned int codePage /*= CP_UTF8*/)
{
    // Ask me for implementation..
    ...
}

// Interface to MFC
std::string convert(const CString &amp;mfcString)
{
#ifdef UNICODE
    return Utils::convert(std::wstring(mfcString.GetString()));
#else
    return mfcString.GetString();   // This branch is deprecated.
#endif
}

CString convert(const std::string &amp;s)
{
#ifdef UNICODE
    return CString(Utils::convert(s).c_str());
#else
    Exceptions::Assert(false, &#34;Unicode policy violation. See W569&#34;); // This branch is deprecated as it does not support unicode
    return s.c_str();   
#endif
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/should-character-encodings-besides-utf-8-and-maybe-utf-16-utf-32-be-deprecated/'>Should character encodings besides UTF-8 (and maybe UTF-16/UTF-32) be deprecated</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/understanding-the-encoding-scheme-in-python-3/'>Understanding the encoding scheme in python 3</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/a-unicode-sentinel-value-i-can-use/'>A Unicode sentinel value I can use</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/is-the-bom-optional-for-utf-16-and-utf-32/'>Is the BOM optional for UTF-16 and UTF-32</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/should-utf-8-csv-files-contain-a-bom-byte-order-mark/'>Should UTF-8 CSV files contain a BOM (byte order mark)</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/how-to-align-on-both-word-size-and-cache-lines-in-x86/'>How to align on both word size and cache lines in x86</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>