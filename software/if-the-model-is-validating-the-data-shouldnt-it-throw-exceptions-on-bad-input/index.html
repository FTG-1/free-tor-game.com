<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>If the model is validating the data, shouldn&#8217;t it throw exceptions on bad input &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073887 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073887" class="post-1073887 software type-software status-publish hentry category-software tag-exceptions tag-language-agnostic tag-validation"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">If the model is validating the data, shouldn&#8217;t it throw exceptions on bad input</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">exceptions</span><span class="mr-2 badge badge-info">language-agnostic</span><span class="mr-2 badge badge-warning">validation</span></p><div class="entry-content"><p>Reading this <a href="https://stackoverflow.com/questions/17060633/show-multiple-catch-messages-in-php">SO question</a> it seems that throwing exceptions for validating user input is frowned upon.</p><p>But who should validate this data? In my applications, all validations are done in the business layer, because only the class itself really knows which values are valid for each one of its properties. If I were to copy the rules for validating a property to the controller, it is possible that the validation rules change and now there are two places where the modification should be made.</p><p>Is my premise that validation should be done on the business layer wrong?</p><h1>What I do</h1><p>So my code usually ends up like this:</p><pre><code>&lt;?php
class Person
{
  private $name;
  private $age;

  public function setName($n) {
    $n = trim($n);
    if (mb_strlen($n) == 0) {
      throw new ValidationException(&#34;Name cannot be empty&#34;);
    }
    $this-&gt;name = $n;
  }

  public function setAge($a) {
    if (!is_int($a)) {
      if (!ctype_digit(trim($a))) {
        throw new ValidationException(&#34;Age $a is not valid&#34;);
      }
      $a = (int)$a;
    }
    if ($a &lt; 0 || $a &gt; 150) {
      throw new ValidationException(&#34;Age $a is out of bounds&#34;);
    }
    $this-&gt;age = $a;
  }

  // other getters, setters and methods
}
</code></pre><p>In the controller, I just pass the input data to the model, and catch thrown exceptions to show the error(s) to the user:</p><pre><code>&lt;?php
$person = new Person();
$errors = array();

// global try for all exceptions other than ValidationException
try {

  // validation and process (if everything ok)
  try {
    $person-&gt;setAge($_POST[&#39;age&#39;]);
  } catch (ValidationException $e) {
    $errors[&#39;age&#39;] = $e-&gt;getMessage();
  }

  try {
    $person-&gt;setName($_POST[&#39;name&#39;]);
  } catch (ValidationException $e) {
    $errors[&#39;name&#39;] = $e-&gt;getMessage();
  }

  ...
} catch (Exception $e) {
  // log the error, send 500 internal server error to the client
  // and finish the request
}

if (count($errors) == 0) {
  // process
} else {
  showErrorsToUser($errors);
}
</code></pre><p>Is this a bad methodology?</p><h1>Alternate method</h1><p>Should maybe I create methods for <code>isValidAge($a)</code> that return true/false and then call them from the controller?</p><pre><code>&lt;?php
class Person
{
  private $name;
  private $age;

  public function setName($n) {
    $n = trim($n);
    if ($this-&gt;isValidName($n)) {
      $this-&gt;name = $n;
    } else {
      throw new Exception(&#34;Invalid name&#34;);
    }
  }

  public function setAge($a) {
    if ($this-&gt;isValidAge($a)) {
      $this-&gt;age = $a;
    } else {
      throw new Exception(&#34;Invalid age&#34;);
    }
  }

  public function isValidName($n) {
    $n = trim($n);
    if (mb_strlen($n) == 0) {
      return false;
    }
    return true;
  }

  public function isValidAge($a) {
    if (!is_int($a)) {
      if (!ctype_digit(trim($a))) {
        return false;
      }
      $a = (int)$a;
    }
    if ($a &lt; 0 || $a &gt; 150) {
      return false;
    }
    return true;
  }

  // other getters, setters and methods
}
</code></pre><p>And the controller will be basically the same, just instead of try/catch there are now if/else:</p><pre><code>&lt;?php
$person = new Person();
$errors = array();
if ($person-&gt;isValidAge($age)) {
  $person-&gt;setAge($age);
} catch (Exception $e) {
  $errors[&#39;age&#39;] = &#34;Invalid age&#34;;
}

if ($person-&gt;isValidName($name)) {
  $person-&gt;setName($name);
} catch (Exception $e) {
  $errors[&#39;name&#39;] = &#34;Invalid name&#34;;
}

...

if (count($errors) == 0) {
  // process
} else {
  showErrorsToUser($errors);
}
</code></pre><h1>So, what should I do?</h1><p>I&#39;m pretty happy with my original method, and my colleagues to whom I have showed it in general have liked it. Despite this, should I change to the alternate method? Or am I doing this terribly wrong and I should look for another way?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The approach I&#39;ve used in the past is to put all validation logic dedicated Validation classes.</p><p>You can then inject these Validation classes into your Presentation Layer for early input validation.  And, nothing prevents your Model classes from using the very same classes to enforce Data Integrity.</p><p>Following this approach you can then treat Validation Errors differently depending on which layer they happen in:</p><ul><li>If Data Integrity Validation fails in the Model, then throw an Exception.</li><li>If User Input Validation fails in the Presentation Layer, then display a helpful tip and delay pushing the value to your Model.</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-is-catching-general-exceptions-really-a-bad-thing/'>C# &#8211; Is catching general exceptions really a bad thing</a></li><li class="list-group-item"><a href='../php-best-method-in-php-for-the-error-handling-convert-all-php-errors-warnings-notices-etc-to-exceptions/'>Php &#8211; Best method in PHP for the Error Handling ? Convert all PHP errors (warnings notices etc) to exceptions</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>