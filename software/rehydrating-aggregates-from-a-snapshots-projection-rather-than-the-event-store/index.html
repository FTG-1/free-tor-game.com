<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Rehydrating Aggregates from a &#8220;snapshots&#8221; projection rather than the Event Store &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071936 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071936" class="post-1071936 software type-software status-publish hentry category-software tag-cqrs tag-event-sourcing tag-eventual-consistency tag-read-model"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Rehydrating Aggregates from a &#8220;snapshots&#8221; projection rather than the Event Store</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">cqrs</span><span class="mr-2 badge badge-info">event-sourcing</span><span class="mr-2 badge badge-warning">eventual-consistency</span><span class="mr-2 badge badge-primary">read-model</span></p><div class="entry-content"><p>So I&#39;ve been flirting with Event Sourcing and CQRS for a while now, though I&#39;ve never had the opportunity to apply the patterns on a real project.</p><p>I understand the benefits of separating your read and write concerns, and I appreciate how Event Sourcing makes it easy to project state changes to &#34;Read Model&#34; databases which are different from your Event Store.</p><p>What I&#39;m not super clear on is why you would ever rehydrate your Aggregates from the Event Store itself.</p><p>If projecting changes to &#34;read&#34; databases is so easy, why not always project changes to a &#34;write&#34; database whose schema perfectly matches your domain model?    This would effectively be a snapshot database.</p><p>I imagine this must be pretty common in ES+CQRS applications in the wild.</p><p>If this is the case, is the Event Store only useful when rebuilding your &#34;write&#34; database as a result of schema changes?  Or am I missing something bigger?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>What I&#39;m not super clear on is why you would ever rehydrate your Aggregates from the Event Store itself.</p></blockquote><p>Because the &#34;events&#34; are the book of record.</p><blockquote><p>If projecting changes to &#34;read&#34; databases is so easy, why not always project changes to a &#34;write&#34; database whose schema perfectly matches your domain model? This would effectively be a snapshot database.</p></blockquote><p>Yes; it&#39;s sometimes a useful performance optimization to use a cached copy of aggregate state, rather than regenerating that state from scratch every time.  Remember: the first rule of performance optimization is &#34;Don&#39;t&#34;.  It adds extra complexity to the solution, and you&#39;d prefer to avoid that until you have a compelling business motivation.</p><blockquote><p>If this is the case, is the Event Store only useful when rebuilding your &#34;write&#34; database as a result of schema changes? Or am I missing something bigger?</p></blockquote><p>You are missing something bigger.</p><p>First point is that if you are considering an event sourced solution, it is because you expect there to be value in preserving the history of what has happened, which is to say that you want to be making <em>non destructive changes</em>.</p><p>So that&#39;s why we are writing to the event store at all.</p><p>In particular, this means that every change needs to be written to the event store.</p><p>Competing writers could potentially either destroy each other&#39;s writes, or drive the system to an unintended state, if they aren&#39;t aware of each other&#39;s edits.  So the usual approach when you need consistency is to address your writes to a specific position in the journal (analogous to a conditional PUT in an HTTP api).  A failed write tells the writer that their current understanding of the journal is out of sync, and that they should recover.</p><p>Returning to a known good position then replaying any additional events since that point is a common recovery strategy.  That known good position can be a copy of what is in the local cache, or a representation in your snapshot store.</p><p>In the happy path, you can keep a snapshot of the aggregate in memory; you only need to reach out to an external store when there is no local copy available.</p><p>Furthermore, you don&#39;t need to be <em>completely</em> caught up, if you have access to the book of record.</p><p>So the usual approach (<em>if</em> using a snapshot repository) is to maintain it <em>asynchronously</em>.  That way, if you do need to recover, you can do so without reloading and replaying the entire history of the aggregate.</p><p>There are many cases where this complexity is not of interest, because fine grained aggregates with scoped lifetimes don&#39;t usually collect enough events for the benefits to exceed the costs of maintaining a snapshot cache.</p><p>But when it is the right tool for the problem, loading a stale representation of the aggregate into the write model, then updating it with additional events, is a perfectly reasonable thing to do.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../cqrs-without-using-others-patterns/'>CQRS without using others patterns</a></li><li class="list-group-item"><a href='../how-to-store-sagas-with-event-sourcing/'>How to store Sagas with Event Sourcing</a></li><li class="list-group-item"><a href='../cqrs-with-an-event-log-and-without-event-sourcing/'>CQRS with an Event Log and without Event Sourcing</a></li><li class="list-group-item"><a href='../reducing-the-code-duplication-between-read-and-write-application-in-cqrs/'>Reducing the code duplication between read and write application in CQRS</a></li><li class="list-group-item"><a href='../what-are-the-problems-with-command-handlers-returning-data-in-cqrs/'>What are the problems with command handlers returning data in CQRS</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>