<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>ASP.net MVC static class and background worker &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077205 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077205" class="post-1077205 software type-software status-publish hentry category-software tag-asp-net-mvc tag-service-workers tag-static"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">ASP.net MVC static class and background worker</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-mvc</span><span class="mr-2 badge badge-info">service-workers</span><span class="mr-2 badge badge-warning">static</span></p><div class="entry-content"><p>I have an MVC 5 ASP.net app that is working perfectly. A colleague of mine has made a project that reads in data from files and churns some of it to output some calculations for me to display in the web application. I call his methods and I get the data back and display on screen.</p><p>As part of his project he has implemented a kind of caching system, it&#39;s not using any of the caching tools in. NET, it&#39;s simply holding some of the files required for calculating the numbers in memory as these take a long time to load in and are definitely the bottle neck.</p><p>So I need to do two things</p><p>1) Have one instance of the class within the project so it makes use of the in memory files.</p><p>2) Setup a worker process that runs at 7am everyday to load those files into memo.</p><p>For number one I have instantiated my colleague&#39;s class as a static class and this seems to work some of the time but it&#39;s unreliable for some reason I&#39;m guessing due to app pool timeouts, I&#39;m also worried about the effectiveness of this and whether or not I will have issues with multiple users sending concurrent requests. Is there a better way to achieve this? I&#39;ve looked at various .NET caching libraries so I could get my colleague to implement a proper cache but for now I&#39;m assuming I can&#39;t ask him. I&#39;m a little confused as to why in MVC every time a user sends a new request a new controller is instantiated hence instantiating my colleague&#39;s class again and losing the in-memory files?</p><p>For number 2 I&#39;ve read about webbackgrounder a library for ASP.net that can run background tasks. All I need to do is whilst the app is running on IIS then run a method everyday at 7am.</p><p>Update:</p><p>I can&#39;t save the output because I need to calculate these vlaues on the fly, there&#39;s about 10 different inputs into the calculation that can change to be any number of different values.</p><p>I can indeed put the input files into a database but that doesn&#39;t solve my problem, it wouldn&#39;t be any faster than loading them in from files, which takes too long as it is, I want to hold these items in memory hence the cache approach.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>Deploy your colleague&#39;s library as a cached microservice</strong></p><p>Assuming you can&#39;t change your friend&#39;s library at all, you don&#39;t want to use a database, and you want to maintain a reasonable level of process isolation, here&#39;s the right way to do it:</p><ol><li><p>Write a bit of glue to expose your colleague&#39;s library as a RESTful microservice. If you&#39;ve never done this before, <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/older-versions/build-restful-apis-with-aspnet-web-api" rel="nofollow noreferrer">start here</a>.  It shouldn&#39;t take more than 100 lines of code to wrap one function call.</p></li><li><p>Use the uniform interface to manage cache and its duration.</p><ul><li><p>Set up ASP.NET output caching.  You can <a href="https://stackoverflow.com/questions/1043112/programmatically-control-output-caching-disable-or-enable-cache-according-to-p">do it programmatically</a> or use the <a href="https://msdn.microsoft.com/en-us/library/system.web.mvc.outputcacheattribute(v=vs.118).aspx" rel="nofollow noreferrer">OutputCacheAttribute</a>, whichever is easier for you.  Set the cache to an absolute expiration of 7:01 am.</p></li><li><p>Set IIS to enable output caching <a href="https://technet.microsoft.com/en-us/library/cc754957(v=ws.10).aspx" rel="nofollow noreferrer">per these instructions</a>.</p></li></ul></li><li><p>Set the application pool for this service to recycle at 6:59 am.</p></li><li><p>Modify your web site to utilize the new service.</p></li><li><p>If your colleague&#39;s code takes a long time to run, the microservice may not be responsive when handling its very first request. To deal with this, you need to &#34;warm up&#34; the service.  Set up <a href="https://stackoverflow.com/questions/11854243/asp-net-warmup-initialize">warmup using IIS auto-start</a>; details can be found <a href="https://www.simple-talk.com/blogs/speeding-up-your-application-with-the-iis-auto-start-feature/" rel="nofollow noreferrer">here</a>.</p></li></ol><p>With this approach, your colleague&#39;s code is completely isolated from yours, and the caching logic simply leverages standard features in IIS. With the caching and recycle scheme set up properly, you should have seamless transitions when the program is recycled, since IIS will continue to serve requests in flight from the old cache while building up the new cache. We set the cache expiration to exactly 7:01 am (as opposed to letting the app pool recycle take care of it) just in case there is some other network node looking at your cache headers, e.g. a proxy server that might cache the response if it isn&#39;t encrypted.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-flash-messages-in-asp-net-mvc-without-sessions/'>C# &#8211; Flash messages in ASP.NET MVC without sessions</a></li><li class="list-group-item"><a href='../php-is-asp-net-mvc-completely-and-exclusively-based-on-conventions/'>Php &#8211; Is ASP.NET MVC completely (and exclusively) based on conventions</a></li><li class="list-group-item"><a href='../how-to-cache-data-that-rarely-changes/'>How to cache data that rarely changes</a></li><li class="list-group-item"><a href='../c-convert-class-to-another-class-and-vice-versa/'>C# &#8211; Convert class to another class and vice versa</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>