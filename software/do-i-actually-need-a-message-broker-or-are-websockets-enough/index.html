<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Do I actually need a message broker or are websockets enough &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071865 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071865" class="post-1071865 software type-software status-publish hentry category-software tag-client-server tag-flask tag-message-queue tag-socket-io tag-websockets"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Do I actually need a message broker or are websockets enough</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">client-server</span><span class="mr-2 badge badge-info">flask</span><span class="mr-2 badge badge-warning">message-queue</span><span class="mr-2 badge badge-primary">socket.io</span><span class="mr-2 badge badge-danger">websockets</span></p><div class="entry-content"><p>The website I am building has a real-time messaging component. The backend is built with Flask and I have integrated Flask-SocketIO to handle Websocket connections when users are on the messaging page.</p><p>My current infrastructure is pretty simple. Flask handles both HTTP requests and Websocket events. When users land on the Messages page, the client sends a <code>GET /message_history</code> request and then opens a socket connection.</p><p><a href="../../../i.stack.imgur.com/IVj6H.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/IVj6H.png" alt="enter image description here"/></a></p><p>When Alice sends a message to Bob, the server handles the event, checks that Alice is logged in and is allowed to talk to Bob, then stores the message in the database and finally emits the message back to both Alice and Bob, whose clients are listening for events from the server.</p><p>This works fine in development but for production I need to make changes.</p><p>Primarily, this won&#39;t work under a load-balancer. As per the <a href="https://flask-socketio.readthedocs.io/en/latest/#using-multiple-workers" rel="nofollow noreferrer">Flask-SocketIO docs</a>:</p><blockquote><p>There are two requirements to use multiple Flask-SocketIO workers:</p><ul><li><p>The load balancer must be configured to forward all HTTP requests from<br /> a given client always to the same worker. This is sometimes referenced<br /> as “sticky sessions”.</p></li><li><p>Since each of the servers owns only a subset of the client<br /> connections, a message queue such as Redis or RabbitMQ is used by the<br /> servers to coordinate complex operations such as broadcasting and<br /> rooms.</p></li></ul></blockquote><p>However, I don&#39;t quite understand how to implement Redis or RabbitMQ as part of my current event handlers, since the clients will not be connecting to Redis/RabbitMQ directly. The Flask server will always need to be the middleman since it needs to perform checks and store the messages in the database.</p><p>Take a look at <a href="https://stackoverflow.com/a/14969041/2808373">this answer</a> on SO:</p><blockquote><p>Redis pub/sub is great in case all clients have direct access to<br /> redis. If you have multiple node servers, one can push a message to<br /> the others.</p><p>But if you also have clients in the browser, you need something else<br /> to push data from a server to a client, and in this case, socket.io is<br /> great.</p><p>Now, if you use socket.io with the Redis store, socket.io will use<br /> Redis pub/sub under the hood to propagate messages between servers,<br /> and servers will propagate messages to clients.</p></blockquote><hr/><h3>EDIT</h3><p>I followed the docs: I have Redis running locally, I have installed the dependecies and monkey-patched eventlet. I ran everything and it works&#8230; ? I see that Redis is receiving &#34;SUBSCRIBE&#34; and &#34;PUBLISH&#34; events&#8230;</p><ol><li><p>Do I still need my PSQL database? Can I use the Redis store to fetch historic messages? What happens if the Redis instance dies?</p></li><li><p>If I run this under a load-balancer, and have configured sticky sessions, does Redis (or Flask?) automagically know how to distribute the messages to the correct nodes?</p></li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>At a high-level, in your design, the PostgreSQL database is standing in for the Redis cache and/or messaging system.</p><p>This can be made to work but you could run into scalability issues.  When you use a database as a messaging system, managing the state of messages becomes problematic.  For example, when you create a new message to be sent, you want to make sure that only one handler picks up that message and delivers it.  This coordination is not something that DBs tend to provide by default.  There are various schemes you can use but if you use a messaging platform it&#39;s an inherent feature.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../is-having-a-bi-directional-message-queue-a-design-smell/'>Is having a bi directional message queue a design smell</a></li><li class="list-group-item"><a href='../design-pattern-for-socket-io-and-express/'>Design pattern for socket.io and Express</a></li><li class="list-group-item"><a href='../deliver-message-to-websocket-client-connected-through-load-balancer/'>Deliver message to websocket client connected through load balancer</a></li><li class="list-group-item"><a href='../message-broker-in-client-server-applications/'>Message Broker in Client-Server-Applications</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>