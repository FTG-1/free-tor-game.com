<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; Unit testing Eloquent outside of Laravel &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077978 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077978" class="post-1077978 software type-software status-publish hentry category-software tag-laravel tag-orm tag-phpunit tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; Unit testing Eloquent outside of Laravel</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">laravel</span><span class="mr-2 badge badge-info">orm</span><span class="mr-2 badge badge-warning">phpunit</span><span class="mr-2 badge badge-primary">unit testing</span></p><div class="entry-content"><p>How can I unit test my Eloquent models when I&#39;m using the ORM outside of Laravel? What I&#39;m hoping to do it run tests on each model but somehow mock the database connection/query/builder(?) object.</p><p>Below is something along the lines of what I&#39;m trying to do:</p><pre><code>$capsule = new Capsule; 

$capsule-&gt;addConnection(array(
    &#39;driver&#39;    =&gt; &#39;mysql&#39;,
    &#39;host&#39;      =&gt; &#39;localhost&#39;,
    &#39;database&#39;  =&gt; &#39;mydb&#39;,
    &#39;username&#39;  =&gt; &#39;dbuser&#39;,
    &#39;password&#39;  =&gt; &#39;badpass&#39;,
    &#39;charset&#39;   =&gt; &#39;utf8&#39;,
    &#39;collation&#39; =&gt; &#39;utf8_unicode_ci&#39;,
    &#39;prefix&#39;    =&gt; &#39;&#39;
));

$capsule-&gt;bootEloquent();
</code></pre><p>Below is my model:</p><pre><code>&lt;?php

use Illuminate\Database\Eloquent\Model as Eloquent;

class Users extends Eloquent
{
    public function myCustomFind($id)
    {
        // .. lots of various checks before find() ...

        return $this-&gt;find($id);
    }
}
</code></pre><p>Then, in my unit tests I can do the following (not a working version, but I hope you can see what I&#39;m hoping to do):</p><pre><code>$mockSomething-&gt;expects($this-&gt;once)
    -&gt;method(&#39;find&#39;)
    -&gt;with(1);

$users = new Users();
$users-&gt;setSomething($mockSomething);

$user = $users-&gt;myCustomFind(1);
</code></pre><p>&#8230;I just have no idea how to do this without full integration (data being written to the database). I just want to test my models, not the ORM, also so my tests are fast and only checking the correct params are passed to the query builder, and that my method handles the resulting data correctly. Will Eloquent allow this? I notice that Laravel has it&#39;s own TestCase class but from what I see this caters for all aspects of testing in Laravel (controllers, etc)</p><p>If Eloquent is not a good choice for unit testing outside of Laravel, are there any popular ORMs that can? I haven&#39;t spent much time with others like Doctrine or Propel to know what they are capable of in that respect. Would appreciate any recommendations.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You probably want to test a class that is using an eloquent model rather than the model itself.</p><p>To create an in memory database for eloquent to query against in your test you want to do create a data base and then create your tables in it with some data to test against.</p><pre><code>use MyNamespace\ClassToTest;
use MyNamespace\Models\MyModel;
use Illuminate\Database\Capsule\Manager as DB;

class ExampleTest extends PHPUnit_Framework_TestCase
{

    public function setUp()
    {
        $this-&gt;configureDatabase();
        $this-&gt;migrateIdentitiesTable();
    }
    protected function configureDatabase()
    {
        $db = new DB;
        $db-&gt;addConnection(array(
            &#39;driver&#39;    =&gt; &#39;sqlite&#39;,
            &#39;database&#39;  =&gt; &#39;:memory:&#39;,
            &#39;charset&#39;   =&gt; &#39;utf8&#39;,
            &#39;collation&#39; =&gt; &#39;utf8_unicode_ci&#39;,
            &#39;prefix&#39;    =&gt; &#39;&#39;,
        ));
        $db-&gt;bootEloquent();
        $db-&gt;setAsGlobal();
    }

    public function migrateIdentitiesTable()
    {
        DB::schema()-&gt;create(&#39;my_table&#39;, function($table) {
            $table-&gt;increments(&#39;id&#39;);
            $table-&gt;integer(&#39;page_id&#39;);
            $table-&gt;timestamps();
        });
        MyModel::create(array(&#39;page_id&#39; =&gt; 1));
        MyModel::create(array(&#39;page_id&#39; =&gt; 2));

    }

    public function testExtract()
    {
        $extractor = new ClassToTest();
        $result = $extractor-&gt;someFunctionThatUsesAnEloquentModel(1);
        $expected = array(
            &#39;id&#39; =&gt; &#39;1&#39;,
            &#39;page_id&#39; =&gt; &#39;1&#39;
        );
        $this-&gt;assertEquals($expected[&#39;page_id&#39;], $result[&#39;page_id&#39;]);
    }

}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-for-an-orm-supporting-data-validation-should-constraints-be-enforced-in-the-database-as-well/'>Database &#8211; For an ORM supporting data validation, should constraints be enforced in the database as well</a></li><li class="list-group-item"><a href='../unit-testing-unit-testing-in-django/'>Unit-testing &#8211; Unit testing in Django</a></li><li class="list-group-item"><a href='../unit-testing-how-to-unit-test-models-in-mvc-mvr-app/'>Unit-testing &#8211; How to unit test models in MVC / MVR app</a></li><li class="list-group-item"><a href='../using-laravel-with-dao-instead-of-eloquent-orm/'>Using Laravel with DAO instead of Eloquent ORM</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>