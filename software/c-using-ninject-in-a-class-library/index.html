<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Using ninject in a class library &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074279 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074279" class="post-1074279 software type-software status-publish hentry category-software tag-c tag-class tag-libraries tag-ninject tag-service-locator"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Using ninject in a class library</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">class</span><span class="mr-2 badge badge-warning">libraries</span><span class="mr-2 badge badge-primary">ninject</span><span class="mr-2 badge badge-danger">service-locator</span></p><div class="entry-content"><p>Looking for some help getting my head around ninject and DI.</p><p>Using the simple examples I&#39;ve found online everything works nicely but trying to do something more complex is causing headaches.</p><p>I have a class library that receives files, analyses them and stores the result in a database. This library can be called from various parts of a business; windows service, website, windows application, etc.</p><p>Please see this example code:</p><pre><code>class FileProcessor : IFileProcessor
{
    public string Process(string fileName)
    {
        using (FileStream fileStream = new FileStream(fileName, FileMode.Open, FileAccess.Read))
        {
            BinaryReader binaryReader = new BinaryReader(fileStream);
            string hexString = BinaryFunctions.BytesToHexString(binaryReader.ReadBytes(2));
            string result = &#34;&#34;;

            if(hexString == &#34;123&#34;)
            {
                // I would like to inject the required BLLs into this constructor
                FileType1Processor p = new FileType1Processor(fileStream);
                result = p.Process();
            }
            else if(hexString == &#34;456&#34;)
            {
                // I would like to inject the required BLLs into this constructor
                FileType2Processor p = new FileType2Processor(fileStream);
                result = p.Process();
            }

            return result;
        }
    }
}
</code></pre><p>I am stuck on how I would get the dependencies into the FileType processors irrespective of what type of application it&#39;s being used in.</p><p>Do I keep the kernel alive in all applications and throw that at the library?<br /> Do I setup a service locator and use that?<br /> Do I create a new kernel at the root of the library?<br /> Am I looking at this all wrong?</p><p>Any help would be much appreciated.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You&#39;re doing quite a lot in a single class, that being said let&#39;s see what we can do.</p><p>First lets modify the code so that we can better support <strong><em>OCP</em></strong>. We will do this by introducing a dictionary that will contain your processors and a related interface <strong>IFileTypeProcessor</strong>.</p><pre><code>interface IFileTypeProcessor
{
    // not sure what string you intended to return
    string Process(FileStream fileStream);
}

class FileProcessor : IFileProcessor
{
    private readonly IDictionary&lt;string, IFileTypeProcessor&gt; processors;
    public FileProcessor(IDictionary&lt;string, IFileTypeProcessor&gt; processors)
    {
            this.processors = processors
    }

    public string Process(string fileName)
    {
        using (FileStream fileStream = new FileStream(fileName, FileMode.Open, FileAccess.Read))
        {
            BinaryReader binaryReader = new BinaryReader(fileStream);
            string hexString = BinaryFunctions.BytesToHexString(binaryReader.ReadBytes(2));
            string result = &#34;&#34;;

            if(!this.processors.ContainsKey(hexString)) 
            {
                throw new YourApplicationSpecificException();
            }
            return this.processors[hexString].Process(fileStream);
        }
    }
}
</code></pre><p>Next let&#39;s introduce a new class called <strong>FirstTwoByteHexKeyProvider</strong> that implements a new interface <strong>IKeyREader</strong> which will then become an additional dependency on the CTOR. We&#39;ll also include some guard clauses to help our users because we like them.</p><pre><code>interface IKeyReader
{
    string GetKeyAsHexString(FileStream filestream)
}

class FirstTwoByteHexKeyProvider : IKeyReader
{
    public string GetKeyAsHexString(FileStream fileStream)
    {
        if(fileStream)
        { 
            throw new ArgumentNullException(nameof(fileStream));
        }

        BinaryReader binaryReader = new BinaryReader(fileStream);
        return BinaryFunctions.BytesToHexString(binaryReader.ReadBytes(2));
    }
}

class FileProcessor : IFileProcessor
    {
        private readonly IDictionary&lt;string, IFileTypeProcessor&gt; processors;
        private readonly IKeyReader keyReader;
        public FileProcessor(IDictionary&lt;string, IFileTypeProcessor&gt; processors, IKeyReader keyReader)
        {
                if(processors == null)
                { 
                    throw new ArgumentNullException(nameof(fileStream));
                }

                if(keyReader == null)
                { 
                    throw new ArgumentNullException(nameof(keyReader));
                }

                this.processors = processors
                this.keyReader = keyReader
        }

        public string Process(string fileName)
        {
            using (FileStream fileStream = new FileStream(fileName, FileMode.Open, FileAccess.Read))
            {
                string hexString = this.keyReader.GetKeyAsHexString(fileStream);

                if(!this.processors.ContainsKey(hexString)) 
                {
                    throw new YourApplicationSpecificException();
                }
                return this.processors[hexString].Process(fileStream);
            }
        }
    }
</code></pre><p>Now on to dependencies, do you need to support only Ninject? if so it could be as simple as using NinjectModules:</p><pre><code>public class FileProcessorNinjectModule : NinjectModule
{
    public override void Load() 
    {
        Bind&lt;IFileProcessor&gt;().To&lt;FileProcessor&gt;();
        Bind&lt;IKeyReader&gt;().To&lt;FirstTwoByteHexKeyProvider&gt;();
        Bind&lt;IDictionary&lt;string, IFileTypeProcessor&gt;&gt;().ToMethod(context =&gt; new Dictionary&lt;string,IFileTypeProcessor&gt;
        {
            [&#34;123&#34;] = new FileType1Processor(),
            [&#34;456&#34;] = new FileType2Processor(),
        });
    }
}
</code></pre><p>Once you have the module built tell your customers to use some form of <a href="https://github.com/ninject/Ninject/wiki/Modules-and-the-Kernel" rel="nofollow">Dynamic Module Loading</a> and Bob&#39;s your uncle.</p><p>I wrote this quickly here and didn&#39;t test it via compiler but I&#39;m sure it&#39;ll work with a bit of correction on your part but it should be enough to get you going.</p><p>If you have to support more than one form of DI then I&#39;d recommend exposing an interface that will allow the customer to provide their own DI Container to you and your package will then use that to resolve dependencies much the same way that ASP.NET Core does it today.</p><p>Lastly you may consider ripping out the action of actually reading the file into another class and making the binary result of this &#34;file read&#34; an argument that get&#39;s passed in to your process method instead of the fileName since as it stands this will be a bit of a pain to test.</p><p>If you don&#39;t want to do that then you at the very least can extract the &#34;new FileStream(...&#34; into an internal virtual function which will give you the ability to MOQ around this system call in unit testing.</p><p>Hope that helps...</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-desktop-application-dependency-injection/'>Design &#8211; Desktop application, dependency injection</a></li><li class="list-group-item"><a href='../java-how-to-decouple-simple-factory-and-default-implementation/'>Java &#8211; How to decouple simple factory and default implementation</a></li><li class="list-group-item"><a href='../c-how-to-deal-with-dependency-when-you-have-separate-projects/'>C# &#8211; How to deal with dependency when you have separate projects</a></li><li class="list-group-item"><a href='../c-only-use-a-dependency-injection-container-at-the-root-of-an-application/'>C# &#8211; Only use a dependency injection container at the root of an application</a></li><li class="list-group-item"><a href='../c-ambient-dependency-injection-through-static-service-locator/'>C# &#8211; Ambient dependency injection through static service locator</a></li><li class="list-group-item"><a href='../c-dependency-injection-for-a-library-with-internal-dependencies/'>C# &#8211; Dependency injection for a library with internal dependencies</a></li><li class="list-group-item"><a href='../c-unity-injection-with-too-many-constructor-parameters/'>C# &#8211; Unity injection with too many constructor parameters</a></li><li class="list-group-item"><a href='../unit-of-work-repository-pattern-dependency-injection/'>Unit of work + repository pattern + dependency injection</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>