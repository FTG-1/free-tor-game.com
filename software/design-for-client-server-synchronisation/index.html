<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design for client-server synchronisation &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085616 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085616" class="post-1085616 software type-software status-publish hentry category-software tag-backend tag-client tag-design tag-server tag-synchronization"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design for client-server synchronisation</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">backend</span><span class="mr-2 badge badge-info">client</span><span class="mr-2 badge badge-warning">design</span><span class="mr-2 badge badge-primary">server</span><span class="mr-2 badge badge-danger">synchronization</span></p><div class="entry-content"><h3>Background</h3><p>I am working on improving the backend design for a video game. The game is live and working fine, but we want to improve various things. As a video game studio, we often do events which sometimes need tinkering with whilst the event is live &#8211; we would love to be able to do these changes seamlessly without having to force an update on players.</p><h3>Problem</h3><p>Our current backend uses various hardcoded values that our endpoints use. This means if we ever want to change an endpoint&#39;s behaviour we have to re-deploy. For instance, if we decide that a certain online-store item needs to point to something else we would need to change the id that is referenced on the endpoint. This is cumbersome and not ideal; we want a more dynamic way of changing configs.</p><p>The general idea we had is that we store these properties in a file on S3 / a CDN and the client and the backend fetch these periodically. There are issues with this approach when it comes to ensuring that both the backend and the client use the same configuration.</p><p><em>Edited solutions for clarity</em></p><h3>Possible Solutions</h3><p><strong>Solution A)</strong></p><p>Create an API that allows the source of the &#34;truthiest&#34; file to speak to the server. Push this new file to the server&#39;s cache whenever there is a change. Then, whenever the client talks to the server, check the client&#39;s file version/hash and compare it to what we have. If it matches, proceed, else we either 1) force the client to update, 2) tell the client to update manually (meaning we deny it access until then) or 3) have a version leeway that will give enough time for the client to update, in theory.</p><p><a href="../../../i.stack.imgur.com/VjaRR.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/VjaRR.png" alt="enter image description here"/></a></p><p><strong>Pros</strong></p><ul><li>avoids roundway trips between server and file provider</li></ul><p><strong>Cons</strong></p><ul><li>not sure what solution is best for synchronising (1, 2 or 3)</li><li>more work required to build API etc&#8230;</li></ul><hr/><p><strong>Solution B)</strong><br /> Both the client and the server make calls periodically to see if there is a new config. When the client speaks to the server and the versions do not match, we have the 3 options again, only this time the server has to make calls to the storage (the truthiest source) to check which version is the correct one.<br /> <a href="../../../i.stack.imgur.com/sIPA3.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/sIPA3.png" alt="enter image description here"/></a></p><p><strong>Pros</strong></p><ul><li>less work than Solution A</li></ul><p><strong>Cons</strong></p><ul><li>less reliable, too many points of weakness</li><li>too many round-trips between server-storage and client-storage.</li></ul><p><em>Note on storage</em><br /> There are problems with both S3 and a CDN. S3 isn&#39;t always honest &#8211; it can sometimes return older data &#8211; it is not a single source of truth. A CDN is useful as clients will have download this data for their specific language, but redistributing each new version can take time, which is why we may need a leeway.</p><hr/><p>This is a brief overview of the ideas we had. There are caveats that may or may not have been outlined but we are looking to find how this kind of thing is typically handled.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>tl;dr: When you rev the content, rev the filename.</p><blockquote><p>The general idea we had is that we store these properties in a file on S3 / a CDN and the client and the backend fetch these periodically.</p></blockquote><p>No, this is the wrong design, due to the concerns that you cite.</p><p>You might have a hallway conversation about some client code &#34;that manipulates <em>the</em> config file&#34;, that&#39;s fine. But what is crucial for your setup is the <em>URI</em> of the &#34;the&#34; config file must change each time you rev it. This induces cache misses and causes clients to be exactly in sync with server, as you desire. The cache hierarchy has many levels, some of which you can see or control, and inventing a new URI has the nice effect of causing cache misses at every level.</p><p>It&#39;s a simple matter of tacking on an ISO8601 timestamp and a serial number or hash to the config file&#39;s URI.</p><p>Depending on how frequently your config churns, you may want to age out ancient versions from your CDN.</p><p>Server will have to honor requests corresponding to K recent config files, where K is at least 2. Client requests should describe the config file in use by the client so server can verify it is a sensible request.</p><p>EDIT: You have recently added diagrams A &amp; B. In (A) you propose client refreshing &#34;same file&#34; from servers. I am suggesting that intermediate &#34;transparent&#34; caches can confound that arrangement, and that is is appropriate to occasionally tell the client a new config file name so he will suffer cache miss and will retrieve from server. In (B) you have even less control over caching effects, so inventing a new config file name is even more important, to deal with the &#34;older data from S3&#34; issue that you mention. The synopsis is simply that you publish the content under each filename exactly once, and rev the filename when you rev the content. That way you can avoid heavier weight approaches like Paxos/ZK. You just need to push a new rev at time t0, wait N seconds until your servers have a copy of it, and then after t0 + N the servers are free to send the new name to clients so clients will use it. This offers consistency with very little effort. Alternatively, assume the load balancer hashes a given client to a single server, so within the brief interval it takes for all servers to get a fresh config, clients will only communicate with single server and therefore will trivially be in sync with that server.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-do-data-synchronisation-between-two-applications/'>How to do data synchronisation between two applications</a></li><li class="list-group-item"><a href='../should-processing-filtering-be-performed-client-side-or-server-side-for-catalog-based-apps/'>Should processing/filtering be performed client side or server side for catalog based apps</a></li><li class="list-group-item"><a href='../rest-many-small-requests-vs-few-large-requests-api-design/'>Rest &#8211; Many small requests vs. few large requests (API Design)</a></li><li class="list-group-item"><a href='../a-simple-approach-for-data-synchronisation/'>A simple approach for data synchronisation</a></li><li class="list-group-item"><a href='../wait-for-files-in-a-remote-directory-to-be-created-then-transfer-the-files-immediately-to-local-computer/'>Wait for file(s) in a remote directory to be created, then transfer the file(s) immediately to local computer</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>