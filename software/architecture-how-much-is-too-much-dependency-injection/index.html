<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; How much is too much Dependency Injection &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069531 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069531" class="post-1069531 software type-software status-publish hentry category-software tag-architecture tag-dependency-injection"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; How much is too much Dependency Injection</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">dependency-injection</span></p><div class="entry-content"><p>I work in a project that uses (Spring) Dependency Injection for literally everything that is a dependency of a class. We are at a point where the Spring configuration file has grown to about 4000 lines. Not long ago I watched one of Uncle Bob’s talks on YouTube (unfortunately, I could not find the link) in which he recommends injecting only a couple of central dependencies (e.g. factories, database, …) into the Main component from which they will then be distributed.</p><p>The advantages of this approach is the decoupling of the DI framework from the most part of the application and also it makes the Spring config cleaner as the factories will contain a lot more of what was in the config before. On the contrary, this will result in spreading creation logic among many factory classes and testing might become more difficult.</p><p>So my question really is what other advantages or disadvantages you see in the one or the other approach. Are there any best practices? Thanks a lot for your answers!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>As always, It Depends™. The answer depends on the problem one is trying to solve. In this answer, I&#39;ll try to address some common motivating forces:</p><h1>Favour smaller code bases</h1><p>If you have 4,000 lines of Spring configuration code, I suppose that the code base has thousands of classes.</p><p>It&#39;s hardly an issue that you can address after the fact, but as a rule of thumb, I tend to prefer smaller applications, with smaller code bases. If you&#39;re into <a href="http://amzn.to/WBCwx7" rel="noreferrer">Domain-Driven Design</a>, you could, for instance, make a code base per bounded context.</p><p>I&#39;m basing this advice on my limited experience, since I&#39;ve written web-based line-of-business code for most of my career. I could imagine that if you&#39;re developing a desktop application, or an embedded system, or other, that things are harder to pull apart.</p><p>While I do realise that this first advice is easily the least practical, I also believe that it&#39;s the most important, and that&#39;s why I include it. Complexity of code varies non-linearly (possibly exponentially) with the size of the code base.</p><h1>Favour Pure DI</h1><p>While I still realise that this question presents an existing situation, I recommend <a href="http://blog.ploeh.dk/2014/06/10/pure-di" rel="noreferrer">Pure DI</a>. Don&#39;t use a DI Container, but if you do, <a href="http://blog.ploeh.dk/2012/11/06/WhentouseaDIContainer" rel="noreferrer">at least use it to implement convention-based composition</a>.</p><p>I don&#39;t have any practical experience with Spring, but I&#39;m assuming that by <em>configuration file</em>, an XML file is implied.</p><p>Configuring dependencies using XML is the worst of both worlds. First, you lose compile-time type safety, but you don&#39;t gain anything. An XML configuration file can easily be as big as the code it tries to replace.</p><p>Compared to the problem it purports to address, dependency injection configuration files occupy the wrong place on the <a href="http://mikehadlow.blogspot.dk/2012/05/configuration-complexity-clock.html" rel="noreferrer">configuration complexity clock</a>.</p><h1>The case for coarse-grained dependency injection</h1><p>I can make a case for coarse-grained dependency injection. I can also make a case for fine-grained dependency injection (see next section).</p><p>If you only inject a few &#39;central&#39; dependencies, then most classes might look like this:</p><pre><code>public class Foo
{
    private readonly Bar bar;

    public Foo()
    {
        this.bar = new Bar();
    }

    // Members go here...
}
</code></pre><p>This is still fits <a href="http://amzn.to/XBYukB" rel="noreferrer">Design Patterns</a>&#39;s <em>favor object composition over class inheritance</em>, because <code>Foo</code> composes <code>Bar</code>. From a maintainability perspective, this could still be considered maintainable, because if you need to change the composition, you simply edit the source code for <code>Foo</code>.</p><p>This is hardly less maintainable than dependency injection. In fact, I&#39;d say that it&#39;s easier to directly edit the class that uses <code>Bar</code>, instead of having to follow the indirection inherent with dependency injection.</p><p>In the first edition of <a href="http://amzn.to/12p90MG" rel="noreferrer">my book on Dependency Injection</a>, I make the distinction between volatile and stable dependencies.</p><p>Volatile dependencies are those dependencies that you should consider injecting. They include</p><ul><li>Dependencies that must be re-configurable after compilation</li><li>Dependencies developed in parallel by another team</li><li>Dependencies with non-deterministic behaviour, or behaviour with side-effects</li></ul><p>Stable dependencies, on the other hand, are dependencies that behave in well defined manner. In a sense, you could argue that this distinction makes the case for coarse-grained dependency injection, although I must admit that I didn&#39;t entirely realise that when I wrote the book.</p><p>From a testing perspective, however, this makes unit testing harder. You can no longer unit test <code>Foo</code> independent of <code>Bar</code>. As <a href="https://www.infoq.com/presentations/integration-tests-scam" rel="noreferrer">J.B. Rainsberger explains</a>, integration tests suffer from a combinatoric explosion of complexity. You&#39;ll literally have to write tens of thousands of test cases if you want to cover all paths through an integration of even 4-5 classes.</p><p>The counter-argument to that is that often, your task isn&#39;t to program a class. Your task is to develop a system that solves some specific problems. This is the motivation behind <a href="https://dannorth.net/introducing-bdd" rel="noreferrer">Behaviour-Driven Development</a> (BDD).</p><p>Another view on this is presented by DHH, who claims that <a href="http://david.heinemeierhansson.com/2014/test-induced-design-damage.html" rel="noreferrer">TDD leads to test-induced design damage</a>. He also favours coarse-grained integration testing.</p><p>If you take this perspective on software development, then coarse-grained dependency injection makes sense.</p><h1>The case for fine-grained dependency injection</h1><p>Fine-grained dependency injection, on the other hand, could be described as <em>inject all the things!</em></p><p>My main concern regarding coarse-grained dependency injection is the criticism expressed by J.B. Rainsberger. You can&#39;t cover all code paths with integration tests, because you need to write literally thousands, or tens of thousands, of test cases to cover all code paths.</p><p>The proponents of BDD will counter with the argument that you don&#39;t need to cover all code paths with tests. You only need to cover those that produce business value.</p><p>In my experience, however, all the &#39;exotic&#39; code paths will also execute in a high-volume deployment, and if not tested, many of those will have defects and cause run-time exceptions (often null-reference exceptions).</p><p>This has caused me to favour fine-grained dependency injection, because it enables me to test the invariants of all objects in isolation.</p><h1>Favour functional programming</h1><p>While I lean towards fine-grained dependency injection, I&#39;ve shifted my emphasis towards functional programming, among other reasons because <a href="http://blog.ploeh.dk/2015/05/07/functional-design-is-intrinsically-testable" rel="noreferrer">it&#39;s intrinsically testable</a>.</p><p>The more you move towards SOLID code, <a href="http://blog.ploeh.dk/2014/03/10/solid-the-next-step-is-functional" rel="noreferrer">the more functional it becomes</a>. Sooner or later, you may as well take the plunge. <a href="http://blog.ploeh.dk/2016/03/18/functional-architecture-is-ports-and-adapters" rel="noreferrer">Functional architecture is Ports and Adapters architecture</a>, and <a href="http://blog.ploeh.dk/2013/12/03/layers-onions-ports-adapters-its-all-the-same" rel="noreferrer">dependency injection is also an attempt and Ports and Adapters</a>. The difference, however, is that a language like Haskell enforces that architecture via its type system.</p><h1>Favour statically typed functional programming</h1><p>At this point, I&#39;ve essentially given up on object-oriented programming (OOP), although many of the problems of OOP are intrinsically coupled to mainstream languages like Java and C# more than the concept itself.</p><p>The problem with mainstream OOP languages is that it&#39;s close to impossible to avoid the combinatoric explosion problem, which, untested, leads to run-time exceptions. Statically typed languages like Haskell and F#, on the other hand, enable you to encode many decision points in the type system. This means that instead of having to write thousands of tests, the compiler will simply tell you whether you&#39;ve dealt with all possible code paths (to an extent; it&#39;s no silver bullet).</p><p>Also, <a href="http://blog.ploeh.dk/2017/01/30/partial-application-is-dependency-injection" rel="noreferrer">dependency injection isn&#39;t functional</a>. True functional programming must <a href="http://blog.ploeh.dk/2017/02/02/dependency-rejection" rel="noreferrer">reject the entire notion of dependencies</a>. The result is simpler code.</p><h1>Summary</h1><p>If forced to work with C#, I prefer fine-grained dependency injection because it enables me to cover the entire code base with a manageable number of test cases.</p><p>In the end, my motivation is rapid feedback. Still, <a href="http://blog.ploeh.dk/2011/04/29/Feedbackmechanismsandtradeoffs" rel="noreferrer">unit testing isn&#39;t the only way to get feedback</a>.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../dependency-injection-dependency-chain-pattern/'>Dependency Injection &#8211; Dependency Chain Pattern</a></li><li class="list-group-item"><a href='../understanding-dependency-injection/'>Understanding dependency injection</a></li><li class="list-group-item"><a href='../architecture-how-to-handle-circular-dependency-in-dependency-injection/'>Architecture &#8211; How to handle &#8220;circular dependency&#8221; in dependency injection</a></li><li class="list-group-item"><a href='../c-circular-dependency-in-dependency-injection/'>C# &#8211; Circular dependency in dependency injection</a></li><li class="list-group-item"><a href='../architecture-criticism-and-disadvantages-of-dependency-injection/'>Architecture &#8211; Criticism and disadvantages of dependency injection</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>