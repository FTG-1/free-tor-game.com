<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Consuming external APIs within the microservice architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086396 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086396" class="post-1086396 software type-software status-publish hentry category-software tag-go tag-json tag-microservices tag-protobuf"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Consuming external APIs within the microservice architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">go</span><span class="mr-2 badge badge-info">json</span><span class="mr-2 badge badge-warning">microservices</span><span class="mr-2 badge badge-primary">protobuf</span></p><div class="entry-content"><p>I&#39;m writing a small microservice-based application. One of the services is assigned the task of querying an external API and processing the JSON response (filtered list of houses). Since I&#39;m using Protocol Buffers to serialize the message that will be sent to the message broker I need to convert the JSON output to the appropriate Protocol Buffer format.</p><p>This is a diagram that illustrates the overall architecture:</p><p><a href="../../../i.stack.imgur.com/gYXg8.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/gYXg8.png" alt="enter image description here"/></a></p><p>The problem is, that since the JSON response is long, paginated and also has many nested fields there is no easy way to manually create a corresponding ProtoBuff message struct.</p><p>I could potentially send the JSON response as a text string and deal with it on the database service side, but this then presents the problem of how to store each house object inside the database so that it can be queried later.</p><p>Unmarshalling the whole response into a Go struct would pose the  same problems as trying to create a ProtoBuff message struct in the first place. Storing it inside a database as a raw JSON field is not an option since I need to be able to query some of the fields  and actually extract each house description from the body of the response.</p><p>Additionally, creating a database schema that matches hundreds of different fields and nested objects, seems like a very tedious way of going about it.</p><p>What are the best practices when it comes to processing substantial JSON output across many web services?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><ol><li><p>There is no clear reason on why to convert the JSON format in the message broker. Probably, leaving it a JSON object through the message broker is the way to go.</p></li><li><p>In terms of how deep you should model it, it depends on several factors. Here are some hints:</p><ul><li>If it is a set of information the microservice should provide in different use cases and information other than just the external API&#39;s should be stored together, it is a sign that you should probably build your our domain or <a href="https://en.wikipedia.org/wiki/Canonical_model" rel="nofollow noreferrer">canonical model</a>. Be careful <a href="https://www.innoq.com/en/blog/thoughts-on-a-canonical-data-model/" rel="nofollow noreferrer">not to grow this model too much</a> - it should still be a microservice.</li><li>On the other hand, if it is basically a &#34;cache&#34; for the external API, storing it without any conversions should work well enough.</li><li>And there is always the <a href="https://en.wikipedia.org/wiki/Semi-structured_data" rel="nofollow noreferrer">middle path</a>. In this case to structure part of that data, and leave part of the data unstructured.</li></ul></li><li><p>The storing decision also depends on multiple factors (check the following articles and questions about <em>Relational vs. non-relational</em> <a href="https://www.pluralsight.com/blog/software-development/relational-non-relational-databases" rel="nofollow noreferrer">1</a>, <a href="http://www.jamesserra.com/archive/2015/08/relational-databases-vs-non-relational-databases/" rel="nofollow noreferrer">2</a> and <a href="https://softwareengineering.stackexchange.com/questions/235707/using-a-relational-database-vs-json-objects-for-event-activity-data">3</a> - and there is much more available). You should have in mind that relationship databases (such as MySQL) are used to store relations.</p><ul><li>Is it relations you are trying to store (multiple or complex relations between entities/classes)? If that is the case: tables, relations and joins should be designed. Be aware that performance could be an issue if too many relations and joins are needed.</li><li>Or, if every object is self contained (basically composed by aggregations), there is the possibility of storing it as an object. MySQL has some JSON features that would still allow you <a href="https://www.percona.com/blog/2016/03/07/json-document-fast-lookup-with-mysql-5-7/" rel="nofollow noreferrer">not just to query but to do it fast with indexes</a>.</li><li>Again, you should consider if structuring only part of the data would be interesting.</li></ul></li></ol></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../microservice-architecture-shared-domain-models/'>Microservice architecture shared domain models</a></li><li class="list-group-item"><a href='../message-validation-in-async-messaging-based-services/'>Message validation in async messaging-based services</a></li><li class="list-group-item"><a href='../architecture-email-service-in-microservice-architecture/'>Architecture &#8211; Email service in microservice architecture</a></li><li class="list-group-item"><a href='../design-event-driven-microservice-architecture-dealing-with-synchronous-external-neighboring-systems/'>Design &#8211; Event Driven Microservice Architecture &#038; Dealing with synchronous external neighboring systems</a></li><li class="list-group-item"><a href='../message-broker-in-client-server-applications/'>Message Broker in Client-Server-Applications</a></li><li class="list-group-item"><a href='../common-data-in-microservice-architecture/'>Common data in microservice architecture</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>