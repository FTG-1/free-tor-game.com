<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; Multi-tenant database design &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080203 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080203" class="post-1080203 software type-software status-publish hentry category-software tag-database-design tag-design tag-multitenancy tag-sql-server"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; Multi-tenant database design</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database-design</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">multitenancy</span><span class="mr-2 badge badge-primary">sql server</span></p><div class="entry-content"><p>My boss is currently working on a database design for a multi-tenant capable ERP/CRM system, which will have a Sql Server backend.</p><p>Some key points of the design:</p><ul><li>A server instance will host a &#34;shared&#34; database (unique model), plus one database per company (same model)</li><li>The &#34;shared&#34; database have tables like contacts, users, etc. that will be referred to by other company databases.</li><li>The &#34;shared&#34; database have triggers that will check if its data can safely be deleted (if it&#39;s used by any company, the DELETE operation must fail)</li><li>If, for security concerns, a company must NOT use shareable information, it must be set up on its own server instance, with its own &#34;shared&#34; database that will, in fact, be used only by that company.</li></ul><p>And here&#39;s an implementation example for a system:</p><p>SERVER INSTANCE 1:</p><ul><li>Shared DB</li><li>ACME</li><li>WayneEnterprises</li><li>KwikEMart</li></ul><p>SERVER INSTANCE 2:</p><ul><li>Shared DB</li><li>Umbrella</li></ul><p>My boss stands by this design on the following believed benefits:</p><ul><li>Since there&#39;s one db per company, smaller companies like KwikEMart won&#39;t suffer from the weight of the bigger ones.</li><li>User access can be defined on a &#34;per-company&#34; strategy. This way, Apu can be granted the privilege to read KwikEMart&#39;s <code>Invoices</code> table, but not ACME&#39;s.</li></ul><p>Although I understand these benefits, the integrity tradeoffs seems overwhelming to me.</p><p>First, there&#39;s the obvious integrity cut-off between companies db and the shared db. It&#39;s impossible to make foreign keys across db boundaries.</p><p>Second, what if the Joker messes up with WayneEnterprises database so bad that Batman will have to restore a day-old backup? If ACME, on that very same day, decided to remove a shared Gotham address that was still in use in the older WayneEnterprises db, then every document which used that address won&#39;t be able to display it anymore. Unless of course there&#39;s a shared db backup from the exact same time that can be restored. But EVEN if there was one, it could lead to even more problems for both ACME and KwikEMart.</p><p>And that&#39;s just the two issues that popped right into my mind, there&#39;s probably others as well.</p><p>So my question here would be: are we getting in the right direction with this? And also, how does this kind of system is normally built?</p><p>Any guidance will be much appreciated.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In the multi tennent systems I have worked on as a DBA and Developer we used 1 database per client.  That database was completely self contained and did not rely on any shared database, not even for things like the states in the US.</p><p>To make standing up a new client easy a model database was created that had all the things like States prepopulated.</p><p>The reason we did not store addresses or other common data in a shared database is that it allowed us to move the databases around several different servers to normalize the load accross the servers we had.  If a database needed a higher SLA due to a client upgrade we could just take a backup and restore the client database on the appropriate server and not need to worry if &#34;the address for Stark Industries&#34; existed on the new server.</p><p>The obvious question is what happens when client A updates the phone number or address for a customer?  Should client B see that change?  Wouldn&#39;t that lead to &#34;duplicated&#34; data if every thing is stored in seperate databases?</p><p>What if &#34;Stark Industries&#34; wants your Client A using a different phone number than your Client B?  Then you will have to have a way to show that and store the different numbers in the Client database or move Client A and Client B to different instances.  I am sure as you look through your shared database you will find additional instances of this problem of different clients wanting to use data differently.</p><p>For updates to the common tables a script that loops through each database is rather easy to write, a cursor on sys.databases and some dynamic SQL takes care of that part.</p><p>Overall while having a shared database may look good from a normalization standpoint once you start to look at different ways that clients use the different data, a shared database may not make sense any more.  If you are going to go the route of seperate databases per client, just go full bore and go completely seperate with no shared data.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-multi-tenancy-or-multi-instance/'>Architecture &#8211; Multi tenancy or multi instance</a></li><li class="list-group-item"><a href='../techniques-for-efficiently-partitioning-data-in-a-shared-multi-tenant-database/'>Techniques for efficiently partitioning data in a shared multi-tenant database</a></li><li class="list-group-item"><a href='../architecture-logical-separation-of-database-content/'>Architecture &#8211; Logical separation of database content</a></li><li class="list-group-item"><a href='../multi-tenant-in-a-micro-service/'>Multi tenant in a micro-service</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>