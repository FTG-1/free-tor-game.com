<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>WCF service &#8211; best way to accept requests from a client and do background work &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071632 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071632" class="post-1071632 software type-software status-publish hentry category-software tag-multithreading tag-net tag-wcf"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">WCF service &#8211; best way to accept requests from a client and do background work</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">multithreading</span><span class="mr-2 badge badge-info">net</span><span class="mr-2 badge badge-warning">wcf</span></p><div class="entry-content"><p>For a project at work, I was tasked to create a WCF service that will receive email messages from client and queue them on a database, while at the same time the service will check the DB every 30 minutes or so to check if there are any new email messages queued, and send them automatically with the appropriate credentials.</p><p>To accomplish this, my boss told me to do it with threads: while the main thread is in charge of taking requests from clients, a background thread will be in charge of checking the DB for as long as the service is alive, and send the queued emails. <a href="https://stackoverflow.com/questions/23571440/wcf-service-automatically-call-method-with-worker-thread#comment36173308_23571440">After asking on StackOverflow</a>, however, I was told that for this kind of scenario <em>two</em> services is a better option, a WCF service that takes requests and a different Windows Service that does the background work.</p><p>So my question is, what is the best option for implementing this kind of scenario? And is doing this with just threads possible, but ill-advised? I would like to hear more opinions before checking with my boss about the best way to accomplish this.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h2>If you host your WCF service on IIS:</h2><p>Running long tasks from a web application which uses IIS is a bad idea:</p><ul><li><p>IIS recycles AppDomains at regular intervals; this may not be what you want if you&#39;re in the middle of a long task.</p></li><li><p>IIS recycles AppDomain when files such as web.config are updated.</p></li><li><p>It may negatively impact performance.</p></li></ul><p>So yes, if you need a background task, use a Windows Service instead.</p><p><strong>Sources:</strong></p><ul><li><p><a href="https://stackoverflow.com/a/16254749/240613">ASP.NET long running task. Thread is being aborted exception</a></p><blockquote><p>You can start the long-running process in its own application domain.</p><p>In the past, when I&#39;ve needed this capability, I create a Windows Service for this purpose. [...]</p></blockquote></li><li><p><a href="https://stackoverflow.com/a/302147/240613">What causes an application pool in IIS to recycle?</a></p><blockquote><p>[...] this can be recycled by a number of effects e.g. time - every &#39;n&#39; hours, lack of requests, memory use etc. [...]</p></blockquote></li><li><p><a href="https://stackoverflow.com/a/539000/240613">Can I use threads to carry out long-running jobs on IIS?</a></p><blockquote><p>[...] In addition to reducing resources available to IIS/ASP.NET to process requests, you also have issues with the thread being killed when the AppDomain is recycled, and then you have to deal with persistence of the task while it is in-flight, as well as starting the work back up when the AppDomain comes back up. [...]</p></blockquote></li><li><p><a href="https://stackoverflow.com/a/5553048/240613">How should I perform a long-running task in ASP.NET 4?</a></p><blockquote><p>Preferentially, avoid having long tasks executing in such an environment.</p><p>Delegate long running tasks out to a stable system service [...]</p><p>Windows services are designed to be long running, and if something goes wrong you&#39;ve generally got more to worry about than your individual service.</p></blockquote></li></ul><h2>If you run your WCF service as a Windows Service:</h2><p>Separating Windows Service hosting your WCF application from the Windows Service which does the background processing can have two benefits:</p><ul><li><p>If one of the services crashes, the second one is not affected. This is a minor benefit, since if one of the services crashes, you may have more urgent concerns.</p></li><li><p>You may host each service on a dedicated server. This benefit is also probably minor, unless you&#39;re processing a lot of information.</p></li></ul><p>As for using a single service and two threads, I don&#39;t see any blocking issue as when the service is hosted on IIS.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../wcf-keep-alive-whether-to-disable-keepaliveenabled/'>WCF Keep Alive: Whether to disable keepAliveEnabled</a></li><li class="list-group-item"><a href='../c-net-multithreaded-application-design/'>C#/.NET multithreaded application design</a></li><li class="list-group-item"><a href='../thread-synchronization-for-multiple-threads-accessing-a-message-stream/'>Thread synchronization for multiple threads accessing a message stream</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>