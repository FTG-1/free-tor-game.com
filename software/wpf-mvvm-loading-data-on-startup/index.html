<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>WPF MVVM Loading data on startup &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067951 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067951" class="post-1067951 software type-software status-publish hentry category-software tag-mvvm tag-wpf"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">WPF MVVM Loading data on startup</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">mvvm</span><span class="mr-2 badge badge-info">wpf</span></p><div class="entry-content"><p>I am building a simple master-details GUI using WPF/MVVM/Prism for some data coming from a Restful service.</p><p>I have the main window as my main view with a corresponding view model.</p><p>I have a user control to show the master data and it&#39;s got its own view model as well.</p><p>I have added an instance of the master data view model into the main view model. I am not sure if this is the best practice. Then I&#39;ve set the data context of the main view in the code behind, and of the user control using the XAML of the main view.</p><pre><code>&lt;Window x:Class=&#34;MyNamespace.MainWindow&#34;
        xmlns=&#34;http://schemas.microsoft.com/winfx/2006/xaml/presentation&#34;
        xmlns:x=&#34;http://schemas.microsoft.com/winfx/2006/xaml&#34;
        xmlns:d=&#34;http://schemas.microsoft.com/expression/blend/2008&#34;
        xmlns:mc=&#34;http://schemas.openxmlformats.org/markup-compatibility/2006&#34;
        xmlns:local=&#34;clr-namespace:MyNamespace&#34;
        xmlns:views=&#34;clr-namespace:MyNamespace.Views&#34;
        xmlns:i=&#34;clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity&#34;
        mc:Ignorable=&#34;d&#34;
        Title=&#34;MainWindow&#34; Height=&#34;350&#34; Width=&#34;525&#34;&gt;

    &lt;i:Interaction.Triggers&gt;
        &lt;i:EventTrigger EventName=&#34;Loaded&#34;&gt;
            &lt;i:InvokeCommandAction Command=&#34;{Binding LoginAndLoadMasterDataCommand}&#34; /&gt;
        &lt;/i:EventTrigger&gt;
    &lt;/i:Interaction.Triggers&gt;
    &lt;Grid&gt;
        &lt;views:MasterDataView DataContext=&#34;{Binding MasterData, Mode=OneWay}&#34; /&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;
</code></pre><p>Now I got two commands one to login to the restful and this is in the main view model, and another to load the master data and this is in the child view model. Loading data might take few seconds.</p><p>I want to fire the two commands in sequence, and I&#39;ve tried Prism composite command and also tried to add both commands to be triggered on view load but both way don&#39;t enable me to control the sequence of commands so loading data is attempted before login returns which causes an exception to be thrown.</p><pre><code>internal class MainViewModel : BindableBase
{
    private readonly ApiClient client = new ApiClient();

    public MasterDataViewModel MasterData { get; }

    public ICommand LoginAndLoadMasterDataCommand { get; }

    public  MainViewModel()
    {
        MasterData = new MasterDataViewModel(client);

        CompositeCommand loginCommand = new CompositeCommand(false);
        loginCommand.RegisterCommand(new DelegateCommand(async () =&gt; await client.Login()));
        loginCommand.RegisterCommand(MasterData.LoadDataCommand);

        LoginCommand = loginCommand;
    }
}
</code></pre><p>Notice that the login method and the load data method are both async methods.</p><p><strong>What is a good practice to handle such a situation?</strong></p><p><strong>And also what if I wanted to set the window to a certain state (e.g. greyed out or showing a &#39;wait&#39; modal) until the loading finishes?</strong></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I would create one single DelegateCommand to call Login and LoadData in such manner that I have control over the order they are called:</p><pre><code>LoginAndLoadMasterDataCommand = new DelegateCommand(
    async () =&gt;
    {
        IsLoading = true;

        bool loginSuccesful = await client.Login();
        if (loginSuccesful)
            await MasterData.LoadData();

        IsLoading = false;
    }
</code></pre><p>IsLoading is an observable property that you can bind to some ProgressBar or other control&#39;s Visibility to provide feedback to the user that the application is working.
And MasterData.LoadData is, supposedly, the awaitable method that your MasterData.LoadDataCommand is calling.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../are-value-converters-more-trouble-than-theyre-worth/'>Are value converters more trouble than they&#8217;re worth</a></li><li class="list-group-item"><a href='../c-net-mvvm-software-architecture-and-naming-conventions/'>C# .NET MVVM software architecture and naming conventions</a></li><li class="list-group-item"><a href='../state-handling-in-wpf-mvvm/'>State handling in WPF-MVVM</a></li><li class="list-group-item"><a href='../wpf-usercontrol-reuse-with-mvvm/'>WPF UserControl Reuse With MVVM</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>