<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; How to get a program designed to run continuously (converting data on a Serial COM port) to exit &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080561 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080561" class="post-1080561 software type-software status-publish hentry category-software tag-c tag-multiprocessing tag-multithreading"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; How to get a program designed to run continuously (converting data on a Serial COM port) to exit</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">multiprocessing</span><span class="mr-2 badge badge-warning">multithreading</span></p><div class="entry-content"><h2><strong>Problem Statement</strong></h2><p>I&#39;m writing a C# console program that takes binary data coming in through Serial COM1, converting each byte into ASCII hex, and then outputting those HEX characters out through Serial COM2.</p><p>I would like this program to run in the command shell continuously but also exit gracefully (so that system resources like the COM ports are freed). The catch is that there is no time-out on either inbound/outbound serial data stream (I&#39;d like for the program to run for weeks-months at a time). So how would such a program exit when the user wants it to quit?</p><p>The ability to <strong>connect to</strong> and <strong>disconnect from</strong> a serial communication session is a standard feature of most terminal emulators and I wanted to know how developers implement such a solution.</p><h2><strong>Initial Solutions</strong></h2><ol><li>Have the program read from a text file and recognize commands like<br /> &#34;quit&#34; from it. The user simply creates a text file, writes &#34;quit&#34; and the next time the application gets around to reading the file, it knows to quit! I don&#39;t like this solution because I&#39;ll be chided for creating an archaic UI.</li><li>Have the application read from a third COM port and process the data<br /> stream as commands. It quits when it sees &#34;quit&#34; in the <em>ReadBuffer</em>.</li><li>Create a second program (process) that invokes the above program as<br /> a process. Then, have the second process handle user i/o from<br /> <em>stdin</em> in another console window. When the user enters &#34;quit&#34;, the second process should kill the first process. (I&#39;ve never worked<br /> with multiple processes so I don&#39;t know what function calls or<br /> libraries to look at.</li><li>Make the program multi-threaded. Have a thread of execution for<br /> reading in bytes, another to do the conversion, another to write out<br /> the converted, and another to handle input from <em>stdin</em>.</li></ol><h2>Comments</h2><p>I&#39;m not sure what solution to invest time in. Currently, I&#39;m looking into (4).</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>There&#39;s nothing in your problem statement to suggest that you require <strong><em>explicit</em></strong> multithreading.  What I don&#39;t know about your C# application is if you are writing a Net Core app that is designed to be cross platform or not.  That can limit what options you have.</p><p><strong>Windows Only</strong></p><p>Using the article <a href="https://stackoverflow.com/q/21751545">here</a> you use PInvoke to register for the <code>SetConsoleCtrlHandler(...)</code> Win32 callback.  That callback will let you know if your app received any of the events that would close your typical console app (Ctrl+C, Break, Close the console, logoff, shutdown).  That lets you handle unexpected closing more gracefully.</p><p>You can create a <a href="https://docs.microsoft.com/en-us/dotnet/framework/windows-services/walkthrough-creating-a-windows-service-application-in-the-component-designer" rel="nofollow noreferrer">Windows Service</a> to enable your application to run even if someone is not logged in.  This has the advantage of being able to use the Services control panel to start/stop your app.</p><p><strong>Cross Platform</strong></p><p>If you need to handle Linux/Mac as well as Windows, then using PInvoke is pointless since that is platform specific.  However you can adopt a hybrid approach inspired by the Apache Tomcat developers.</p><p>They created a control interface on a separate TCP port that would allow an external tool to send a control message like shut down, restart, etc.  For Windows, they had a Windows service that would handle starting the console app (Tomcat is a Java based web server you can run from your console) and sending the appropriate control messages when it was time to shut down.  For Linux/Mac, they just had a script that did essentially the same thing that tied in to the daemon/service system.</p><p><strong>Personal Experience</strong></p><p>I created a separate console data processing app that was controlled a Windows service.  This particular data processing app was used to monitor sensors and perform some fancy calculus so we could pinpoint problems.  The data processing app sent the results to a semi-real time monitoring UI.  The app had to work without stop for as long as the machine did.  By creating a Windows Service that simply was there to control the data processing app, we could easily spin up a new instance if the old instance died for an unexpected reason.  We could also monitor the app&#39;s memory usage and other health criteria.</p><p>One of the things we did in the console app was to make sure that there were no leftover resources being consumed by an instance that didn&#39;t shut down cleanly.  It never happened in real life, but the importance of this process made us design for that case.</p><p><strong>Control Protocol</strong></p><p>You can use a simple control protocol based on UDP.  C#&#39;s socket API has asynchronous read/write which is why you don&#39;t need explicit multithreading.  A lot of that is handled for you.</p><p>You just have to decide on the message format.  If you use a control program, you can keep a reference to the running Process to monitor it&#39;s health and determine if it is running.  Useful commands:</p><ul><li>Hang Up -- you can shut down now</li><li>Reset -- go back to start up conditions (i.e. close your ports and reopen them)</li><li>Heartbeat -- if you need to manage a process remotely</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-design-pattern-for-an-automated-mechanical-test-bench/'>C# &#8211; Design pattern for an automated mechanical test bench</a></li><li class="list-group-item"><a href='../c-design-for-sql-connection-and-commands/'>C# Design for SQL connection and commands</a></li><li class="list-group-item"><a href='../c-passing-a-serial-port-instance/'>C# &#8211; Passing a Serial Port Instance</a></li><li class="list-group-item"><a href='../python-not-understanding-the-concept-of-how-to-make-the-gui-application/'>Python &#8211; Not understanding the concept of how to make the GUI application</a></li><li class="list-group-item"><a href='../c-inter-process-communication-in-net-on-the-same-computer/'>C# &#8211; Inter-Process Communication in .NET on the same computer</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>