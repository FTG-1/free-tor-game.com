<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; Integration Testing: Testing Service to Service &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071932 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071932" class="post-1071932 software type-software status-publish hentry category-software tag-integration-tests tag-rest tag-unit-testing tag-web-services"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; Integration Testing: Testing Service to Service</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">integration-tests</span><span class="mr-2 badge badge-info">rest</span><span class="mr-2 badge badge-warning">unit testing</span><span class="mr-2 badge badge-primary">web services</span></p><div class="entry-content"><p>I&#39;m looking for some advice on testing strategies for service to service communication.</p><p>I have one service (service A) that makes a call to another service (B) &#8211; which is a rest API. Both services are owned by me.</p><p>I have some unit tests around the service calls and I simply mock the HTTP library so no requests are actually sent to the service. That works well for unit testing but I was wondering if it is worthwhile to add some integration tests that actual test the service calls and responses.</p><p>The problem I see is service B updates a database so any integration tests in service A will have to reset any changes they make by calling the DB directly. To me this doesn&#39;t seem ideal as now service A knows more about the implementation of service B than it should.</p><p>Are these tests valuable? When I&#39;ve seen these kind of tests before they are often brittle and rely on development environments being in a good state. If this was a third party API for example I wouldn&#39;t have tests which call it directly.</p><p>I can think of two options:</p><ol><li><p>Write the integration tests in service A and have these tests call service B&#39;s database to reset/inset data as needed.</p></li><li><p>Stick with mocks and don&#39;t add integration tests to service A. Instead add some functional tests to service B which test the various rest endpoints.</p></li></ol><p>Any advice or thoughts?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>To my experience, our <em>tests</em> should not be bound to dependencies which execution are out of our control.</p><p>First of all, let&#39;s narrow down the scope of the tests. As stated by question, the service under test is <em>A</em>, so let&#39;s focus on testing <em>A</em> first.</p><p>One important thing to achieve with tests is determinism. It should be possible to execute all our tests in any order, time and/or environment. Ideally these tests will reproduce real uses-cases on ideal conditions.</p><p>For us to achive determinism, we need to remove any source of undeterminism, as for example integrations with services (of any sort) that we can not control. Or services we can not bring them up to the precise state we need for each of our tests.</p><p>Some will argue that this is not an integration test because we are removing the integration. To me, the key is testing our code isolated from external inferences. By the due technique I will reproduce diferent integration behaviours like latency, timeouts, down times, etc...
I have found important to remove dependencies that slow down the testing time, overall if we do CI/CD. By isolating my tests from this dependencies I can set different  stagings in my testing so I can prioritize the faster ones and schedule the slowers.</p><blockquote><p>The problem I see is service B updates a database so any integration
tests in service A will have to reset any changes they make by calling
the DB directly.</p></blockquote><p><em>B</em> writing in DB is almost anecdotic. The problem is testing a real <em>service B</em> because we are -indirectly- testing <em>B</em> code and the environment where <em>B</em> is running at!</p><p>The real danger is on the unknown conditions under which <em>B</em> is living at the moment of testing. These conditions, in the worst of the cases, could make our test to fail. If they fail, they do it due to issues unrelated to our code. These fails don&#39;t give us meaningful feedback about the state of the code being tested and slow us down.</p><p>As commented, writing in DB is anecdotic, there are many more things that could go wrong.</p><ul><li>Service B has no test environment.</li><li>Service B has a test environment but has been deployed a new version which includes breaking changes.</li><li>Service B is buggy.</li><li>Service B data storage is unavailable.</li><li>Service B is unavailable</li><li>Service B responds with corrupt data.</li><li>Service B is under test, and the data is changing over time.</li></ul><p>You should be wondering <em>why non-deterministic tests are dangerous?</em> I suggest reading Fowler&#39;s blog about <a href="https://martinfowler.com/articles/nonDeterminism.html" rel="nofollow noreferrer">Erradicating non-determinism in tests</a> and check out the following <a href="https://softwareengineering.stackexchange.com/a/221636/222996">question</a> too. Doc&#39;s answer summarises the subject very well.</p><p>Examples of non-deterministic tests are <em>Flaky tests</em>. Flaky tests are tests that fail due to undetermined circumstances. These tests fail now and then and we don&#39;t know why. We can not reproduce the issue.</p><blockquote><p>A test suite with flaky tests can become a victim of what Diana Vaughan calls <em>normalization of deviance</em> - the idea that over time we can become so accustomed to things being wrong that we start to accept them as being normal and not a problem.</p><p><em>-Building Microservices- by Sam Newman</em></p></blockquote><p>The <em>normalization of deviance</em> is the seed of the evil.</p><blockquote><p>Any advice or thoughts?</p></blockquote><p>When testing integrations, neither the data nor the behaviour of the external service should worry you. At least not yet. <sup>1</sup></p><p>What should worry you is to test the correct consumption of interface (API) and the proper handling of the feedback (error handling, deserialization, mappings, etc). In other words, <strong>the contract</strong>.</p><p>Lately, I have started to work with the concept of <a href="https://martinfowler.com/bliki/TestDouble.html" rel="nofollow noreferrer">Test Doubles</a> and <a href="http://martinfowler.com/articles/consumerDrivenContracts.html" rel="nofollow noreferrer">Consumer Driven Contracts tests</a> with very positive results.</p><p>It&#39;s true that they require additional efforts addressed to build and maintain these tests. That&#39;s our case. However, we have reduced the building, the testing and the deployment time significantly and we get faster and more meaningful feedback from CI.</p><p>In line with the above writing and @Justin&#39;s answer, you might be interested in tools like <a href="http://www.mbtest.org/docs/gettingStarted" rel="nofollow noreferrer">Mountebank</a>.</p><hr/><p><sup>1: There are a place for tests addressed to validate the real behaviour of external services. They can be placed out of the building pipeline. They might or might not be essential for a green deployment. That depends on whether you can or not circumvent the issues raised by the service. It&#39;s almost a political question rather than technical.</sup></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-am-i-unit-testing-or-integration-testing-the-stored-procedures/'>Database &#8211; Am I Unit Testing or Integration Testing the Stored Procedures</a></li><li class="list-group-item"><a href='../database-unit-integration-testing-the-dal/'>Database &#8211; Unit/Integration Testing the DAL</a></li><li class="list-group-item"><a href='../php-unit-integration-testing-web-service-proxy-client/'>Php &#8211; unit/integration testing web service proxy client</a></li><li class="list-group-item"><a href='../unit-testing-testing-front-end-app-that-hits-a-rest-service/'>Unit-testing &#8211; Testing front-end app that hits a REST service</a></li><li class="list-group-item"><a href='../unit-testing-are-integration-tests-meant-to-be-redundant/'>Unit-testing &#8211; Are Integration Tests Meant to be Redundant</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>