<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; RESTful api and nested resources &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075083 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075083" class="post-1075083 software type-software status-publish hentry category-software tag-api tag-api-design tag-laravel tag-php tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; RESTful api and nested resources</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api</span><span class="mr-2 badge badge-info">api-design</span><span class="mr-2 badge badge-warning">laravel</span><span class="mr-2 badge badge-primary">PHP</span><span class="mr-2 badge badge-danger">rest</span></p><div class="entry-content"><p>Having built a RESTful API (using Laravel) for a project at work, I followed what seemed (from lots of reading) to be a the majority in terms of my approach to nested resources &#8211; by defining them in the path:</p><pre><code>https://myapi.com/clients/{clientId}/tasks
</code></pre><p>rather than:</p><pre><code>https://myapi.com/tasks?client={clientId}
</code></pre><p>Filtering results further than this, plus ordering etc was done using query parameters:</p><pre><code>https://myapi.com/clients/{clientId}/tasks?orderby=title
</code></pre><p>Whilst initially this seemed like a good approach, it did become more difficult to maintain in terms of the controllers and routes. For example, for the above, I created a ClientsController, a TasksController AND a ClientsTasksController.</p><p><strong>TasksController</strong></p><pre><code>public function store() {}
public function updated() {}
public function destroy() {}
</code></pre><p><strong>TasksClientsController</strong></p><pre><code>public function index($client_id) {}
</code></pre><p>And the <strong>routes</strong>:</p><pre><code>Route::resource(&#39;tasks&#39;, &#39;TasksController&#39;, [&#39;except&#39; =&gt; [
    &#39;edit&#39;, &#39;index&#39;
]]);
Route::resource(&#39;clients.tasks&#39;, &#39;ClientsTasksController&#39;, [&#39;only&#39; =&gt; [
    &#39;index&#39;
]]);
</code></pre><p>This application did not need many more nested resources such as this, it was relatively straightforward. However, I am now looking to create an API for existing application which has many more complex relationships. It is a league management app, EER diagram below:</p><p><a href="../../../i.stack.imgur.com/pToMx.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/pToMx.png" alt="enter image description here"/></a></p><p>Where I&#39;m concerned is that I am going to need to query resources by a lot of different data &#8211; for example:</p><ol><li><strong>teams by a specific division, season and round</strong></li><li><strong>statistics by both team id and season id, and possibly round id also</strong></li><li><strong>matches by season, round and division</strong></li></ol><p>and combinations of the above.</p><p>It therefore seems to me to make more sense to have a controller and route for each final resource, but to use query parameters rather than path variables.</p><p>For example:</p><pre><code>https://myapi.com/matches?team_id={teamId}&amp;season_id={seasonId}&amp;roundId={roundId}
</code></pre><p>rather than:</p><pre><code>https://myapi.com/seasons/{seasonId}/teams/{teamId}/matches
</code></pre><p>and the various extra controllers this would create.</p><p>However I feel this may be going against the grain in terms of what most people seem to suggest &#8211; see <a href="https://stackoverflow.com/questions/4024271/rest-api-best-practices-where-to-put-parameters">here</a> for example. The second URL also seems neater to me.</p><p>Any help / recommendations would be very much appreciated.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>If you are designing L3 maturity API (HATEOAS) [1], clients do not build or remember URLs. The best approach in this case is to have multiple mappings to support both scenarios: fetching by navigation and query by population of URI template parameters (RFC 6570 [2]).</p><p>When fetching by navigation to provided link, the choice of path structure should be based on either the relationship between entities is aggregation or composition, i.e. whether one entity owns another or just refers it. For example, a player is top level entity, because life cycle of a player is not within bounds of life cycle of a team. Players may change teams, so it&#39;s natural to have following set of routes:</p><ul><li><code>rel=players</code> references list of players at <code>/players</code></li><li><code>rel=self</code> for player is <code>players/{playerId}</code></li><li><code>rel=teams</code> references list of teams at <code>/teams</code></li><li><code>rel=self</code> for team is <code>teams/{teamId}</code></li><li><code>rel=seasons</code> references list of seasons at <code>/seasons</code></li><li><code>rel=self</code> for season is <code>/seasons/{seasonId}</code></li></ul><p>All collection endpoints may accept query parameters to paginate and filter the response.</p><h3>Aggregation examples</h3><p>It&#39;s possible to know all teams of the player and vice versa,
but the collection links include URI template parameters only if these parameter values are discoverable by client on prior navigations.</p><p>For example, every client starts with root of the API to fetch list of resources. At this moment, he discovers <code>rel=teams</code>, but the link cannot have query parameter to filter by players, because client does not yet know what are the player id values to substitute. The link may look at this moment only as following: <code>/teams{?team_name}</code> Same with the link <code>rel=players</code> at this moment: it may contain only filters by player name, but not by the team. It may look like following: <code>/players{?first_name}</code>.</p><p>However, when we navigate to <code>/teams</code>, we discover the link <code>rel=players</code> in <code>/teams</code>, that now contains <code>team_id</code> parameter, because its possible values are already discovered by client. It may look like following: <code>/players{?team_id,first_name,last_name}</code>.</p><p>As an alternative, we can use following routes discovered in responses of <code>rel=self</code> requests for players and teams:</p><ul><li><code>rel=player_teams</code> may list all teams for which player had ever performed: <code>/players/{playerId}/teams</code>. Each team has <code>rel=self</code> as defined above.</li><li><code>rel=team_players</code> within team resource references list of team players via <code>/teams/{teamId}/players</code>. Each player has <code>rel=self</code> as defined above.</li></ul><h3>Composition example</h3><p>If a division is defined for each season separately, then it has the same lifecycle and there&#39;s composition relationship. Same is for matches within a season.
This means, it&#39;s natural to build the path to match as following:</p><p><code>/seasons/{seasonId}/matches/{matchId}</code></p><p>And navigate to matches within a division via following route:</p><p><code>/seasons/{seasonId}/divisions/{divisionId}/matches</code></p><p>or by search:</p><p><code>/seasons/{seasonId}/matches?division_id={divisionId}</code></p><p>The last two can be handled by the same controller if your REST API technology supports multiple mappings. All subpaths in this examples are also valid requests and shall return the respective information. Moreover, this example may be extended with additional aggregate routes like:</p><ul><li><code>/seasons/{seasonId}/divisions/{divisionId}/teams</code> - list of teams in division, in which every team resource has <code>rel=self</code> link as defined above.</li><li><code>/seasons/{seasonId}/statistics/players</code> - list of player stats in season</li></ul><h3>References</h3><ol><li><a href="https://martinfowler.com/articles/richardsonMaturityModel.html" rel="nofollow noreferrer">https://martinfowler.com/articles/richardsonMaturityModel.html</a></li><li><a href="https://www.rfc-editor.org/rfc/rfc6570" rel="nofollow noreferrer">https://www.rfc-editor.org/rfc/rfc6570</a></li></ol></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-when-to-use-nested-resources-in-a-restful-api/'>Rest &#8211; When to use nested resources in a RESTful API</a></li><li class="list-group-item"><a href='../rest-api-nested-routes-without-providing-identifiers-at-every-nested-level/'>REST API, nested routes without providing identifiers at every nested level</a></li><li class="list-group-item"><a href='../rest-mvc-and-restful-api-service/'>Rest &#8211; MVC and RESTful API service</a></li><li class="list-group-item"><a href='../restful-nested-resources/'>RESTful nested resources</a></li><li class="list-group-item"><a href='../restful-api-relationships/'>RESTful API Relationships</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>