<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Access multiple entities in repository &#8211; clean architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070014 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070014" class="post-1070014 software type-software status-publish hentry category-software tag-android tag-clean-code tag-domain-driven-design tag-repository-pattern"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Access multiple entities in repository &#8211; clean architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">android</span><span class="mr-2 badge badge-info">clean code</span><span class="mr-2 badge badge-warning">domain-driven-design</span><span class="mr-2 badge badge-primary">repository-pattern</span></p><div class="entry-content"><p>I have a API call that returns a list of <code>Payments</code>, each <code>Payment</code> contains a <code>User</code>. I need to call it, save the results in the database, fetch all the payments and users and return them all to the presenter. On the UI each payment row will also contain info about the user. So the <code>Payment</code> and <code>User</code> entities are highly coupled in my case.</p><p>My idea was creating <code>PaymentRepository</code> and <code>GetPaymentsUseCase</code>. The repository in this case has access to both <code>Payment</code> and <code>User</code> tables, so it can query them both and insert into both. However (correct me if I&#39;m wrong) the clean architecture principles state that every repository should be responsible for one entity.</p><p>But in my case it really makes no sense to separate this call between 2 repos. If I decide to do so, the <code>PaymentRepository</code> and <code>UserRepository</code> should not access each other, so the use case would have to call both of them and pass data between them after mapping it back and forth, which looks terrible in my opinion.</p><p>Is my solution acceptable or does it break the clean architecture principles? If so, are there any suggestions on how to implement this?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your repository doesn&#39;t break the  &#34;<a href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html" rel="noreferrer">clean architecture</a>&#34;, which identifies entities as the core, requires dependency inversion, but doesn&#39;t impose to use repositories.</p><p>But your repository seems to break the clean code principles, and in particular:</p><ul><li>the <a href="https://8thlight.com/blog/uncle-bob/2014/05/08/SingleReponsibilityPrinciple.html" rel="noreferrer">single responsibility principle</a>: you pack together things that have different reasons to change: <code>Payment</code> (which could change for example because of new commercial practices or new banking standards) and <code>User</code> (subject to internal policy, GDPR concerns, or identity provider requirements);</li><li>the <a href="https://www.tomdalling.com/blog/software-design/solid-class-design-the-interface-segregation-principle/" rel="noreferrer">interface segregation principle</a>: you force the clients of your repository to know <code>Payment</code>&#39;s and <code>User</code>&#39;s interface, even if they do not need them (e.g. if a later use case would produce a report on the total of payments per day the last month).</li></ul><p>Your approach seems not either in line with <a href="https://en.wikipedia.org/wiki/Domain-driven_design" rel="noreferrer">Domain Driven Design</a> principles, which suggest a repository for a single Aggregate :</p><ul><li><p>In DDD you identify <em>Entities</em>, and group them into independent <em>Aggregates</em> that are objects that have to always be accessed via a single <em>Aggregate Root</em>.</p></li><li><p>But in your case, you have two independent Entities that each constitutes its own Aggregate:</p><ul><li>It is not possible to see <code>Payment</code> as an aggregate containing a dependent <code>User</code>,  since the latter may exist prior to having made any payment.</li><li>It is not either possible to consider <code>User</code> as an aggregate with dependent <code>Payments</code>, because this would mean that you could identify a payment only in relation to a user, which is not a realistic case for payment systems.</li></ul></li></ul><p><strong>Edit: additional infos</strong></p><p>The repository concept intends to provide a level of abstraction that lets  you handle persistent objects as if they were in a collection in memory, and without carrying about the db.</p><p>With this architectural pattern, you&#39;d rather reference other aggregates <a href="http://www.informit.com/articles/article.aspx?p=2020371&amp;seqNum=4" rel="noreferrer">by identity (value)</a>. The typical scenario is to get <code>Payments</code> by querying the <code>PaymentRepository</code>.  Then the payment&#39;s <code>UserId</code> would be used to get the user with <code>UserRepostitory.getById()</code>.  Or alternatively you&#39;d just use the <code>PaymentId</code> to query a user of a payment with by invoking <code>UserRepostitory.getByPaymentId()</code>.</p><p>The advantage of the identity is that it allows to decouple Entities in very complex models: passing all possible kind of objects to a repository (instead of a simple id) would cause an explosion of interface dependencies.  Similarly, if related objects would systematically be loaded by the repository (as you think to expect), then you could have a snowball effect: Imagine you&#39;d have entities representing nodes and edges of a graph.  Whatever node you&#39;d get from the repository, you&#39;d end-up with the full graph in memory!</p><p>This being said, I don&#39;t know your model nor your constraints and I do not judge. It&#39;s up to you to decide what&#39;s the most suitable architecture. You may perfectly deviate from the rules if you have valid arguments and understand the consequences. By the way, <a href="https://softwareengineering.stackexchange.com/q/47488/209774">this question</a> about repository performance may interest you.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-clean-architecture-too-many-use-case-classes/'>Java &#8211; Clean Architecture &#8211; Too many Use Case Classes</a></li><li class="list-group-item"><a href='../architecture-uncle-bobs-clean-architecture-composed-entities/'>Architecture &#8211; Uncle Bob&#8217;s clean architecture &#8211; Composed entities</a></li><li class="list-group-item"><a href='../java-clean-architecture-apps-that-rely-heavily-on-background-services/'>Java &#8211; Clean Architecture: Apps that rely heavily on background services</a></li><li class="list-group-item"><a href='../c-data-entities-domain-entities-and-the-repositories/'>C# &#8211; Data Entities, Domain entities and the repositories</a></li><li class="list-group-item"><a href='../clean-architecture-google-facebook-login-and-data-layer/'>Clean Architecture : Google/Facebook Login and data layer</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>