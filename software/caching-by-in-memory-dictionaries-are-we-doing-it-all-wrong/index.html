<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Caching by in-memory dictionaries. Are we doing it all wrong &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073937 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073937" class="post-1073937 software type-software status-publish hentry category-software tag-caching"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Caching by in-memory dictionaries. Are we doing it all wrong</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">caching</span></p><div class="entry-content"><p>This approach is pretty much the accepted way to do anything in our company.</p><p>A simple example</p><ul><li>When a piece of data for a customer is requested from a service, we fetch all the data for that customer(relevant part to the service) and save it in a in-memory dictionary then serve it from there on following requests(we run singleton services).</li><li>Any update goes to DB, then updates the in memory dictionary.</li></ul><p>It seems all simple and harmless but as we implement more complicated business rules the cache gets out of sync and we have to deal with hard to find bugs.</p><p>Sometimes we defer writing to database, keeping new data in cache until then. There are cases when we store millions of rows in memory because the table has many relations to other tables and we need to show aggregate data quickly.</p><p>All this cache handling is a big part of our codebase and I sense this is not the right way to do it. All of this juggling adds too much noise to the code and it makes it hard to understand the actual business logic. However I don&#39;t think we can serve data in a reasonable amount of time if we have to hit the database every time.</p><p>I am unhappy about the current situation but I don&#39;t have a better alternative.</p><ul><li>My only solution would be to use NHibernate 2nd level cache but I have nearly no experience with it.</li><li>I know many companies use Redis or MemCached heavily to gain performance but I have no idea how I would integrate them into our system.</li><li>I also don&#39;t know if they can perform better than in-memory data structures and queries.</li></ul><p>Are there any alternative approaches that I should look into?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>First you last question:  Why Redis/memcached?</p><p>No, they&#39;re not (usually) faster than simple in-process dictionaries.  The advantage comes when you have several worker processes, or even many app-layer machines.  In that case, instead of each process having its own small cache, they all share a single big (distributed) cache.  With bigger caches, you get better hit ratios.</p><p>As you can see, the cache layer becomes a shared resource, much like the database, but (hopefully) faster.</p><p>Now, about the big part: how to avoid the mess?</p><p>It seems that your problem is keeping cache consistent while at the same time decoupling it from the database.  I see three pain points there:</p><ol><li><p>cache invalidation.  This is just hard.  Sometimes the easiest solution is to add a generation ID to every record and use it as part of the cache key.  When the data is updated, you get a new generation ID, and the next cache query won&#39;t hit so you go to the database and refresh the cache.  Of course, the (now unused) entry must have a sensible expiry time so it gets eventually purged from cache.</p></li><li><p>writeback. You say you work on the cache and update the database later.  This is dangerous; most architectures avoid that idea.  A step on the right direction would be to mark every new or modified entry in the cache as &#39;dirty&#39; so can be flushed to database by a decoupled process.  A better idea might be to add to a message queue as soon as it&#39;s modified, effectively making the writing to the database &#39;inline but async&#39;.  In the end, I think you should realize that this is not a valid use for a cache, this is a &#34;staging area&#34; that should be treated with a different architecture than a cache layer.</p></li><li><p>interprocess synchronization: since your in-process cache is private to each process, any modification there isn&#39;t propagated to other processes until they&#39;re flushed to database.  This might be correct under your app design (kind of poor man&#39;s transaction isolation), but might have unintended results.  A much more manageable architecture is a cache layer that is just a faster API to the database, with the same shared properties as the database, and just as &#39;authoritative&#39; as it.  For that you need out-of-process caches, like memcached or Redis.</p></li></ol></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-using-memcached-is-it-good-practice-to-update-the-cache-when-updating-the-database/'>Architecture &#8211; Using Memcached: is it good practice to update the cache when updating the database</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>