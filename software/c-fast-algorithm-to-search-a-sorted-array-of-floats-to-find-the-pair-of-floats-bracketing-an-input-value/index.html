<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Fast algorithm to search a sorted array of floats to find the pair of floats bracketing an input value &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1065972 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1065972" class="post-1065972 software type-software status-publish hentry category-software tag-algorithms tag-c"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Fast algorithm to search a sorted array of floats to find the pair of floats bracketing an input value</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">algorithms</span><span class="mr-2 badge badge-info">c</span></p><div class="entry-content"><p>I have an array of floats, sorted from smallest to largest, and need to be able to pick out the nearest float greater than or less than a passed input value.  This input value is not necessarily present as a value in the array.</p><p>A naive approach would be to do a simple linear search through the array.  That might look like this:</p><pre><code>void FindClosestFloatsInArray( float input, std::vector&lt;float&gt; array, 
                               float *min_out, float *max_out )
{
    assert( input &gt;= array[0] &amp;&amp; input &lt; array[ array.size()-1 ] );
    for( int i = 1; i &lt; array.size(); i++ )
    {
        if ( array[i] &gt;= input )
        {
            *min = array[i-1];
            *max = array[i];
        }
    }
}
</code></pre><p>But obviously as the array gets larger, this will become slower and slower.</p><p>Does anyone have an idea about an algorithm that would let me find this data more optimally?  I&#39;ve already switched to a binary search, which has improved matters somewhat, but it&#39;s still a lot slower than I&#39;d like, and since I&#39;m not actually looking for a specific value that exists in the array, it can never terminate early.</p><p>More information:  The floating point values in the array are not necessarily distributed evenly (that is, the array could consist of the values &#34;1.f, 2.f, 3.f, 4.f, 100.f, 1200.f, 1203.f, 1400.f&#34;.</p><p>I&#39;m doing this operation hundreds of thousands of times, but I can do any amount of pre-processing on the array of floats, if it&#39;ll improve the lookup time.  I absolutely can change to use something other than a vector to store them, if that&#39;ll help.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The code in the question (a linear search), as you rightly point out, is going to get slow for large float arrays. Technically it&#39;s O(n) where n is the number of float values in your array.</p><p>In general, the best that you can do to find a value in an ordered array is a recursive tree search  of some kind (e.g. binary search), in which case you can achieve an O(log n) lookup time in the number of elements in your array. O(log n) is <em>much</em> better than O(n) for large values of n.</p><p>My suggested approach would therefore be a <strong>simple binary search of the array</strong>, i.e.:</p><ol><li>Set min/max integer indexes to cover your whole float array</li><li>test the value in the middle of the range at index mid=(min+max/2) against the search value x</li><li>if x is lower than this value, set max to mid, else set min to mid</li><li>repeat (2-4) until you have found the correct value</li></ol><p>This is an O(log n) algorithm which should be fast enough for nearly all situations. Intuitively, it works by halving the range to be searched at each step until you find the correct value.</p><p>It&#39;s really hard to beast the simple binary search, so if you have already implemented this correctly then you may be pretty close to optimal already. However, if you know the distributions of the data and/or have a limited range of lookup values (x), there are still some other more advanced tricks you can try:</p><ul><li><strong>Bucketing</strong> - create buckets (e.g. for each interval between two integers), each of which contains a smaller sorted list of the float values between the two bounding integers plus two values immediately below and immediately above each range. You can then start your search at (trunc(x)+0.5). This should give you a good speedup if you choose appropriately sized buckets (it&#39;s effectively increasing the branching factor of the tree.....). If integers don&#39;t work for you, then you can try buckets of some other fixed-point precision (e.g. multiples of 1/16).</li><li><strong>Bit-mapping</strong> - if the range of possible lookup values is small enough, you could try creating a big lookup table indexed by the bitwise value of x. This will be O(1) but you may need a lot of memory which will be very unfriendly on your cache... so use with caution. This is especially nasty because you are looking up float values, so you may well need several GBs to account for all of the less significant bits......</li><li><strong>Rounding and hashing</strong> - hash tables are probably not the best data structure for this problem, but if you can survive losing a bit of accuracy they could work - simply round off the lowest bits of your lookup values and use a hashmap to directly look up the correct value. You will have to experiment on the right trade-off between hashmap size and precision, and also ensure that all possible hash values are populated so this can be a bit tricky......</li><li><strong>Tree-balancing</strong> - your ideal tree should have a 50% chance of going left or right. So if you create a tree based on the distribution of lookup values (x), then you can optimise the tree to produce answers with the minimal amount of tests. This is likely to be a good solution if a lot of values in your float array are very close together, since it will enable you to avoid searching these branches too often.</li><li><a href="http://cr.yp.to/critbit."><strong>Crit-bit trees</strong></a> - these are still trees (so still O(log n)...) but some cases: you would however need to convert your floats into some fixed-point format in order to make the comparisons work</li></ul><p>However, unless you are in a very special situation I&#39;d probably recommend sticking with the simple binary search. Reasons:</p><ul><li>it&#39;s much easier to implement</li><li>it&#39;s very fast for most common cases</li><li>the extra overhead of the more complex approaches (e.g. higher memory usage / cache pressure) often outweighs the minor theoretical gains</li><li>it will be more robust to future changes in the data distributions....</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-reading-a-specific-type-of-input-from-file/'>C++ &#8211; Reading a specific type of input from file</a></li><li class="list-group-item"><a href='../sorting-an-array-of-numbers-with-decimal-places/'>Sorting an array of numbers with decimal places</a></li><li class="list-group-item"><a href='../algorithm-for-fast-tag-search/'>Algorithm for fast tag search</a></li><li class="list-group-item"><a href='../c-c-c-which-conversion-warnings-make-sense-in-practice/'>C++ &#8211; C/C++: Which conversion warnings make sense in practice</a></li><li class="list-group-item"><a href='../c-how-to-store-various-sized-values-in-a-vector/'>C++ &#8211; How to store various sized values in a vector</a></li><li class="list-group-item"><a href='../how-to-efficiently-search-a-set-of-vectors-for-a-vector-which-is-the-closest-match/'>How to efficiently search a set of vectors for a vector which is the closest match</a></li><li class="list-group-item"><a href='../find-k-max-integers-of-an-array-min-heap-vs-selection-algo-vs-selection-sort/'>Find k max integers of an array &#8212; Min Heap vs. Selection Algo vs. Selection Sort</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>