<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to get ORM (Ef Core) Entities follow a DDD style . Which is the best approach &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087635 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087635" class="post-1087635 software type-software status-publish hentry category-software tag-entity-framework tag-repository-pattern tag-unit-of-work"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to get ORM (Ef Core) Entities follow a DDD style . Which is the best approach</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">entity-framework</span><span class="mr-2 badge badge-info">repository-pattern</span><span class="mr-2 badge badge-warning">unit-of-work</span></p><div class="entry-content"><p>I am considering mutliple options to face a problem.<br /> I want to develop software following DDD style.<br /> The problem arise when I have to define my entities and I am working with Entity Framework Core, any other ORM would have the same problems.</p><p>ORM generates plain POCOs entities that represents the Tables in our DB. That don&#39;t fits DDD style.</p><p>Ways to accomplish a DDD style entities:</p><p><strong>A) Implement Repository/Unit of Work patterns  + Mapping</strong>: Use some kind of mapping process inside the repositories implementations, between the Ef entities and the Domain entities we work with. We got a set of repositories that makes a facade to EF Core, and all the EF implementation details remains decopupled.</p><p><strong><em>Pros</em></strong></p><ul><li>Decopuling achieved</li><li>Centralized mapping configuration</li><li>Repositories return DDD style entities, easy to aggregate and follow DDD rules.</li></ul><p><strong><em>Cons</em></strong></p><ul><li>Loose of some EF features , autotracking =&gt; Less efficient</li><li>The possibility to launch Expression&gt; queries=&gt; Over-verbose methods in the repos to fit all needs.</li><li>Our implementation of UoW will be poor compared to Ef/ORM ones</li></ul><p><strong>B) Turn EF Core Entities into DDD style.</strong>: ORM usually allow us to define our classes before and then map them to a database with some configuration. Following this path you could get , business logic inside entities and DDD related practices( private setters/ aggregation) .See answer of @Flater for more detail.</p><p><strong><em>Pros</em></strong></p><ul><li>All the features implemented  by specific ORM(EF Core) =&gt; efificency, auto tracking , etc</li><li>We don&#39;t have to implement an &#34;overdesign&#34; of Repository/UoW patterns</li></ul><p><strong><em>Cons</em></strong></p><ul><li>We lose decoupling between layers, because we introduce dependency on the DbContext which is a specific tech related.</li></ul><p>Do you know other approaches?<br /> Which pros and cons have them?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You mention &#34;EF auto generated classes&#34;, which suggest you&#39;re using a DB-first approach. But you mentioned in the comments that you&#39;re open to anything, so I want to suggest switching to a Code First approach.</p><p>Robert Harvey&#39;s answer isn&#39;t wrong, I simply want to offer another viable solution to the problem.</p><p><em>Note: I don&#39;t know much about EF Core specifically, my answer uses EF but I assume that there aren&#39;t too many differences between the two.</em></p><hr/><p>EF has two approaches:</p><ul><li><strong>Database First</strong> - EF generates C# based on an existing database</li><li><strong>Code First</strong> - EF generates a databased based on existing C# classes.</li></ul><p>So the idea is simple: create your classes, and then tell EF that you want it to create the database accordingly. This gives you direct control over your classes and where you store them.</p><p><strong>A basic example</strong></p><pre><code>public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
}

public class MyContext : DbContext
{
    public MyContext() : base(&#34;MyConnectionStringName&#34;)
    { 

    }

    public DbSet&lt;User&gt; Users { get; set; }
}
</code></pre><p>This is enough information for EF to generate a database for you. It will generate a table for every <code>DbSet&lt;T&gt;</code> you specify, and it will generate that table&#39;s columns based on the class definition of <code>T</code>.<br/> EF will make some assumptions (e.g. that a property named <code>Id</code> is intended to be the PK of your table). You can change these default behaviors; more on that further in the answer.</p><p>There is a lot more information on this subject than I can provide in the answer. Plenty of tutorials and guides exist online (<a href="https://www.c-sharpcorner.com/article/code-first-approach-in-asp-net-core-mvc-with-ef-core-migration/" rel="nofollow noreferrer">example</a>), I suggest you look into these to learn about the more detailed configuration options that EF puts at your disposal.</p><hr/><p>However, there is one thing I still want to point out. When you want to adjust your db columns, e.g. putting a max length on a certain string property, there are two ways of doing so.</p><p>Firstly, and most commonly found online, you can use <strong>attributes</strong> on your class:</p><pre><code>public class User
{
    public int Id { get; set; }

    [MaxLength(50)]
    public string Name { get; set; }
}
</code></pre><p>These attributes are mostly provided by EF. Some others (e.g. <code>[NotMapped]</code>) are not provided by EF but EF does observe and respond to them (in the case of <code>[NotMapped]</code>, the property will not generate a table column).</p><p>As you may suspect, <a href="http://www.entityframeworktutorial.net/code-first/dataannotation-in-code-first.aspx" rel="nofollow noreferrer">many attributes are available</a>.</p><p>But there is a second way, using the <strong>Fluent API</strong>. This will initially feel more contrived, but it&#39;s actually the better option when you want to take a DDD approach. Instead of decorating your entity with attributes, you instead &#34;register&#34; these configurations on the context itself:</p><pre><code>public class MyContext : DbContext
{
    public MyContext() : base(&#34;MyConnectionStringName&#34;)
    { 

    }

    public DbSet&lt;User&gt; Users { get; set; }

    protected override void OnModelCreating(DbModelBuilder modelBuilder)
    {
        modelBuilder.Entity&lt;User&gt;().Property(p =&gt; p.Name).HasMaxLength(50);
    }
}
</code></pre><p>As far as I&#39;m aware, every attribute has an equivalent Fluent API alternative.</p><p><strong>But why use Fluent for DDD?</strong></p><p>The reason I want to suggest this is because the attributes require you to have access to the EF dependency in your class definition, which means that your entity will be defined in the data layer.</p><p>But you don&#39;t want that. You want to have a separate domain layer where your classes are defined and then consumed by the data layer. By using the Fluent API, you can ensure that this is what happens. The <code>MyContext</code> class is already required to be part of the data layer (since it derives from EF&#39;s <code>DbContext</code>), so it makes more sense to have it also take care of the EF-specific configuration of the table columns.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../ddd-with-orm-where-should-the-business-logic-go/'>DDD with ORM where should the business logic go</a></li><li class="list-group-item"><a href='../unit-of-work-pattern/'>Unit of Work pattern</a></li><li class="list-group-item"><a href='../ddd-infrastructure-layer-implement-servicepersistence-or-just-persistence/'>DDD infrastructure layer: implement service+persistence or just persistence</a></li><li class="list-group-item"><a href='../c-repository-pattern-and-joined-queries/'>C# &#8211; Repository Pattern and Joined Queries</a></li><li class="list-group-item"><a href='../unit-of-work-repository-pattern-dependency-injection/'>Unit of work + repository pattern + dependency injection</a></li><li class="list-group-item"><a href='../avoiding-repository-pattern-implementing-onion-architecture-with-dbcontext-only/'>Avoiding Repository pattern &#8211; implementing Onion Architecture with DbContext only</a></li><li class="list-group-item"><a href='../clean-architecture-and-repository-pattern/'>Clean architecture and Repository pattern</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>