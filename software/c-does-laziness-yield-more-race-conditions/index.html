<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Does laziness yield more race conditions &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084185 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084185" class="post-1084185 software type-software status-publish hentry category-software tag-c tag-lazy-initialization tag-multithreading"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Does laziness yield more race conditions</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">lazy-initialization</span><span class="mr-2 badge badge-warning">multithreading</span></p><div class="entry-content"><p>I recently ran into a race condition while accessing a configuration setting.  After examining what I could of the code, I came to the conclusion that the <code>Configuration</code> class&#39; laziness<sup>1</sup> was the source of the race condition.  Pondering that lead me to me wonder if <strong>laziness naturally yields a greater chance of race conditions?</strong></p><hr/><p>Here&#39;s how I came to the initial finding:<br /> The <code>Configuration</code> class is implemented as a <a href="http://msdn.microsoft.com/en-us/library/79b3xss3.aspx" rel="nofollow noreferrer">static class</a>, which means:</p><blockquote><p>The program cannot specify exactly when the class is loaded. However, it is guaranteed to be loaded and to have its fields initialized and its static constructor called before the class is referenced for the first time in your program.</p></blockquote><p>Which, if I read it correctly, is a long way of saying that the class is lazily loaded.  I did not find anything referencing ordering of events when using additional resources.  i.e. It didn&#39;t say when the configuration file (<code>app.config</code>) would be read.</p><p>And while <a href="http://msdn.microsoft.com/en-us/library/system.configuration.configuration(v=vs.110).aspx" rel="nofollow noreferrer">the class itself</a> states the following for thread safety, it&#39;s not clear when it actually reads the configuration file.</p><blockquote><p>Any public static members of this type are thread safe. Any instance members are not guaranteed to be thread safe.</p></blockquote><p>The bit about <code>Any instance members are not guaranteed to be thread safe</code> is particularly confusing since <a href="http://msdn.microsoft.com/en-us/library/79b3xss3.aspx" rel="nofollow noreferrer">a static class cannot be instantiated</a>.</p><p>What I believe occurred is that my program wrote to a section of the <code>Configuration</code> which was subsequently over-written as the static instance completed it&#39;s initialization and reading from the configuration file.</p><p>All of that led me to believe that the lazy loading of the static class with its indeterminate reading of the configuration file created the race condition I smacked into.</p><p>Which leads me to my broader question of: <strong>does laziness within an application naturally yield a greater chance of race conditions?</strong></p><p><sup>1</sup> <sub>The particular class in question is <a href="http://msdn.microsoft.com/en-us/library/system.configuration.configuration(v=vs.110).aspx" rel="nofollow noreferrer">System.Configuration.Configuration</a> from the .NET framework which is defined as <code>public static class ConfigurationManager</code>.</sub></p><hr/><p>For the gory details, this is the abstract version of the code:</p><pre><code>//This first line probably isn&#39;t required, but I inherited the code and didn&#39;t test removing it.
System.Configuration.Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);
config.ConnectionStrings.ConnectionStrings[DBName].ConnectionString = passedParam;
config.Save();
...
ConnectionStringSettings connectionString = ConfigurationManager.ConnectionStrings[DBName];
</code></pre><hr/><p>The answers <a href="https://softwareengineering.stackexchange.com/q/124500/53019">from here</a> hint at my question, but don&#39;t directly address my concern with race conditions.  And <a href="https://softwareengineering.stackexchange.com/q/156944/53019">this one</a> is somewhat related but more focused on IoC.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your first link does address the issue - it&#39;s laziness combined with side effects that is problematic, because the order of side effects matters.</p><p>For pure computations, the main thing that changes is space/time usage and whether the computation produces a result or not. More specifically, lazy evaluation won&#39;t evaluate expressions that aren&#39;t used, so the time usage can be lower, but the space usage is very hard to reason about.</p><p>For pure computations that don&#39;t complete successfully, both evaluation strategies can give different results. For example, since lazy evaluation doesn&#39;t evaluate expressions that aren&#39;t used, if an unused expression would&#39;ve resulted in an exception or an infinite loop, the computation will still terminate.</p><p>If the computation is both pure and total (always terminates successfully) both evaluation strategies give the same results (though space/time usage may still be different).</p><p>In short, while laziness may require you to think differently to figure out the execution order, it won&#39;t result in race conditions unless it&#39;s combined with side effects.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-how-to-make-a-universal-construction-more-efficient/'>Java &#8211; How to make a universal construction more efficient</a></li><li class="list-group-item"><a href='../java-the-advantage-of-swingutilities-invokelater-method/'>Java &#8211;  the advantage of &#8216;SwingUtilities.invokeLater()&#8217; method</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>