<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>REST API: Handle &#8220;partial&#8221; nested objects &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067193 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067193" class="post-1067193 software type-software status-publish hentry category-software tag-api tag-api-design tag-data-structures tag-json tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">REST API: Handle &#8220;partial&#8221; nested objects</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api</span><span class="mr-2 badge badge-info">api-design</span><span class="mr-2 badge badge-warning">data structures</span><span class="mr-2 badge badge-primary">json</span><span class="mr-2 badge badge-danger">rest</span></p><div class="entry-content"><p>Let&#39;s say we have schools with some data including a name and a list of students, and students with some data including courses they&#39;re enrolled in and a reference to their school. On the client:</p><ul><li>I&#39;d like to show a screen that shows information about a school, which includes a list of all of its students by name.</li><li>I&#39;d like to show a screen that shows information about a student, including the name of their school and the names of courses they&#39;re taking.</li><li>I&#39;d like to cache this information so that I can show the same screen without waiting on a new fetch. I should be able to go from school to student and back to school without fetching the school again.</li><li>I&#39;d like to show each screen with only one fetch. Going from the school page to the student page can take a separate fetch, but I should be able to show a school with the full list of student names in one fetch.</li><li>I&#39;d like to avoid duplicating data, so that if the school name changes, one fetch to update the school will lead to the correct name being shown both on the school page and the student pages.</li></ul><p>Is there a good way to do all of this, or will some of the constraints have to be lifted?</p><p>A first approach would be to have an API that does something like this:</p><pre><code>GET /school/1

{
    id: 1,
    name: &#34;Jefferson High&#34;,
    students: [
        {
             id: 1
             name: &#34;Joel Kim&#34;
        },
        {
             id: 2,
             name: &#34;Chris Green&#34;
        }
        ...
    ]
}


GET /student/1

{
    id: 1,
    name: &#34;Joel Kim&#34;,
    school: {
        id: 1,
        name: &#34;Jefferson High&#34;
    }
    courses: [
        {
             id: 3
             name: &#34;Algebra 1&#34;
        },
        {
             id: 5,
             name: &#34;World History&#34;
        }
        ...
    ]
}
</code></pre><p>An advantage of this approach is that, for each screen, we can just do a single fetch. On the client side, we could normalize schools and students so that they reference eachother with IDs, and then store the objects in different data stores. However, the <code>student</code> object nested inside of <code>school</code> isn&#39;t a full object &#8212; it doesn&#39;t include the nested courses, or a reference back to the school. Likewise, the <code>school</code> object inside of <code>student</code> doesn&#39;t have a list of all attending students. Storing partial representations of objects in data stores would lead to a bunch of complicated logic on the client side.</p><p>Instead of normalizing these objects, we could store schools and students with their nested partial objects. However, this means data duplication &#8212; each student at Jefferson High would have the name of the school nested. If the school name changed just before doing a fetch for a specific student, then we&#39;d show the right school name for that student but the wrong name everywhere else, including on the &#34;school details&#34; page.</p><p>Another approach could be to design the API to just return the ids of nested objects:</p><pre><code>GET /school/1

{
    id: 1,
    name: &#34;Jefferson High&#34;,
    students: [1, 2]
}


GET /student/1

{
    id: 1,
    name: &#34;Joel Kim&#34;,
    school: 1,
    courses: [3, 5]
}
</code></pre><p>We&#39;d always have &#34;complete&#34; representations of objects with all of their references, so it&#39;s pretty easy to store this information in data-stores client side. However, this would require multiple fetches to show each screen. To show information about a student, we&#39;d have to fetch the student and then fetch their school, as well as their courses.</p><p>Is there a smarter approach that would allow us to cache just one copy of each object, and to prevent multiple fetches to show basic screens?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In REST you can see everything you listed as a different resource. It is a different approach. In general you want to denormalize (database term) the data in a REST resource to fit your use case. So your examples are just fine, it includes all data you need at once so you can easily build a client for that.</p><p>In REST we can say you have the following resources:</p><ul><li>/schools (list of schools)</li><li>/schools/1 (school 1 with list of students)</li><li>/students (maybe list of students)</li><li>/students/1 (student 1 with list of courses for example).</li><li>/courses (list of all courses)</li><li>/courses/1 (list of one course which may contain all students enrolled)</li></ul><p>You could also have in addition:</p><ul><li>/schools/1/students (list of all students at this school)</li><li>/students/1/courses (all courses for this student)</li><li>/students/1/courses-finished (all finished courses for this student)</li></ul><blockquote><p>Is there a smarter approach that would allow us to cache just one copy
of each object, and to prevent multiple fetches to show basic screens?</p></blockquote><p>Object != resource in REST. The list of schools for example is also a resource. So you might have 3 database tables here but multiple resources.</p><p><strong>Client-side data stores</strong> Having data stored in separate data stores on the client is a different matter. I know it has been implemented in Meteor: <a href="https://meteorhacks.com/understanding-mergebox/" rel="nofollow noreferrer">https://meteorhacks.com/understanding-mergebox/</a> which allows to have an initial smaller document which expands when needed.</p><p><strong>Subscriptions</strong> So what you do is: You subscribe to schools and students (only info needed for listings, so for example: id &amp; name). Then when you know which student you want more details off you subscribe to that student in full detail. Behind the scenes it will populate your client-side database with all details of that specific student.</p><p><strong>REST</strong> That&#39;s not about REST, it&#39;s a totally different way of working. With REST, in general, you should not have to associate resources on the client.</p><p><strong>Normalisation</strong></p><blockquote><p>Instead of normalizing these objects, we could store schools and
students with their nested partial objects. However, this means data
duplication -- each student at Jefferson High would have the name of
the school nested.</p></blockquote><p>No. A REST resource (school/student/etc) is NOT equal to your database or whatsoever. (<a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven#comment-743" rel="nofollow noreferrer">http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven#comment-743</a>) You can return the REST resource school by making a join query behind the scenes. REST does and should not care about that. If performance becomes an issue you can just de-normalize that query behind the scenes and the REST resource is still looking the same. If you switch databases, resource looks still the same. Switching to another students management system, resource still the same. That&#39;s a big advantage you get by using REST. Originally it was designed to connect lots of unknown systems, by creating a universal API not linked to the backend technology you can work better together.</p><p><strong>Caching</strong> When a school name changes your should invalidate all caches using that school name. You can do that using ETAG. A quite simple example to understand this is: <a href="http://fideloper.com/api-etag-conditional-get" rel="nofollow noreferrer">http://fideloper.com/api-etag-conditional-get</a></p><p>So, let&#39;s assume you use a join to generate the school resource with the list of student names. And let&#39;s assume that you have a modifiedAt field in both schools and students table:</p><p>When you include both modifiedAt fields in your resource (or at least use them) and you generate a unique ETAG the following will happen:</p><ul><li><p>When school name is updated: ETAG becomes invalid for ONE school and ALL students of that school.</p></li><li><p>When student name is update: ETAG becomes invalid from ALL schools where the student is located and ONE student (the one changing).</p></li></ul><p>That allows the caches in between all to know when to invalidate their cache. You can also pre-cache those resources. ETAG allows to return the cached instance. So if the user would be offline he could just use the local resources. You could for example after login load all resources by requesting them in the background for this user:</p><pre><code>/students/1
/student/1/courses (even all filtered courses)
And then all courses he is enrolled into.
</code></pre><p>They will then be in the local cache and are available. This is also used for optimistic loading. You could just show the on from the cache instantly. Then in the background check to see if they are updated. If they are reload the data on screen.</p><p>Understand that there are multiple caches: The server may use one, in between some cache might be active, the browser caches, your own code may  cache. This universal way gets almost all well done HTTP caches to behave like you want.</p><p><strong>HATEOAS</strong> Read about HATEOS which makes it easier for you to fetch those students. Just include an url to them in the school resource. Then you can just follow the links. Examples: <a href="https://www.infoq.com/articles/webber-rest-workflow" rel="nofollow noreferrer">https://www.infoq.com/articles/webber-rest-workflow</a> and an example: <a href="https://developer.paypal.com/docs/integration/direct/paypal-rest-payment-hateoas-links/" rel="nofollow noreferrer">https://developer.paypal.com/docs/integration/direct/paypal-rest-payment-hateoas-links/</a></p><p>That makes it more manageable to get those sub resources.</p><p>It will allow you for example to show a list view with links on the student page to all his courses. And on top you might show a link to all his finished courses (when available in the api). And that business logic would all be handled by the api. So your client could just do:</p><p>/students/1 (so you get all data on the student)</p><pre><code>if(student.links.finished) {
  console.log(student.links.finished);
}
</code></pre><p>When he has no finished courses you could hide the link that way for example.</p><p>This can also be expanded like:</p><pre><code>student.links.courses {
  latest: /students/1/new-courses
  finished: /students/1/courses-finished
  failed: /students/1/courses-failed
}
</code></pre><p>That way you could on your client just do a forEach loop and show all available filters.</p><p><strong>Strategy</strong> Off course you can mix both. You could write a merge box implementation like which uses a REST api. That might be worth it if you want to re-use that data on the client and do for example complex searches / filtering on them. That&#39;s the advantage of having a client-side database.</p><p>On the other hand: If you just deliver the right data as REST resources there is no direct advantage of converting that data into a database at client side and then read from that. If you could just use the original resource because it contains just what you need.</p><p>So it is a trade-off depending on your exact use-case. If you can keep it simple and just use the REST resources that will work just fine. And it&#39;s simple which is a great advantage.</p><p>If you have to do complex data searches etc. the local client database might be a good fit.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-always-return-single-objects-in-an-array-for-rest-api-json-payloads/'>Rest &#8211; Always return single objects in an array for REST API JSON payloads</a></li><li class="list-group-item"><a href='../rest-api-should-api-return-nested-json-objects/'>REST API &#8211; Should API Return Nested JSON Objects</a></li><li class="list-group-item"><a href='../rest-api-nested-routes-without-providing-identifiers-at-every-nested-level/'>REST API, nested routes without providing identifiers at every nested level</a></li><li class="list-group-item"><a href='../rest-how-to-structure-a-rest-api-response-for-a-flux-redux-frontend/'>Rest &#8211; How to structure a REST API response for a Flux/Redux frontend</a></li><li class="list-group-item"><a href='../rest-api-proper-way-to-handle-non-crud-items-with-rest/'>REST API &#8211; proper way to handle non-CRUD items with REST</a></li><li class="list-group-item"><a href='../rest-api-responding-with-nested-arrays/'>REST API responding with nested arrays</a></li><li class="list-group-item"><a href='../java-rest-api-design-in-case-of-partial-success/'>Java &#8211; Rest API Design in case of partial success</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>