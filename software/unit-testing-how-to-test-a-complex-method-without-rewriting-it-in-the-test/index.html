<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; How to test a complex method (without rewriting it in the test) &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085146 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085146" class="post-1085146 software type-software status-publish hentry category-software tag-testing tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; How to test a complex method (without rewriting it in the test)</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">testing</span><span class="mr-2 badge badge-info">unit testing</span></p><div class="entry-content"><p>When writing tests, I often struggle with a conceptual issue, and maybe I am missing something major here.</p><p>For many classes, the test writing is straight forward and simple, often tests (and their verification) are even possible to be repeated with any amount of random input data.<br /> However, for a certain type of classes/methods &#8211; and they are they real &#39;meat&#39; of the program &#8211; it seems to be difficult to write any useful test &#8211; take <em>for example</em> a method that returns all possible moves of a knight in a given chess position:<br /> I could hard-code a position, call the method, and compare to the hard-codes expected resulting move list. I could then add ten or twenty more such hard-coded examples, and/or add one or two examples each for every special or edge case I can imagine. However, this doesn&#39;t feel like a good test &#8211; I&#39;d rather generate 1000 positions at random, and check the result for each one &#8211; but <em>how</em>? I would have to basically re-code the whole method again in the test, to be able to verify the result!?</p><p>Aside from the possibility that having such a complex method might be the issue itself, what would be the approach?</p><p>Another example is a recursive method for mini-max move evaluation, with alpha-beta-pruning. Although it has only 20 lines, the complexity of the desired functionality seems to disable any approach outside of hard-coding some input-output pairs, and verifying them &#8211; again, very unsatisfying, and it might miss many complex cases and subtle errors.</p><p><strong>How can testing such a complicated method be approached in a practical and effective way?</strong></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>There is a mantra in the testing community about &#34;Listening to your tests&#34;. Your tests tell you things about your code, and you should listen to them.</p><p>If you cannot figure out how to write a sensible test, then that could be an indication of a problem not with your tests, but with the code you are testing.</p><p>This comes up especially often in the context &#34;Doctor, it hurts when I try and test complex methods&#34;, and the answer to that is: don&#39;t write complex methods. After all, a test is just another client of your code, if your tests are hard two write that could be an indication that other clients are hard to write, too.</p><p>&lt;aside&gt;<br/> This is one of the advantages of Test-Driven Development: since the production code, and thus its interface, doesn&#39;t exist yet, when you write the tests, you can &#34;dream up&#34; any interface you want, for writing your tests against. And since programmers tend to be lazy, the interface yo dream up will be easy to use: why would you deliberately make it hard to write tests if there are no constraints that you force you to?<br/> &lt;/aside&gt;</p><p>Unfortunately, this is easier said than done.</p><p>For complex algorithms, there are some possibilities.</p><ol><li><em>Existing test cases</em>: oftentimes, complex algorithms are based on some research paper, and oftentimes, such a research paper will contain examples. These examples make good test cases.</li><li><em>Test known corner cases, special cases, edge cases, and exceptions, and at and near singularities</em>: many algorithms have corner cases that need to be handled, or they have singularities where they don&#39;t work, etc. Pathfinding algorithms that break down when the graph contains cycles, for example. Fibonacci of 0. Factorial of 0. If you know that the algorithm has problems with small numbers, you test it with -1, 0, 1, 0+ε, 0-ε, and so on.</li><li><em>Property-based testing</em>: this is a variation of #2 that was popularized by <a href="http://hackage.haskell.org/package/QuickCheck" rel="noreferrer">Haskell&#39;s QuickCheck</a> library. You state properties about your algorithm, and the test framework statistically generates likely counterexamples. <a href="https://microsoft.com/research/publication/pex-white-box-test-generation-for-net/" rel="noreferrer">Microsoft Research&#39;s Pex</a> is a very interesting example of this, since it can actually perform this analysis <em>statically</em> and not only <em>prove</em> that a property is violated but statically compute a counterexample without the need of generating it statistically.</li><li><em>Comparison with a known-good implementation</em>: You can compare the output of your implementation of the algorithm for a large number of both carefully selected cases (see #1 and #2) and randomly generated cases (a kind of &#34;fuzz testing&#34; for algorithms) with an implementation of the algorithm you know to be correct. For example, you have a highly optimized implementation in your library and a separate, very slow, very dumb, very simple, very straightforward, line-by-line translation of the idea behind the algorithm that you can read and verify, in your tests. You can even use different languages, e.g. a Python test that reads almost like a natural language description of the algorithm, and your production code is aggressively hand-optimized assembly.</li><li><em>Comparison with a known-good algorithm</em>: This is similar to #4 but instead of comparing against a known-good (ideally simpler) implementation of the <em>same algorithm</em>, you use a <em>different</em> (ideally simpler) algorithm altogether. Going with your example for an implementation of min-max search with alpha-beta pruning, you could e.g. implement a simple brute-force search in the test and verify that they always come to the same solution for the same inputs. (The high-level language trick from #4 can also be used here.)</li></ol><blockquote><p>I would have to basically re-code the whole method again in the test, to be able to verify the result!?</p></blockquote><p>That is essentially my points #4 and #5, but I want to emphasize a crucial point: the two implementations don&#39;t need to be the same. They <em>shouldn&#39;t</em> be the same!</p><p>The idea is that the implementation or even the algorithm that is used in the test is <em>simpler</em> than the one in the production code. Ideally, it should be so simple that it can be verified to be correct.</p><p>The second idea is that <em>this</em> test implementation never changes. As you add performance improvements to your production code, the test implementation always stays the same, and thus serves as a regression test to make sure that your optimizations never change the results.</p><p>You can even completely change the algorithm in the production code and be sure that you didn&#39;t break anything. (If you do this, you can also add the old algorithm you replaced to the tests!)</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-how-should-i-test-randomness/'>Unit-testing &#8211; How should I test randomness</a></li><li class="list-group-item"><a href='../c-how-should-i-unit-test-a-bitmap-modifying-method/'>C# &#8211; How should I unit test a bitmap modifying method</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>