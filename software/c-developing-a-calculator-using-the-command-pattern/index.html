<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Developing a calculator using the command pattern &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084693 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084693" class="post-1084693 software type-software status-publish hentry category-software tag-c tag-design-patterns"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Developing a calculator using the command pattern</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design-patterns</span></p><div class="entry-content"><p>In an attempt to solidify my understanding of the command pattern, I decided to write a  calculator application that utilised it.</p><p>After making some progress, I realised that my choice of application may not have been the ideal choice.</p><p><a href="../../../i.stack.imgur.com/PdM3W.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/PdM3W.png" alt="enter image description here"/></a></p><p><strong>I have the following components:</strong></p><hr/><p><strong>View.xml</strong></p><p>This is the user interface of the calculator, and is equivalent to the “client” in diagram.<br /> This is my view layer.</p><hr/><p><strong>Controller.cs</strong></p><p>This is the equivalent to the “invoker” in the diagram, this holds the commands, and calls execute on them.<br /> This is my controller layer</p><hr/><p><strong>Model.cs</strong></p><p>This is the equivalent to the “receiver” on the diagram.</p><hr/><p><strong>commandOne.cs, comandTwo.cs, commandMinus.cs&#8230;&#8230; etc</strong></p><p>These are my concrete commands , that define a binding between an action and the model.</p><hr/><p>As well as executing the commands, the controller also mains a queue of commands for the purposes of undo and redo.</p><p>In applying the command pattern to a calculator, I realised that execution of the commands is deferred until the entire expression has been created and equals has been pressed. I therefore set about recoding the sequence of button presses in the model layer before realising that I already had a container storing these in the form of the undo/redo queue in the controller.</p><p>Therefore, my question is, should I pass my controller/invoker to the model layer when the expression has been completed so that the commands in the queue can be run sequentially to calculate the result.</p><p>Or should I persist a similar queue in the model layer for the purposes of evaluating the expression when the equals button has been pressed.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The problem you&#39;re describing is that the model needs to know the internal state of the controller. This is a symptom of a much bigger problem, namely: Most of the state that belongs in your model is not being stored in your model. The solution here is not to duplicate the controller&#39;s state inside the model or pass the controller into the model, but rather to move that state into the model.</p><p>A closely related problem is that you&#39;re trying to use commands to represent not-yet-performed mathematical operations, when you should really be using them to represent the orders the user is giving your calculator app. It may be counterintuitive, but when the user presses the * button on a calculator, they are not telling the calculator to multiply two numbers, they&#39;re actually telling it to add a multiplication symbol to the current expression.</p><p>Specifically, <strong>your model should contain a representation of the current expression</strong>, whether that&#39;s a single number like &#34;123&#34; or a complicated not-yet-evaluated expression like &#34;3+4*90-8&#34;, and <strong>evaluating that expression should be its own command</strong>, separate from the commands to add a * and a 90 and a - and an 8 to the current expression.</p><p>For example, if your model is currently &#34;123&#34; and the user presses the * key, the model should be changed to &#34;123*&#34;, the view should be told to update itself, and the undo/redo stacks should be given command objects that add and remove a *. Then when the user presses 4, the model should change to &#34;123*4&#34;, the view should be told to update itself, and the undo/redo stacks should be given command objects that add/remove a 4. Finally, when the user presses =, the model should be told to evaluate its expression so it changes to &#34;492&#34;, the view should be told to update itself, the undo stack should be given a command object that resets the current expression back to &#34;123*4&#34; and the redo stack should be given a command object that evaluates the current expression. This way, there&#39;s absolutely no need for the model to ever receive a reference to the controller or the view, and you only need one pair of undo/redo stacks in the controller.</p><p>Note that the model doesn&#39;t have to be a simple string as I just described. In practice it&#39;s often better to represent an expression like this as an AST and give the model a method that converts said AST to a string for the view to display. But for a very simple calculator app a string might be sufficient.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-implementing-command-pattern-in-web-application/'>C# &#8211; Implementing Command Pattern in Web Application</a></li><li class="list-group-item"><a href='../c-command-pattern-design/'>C++ &#8211; Command pattern design</a></li><li class="list-group-item"><a href='../php-using-the-command-pattern-for-a-sequence-of-tasks/'>Php &#8211; Using the command pattern for a sequence of tasks</a></li><li class="list-group-item"><a href='../c-which-pattern-is-most-intuitive-for-a-calculator-app/'>C# &#8211; which pattern is most intuitive for a calculator app</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>