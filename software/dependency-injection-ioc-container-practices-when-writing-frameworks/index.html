<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Dependency Injection/IoC container practices when writing frameworks &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068917 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068917" class="post-1068917 software type-software status-publish hentry category-software tag-dependency-injection tag-inversion-of-control tag-ioc-containers tag-net tag-silverlight"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Dependency Injection/IoC container practices when writing frameworks</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">dependency-injection</span><span class="mr-2 badge badge-info">inversion-of-control</span><span class="mr-2 badge badge-warning">ioc-containers</span><span class="mr-2 badge badge-primary">net</span><span class="mr-2 badge badge-danger">silverlight</span></p><div class="entry-content"><p>I&#39;ve used various IoC containers (Castle.Windsor, Autofac, MEF, etc) for .Net in a number of projects. I have found they tend to be frequently abused and encourage a number of bad practices.</p><p>Are there any established practices for IoC container use, particularly when providing a platform/framework? My aim as a framework writer is to make code as simple and as easy to use as possible. I&#39;d rather write one line of code to construct an object than ten or even just two.</p><p>For example, a couple of code smells that I&#39;ve noticed and don&#39;t have good suggestions to:</p><ol><li><p>Large number of parameters (&gt;5) for constructors. Creating services tends to be complex; all of the dependencies are injected via the constructor &#8211; despite the fact that the components are rarely optional (except for maybe in testing).</p></li><li><p>Lack of private and internal classes; this one may be a specific limitation of using C# and Silverlight, but I&#39;m interested in how it is solved. It&#39;s difficult to tell what a frameworks interface is if all the classes are public; it allows me access to private parts that I probably shouldnt touch.</p></li><li><p>Coupling the object lifecycle to the IoC container. It is often difficult to manually construct the dependencies required to create objects. Object lifecycle is too often managed by the IoC framework. I&#39;ve seen projects where most classes are registered as Singletons. You get a lack of explicit control and are also forced to manage the internals (it relates to the above point, all classes are public and you have to inject them).</p></li></ol><p>For example, .Net framework has many static methods. such as, DateTime.UtcNow. Many times I have seen this wrapped and injected as a construction parameter.</p><p>Depending on concrete implementation makes my code hard to test.<br /> Injecting a dependency makes my code hard to use &#8211; particularly if the class has many parameters.</p><p>How do I provide both a testable interface, as well as one that is easy to use?<br /> What are the best practices?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The only legitimate dependency injection anti-pattern that I&#39;m aware of is the <a href="http://en.wikipedia.org/wiki/Service_locator_pattern">Service Locator</a> pattern, which is an anti-pattern when a DI framework is used for it.</p><p>All of the other so-called DI anti-patterns that I&#39;ve heard about, here or elsewhere, are just slightly more specific cases of general OO/software design anti-patterns. For instance:</p><ul><li><p>Constructor over-injection is a violation of the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility Principle</a>. Too many constructor arguments indicates too many dependencies; too many dependencies indicates that the class is trying to do too much. Usually this error correlates with other code smells, such as unusually long or ambiguous (&#34;manager&#34;) class names. Static analysis tools can easily detect excessive afferent/efferent coupling.</p></li><li><p>Injection of data, as opposed to behaviour, is a subtype of the <a href="http://en.wikipedia.org/wiki/Poltergeist_(computer_science)">poltergeist</a> anti-pattern, with the &#39;geist in this case being the container. If a class needs to be aware of the current date and time, you don&#39;t inject a <code>DateTime</code>, which is data; instead, you inject an abstraction over the system clock (I usually call mine <code>ISystemClock</code>, although I think there&#39;s a more general one in the <a href="http://systemwrapper.codeplex.com/">SystemWrappers</a> project). This is not only correct for DI; it is absolutely essential for testability, so that you can test time-varying functions without needing to actually wait on them.</p></li><li><p>Declaring every life cycle as Singleton is, to me, a perfect example of <a href="http://en.wikipedia.org/wiki/Cargo_cult_programming">cargo cult programming</a> and to a lesser degree the colloquially-named &#34;<a href="http://en.wikipedia.org/wiki/Object_cesspool#Pitfalls">object cesspool</a>&#34;. I&#39;ve seen more singleton abuse than I care to remember, and very little of it involves DI.</p></li><li><p>Another common error is implementation-specific interface types (with strange names like <code>IOracleRepository</code>) done just to be able to register it in the container. This is in and of itself a violation of the <a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle">Dependency Inversion Principle</a> (just because it&#39;s an interface, does not mean it&#39;s truly abstract) and often also includes <a href="http://en.wikipedia.org/wiki/Interface_bloat">interface bloat</a> which violates the <a href="http://en.wikipedia.org/wiki/Interface_segregation_principle">Interface Segregation Principle</a>.</p></li><li><p>The last error I usually see is the &#34;optional dependency&#34;, which they <a href="http://lostechies.com/jimmybogard/2009/07/03/how-not-to-do-dependency-injection-in-nerddinner/">did in NerdDinner</a>. In other words, there is <strong>a</strong> constructor that accepts dependency injection, but also <em>another</em> constructor that uses a &#34;default&#34; implementation. This <em>also</em> violates the DIP and <em>tends</em> to lead to <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle">LSP</a> violations as well, as developers, over time, start making assumptions around the default implementation, and/or start new-ing up instances using the default constructor.</p></li></ul><p>As the old saying goes, <em>you can write FORTRAN in any language</em>. Dependency Injection isn&#39;t a silver bullet that will prevent developers from screwing up their dependency management, but it <em>does</em> prevent a number of common errors/anti-patterns:</p><ul><li><a href="http://en.wikipedia.org/wiki/Abstraction_inversion">Abstraction inversion</a></li><li><a href="http://en.wikipedia.org/wiki/Circular_dependency">Circular dependencies</a></li><li><a href="http://en.wikipedia.org/wiki/Spaghetti_code">Spaghetti code</a> (sort of)</li></ul><p>...and so on.</p><p>Obviously you don&#39;t want to design a framework to depend on a specific IoC container <em>implementation</em>, like Unity or AutoFac. That is, once again, violating the DIP. But if you find yourself even thinking about doing something like that, then you must have already made several design errors, because Dependency Injection is a general-purpose dependency-management technique and is <em>not</em> tied to the concept of an IoC container.</p><p>Anything can construct a dependency tree; maybe it&#39;s an IoC container, maybe it&#39;s a unit test with a bunch of mocks, maybe it&#39;s a test driver supplying dummy data. Your framework shouldn&#39;t care, and most frameworks I&#39;ve seen don&#39;t care, but they still make heavy use of dependency injection so that it can be easily integrated into the end user&#39;s IoC container of choice.</p><p>DI isn&#39;t rocket science. Just try to avoid <code>new</code> and <code>static</code> except when there&#39;s a compelling reason to use them, such as a utility method that has no external dependencies, or a utility class that could not possibly have any purpose outside the framework (interop wrappers and dictionary keys are common examples of this).</p><p>Many of the problems with IoC frameworks come up when developers are first learning how to use them, and instead of actually changing the way they handle dependencies and abstractions to fit the IoC model, instead try to manipulate the IoC container to meet the expectations of their old coding style, which would often involve high coupling and low cohesion. Bad code is bad code, whether it uses DI techniques or not.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../should-the-usage-of-di-ioc-remove-all-occurrences-of-the-new-keyword/'>Should the usage of DI/IoC remove all occurrences of the &#8220;new&#8221; keyword</a></li><li class="list-group-item"><a href='../c-should-ioc-container-be-part-of-portable-library/'>C# &#8211; Should IoC container be part of portable library</a></li><li class="list-group-item"><a href='../how-to-manage-config-with-dependency-injection/'>How to manage config with dependency injection</a></li><li class="list-group-item"><a href='../how-does-a-dependency-injection-ioc-container-know-which-implementation-to-use/'>How does a Dependency Injection/IOC Container know which implementation to use</a></li><li class="list-group-item"><a href='../c-dependency-injection-for-a-library-with-internal-dependencies/'>C# &#8211; Dependency injection for a library with internal dependencies</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>