<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Mercurial Repository structure with heavyweight corporate comms, configuration management &#038; test requirements &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080565 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080565" class="post-1080565 software type-software status-publish hentry category-software tag-configuration-management tag-continuous-integration tag-mercurial tag-organization tag-svn"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Mercurial Repository structure with heavyweight corporate comms, configuration management &#038; test requirements</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">configuration-management</span><span class="mr-2 badge badge-info">continuous integration</span><span class="mr-2 badge badge-warning">mercurial</span><span class="mr-2 badge badge-primary">organization</span><span class="mr-2 badge badge-danger">svn</span></p><div class="entry-content"><p>I am yet another Subversion user struggling to re-educate myself in the Tao of distributed version control.</p><p>When using Subversion, I was a big fan of the project-minor approach, and, with most of my former employers, we would structure our repository branches; tags &amp; trunk as follows:</p><pre><code>branches-+
         +-personal-+
         |          +-alice-+
         |          |       +-shinyNewFeature
         |          |       +-AUTOMATED-+
         |          |                   +-shinyNewFeature
         |          +-bob-+
         |                +-AUTOMATED-+
         |                            +-bespokeCustomerProject
         +-project-+
                   +-shinyNewFeature
                   +-fixStinkyBug
tags-+
     +-m20110401_releaseCandidate_0_1
     +-m20110505_release_0_1
     +-m20110602_milestone
trunk
</code></pre><p>Within the actual source tree itself, we would use (something like) the following structure:</p><pre><code>  (src)-+
        +-developmentAutomation-+
        |                       +-testAutomation
        |                       +-deploymentAutomation
        |                       +-docGeneration
        |                       +-staticAnalysis
        |                       +-systemTest
        |                       +-performanceMeasurement
        |                       +-configurationManagement
        |                       +-utilities
        +-libraries-+
        |           +-log-+
        |           |     +-build
        |           |     +-doc
        |           |     +-test
        |           +-statistics-+
        |           |            +-build
        |           |            +-doc
        |           |            +-test
        |           +-charting-+
        |           |          +-build
        |           |          +-doc
        |           |          +-test
        |           +-distributedComputing-+
        |           |                      +-build
        |           |                      +-doc
        |           |                      +-test
        |           +-widgets-+
        |                     +-build
        |                     +-doc
        |                     +-test
        +-productLines-+
        |              +-flagshipProduct-+
        |              |                 +-coolFeature
        |              |                 +-anotherCoolFeature
        |              |                 +-build
        |              |                 +-doc
        |              |                 +-test
        |              +-coolNewProduct
        +-project-+
                  +-bigImportantCustomer-+
                  |                      +-bespokeProjectOne
                  |                      +-bespokeProjectTwo
                  +-anotherImportantCustomer-+
                                             +-anotherBespokeProject
</code></pre><p>The idea was (and still is) to use the structure of the repository to help structure communication between the engineering team; the customer-facing part of the business and various other stakeholders &amp; domain experts.</p><p>To wit: Source documents that sit in one of the &#34;project&#34; directories get used (and earn money) only once. Documents that sit in one of the &#34;productLines&#34; directories earn money as many times as a product from that particular line gets sold. Documents that sit in one of the &#34;libraries&#34; directories earn money as many times as any of the products that use them get sold.</p><p>It makes the notion of amortization of costs explicit, and helps build support for source document reuse across the business.</p><p>It also means that there is a common structure over which our build automation tools can operate. (Our build scripts walk the source tree looking for &#34;build&#34; folders within which they find configuration files specifying how each component is to be built; a similar process happens for documentation generation and testing).</p><p>Significantly, the products on which I work typically take a LONG time to run performance measurement &amp; characterization tests; from 20 to 200 hours; generating somewhere between several GB to several TB of processed test results/intermediate data (that must be stored and tied to a particular system configuration so performance improvement over time can be measured). This issue makes configuration management an important consideration, and also imposes some requirement for centralisation, as typically the computational resources needed to run the performance measurement and characterization tests are limited; (a small cluster of 64-128 cores).</p><p>As one final note; the continuous integration system knows that it needs to trigger a build; static analysis; smoke test &amp; unit test run each time trunk is modified, each time any &#34;tag&#34; branch is modified, and each time any &#34;AUTOMATED&#34; branch branch is modified. This way, individual developers can use the CI system with their personal branches, an important capability, IMHO.</p><p>Now, here is my question: How can I replicate all of the above (and improve upon it, if possible), with Mercurial.</p><p>&#8211;edit:</p><p>My current line of thinking is to use a central Subversion Repository, to define the overall structure, but to allow the use of hg as a client so developers can have repos available locally.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><a href="https://softwareengineering.stackexchange.com/a/128398/22493">Spoike&#39;s answer</a> is excellent, but there are a few things I think it would be worth adding which are too large for comments.</p><h3>Branch organisation</h3><p>With Mercurial you can happily ignore the whole of your first organisational chart. As Spoke says, each repository has it&#39;s own set of tags, branches (named and anonymous) and can be organised according to business need.</p><p>If <code>bespokeProjectTwo</code> needs a special version of the <code>charting</code> library, then you would branch <code>charting</code>, add the new facilities and use it in <code>bespokeProjectTwo</code>. The new facilities (and their bugs) would not be used by other projects which would reference the standard <code>charting</code> library. If the main <code>charting</code> library had bugs fixed, you could merge those changes into the branch. If other projects also needed these facilities, you could either get those projects to use the <em>special</em> branch, or merge the branch up into the main-line and close the branch.</p><p>Also, there is nothing stopping you having a policy to structure branch names to provide specific facilities like your AUTOMATION branches.</p><h3>Directory organisation</h3><p>There is no reason why you can&#39;t keep your source directory exactly as it is with Mercurial. The only difference is that whereas with Subversion you have a single monolithic <code>(src)</code> repository, with Mercurial you are better off splitting into repositories which are logically grouped. From your source tree structure, I would probably extract out each of the following as individual repositories:</p><pre><code>src-+
      +-(developmentAutomation)
      +-libraries-+
      |           +-(log)
      |           +-(statistics)
      |           +-(charting)
      |           +-(distributedComputing)
      |           +-(widgets)
      +-productLines-+
      |              +-(flagshipProduct)
      |              +-(coolNewProduct)
      +-project-+
                +-bigImportantCustomer-+
                |                      +-(bespokeProjectOne)
                |                      +-(bespokeProjectTwo)
                +-anotherImportantCustomer-+
                                           +-(anotherBespokeProject)
</code></pre><p>This allows any <em>product</em> or <em>bespoke project</em> to use any combination of libraries, at any revision. Have a look at <a href="http://mercurial.selenic.com/wiki/Subrepository" rel="nofollow noreferrer">mercurial sub-repositories</a> for an easy way to manage which libraries are used for any given version of a product or project.</p><h3>Workflow</h3><p>An alternative to Spoike&#39;s suggested workflow (developer pulls from blessed repo, works locally, issues a pull request and finally the integrator pulls those changes &amp; merges them) would be to use the continuous integration system as an intermediary.</p><p>As before, the developer pulls from blessed repo and works locally, but when done, they pull from the blessed repo again and merge themselves before pushing to an unblessed repo. Any changes to the unblessed repo are then reviewed (either manually or automatically) and moved to the blessed repo only if they are approved.</p><p>This means that the integrator only has accept or reject a change, not do the merge. <sup>In my experience it is almost always better for the developer who wrote the code to perform the merge than for someone else to do it.</sup></p><p>As suggested in the mercurial book, <a href="http://hgbook.red-bean.com/read/handling-repository-events-with-hooks.html" rel="nofollow noreferrer">hooks</a> can be used to automate this procedure:</p><blockquote><p>When someone pushes a changeset to the server that everyone pulls from, the server will test the changeset before it accepts it as permanent, and reject it if it fails to pass the test suite. If people only pull changes from this filtering server, it will serve to ensure that all changes that people pull have been automatically vetted.</p></blockquote><h3>Other issues</h3><p>The problem of large test datasets can also be solved by putting that test data into a <a href="http://mercurial.selenic.com/wiki/Subrepository" rel="nofollow noreferrer">mercurial sub-repository</a>. This will prevent the code repository getting bloated with test data, while still keeping the test data under revision control.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../best-practice-with-branching-source-code-and-application-lifecycle/'>Best practice with branching source code and application lifecycle</a></li><li class="list-group-item"><a href='../coming-up-with-a-version-control-strategy-for-svn/'>Coming up with a version control strategy for SVN</a></li><li class="list-group-item"><a href='../git-branching-a-subdirectory-while-keeping-commits-from-other-directories/'>Git &#8211; Branching a subdirectory while keeping commits from other directories</a></li><li class="list-group-item"><a href='../is-the-company-merging-branches-wrong/'>Is the company merging branches wrong</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>