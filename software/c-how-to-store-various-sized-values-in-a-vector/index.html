<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; How to store various sized values in a vector &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086624 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086624" class="post-1086624 software type-software status-publish hentry category-software tag-c"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; How to store various sized values in a vector</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span></p><div class="entry-content"><p>I want to separate the communication protocol from the communication medium in a project.  For example, I want to have a serial class and whatever other medium class and separately have a checksum protocol class and a crc protocol class and so forth.  That way, a device class can have a member base class pointer to the medium and another to the protocol and via that device class&#39;s constructor child classes of both can be passed.</p><p>Pseudo code</p><pre><code>class CDevice
{
public:
CDevice( CCommunicationDriver * drvr, CProtocol * protocol ) :
    drvr_     ( drvr ),
    protocol_ ( protocol )
{}

private:
CCommunicationDriver * drvr_;
CProtocol *            protocol_;
};

class CCrcProtcol : public CProtocol
{};

class CSerial : public CCommunicationDriver
{};

CDevice  a_device( new CSerial, new CCrcProtocol );
</code></pre><p>The idea is that if the difference between 2 devices is solely the medium and/or protocol a simple change can have a profound impact.  The goal is minimal code rewrite for a change of this nature.</p><p>Ultimately, I envision the communication driver taking in a CPacket which is a thin wrapper around a std::vector.  That way the interface for communicationdriver doesn&#39;t have to change going forward.  I plan for the vector to hold unsigned char&#39;s ( bytes ) since ultimately everything going over a wire/medium is bytes.</p><p>This leads to commands that are decoupled from the medium and protocol albeit not completely decoupled.  So, a command to turn on a light might have an ID 1 and a sub-ID 2.  What I think I need to do is to pass child commands to the driver&#39;s transmit function [ tx( CCommand * ) ] and have that function apply the protocol&#39;s decoration ( not sure on how that&#39;ll work yet ) and then get a vector of bytes to have the child communication driver push out over the wire.</p><p>Thus, I have 2 questions I could use help with.<br /> 1. ( main question ) Since ultimately everything ends up in the std::vector&lt; unsigned char &gt; what&#39;s a flexible way to add data to that vector?  I.e. a command has an id 2 bytes long due to one protocol but for another it&#39;s 4 bytes.  How do I pass id and 2 or 4 to some function that will split it up into single bytes?  Assume there&#39;s a lot sizes ( 1, 2, 3, 4, 8, etc. length ).  I&#39;ve thought about a template function that you specify the type with and then the value passed will be interpreted as that type&#39;s size.<br /> template&lt; typename T &gt;<br /> void addData( T data )<br /> {<br /> // determine data&#39;s type, parse somehow?<br /> }</p><pre><code>and also
template &lt;typename T &gt;
void addData( T data, int size )
{
// size is known but won&#39;t I have to specialize every size?
}
</code></pre><ol start="2"><li>Would you have the protocol class be a member of the driver class or keep them separate?</li></ol><p>I hope this long explanation of what I&#39;m trying to achieve is more helpful than annoying and that someone has a bright idea.</p><p>Thanks.<br /> -G-</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Firstly, command classes are decoupled from the medium and protocol. That means you can design the command classes for your own programming <em>convenience</em>, rather than having to design it to match exactly to the specifics of each protocol (which would be impossible, since different protocols may have different bit widths for the same command and field).</p><p>When I mention <em>convenience</em>, what I mean is that you can use the maximum bit width you&#39;ll ever need for each command&#39;s fields.</p><p>However, you may still need to have device- or protocol-specific validation code, since each device or protocol imposes its own limits to what values can be in those fields. Unless you don&#39;t plan to implement any validation at all.</p><p>When it comes to validation, there are several choices:</p><ul><li>Not doing it at all, if you will be doing all of the programming yourself, and if it is a hobby project such that mistakes do not result in damages.</li><li>Validating it eagerly, i.e. in the command class. This may be difficult, since a command class might not know which device or protocol it will be sent to.</li><li>Validating it late, i.e. in the protocol class where the command values are being converted into bytes.</li></ul><p>For example, even if a validation rule says that a particular field can only have a value in the range 0 - 100, it doesn&#39;t stop you from using a <code>uint32_t</code> or <code>int32_t</code> for that field in the command class.</p><p>To the second question of having an overloaded method that takes in various built-in number types and append the bytes to an internal byte vector, do notice the <a href="https://en.wikipedia.org/wiki/Partial_template_specialization#Caveats" rel="nofollow">caveats</a>.</p><p>In my opinion, if you only needs to work with the fundamental integer types, you don&#39;t need templates. Instead, you simply provide function overloads for each of the types, and you call the functions with a value of the appropriate type.</p><pre><code>void CPacket::addData(uint32_t data) { ... }
void CPacket::addData(int32_t data) { ... }
void CPacket::addData(uint16_t data) { ... }
void CPacket::addData(int16_t data) { ... }
...
</code></pre><p>Regarding the code inside, there are several choices:</p><p><a href="https://en.wikipedia.org/wiki/Type_punning#Use_of_union" rel="nofollow">Type punning with <code>union</code></a>. This assumes that your code will work exclusively with one byte-endianness, thus not needing to consider the possibility of porting to a different byte-endianness.</p><pre><code>union
{
    uint32_t value;
    uint8_t bytes[4];
} pun = { data };
// after that, add the bytes to the vector one-by-one, according to the byte endianness of the communication.
</code></pre><p>Explicitly extracting the bytes with endian-agnostic bitwise arithmetic: (see note on <a href="http://en.cppreference.com/w/c/language/conversion#Integer_conversions" rel="nofollow">casting</a>)</p><pre><code>// only if value is unsigned. For signed value, it must first be cast to unsigned
uint8_t byte0 = (uint8_t)value;
uint8_t byte1 = (uint8_t)(value &gt;&gt; 8ul);
uint8_t byte2 = (uint8_t)(value &gt;&gt; 16ul);
uint8_t byte3 = (uint8_t)(value &gt;&gt; 24ul);
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-efficient-way-to-find-unique-elements-in-a-vector-compared-against-multiple-vectors/'>C++ &#8211; Efficient way to find unique elements in a vector compared against multiple vectors</a></li><li class="list-group-item"><a href='../c-interface-questions-for-using-command-pattern-and-dependency-injection-together/'>C++ &#8211; Interface questions for using Command Pattern and Dependency Injection together</a></li><li class="list-group-item"><a href='../c-is-returning-a-reference-to-inside-a-private-vector-bad-practice/'>C++ &#8211; Is returning a reference to inside a private vector bad practice</a></li><li class="list-group-item"><a href='../c-key-value-store-development-porting-to-modern-c/'>C++ &#8211; Key / Value store development porting to modern C++</a></li><li class="list-group-item"><a href='../c-design-vector-classes-with-different-element-types/'>C++ design &#8211; vector classes with different element types</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>