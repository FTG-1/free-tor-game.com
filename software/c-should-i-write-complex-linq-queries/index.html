<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Should I write complex Linq queries &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072261 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072261" class="post-1072261 software type-software status-publish hentry category-software tag-c tag-linq"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Should I write complex Linq queries</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">linq</span></p><div class="entry-content"><p>I often find complex Linq queries that span over 10-15 lines in our code base.<br /> <br />I find such queries hard to understand and impossible to debug.<br /> <br />I&#39;ve tried to split the query to smaller parts, but it&#39;s hard to do since usually inner parts depend on the outer scope variables. Think of nested loops in imperative code.<br /> <br />Is this an indication of my inproficiency with Linq? Are complex Linq queries justified?<br /> <br />Would imperative solution be better in such cases?<br /> <br />Below is a sample query&#8230;</p><pre><code> var xItems = (
            from responseData in filteredItems
            let parentLevelItems = responseData.Items.Where(adi =&gt; ids.Contains(adi.Id))
            select new
            {
                secondLevelData = 
                (from c in secondLevelLabels
                    join secondLevel in responseData.children on c
                    equals string.IsNullOrEmpty(secondLevel.Label) ? 
                                           Constants.BlankData : secondLevel.Label into coun
                    from cn in coun.DefaultIfEmpty()
                    select new
                    {
                        secondLevelLabel = c,
                        parentLevelItems = parentLevelItems,
                        dataItems = cn == null ? response : 
                                                 cn.Items.Where(adi =&gt; ids.Contains(adi.Id))
                    })
            });
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Let&#39;s rewrite that without any LINQ or LINQ extensions:</p><pre><code>var xItems = new List&lt;object&gt;();
foreach(var responseData in filteredItems)
{
    var parentLevelItems = new List&lt;Item&gt;();
    foreach(var adi in responseData.Items)
    {
        if(ids.Contains(adi.Id))
        {
            parentLevelItems.Add(adi);
        }
    }

    var coun = new Dictionary&lt;Label, List&lt;Data&gt;&gt;();
    foreach(var c in secondLevelLabels)
    {
        foreach(var secondLevel in responseData.Children)
        {

            if(c == string.IsNullOrEmpty(secondLevel.Label) ? 
                                           Constants.BlankData : secondLevel.Label)
            {
                if(!coun.ContainsKey(c))
                {
                   coun[c] = new List&lt;Data&gt;();
                }
                count[c].Add(secondLevel);
            }
        }
        var secondLevelData = new List&lt;object&gt;();
        foreach(var cn in coun.DefaultIfEmpty())
        {
            secondLevelData.Add(new
            {
                secondLevelLabel = c,
                parentLevelItems = parentLevelItems,
                dataItems = cn == null ? response : 
                                                 cn.Values.Where(adi =&gt; ids.Contains(adi.Id))
            });
        }
    }

    xItems.Add(new 
    {
        secondLevelData = secondLevelData;
    });
}
</code></pre><p>I took some liberties with making up type names, translating the group join, and I did in fact keep some simple LINQ extensions (<code>Contains</code> and <code>DefaultIfEmpty</code>) to avoid going too mad. Nonetheless, looking at the above, I think it&#39;s relatively clear that your root problem <em>isn&#39;t</em> the choice of LINQ over loops.</p><hr/><p>Actually, the right way to deal with this code is probably with the usual refactorings: <strong>rename</strong> and <strong>extract method</strong>.</p><p>Names range from terrible (<code>cn</code>,<code>coun</code>) to the pretty-bad (<code>xItems</code>, <code>secondLevelItems</code>). It&#39;s hard to say for sure without knowing the context of this code, but you <em>should</em> be able to find more expressive names for these. This is a lot of complex logic, it seems like what it applies to should be more specific than just an &#34;item&#34;!</p><p>As for extracting methods, you say:</p><blockquote><p>I&#39;ve tried to split the query to smaller parts, but it&#39;s hard to do since usually inner parts depend on the outer scope variables.</p></blockquote><p>Well, this is where parameters come in handy! If loops are still more natural to you, you could always try translating from LINQ to loops, extracting out your methods, then translating the individual bits back to LINQ again.</p><hr/><p>More generally, you don&#39;t get any kind of automatic bonus points for using LINQ. There are two reasons it might be preferable:</p><ul><li>It&#39;s more declarative than loop-writing, making your code more expressive by letting you write <em>what</em> you&#39;re trying to achieve rather than <em>how</em> you&#39;re doing it.</li><li>It may be easier to keep lazy evaluation.</li></ul><p>The latter is very situation-specific, so let&#39;s focus on the former. That&#39;s really just a particular type of readability benefit. Usually it&#39;s enough, but I&#39;ve definitely seen cases (often involving the <code>Aggregate</code> extension method) where the LINQ version is just plain harder to decipher than the loop version. In that case, go for the loops! It&#39;d be crazy to pick the less readable option in the name of readability.</p><p>If you&#39;re worried that lack of experience with LINQ means your judgement may not be good on readability, there&#39;s really not too much you can do about that other than seek out the judgement of others and gain more experience. But if, as in your example, complexity is about the sheer length rather than too stuff much being packed into too few statements, there&#39;s a good chance that the choice of LINQ isn&#39;t ultimately what&#39;s causing the problem.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-the-point-of-properties/'>C# &#8211;  the point of properties</a></li><li class="list-group-item"><a href='../c-javascript-modularity-server-based-mvc-business-reality/'>C# &#8211; Javascript modularity, server based MVC &#038; business reality</a></li><li class="list-group-item"><a href='../c-for-vs-foreach-vs-linq/'>C# &#8211; for vs. foreach vs. LINQ</a></li><li class="list-group-item"><a href='../c-extracting-lambda-expressions-from-linq-queries-and-readability/'>C# &#8211; Extracting lambda expressions from linq queries and readability</a></li><li class="list-group-item"><a href='../c-is-linq-more-efficient-than-it-appears-on-the-surface/'>C# &#8211; Is linq more efficient than it appears on the surface</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>