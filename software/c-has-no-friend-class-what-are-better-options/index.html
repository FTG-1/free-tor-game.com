<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# has no friend class &#8211; what are better options &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068344 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068344" class="post-1068344 software type-software status-publish hentry category-software tag-architecture tag-c tag-design tag-design-patterns tag-object-oriented"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# has no friend class &#8211; what are better options</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">design</span><span class="mr-2 badge badge-primary">design-patterns</span><span class="mr-2 badge badge-danger">object-oriented</span></p><div class="entry-content"><p>I return to this question every couple of years, so now i decided to solve it once and for all, by asking here.</p><p>So, the sequence:</p><ol><li>I&#39;m writing a simple application that parses Json file (configuration to 3rd party app, further named as <em>config</em>) and allows user to do some editing with it. I&#39;ve picked a platform, made some basic UI, binded some buttons to NewFileCommand, OpenFileCommand, SaveFileCommand, etc.</li><li>Now I need to store somewhere the opened (and deserialized into a class) config, so I made a new StorageService class. It has some methods like OpenFile(), ReloadFile(), SaveFile(), etc. They are called from the ViewModel, StorageService opens file, <strong>read the config and store it as a field</strong>. When needed, it saves it to a file &#8211; so far so good.</li><li>At this moment, I want to add some manipulations with the config itself. I really dont want to put it in the StorageService. Some methods like GetConfigPropertyByNameAndDoSomeMagicWithIt() are definitely should be placed to another service.</li><li>So, i made another service, OperationsService. Now i want it it have an access to the config, stored in StorageService and add methods GetConfigPropertyByNameAndDoSomeMagicWithIt(). I dont want to expose the StorageService.config into the public API &#8211; because i already have all necessary accessors. For everyone else, except of OperationsService. Which i pretty much want to make the one, who can access StorageService.config. Looking like a good use case for old good C++ concept of the &#34;friend&#34; class, where OperationsService can be declared as a friend of StorageService and access its internals.</li><li>I&#39;m recalling that I&#39;ve faced similar issue earlier, so I googled for &#34;C# friendly class&#34;, opened <a href="https://stackoverflow.com/questions/204739/what-is-the-c-sharp-equivalent-of-friend">the first link</a> in a hope to find a modern solution &#8211; and realized that I&#39;ve a deja vu feeling.</li></ol><p>So, what is a flow in my current approach? How to solve it in &#34;proper modern OOP architecture&#34; manner?<br /> Make OperationsService an internal class of StorageService? That would mean that all the code would be stored in the same file (pretty much violation of SOLID).<br /> Make OperationsService an internal class of StorageService and make it partial and move to another file? Seems kinda creepy.</p><p>In general, I don&#39;t even want OperationsService to be exposed (not even to register it in IoC container) for the rest of the app &#8211; just to do the heavy lifting. OperationsService would be not that large, so I don&#39;t want to make a third (some kind of a wrapper service) as well.</p><p>In terms of objects I can rephrase the problem as &#34;object A has a private field, which should be accessible only for object B. Object&#39;s A responsibility is IO, Object&#39;s B responsibility is some logic, so they cant be merged&#34;.</p><p>To sum up, we have:</p><ul><li>config, which is POCO and contains deserialized data from Json.</li><li>StorageService, which contains OpenFile(), SaveFile(). Also, it contains current instance of the config.</li><li>theoretical OperationsService, which contains some logic in GetConfigPropertyByNameAndDoSomeMagicWithIt(). In order to run that logic, it has to have an access to the config as well. The question is how to relate OperationsService and StorageService.</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>One way of priveliging <code>OperationsService</code> over the rest of the system in regards to specific data is directly passing such data to it on a need to use basis: You could keep your config manipulation logic inside <code>OperationsService</code> and add a public <code>AcceptOperations()</code> method in <code>StorageService</code> that takes an <code>OperationsService</code> object as an arg and calls upon its relevant config manipulation logic, directly passing to it any privately held relevant config data.</p><p>Concretely, you could still have <code>GetConfigPropertyByNameAndDoSomeMagicWithIt()</code> be a member of <code>OperationsService</code>, that would call <code>AcceptOperations()</code> on the relevant <code>StorageService</code> instance and pass <code>this</code> as an arg. <code>AcceptOperations()</code> itself would call some concrete <code>ManipulateConfig()</code> method on the <code>OperationsService</code> instance given to it as a param, passing the internal config data to be manipulated as args for <code>ManipulateConfig()</code>.</p><p>This proposal takes in part some resemblance to the classic OOP <a href="https://en.wikipedia.org/wiki/Visitor_pattern" rel="nofollow noreferrer">Visitor Pattern</a>, excluding the <em>Double Dispatch</em> idiom but keeping the concept of restrictively defining who can visit what and definitely in keeping with the original idea behind the pattern which is to perform such separation of responsibilities such that <em>&#34;... [it provides] the ability to add new operations to existent object structures without modifying the structures.&#34;</em> The whole idea of such a pattern is to aid follow the <a href="https://en.wikipedia.org/wiki/Open–closed_principle" rel="nofollow noreferrer">Open-closed principle</a> which is one of SOLID principles, keeping of which you have mentioned to be a concern of yours to begin with.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../object-oriented-parameter-management-in-oop-application/'>Object-oriented &#8211; Parameter management in OOP application</a></li><li class="list-group-item"><a href='../what-are-repositories-services-and-actions-controllers/'>What are Repositories, Services, and Actions/Controllers</a></li><li class="list-group-item"><a href='../design-which-design-pattern-should-i-use-for-making-3-objects-loosely-coupled-and-encapsulated/'>Design &#8211; Which design pattern should I use for making 3 objects loosely coupled and encapsulated</a></li><li class="list-group-item"><a href='../java-injecting-dao-dependencies-into-service-class-in-core-java/'>Java &#8211; Injecting DAO dependencies into Service Class in Core Java</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>