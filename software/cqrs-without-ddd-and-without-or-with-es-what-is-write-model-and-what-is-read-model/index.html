<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>CQRS without DDD and without (or with?) ES &#8211; what is write model and what is read model &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076052 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076052" class="post-1076052 software type-software status-publish hentry category-software tag-cqrs tag-read-model"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">CQRS without DDD and without (or with?) ES &#8211; what is write model and what is read model</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">cqrs</span><span class="mr-2 badge badge-info">read-model</span></p><div class="entry-content"><p>As far as I understand, the big idea behind CQRS is having 2 different data models for handling commands and queries. These are called &#34;write model&#34; and &#34;read model&#34;.</p><p>Let&#39;s consider an example of Twitter application clone. Here are the commands:</p><ul><li>Users can register themselves. <code>CreateUserCommand(string username)</code> emits <code>UserCreatedEvent</code></li><li>Users can follow other users. <code>FollowUserCommand(int userAId, int userBId)</code> emits <code>UserFollowedEvent</code></li><li>Users can create posts. <code>CreatePostCommand(int userId, string text)</code> emits <code>PostCreatedEvent</code></li></ul><p><strong>While I use the term &#34;event&#34; above, I don&#39;t mean &#39;event sourcing&#39; events. I just mean signals that trigger read model updates.</strong> I don&#39;t have an event store and so far want to concentrate on CQRS itself.</p><p>And here are the queries:</p><ul><li>A user needs to see the list of its posts. <code>GetPostsQuery(int userId)</code></li><li>A user needs to see the list of its followers. <code>GetFollowersQuery(int userId)</code></li><li>A user needs to see the list of users it follows. <code>GetFollowedUsersQuery(int userId)</code></li><li>A user needs to see the &#34;friend feed&#34; &#8211; a log of all their friends&#39; activities (&#34;your friend John has just created a new post&#34;). <code>GetFriedFeedRecordsQuery(int userId)</code></li></ul><p>To handle <code>CreateUserCommand</code> I need to know if such a user already exists. So, at this point I know that my write model should have a list of all users.</p><p>To handle <code>FollowUserCommand</code> I need to know if userA already follows userB or not. At this point I want my write model to have a list of all user-follows-user connections.</p><p>And finally, to handle <code>CreatePostCommand</code> I don&#39;t think I need anything else, because I don&#39;t have commands like <code>UpdatePostCommand</code>. If I had those, I would need to make sure that post exists, so I would need a list of all posts. But because I don&#39;t have this requirement, I don&#39;t need to track all posts.</p><p><strong>Question #1</strong>: is it actually correct to use the term &#34;write model&#34; they way I use it? Or does &#34;write model&#34; always stand for &#34;event store&#34; in case of ES? If so, is there any kind of separation between the data I need to handle commands and the data I need to handle queries?</p><p>To handle <code>GetPostsQuery</code>, I would need a list of all posts. This means that my read model should have a list of all posts. I&#39;m going to maintain this model by listening to <code>PostCreatedEvent</code>.</p><p>To handle both <code>GetFollowersQuery</code> and <code>GetFollowedUsersQuery</code>, I would need a list of all connections between users. To maintain this model I&#39;m going to listen to <code>UserFollowedEvent</code>. Here is a <strong>Question #2</strong>: is it practically OK if I use write model&#39;s list of connections here? Or should I better create a separate read model, because in the future I may need it to have more details than write model has?</p><p>Finally, to handle <code>GetFriendFeedRecordsQuery</code> I would need to:</p><ul><li>Listen to <code>UserFollowedEvent</code></li><li>Listen to <code>PostCreatedEvent</code></li><li>Know which users follow which other users</li></ul><p>If user A follows user B and user B starts to follow user C, the following records should appear:</p><ul><li>For user A: &#34;You friend user B has just started following user C&#34;</li><li>For user B: &#34;You&#39;ve just started following user C&#34;</li><li>For user C: &#34;User B is now following you&#34;</li></ul><p>Here&#39;s the <strong>Question #3</strong>: what model should I use to get the list of connections? Should I use write model? Should I use read model &#8211; <code>GetFollowersQuery</code>/<code>GetFollowedUsersQuery</code>? Or should I make <code>GetFriendFeedRecordsQuery</code> model itself handle the <code>UserFollowedEvent</code> and maintain its own list of all connections?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><a href="http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/" rel="noreferrer">Greg Young (2010)</a></p><blockquote><p>CQRS is simply the creation of two objects where there was previously only one.</p></blockquote><p>If you think in terms of Bertrand Meyer&#39;s <a href="http://martinfowler.com/bliki/CommandQuerySeparation.html" rel="noreferrer">Command Query Separation</a>, you can think of the model as having two distinct interfaces, one that supports commands, and one that supports queries.</p><pre><code>interface IChangeTheModel {
    void createUser(string username)
    void followUser(int userAId, int userBId)
    void createPost(int userId, string text)
}

interface IDontChangeTheModel {
    Iterable&lt;Post&gt; getPosts(int userId)
    Iterable&lt;Follower&gt; getFollowers(int userId)
    Iterable&lt;FollowedUser&gt; getFollowedUsers(int userId)
}

class TheModel implements IChangeTheModel, IDontChangeTheModel {
    // ...
}
</code></pre><p>Greg Young&#39;s insight was that you could separate this into two separate objects</p><pre><code>class WriteModel implements IChangeTheModel { ... }
class ReadModel  implements IDontChangeTheModel {...}
</code></pre><p>Having separated the objects, you now have the option of separating the data structures that hold the object state in memory, so that you can optimize for each case; or store/ persist the read state separately from the write state.</p><blockquote><p>Question #1: is it actually correct to use the term &#34;write model&#34; they way I use it? Or does &#34;write model&#34; always stand for &#34;event store&#34; in case of ES? If so, is there any kind of separation between the data I need to handle commands and the data I need to handle queries?</p></blockquote><p>The term WriteModel is usually understood to be the mutable representation of the model (ie: the object, not the persistence store).</p><p>TL;DR: I think your use is fine.</p><blockquote><p>Here is a Question #2: is it practically OK if I use write model&#39;s list of connections here?</p></blockquote><p>That&#39;s &#34;fine&#34;--ish.  Conceptually, there&#39;s nothing wrong with the read model and write model sharing the same structures.</p><p>In practice, because writes to the model are not typically atomic, there is potentially a problem when one thread is trying to modify the state of the model while a second thread is trying to read it.</p><blockquote><p>Here&#39;s the Question #3: what model should I use to get the list of connections? Should I use write model? Should I use read model - GetFollowersQuery/GetFollowedUsersQuery? Or should I make GetFriendFeedRecordsQuery model itself handle the UserFollowedEvent and maintain its own list of all connections?</p></blockquote><p>Using the write model is the wrong answer.</p><p>Writing multiple read models, where each is tuned to a particular use case is totally reasonable.  We say &#34;the read model&#34;, but it is understood that there could be many read models, each of which is optimized for a particular use case, and does <em>not</em> implement the cases where it doesn&#39;t make sense.</p><p>For example, you might decide to use a key-value store to support some queries, and a graph database for other queries, or a relational database where that query model makes sense.  Horses for courses.</p><p>In your specific circumstance, where you are still learning the pattern, my suggestion would be to keep your design &#34;simple&#34; -- have one read model that does not share the data structure of the write model.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../cqrs-how-to-restore-read-model/'>CQRS: How to restore read model</a></li><li class="list-group-item"><a href='../ddd-cqrs-per-query-and-per-command-authorization/'>DDD CQRS &#8211; per-query and per-command authorization</a></li><li class="list-group-item"><a href='../cqrs-and-microservices-passing-information-from-one-service-to-another/'>CQRS and microservices: passing information from one service to another</a></li><li class="list-group-item"><a href='../cqrs-event-sourcing-how-to-process-events-in-the-expected-order-inside-the-read-model/'>CQRS-Event Sourcing: how to process events in the expected order inside the read model</a></li><li class="list-group-item"><a href='../reducing-the-code-duplication-between-read-and-write-application-in-cqrs/'>Reducing the code duplication between read and write application in CQRS</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>