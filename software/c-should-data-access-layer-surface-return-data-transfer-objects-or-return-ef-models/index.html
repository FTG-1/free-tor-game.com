<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Should Data Access Layer surface return Data Transfer Objects or return EF Models &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082254 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082254" class="post-1082254 software type-software status-publish hentry category-software tag-c tag-entity-framework"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Should Data Access Layer surface return Data Transfer Objects or return EF Models</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">entity-framework</span></p><div class="entry-content"><p>So say I have a controller Method</p><pre><code>    // GET: TimeEntries
    [HttpGet(&#34;[action]&#34;)]
    public IEnumerable&lt;TimeEntryDTO&gt; GetLast(int value)
    {
        return dal.GetLast(value);
    }
</code></pre><p>And a data access layer method of (using AutoMapper to convert TimeEntry to TimeEntryDTO)</p><pre><code>    public IEnumerable&lt;TimeEntryDTO&gt; GetLast(int value)
    {
        return db.TimeEntries.TakeLast(value).ProjectTo&lt;TimeEntryDTO&gt;();
    }
</code></pre><p>My Question is should I do this, and have the DAL (Data Access Layer) return the DTO (Data Transfer Object) or should I have the DAL return an IQuerable of the EF Model, and then convert it to a DTO in the controller method?</p><p>EDIT:</p><p>After doing some more reading, isn&#39;t the DBsets exposed by an EF context, in fact, the repository surface? So you wouldn&#39;t really ever see the actual DAL right, because it is a layer inside EF? So I should not call a layer that is on top of the EF Context, a DAL?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>...should I have the DAL return an IQuerable of the EF Model...</p></blockquote><p>Please don&#39;t do this. As Mark Seemann explains in <a href="http://blog.ploeh.dk/2012/03/26/IQueryableTisTightCoupling/" rel="nofollow noreferrer">IQueryable is Tight Coupling</a>, this interface suffers from a number of problems.</p><ol><li><p>It&#39;s what&#39;s often referred to as a &#34;header interface&#34;. This term refers to the bad practice in languages like C whereby a <code>.h</code> file simply details <em>all</em> the public functions found in the corresponding <code>.c</code> file. No consideration is given to the needs of the consumer, they simply get everything in one big lump. This means that <code>IQuerable</code> is a huge interface that is incredibly difficult to mock when writing unit tests around methods that return it. <a href="https://blogs.msdn.microsoft.com/mattwar/2008/11/18/linq-building-an-iqueryable-provider-series/" rel="nofollow noreferrer">Have a look at the 16 part series on how to write an implementation of <code>IQuerable</code> to get an idea of how hard this can be</a>.</p></li><li><p>It&#39;s a leaky abstraction. It&#39;s effectively an interface written to reflect the design of the Entity Framework ORM. As such, it exposes much of the functional design of that ORM in the interface, ie those implementation details &#34;leak out&#34; through the interface. So by exposing <code>IQuerable</code> in your DAL API, you couple your DAL to it and you couple consumers of that API to it.</p></li></ol><p>The whole purpose of abstractions is to decouple parts of your code. Using an interface that actually couples things together defeats the whole purpose of an abstraction. So don&#39;t do this.</p><p>Instead, stick to your other suggestion: convert those implementation details of <code>IQuerable</code> into DTOs that are focused on supplying just what the caller needs. This requires a bit more work as you have to write the DTOs and the conversion code, but it pays dividends in keeping things decoupled and easier to understand and test.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-business-objects-within-a-data-access-layer/'>C# &#8211; Business Objects within a Data Access Layer</a></li><li class="list-group-item"><a href='../c-confused-on-how-to-properly-employ-a-repository-pattern-with-service-business-layer-on-top/'>C# &#8211; Confused on how to properly employ a Repository Pattern with Service/Business Layer on top</a></li><li class="list-group-item"><a href='../c-separation-of-retrieving-data-and-business-objects-between-dal-and-bll-layers/'>C# &#8211; Separation of retrieving data and business objects between DAL and BLL Layers</a></li><li class="list-group-item"><a href='../c-data-layer-vs-business-layer/'>C# &#8211; Data Layer vs Business Layer</a></li><li class="list-group-item"><a href='../c-in-ddd-should-repositories-expose-an-entity-or-domain-objects/'>C# &#8211; in DDD, should repositories expose an entity or domain objects</a></li><li class="list-group-item"><a href='../should-an-update-method-in-crud-repository-class-always-return-something/'>Should an update method in CRUD Repository class always return something</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>