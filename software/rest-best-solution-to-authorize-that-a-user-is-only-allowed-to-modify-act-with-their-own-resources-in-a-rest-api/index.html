<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Rest &#8211; Best solution to authorize that a user is only allowed to modify/act with their own resources in a REST API &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080432 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080432" class="post-1080432 software type-software status-publish hentry category-software tag-authorization tag-large-scale-project tag-rest tag-session"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Rest &#8211; Best solution to authorize that a user is only allowed to modify/act with their own resources in a REST API</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">authorization</span><span class="mr-2 badge badge-info">large-scale-project</span><span class="mr-2 badge badge-warning">rest</span><span class="mr-2 badge badge-primary">session</span></p><div class="entry-content"><h2>Background:</h2><p>Currently in the process of building out a REST API, using node w/express and it is consumed by a mobile app and eventually a (modern browser based) website.</p><p>I&#39;m trying to identify the best way to authorize a user&#39;s update/action request so they are only allowed to modify their own resources. The actions will occur at a semi high rate hence the concern.</p><p>Note: Ownership of entities can not be transferred in this use case.</p><h2>Potential Solutions:</h2><p><strong>Solution</strong>:<br /> Store and maintain a list of each user&#39;s resources in a server session backed by something like reddis.</p><p><strong>Concern(s)</strong>:<br /> Persisting a server side session has its own set of complexities specifically scaling with multiple servers. This also violates the REST. <a href="https://stackoverflow.com/questions/6068113/do-sessions-really-violate-restfulness">do-sessions-really-violate-restfulness</a> for more information.</p><p><strong>Solution:</strong><br /> Do a read query before the user&#39;s update/action query. IE give me this user&#39;s items then if its in the list proceed with update.</p><p><strong>Concern(s):</strong><br /> Overhead of an additional read every time a user acts on behalf of a resource.</p><p><strong>Solution:</strong><br /> Pass the user id down to the db layer and make it part of the update conditional or if you want to get fancy use something like Postgres&#39; row level security for that resource depending on the data backend.</p><p><strong>Concern(s):</strong><br /> This seems a bit late in the request life cycle to check if the resource is the requesting user&#39;s. The error would have to be thrown all the way up from the data backend. On the same note it would also be a bit out of place considering the authentication and role based authorization is often done at the beginning of the request life cycle. The implementation is also dependent on the data backend. It also shoves business logic in the data backend.</p><p><strong>Solution:</strong><br /> Client side signed session of sorts. Either with a JWT or a encrypted/signed cookie. Essentially maintaining a trusted session containing a list of the user&#39;s resource ids.</p><p><strong>Concern(s):</strong><br /> The size of the client side session. The fact that it would be sent with every single request even when its not needed. Maintenance becomes extremely complex when you introduce the possibility of multiple active sessions/clients. How would you update the client side state when a resource was added on another client.</p><p><strong>Solution:</strong><br /> Pass a signed update token(JWT) or url to the client with the resource when the resource is fetched. Expect that when a resource is updated/actioned. The signed token would contain the user id and the resource id and you could verify easily against those.</p><p><strong>Concern(s):</strong><br /> Gets complex if resource ownership is transferable but in my case that is not a concern. Introduces complexity over a read before update. It&#39;s a bit odd?</p><h2>Final Thoughts:</h2><p>I&#39;m leaning towards the last solution, but because I don&#39;t see it happen very often I&#39;m wondering if I am missing something? or maybe its part of a design pattern I don&#39;t know about.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I think there are two solutions in your list that fit your use case best;  the read query before the update (solution 2) and sending an update token with the read request (solution 5).</p><p>If you&#39;re worried about performance, I&#39;d decide on one or the other depending on how many reads vs updates to a resource you expect. If you expect way more updates than reads, then obviously solution 5 is better, because you don&#39;t need to do an additional database fetch to figure out the owner of the resource.</p><p>However, you shouldn&#39;t forget the security implications of giving out an update token. With solution 2, assuming authentication is secure, then updating a resource is probably also secure because you determine the owner of a resource on the server.</p><p>With solution 5, You don&#39;t double-check the claim the client makes, except that you check for a valid signature. If you&#39;re letting the update happen over a cleartext link (eg, no SSL), then only encoding the resource and user id in the token isn&#39;t secure. For one, you&#39;re opening yourself to replay attacks, so you should include a nonce that grows with each request. Also, if you don&#39;t encode a timestamp/expiration date in the update token, you basically give indefinite update access to anyone who has that token. Finally, if you don&#39;t want the nonce, then you should at least include an hmac of the fetched resource, so that the update token is only valid for the state of the resource as it was fetched. This makes replay attacks more difficult and further limits the damage knowledge of the update token can do, since the update token is only valid when the resource is in the given state.</p><p>I think that even if you&#39;re communicating over a secure link, adding a nonce (or at least an hmac of the state of the resource) and an expiration date for the update token would be a clever thing to do. I don&#39;t know the application domain, but you may deal with malicious users and they might wreck all kinds of havoc with the power of unlimited update access to their own resources.</p><p>Adding a nonce will mean an additional column per resource in your database where you store the value of the nonce you sent with the last fetch request. You can compute the hmac over the serialized json representation of your resource. You can then send your token not as part of the message body but as an additional HTTP header.</p><p>Oh, and I&#39;d use a token, not a URL; in REST, the update URL for a given resource should be the same URL the resource was fetched from, right? I&#39;d move all authentication &amp; authorization-related stuff to the HTTP headers, e.g. you could provide the update token in the Authorization Header of the PUT request.</p><p>Note that adding a nonce that grows with each resource fetch will also require a database update (the new value for the nonce) for each resource fetch request (although you may get away with only updating the nonce when the state of the resource is actually changed, so it would be free from a performance standpoint), unless you want to keep that information in transient memory and simply have the clients retry when your server is restarted between a fetch and an update request.</p><p>A side note to your solution 4 (client side sessions): Depending on the number of resources your users can create, the session size might not be a problem. The client side session update problem might be fairly easy to solve, as well: If an update request to a resource fails because the resource is not listed in the session data you received from your client, but the user is correct, then you do a check in the backend whether the session data from that client is outdated. If it is, you allow the update and send back an updated cookie with the answer to the update request. This will only cause a database lookup when a user tries to update a resource from a client with outdated local session data (or when he is malicious and tries to ddos you, but rate limiting to the rescue!). However, I agree that solution 4 is more complicated than the others and you&#39;re better of with one of your other ideas. Solution 4 also has various security considerations you should take into account; storing this much authorization state on the client really needs your security to be watertight.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../should-i-store-the-user-claims-in-the-jwt-token/'>Should I store the user claims in the JWT token</a></li><li class="list-group-item"><a href='../rest-api-security-stored-token-vs-jwt-vs-oauth/'>REST API security Stored token vs JWT vs OAuth</a></li><li class="list-group-item"><a href='../rest-handling-token-renewal-session-expiration-in-a-restful-api/'>Rest &#8211; Handling token renewal / session expiration in a RESTful API</a></li><li class="list-group-item"><a href='../microservices-session-data-when-communicating-internally/'>Microservices session data when communicating internally</a></li><li class="list-group-item"><a href='../rest-stateful-authentication-in-rest-api-using-tokens/'>Rest &#8211; Stateful authentication in REST API using tokens</a></li><li class="list-group-item"><a href='../how-to-efficiently-pass-permissions-that-control-view-and-access-of-specific-front-end-elements-from-backend-to-the-spa-using-jwt/'>How to efficiently pass permissions that control view and access of specific front-end elements from backend to the SPA using JWT</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>