<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Would a &#8220;downcast if block&#8221; be a reasonable language feature &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081214 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081214" class="post-1081214 software type-software status-publish hentry category-software tag-c tag-language-features tag-syntax tag-type-casting"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Would a &#8220;downcast if block&#8221; be a reasonable language feature</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">language-features</span><span class="mr-2 badge badge-warning">syntax</span><span class="mr-2 badge badge-primary">type casting</span></p><div class="entry-content"><p>Consider the following &#34;if cast&#34;:</p><pre><code>class A     { public void f1() { ... } }
class B : A { public void f2() { ... } }

A a = foo(); // might return A or B

if ( a is B ) {
    //  Inside block, implicitly &#34;redeclare&#34; a as type B
    //  It&#39;s B, go for it
    a.f2();
    //  Wouldn&#39;t compile.
    a = new A();
}
</code></pre><p>We don&#39;t enter the block unless <code>a</code> is a <code>B</code>, therefore within the block, the compiler treats <code>a</code> exactly as if it had been declared as type <code>B</code>. You could assign null to it in the block if it&#39;s a reference type, but it would be a compile-time error to assign <code>new A()</code> to it, for example (thanks @ThomasEding for bringing up that question).</p><p>Anything that could break that assumption that <code>a</code> is <code>B</code>, could just as easily break the following legal C# as well:</p><pre><code>if ( a is B ) {
    B b = a as B;

    b.f2();
}
</code></pre><p>The former looks to me like syntactic sugar for the latter.</p><p>Even if this feature makes sense, I&#39;m sure Anders Hjelberg&#39;s lads have more useful features to implement. I&#39;m just wondering if it&#39;s a worse idea than I think it is.</p><p><strong>UPDATE</strong> A serious objection would be that the feature as described adds semantics without adding syntax: From one version of the language to the next, the meaning of the above block would change significantly. It would be more tolerable with a new keyword. But then you&#39;d be adding a new keyword.</p><h2>Update</h2><p>A more redable version of this feature was implemented in C#7:</p><pre><code>object object2 = new List&lt;Test&gt;();

if (object2 is Dictionary&lt;String, int&gt; foo)
{
    Console.WriteLine(foo.Keys);
}
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Let&#39;s assume features start with 0 points, rather than with <a href="https://docs.microsoft.com/en-us/archive/blogs/ericgu/minus-100-points" rel="nofollow noreferrer">-100 points</a> (due to costs associated with implementation, design, etc.).</p><p>This feature strikes me as confusing.  I&#39;ve already declared that a is an A.  If I want to know the compile-time type of a, I only have to look in one place, at the declaration.  While I acknowledge that the implementation is relatively simple (use the code substitution you describe in your question), this also argues in favor of not implementing the feature; it&#39;s easy for coders to do it, too.</p><p>The truly horrifying thing is that the type of a variable can magically change immediately after a <code>}</code>.  C# very deliberately prevents this from happening (see <a href="https://docs.microsoft.com/en-us/archive/blogs/ericlippert/simple-names-are-not-so-simple" rel="nofollow noreferrer">Simple names are not so simple</a>).  So, I absolutely hate any version of this feature that fails to introduce a new variable during the cast.</p><p>If you find yourself constantly casting your types so as to access members of derived classes, it makes me suspect you are misusing inheritance.  Personally, usually in code where I&#39;m using such a conditional, I&#39;m going to break out of my function if the cast fails.  So, my code would look more like this:</p><pre><code>B myB = myA as B;
if (myB == null) return;
</code></pre><p>Which would, under some variant of your proposal, become this:</p><pre><code>if (!(myA is B)) return;
</code></pre><p>or (introducing a new name)</p><pre><code>if (!(myA to B myB)) return;
</code></pre><p>or, using <a href="https://roslyn.codeplex.com/wikipage?title=Language%20Feature%20Status&amp;referringTitle=Documentation" rel="nofollow noreferrer">declarative expressions</a> (this is a variant on <a href="https://softwareengineering.stackexchange.com/a/236335/15162">Jimmy Hoffa&#39;s answer</a>)</p><pre><code>if (!a.To(out B myB)) return;
</code></pre><p>With the exception of the approach using declarative expressions, all of these features require learning new C# syntax for a feature that is not at all painful to deal with.  The declarative expression approach is nice in that it is the <a href="https://ericlippert.com/2012/07/17/should-c-warn-on-null-dereference/" rel="nofollow noreferrer">general case of a specific feature</a>; i.e. allowing coders to make use of an assignment and conditional using a single expression.</p><p>The only cost to the declarative expression approach is that it won&#39;t work universally; it only works if your special <code>To</code> method is implemented and visible in your current scope.  However, that&#39;s a price I&#39;m willing to pay to avoid adding yet more syntax to the C# language; I won&#39;t bother using such an extension method unless I&#39;m dealing with code which constantly requires it (and probably not even then).</p><p>In summary: This feature isn&#39;t needed quite often enough to justify adding new syntax to the language.  However, the more general feature, declarative expressions, may be worth the cost (which is why Microsoft is probably going to pay it).  It not only handles this case, but also handles the annoying two-statement <code>TryParse</code> case (and, like your proposal, makes for clean scope; the type is only in scope on the inside of the conditional).</p><p><strong>Update: <a href="https://roslyn.codeplex.com/discussions/568820" rel="nofollow noreferrer">Declarative Expressions were cancelled</a>.</strong></p><p><strong>Update 2: <a href="https://devblogs.microsoft.com/dotnet/whats-new-in-csharp-7-0/" rel="nofollow noreferrer">C# 7.0 is adding &#34;out variables&#34;</a>.</strong> This might be enough for my final example (<code>if (!a.To(out B myB)) return;</code>). <a href="https://devblogs.microsoft.com/dotnet/whats-new-in-csharp-7-0/#user-content-is-expressions-with-patterns" rel="nofollow noreferrer">C# 7.0 is also adding &#34;Is-expressions with patterns&#34;</a>, which allows, <code>if (!(o is int i)) return;</code>.  This is basically the feature you asked for.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-why-arent-databases-integrated-as-a-language-feature/'>Database &#8211; Why aren&#8217;t databases integrated as a language feature</a></li><li class="list-group-item"><a href='../when-is-a-feature-considered-a-first-class-citizen-in-a-programming-language-platform/'>When is a feature considered a &#8220;First class citizen&#8221; in a programming language/platform</a></li><li class="list-group-item"><a href='../a-combined-if-switch-statement-syntax-with-exception-handling-for-a-c-inspired-language/'>A combined if/switch statement syntax with exception handling for a C#-inspired language</a></li><li class="list-group-item"><a href='../c-is-the-usage-of-explicit-casting-operator-reasonable-or-a-bad-hack/'>C# &#8211; Is the usage of explicit casting operator reasonable or a bad hack</a></li><li class="list-group-item"><a href='../c-why-session-has-implemented-this-way-in-asp-net/'>C# &#8211; Why Session has implemented this way in Asp.net</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>