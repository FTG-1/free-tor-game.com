<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Working with legacy code &#8211; introducing an external BDD integration test harness &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084062 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084062" class="post-1084062 software type-software status-publish hentry category-software tag-bdd tag-legacy"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Working with legacy code &#8211; introducing an external BDD integration test harness</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">bdd</span><span class="mr-2 badge badge-info">legacy</span></p><div class="entry-content"><p>Here&#39;s the scenario.</p><ul><li>There&#39;s a large, organically grown application written in some language and manner that makes it difficult to test.  It works but is hard to maintain.</li><li>Specifications are woolly, so even if the code was amenable, it&#39;s hard to know what things should be doing without doing them.</li><li>You want to get it into a test harness so you can start to refactor and create proper unit tests.</li></ul><p>In these cases it makes sense to build an external or superficial &#39;test everything&#39; harness so you can start more aggressive refactoring to enable you to write proper unit tests.  This seems a pretty established practice of incrementally introducing tests.</p><p><em>&#34;The main thing that distinguishes legacy code from non-legacy code is a lack of<br /> comprehensive tests.&#34; &#8211; Michael C. Feathers (Working Effectively with Legacy Code)</em></p><p>My question is this:</p><p>Does it make sense to build a suite of Behaviour Driven tests at this point and execute them via some kind of automated button clicker?  I&#39;m thinking something like (but not limited to) cucumber or similar where the human readable tests match executable code/scripts that prove the defined behaviour is being met.</p><p>A clear advantage of this is that a human readable specification of sorts could be developed alongside the tests and that these specifications are much easier to confirm as sane and correct with users/developers of the system.  They are essentially integration tests but perform the function that Feathers recommends.</p><p>eta: I&#39;m not asking for a specific tool recommendation, the actual tool is irrelevant (although it would be helpful to know if they actually exist) I&#39;m after a sanity check and recommendations around external BDD integration testing.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It&#39;s perfectly possible to do this. I&#39;ve <a href="http://lizkeogh.com/2014/01/22/using-bdd-with-legacy-systems/">written a blog with a few guidelines</a>, but these additional ones might help you too:</p><ul><li><p>Think about the <em>capabilities</em> of the system. For instance, an accounting system might have the ability to read bank feeds, raise invoices, email those invoices, etc.</p></li><li><p>Group the scenarios in terms of the capabilities. Look at what kind of contexts (the givens) produce what kinds of outcomes (the thens). Have some conversations with the business people about these, and pick up their language as far as possible. The capabilities themselves will drive what you write for the events (the whens).</p><p>For instance, you might find a couple of scenarios for raising invoices where it says something like:</p><blockquote><p>Given an organisation to bill is outside the US<br/> When we send the invoice<br/> Then international bank details should be included.</p><p>Given an organisation to bill is within the US<br/> When we send the invoice<br/> Then it should include only US bank details.</p></blockquote><p>These will then tie into the automation that does the more detailed steps that actually create organisations with different addresses in different countries, send the invoices, and verify that those invoices have been sent with the correct bank details. There will be far more automation steps than there will of these higher-level ones. This is commonly referred to as <em>declarative vs. imperative language</em>, and will help you to work out which scenarios are the most important to cover, and which are functionally equivalent.</p><p>Notice that the difference between the scenarios is called out fairly cleanly here, which it wouldn&#39;t be if there were multiple UI steps hiding that difference. The difference between the scenarios is what illustrates the <em>behaviour</em>.</p></li><li><p>You are likely to find bugs. It&#39;s up to you if you want to write scenarios around what the system should do. It&#39;s highly likely though that by now there are some human workarounds, so I wouldn&#39;t worry too much about this behaviour. If the application is in the wild and producing value, it&#39;s good. Make sure you get scenarios around the core capabilities written first.</p></li><li><p>Whenever you have to fix a bug, <em>write some unit tests</em>. This will force you to redesign your code. Regression bugs are usually caused by poor design, and adding yet more scenarios will just make the code harder to change rather than give you any more confidence in it. This is what Michael Feathers is primarily referring to here. See also the <a href="http://martinfowler.com/bliki/TestPyramid.html">test pyramid</a>. As your system is refactored, the number of unit tests and integration tests should be rapidly outstripping those at the UI level.</p></li><li><p>You can use the different capabilities of the system to guide you in finding the seams which Michael talks about in his book, which will help you to refactor.</p></li><li><p>Note that I don&#39;t use the word test very often. Business people will tend to talk more comfortably about the behaviour of the system when you talk about examples or scenarios in which things happen than when you talk about tests. This harks back to the <a href="http://dannorth.net/introducing-bdd/">origins of BDD</a>.</p></li></ul><p>Good luck!</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-have-unit-test-generators-helped-you-when-working-with-legacy-code/'>Unit-testing &#8211; Have unit test generators helped you when working with legacy code</a></li><li class="list-group-item"><a href='../best-practices-for-retrofitting-legacy-code-with-automated-tests/'>Best practices for retrofitting legacy code with automated tests</a></li><li class="list-group-item"><a href='../c-does-adding-unit-tests-make-sense-for-well-known-legacy-code/'>C++ &#8211; Does adding unit tests make sense for well-known legacy code</a></li><li class="list-group-item"><a href='../unit-testing-is-it-sufficient-to-use-acceptance-and-integration-tests-instead-of-unit-test/'>Unit-testing &#8211; Is it sufficient to use acceptance and integration tests instead of unit test</a></li><li class="list-group-item"><a href='../what-levels-to-test-on-with-bdd-cucumber/'>What levels to test on with BDD/Cucumber</a></li><li class="list-group-item"><a href='../unit-testing-how-to-write-unit-tests-for-legacy-code-that-i-dont-understand/'>Unit-testing &#8211; How to write unit tests for legacy code (that I don&#8217;t understand)</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>