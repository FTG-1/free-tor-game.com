<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; Does the visitor pattern violate the Liskov Substitution Principle &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081861 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081861" class="post-1081861 software type-software status-publish hentry category-software tag-design tag-liskov-substitution tag-solid tag-visitor-pattern"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; Does the visitor pattern violate the Liskov Substitution Principle</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">liskov-substitution</span><span class="mr-2 badge badge-warning">solid</span><span class="mr-2 badge badge-primary">visitor-pattern</span></p><div class="entry-content"><p>When using the Visitor pattern, I have observed the following:</p><ul><li>The visitor has weak dependencies to concrete types (each visit method has the concrete element as a parameter or is a method that corresponds to a concrete element)</li><li>The element (supertype of the concrete types) has a weak dependency to the visitor (the accept method has the visitor as a parameter)</li></ul><p>Doesn&#39;t this mean that the element (supertype) will have transitive dependency towards the concrete elements?</p><p>Does the supertype knowing about the subtypes for violate the LSP [for the purpose of deciding on what behavior to do]? or is this a naive understanding of the principle?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Neither &#34;transitive dependency towards the concrete elements&#34; nor &#34;supertype knowing about the subtypes&#34; leads to a conclusion of LSP being violated. The first one is harmless. The second one is merely a smoking gun.</p><hr/><p>Visitor pattern can be used for several purposes. Judging from the way this question is asked, this answer will put the focus on the case of Double Dispatch.</p><p><em>Visitor pattern might also be used for other purposes. The possibility of those other purposes violating OCP or LSP is practically nil; therefore they will not be discussed in this answer.</em></p><hr/><p>In cases where the Visitor pattern is used to implement Double Dispatch (or equivalently to get around the lack of double dispatch in OOP languages), it is often said to be incompatible with Open/Closed Principle (OCP), although generally we can&#39;t say much about whether it violates Liskov Substitution Principle (LSP) unless there is an implementation mistake.</p><p><a href="https://lostechies.com/derekgreer/2010/04/19/double-dispatch-is-a-code-smell/">This article on Double Dispatch</a> explains it better than I do.</p><p>An example of double dispatch is that you have one inheritance hierarchy of <code>Shape</code>, and then a different inheritance hierarchy of <code>Display</code> (or <code>ISurface</code> in the article linked above). The project requires an implementation of a polymorphic method, whose behavior varies with both the concrete <code>Shape</code> subtype and the concrete <code>Display</code> subtype. If you have 3 concrete <code>Shape</code> subtypes and 5 concrete <code>Display</code> subtypes, this requires 15 concrete implementations of the polymorphic method, i.e. it is a <a href="https://en.wikipedia.org/wiki/Cartesian_product">Cartesian product</a> of implementations.</p><p>The most widely used OOP languages do not support Double Dispatch out-of-the-box. There are several ways to get around this; using the Visitor pattern is one way.</p><p>However, <strong>using the Visitor pattern to achieve Double Dispatch</strong> requires you to <strong>lock down one of the two inheritance hierarchies</strong>: you will not be able to add support for new subtypes to the locked-down inheritance hierarchy anymore (<em>without modifying the supertype/interface</em>). Using the above example, you have to choose either: (1) lock down the <code>Shape</code> hierarchy, or (2) lock down the <code>Display</code> hierarchy. This breaks the &#34;open for extension&#34; part of the OCP.</p><p>If the nature of one of the inheritance hierarchy is that it is &#34;complete&#34;, i.e. there will never be a future necessity to add any new subtypes to that hierarchy, then locking it down is not an issue, so it does not violate OCP.</p><p>There is an alternative implementation of Double Dispatch that does not break OCP, i.e. that will allow adding new subtypes to both the <code>Shape</code> and <code>Display</code> inheritance hierarchies, without modifying existing code. However, this alternative implementation does require checking the concrete types of both arguments via <code>instanceof</code>.</p><p>Some would argue that checking the concrete argument types with <code>instanceof</code> is itself an antipattern, or a smell, or something undesirable. This is somewhat an exaggeration of the original opinions held by Java mentors, which was to <a href="https://www.artima.com/interfacedesign/PreferPoly.html"><em>prefer</em> polymorphism over instanceof and downcasting</a>, not to outright forbid it even when necessitated by software requirements.</p><hr/><p>This brings up another discussion. In light of <a href="http://www.agilemanifesto.org/">agile methodology</a>, it is often the case that new software requirements necessitate code changes to certain parts of the project that were once considered immutable. In other words, breaking changes are sometimes needed.</p><p>From this perspective, the Open/Closed Principle (OCP) itself often came up as being too rigid/inflexible.</p><p>In the past, violation of OCP will cause harm to compiled libraries (binaries) which are then packaged and shipped. Propagating breaking changes in upstream dependencies often has a ripple effect that result in a large number of compiled libraries to be updated.</p><p>Agile methodology intends to solve this issue with:</p><ul><li>Versioning (leave the old system in place, but introduce the new system as an alternative, while making both available to customers)</li><li>Continuous integration (literally, recompile everything, every time)</li><li>Open source (customers can see and modify the source code inside dependencies)</li></ul><hr/><p>Agile methodology also views violations of Liskov Substitution Principle in a different way. Instead of branding a violation as a sign that the system or design is unsafe or having questionable correctness, it is merely seen as being a <strong>pain point</strong>. So, a LSP violation is not a death knell, but is a bad mark that adds up.</p><p>There are plenty of new software requirements which require the violation of LSP. In the past, such feature requests will be rejected on the grounds of correctness. Nowadays, it will be given business considerations. If a violation of LSP is accepted, then it shall be properly documented.</p><p>The additional cost of documenting an LSP violation, the displeasure of a programmer caught by the astonishment of software breakage (due to not heeding the documented warning), and the software maintenance and support overhead stemming from such breakage, are seen as business costs that are weighted against the business gains from implementing the requested feature.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../object-oriented-is-liskov-substitution-principle-incompatible-with-introspection-or-duck-typing/'>Object-oriented &#8211; Is Liskov Substitution Principle incompatible with Introspection or Duck Typing</a></li><li class="list-group-item"><a href='../java-does-the-state-pattern-violate-liskov-substitution-principle/'>Java &#8211; Does the state Pattern violate Liskov Substitution Principle</a></li><li class="list-group-item"><a href='../object-oriented-does-this-decorator-implementation-violate-the-liskov-substitution-principle/'>Object-oriented &#8211; Does this Decorator implementation violate the Liskov Substitution Principle</a></li><li class="list-group-item"><a href='../object-oriented-do-special-cases-with-fallbacks-violate-the-liskov-substitution-principle/'>Object-oriented &#8211; Do special-cases with fallbacks violate the Liskov Substitution Principle</a></li><li class="list-group-item"><a href='../real-world-liskov-substitution-principle/'>Real World &#8211; Liskov Substitution Principle</a></li><li class="list-group-item"><a href='../object-oriented-liskov-substitution-principle-strengthening-preconditions/'>Object-oriented &#8211; Liskov Substitution principle &#8211; strengthening preconditions</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>