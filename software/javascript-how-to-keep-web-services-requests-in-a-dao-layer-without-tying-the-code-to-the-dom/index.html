<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Javascript &#8211; How to keep Web services requests in a DAO layer without tying the code to the DOM &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076415 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076415" class="post-1076415 software type-software status-publish hentry category-software tag-architectural-patterns tag-javascript tag-node-js tag-web-services"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Javascript &#8211; How to keep Web services requests in a DAO layer without tying the code to the DOM</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">architectural-patterns</span><span class="mr-2 badge badge-info">javascript</span><span class="mr-2 badge badge-warning">node.js</span><span class="mr-2 badge badge-primary">web services</span></p><div class="entry-content"><p>I&#39;m working on a single page application on the <a href="https://github.com/rogerwang/node-webkit" rel="nofollow">node-webkit desktop app platform</a>, which means 99.9% of all of the logic is written in JavaScript. Since this is a reboot of a project we&#39;re working on, I wanted to approach the architecture from more of an MVC approach on the client side.</p><p>I&#39;m planning on creating a DAO layer for access to localStorage, IndexedDB, as well as Web services via REST requests. The problem is, the first tool I reach for to make HTTPS requests to the server is jQuery AJAX. It feels a bit weird to use jQuery in the DAO layer, even though I don&#39;t plan to manipulate the DOM, but it works really well on node-webkit and is a tried and tested tool for retrieving and sending data to the servers.</p><p>Despite the popularity of certain JavaScript application frameworks that have a certain <em>way</em> of doing things, we&#39;re not planning on using any frameworks other than JavaScript libraries that are fairly lightweight and unobtrusive, such as jQuery, Underscore, Mustache, Node.js modules, but nothing that forces us to unequivocally exclude certain technologies.</p><p>I&#39;m planning to inject jQuery into the DAO layer for the purposes of making calls via AJAX to the Web services. My question is this:</p><ul><li>How should I approach Web services? Do I treat Web services as just another data source like the local database?</li><li>Or do I just simply use the raw XMLHttpRequest object? What&#39;s the proven method for dealing with this architectural problem on the client side, <strong><em>without JavaScript frameworks</em></strong>?</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>Treat Web services the same as any other data access:</strong></p><p>To approach client side MVC architecture, without frameworks, we treated Web services in the same manner as we did localStorage and the local IndexedDB database. All code that involves requests to remote servers or that query a database or that read/write to localStorage happen in the model layer as DAO objects.</p><p>These were written using either the prototype pattern, the module pattern, or in some cases a combination of the two, using a modified factory pattern to treat objects as singletons in production but allowing us to &#34;reset&#34; them when unit testing so we keep tests self-contained.</p><p>They&#39;re generalized so that no application logic exists in this layer, and most of the code at this level can essentially be reused across future applications.</p><p>The services layer encapsulates the DAO layer, keeping the specific storage technology separate from the controller logic. Thus, pushing data to a remote server is seen as the same as inserting data into IndexedDB.</p><p><strong>Used raw XMLHttpRequest to interface with Web services:</strong></p><p>We chose not to use jQuery AJAX. Instead, we wrote a wrapper around XMLHttpRequest. There&#39;s no right or wrong answer here, but choosing not to use jQuery here allows us to stay focused on the rule of having no DOM manipulations in this layer. By wrapping the AJAX logic inside a prototype class, we set certain default headers, since most of what Web services deals with in our case is application/json data.</p><p>However, we did make an exception for jQuery Deferred. It didn&#39;t seem to make sense to write our own Observer implementation simply to be purists, and our logic behind this decision is that future professional programmers who work on this project with us have a better chance of understanding $.Deferred than some hand-rolled implementation. Many developers, on the other hand, we argued would have been exposed to XMLHttpRequest at some point in time, so being a purist here seemed less risky from the perspective of communicating to other developers what a piece of code does.</p><p><strong>Analysis:</strong></p><p>Earlier, I mentioned rules. We wrote up a series of &#34;rules&#34; designed to keep the code maintainable. For instance, rule #1 is that jQuery DOM manipulations only happen in a &#34;view&#34; layer. So the only jQuery we use in other layers is the $.Deferred object and nothing else.</p><p>We use $.Deferred throughout the application to keep certain logic in the layers where that belongs. For instance, we keep a persistent $.Deferred observer in the DOM click handlers in order to &#34;notify&#34; the controller that a click event has occurred so the controller can then delegate to other layers of the application to get/set, fetch/store, or perform other actions.</p><p>Using TDD as a development methodology, we&#39;ve created small functions, where the largest is never more than a page, and most layers have a great deal of test coverage.</p><p>After a few months, the jury is still out on whether we should have used a framework, as much of what we&#39;ve done could be generalized further into a reusable framework. We&#39;ve learned quite a bit trying this, and I&#39;m hoping this experience helps others who wish to develop client-side applications that involve a lot of asynchronous operations.</p><p><strong>To give credit where it&#39;s due, I took inspiration from the following people:</strong></p><ul><li>Ben Nadel&#39;s article on <a href="http://www.bennadel.com/blog/2379-a-better-understanding-of-mvc-model-view-controller-thanks-to-steven-neiland.htm" rel="nofollow">A Better Understanding of MVC Model View Controller</a></li><li>My colleague <a href="https://github.com/varunvairavan?tab=repositories" rel="nofollow">Varun Vairavan</a>, who has written some tools for AngularJS and node-webkit, and who was heavily involved in many of these technical decisions based on his experiences with Backbone.js and AngularJS.</li><li>Joel Spolsky&#39;s <a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html" rel="nofollow">Law of Leaky Abstractions</a>, which we personally dealt with when using a specific JavaScript framework.</li><li>Ben Nadel&#39;s <a href="http://www.bennadel.com/blog/2311-using-jquery-deferred-to-create-compound-objects-from-multiple-asynchronous-data-sources.htm" rel="nofollow">Using jQuery Deferred To Create Compound Objects From Multiple Asynchronous Data Sources</a></li></ul><p>For further reading on going framework-less, see Joe Gregorio&#39;s <a href="http://bitworking.org/news/2014/05/zero_framework_manifesto" rel="nofollow">Zero Framework Manifesto</a></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../javascript-combination-of-asp-net-server-side-html-js-jquery-client-side/'>Javascript &#8211; Combination of asp.net server side + html/js/jQuery client side</a></li><li class="list-group-item"><a href='../java-microservices-architecture-separating-backend-and-front-end/'>Java &#8211; Microservices Architecture separating backend and front end</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>