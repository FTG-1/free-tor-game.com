<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Is using protected inheritance to hide (but exploit) implemented interface from the public ok &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087193 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087193" class="post-1087193 software type-software status-publish hentry category-software tag-c tag-design tag-inheritance tag-interfaces tag-object-oriented-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Is using protected inheritance to hide (but exploit) implemented interface from the public ok</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">inheritance</span><span class="mr-2 badge badge-primary">interfaces</span><span class="mr-2 badge badge-danger">object-oriented-design</span></p><div class="entry-content"><p>Recently, we had a discussion about code using protected inheritance in order to hide the fact (to client code) a class inherits from a specific base class but to exploit this fact in the implementation.</p><p>The following code demonstrates this. It compiles with recent versions of GCC and clang++ (it uses C++11 features):</p><pre class="lang-cpp prettyprint-override"><code>#include &lt;vector&gt;
#include &lt;iostream&gt;

class IObserver
{
public:
    virtual void update() = 0;
};

class Model
{
    std::vector&lt;IObserver*&gt; m_observers;
    int m_number = 0;
public:
    void addObserver(IObserver&amp; observer) {
        m_observers.push_back(&amp;observer);
    }
    void setNumber(int value) {
        m_number = value;
        notifyObservers();
    }
    int number() const {
        return m_number;
    }
protected:
    void notifyObservers() {
        for (auto pObserver : m_observers)
            pObserver-&gt;update();
    }
};

// We want to hide the fact class &#39;View&#39; has &#39;IObserver&#39; interface.
class View : protected IObserver
{
    Model* m_pModel;
public:
    View(Model&amp; model) : m_pModel(&amp;model) {
        model.addObserver(*this); // Exploit the fact we are an &#39;IObserver&#39;.
    }
protected:
    void update() override {
        std::cout &lt;&lt; m_pModel-&gt;number() &lt;&lt; std::endl;
    }
};

int main(int argc, char *argv[])
{
    Model model;
    View view(model);

    //view.update(); // ERROR: &#39;update&#39; is a protected member of &#39;View&#39;.

    model.setNumber(1);
    model.setNumber(2);
}
</code></pre><p>The &#39;View&#39; class inherits &#39;IObserver&#39; interface but uses &#39;protected&#39; modifier. So correspondingly, the public method &#39;update&#39; inherited from that interface is protected. In the constructor, class &#39;View&#39; adds itself as an observer to the &#39;Model&#39; instance passed in as a parameter. Running the executable will output &#39;1&#39; and &#39;2&#39; in two separate lines, so the code runs as expected.</p><p>Now this solution was intensely discussed in our team but in the end there were some questions we could not answer with a common agreement:</p><ol><li><strong>Is this code actually legal w.r.t. to the C++ standard?</strong> The issue here is that, in the constructor, the &#39;View&#39; class passes a reference to itself to method &#39;Model::addOberver&#39; which expects a reference to an &#39;IObserver&#39; instance with a public &#39;update&#39; method. However, as the &#39;View&#39; class uses protected inheritance, this method now is protected. So when &#39;Model::notifyObservers&#39; method is called within &#39;Model::setNumber&#39; method, the View&#39;s &#39;update&#39; method will be called &#34;from outside&#34; in spite of the fact it is actually protected. (The <a href="http://www.parashift.com/c++-faq-lite/prot-vs-priv-inherit.html" rel="noreferrer">C++ FAQ Lite</a> states: <em>&#34;[protected inheritance] allows derived classes of the protected derived class to <strong>exploit</strong> the relationship to the protected base class&#34;</em>. So this sounds like the code above is a corresponding use case.)</li><li><strong>Assumed it is legal code, is it also good design?</strong> The fact we discussed a lot and didn&#39;t come to a common agreement might be a hint that it is not. Some of our colleagues had the opinion that a class&#39; interface is solely defined by its public methods. And if &#39;View&#39; class wants to pass a reference to itself to a method expecting an &#39;IObserver&#39; instance it must use public inheritance. Some others (including myself) didn&#39;t agree with this strict definition. The implementation knows about the fact it has (and can provide) an &#39;IObserver&#39; interface, so why should it not exploit this knowledge and expose the protected interface to code it wants to? In C++ we are able to define both, a public interface for &#34;normal&#34; client code and a protected interface for client code that wants to specialize/extend the class. So from this point of view, a class&#39; interface is defined by its public <strong>and</strong> its protected interface. It just depends on which kind of client code &#34;looks at&#34; a class&#39; interface.</li><li><strong>If the goal is to hide away &#39;IObserver&#39; interface from the public, is using the <a href="http://en.wikibooks.org/wiki/More_C++_Idioms/Handle_Body#Pointer_To_Implementation_.28pImpl.29" rel="noreferrer">pImpl idiom</a> solely for this purpose worth it?</strong> Because we were not able to come to a common conclusion regarding the first two questions we decided to &#34;workaround&#34; them by using the pImpl idiom and public inheritance in the implementation class. So we now have a class &#39;View&#39; that does not inherit from &#39;IObserver&#39; class at all. Instead, a class &#39;ViewImpl&#39; now inherits from &#39;IObserver&#39; publicly. While we agreed that this is &#34;good design&#34; it made our implementation more complex, we have one indirection more, and we now have to maintain nearly twice as much code. Furthermore, we need to maintain inheritance hierarchies for both, the public and the implementation classes. (Of course, these are well-known drawbacks from using the pImpl idiom.)</li></ol><p>I appreciate your opinions regarding these three questions a lot!!! So many thanks in advance ðŸ™‚</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><ol><li><p>We can establish that it is legal (i.e. valid) C++ because it compiles.  You&#39;ve used it on GCC and clang and I&#39;ve done exactly same thing with MSVC++ so that covers the majority of the compiler market.</p></li><li><p>This is why protected/private (btw, I would use private) modifier was introduced. It allows your class to implement callback interfaces which are needed for other classes it is using internally, but a) the rest of the world doesn&#39;t need to know that you are using those other classes and b) the rest of the world should not be able to even call on any of those functions because they are meant to be hidden and used only by internals.</p><p>When I transitioned from C++ to C#, I actually felt weird that I couldn&#39;t have private interface inheritance.  If something is an implementation detail and not intended to be seen/used by the public, it should be kept hidden and I think the method you described is a great and simple way of doing that.</p></li><li><p>Using pImpl just generates more overhead. When you allocate your objects (obviously assuming dynamic allocation), you end up going to the heap twice as many times. You also reduce the locality of your code because now View and ViewImpl might be in different pages in memory and will cause more cache misses. And you&#39;ve increased the amount of boiler plate code you have to write because now you are forwarding all public interface calls from the View to ViewImpl.</p></li></ol><p>This is all just my opinion but in the end, I cannot think of any reason not to have private interface inheritance.  I&#39;ve written code like this for 6+ years and never had any readability/maintainability problems because of it.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-observer-pattern-knowing-what-changed/'>C++ &#8211; Observer pattern; knowing *what* changed</a></li><li class="list-group-item"><a href='../c-code-re-use-in-c-via-multiple-inheritance-or-composition-or/'>C++ &#8211; Code re-use in C++, via multiple inheritance or composition? Or&#8230;</a></li><li class="list-group-item"><a href='../is-dependency-inversion-a-valid-alternative-to-the-pimpl-idiom/'>Is Dependency Inversion a valid alternative to the pImpl idiom</a></li><li class="list-group-item"><a href='../coding-to-interfaces-vs-abstract-inheritance/'>Coding to Interfaces vs Abstract Inheritance</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>