<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>IoC, Unity and passing parameters (or a way to avoid doing so) &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077532 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077532" class="post-1077532 software type-software status-publish hentry category-software tag-inversion-of-control"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">IoC, Unity and passing parameters (or a way to avoid doing so)</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">inversion-of-control</span></p><div class="entry-content"><p>While the concept of IoC isn&#39;t foreign to me, I&#39;m new to Unity and I&#39;m having trouble connecting the metaphorical dots, so to speak.</p><p>In our project we have a class library for logic, then several class libraries with repositories implementing common interfaces (they provide access and allow CRUD operations on different data sources). Finally, this is all used together in either an MVC web site or a SharePoint site.</p><p>We wanted to implement Unity to keep a single configuration and make the whole thing better.</p><p>But&#8230; there are some design issues I&#39;m facing. For example &#8211; the MVC web site, as far as communicating with the underlying SQL database is concerned, can have everything it needs specified in the configuration section for the Unity container. However, said web site also needs to occasionally connect with SharePoint&#8230; in order to create a SharePoint repository, I need to create an <code>SPWeb</code> object and pass it to the repository constructor.</p><p>I CAN do that using <code>ParameterOverride</code> when resolving the type, but this doesn&#39;t&#8230; feel right. There are cases where a larger number of parameters need to overridden this way; to resolve a logic class I need to pass repositories, which in turn are resolved by passing a manually created <code>SPWeb</code> object&#8230; When this happens it seems I&#39;m no longer following an IoC pattern. The kicker here is that I cannot have the <code>SPWeb</code> object defined in the Unity container!</p><p>Is there a pattern (a practical example would be superb) where Unity is used but certain values are being passed TO the container while resolving types, without the need to use <code>ParameterOverride</code>?</p><hr/><p><strong>EDIT</strong></p><p>I feel I need to provide a more specific example of why <code>ParameterOverride</code> is a problem. Below is a fragment of code used by a SharePoint timer job. The job in question synchronizes some data between SharePoint and SQL, so it requires two different repositories implementing the same interface. Because the code is ran from SharePoint, it cannot access a global configuration defined <code>DataContext</code> (EntityFramework, code-first) because there&#39;s no <code>web.config</code> file to read the connection string from. Also, due to the weirdness that is SharePoint, I cannot &#34;get&#34; the current <code>SPWeb</code> object, and instead need to create it on the fly.</p><p>The end result is a ton on <code>using</code> statements, and a lot of parameters need to overridden when using <code>Resolve</code>. Also, the need to pass the parameter NAME as a string would make this really difficult to code for anyone else &#8211; this information isn&#39;t known from the interface alone.</p><pre><code>    public override void Execute(Guid targetInstanceId)
    {
        var siteUrl = Properties[&#34;Site&#34;] as string;
        var sqlConnection = Properties[&#34;SQL&#34;] as string;
        if (String.IsNullOrEmpty(siteUrl))
            throw new ArgumentNullException(&#34;Site URL is missing.&#34;);
        if (String.IsNullOrEmpty(sqlConnection))
            throw new ArgumentNullException(&#34;SQL connection string is missing.&#34;);

        using (var site = new SPSite(siteUrl, SPUserToken.SystemAccount))
        using (var web = site.OpenWeb())
        using (var spPollRepository = Configuration.ServiceLocator.SharePointContainer.Container.Resolve&lt;IPollRepository&gt;(new ParameterOverride(&#34;web&#34;, web)))
        using (var ctx = Configuration.ServiceLocator.SharePointContainer.Container.Resolve&lt;Repositories.PollsDataContext&gt;(Configuration.ServiceLocator.SqlNamedRegistration, new ParameterOverride(&#34;nameOrConnectionString&#34;, sqlConnection), new ParameterOverride(&#34;initialize&#34;, false)))
        using (var sqlPollRepository = Configuration.ServiceLocator.SharePointContainer.Container.Resolve&lt;IPollRepository&gt;(Configuration.ServiceLocator.SqlNamedRegistration, new ParameterOverride(&#34;ctx&#34;, ctx)))
        {
            IPollsSyncLogic logic = Configuration.ServiceLocator.SharePointContainer.Container.Resolve&lt;Logic.IPollsSyncLogic&gt;(new ParameterOverride(&#34;sqlRepository&#34;, sqlPollRepository), new ParameterOverride(&#34;spRepository&#34;, spPollRepository));
            logic.SyncPolls();
        }
    }
</code></pre><p>There&#39;s a big chance I&#39;m using Unity&#8230; wrong. Or that some other fundamental definition has been mixed up. I hope this clears up any confusion regarding the question.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>If the entities returned by the SharePoint repository are specific, just create a <code>[TheEntity]Repository</code> interface with a single implementation that talks to SharePoint.</p><p>If the <code>[TheEntity]Repository</code> interface has two implementations that talk respectively to SharePoint and a SQL database, you could use <a href="https://stackoverflow.com/questions/5004306/how-to-conditionaly-bind-a-instance-depending-on-the-injected-type-using-unity">ResolvedParameters</a> at configuration time (not <em>Overrides at resolve time</em>) to inject the right concrete repository depending on the type that is being injected into.</p><p><strong>Edit</strong></p><p>Seeing the code you posted, the big flaw is that you would like to use IOC and abstract repositories, but this is ruined by the fact that <code>IPollsSyncLogic</code> perfectly knows about Sql and Sharepoint, since its constructor has two parameters explicitly named sqlRepository and spRepository.</p><p>You should either</p><ul><li>Fully embrace the specificity of <code>IPollsSyncLogic</code> as an SP to SQL synchronizer by using explicit SQL and SP repository types in its constructor signature.</li></ul><p>or</p><ul><li>Make <code>IPollsSyncLogic</code> a more abstract synchronizer between any two implementations of the same repository interface. In that case, just name its constructor parameters something like <code>repositorySource</code> and <code>repositoryTarget</code>. In your IoC configuration, use an InjectionFactory to specify the two concrete repository types.</li></ul><p>As a side note, you should avoid resorting to <code>Container.Resolve</code> and rely on automatic resolution based on configuration when possible, because discrete calls to the container are usually hidden dependencies. For dependencies that are part of <code>using</code> statements and can&#39;t be injected through a constructor, you can rely on a Factory that produces them on the fly.</p><p>Regarding your problem with SharePoint accessing <code>DataContext</code>, I think it deserves a separate question.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../sell-me-on-ioc-containers-please/'>Sell me on IoC containers, please</a></li><li class="list-group-item"><a href='../c-i-get-dependency-injection-but-can-someone-help-me-understand-the-need-for-an-ioc-container/'>C# &#8211; I get dependency injection, but can someone help me understand the need for an IoC container</a></li><li class="list-group-item"><a href='../c-ioc-between-presentation-and-infrastructure-layer/'>C# &#8211; IOC Between Presentation and Infrastructure Layer</a></li><li class="list-group-item"><a href='../how-is-inversion-of-control-related-to-dependency-inversion/'>How is Inversion of Control related to Dependency Inversion</a></li><li class="list-group-item"><a href='../c-service-locator-anti-pattern-alternative/'>C# &#8211; Service-locator anti-pattern alternative</a></li><li class="list-group-item"><a href='../c-dependency-injection-for-a-library-with-internal-dependencies/'>C# &#8211; Dependency injection for a library with internal dependencies</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>