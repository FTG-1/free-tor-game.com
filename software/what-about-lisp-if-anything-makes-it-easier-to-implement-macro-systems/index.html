<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>What about LISP, if anything, makes it easier to implement macro systems &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075459 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075459" class="post-1075459 software type-software status-publish hentry category-software tag-common-lisp tag-lisp tag-macros tag-scheme tag-templates"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">What about LISP, if anything, makes it easier to implement macro systems</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">common-lisp</span><span class="mr-2 badge badge-info">lisp</span><span class="mr-2 badge badge-warning">macros</span><span class="mr-2 badge badge-primary">scheme</span><span class="mr-2 badge badge-danger">templates</span></p><div class="entry-content"><p>I&#39;m learning Scheme from the <em>SICP</em> and I&#39;m getting the impression that a big part of what makes Scheme and, even more so, LISP special is the macro system. But, since macros are expanded at compile-time, why don&#39;t people make equivalent macro systems for C/Python/Java/whatever? For example, one could bind the <code>python</code> command to <code>expand-macros | python</code> or whatever. The code would still be portable to people who don&#39;t use the macro system, one would just expand the macros before publishing code. But I don&#39;t know of anything like that except templates in C++/Haskell, which I gather aren&#39;t really the same. What about LISP, if anything, makes it easier to implement macro systems?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Many Lispers will tell you that what makes Lisp special is <em>homoiconicity</em>, which means that the code&#39;s syntax is represented using the same data structures as other data. For example, here&#39;s a simple function (using Scheme syntax) for calculating the hypotenuse of a right-angled triangle with the given side lengths:</p><pre><code>(define (hypot x y)
  (sqrt (+ (square x) (square y))))
</code></pre><p>Now, homoiconicity says that the code above is actually representable as a data structure (specifically, lists of lists) in Lisp code. Thus, consider the following lists and see how they &#34;glue&#34; together:</p><ol><li><code>(define #2# #3#)</code></li><li><code>(hypot x y)</code></li><li><code>(sqrt #4#)</code></li><li><code>(+ #5# #6#)</code></li><li><code>(square x)</code></li><li><code>(square y)</code></li></ol><p>Macros allow you to treat the source code as just that: lists of stuff. Each of those 6 &#34;sublists&#34; contain either pointers to other lists, or to symbols (in this example: <code>define</code>, <code>hypot</code>, <code>x</code>, <code>y</code>, <code>sqrt</code>, <code>+</code>, <code>square</code>).</p><hr/><p>So, how can we use homoiconicity to &#34;pick apart&#34; syntax and make macros? Here&#39;s a simple example. Let&#39;s reimplement the <code>let</code> macro, which we&#39;ll call <code>my-let</code>. As a reminder,</p><pre><code>(my-let ((foo 1)
         (bar 2))
  (+ foo bar))
</code></pre><p>should expand into</p><pre><code>((lambda (foo bar)
   (+ foo bar))
 1 2)
</code></pre><p>Here&#39;s an implementation using Scheme &#34;explicit renaming&#34; macros<sup>†</sup>:</p><pre><code>(define-syntax my-let
  (er-macro-transformer
    (lambda (form rename compare)
      (define bindings (cadr form))
      (define body (cddr form))
      `((,(rename &#39;lambda) ,(map car bindings)
          ,@body)
        ,@(map cadr bindings)))))
</code></pre><p>The <code>form</code> parameter is bound to the actual form, so for our example, it would be <code>(my-let ((foo 1) (bar 2)) (+ foo bar))</code>. So, let&#39;s work through the example:</p><ol><li>First, we retrieve the bindings from the form. <code>cadr</code> grabs the <code>((foo 1) (bar 2))</code> portion of the form.</li><li><p>Then, we retrieve the body from the form. <code>cddr</code> grabs the <code>((+ foo bar))</code> portion of the form. (Note that this is intended to grab all the subforms after the binding; so if the form were</p><pre><code>(my-let ((foo 1)
         (bar 2))
  (debug foo)
  (debug bar)
  (+ foo bar))
</code></pre><p>then the body would be <code>((debug foo) (debug bar) (+ foo bar))</code>.)</p></li><li>Now, we actually build the resultant <code>lambda</code> expression and call using the bindings and body we have collected. The backtick is called a &#34;quasiquote&#34;, which means to treat everything inside the quasiquote as literal datums, <em>except</em> the bits after the commas (&#34;unquote&#34;).<ul><li>The <code>(rename &#39;lambda)</code> means to use the <code>lambda</code> binding in force when this macro is <em>defined</em>, rather than whatever <code>lambda</code> binding might be around when this macro is <em>used</em>. (This is known as <em>hygiene</em>.)</li><li><code>(map car bindings)</code> returns <code>(foo bar)</code>: the first datum in each of the bindings.</li><li><code>(map cadr bindings)</code> returns <code>(1 2)</code>: the second datum in each of the bindings.</li><li><code>,@</code> does &#34;splicing&#34;, which is used for expressions that return a list: it causes the list&#39;s elements to be pasted into the result, rather than the list itself.</li></ul></li><li>Putting all that together, we get, as a result, the list <code>(($lambda (foo bar) (+ foo bar)) 1 2)</code>, where <code>$lambda</code> here refers to the renamed <code>lambda</code>.</li></ol><p>Straightforward, right? ;-) (If it&#39;s not straightforward for you, just imagine how difficult it would be to implement a macro system for other languages.)</p><hr/><p>So, you can have macro systems for other languages, if you have a way to be able to &#34;pick apart&#34; source code in a non-clunky way. There are some attempts at this. For example, <a href="http://sweetjs.org/">sweet.js</a> does this for JavaScript.</p><p>† For seasoned Schemers reading this, I intentionally chose to use explicit renaming macros as a middle compromise between <code>defmacro</code>s used by other Lisp dialects, and <code>syntax-rules</code> (which would be the standard way to implement such a macro in Scheme). I don&#39;t want to write in other Lisp dialects, but I don&#39;t want to alienate non-Schemers who aren&#39;t used to <code>syntax-rules</code>.</p><p>For reference, here&#39;s the <code>my-let</code> macro that uses <code>syntax-rules</code>:</p><pre><code>(define-syntax my-let
  (syntax-rules ()
    ((my-let ((id val) ...)
       body ...)
     ((lambda (id ...)
        body ...)
      val ...))))
</code></pre><p>The corresponding <code>syntax-case</code> version looks very similar:</p><pre><code>(define-syntax my-let
  (lambda (stx)
    (syntax-case stx ()
      ((_ ((id val) ...)
         body ...)
       #&#39;((lambda (id ...)
            body ...)
          val ...)))))
</code></pre><p>The difference between the two is that <em>everything</em> in <code>syntax-rules</code> has an implicit <code>#&#39;</code> applied, so you can <em>only</em> have pattern/template pairs in <code>syntax-rules</code>, hence it&#39;s fully declarative. In contrast, in <code>syntax-case</code>, the bit after the pattern is actual code that, in the end, has to return a syntax object (<code>#&#39;(...)</code>), but can contain other code too.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../python-choosing-between-cl-and-python-for-web-development/'>Python &#8211; Choosing between CL and Python for web development</a></li><li class="list-group-item"><a href='../how-useful-are-lisp-macros/'>How useful are Lisp macros</a></li><li class="list-group-item"><a href='../a-dotted-pairs-analogy-in-other-lisp-implementations/'>A dotted pair&#8217;s analogy in other Lisp implementations</a></li><li class="list-group-item"><a href='../what-are-the-typical-applications-of-lisp-macros/'>What are the typical applications of Lisp macros</a></li><li class="list-group-item"><a href='../would-rebol-or-red-benefit-from-lisp-style-macros/'>Would Rebol (or Red) benefit from Lisp-style Macros</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>