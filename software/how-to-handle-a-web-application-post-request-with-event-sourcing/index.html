<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to handle a web application POST request with event sourcing &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085234 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085234" class="post-1085234 software type-software status-publish hentry category-software tag-cqrs tag-event-sourcing tag-web-applications"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to handle a web application POST request with event sourcing</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">cqrs</span><span class="mr-2 badge badge-info">event-sourcing</span><span class="mr-2 badge badge-warning">web-applications</span></p><div class="entry-content"><p>I&#39;d like to ask for some help in understanding how event-sourcing systems are used when it comes to web applications and POST requests. I understand how events are stored and the event-driven architecture of eventual consistency. I understand CQRS etc, but I cannot imagine how an event store mechanism handles something like a HTML POST request when the web application in the browser has to return the changed state on the following page we&#39;re redirected to, meaning:</p><ol><li><p>I fill in a HTML form on a page to update some resource.</p></li><li><p>I press submit to POST the data to a web application.</p></li><li><p>An event is created with the data to update and the resource ID.</p></li><li><p>The event is raised and will be saved in the event store eventually.</p></li><li><p>The browser takes me to a different page in the web application.</p></li><li><p>I issue a query request to retrieve the updated resource (through replaying events) because I want to present the user with the latest state of the resource.</p></li><li><p>The query does not return the latest state because the eventual consistency hasn&#39;t taken place yet and the system still needs few milliseconds to update the event store.</p></li><li><p>I see the update never took place. The resource still looks the same.</p></li><li><p>The event store has saved the resource and now I can refresh the browser and see that the update has actually taken place.</p></li></ol><p>What I am missing, please? It seems that there&#39;s something really simple here, but I cannot see how a web application can work with event sourcing. Are we relying on the event-sourcing being faster than the web application and assuming that the data will always be consistent before the user hits the next page? Wouldn&#39;t that be a bit risky during heavy system use?</p><p>Thank you</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>The event is raised and will be saved in the event store eventually.</p></blockquote><p>That&#39;s wrong -- the event should be written into the event store immediately.  The edge case that you need to be careful of here is two conflicting writes being made concurrently -- if either of those writes fails, then the caller should be notified that the command failed, making them aware of the problem and allowing them to consider the appropriate strategy.</p><p>You are correct that the <em>read models</em> are updated eventually, rather than immediately, which introduces some challenges.</p><blockquote><p>What I am missing, please? It seems that there&#39;s something really simple here, but I cannot see how a web application can work with event sourcing. Are we relying on the event-sourcing being faster than the web application and assuming that the data will always be consistent before the user hits the next page? Wouldn&#39;t that be a bit risky during heavy system use?</p></blockquote><p>There are a couple of approaches to take.  One is, as you described POST-REDIRECT-GET.  But we get a bit more clever about the resource that is the target of the redirection.  Rather than redirecting to an arbitrary &#34;latest&#34; endpoint, we instead redirect to an endpoint that can identify where in event stream we should be</p><pre><code>/foo?asOf={sequenceNumber}
</code></pre><p>Then that endpoint can block, waiting for the event to show up, or it can pro-actively create a new representation of the resource by fetching the history from the event store, or....  There are a lot of variations, but they all start from thinking about being specific about where in the history you want the representation to be created from.</p><p>(Depending on your needs, the implementation might return a representation, or might redirect to a representation once the results are available.  You might be wanting to return a representation at that exact point in the history, or at any convenient point after.)</p><p>Another alternative is to construct a representation in the POST handler.  The application just updated the event stream successfully, so it has all of the events in the history up to that point.  You can pass that history to a bit of code that knows how to generate the view (possibly reading in other histories from the write model, or cached copies from the read model).</p><p>Another approach, useful in some circumstances, is to just return the events themselves, and let the caller reconstruct the view they expect.  This approach might make sense if you were writing a single page app, you let the app update its own non-authoritative copy of the model, and work from there.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-handle-duplicate-events-when-replaying-event-store/'>How to handle duplicate events when replaying event store</a></li><li class="list-group-item"><a href='../how-to-implement-a-process-manager-in-event-sourcing/'>How to implement a process manager in event sourcing</a></li><li class="list-group-item"><a href='../how-to-deal-with-side-effects-in-event-sourcing/'>How to deal with side effects in Event Sourcing</a></li><li class="list-group-item"><a href='../cqrs-event-sourcing-how-to-process-events-in-the-expected-order-inside-the-read-model/'>CQRS-Event Sourcing: how to process events in the expected order inside the read model</a></li><li class="list-group-item"><a href='../what-are-the-problems-with-command-handlers-returning-data-in-cqrs/'>What are the problems with command handlers returning data in CQRS</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>