<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Having an inherited function return the derived type instead of the base type &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1065095 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1065095" class="post-1065095 software type-software status-publish hentry category-software tag-c tag-inheritance tag-type-casting"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Having an inherited function return the derived type instead of the base type</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">inheritance</span><span class="mr-2 badge badge-warning">type casting</span></p><div class="entry-content"><p>I am writing two classes in C#:</p><ul><li>A <code>Matrix</code> class that represents a general Matrix with n-by-m dimensions</li><li>A <code>SquareMatrix</code> class that inherits from <code>Matrix</code> and has the constraint of being n-by-n</li></ul><p>The reason I designed it this way is because square matrices support additional specific operations like calculating the determinant or the inverse, so being able to guarantee that those functions are avaliable with the specific type you&#39;re using are nice things to have. Additionally it would support all the regular Matrix operations and can be used as a Matrix</p><p>I have a function in <code>Matrix</code> called <code>getTranspose()</code>. It calculates the transpose of the Matrix and returns it as a new <code>Matrix</code></p><p>I inherited it in <code>SquareMatrix</code>, but because the transpose of a square matrix is guaranteed to be square matrix, I also want it to return a <code>SquareMatrix</code></p><p>I am unsure about the best way to do this.</p><ul><li>I can re-implement the function in <code>SquareMatrix</code>, but that would be code duplication because it&#39;s essentially the same calculation</li><li>I can use implicit typecast operators, but if I understand correctly that would cause unnecessary allocations (upcast <code>SquareMatrix</code> to <code>Matrix</code>, create a new <code>Matrix</code> as the transpose, create a new <code>SquareMatrix</code> during typecasting and throw away the tranposed <code>Matrix</code>)</li><li>I can use explicit typecast operators, but it would be stupid to have to typecast the transpose of a <code>SquareMatrix</code> explicitly, and it also has the same problem of the implicit operator with unnecessary allocations</li></ul><p>Is there another option? Should I change the design of having <code>SquareMatrix</code> inherit from <code>Matrix</code>?</p><p>This problem also applies to operators. It seems that I have to either implement typecasting operators which might cost in performance, or have to re-implement the same code.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Inheritance not helping to eliminate repetition and typecasts is often a sign that generics would help.  You can do something like:</p><pre><code>public T getTranspose&lt;T&gt;()
// or non-member function
T getTranspose&lt;T&gt;(T input)
</code></pre><p>I haven&#39;t fully worked it out, but it seems it might get awkward on the calling side.  I know C# does some inference with generic methods, but I don&#39;t know C#, so I&#39;m not familiar with the details.  That might be the way you have to go, though, if you want full compile-time type checking with the least amount of repetition in the implementation.</p><p>Another option would be to create private helper functions, then pass in the result type you want, for the helper to populate, like:</p><pre><code>public SquareMatrix getTranspose() {
    SquareMatrix result = new SquareMatrix();
    transposeHelper(result);
    return result;
}
</code></pre><p>This gives you more boilerplate on the implementation side, but at least it isn&#39;t full repetition.</p><p>A third option is just to check if the result is square in the <code>Matrix</code> implementation, and return a <code>SquareMatrix</code> if it is, like:</p><pre><code>public Matrix getTranspose() {
   Matrix result; 
   if (resultIsSquare())
        result = new SquareMatrix();
   else
        result = new Matrix();

   // calculate result
   return result;
}
</code></pre><p>This has the advantage of not needing any implementation at all for <code>getTranspose()</code> in <code>SquareMatrix</code>, but at the expense of requiring type checking of the return value at the call site.  It also works for cases like multiplying two non-square matrices that happen to give a square result.  You give up most compile-time type checking, though.</p><p>If your application happens to mostly require run-time instead of compile-time type checking anyway, you might as well just give up the different types and throw an exception if you call a method that a non-square matrix doesn&#39;t support.  I believe this is the approach most existing libraries take, especially since there are other conditions than being non-square that can cause methods like <code>inverse()</code> to fail.</p><p>Speaking of libraries, there are a lot of good ones out there for matrix math, that are already heavily tested and optimized.  Don&#39;t reinvent the wheel if you don&#39;t have to.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-how-to-create-a-common-interface-for-classes-with-different-subsets-of-members/'>C# &#8211; How to create a common interface for classes with different subsets of members</a></li><li class="list-group-item"><a href='../a-vector-of-pointers-to-different-derived-classes-of-the-same-base-class/'>A vector of pointers to different derived classes of the same base class</a></li><li class="list-group-item"><a href='../c-proper-design-to-avoid-the-use-of-dynamic_cast/'>C++ &#8211; Proper design to avoid the use of dynamic_cast</a></li><li class="list-group-item"><a href='../c-how-to-implement-an-opaque-handle-in-c/'>C# &#8211; How to implement an opaque handle in C#</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>