<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Rest &#8211; Stateful authentication in REST API using tokens &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075872 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075872" class="post-1075872 software type-software status-publish hentry category-software tag-asp-net-core tag-asp-net-mvc-web-api tag-authentication tag-rest tag-web-api"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Rest &#8211; Stateful authentication in REST API using tokens</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-core</span><span class="mr-2 badge badge-info">asp.net-mvc-web-api</span><span class="mr-2 badge badge-warning">authentication</span><span class="mr-2 badge badge-primary">rest</span><span class="mr-2 badge badge-danger">web-api</span></p><div class="entry-content"><p>I have recently started on a project involving a REST API. The API requires authentication with requirements for administrators to be able to view logged in users and to be able to revoke specific login-sessions immediately. The API is consumed primarily by a SPA and a native application.</p><p>During my search for existing implementations in ASP.NET Core 2x I am however having some trouble. It seems there are 4 main methods of authentication:</p><ol><li>Cookie-based</li><li>JSON Web Tokens</li><li>OAuth 1 and 2</li><li>3rd party services such as Microsoft, Google, Twitter etc.</li></ol><p>Due to the API being consumed by a native application cookie based authentication isn&#39;t viable. There is no requirement for integration with 3rd parties (such as Google), so that isn&#39;t an option either. Much like in the same way there is no requirement for the API to be consumed by an unknown number of 3rd party applications, which effectively rules out OAuth.</p><p>Now I am left with JSON Web Tokens, but&#8230; They also have issues. Mainly the requirement of immediate revocation of logins is important, however, this is not possible when using JWTs. A possible solution is maintaining a revocation list, but that defeats their stateless nature as each request to the API would need to check this list. But as this is not a large-scale application the stateless feature is unimportant at the moment. I can&#39;t use tokens with a short lifetime either as the requirement for immediate revocation doesn&#39;t work well with this. <a href="http://cryto.net/~joepie91/blog/2016/06/19/stop-using-jwt-for-sessions-part-2-why-your-solution-doesnt-work/" rel="nofollow noreferrer">Here is an article</a>, which perfectly explains my issues with JWTs as sessions.</p><p>So now we are at the big problem. There are no existing solutions supported out of the box in ASP.NET Core available.</p><p><strong>Question 1: Any alternatives or remarks of the previously mentioned issues, which would change the conclusion?</strong></p><p>I have searched the vast space that is the internet for anything, which would meet the requirements, but is unable to find anything else, but JWTs and OAuth&#8230; Everyone uses JWTs for everything it seems. So this has led me to what I feared: I need to write my own implementation üôÅ</p><p>The optimal solution would be:</p><ol><li>The client exchanges username/password for a random token</li><li>The client sends the token in the <code>Authorization</code> HTTP header much like JWT may do.</li><li>The token is used to fetch the user&#39;s <code>AuthenticationTicket</code> upon an incoming request and the token is verified.</li><li>Logouts or revocation removes the token (and effectively the <code>AuthenticationTicket</code>) in a centralized store</li></ol><p>Looking through the source code for the existing solutions for mainly <a href="https://github.com/aspnet/Security/tree/master/src" rel="nofollow noreferrer">JWT and Cookie</a> authentication in ASP.NET Core I realize I can reuse quite a bit of the existing implementations and integrate well with the framwork, but I would rather avoid writing anything security related myself.</p><p><strong>Question 2: Anyone know an implementation, which satisfies this flow or can be configured to?</strong></p><p>As a closing note. I know storing session state server-side is against pure REST principles, but I find this far more practical given the requirements. To overcome any scaling issues over a small number of containers I plan to use a centralized server (redis as an example) as cache/storage, which should be more than enough to handle the expected traffic several times over.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Question 1: Any alternatives or remarks of the previously mentioned
 issues, which would change the conclusion?</p></blockquote><p><strong>Cookies</strong> are just headers, your native client can add and read them them no problem. Not sure if the built in solution allows revocation though.</p><p><strong>JWT/OAuth</strong> The reason revocation isnt supported is to enable to idea that resources can validate the request without contacting a central server. Avoiding that bottleneck</p><p>However! <strong><em>any</em></strong> solution with immediate revocation will <strong><em>require</em></strong> that you validate on a central server.</p><p>Implementing this extra check is simple. eg with the IdentityModel nuget</p><pre><code>public class MyJwtSecurityTokenHandler : System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler
{
    public override ClaimsPrincipal ValidateToken(string token, TokenValidationParameters validationParameters, out SecurityToken validatedToken)
    {
       return  myAuthService.ValidateToken(token, validationParameters, out validatedToken);
    }
}
</code></pre><p>The auth server can keep track of issued tokens, expose a revoke endpoint and a LoggedInUsers endpoint. Just like the old MembershipProvider...</p><blockquote><p>Question 2: Anyone know an implementation, which satisfies this flow
 or can be configured to?</p></blockquote><p>You want an out of the box solution, MembershipProvider and getting your native client to understand cookies is probably the closest you will get. You could go for the Cookieless option, but having the token in the url is considered less secure and its probably hard to handle on the client anyway.</p><p>But with .net Core, I&#39;m unsure that it fulfils all your goals, and it&#39;s definitely swimming against the tide of JWT tokens with claims.</p><p>I would go with OAuth and JWT and program the revocation custom extras myself. Ensuring that I do validate the JWT normally as well as checking for revocation.</p><p>I would expect the requirement for logged in users and revocation to eventually be dropped and this would allow me to simply remove it.</p><p>In Fact, lets move the logged in users right out to a reporting component rather than auth, we can get better stats that way anyway</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-is-it-an-implementation-of-a-stateful-mechanism-for-rest-api-authentication/'>Rest &#8211; Is it an implementation of a stateful mechanism for Rest API authentication</a></li><li class="list-group-item"><a href='../rest-token-based-authentication-using-access-and-refresh-tokens/'>Rest &#8211; Token-based authentication using access and refresh tokens</a></li><li class="list-group-item"><a href='../architecture-integrate-web-api-services-with-multiple-authentication-services/'>Architecture &#8211; Integrate Web API Services with multiple authentication services</a></li><li class="list-group-item"><a href='../rest-api-authentication-cookie-vs-web-storage/'>REST API Authentication: Cookie vs Web Storage</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>