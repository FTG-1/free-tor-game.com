<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Javascript &#8211; How to keep code with continuations/callbacks readable &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075778 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075778" class="post-1075778 software type-software status-publish hentry category-software tag-async tag-coding-style tag-continuation tag-javascript"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Javascript &#8211; How to keep code with continuations/callbacks readable</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">async</span><span class="mr-2 badge badge-info">coding-style</span><span class="mr-2 badge badge-warning">continuation</span><span class="mr-2 badge badge-primary">javascript</span></p><div class="entry-content"><p>Summary: <strong>Are there some well-established best-practice patterns that I can follow to keep my code readable in spite of using asynchronous code and callbacks?</strong></p><hr/><p>I&#39;m using a JavaScript library that does a lot of stuff asynchronously and heavily relies on callbacks. It seems that writing a simple &#34;load A, load B, &#8230;&#34; method becomes quite complicated and hard to follow using this pattern.</p><p>Let me give a (contrived) example. Let&#39;s say I want to load a bunch of images (asynchronously) from a remote web server. In C#/async, I&#39;d write something like this:</p><pre><code>disableStartButton();

foreach (myData in myRepository) {
    var result = await LoadImageAsync(&#34;http://my/server/GetImage?&#34; + myData.Id);
    if (result.Success) {
        myData.Image = result.Data;
    } else {
        write(&#34;error loading Image &#34; + myData.Id);
        return;
    }
}

write(&#34;success&#34;);
enableStartButton();
</code></pre><p>The code layout follows the &#34;flow of events&#34;: First, the start button is disabled, then the images are loaded (<code>await</code> ensures that the UI stays responsive) and then the start button is enabled again.</p><p>In JavaScript, using callbacks, I came up with this:</p><pre><code>disableStartButton();

var count = myRepository.length;

function loadImage(i) {
    if (i &gt;= count) {
        write(&#34;success&#34;);
        enableStartButton();
        return;
    }

    myData = myRepository[i];
    LoadImageAsync(&#34;http://my/server/GetImage?&#34; + myData.Id,
        function(success, data) { 
            if (success) {
                myData.Image = data;
            } else {
                write(&#34;error loading image &#34; + myData.Id);
                return;
            }
            loadImage(i+1); 
        }
    );
}

loadImage(0);
</code></pre><p>I think the drawbacks are obvious: I had to rework the loop into a recursive call, the code that&#39;s supposed to be executed in the end is somewhere in the middle of the function, the code starting the download (<code>loadImage(0)</code>) is at the very bottom, and it&#39;s generally much harder to read and follow. It&#39;s ugly and I don&#39;t like it.</p><p>I&#39;m sure that I&#39;m not the first one to encounter this problem, so my question is: <strong>Are there some well-established best-practice patterns that I can follow to keep my code readable in spite of using asynchronous code and callbacks?</strong></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It&#39;s highly unlikely that you can achieve with plain js the same level of conciseness and expressiveness in working with callbacks that C# 5 has. The compiler does the work in writing all that boilerplate for you, and until the js runtimes will do that, you will still have to pass an occasional callback here and there.</p><p>However, you may not always want to bring callbacks down to the level of simplicity of linear code - throwing functions around doesn&#39;t have to be ugly, there&#39;s an <a href="http://en.wikipedia.org/wiki/Functional_programming" rel="nofollow">entire world</a> working with this kind of code, and they keep sane without <code>async</code> and <code>await</code>.</p><p>For instance, use higher-order functions (my js may be a bit  rusty):</p><pre><code>// generic - this is a library function
function iterateAsync(iterator, action, onSuccess, onFailure) {
var item = iterator();
if(item == null) { // exit condition
    onSuccess();
    return;
}
action(item,
    function (success) {
        if(success)
            iterateAsync(iterator, action, onSuccess, onFailure);
        else
            onFailure();
    });
}


// calling code
var currentImage = 0;
var imageCount = 42;

// you know your library function expects an iterator with no params, 
// and an async action with the current item and its continuation as params
iterateAsync(
// this is your iterator
function () {   
    if(currentImage &gt;= imageCount)
        return null;
    return &#34;http://my/server/GetImage?&#34; + (currentImage++);
},

// this is your action - coincidentally, no adaptor for the correct signature is necessary
LoadImageAsync,

// these are your outs
function () { console.log(&#34;All OK.&#34;); },
function () { console.log(&#34;FAILED!&#34;); }
);
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-blurring-the-lines-between-async-and-regular-functions-in-c-5-0/'>C# &#8211; Blurring the lines between async and regular functions in C# 5.0</a></li><li class="list-group-item"><a href='../java-is-the-c-async-task-construct-equivalent-to-javas-executor-future/'>Java &#8211; Is the C# async/Task construct equivalent to Java&#8217;s Executor/Future</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>