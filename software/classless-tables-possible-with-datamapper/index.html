<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Classless tables possible with Datamapper &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087602 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087602" class="post-1087602 software type-software status-publish hentry category-software tag-database-design tag-orm tag-ruby"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Classless tables possible with Datamapper</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database-design</span><span class="mr-2 badge badge-info">orm</span><span class="mr-2 badge badge-warning">ruby</span></p><div class="entry-content"><p>I have an Item class with the following attributes:</p><p><code>itemId,name,weight,volume,price,required_skills,required_items</code>.</p><p>Since the last two attributes are going to be multivalued, I  removed them and create new schemes like:</p><p><code>itemID,required_skill</code> (<code>itemID</code> is foreign key, <code>itemID and required_skill</code> is primary key.)</p><p>Now, I&#39;m confused how to create/use this new table. Here are the options that came to my mind:</p><p>1) The relationship between Items and Required_skills is one-to-many, so I may create a RequiredSkill class, which belongs_to Item, which in turn has n RequiredSkills. Then I can do <code>Item.get(1).requiredskills</code>. This sounds most logical to me and provides me methods and queries like:</p><pre><code>sugar.components.create :raw_material =&gt; water.name
sugar.components.create :raw_material =&gt; sugarcane.name
sugar.components
sugar.components.count
</code></pre><p>2) Since required_skills may well be thought of as constants (since they resemble rules), I may put them into a hash or gdbm database or another sql table and query from there, which I don&#39;t prefer.</p><p>My question is: is there something like a modelless table in datamapper, where datamapper is responsible from the creation and integrity of the table and allows me to query it in datamapper way, but does not require a class, like I may do it in sql?</p><p>I solved my problem by using the first way: I created a new class for each normalization process (which appears as one-to-many association above). However, I am new to object oriented programming and I don&#39;t know if creating a new class for each such normalization is the usual way to do it in datamapper, or rather a hack? This, and whether there is a better way to do this, is what I would like to know.</p><h1>@JustinC</h1><p><strong>Rereading the <a href="http://datamapper.org/docs/associations.html" rel="nofollow">datamapper.org Associations</a> several times, now I see that datamapper certainly requires separate classes for joins. So you answered my question. However, since Robert Harvey placed the bounty, I feel the responsibility to wait a little more for a response about a dynamic way.</strong></p><p>Your code complained with <code>Cannot find the child_model Container for Item in containers</code>. I managed to get it work with the second example of self referential association like below (putting here as a reference to others):</p><pre><code>class Item
  class Link
    include DataMapper::Resource
    storage_names[:default] = &#34;requirement_links&#34;

    belongs_to :require, &#34;Item&#34;, :key =&gt; true
    belongs_to :required, &#34;Item&#34;, :key =&gt; true
  end

  include DataMapper::Resource

  property :id, Serial
  property :name, String, :required =&gt; true

  has n, :links_to_required_items, &#34;Item::Link&#34;, :child_key =&gt; [:require_id]
  has n, :links_to_requiring_items, &#34;Item::Link&#34;, :child_key =&gt; [:required_id]

  has n, :required_items, self,
    :through =&gt; :links_to_required_items,
    :via =&gt; :required
  has n, :requiring_items, self,
    :through =&gt; :links_to_requiring_items,
    :via =&gt; :require

 def require(others)
    required_items.concat(Array(others))
    save
    self
  end

  def unrequire(others)
    links_to_required_items.all(:required =&gt; Array(others)).destroy!
    reload
    self
  end
end
</code></pre><p>So I can do:</p><pre><code>jelly = Item.get :name =&gt; &#34;Jelly&#34;
sugar = Item.get :name =&gt; &#34;Sugar&#34;
jelly.require sugar
</code></pre><p>to require items and:</p><pre><code>jelly.required_items.each { |i|; puts i.name }
</code></pre><p>to list requirements, which are really great.</p><p>After reading your answer, I see that I am yet to normalize my database schema further. To be honest, I don&#39;t see the point of defining the relationship between rawmaterials and products as self referential. I mean, if that would be a small program, I certainly would use a hash like <code>{:jelly =&gt; &#34;:sugar =&gt; 3, :water =&gt; 5&#34;}</code> to reflect required items and amounts, according to YAGNI principle. Doing it as in the 1st option already provides me queries and methods as simple as the ones provided by the self referential association. <strong>(However, I must admit that it looks more like a stored procedure rather than a method call to an object.)</strong></p><p>So, could you very mind to explain the benefits of using a self referential association, which is difficult to understand/implement for me, compared to my simpler approach? I am new to OOP and wonder if I&#39;m sort of undermodelling.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I think what you are looking for at a SQL conceptual level is a junction table (map, link, resolver, pivot are also common names for handling many to many relationships). These junction tables are generally intermediary tables; however, additional attributes can and are often added to them.</p><p>The intention of the stated pseudo schema is a bit murky, but I think what you intended is that items can require multiple skills; items can also require other items, each with their own required skills, possibly own requisite items, and so and so forth, to many levels deep.  Beware of circular references in your [many-to-many] self-referencing relationships, such as what could happen in &#39;containerItemMaps&#39;.  The following pseudo schema reflects how I envision the OP intent:</p><pre><code>items (itemId PK, itemName, weight, volume, price)

skillMaps ( (itemId, skillId) PK)

skills (skillId PK, skillName)

containerItemMaps ( (containerItemId, componentItemId) PK)
    -- containerItemId is the parent/requiring item id
    -- componentItemId is the child/required item id
</code></pre><p>ActiveRecord terminology suggests <strong>&#39;has_and_belongs_to_many&#39;</strong> as the type of association a relationship in a data model to use in this situation.  For more information you may want to look at the page at <a href="http://datamapper.org/docs/associations.html" rel="nofollow">datamapper.org Associations</a>.  Specifically the sections titled &#39;Has, and belongs to many (Or Many-To-Many)&#39; and &#39;Self referential many to many relationships&#39;</p><p>Because I am not a ruby guy at this point, I can only muddle with ruby code to give an example, but this is my best approximation of what your item class would look like:</p><pre><code># revised
class Item
   include DataMapper::Resource

   property :id, Serial

   property :name, String, :required =&gt; true
   property :weight, Float
   property :volume, Float
   property :price, Float 

   has n, :componentMaps, :child_key =&gt; [:container_id]
   has n, :components, self, :through =&gt; :componentMaps, :via =&gt; :component

   has n, :skillMaps, :child_key =&gt; [:skill_id]
   has n, :skills, :through =&gt; :skillMaps, :via =&gt; :skill    
end
</code></pre><p>And the map table for self-referencing many to many items, eg.. required items:</p><pre><code>#revised
class ComponentMap
  include DataMapper::Resource

  belongs_to :container, &#39;Item&#39;, :key =&gt; true
  belongs_to :component, &#39;Item&#39;, :key =&gt; true

  property :quantity, Integer, :default =&gt; 1
end
</code></pre><p>For completeness:</p><pre><code>class SkillMap
  include DataMapper::Resource

  belongs_to :item, &#39;Item&#39;, :key =&gt; true
  belongs_to :skill, &#39;Skill&#39;, :key =&gt; true

  property :mastery, Enum[:none, :aprentice, :journeyman, :craftsman, :master ], :default =&gt; :none

end

class Skill
    include DataMapper::Resource

    property :id, Serial
    property :name, String, :required =&gt; true

    has n, :skillMap, :child_key =&gt;[:skill_id]     
end
</code></pre><p>Revisions:</p><p>Noting your concerns, I went and installed an interpruter and debugger to verify the code compiled and the emitted sql was more ideal.  Originally,  I only was going off cursory examination of documentation.  The structures above should produce generally well-structured sql from the mappings.</p><p>No matter which fields and structures you use, and no matter which ORM you pick (datamapper or some other provider), you will want to run the code through the debugger and pay attention to the sql it emits as sometimes the mappings aren&#39;t necessarily what you might first expect.</p><p>A second note about the junction tables (skillMap and componentMap): note my inclusion of additional fields (quantity and mastery).  These seem to be a natural fit for the kind of application originally described, even though not originally specified.  In a recipe, some ingredients are common among many different combinations, however the quantity from recipe to recipe varies.  For skills, like ingredients, the skill level needed to perform certain activities varies, and thus I added a mastery field to the junction table skillMap.</p><p>Of course, you probably want to add appropriate business rules and helper functions (for accessing the composition of collections programmattically such as adding and removing elements, adding and removing groups of elements, and so on).</p><p>Hopefully this demonstrates a bit better a reason why you may want to consider and use the junction table over a straight hash.  Of course each specific application is different, and perhaps the ability to specify additional aspects of the relationship between items and skill and items and other items isnt needed in your case.</p><p>Having and utilizing the extra control in defining the relationships explicitly has many advantages over relying on a dynamic/magic mapping.  In some cases, I feel it is really needed, and I think in the case of a many-to-many, this is demonstrated.  For one-to-many, the relationship is easier to infer, and using a more dynamic method of generating the mappings (eg.  has n, : &lt;attribute group&gt;, :through =&gt; Resource) would be acceptable.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/database-for-storing-books-by-grouping-their-pages-and-the-table-of-contents/'>Database for storing books by grouping, their pages, and the table of contents</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/database-design-with-performance-issue-and-use-of-views/'>Database design with performance issue and use of views</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/how-to-store-records-with-variable-structure/'>How to store records with variable structure</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>