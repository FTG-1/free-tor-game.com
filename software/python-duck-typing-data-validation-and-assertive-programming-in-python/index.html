<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python &#8211; Duck typing, data validation and assertive programming in Python &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072221 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072221" class="post-1072221 software type-software status-publish hentry category-software tag-assertions tag-duck-typing tag-python tag-validation"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python &#8211; Duck typing, data validation and assertive programming in Python</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">assertions</span><span class="mr-2 badge badge-info">duck-typing</span><span class="mr-2 badge badge-warning">python</span><span class="mr-2 badge badge-primary">validation</span></p><div class="entry-content"><p>About <a href="http://en.wikipedia.org/wiki/Duck_typing">duck typing</a>:</p><blockquote><p>Duck typing is aided by habitually not testing for the type of arguments in method and function bodies, relying on documentation, clear code and testing to ensure correct use.</p></blockquote><p>About argument validation (EAFP: Easier to ask for forgiveness than permission). An adapted example from <a href="http://www.voidspace.org.uk/python/articles/duck_typing.shtml">here</a>:</p><blockquote><p>&#8230;it is considered more pythonic to do :</p></blockquote><pre><code>def my_method(self, key):
    try:
        value = self.a_dict[member]
    except TypeError:
        # do something else
</code></pre><blockquote><p>This means that anyone else using your code doesn&#39;t have to use a real dictionary or subclass &#8211; they can use any object that implements the mapping interface.</p><p>Unfortunately in practise it&#39;s not that simple. What if member in the above example might be an integer ? Integers are immutable &#8211; so it&#39;s perfectly reasonable to use them as dictionary keys. However they are also used to index sequence type objects. If member happens to be an integer then example two could let through lists and strings as well as dictionaries.</p></blockquote><p>About <a href="http://wiki.python.org/moin/UsingAssertionsEffectively">assertive</a> programming:</p><blockquote><p>Assertions are a systematic way to check that the internal state of a program is as the programmer expected, with the goal of catching bugs. In particular, they&#39;re good for catching false assumptions that were made while writing the code, or abuse of an interface by another programmer. In addition, they can act as in-line documentation to some extent, by making the programmer&#39;s assumptions obvious. (&#34;Explicit is better than implicit.&#34;)</p></blockquote><p>The mentioned concepts are sometimes in conflict, so i count on the following factors when choosing if i don&#39;t do any data validation at all, do strong validation or use asserts:</p><ol><li><p>Strong validation. By strong validation I mean raising a custom Exception (<code>ApiError</code> for example). If my function/method is part of a public API, it&#39;s better to validate the argument to show a good error message about unexpected type. By checking the type I do not mean using only <code>isinstance</code>, but also if the object passed supports the needed interface (duck typing). While I document the API and specify the expected type and the user might want to use my function in an unexpected way, I feel safer when I check the assumptions. I usually use <code>isinstance</code> and if later I want to support other types or ducks, I change the validation logic.</p></li><li><p>Assertive programming. If my code is new, i use asserts a lot. What are your advices on this? Do you later remove asserts from the code?</p></li><li><p>If my function/method is not part of an API, but passes some of its arguments through to a other code not written, studied or tested by me, I do a lot of asserts according to the called interface. My logic behind this &#8211; better fail in my code, then somewhere 10 levels deeper in stacktrace with incomprehensible error which forces be to debug a lot and later add the assert to my code anyway.</p></li></ol><p>Comments and advices on when to use or not to use type/value validation, asserts? Sorry for not the best formulation of the question.</p><p>For example consider the following function, where <code>Customer</code> is a SQLAlchemy declarative model:</p><pre><code>def add_customer(self, customer):
    &#34;&#34;&#34;Save new customer into the database.
    @param customer: Customer instance, whose id is None
    @return: merged into global session customer
    &#34;&#34;&#34;
    # no validation here at all
    # let&#39;s hope SQLAlchemy session will break if `customer` is not a model instance
    customer = self.session.add(customer)
    self.session.commit()
    return customer
</code></pre><p>So, there several ways to handle validation:</p><pre><code>def add_customer(self, customer):
    # this is an API method, so let&#39;s validate the input
    if not isinstance(customer, Customer):
        raise ApiError(&#39;Invalid type&#39;)
    if customer.id is not None:
        raise ApiError(&#39;id should be None&#39;)

    customer = self.session.add(customer)
    self.session.commit()
    return customer
</code></pre><p>or</p><pre><code>def add_customer(self, customer):
    # this is an internal method, but i want to be sure
    # that it&#39;s a customer model instance
    assert isinstance(customer, Customer), &#39;Achtung!&#39;
    assert customer.id is None

    customer = self.session.add(customer)
    self.session.commit()
    return customer
</code></pre><p>When and why would you use each of these in the context of duck typing, type checking, data validation?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Let me give some guiding principles.</p><p>Principle #1.  As outlined in <a href="http://docs.python.org/2/reference/simple_stmts.html" rel="nofollow">http://docs.python.org/2/reference/simple_stmts.html</a> the performance overhead of asserts can be removed with a command line option, while still being there for debugging.  If performance is a problem, do that.  Leave the asserts.  (But don&#39;t do anything important in the asserts!)</p><p>Principle #2.  If you&#39;re asserting something, and will have a fatal error, then use an assert.  There is absolutely no value in doing something else.  If someone later wants to change that, they can change your code or avoid that method call.</p><p>Principle #3.  Do not disallow something just because you think it is a stupid thing to do.  So what if your method allows strings through?  If it works, it works.</p><p>Principle #4.  Disallow things that are signs of likely mistakes.  For instance consider being passed a dictionary of options.  If that dictionary contains things that are not valid options, then that&#39;s a sign that someone didn&#39;t understand your API, or else had a typo.  Blowing up on that is more likely to catch a typo than it is to stop someone from doing something reasonable.</p><p>Based on the first 2 principles, your second version can be thrown away.  Which of the other two you prefer is a matter of taste.  Which do you think more likely?  That someone will pass a non-customer to <code>add_customer</code> and things will break (in which case version 3 is preferred), or that someone will at some point want to replace your customer with a proxy object of some kind that responds to all of the right methods (in which case version 1 is preferred).</p><p>Personally I&#39;ve seen both failure modes.  I&#39;d tend to go with version 1 out of the general principle that I&#39;m lazy and it is less typing.  (Also that kind of failure usually tends to show up sooner or later in a fairly obvious way.  And when I want to use a proxy object, I get really annoyed at people who have tied my hands.)  But there are programmers I respect who would go the other way.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../object-oriented-is-duck-typing-a-subset-of-polymorphism/'>Object-oriented &#8211; Is duck typing a subset of polymorphism</a></li><li class="list-group-item"><a href='../python-forgiveness-vs-permission-and-duck-typing/'>Python Forgiveness vs. Permission and Duck Typing</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>