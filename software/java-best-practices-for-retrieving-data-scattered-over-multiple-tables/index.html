<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Best practices for retrieving data scattered over multiple tables &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078789 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078789" class="post-1078789 software type-software status-publish hentry category-software tag-hibernate tag-java tag-jpa"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Best practices for retrieving data scattered over multiple tables</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">hibernate</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">jpa</span></p><div class="entry-content"><p>In the company I work with, we have a 3-layer architecture in our micro-services and the flow is like this:</p><pre><code>Repository/DAO (entity) =&gt; Service (entity) =&gt; Controller (dto)
</code></pre><p>At the Controller level we map our entities to DTOs,</p><p>Now I am working on a search feature, and I need to perform a query with Spring Data JPA / QueryDSL that spans (joins) multiple entities (tables) in the database and must return only the fields needed to the UI.</p><p>For this purpose in the repository I create a query that return a DTO representing data needed by the UI.</p><p>And the query works perfectly and return the correct DTO,</p><p>However, some guys in my team told me that the DTOs are the Controller responsibility and they must be sent directly over the network and not through the app layers.</p><p>If I go with a different name like <strong><code>FooView</code></strong> or <strong><code>FooProjection</code></strong> should I :</p><ol><li>make a extra mapping <code>View =&gt; DTO</code> in the controller layer ?</li><li>send it directly as <code>FooView</code>?</li></ol><p>Or I shoud stick with my DTO at DAO layer ?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>There are two questions in your question.
Question 1: How to fetch scattered data accross tables?</p><p>Question 2: &#34;some guys in my team told me that the DTOs are the Controller responsibility and they must be sent directly over the network and not through the app layers&#34;</p><p><strong>Question 1 Answer</strong>:
Since you are using hibernate I would focus on the pitfalls this creates. When using ORM very often people forget they are implicitly using SQL. A good aprach is to think backwards , what SQL you would like to have and then map it accordingly via ORM.</p><p>When collecting scattered data one major issue that may arrise from ORM usage would be effectivly joining two many tables which may have 2 effects:</p><ul><li>In case of Inner join, joining 4-5 tables especialy if nested  like table A join table B join table C where you have one to many A to B and one to many B to C would cause significant data duplication</li><li>In case of <strong>MULTIPLE LEFT JOIN</strong> you have the potential of creating a problem known as Cartesian product.</li></ul><p>So you more or less are left with couple of appriaches which can be used in different scenarios:</p><ol><li><p>Lets say that you have a complex business process that may reuse the same data again and again within the same transaction. In this particular case you should not worry you are fetching to much as the overal gain you would have via Level 1 cache by far will surpass the negative effects of fetching too much.
Level 1 caching within a transaction is very effective when dealing with repeatable reads.</p></li><li><p>Alternative aproach would be to write queries in order to fetch the scattered data accross the tables. There are some PROS and some CONS with this aproach.</p></li></ol><p>PROS:</p><ul><li>You fetch only what you need.</li><li>Performance is OK</li></ul><p>CONS:</p><p>-The level of granularity is very fine grained. You may end up supporting a lot of queries</p><ul><li>The queries avoid Level 1 caching hibernate presents.</li><li>Each query may cause flushing which may be negative when dealing with complex process / business transaction</li></ul><ol start="3"><li>Resolving the cartesian product issue if you are using activly your entities instead of your queries. You can use Collection Batching, or you can define how many levels your hibernate is allowed to fetch the collections.
Another aproach here would be to use Fetch Strategy SELECT instead of JOIN. Such fetch strategy would be also more effective when it comes to hitting the cache because internaly hibernate will fetch aways by ID.</li></ol><p>Now when you decide your aproach if it will be more ORM or if it will be more Query oriented. On top you can model your DTOs but this is secondary.</p><p>Hibernate also have a feature called projections so it may be possible to directly use the projections in your DTO later.</p><p><strong>Question 2 Answer:</strong></p><p>This answer presumes that you have dealt with fetching the scattered data via answer 1. In a big enough system there are well defined benefits to split your persistence model from your domain model even from your DTO model. Not every application is big and complex enough though to justify having all the three layers and all the boilerplate code that comes with it. Very often when doing a simple app a person measures the time and the resource you need to invest in order to keep all these layers. For a small enough application it may be justified to return your entities and hibernate projections as DTOs.</p><p>So the answer to your question is:</p><blockquote><p>It depends.</p></blockquote><p>And by the way there is no such thing as DTO in the DAO layer :) But for small application it may be justified to re-use the objects accross the logical layers.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-entity-to-dto-usage/'>Java &#8211; Entity to DTO Usage</a></li><li class="list-group-item"><a href='../whats-the-correct-approach-to-dao-layer-in-presence-of-orm-framework/'>What&#8217;s the correct approach to DAO layer in presence of ORM framework</a></li><li class="list-group-item"><a href='../dto-and-jpa-version/'>DTO and JPA Version</a></li><li class="list-group-item"><a href='../decoupled-architecure-between-business-and-data-layers-in-spring-jpa-hibernate/'>Decoupled architecure between business and data layers in Spring JPA / Hibernate</a></li><li class="list-group-item"><a href='../java-the-use-of-dto-instead-of-entity/'>Java &#8211;  the use of DTO instead of Entity</a></li><li class="list-group-item"><a href='../best-practice-for-references-in-dtos-and-entities-in-spring/'>Best practice for references in DTOs and entities in Spring</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>