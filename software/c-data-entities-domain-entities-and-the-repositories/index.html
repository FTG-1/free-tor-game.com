<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Data Entities, Domain entities and the repositories &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069485 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069485" class="post-1069485 software type-software status-publish hentry category-software tag-c tag-domain-driven-design tag-repository-pattern"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Data Entities, Domain entities and the repositories</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">repository-pattern</span></p><div class="entry-content"><p>I&#39;m trying to get my head around DDD but I&#39;m stuck.<br /> This is how I setup my project:</p><pre><code>Data Access Layer
 -Entity models that map to the db
 -Db connection stuff
 -Repositories implementations

Domain Layer
 -Models that represent the DAL entity models
 -Repositories interfaces

Application Layer
 -MVC application that uses Domain models
</code></pre><p>The first problem I see here is that the Domain models are exactly the same as the Entity models, and I have a serious problem with this: the entity models obviously have validation configured into them, things like &#34;max length&#34;, &#34;nullable&#34;, &#34;required&#34;, etc. Now, to conform to what I understand is DDD, I can&#39;t directly use these models anywhere, except the DAL, so I created my domain layer. In the domain layer, I have all these validation rules duplicated for UI validation, and what&#39;s even worse, is that if I need to change a rule, I will have to change it in two places: the DAL and the Domain.</p><p>Example:</p><pre><code>User Entity in DAL
Name (required)
Last name (required)
Email (required, maxlen 120)
Username (required, maxlen 120)

User Domain Model
Name (required)
Last name (required)
Email (required, maxlen 120)
Username (required, maxlen 120)
</code></pre><p>Another thing that I find very weird is that the repositories organization in this architecture.<br /> Following what I read, I created a GenericRepository interface, and a UserRepository interface, which inherits the GenericRepository, all in the Domain layer.<br /> I implemented the GenericRepository in the DAL, and the implementation creates a DAO for the type of the entity used to create the repository. So far, so good.</p><p>Then, I proceeded to implement the UserRepository, and here I have another problem: the UserRepository interface expects the Domain User model, and when I try to implement the interface in the DAL, I need to implement it using the Domain User model, which causes the DAO to be created for a Domain model, not a DAL model, and this doesn&#39;t make any sense. The only to fix it would be to reference the DAL in the Domain layer, which is wrong.</p><pre><code>Domain Layer:

public interface IGenericRepository&lt;TEntity&gt;
{
    TEntity FindById(TKey id);
}

public interface IUserRepository : IGenericRepository&lt;Domain.User&gt;
{
    Task&lt;User&gt; FindByUserNameAsync(string userName);
}


DAL:

public abstract class GenericRepository&lt;TEntity&gt; : IGenericRepository&lt;TEntity&gt;
{
    protected DbContext ctx;
    protected DAO&lt;Entity&gt; dao;

    public GenericRepository(DbContext context)
    {
        ctx = context;
        dao= ctx.Dao&lt;TEntity&gt;();
    }

    public virtual TEntity FindById(TKey id)
    {
        return dao.Find(id);
    }
}

 public class UserRepository : GenericRepository&lt;Domain.Models.User&gt;, IUserRepository
{
    public UserRepository(DbContext context)
        : base(context)
    {
       // THIS WILL CREATE A DAO FOR A DOMAIN MODEL
    }

    // rest of code...
}
</code></pre><p>Can anybody shed a light on what I&#39;m missing from DDD?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Okay. There is a lot to unpack here, but the I think the root cause of some of your confusion is stemming from starting this process with the physical model at the forefront. This commonly causes all sorts of issues for individuals first trying to implement DDD. The goal of DDD is to model the <em>behavior</em> of a system such that the result is a useful abstraction of the function requirements of the core domain. For now, just forget about your DAL. It&#39;s an implementation detail.</p><p>Start by modelling your system by organizing the models by <em>behavior</em> into bounded contexts. It&#39;s the behavior of models that truly relates them. The data/attributes that entities contain is rarely a good starting point for modelling the functional requirements of a complex system. I&#39;d love to provide some examples, but you didn&#39;t specify your domain so I&#39;ll just give you some tips:</p><p>Starting with your <code>User</code> domain model. I&#39;d bet the kitchen sink that the only reason this exists is because you have a <code>User</code> entity. The issue with this is that <code>User</code> implies little to no behavior (uses what?), probably encompasses too much knowledge, and is therefore too abstract. What do your users do (authentication aside)? Shop? <code>Shopper</code>. Comment? <code>Commenter</code>/<code>Poster</code>. Sell? <code>Seller</code>. The important part is that these <em>are not</em> mutually exclusive! One <code>User</code> can be all of these things depending on the behavior in which they are going to engage. The fact that they all map to the same database table is an implementation detail.</p><p>You see where I&#39;m going here? You may have a Shopping context that has <code>Shopper</code>, <code>ShoppingCart</code>, and <code>CartItem</code> and a Billing context that has <code>Buyer</code>, <code>PurchaseRequest</code>, and <code>LineItem</code> where the models in each respectively map to a <code>[User]</code>, <code>[Order]</code>, and <code>[OrderItem]</code> database table. Your model should be the absolute focus of this process. Not how it is persisted.</p><p>As for a direct answer to your question. There are a number common objects found in a domain. <code>DomainModels</code> and <code>ValueObjects</code> are the cornerstones of your model, but you will often find <code>Repositories</code> and <code>Factories</code> playing a supporting role. Because repositories and factories nearly always need to know the implementation details of your domain, they are usually part of your domain model (but not part of the diagram, for example).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../domain-model-validation-and-pushing-errors-to-the-model/'>Domain Model, validation, and pushing errors to the model</a></li><li class="list-group-item"><a href='../design-ddd-repositories-in-application-or-domain-service/'>Design &#8211; DDD repositories in application or domain service</a></li><li class="list-group-item"><a href='../c-architecture-how-to-pass-models-between-controllers-services-and-repositories/'>C# &#8211; Architecture: How to pass models between controllers, services and repositories</a></li><li class="list-group-item"><a href='../ddd-domain-models-and-business-logic/'>DDD Domain Models and Business Logic</a></li><li class="list-group-item"><a href='../c-ddd-best-practices/'>C# &#8211; DDD Best practices</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>