<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; How to refactor services into API, repository and caching (.NET) &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087665 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087665" class="post-1087665 software type-software status-publish hentry category-software tag-api tag-architecture tag-asp-net-mvc tag-net tag-repository"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; How to refactor services into API, repository and caching (.NET)</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api</span><span class="mr-2 badge badge-info">Architecture</span><span class="mr-2 badge badge-warning">asp.net-mvc</span><span class="mr-2 badge badge-primary">net</span><span class="mr-2 badge badge-danger">repository</span></p><div class="entry-content"><p>I am working on a .NET project with, which started out as a prototype that now has to scale. We have the ASP.NET MVC stack with Entity Framework (code first).</p><p>I would like to hear how to scale this into a &#34;proper architecture&#34; with API, repository that handles caching and so forth probably.</p><p><em>Note</em>: I am not looking for a discussion (which isn&#39;t meant to happen on this site), but just how this is usually solved.</p><p><strong>Situation today:</strong></p><p>We have a website, service project, model project and database project:</p><p><a href="../../../i.stack.imgur.com/ZJRWf.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/ZJRWf.png" alt="enter image description here"/></a></p><p>So in practice our website uses the Service, Model and Database assembly. The service returns our Model objects, which it retrieves from direct use on Context.cs.</p><p>So in practice we could for instance call <code>CustomerService</code> in Service project, which derives from <code>ICustomerService</code> from Model project. This would call <code>Context</code> in Database project directly, which then return a <code>Customer</code> object from Model project.</p><p><strong>Top experienced issues with today:</strong></p><ol><li>Business logic, caching logic and database logic is not separated, but one big pile in a Service</li><li>Impossible to easily use a new caching, database or similar.</li><li>A lot of inconsistency issues with DB objects, being attached/detached from EntityFramework directly</li></ol><p><strong>My thinking:</strong></p><p>I was considering an architecture such as this:</p><p><a href="../../../i.stack.imgur.com/9vbvt.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/9vbvt.png" alt="enter image description here"/></a></p><p>Where:</p><ul><li>The API would have its own viewmodels that work as our Resources the consumer of the API expects</li><li>The service layer would let Repository handle all database activity.</li><li>We would be able to decorate model objects with caching</li></ul><p><strong>But this leaves me with a lot of questions:</strong></p><ul><li>Does this architecture even make remotely sense?</li><li>Which objects would be injected where? Would a service inject repository so a <code>CustomerRepository</code> that derives from a <code>IRepository</code>? How is the caching actually done / called?</li><li>This leaves me with 3 representations of an object. Model, API viewmodel and website viewmodel &#8211; seems quite timeconsuming</li><li>Where can I find some examples about this that will help me?</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Does this architecture even make remotely sense?</p></blockquote><p>It seems reasonable to me. You&#39;ve correctly identified the layers you need and what behaviour belongs in each of them.</p><blockquote><p>Which objects would be injected where? Would a service inject repository so a CustomerRepository that derives from a IRepository? How is the caching actually done / called?</p></blockquote><p>I&#39;m pretty sure you&#39;re talking about dependency injection? If so, yes, the service layer would inject the repo layer, and the api layer would inject the service layer. Pretty much every dependency to something doing business logic for the system should be injected, so that you can unit test.</p><p>I&#39;d suggest starting off with a direct database cache if you don&#39;t already have one, and then possibly adding a higher-level cache if you still have demonstrated performance issues in production. If your API is RESTful, you could go a step farther and use a caching proxy such as squid in conjunction with properly set caching headers. The convenience of this will depend on your stack - NHibernate has L2 caching support built in, for instance.</p><blockquote><p>This leaves me with 3 representations of an object. Model, API viewmodel and website viewmodel - seems quite timeconsuming</p></blockquote><p>Yup. The tradeoff is more time for more flexibility. In addition to the attachment issue you saw, a single representation tied to all three layers may be very limiting later on. For instance, you can&#39;t decide to have your API release a single resource that&#39;s a combination of two or more database tables. Any change to the representation will impact the whole application, which may not be desirable. You may also find, over time, that layer-specific information creeps into your representation, which will add dependencies that really don&#39;t belong in the other layers.</p><blockquote><p>Where can I find some examples about this that will help me?</p></blockquote><p>Out of scope. :-( Google is your friend? Try something like <code>.net n-tier example</code>. Alternately, if you prefer real code, you could troll github and see if there&#39;s anything on there to work off of.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-domain-driven-design-and-wcf-services-architecture/'>C# &#8211; Domain driven design and WCF services architecture</a></li><li class="list-group-item"><a href='../rest-considerations-for-decoupling-and-refactoring-business-logic-to-a-rest-api/'>Rest &#8211; Considerations for decoupling and refactoring business logic to a REST API</a></li><li class="list-group-item"><a href='../architecture-should-i-use-a-layer-between-service-and-repository-for-a-clean-architecture-spring/'>Architecture &#8211; Should I use a layer between service and repository for a clean architecture &#8211; Spring</a></li><li class="list-group-item"><a href='../architecture-calling-service-and-repository-layer-from-controller/'>Architecture &#8211; Calling service and repository layer from controller</a></li><li class="list-group-item"><a href='../c-asp-net-web-api-and-mvc-architecture-for-web-application/'>C# &#8211; ASP.NET Web API and MVC Architecture for Web Application</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>