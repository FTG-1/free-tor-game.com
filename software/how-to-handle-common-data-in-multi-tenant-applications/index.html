<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to handle common data in multi-tenant applications &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077142 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077142" class="post-1077142 software type-software status-publish hentry category-software tag-database-design tag-multitenancy"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to handle common data in multi-tenant applications</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database-design</span><span class="mr-2 badge badge-info">multitenancy</span></p><div class="entry-content"><p>I am designing a multi-tenant application which will use the same database schema for a separate DB instance per-tenant (i.e. every time I get a new customer, I create a new database for them). This approach is desirable for its simplicity in that I won&#39;t need to filter data per-tenant -&gt; I can just select every <code>User</code> in <code>dbo.Users</code>, for example &#8211; no need to filter by <code>CustomerId</code> / no danger that I forget to and accidentally expose the wrong data to the wrong customer.</p><p>What I am wondering is how to handle data which is common to <em>all</em> databases. Postcodes (Zipcodes) would be a great example. It looks like I either need to replicate this data in each database (which will be a nightmare to maintain and will mean I am storing <em>loads</em> of duplicated data) <strong>OR</strong> I need to use some common database which then prevents me from joining tables in the natural way, or using e.g. <code>EntityFramework</code> out of the box. Neither of these sound right/better than the other.</p><p>Does anyone have a good strategy for this?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>I need to use some common database which then prevents me from joining tables in the natural way, or using e.g. EntityFramework out of the box.</p></blockquote><p>You can use <a href="https://github.com/zzzprojects/EntityFramework.DynamicFilters" rel="noreferrer">EntityFramework.DynamicFilters</a> for this. It allows you to put a dynamic filter on your model that will be applied to <strong>all</strong> queries (both direct queries and loading related entities).</p><p>For example, I use DynamicFilters to filter soft-deleted items. Items with <code>DeletedOn != null</code> will be hidden from sight.</p><pre><code>modelBuilder.Filter(&#34;IsDeleted&#34;, (BaseEntity d) =&gt; d.DeletedOn, null);
</code></pre><p>You could use a similar approach, something like:</p><pre><code>modelBuilder.Filter(&#34;CustomerId&#34;, (User u) =&gt; u.CustomerId, GetCurrentCustomerId());
</code></pre><p>This mostly disables your further reasoning to use multi-tenancy purely to separate customer data.</p><hr/><p>However, there are other considerations that can lead you to want to use a multi-tenant platform.</p><blockquote><p>I am designing a multi-tenant application which will use the same database schema for a separate DB instance per-tenant (i.e. every time I get a new customer, I create a new database for them).</p></blockquote><ul><li><p>What happens when you have customers, and you then wish to upgrade your database schema. Are you enforcing upgrades across the board, or are you going to allow customers to upgrade when/if they want to?</p></li><li><p>What happens when one customer requires a restore of their data? Do you want to be able to only restore that customer&#39;s data? (I assume so - I just wanted to point this out).</p></li></ul><p>Both cases can be strong point for using multi-tenancy: customers can upgrade at their own pace, and can receive data restores without affecting other customers.</p><p>However, then we run into another issue: <strong>common data between different application versions</strong>. If the common data changes during an upgrade, you&#39;re going to run into trouble.</p><p><em>I know your examples of ZIP codes is less applicable here, as they&#39;re not prone to being changed between versions; but the general point still stands: some common data may indeed change between versions.</em></p><p>There are two solutions here, I will discuss both briefly.</p><hr/><p><strong>1. Hosting the common data</strong></p><p>You can keep a centralized database of common data, but I suggest hiding this behind a service. This gives you the possibility of easily returning <em>versioned</em> common data. Every tenant will tell you what their current version is (e.g. v1.3) and your service then ensures that it returns the common data for version 1.3.</p><p>This gives you the separation you need, but there are some issues here: it costs overhead to create the web service, and it&#39;s effectively an external dependency that you&#39;re always going to have to rely on.</p><p>I prefer this approach for common data which is not version-specific and instead considered &#34;globally correct&#34; (such as a list of ZIP codes).<br/> However, there needs to be a reasonable data size to warrant putting it into a centralized repository. If it&#39;s 5 fields, the overhead of creating the service far outweighs the data footprint of copying those 5 lines in all tenants.</p><hr/><p><strong>2. Loading the common data into the tenant</strong></p><p>I prefer this approach for common data which is version-specific, unless the data is so large that it becomes a problem to include it in every tenant separately.</p><p>In short, you can achieve this using (for example) <a href="http://www.entityframeworktutorial.net/code-first/seed-database-in-code-first.aspx" rel="noreferrer">database seeding in EF</a>, which allows you to update the common data at the same time you upgrade the database schema to a newer version.</p><p>There are many ways to achieve this. I like database seeding as it ties nicely into the schema upgrade process.</p><hr/><p>I understand why you want to centralize data - it&#39;s shared data right? But there is a line of reasonability here, not <em>every</em> abstraction is necessary.</p><p>As an oversimplified example, consider the idea that when your entities all have audit fields (<code>CreatedOn</code>, <code>ModifiedOn</code>, ...), you tend to abstract this in a <code>IAuditable</code> or <code>AuditableEntity</code>. That is good practice<br/> However, when you have three entities (<code>Person</code>, <code>Country</code> and <code>StuffedAnimal</code>) which all have a <code>Name</code> property, that doesn&#39;t mean that you should abstract this into a <code>INamed</code> or <code>NamedEntity</code>. This no longer a reasonable argument.</p><p>The same is happening here. When you apply the theory to the letter, then shared data should be abstracted into a centralized point. However, by that same logic, you also shouldn&#39;t be using multi-tenancy then because they have a <em>shared database schema</em>, right?</p><p>You shouldn&#39;t apply the theory to the letter here, and instead consider the <strong>practical application</strong>. A tenant is created specifically to run independently from the other tenants. There are several benefits to doing so, but &#34;pure abstraction&#34; isn&#39;t one of them. If anything, multi-tenancy is <em>refusing to abstract or share resources</em> specifically so you can prevent issues from becoming a global issue for all yoru customers.</p><p>If you need updates to your common data to be propagated to all tenants at all times, then option 1 is better.</p><p>If you want to ability to version your common data for your tenants, then you are better off keeping the data locally inside the tenants themselves.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/design-multi-tenant-database-design/'>Design &#8211; Multi-tenant database design</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/how-to-handle-db-authentication-in-multi-tenant-application-with-separate-databases/'>How to handle db authentication in multi tenant application with separate databases</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/techniques-for-efficiently-partitioning-data-in-a-shared-multi-tenant-database/'>Techniques for efficiently partitioning data in a shared multi-tenant database</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/architecture-designing-a-multi-tenant-single-page-application-for-the-web/'>Architecture &#8211; Designing a multi-tenant single page application for the web</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/architecture-logical-separation-of-database-content/'>Architecture &#8211; Logical separation of database content</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>