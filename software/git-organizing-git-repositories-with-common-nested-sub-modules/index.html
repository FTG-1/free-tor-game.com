<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Git &#8211; Organizing Git repositories with common nested sub-modules &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1066755 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1066755" class="post-1066755 software type-software status-publish hentry category-software tag-cmake tag-git tag-submodules"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Git &#8211; Organizing Git repositories with common nested sub-modules</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">cmake</span><span class="mr-2 badge badge-info">git</span><span class="mr-2 badge badge-warning">submodules</span></p><div class="entry-content"><p>I&#39;m a big fan of <a href="http://book.git-scm.com/5_submodules.html">Git sub-modules</a>.  I like to be able to track a dependency along with its version, so that you can roll-back to a previous version of your project and have the corresponding version of the dependency to build safely and cleanly.  Moreover, it&#39;s easier to release our libraries as open source projects as the history for libraries is separate from that of the applications that depend on them (and which are not going to be open sourced).</p><p>I&#39;m setting up workflow for multiple projects at work, and I was wondering how it would be if we took this approach a bit of an extreme instead of having a single monolithic project.  I quickly realized there is a potential can of worms in <em>really</em> using sub-modules.</p><p>Supposing a pair of applications: <code>studio</code> and <code>player</code>, and dependent libraries <code>core</code>, <code>graph</code> and <code>network</code>, where dependencies are as follows:</p><ul><li><code>core</code> is standalone</li><li><code>graph</code> depends on <code>core</code> (sub-module at <code>./libs/core</code>)</li><li><code>network</code> depdends on <code>core</code> (sub-module at <code>./libs/core</code>)</li><li><code>studio</code> depends on <code>graph</code> and <code>network</code> (sub-modules at <code>./libs/graph</code> and <code>./libs/network</code>)</li><li><code>player</code> depends on <code>graph</code> and <code>network</code> (sub-modules at <code>./libs/graph</code> and <code>./libs/network</code>)</li></ul><p>Suppose that we&#39;re using <a href="http://www.cmake.org/">CMake</a> and that each of these projects has unit tests and all the works.  Each project (including <code>studio</code> and <code>player</code>) must be able to be compiled standalone to perform code metrics, unit testing, etc.</p><p>The thing is, a recursive <code>git submodule fetch</code>, then you get the following directory structure:</p><pre><code>studio/
studio/libs/                    (sub-module depth: 1)
studio/libs/graph/
studio/libs/graph/libs/         (sub-module depth: 2)
studio/libs/graph/libs/core/
studio/libs/network/
studio/libs/network/libs/       (sub-module depth: 2)
studio/libs/network/libs/core/
</code></pre><p>Notice that <code>core</code> is cloned twice in the <code>studio</code> project.  Aside from this wasting disk space, I have a build system problem because I&#39;m building <code>core</code> twice and I potentially get two different versions of <code>core</code>.</p><h3>Question</h3><p>How do I organize sub-modules so that I get the versioned dependency and standalone build without getting multiple copies of common nested sub-modules?</p><h3>Possible solution</h3><p>If the the library dependency is somewhat of a suggestion (i.e. in a &#34;known to work with version X&#34; or &#34;only version X is officially supported&#34; fashion) and potential dependent applications or libraries are responsible for building with whatever version they like, then I could imagine the following scenario:</p><ul><li>Have the build system for <code>graph</code> and <code>network</code> tell them where to find <code>core</code> (e.g. via a compiler include path).  Define two build targets, &#34;standalone&#34; and &#34;dependency&#34;, where &#34;standalone&#34; is based on &#34;dependency&#34; and adds the include path to point to the local <code>core</code> sub-module.</li><li>Introduce an extra dependency: <code>studio</code> on <code>core</code>.  Then, <code>studio</code> builds <code>core</code>, sets the include path to its own copy of the <code>core</code> sub-module, then builds <code>graph</code> and <code>network</code> in &#34;dependency&#34; mode.</li></ul><p>The resulting folder structure looks like:</p><pre><code>studio/
studio/libs/                    (sub-module depth: 1)
studio/libs/core/
studio/libs/graph/
studio/libs/graph/libs/         (empty folder, sub-modules not fetched)
studio/libs/network/
studio/libs/network/libs/       (empty folder, sub-modules not fetched)
</code></pre><p>However, this requires some build system magic (I&#39;m pretty confident this can be done with CMake) and a bit of manual work on the part of version updates (updating <code>graph</code> might also require updating <code>core</code> and <code>network</code> to get a compatible version of <code>core</code> in all projects).</p><p>Any thoughts on this?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I&#39;m very late to this party, but your question still doesn&#39;t seem to have a complete answer, and it&#39;s a pretty prominent hit from google.</p><p>I have the exact same problem with C++/CMake/Git/Submodules and I have a similar problem with MATLAB/Git/Submodules, which gets some extra weirdness because MATLAB isn&#39;t compiled. I came across <a href="https://www.youtube.com/watch?v=3eH4hMKl7XE" rel="noreferrer">this video</a> recently, which seems to propose a &#34;solution&#34;. I don&#39;t like the solution, because it essentially means throwing away submodules, but it does eliminate the problem. It is just as @errordeveloper recommends. Each project has no submodules. To build a project, create a super-project to build it, and include it as a sibling to its dependencies.</p><p>So your project for developing <code>graph</code> might look like:</p><pre><code>buildgraph/graph
buildgraph/core
</code></pre><p>and then your project for studio could be:</p><pre><code>buildstudio/studio
buildstudio/graph
buildstudio/network
buildstudio/core
</code></pre><p>The super-projects are just a main <code>CMakeLists.txt</code> and a bunch of submodules. But none of the projects have any submodules themselves.</p><p>The only cost I see to this approach is the proliferation of trivial &#34;super-projects&#34; that are just dedicated to building your real projects. And if someone gets a hold of one of your projects, there is no easy way to tell without finding the super-project as well, what its dependencies are. That might make it sit really ugly on Github, for example.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../which-should-i-prefer-a-subrepository-submodule-or-a-cmake-externalproject/'>Which should I prefer: A subrepository/submodule, or a CMake ExternalProject</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>