<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Rest &#8211; What API design makes the most sense for changing a user&#8217;s password &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071038 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071038" class="post-1071038 software type-software status-publish hentry category-software tag-api tag-api-design tag-http tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Rest &#8211; What API design makes the most sense for changing a user&#8217;s password</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api</span><span class="mr-2 badge badge-info">api-design</span><span class="mr-2 badge badge-warning">http</span><span class="mr-2 badge badge-primary">rest</span></p><div class="entry-content"><p>Consider a web page where a user changes his password after clicking on an emailed password reset link.</p><p>The page will be implemented against an API using ajax, rather than as an ordinary form submission.  That is, this question is about designing an API endpoint for changing a password.</p><h3>Requirements</h3><p>Any time a password is changed, the change must be recorded in the database in the <code>password_changes</code> table:</p><pre><code>password_changes
  - user_id
  - date_changed
</code></pre><h3>Specific Question</h3><p>Thinking about this design from the perspective of API endpoints that create, update, or delete abstract &#34;resources&#34;, does it make more sense to think about the password change as:</p><ol><li><p>We&#39;re updating the &#34;user&#34; resource, and hence should <code>PUT</code> a new password onto <code>/user/{id}</code> or perhaps <code>/user/{id}/password</code>?  In this model, recording the change in <code>password_changes</code> is just an irrelevant implementation detail, and has no bearing on our concept of the &#34;user&#34; resource or the name of our endpoint.</p></li><li><p>We&#39;re creating a &#34;password_change&#34;.  Thus we should be <code>POST</code> to <code>/user/{id}/password_change</code>, or something similar.  In this model, the change to the &#34;user&#34; resource is just a side effect of creating a &#34;password_change&#34;.</p></li></ol><p>In this particular example, I think most people would choose option 1.  And indeed it feels more natural to me too.  Buy why?  Is this just a matter of judgment, taste, or intuition?  Or is there some codified principle of REST or even the basic concepts of resources and http actions that option 2. clearly violates?</p><p>(<strong>EDIT 3/2/2019:</strong> Fwiw, #2 now seems much more natural to me, and I&#39;m confused why my former self felt #1 was more natural)</p><h3>More General Question</h3><p>What if we provide a history of password changes as a new enpoint: <code>/user/{id}/password_changes</code>?</p><p>That seems like a reasonable service.</p><p>But if we stick with design 1., now we make password changes by making <code>PUT</code>s to <code>/user</code> but view them with <code>GET</code>s to <code>/user/{id}/password_changes</code>.  And then do we just disallow other http actions to <code>password_changes</code> (PUT, POST, DELETE)?  That seems inconsistent&#8230; or maybe not?</p><p>Again, what are the rules (or even heuristics) governing these decisions?  I can make judgment calls, but I&#39;m looking for something more definitive.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>In this particular example, I think most people would choose option 1. And indeed it feels more natural to me too. Buy why?</p></blockquote><p>Not sure there&#39;s going to be a definitive answer to this, but my guess: because password, the entity, has a relatively straight forward representation as a <em>document</em>; HTTP&#39;s raison d&#39;etre is document transfer, after all.  It&#39;s pretty well designed for that.</p><p>Additionally, there&#39;s a simplicity to password - current state is a simple value type, and consequently there&#39;s no confusion about what &#34;modify&#34; should mean.  Having only a single method available to mutate the state of the resource doesn&#39;t cause any problems because there&#39;s only one way you would want to: by completely replacing one representation with another, which is exactly the semantic of the PUT method in HTTP.</p><blockquote><p>Generally speaking, a password change is not idempotent.</p></blockquote><p>Yes, but that&#39;s a moot point here; the choice of method in this case is more driven by what should happen if a request is not acknowledged.  Do we get to retry?  If the message travels through an intermediate, is <em>it</em> allowed to retry the message rather than immediately returning a failure to the client?</p><p>(Admittedly, if we are throwing secrets around, we should be using an encrypted channel, which means that the intermediates can&#39;t see what&#39;s going on)</p><p>We aren&#39;t sending the request twice because we want the change applied twice, we are sending it twice to ensure that it is delivered at least once.</p><p>To ensure that the <em>side effect</em> on the domain doesn&#39;t get repeated, use a &#34;conditional put&#34;, so that the server can distinguish between two copies of the same request, and two <em>different</em> requests that happen to contain the same representation of the password.</p><blockquote><p>What if we provide a history of password changes as a new end point: /user/{id}/password_changes?</p><p>That seems like a reasonable service.</p></blockquote><p>Yup.  I would probably lean toward the spelling <code>/user/{id}/password/history</code>; it feels natural to make the audit log subordinate to the password resource.</p><blockquote><p>And then do we just disallow other http actions to password_changes (PUT, POST, DELETE)? That seems inconsistent... or maybe not?</p></blockquote><p>I don&#39;t see a consistency issue.  Your domain model is the book of record for password changes; that history is not subject to override by the clients -- the domain reserves that privilege for itself.  So the resource is read only.  Ta-da?</p><p><strong>all that said</strong></p><blockquote><p>We&#39;re creating a &#34;password_change&#34;. Thus we should be POST to /user/{id}/password_change, or something similar. In this model, the change to the &#34;user&#34; resource is just a side effect of creating a &#34;password_change&#34;.</p></blockquote><p>This isn&#39;t wrong either; if you twist it around a little bit, you are basically describing AtomPub; you are publishing an entry (the PasswordChanged event) into a feed (the history), and the new &#34;state&#34; of the resource is derived from looking at the history.  In other words, RESTful <a href="../../questions/tagged/event-sourcing.html" class="post-tag" title="show questions tagged &#39;event-sourcing&#39;" rel="tag">event-sourcing</a>.</p><p>It&#39;s a bit crooked; the usual idiom is that commands are sent to an <code>aggregate</code> in the domain model, and the state changes that are caused by the command are published to a stream, which is exposed via an atom feed.  In this use case, we turn it around, somewhat, by the fact that the human being, rather than the domain, is the book of record.  Maybe.</p><p><a href="https://yow.eventer.com/yow-2011-1004/domain-driven-design-for-restful-systems-by-jim-webber-1047" rel="nofollow noreferrer">Jim Webber</a> describes REST application protocols as an analog to a 1950s style office, where you get things done by passing documents into inboxes.  You deliver a ChangePasswordRequest to the server, and as a side effect the domain model updates itself, which has the cascading side effect of changing the state of other resources, like the audit log.</p><p>That&#39;s perhaps overkill for a simple ReplacePassword protocol, but is useful to keep in mind when things get to be more complicated.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-api-concepts/'>REST API concepts</a></li><li class="list-group-item"><a href='../rest-api-design-how-to-break-down-the-api-object-to-make-more-scalable-and-robust-api/'>REST API Design: How to break down the API object to make more scalable and robust API</a></li><li class="list-group-item"><a href='../rest-how-to-approach-user-related-resources-on-a-rest-api/'>Rest &#8211; How to approach user related resources on a REST API</a></li><li class="list-group-item"><a href='../javascript-rest-api-design-patterns/'>Javascript &#8211; REST Api Design Patterns</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>