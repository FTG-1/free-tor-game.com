<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; design a model for a system of dependent variables &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082735 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082735" class="post-1082735 software type-software status-publish hentry category-software tag-c tag-design tag-functional-programming tag-object-oriented-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; design a model for a system of dependent variables</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">functional programming</span><span class="mr-2 badge badge-primary">object-oriented-design</span></p><div class="entry-content"><p>I&#39;m dealing with a modeling system (financial) that has dozens of variables.  Some of the variables are independent, and function as inputs to the system; most of them are calculated from other variables (independent and calculated) in the system.</p><p>What I&#39;m looking for is a clean, elegant way to:</p><ol><li>define the function of each dependent variable in the system</li><li>trigger a re-calculation, whenever a variable changes, of the variables that depend on it</li></ol><p>A naive way to do this would be to write a single class that implements <code>INotifyPropertyChanged</code>, and uses a massive case statement that lists out all the variable names x1, x2, &#8230; xn on which others depend, and, whenever a variable <code>xi</code> changes, triggers a recalculation of each of that variable&#39;s dependencies.</p><p>I feel that this naive approach is flawed, and that there must be a cleaner way.  I started down the path of defining a <code>CalculationManager&lt;TModel&gt;</code> class, which would be used (in a simple example) something like as follows:</p><pre><code>public class Model : INotifyPropertyChanged
{
    private CalculationManager&lt;Model&gt; _calculationManager = new CalculationManager&lt;Model&gt;(); 

    // each setter triggers a &#34;PropertyChanged&#34; event
    public double? Height { get; set; }
    public double? Weight { get; set; }
    public double? BMI { get; set; }

    public Model()
    {
        _calculationManager.DefineDependency&lt;double?&gt;(
            forProperty: model =&gt; model.BMI,
            usingCalculation: (height, weight) =&gt; weight / Math.Pow(height, 2),
            withInputs: model =&gt; model.Height, model.Weight);
    }

    // INotifyPropertyChanged implementation here
}
</code></pre><p>I won&#39;t reproduce <code>CalculationManager&lt;TModel&gt;</code> here, but the basic idea is that it sets up a dependency map, listens for <code>PropertyChanged</code> events, and updates dependent properties as needed.  I still feel that I&#39;m missing something major here, and that this isn&#39;t the right approach:</p><ol><li>the (mis)use of <code>INotifyPropertyChanged</code> seems to me like a code smell</li><li>the <code>withInputs</code> parameter is defined as <code>params Expression&lt;Func&lt;TModel, T&gt;&gt;[] args</code>, which means that the argument list of <code>usingCalculation</code> is not checked at compile time</li><li>the argument list (weight, height) is redundantly defined in both <code>usingCalculation</code> and <code>withInputs</code></li></ol><p>I am sure that this kind of system of dependent variables must be common in computational mathematics, physics, finance, and other fields.  Does someone know of an established set of ideas that deal with what I&#39;m grasping at here?  Would this be a suitable application for a functional language like F#?</p><hr/><p><strong>Edit</strong></p><p>More context:</p><p>The model currently exists in an Excel spreadsheet, and is being migrated to a C# application.  It is run on-demand, and the variables can be modified by the user from the application&#39;s UI.  Its purpose is to retrieve variables that the business is interested in, given current inputs from the markets, and model parameters set by the business.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Assuming you can model the dependencies as a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" rel="nofollow">directed acyclic graph</a>, you can then use a <a href="http://en.wikipedia.org/wiki/Topological_sorting" rel="nofollow">Topological Sort</a> to order them.  My understanding is that spreadsheets use this idea.</p><p>Seems like F# would be a good fit.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-why-in-wpf-do-we-set-an-object-to-stretch-via-its-alignment-properties-instead-of-width-height/'>Design &#8211; Why, in WPF, do we set an object to Stretch via its Alignment properties instead of Width/Height</a></li><li class="list-group-item"><a href='../c-architecture-strategies-for-a-complex-competition-scoring-system/'>C# &#8211; Architecture strategies for a complex competition scoring system</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>