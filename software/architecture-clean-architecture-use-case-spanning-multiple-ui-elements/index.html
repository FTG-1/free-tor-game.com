<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; Clean Architecture: Use case spanning multiple UI elements &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082372 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082372" class="post-1082372 software type-software status-publish hentry category-software tag-architecture tag-clean-architecture tag-coupling tag-use-case"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; Clean Architecture: Use case spanning multiple UI elements</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">clean-architecture</span><span class="mr-2 badge badge-warning">coupling</span><span class="mr-2 badge badge-primary">use-case</span></p><div class="entry-content"><p>So I&#39;m currently trying to write a project using Clean Architecture. Its a Unity Engine project which doesn&#39;t make the task any easier.</p><p>The Issue I&#39;m running into however is much more basic and has to do with the fact that all examples for Clean Architecture use cases I have seen appear to be rather simple mostly CRUD and without multiple steps.</p><p>Now the (high-level Cockburn-definition) Use Cases I want to implement involve a couple of steps:</p><ol><li>User creates an element</li><li>User puts information about the element</li><li>User creates additional elements and links them to the first one</li></ol><p>Now in the traditional use case sense as described by Clean Architecture with an input-port and an output-port I do not know how to model this workflow as a single use case as it spans multiple UI elements with their own presenters and the workflow itself is being triggered from deep within a presenter hierarchy that has nothing at all to do with the execution of this workflow aside form starting it.</p><p>I do want to keep the application as loosely coupled as possible so I do not wish to introduce tight-coupling via some god-object that holds references to all needed presenters and implements the output port.</p><p>I have a solution that is rather hands-off by simply having most of the UI listen to state changes in the repositories however this as discussed today with colleagues leads to a bit of confusion of how the flow of data works and we have people opting for having use-cases drive UI state changes instead as in:</p><pre><code>outputPort.ChangeToInputDetailsState()
</code></pre><p>which I think completely breaks the principle that use cases should not care about how they are called etc.</p><p>If anyone has any example of use-cases in Clean Architecture requesting further information or in general any source of information on using Clean Architecture with more complex use-cases in a UI driven environment I would be quite happy.</p><p>Edit: More details as requested</p><p>To elaborate a bit on what I mean with spans multiple UI elements since it was asked in the comments. I can&#39;t give details on the specific project but I can try to make an analogon.</p><p>Use case (Cockburn definition) is something like:</p><p>Name: Record and Upload Video</p><p>Primary Actor: User</p><p>Steps:</p><ol><li>Record Video</li><li>Annotate and Cut Video</li><li>Upload Video to Server</li></ol><p>Now these span multiple UI elements in the sense that steps 1, 2 and 3 require different parts of the UI with their own sublogic to complete, which themselves are used from multiple points. I&#39;m not sure that this use-case definition can be mapped 1:1 to a Clean Architecture use-case. If it can be then the Input/Output port would have to be able to orchestrate all these different UI parts which themselves might be used by different use-cases.</p><p>Elaborating on it like that I think that my issue also contains a variant of the issue of reusing UI components in a Clean Architecture case where there might be more than one use-case associated with a single controller/presenter.</p><p>Edit 2: Elaborating on just using functions on the outport port that return after getting the necessary info.</p><p>The issue I see here is that in Clean Architecture Output Ports/Presenters to me always looked dumb (in the sense of barely any logic) and that orchestrating all the business logic falls into the realm of use cases.</p><p>If I were to however only call another use-case to get my additional information instead of passing it back into the presentation layer I would not be able to open another user interface as the use cases don&#39;t even know about it.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>OK, I think you you have a few misconceptions about the architecture itself and that this is tripping you up, so let me try to sort that out.</p><p><a href="../../../i.stack.imgur.com/IHT86.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/IHT86.png" alt="enter image description here"/></a></p><p>So, domain behavior (the business logic of the application) resides within the combined Use Cases + Entities layer. How you split that up internally is up to you, but the guideline is to put the &#34;application independent&#34; (core) domain logic/rules within the entities (domain model with behavior), or within objects that share that layer with the entities (anemic data structures + functions). However, if you don&#39;t actually have several applications that share application independent logic, or if it&#39;s just not perfectly clear what that should be, most of the good stuff will probably end up in the Use Cases layer, though - and that&#39;s OK.</p><blockquote><p>The issue I see here is that in Clean Architecture Output
 Ports/Presenters to me always looked dumb (in the sense of barely any
 logic)</p></blockquote><p>I think you have a slight misconception about what input and output ports are. You have a certain domain behavior: it needs some input, then it does something, and produces some output or some side effect. The input is received through the input port, which is just an <em>interface to this domain code</em> - it&#39;s either an actual interface type, or a base class, or just the public interface (public methods and properties) on some object (the &#34;Interactor&#34;). So, the input port is not a dumb component (barely any logic) as it represents an abstract view of the business logic provided by the use case (and, hopefully, the use case involves some logic of value). Yes, the implementation of it resides in the use case, but the methods (the capabilities, the things that tell us what it can do, and thus, if it&#39;s a smart component or an anemic data structure, are defined by the interface of the input port). The data structures (or parameters) that pass through it, however, are dumb - as these are just plain data structures.</p><p>Similarly, an output port is an abstract <em>interface to some external component</em> (a view, a service, a data store) - and how dumb/smart it is depends on the nature of the component it represents. (When I say &#34;external&#34;, I mean external to the Use Cases layer).</p><p>Note that this is a generalized view; in some cases, you may decide to merge the two ports into a single one (e.g., if you don&#39;t need anything to inherit from the Output Port, or if you do all the output through data structures returned by the Interactor interface).</p><p>BTW, if you are using the Observer pattern or events, then the abstract Observer interface, or, in the case of events, the signature of the event handler, is a concrete example of an Output Port.</p><h3>Not a UI Pattern</h3><blockquote><p>I&#39;m not sure that this use-case definition can be mapped 1:1 to a Clean Architecture use-case. If it can be then the Input/Output port would have to be able to orchestrate all these different UI parts which themselves might be used by different use-cases.</p></blockquote><p>Clean architecture is <em>not a UI pattern</em>; it does <em>not</em> demand that each UI element has a Controller, a Presenter, and an Interactor with an input and output port. That&#39;s not what it&#39;s about <em>at all</em>. Strictly speaking, the Controller and the Presenter aren&#39;t really a part of the architecture (aren&#39;t really prescribed by it), the relationships across the boundary are. The Controller and the Presenter are there because that&#39;s how UI-related logic happens to be structured in the example (MVC/MVP being a common pattern). And the Interactor has nothing conceptually to do with UI. It just handles how the &#34;outside world&#34; interacts with the domain logic and vice versa. A use case is implemented by one or more objects in the Use Cases layer that work together, the Interactor being an entry point - a Facade if you will.</p><p>The input and output ports don&#39;t <em>orchestrate</em> UI - they don&#39;t know about the UI, and they certainly don&#39;t know about the fact that it&#39;s composed of <em>parts</em>. That&#39;s presentation logic. A use case might have <em>several</em> input and output ports, for different purposes - e.g, one for user input, one for input by an automated system, one that outputs to the screen, one that outputs to a database, or a web server. And these ports may be connected to actual components, or to a test case (say, in TDD), or a test double.</p><p>So, if you have UI elements that are (to some extent) generic, so that they can appear on multiple screens, in the context of different use cases - that is <em>absolutely fine</em>. The inset to the right <em>does not</em> say that this is a structure for every UI element - it&#39;s just an example of the flow initiated from the UI side.</p><p><a href="../../../i.stack.imgur.com/YLcxb.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/YLcxb.png" alt=""/></a></p><p>In terms of the presentation logic, any orchestration the UI needs happens in the the presentation layer. But the actual work on the objects that are of business interest to the users is delegated by the UI to an Interactor. Often, a screen will use a single Interactor, but there&#39;s no reason why it can&#39;t reference two or three of them to support different but related use cases, or why several screens that represent a UX-related breakdown of the same use case can&#39;t share the same Interactor.</p><h3>The Architectural Boundary</h3><p>OK, so you have some business logic, a use case, that requires some input data to do something. The data that you pass in is, in a generalized way, referred to as &#34;The Input Model&#34; (&#34;model&#34; just means a &#34;representation&#34; - as in, you&#39;ve studied the problem and understood it in a certain way, and came up with all these concepts, ideas, data structures, etc., that you are going to use to represent that problem in code). The input model could be an actual data structure, or just a parameter list on a method. It&#39;s a dumb thing; no behavior, just data that you can toss across the architectural boundary. It&#39;s really a part of the Input Port interface - it&#39;s &#34;owned&#34; by it, and it&#39;s defined in the same layer (Use Cases).</p><p>Note that both the Input Port and the Output Port are just interfaces that capture how the Interactor and some other component &#34;talk&#34; - so they will likely contain a few methods for different aspects of that interaction, and each method will have it&#39;s own Input and/or Output Model (basically, what parameters they take, and what they return, or pass to other components as parameters). The thing to remember is that all those methods and any data structures and types that get passed through them are on the boundary of the layer; the insides of the layer are encapsulated <em>behind them</em>. Any code in the outer layers that needs to interact with an inner layer is programmed in terms of those elements that are on the boundary. It&#39;s basically the API of the layer.</p><h3>Multiple Screens per Use Case</h3><p>When there&#39;s a multi-step process involved, with several screens, one viable option is to use a standalone data structure for the Input Model, because then you can pass it between multiple views (but read on, there are cases where you might want to do it in a different way).</p><p>Now, collecting input is really a part of the presentation logic. The presentation layer depends on the application business rules layer, in the sense that it will make use of the interfaces defined there. (Again, I&#39;m using the more general notion of &#34;interface&#34;). Specifically, it is going to use the Input Model to pass data to the Interactor. You&#39;d give both the Input Model and the Interactor a more meaningful name, BTW. When implementing presentation layer code, you can pass the input model from screen to screen, and collect user input along the way. Or just could inject it in all the relevant screens at the start, when they are assembled. On the final screen, invoke a method on the Interactor and pass in the data structure containing the complete input for the use case.</p><p>Sometimes, it&#39;s good enough to save the data locally (to prevent loss of work in case of a crash); in other scenarios, you may want to upload it somewhere at certain steps (or after every step). Either way, don&#39;t make <em>assumptions</em> about this; talk to your users, the domain experts, to find out what&#39;s actually necessary, what&#39;s acceptable, and what&#39;s not needed. Don&#39;t make things more complicated then they need to be.</p><p>The process may involve keeping track of some strictly UI/UX-related stuff. E.g. you may need to track if some panel is collapsed or not, or if some data is hidden - but this happens to be just for user convenience (say, it helps them focus on something when they work), and isn&#39;t due to business logic. In that case, it doesn&#39;t make sense to place that kind of data in the Input Model, especially if you are at a stage in the project where the idea of what the UI should be hasn&#39;t stabilized enough - because then whenever you need to introduce a change, the Input Model would get in the way. The idea is confine the UI/UX-specific stuff within the presentation layer. Several options there. You could create a composite structure that contains the Input Model and the extra data. You could derive from the input model if the structure and the language allow it. Or if the language makes it easier that way, you could use a different, specialized data structure to collect the data, and copy the relevant fields to the Input Model in the last step (or if the input model is just a parameter list, pass the relevant properties as parameters). Do the simplest thing that works given the tools at your disposal.</p><p>If you have business logic in a middle step that&#39;s different from the final use case (when all the data is ready), then create a separate use case for it, and call that. On the other hand, if, for example, you need to upload at some middle step, but there&#39;s really no domain logic involved, and it&#39;s all &#34;logistics&#34; or CRUD-like, you can <em>bypass</em> the domain-related core of the application completely, and call a (possibly special-purpose) <a href="https://martinfowler.com/eaaCatalog/gateway.html" rel="noreferrer">Gateway</a> directly. Note that this doesn&#39;t break the dependency rule - coupling within the layer is allowed, but it should be minimized/controlled, as always. If future changes do introduce business logic, restructure and go through the Use Cases layer; if not, just leave it as is.</p><h3>The Flow of Control</h3><blockquote><p>If I were to however only call another use-case to get my additional information instead of passing it back into the presentation layer I would not be able to open another user interface as the use cases don&#39;t even know about it.</p></blockquote><p>I suspect there may be some design problems; e.g., you may have business logic intermingled with presentation logic in your presenters. If so, try to untangle that, but not everywhere at once, but incrementally - start at some small part of the codebase that&#39;s actively being developed, and then fix the others as needed.</p><p>In any case, think about the flow through the application. Also think about the flow of your screens. Sometimes, there will be side effects that need to be shown immediately on the same screen - in that case, push them through the (presentation) Output Port, or use the observer pattern (events). Other times, you just show a completely new screen; you can use the same strategy there, but there&#39;s also an option to pull the data by calling a method on the Interactor.</p><p>If several screens are sharing a use case, then the use case doesn&#39;t need to know anything about the screens being changed (from its perspective, all that is happening is that methods are being called on it by <em>something</em>, at different times). If each screen calls a different Interactor, then the flow is as follows. You invoke a method on an Interactor, it does something, and possibly returns something in one way or another; the UI handles that, and switches to another screen, and then the process repeats, but with a different screen and a different Interactor. Think through these flows, decide what&#39;s presentation logic, what&#39;s business logic, what the use case is really about, and try to find balanced design that&#39;s not too complicated.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-clean-architecture-use-case-containing-the-presenter-or-returning-data/'>Architecture &#8211; Clean Architecture: Use case containing the presenter or returning data</a></li><li class="list-group-item"><a href='../java-clean-architecture-too-many-use-case-classes/'>Java &#8211; Clean Architecture &#8211; Too many Use Case Classes</a></li><li class="list-group-item"><a href='../architecture-uncle-bobs-clean-architecture-composed-entities/'>Architecture &#8211; Uncle Bob&#8217;s clean architecture &#8211; Composed entities</a></li><li class="list-group-item"><a href='../use-case-interactions-in-clean-architecture/'>Use case interactions in clean architecture</a></li><li class="list-group-item"><a href='../architecture-clean-architecture-should-each-view-have-its-own-presenter-and-viewmodel/'>Architecture &#8211; Clean Architecture: Should each view have its own presenter and viewmodel</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>