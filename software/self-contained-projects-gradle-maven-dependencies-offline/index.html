<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Self-contained projects: Gradle &#038; Maven dependencies offline &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068763 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068763" class="post-1068763 software type-software status-publish hentry category-software tag-gradle tag-maven"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Self-contained projects: Gradle &#038; Maven dependencies offline</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">gradle</span><span class="mr-2 badge badge-info">maven</span></p><div class="entry-content"><p>I&#39;m trying to get a Java programming project set up in a way that it can be built completely offline just from the files in version control, on any machine, with no prerequisites to install. (Sole exception: the JDK)</p><p>I don&#39;t know much of Maven, but I&#39;m learning Gradle currently. For the build I&#39;m using Gradle with the wrapper, I modified the <code>gradle-wrapper.properties</code> so the <code>distributionUrl</code> doesn&#39;t point to a remote URL but instead a file within the project&#39;s folder. So Gradle itself is done already.</p><p>For dependencies though, this is a pure nightmare. I&#39;ve already tried managing it with simply directly pointing to single JARs or collections of JARs, but as you sure know this ends up in total confusion if you have interdependencies and/or transitive dependencies.</p><p>Basically what I want to have is Gradle/Maven configured (just for this project) in such a way that they use a different directory for their local dependency cache &#8211; not one that is shared by anything you do on your user account, in your home directory, but instead a folder within the project folder (so I can check that into version control as well) which is only used for that one project. I would then only once take Gradle/Maven in online mode, run the build once to download all the currently needed dependencies into the local cache directory within the project folder (whose contents then are put into VC), then put it in offline mode for all subsequent builds.</p><p>I haven&#39;t found a way yet to reconfigure that local cache path just for this one project (has to be something I can just put into my <code>build.gradle</code>). Anyone have a lead for me?</p><p><strong>Edit:</strong> Another thing would be to have this local repository within the project folder be a &#34;real&#34; Maven repository (instead of just a cache). But that would involve manual work for one way I imagined: You start a local copy of Sonatype Nexus that has a proxying repository set up for any Maven repos you&#39;re referring to in your <code>build.gradle</code>; you modify the repo URLs in your build script to point to your local Nexus, run the build once so Nexus downloads the deps and puts them into its work directory in the &#34;usual&#34; Maven repo structure; then you copy that structure to a folder within your project folder and change the buildscript repo URLs to point to the folder you just copied the files to. Quite a lot of work that can barely be automated.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Alright, so I found a way which works for me, and it&#39;s automatable.</p><p>I found <a href="https://gist.github.com/bmuschko/e4e04abca105c397145e" rel="nofollow noreferrer">this snippet</a> which allows you to create a Gradle task that will copy certain project dependencies to an arbitrary folder in Maven directory structure. I needed to <a href="http://pastebin.com/j6gq08ih" rel="nofollow noreferrer">tweak it slightly</a> (link broken) so it doesn&#39;t just do that for one single configuration, but for any and all configurations the project defines.</p><p>My build script looks like this now:</p><pre><code>apply plugin: &#39;java&#39;

repositories {
    maven {
        url &#39;./dependencies-maven/&#39;
    }
    mavenCentral()
    jcenter()
    // whatever other external repos your deps come from
}

dependencies {
    // ...
}

task offlineRepo (type:OfflineMavenRepository) {
    repoDir = new File(project.projectDir, &#39;dependencies-maven&#39;)
}
</code></pre><p>You then simply fire the <code>offlineRepo</code> task once: all current project dependencies will be downloaded to Gradle&#39;s local cache and then copied into a subfolder in the project directory (in Maven repo structure). The next time you run the build with the project directory in this state, the just-populated local repo will be queried first, and since it contains (should contain) all the deps, nothing should be taken from the Gradle&#39;s user folder cache nor from the web.</p><p>At this point you can take the whole project folder to any other machine with just Gradle installed and it should be able to do the build without ever going online to fetch some additional data.</p><p>Whenever you want to update some project dependency or add new ones, you&#39;ll just need to fire the <code>offlineRepo</code> task once again. Be aware that this won&#39;t delete the old version of the dependency you update, so if you don&#39;t want to end up with a cluttered repo, you need to do some manual cleaning here.</p><p>With this, plus putting the Gradle wrapper offline as well (described in my original question), I&#39;ve now made my project buildable completely offline and with minimal prerequisites: no internet connectivity required, not even a Gradle install required. Merely the JDK.</p><p><strong>Note:</strong> When I set this up in a completely empty dummy project, I had to create a java source directory and some sample java file, otherwise Gradle would only download/copy some POMs but not the corresponding JARs.</p><p><strong>Addition:</strong> The tweaked snippet will only take care of project dependencies. But if you use a custom plugin, which is a buildscript dependency, the script will miss it. You&#39;ll need to add more code to the <code>build()</code> method:</p><pre><code>for(Configuration configuration : project.buildscript.configurations.findAll())
{
    copyJars(configuration)
    copyPoms(configuration)
}
</code></pre><hr/><p><strong>Edit, December 2019:</strong> Three years later after a good bunch of upvotes over the whole time and now an explicit request, it appears this topic is still important not only to me.</p><p>To avoid link breakage, I will post the current version of my project skeleton setup right here.</p><p>The following assumes you are starting with a blank slate / empty folder that is supposed to be your future project directory. All paths I specify here are relative to the project root folder.</p><ol><li>Get a <code>gradle-wrapper.jar</code> and place it in <code>/gradle/wrapper</code>. Place the accompanying <code>gradlew</code> and <code>gradlew.bat</code> run scripts in the project&#39;s root folder. Either grab those directly if you have them around somewhere, or install Gradle on your local system and run <code>gradle wrapper</code> in your project&#39;s root folder to generate these files. (You do not need to install Gradle locally if you can get the wrapper jar and scripts from somewhere else, and even if not, this is a one-time job. Once the wrapper is in place, there is no more need for a local Gradle installation.)</li><li>Grab a Gradle binary distribution package (file name like <code>gradle-X.X-bin.zip</code>) from somewhere and place it in <code>/gradle/wrapper/</code>.</li><li><p>Create (or modify an existing) <code>/gradle/wrapper/gradle-wrapper.properties</code> to contain the following:</p><pre><code>distributionBase=PROJECT
distributionPath=gradle/wrapper/dists
zipStoreBase=PROJECT
zipStorePath=gradle/wrapper/dists
distributionUrl=./gradle-X.X-bin.zip
</code></pre><p>(The file name specified in <code>distributionUrl</code> obviously is just a placeholder and has to match the actual filename or the binary distribution package you used in step 2.) (You can alternatively set both <code>distributionBase</code> and <code>zipStoreBase</code> to <code>GRADLE_USER_HOME</code> to avoid having those temp files created in your project&#39;s folder; they will be created in your home folder instead.)</p></li><li><p>Make sure you exclude certain temporary files and directories from version control. I myself am using Git, so my example ignore-file is for Git. Adjust as needed if you are using a different version control system:</p><pre><code>.gradle/
gradle/wrapper/dists/
build/
buildSrc/.gradle
buildSrc/build/
</code></pre></li><li><p>Add the file <code>/buildSrc/src/main/groovy/buildutils/OfflineMavenRepository.groovy</code> with following contents (this is bmuschko&#39;s code linked above with all my proposed modifications applied to it):</p><pre><code>package buildutils

import org.gradle.api.tasks.Input
import org.gradle.api.tasks.Optional
import org.gradle.api.tasks.OutputDirectory
import org.gradle.api.tasks.TaskAction
import org.gradle.api.DefaultTask
import org.gradle.util.GFileUtils
import org.gradle.api.artifacts.Configuration
import org.gradle.api.artifacts.component.ModuleComponentIdentifier
import org.gradle.maven.MavenModule
import org.gradle.maven.MavenPomArtifact

class OfflineMavenRepository extends DefaultTask {
    @OutputDirectory
    File repoDir = new File(project.projectDir, &#39;dependencies/maven&#39;)

    @TaskAction
    void build() {
        // Plugin/Buildscript dependencies
        for(Configuration configuration : project.buildscript.configurations.findAll())
        {
            copyJars(configuration)
            copyPoms(configuration)
        }

        // Normal dependencies
        for(Configuration configuration : project.configurations.findAll())
        {
            copyJars(configuration)
            copyPoms(configuration)
        }
    }

    private void copyJars(Configuration configuration) {
        configuration.resolvedConfiguration.resolvedArtifacts.each { artifact -&gt;
            def moduleVersionId = artifact.moduleVersion.id
            File moduleDir = new File(repoDir, &#34;${moduleVersionId.group.replace(&#39;.&#39;,&#39;/&#39;)}/${moduleVersionId.name}/${moduleVersionId.version}&#34;)
            GFileUtils.mkdirs(moduleDir)
            GFileUtils.copyFile(artifact.file, new File(moduleDir, artifact.file.name))
        }
    }

    private void copyPoms(Configuration configuration) {
        def componentIds = configuration.incoming.resolutionResult.allDependencies.collect { it.selected.id }

        def result = project.dependencies.createArtifactResolutionQuery()
            .forComponents(componentIds)
            .withArtifacts(MavenModule, MavenPomArtifact)
            .execute()

        for(component in result.resolvedComponents) {
            def componentId = component.id

            if(componentId instanceof ModuleComponentIdentifier) {
                File moduleDir = new File(repoDir, &#34;${componentId.group.replace(&#39;.&#39;,&#39;/&#39;)}/${componentId.module}/${componentId.version}&#34;)
                GFileUtils.mkdirs(moduleDir)                
                File pomFile = component.getArtifacts(MavenPomArtifact)[0].file
                GFileUtils.copyFile(pomFile, new File(moduleDir, pomFile.name))
            }          
        }
    }
}
</code></pre></li><li><p>Create your <code>/build.gradle</code> skeleton as follows:</p><pre><code>repositories {
    maven {
        url &#39;./dependencies/&#39;
    }

    mavenLocal()
    mavenCentral()
    jcenter()
}

buildscript {
    repositories {
        maven {
            url &#39;./dependencies/&#39;
        }

        mavenLocal()
        mavenCentral()
        jcenter()
    }
}

import buildutils.OfflineMavenRepository
task offlineDependencies (type:OfflineMavenRepository) {
    repoDir = new File(project.projectDir, &#39;dependencies/&#39;)
}
</code></pre></li><li><p>Add your additional online dependency repos, dependencies and other build logic to your <code>build.gradle</code>, then run <code>./gradlew offlineDependencies</code>. This will create a folder structure within <code>/dependencies/</code> and download and place all the dependency JARs inside. You only have to do this once to get the files there; once they are in place, you will only need to run this command again if your project&#39;s dependencies change (i.e. additional dependency or version change).</p></li><li>Check everything in version control and you should be good. Only requirement for building the project is a working Java JDK on your system. Gradle is contained within your project&#39;s directory (usable via the wrapper), so are all your Maven dependencies.</li></ol></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../creating-java-ee-projects-with-maven/'>Creating Java EE Projects with Maven</a></li><li class="list-group-item"><a href='../managing-maven-dependencies-between-multiple-components-with-multiple-teams-making-changes/'>Managing Maven dependencies between multiple components with multiple teams making changes</a></li><li class="list-group-item"><a href='../sharing-dependency-configuration-over-multiple-projects-maven/'>Sharing dependency configuration over multiple projects (Maven)</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>