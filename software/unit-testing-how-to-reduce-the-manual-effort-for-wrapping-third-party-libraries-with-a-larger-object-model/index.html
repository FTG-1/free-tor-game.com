<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; How to reduce the manual effort for wrapping third party libraries with a larger object model &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087203 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087203" class="post-1087203 software type-software status-publish hentry category-software tag-third-party-libraries tag-unit-testing tag-wrapper"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; How to reduce the manual effort for wrapping third party libraries with a larger object model</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">third-party-libraries</span><span class="mr-2 badge badge-info">unit testing</span><span class="mr-2 badge badge-warning">wrapper</span></p><div class="entry-content"><p>Like the author of <a href="https://softwareengineering.stackexchange.com/questions/174733/is-wrapping-a-third-party-code-the-only-solution-to-unit-test-its-consumers">this question from 2012</a> <a href="https://softwareengineering.stackexchange.com/questions/216639/unit-testing-code-that-relies-on-untestable-3rd-party-code/218198">and this one from 2013</a>, I have a 3rd party library that I need to wrap in order to properly test my application. The top answer states:</p><blockquote><p>You always want to wrap third party types and methods behind an<br /> interface. This can be tedious and painful. Sometimes you can write a<br /> code generator or use a tool to do this.</p></blockquote><p>In my case, the library is for an object model and consequently has a larger number of classes and methods that would need to be wrapped for this strategy to be successful. Beyond merely &#34;tedious and painful&#34;, this becomes a hard barrier to testing.</p><p>In the 4 years since this question, I&#39;m aware that isolation frameworks have come a long way. My question is: does there now exist a simpler way to achieve the effect of full wrapping of 3rd party libraries? How can I take the pain out of this process and reduce the manual effort?</p><hr/><p>My question is not a duplicate of the questions I initially linked to, since my one is about reducing the manual effort of wrapping. Those other questions only ask if wrapping make sense, not how the effort can be kept small.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Assuming you&#39;re not looking for a mocking framework, because they&#39;re <a href="https://www.google.com/search?q=mocking+frameworks&amp;oq=mocking+frameworks&amp;aqs=chrome..69i57j0l5.2710j0j7&amp;sourceid=chrome&amp;ie=UTF-8" rel="nofollow noreferrer">ultra-ubiquitous and easy to find</a>, there are a few things worth noting up front:</p><ol><li><strong>There is &#34;never&#34; anything you should &#34;always&#34; do.</strong><br/>It&#39;s not always best to wrap up a third party library. If your application is intrinsically dependent on a library, or if it&#39;s literally built around one or two core libraries, don&#39;t waste your time wrapping it up. If the libraries change, your application will need to change <em>anyway.</em></li><li><strong>It is OK to use integration tests.</strong><br/>This is especially true around boundaries that are stable, intrinsic to your application, or cannot be easily mocked. If those conditions are met, wrapping and mocking <em>will</em> be complicated and tedious. In that case, I&#39;d avoid both: don&#39;t wrap and don&#39;t mock; just write integration tests. (If automated testing is a goal.)</li><li><strong>Tools and framework cannot eliminate logical complexity.</strong><br/>In principle, a tool can only cut down on boilerplate. But, there&#39;s no automate-able algorithm for taking a complex interface and making it simple -- let alone taking interface X and adapting it to suit <em>your needs.</em> (Only you know <em>that</em> algorithm!) So, while there are undoubtedly tools that can generate <em>thin wrappers,</em> I&#39;d suggest that they&#39;re not already ubiquitous because, in the end, you still need to just code intelligently, and therefore manually, against the interface <em>even if it&#39;s hidden behind a wrapper.</em></li></ol><p>That said, there are <em>tactics</em> you can use in many languages to avoid referring directly to a class. And in some cases, you can &#34;feign&#34; an interface or thin wrapper that <em>doesn&#39;t actually exist.</em> In C#, for example, I would go one of two routes:</p><ol><li><strong>Use a factory and <a href="https://msdn.microsoft.com/en-us/library/bb383973.aspx" rel="nofollow noreferrer">implicit typing</a>.</strong></li></ol><p>You can avoid the effort of fully wrapping a complex class with this little combo:</p><pre><code>// &#34;factory&#34;
class PdfDocumentFactory {
  public static ExternalPDFLibraryDocument Build() {
    return new ExternalPDFLibraryDocument();
  }
}

// code that uses the factory.
class CoreBusinessEntity {
  public void DoImportantThings() {
    var doc = PdfDocumentFactory.Build();

    // ... i have no idea what your lib does, so, I&#39;m making stuff but.
    // but, you can do whatever you want here without explicitly
    // referring to the library&#39;s actual types.
    doc.addHeader(&#34;Wee&#34;);
    doc.getAllText().makeBiggerBy(4).makeBold().makeItalic();
    return doc.exportBinaryStreamOrSomething();
  }
}
</code></pre><p>If you can avoid storing these objects as members, either through a more &#34;functional&#34; approach or by storing them in a dictionary (or <em>whatever</em>), this approach has the benefit of compile-time type checking without your core business entities needing to know <em>exactly</em> what class they&#39;re working with.</p><p>All that is required is that, at compile time, the class returned by your factory actually has the methods on it that your business object is using.</p><ol start="2"><li><strong>Use <a href="https://msdn.microsoft.com/en-us/library/dd264741.aspx" rel="nofollow noreferrer">dynamic typing</a>.</strong></li></ol><p>This is in the same vein as using <em>implicit typing</em>, but involves another tradeoff: You lose compile-type checks and gain the ability to anonymously add external dependencies as class members and <em>inject</em> your dependencies.</p><pre><code>class CoreBusinessEntity {
  dynamic Doc;

  public void InjectDoc(dynamic Doc) {
    Doc = doc;
  }

  public void DoImortantThings() {
    Doc.addHeader(&#34;Wee&#34;);
    Doc.getAllText().makeBiggerBy(4).makeBold().makeItalic();
    return Doc.exportBinaryStreamOrSomething();
  }
}
</code></pre><p>With both of these tactics, when it comes time to mock <code>ExternalPDFLibraryDocument</code>, as I stated earlier, you have some work to do -- but, it&#39;s work you&#39;d need to do <em>anyway</em>. And, with this construction, you&#39;ve avoided tediously defining 100&#39;s of thin little wrapper classes. You&#39;ve simply <em>used</em> the library without looking directly at it -- <em>for the most part.</em></p><p><strong>With all of that said,</strong> there are three big reasons I would still consider explicitly wrapping up a third party library -- none of which would hint at using a tool or framework:</p><ol><li><strong>The specific library is not <em>intrinsic</em> to the application.</strong></li><li><strong>It would be <em>very</em> expensive to swap without wrapping it up.</strong></li><li><strong>I don&#39;t like the API itself.</strong></li></ol><p>If I don&#39;t have some level concern in all three of those areas, you <em>don&#39;t</em> make any <em>significant</em> effort to wrap it up. And, if you have some concern in all three areas, an auto-generated thin wrapper isn&#39;t really going to help.</p><p>If you&#39;ve decided to wrap a library up, the most efficient and effective use of your time is to <strong>build your application against the interface you <em>want</em>; <em>not against an existing API.</em></strong></p><p>Put another way, heed the classical advice: <strong>Postpone every decision you can.</strong> Build the &#34;core&#34; of your application first. Code against interfaces that will <em>eventually</em> do what you want, which will <em>eventually</em> be fulfilled by &#34;peripheral stuff&#34; that doesn&#39;t exist yet. Bridge the gaps as-needed.</p><p>This effort may not <em>feel</em> like time-saved; but if you feel you need a wrapper, this is the most efficient way to do it <em>safely.</em></p><p><strong>Think of it this way.</strong></p><p>You need to code against this library in some dark corner of your code -- <em>even if it&#39;s wrapped up.</em> If you mock the library during testing, there&#39;s unavoidable manual effort there -- <em>even if it&#39;s wrapped up.</em> But, that doesn&#39;t mean you need to directly acknowledge that library <em>by name</em> throughout the bulk of your application.</p><p><strong>TLDR</strong></p><p>If the library is worth wrapping, use <em>tactics</em> to avoid widespread, direct references to your 3rd party library, but don&#39;t take shortcuts to generate thin wrappers. Build your business logic first, be deliberate about your interfaces, and emerge your adapters organically, <em>as needed.</em></p><p>And, if it comes to it, don&#39;t be afraid of integration tests. They&#39;re a little fuzzier, but they still offer evidence of working code, and they can still easily be made to keep regressions at bay.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/object-oriented-is-wrapping-a-third-party-code-the-only-solution-to-unit-test-its-consumers/'>Object-oriented &#8211; Is wrapping a third party code the only solution to unit test its consumers</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/object-oriented-considered-third-party-code/'>Object-oriented &#8211;  considered third party code</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-how-to-test-parts-of-the-application-against-the-output-of-third-party-application/'>C# &#8211; How to test parts of the application against the output of third party application</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>