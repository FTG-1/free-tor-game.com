<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>DDD and MediatR &#8211; where the Validation and Business Logic go &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087633 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087633" class="post-1087633 software type-software status-publish hentry category-software tag-business-logic tag-clean-architecture tag-domain-driven-design tag-validation"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">DDD and MediatR &#8211; where the Validation and Business Logic go</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">business-logic</span><span class="mr-2 badge badge-info">clean-architecture</span><span class="mr-2 badge badge-warning">domain-driven-design</span><span class="mr-2 badge badge-primary">validation</span></p><div class="entry-content"><p>I&#39;m trying to get to grips with Domain Driven Design and MediatR.  A reaction to being involved with applications that favour Services for almost everything.  I see so much value in DDD and I&#39;m trying to increase my understanding to write better more maintainable software.<br /> For software context I&#39;m using a .netcore Razor Pages application (trying to use Clean Architecture layout).<br /> For business context I&#39;m dealing with Memorials and ServicePersons. Memorials have RecordedNames (link table with additional properties). Memorial -&gt; RecordedNames &lt;-ServicePerson</p><p><strong>The thing I&#39;m trying to work out is where best the validations and business rules ought to go.</strong></p><p>There&#39;s the 2 types of validation I have in mind:</p><ol><li>Request validation &#8211; e.g. An email field is [required] and is it a [valid email address].</li><li>Business rules &#8211; shouldn&#39;t add the same person to the same List.</li></ol><h2>Request Validation</h2><p>Initial thoughts are:<br /> Options:</p><ol><li>PageModel properties/ViewModel &#8211; Similar to each other</li><li>MediatR Pipeline -Pre with Fluent Validation.</li></ol><p>One of the nice things about using PageModel properties with attributes validation is it gives the client side unobtrusive out the box too.  But it&#39;s at the expense of writing mapping code for each operation like this into the PageModel class properties.</p><p>Whereas when I consider using MediatR pipeline to do Request Validation, I would need to handle that all separately and more manually.</p><h2>Business Rules</h2><p><em>E.g. We shouldn&#39;t add the same person to the same memorial more than once.</em></p><ol><li>Have them in the Domain of Aggregates/entities/ValueObjects &#8211; MediatR just acts as a handler between the UI and the Domain object.</li><li>Use MediatR Command and have the business logic there.  However this feels like it starts to fragment the Domain business rules, but looks like the norm with MediatR.  With that in mind I then start to wonder about the value of adding MediatR in, so as much as anything I&#39;m trying to understand MediatR&#39;s strengths too.</li></ol><h3>Thoughts so far</h3><p><a href="../../../i.stack.imgur.com/SZJYF.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/SZJYF.png" alt="Possible MediatR flow within DDD"/></a></p><h3>Lastly</h3><p>A colleague is pushing for the Aggregate Domain Objects to be used in the PageModel, which just feels all kinds of wrong.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I expect the reason you aren&#39;t seeing benefits of MediatR is that the diagram shows a &#34;layered&#34; approach where your domain logic sits on top of a repository, which usually means domain classes all have a repository interface injected into their constructor by an IoC container.</p><p>A common disadvantage of a layered approach is that business logic must necessarily depend upon a repository interface (perhaps interfaces to other APIs too) and be responsible for triggering queries and updates to/from that repository.   This is a potential design smell because in most cases, the orchestration of data persistence aren&#39;t domain rules or business logic.  This is something MediatR is designed to avoid.</p><p>MediatR is a broker which exists as the focal point in the middle of <strong>everything</strong>; handling all orchestration and communication between different, disconnected components that have absolutely no interaction with each other whatsoever nor knowledge of each others&#39; interfaces;  They have no injected dependencies except for those which are absolutely essential.</p><p>For example, most classes may require an injected Logger.   A repository may require a DB Connection Factory.   But a domain class being concerned only with business logic really shouldn&#39;t need a repository since that breaks the separation-of-concerns between business rules and orchestration.</p><p>Using MediatR, the Domain Model can remain &#39;pure&#39; by being concerned with business logic and rules only.  Domain classes can operate without any side-effects (except for logging) since they will not be triggering any queries to any repositories, nor triggering any updates into a repository, nor triggering any downstream APIs or other external components, nor indeed any other concerns which aren&#39;t solely around business rules and domain logic.</p><p>This is ideal for isolating the business rules and ensuring the domain model remains agnostic to wider technical concerns and systems which surround it. In particular, removing repository interfaces from business logic classes reduces the complexity of building automated testing for business rules too by eliminating the need for mocking various interfaces for repositories, APIs, etc.</p><p>The responsibility for triggering a query from a repository or API to obtain data which needs to feed into the domain model rests solely within the remit of a MediatR handler.   Again, MediatR is the only place where any orchestration happens between different components, so if the business rules require any additional data or state from elsewhere, then that query would be triggered by a separate MediatR handler which sends another event.</p><p>Again, MediatR, is the focal point of orchestration - the central idea is that MediatR adds extra levels of indirection which provide almost complete de-coupling between all the major components of the application.    The UI, the domain model and the repository are all entirely disconnected and unaware of each others&#39; interfaces or existence.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../where-to-put-format-validation-in-a-cqrs-stylish-domain-model/'>Where to put format validation in a CQRS “stylish” domain model</a></li><li class="list-group-item"><a href='../where-should-business-logic-go-in-a-layered-architecture/'>Where should business logic go in a layered architecture</a></li><li class="list-group-item"><a href='../in-ddd-is-validation-application-logic-or-domain-logic/'>In DDD, is validation application logic, or domain logic</a></li><li class="list-group-item"><a href='../ddd-domain-models-and-business-logic/'>DDD Domain Models and Business Logic</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>