<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>A simple approach for data synchronisation &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068126 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068126" class="post-1068126 software type-software status-publish hentry category-software tag-client-server tag-synchronization"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">A simple approach for data synchronisation</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">client-server</span><span class="mr-2 badge badge-info">synchronization</span></p><div class="entry-content"><p>I want to synchronise the local database of mobile devices with the server&#39;s database. This synchronisation will happen for example when user comes online, to update the local as well as the remote database with possible changes.</p><p>I thought about 2 approaches and already implemented 1 of them, but it&#39;s quite complicated and I fear a bit about its performance and error-proneness.</p><p><strong>Approach 1.</strong></p><p>The approach I implemented does all the <strong>synchronisation in the server</strong>. I&#39;ll store in the client&#39;s database the last server update timestamp for each item and a flag for items that are marked for removal. I send all my items &#8211; with their timestamps and flags &#8211; to the server, and the server then decides which items have to be inserted, updated &#8211; only if the last update timestamp of the client is equal to the last update timestamp stored in the server (meaning the client has the latest version of the item) and what has to be deleted. Then I do a fresh query to the database and send everything back to the client. The client overwrites it&#39;s local database with the result. In detail:</p><ol><li><p>Client sends all its items to server (this could be refined by filtering items that need create/update/delete, but for now it sends everything). Items have a server last update timestamp and flag if it&#39;s marked to be deleted.</p></li><li><p>Server queries all the items for the user</p></li><li><p>Programmatic algorithm that goes through all the items checking timestamps in order to determine if the item can be updated/deleted or not. If the last server update timestamp in the client&#39;s item is different than the one stored in the server (meaning, someone else updated the item in between) the update/delete is rejected. I build many lists here, one of items that have to be inserted (items are not in the server&#39;s query result), items that are to be updated, items that are to be deleted, items that can&#39;t be updated because the timestamp is different, items that can&#39;t be deleted because the timestamp is different.</p></li><li><p>Transaction for inserts/updates/deletes, for which I use lists constructed in 3.</p></li><li><p>Query to get again all the items for the user.</p></li><li><p>Send result of this query to client, together with the lists of items that couldn&#39;t be updated or deleted built in 3., so client knows what failed.</p></li></ol><p>The problem with this approach is the multiple queries and programmatic processing, another client (some items can have multiple users) could update something in between these queries and updates can get lost. I assume I have to compact my queries (try to somehow do everything in a single transaction, maybe use stored procedures?) and lock rows to avoid synchronisation issues. My knowledge of SQL doesn&#39;t go much further than <code>select...where</code> and <code>join</code> so I may me missing a better way to do this.</p><p><strong>Approach 2.</strong></p><p>Because of these complications I was thinking if there&#39;s maybe a simpler way. The other idea I had, was to do the <strong>synchronisation in the client</strong>. So I&#39;d do first query all my data and do an update (for which I still need the last update timestamp and delete flags &#8211; only this time the sync logic is in the client and I don&#39;t have to worry about multiple users here), and then send the sync result to the server which will just do an overwrite. In detail:</p><ol><li><p>Download items for user</p></li><li><p>Do sync alhorithm in the client, similar to what I do in the server in 3. (Approach 1).</p></li><li><p>Upload items to the server, server overwrites user&#39;s items with this.</p></li></ol><p>The problem here, of course, is that another client can update items in the server while this client is doing sync, and when it uploads the results, the updates of former client will be lost. I thought maybe I can work around this with a hash, so the downloaded data has a hash and when the database is to be overwritten with the sync result I do a query first and check it&#39;s the same hash, if not return an error. But then again I&#39;m with multiple queries in the server and not sure this a recommended way.</p><p>I&#39;d appreciate thoughts on this matter. Is my current approach the best? Or should I rather go with the client sync (this would also reduce workload in the server, which is good), but then how do I avoid possible overwrites, is the hash a good idea?  Note that my app doesn&#39;t have super strict requirements, it&#39;s something like shared todo lists with a few additional features, nothing generic (like a file sharing service) or for health, science etc. so if once in a (long) while an update is lost it&#39;s not the end of the world. I care a little more about performance and implementation easiness than 100% correctness. Of course the less error prone, the better.</p><p>P.S. would also appreciate reading recommendations about this (maybe as a comment), any good resource about sync strategies. I&#39;m using Scala, Play 2.4 and Akka in some parts so a recommendation in this direction would also be very useful.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><ul><li>Syncing between multiple clients is a very complext task.</li><li>Let&#39;s not call it syncing, let&#39;s call it bash transaction processing.</li><li>Let&#39;s get rid of <em>&#34;last server update timestamp&#34;</em>, let&#39;s just every transaction be inserted into a pre-process table with a timestamp generated by the server.</li><li>Let&#39;s make it asyncronous. If data is processed fast enough, users shouldn&#39;t notice.</li><li>Client generates a job id (hash of userid plus timestamp plus some other randon data), and pushes it to the server.</li><li>Server saves the job id in a jobs table and assigns it a timestamp</li><li><p>Client sends transactions that will be in that job <a href="../../../i.stack.imgur.com/pWgWn.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/pWgWn.png" alt="enter image description here"/></a></p><p>ITEM ID is client generated using a hash function the same way job id was generated.</p></li><li><p>A process that runs, say every few seconds gets the more recent pending job, and proceeds to process all transactions.</p></li><li>Transactions that couldn&#39;t be done because the ITEM was previously erased are inserted in a rejects table</li><li>Current data after transaction is pushed to client including rejections (client data is deleted and new data is inserted, client perceives it as a refresh)</li><li>A jobs can be transanction-less, meaning it&#39;s only a refresh request.</li><li>Overwrites cannot be avoided but you can opt to duplicate entries when a conflict arises instead of overwriting the older version of an item.</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../best-practice-patterns-for-two-way-data-synchronisation/'>Best practice/Patterns for two way data synchronisation</a></li><li class="list-group-item"><a href='../database-implementation-details-of-database-synchronisation-api/'>Database &#8211; Implementation details of database synchronisation API</a></li><li class="list-group-item"><a href='../rest-a-separate-endpoint-specifically-for-sync-in-a-rest-api/'>Rest &#8211; A separate endpoint specifically for sync in a REST api</a></li><li class="list-group-item"><a href='../generation-of-ids-in-offline-online-application/'>Generation of ids in offline/online application</a></li><li class="list-group-item"><a href='../whats-the-best-way-to-track-updates-when-syncing-data-from-mysql-remote-server-to-local-sqlite-database/'>What&#8217;s the best way to track updates when syncing data from MySQL remote server to local SQLite database</a></li><li class="list-group-item"><a href='../java-synchronisation-with-offline-system/'>Java &#8211; Synchronisation with offline system</a></li><li class="list-group-item"><a href='../technique-to-sync-medium-large-amounts-of-data/'>Technique to sync medium/large amounts of data</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>