<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Why is Throwable initCause designed to be called only once &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075063 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075063" class="post-1075063 software type-software status-publish hentry category-software tag-exception-handling tag-exceptions tag-java tag-language-design tag-language-features"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Why is Throwable initCause designed to be called only once</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">exception handling</span><span class="mr-2 badge badge-info">exceptions</span><span class="mr-2 badge badge-warning">java</span><span class="mr-2 badge badge-primary">language-design</span><span class="mr-2 badge badge-danger">language-features</span></p><div class="entry-content"><p>I find it really odd that the <code>initCause</code> method of Java&#39;s <code>Throwable</code> class can only be called once, or even not at all (if the constructor accepting a <code>Throwable</code> was used). This makes exception chaining not as easy as I think it should be.</p><pre><code>private Throwable cause = this;

public Throwable(String message, Throwable cause) {
    ...
    this.cause = cause;
}

public Throwable getCause() {
    return (cause==this ? null : cause);
}

public synchronized Throwable initCause(Throwable cause) {
    if (this.cause != this)
        throw new IllegalStateException(&#34;Can&#39;t overwrite cause&#34;);
    if (cause == this)
        throw new IllegalArgumentException(&#34;Self-causation not permitted&#34;);
    this.cause = cause;
    return this;
}
</code></pre><p>It leads to ugly boilerplate code that has to take care of edge cases where the method <em>may</em> have already been called, but the part of the code where you want to call it again, you&#39;re not sure.</p><p>What is worse is that the <code>getCause</code> method does not correctly tell you whether <code>initCause</code> method had been called or not. This is because someone else could have called <code>initCause(null)</code> and this would make <code>getCause</code> to return <code>null</code> while at the same time have <code>initCause</code> fail with <code>IllegalStateException</code> (because <code>null != this</code> is true).</p><p>The result is a boilerplate code as follows:</p><pre><code>try {
    exp1.initCause(exp2);
} catch (IllegalStateException ise) {
    // do something or ignore
} catch (IllegalArgumentException iae) {
    // do something or ignore
}
</code></pre><p>Whereas I should be able to simply call <code>exp1.initCause(exp2);</code> without caring whether it&#39;s the same exception or the method had already been called (and let the method take care of what to do if either of the condition was true; <em>for example</em> simply ignore the new cause).</p><p><strong>What is the reason behind such an odd design?</strong></p><p><strong><em>Edit:</em></strong></p><p>I would like to clarify that I don&#39;t have a problem with the cause being immutable. My problem is that, ensuring such immutability is not violated is made a burden for the programmers, rather than being handled automatically by the implementation.</p><p>It would have made more sense to me if the cause was implemented as follows:</p><pre><code>private Throwable cause; // null means no cause

public Throwable(String message, Throwable cause) {
    ...
    this.cause = cause;
}

public Throwable getCause() {
    return cause;
}

public synchronized Throwable initCause(Throwable cause) {
    if (this.cause == null)
        this.cause = cause;
    return this;
}
</code></pre><p>Or even if the <strong>original</strong> implementation was kept, a handy method could have been added:</p><pre><code>public boolean hasCause() {
    return (this.cause != this);
}
</code></pre><p>So that I could reduce the boilerplate code to simply:</p><pre><code>if (!exp1.hasCause()) exp1.initCause(exp2);
</code></pre><p>I would also like to clarify that this is not a question of which Java version I should be using, or whether I should continue using versions of Java that have reached their support&#39;s end-of-life. There are many reasons why older versions of Java continue to be used other than <em>&#34;lazy to upgrade&#34;</em> or <em>&#34;don&#39;t care about security&#34;</em>. <code>:)</code></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>What is the reason behind such an odd design?</p></blockquote><p>It is not an odd design. The cause should be immutable since user code playing with the cause will most likely always cause more harm than good and will break the semantic of the cause.</p><p>The explanation of the existence of the <code>initCause</code> method can be found in the <code>Throwable</code> javadoc:</p><blockquote><p>Because the <code>initCause</code> method is public, it allows a cause to be associated with any throwable, even a &#34;legacy throwable&#34; whose implementation predates the addition of the exception chaining mechanism to <code>Throwable</code>.</p></blockquote><p>Indeed, exception chaining has only been added in Java 1.4. Before that, an exception did not had a cause.</p><p>They had to add this method for compatibility reason. You could still use an old exception without the cause parameter in the constructor but still set the cause later on.</p><p>Regarding your use case, what you want to use are <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html#addSuppressed%28java.lang.Throwable%29" rel="nofollow">suppressed exceptions</a>. They have been added in Java 7 to handle your exact use case (see try-with-catch documentation for example).</p><p>If you are using an end-of-life version of Java, you can add a similar mechanism to your own exception (or upgrade to a non end-of-life version).</p><p>If you really really want to break the exception chaining semantic you can always create a new exception with a composite/hacked cause and throw it.</p><p><strong>TL;DR:</strong> Cause should be immutable that&#39;s why this check is done in <code>initCause</code>. Hacking the cause is not the good way to handle suppressed exceptions and will usually cause lot of trouble. It was a major flaw of Java older than version 7, like the lack of chained exceptions was before Java 1.4.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../using-a-try-finally-without-catch-vs-enum-state-validation/'>Using a try-finally (without catch) vs enum-state validation</a></li><li class="list-group-item"><a href='../java-generic-decorator-implementation/'>Java &#8211; Generic decorator implementation</a></li><li class="list-group-item"><a href='../java-better-way-to-define-an-exception-thrown-by-a-method-in-java/'>Java &#8211; better way to define an exception thrown by a method in Java</a></li><li class="list-group-item"><a href='../java-why-doesnt-java-string-have-static-string-manipulation-methods/'>Java &#8211; Why doesn&#8217;t Java String have static string manipulation methods</a></li><li class="list-group-item"><a href='../java-exception-versus-return-code-in-dao-pattern/'>Java &#8211; Exception versus return code in DAO pattern</a></li><li class="list-group-item"><a href='../java-can-dto-contain-additional-helper-methods/'>Java &#8211; Can DTO contain additional helper methods</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>