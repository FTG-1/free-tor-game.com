<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Object Initializer in C# problem with readability &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070174 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070174" class="post-1070174 software type-software status-publish hentry category-software tag-asp-net tag-c"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Object Initializer in C# problem with readability</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net</span><span class="mr-2 badge badge-info">c</span></p><div class="entry-content"><p>I wonder if object initializing have some performance gain in ASP.NET website. I have an office mate that told me that object initialization is much readable and faster than constructor. But one of my office mate disagree with that and said that it always depends.<br /> For example I am doing this:</p><pre><code>using (var dataAccess = new DatabaseAccess { ConnectionString = ConfigurationManager.ConnectionStrings[&#34;test&#34;].ConnectionString, Query = query, IsStoredProc = true })
{
    //some code here
}
</code></pre><p>Is it better if I will do this way?</p><pre><code>using (var dataAccess = new DatabaseAccess())
{
    dataAccess.ConnectionString = ConfigurationManager.ConnectionStrings[&#34;test&#34;].ConnectionString;
    dataAccess.Query = query;
    dataAccess.IsStoredProc = true;
}
</code></pre><p>Thanks in advance guys!</p><p>&#8212;<strong>EDIT</strong>&#8212;-</p><p>is this somehow much better:</p><pre><code>using (
    var dataAccess = new DatabaseAccess 
    {
        ConnectionString = ConfigurationManager.ConnectionStrings[&#34;test&#34;].ConnectionString,
        Query = query,
        IsStoredProc = true
    }
)
{
    //some code here
}
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h2>Stop!</h2><p>You have a bigger problem than the readability. <strong>It looks like you don&#39;t understand how object initializers work.</strong></p><p>Let&#39;s create a disposable class which traces its execution:</p><pre><code>public class Demo : IDisposable
{
    private string hello;

    public Demo()
    {
        Debug.WriteLine(&#34;The parameterless constructor was called.&#34;);
    }

    public Demo(string hello)
        : this()
    {
        Debug.WriteLine(&#34;The constructor with parameters was called.&#34;);
        this.Hello = hello;
    }

    public string Hello
    {
        get
        {
            Debug.WriteLine(&#34;The getter was called.&#34;);
            return this.hello;
        }

        set
        {
            Debug.WriteLine(&#34;The setter was called.&#34;);
            this.hello = value;
            throw new NotImplementedException();
        }
    }

    public void Dispose()
    {
        Debug.WriteLine(&#34;The disposer was called.&#34;);
    }
}
</code></pre><p>Now, let&#39;s write an app which initializes this class in three different ways (sorry, it&#39;s too big; I&#39;ll explain it more in details later):</p><pre><code>public static class Program
{
    // --- Interesting stuff ---
    private static void WithPropertiesInitialization()
    {
        using (var demo = new Demo())
        {
            demo.Hello = &#34;Hello World!&#34;;
            // Do nothing.
        }
    }

    private static void WithObjectInitializer()
    {
        using (var demo = new Demo { Hello = &#34;Hello World!&#34; })
        {
            // Do nothing.
        }
    }

    private static void WithConstructor()
    {
        using (var demo = new Demo(&#34;Hello World!&#34;))
        {
            // Do nothing.
        }
    }

    // --- Not so interesting stuff ---
    public static void Main()
    {
        Debug.Listeners.Add(new TextWriterTraceListener(Console.Out));

        Console.WriteLine(&#34;With constructor:&#34;);

        try
        {
            WithConstructor();
        }
        catch (NotImplementedException)
        {
        }

        Console.WriteLine();
        Console.WriteLine(&#34;With object initializer:&#34;);

        try
        {
            WithObjectInitializer();
        }
        catch (NotImplementedException)
        {
        }

        Console.WriteLine();
        Console.WriteLine(&#34;With properties initialization:&#34;);

        try
        {
            WithPropertiesInitialization();
        }
        catch (NotImplementedException)
        {
        }

        Console.WriteLine();
        Console.WriteLine(&#34;Press any key to continue...&#34;);
        Console.ReadKey(true);
    }
}
</code></pre><p>There are three types of initialization here:</p><ul><li>Through the constructor, the value to set to the property being passed to the constructor,</li><li>With the usage of an object initializer,</li><li>With a parameterless constructor, the property being assigned later.</li></ul><p>Before continuing to read the answer, ask yourself two questions:</p><ul><li>Do those initialization techniques result in the same console output?</li><li>Is there a bug?</li></ul><hr/><p>Those techniques are totally different, and there is effectively two bugs: only one of them is correct.</p><p><strong>1. Constructor</strong></p><pre><code>using (var demo = new Demo(&#34;Hello World!&#34;))
{
    // Do nothing.
}
</code></pre><p>has nothing wrong, but it&#39;s the actual implementation of the constructor which is wrong. <strong>Constructors shouldn&#39;t throw exceptions</strong>, and one of the reasons is that it may cause inconsistent state when the object is used inside a <code>using</code> block: it&#39;s not fully initialized yet, so it will not be disposed, causing disaster if the unfinished initialization allocated some resources which should have been disposed.</p><pre><code>using (var a = new A())
{
    DoWork(a);
}
</code></pre><p>is basically the same as:</p><pre><code>var a = new A();
try
{
    DoWork(a);
}
finally
{
    a.Dispose();
}
</code></pre><p>As you can see, there is no <code>try</code> around the constructor, so an exception within it would terminate the program before reaching <code>a.Dispose()</code>: in all cases, we can&#39;t invoke a method of an object which is not initialized yet.</p><p>The setter of <code>Hello</code> throws an exception; the constructor should have been using the backing field directly, instead of the property.</p><p><strong>2. Object initializer</strong></p><pre><code>    using (var demo = new Demo { Hello = &#34;Hello World!&#34; })
    {
        // Do nothing.
    }
</code></pre><p>is itself incorrect, and if you have used Code Analysis even at Minimum Recommended Rules level, you would have seen the warning CA2000, telling that:</p><blockquote><p>object &#39;&lt;&gt;g__initLocal0&#39; is not disposed along all exception paths.</p></blockquote><p>What it that?!</p><p>That is the indicating that somewhere, an object is created and not disposed. To avoid concurrency issues, when you use an object initializer, a temporary instance of created:</p><pre><code>this.Pet = new Gremlin
{
    Title = &#34;Mogwai&#34;,
    Age = 14,
}
</code></pre><p>is transformed by the compiler into:</p><pre><code>Gremlin someCrypticName = new Gremlin();
someCrypticName.Title = &#34;Mogwai&#34;;
someCrypticName.Age = 14;
this.Pet = someCrypticName;
</code></pre><p>Indeed, when you use an object initializer inside a <code>using (...)</code>:</p><ul><li>The temporary object is created,</li><li>The properties are assigned,</li><li>The temporary object is assigned to the one which is used inside a <code>using</code>,</li><li>The <code>using</code> block runs.</li></ul><p>Any exception thrown when assigning properties will prevent disposing the object, since the assignment happens before the <code>try/finally</code>.</p><p><strong>3. Late assignment</strong></p><pre><code>using (var demo = new Demo())
{
    demo.Hello = &#34;Hello World!&#34;;
    // Do nothing.
}
</code></pre><p>is correct. Since the constructor is not expected to throw an exception (and if it will, it would be the fault of the person who implemented the constructor, not the person who is using it within the <code>using</code>), all exceptions will occur within the <code>try</code> block, resulting in the <code>demo</code> object being properly disposed.</p><p><strong>Conclusion:</strong></p><p><code>using</code> should contain either:</p><ul><li><p>A parameterless constructor,</p></li><li><p>A constructor which takes parameters,</p></li></ul><p>given that constructors are not expected to throw exceptions.</p><p><code>using</code> should not contain an object initializer: properties should be initialized within the <code>using { ... }</code>, in order to guarantee the proper disposal of objects.</p><h2>Readability</h2><p>Now that you&#39;ve understood that the two pieces of code in your question are totally difference, since one is correct, and another one is buggy, let&#39;s talk readability.</p><p>Until C# 4.0, object initialization was slightly more readable than a similar constructor:</p><pre><code>var product = new Product(&#34;PowerEdge R620 rack server&#34;, 1, &#34;Intel® Xeon® E5-2620&#34;, 16, 1929, true);
</code></pre><p>Here, I have no idea what is &#34;1&#34; or &#34;16&#34; or &#34;1929&#34;. A person who is not at all familiar with hardware wouldn&#39;t know what &#34;Intel® Xeon® E5-2620&#34; is. No one would find what is <code>true</code>.</p><p>Instead:</p><pre><code>var product = new Product
{
    Title = &#34;PowerEdge R620 rack server&#34;,
    RackUnits = 1,
    ProcessorName = &#34;Intel® Xeon® E5-2620&#34;,
    MemoryInGB = 16,
    PriceInDollars = 1929,
    IsAvailable = true,
}
</code></pre><p>is much more readable.</p><p>.NET Framework introduced named arguments, and since then, a constructor can be as readable as an object initializer, while being more compact. For example, title is explicit enough, and we would consider that anyone will understand the names of processors, so we can write:</p><pre><code>var product = new Product(
    &#34;PowerEdge R620 rack server&#34;,
    &#34;Intel® Xeon® E5-2620&#34;,
    rackUnits: 1,
    memoryInGB: 16,
    priceInDollars: 1929,
    isAvailable: true);
</code></pre><blockquote><p>I have an office mate that told me that object initialization is much readable and faster than constructor.</p></blockquote><p>We have seen that with named arguments, a constructor can be as readable as an object initializer. What about performance?</p><p>Above, I&#39;ve explained that an object initializer <code>this.a = new A { B = b }</code> is translated by the compiler into:</p><pre><code>A temp = new A();
temp.B = b;
this.a = temp;
</code></pre><p>If the only thing the constructor is doing is to assign fields or properties from arguments, then the performance would be approximately the same. Unless your office mate can give precise profiling results and benchmarks proving his point, his statement about the performance should be considered wrong.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-the-point-of-properties/'>C# &#8211;  the point of properties</a></li><li class="list-group-item"><a href='../c-sanity-of-design-for-the-in-memory-object-representations-of-database-rows/'>C# &#8211; Sanity of design for the in-memory object representations of database rows</a></li><li class="list-group-item"><a href='../c-why-does-the-net-world-seem-to-embrace-magic-strings-instead-of-staticly-typed-alternatives/'>C# &#8211; Why does the .Net world seem to embrace magic strings instead of staticly typed alternatives</a></li><li class="list-group-item"><a href='../c-unit-testing-on-visualization-3d-graphics-frameworks/'>C# &#8211; Unit testing on visualization (3D graphics) frameworks</a></li><li class="list-group-item"><a href='../c-unit-testing-with-massive-lookup-tables/'>C# &#8211; Unit Testing with massive lookup tables</a></li><li class="list-group-item"><a href='../c-how-should-i-test-the-html-output-the-class-creates/'>C# &#8211; How should I test the HTML output the class creates</a></li><li class="list-group-item"><a href='../isnt-cqrs-overengineering/'>Isn&#8217;t CQRS overengineering</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>