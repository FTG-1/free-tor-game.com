<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Rich Domain Models &#8212; how, exactly, does behavior fit in &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1064450 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1064450" class="post-1064450 software type-software status-publish hentry category-software tag-c tag-domain-driven-design tag-object-oriented tag-object-oriented-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Rich Domain Models &#8212; how, exactly, does behavior fit in</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">object-oriented</span><span class="mr-2 badge badge-primary">object-oriented-design</span></p><div class="entry-content"><p>In the debate of Rich vs. Anemic domain models, the internet is full of philosophical advice but short on authoritative examples.  The objective of this question is to find definitive guidelines and concrete examples of proper Domain-Driven Design models. (Ideally in C#.)</p><p>For a real-world example, this implementation of DDD seems to be wrong:</p><p>The WorkItem domain models below are nothing but property bags, used by Entity Framework for a code-first database.  Per Fowler, it is <a href="http://www.martinfowler.com/bliki/AnemicDomainModel.html" rel="noreferrer">anemic</a>.</p><p>The WorkItemService layer is apparently a common misperception of Domain Services; it contains all of the behavior / business logic for the WorkItem. Per Yemelyanov and others, it is <a href="https://gupea.ub.gu.se/bitstream/2077/10462/1/gupea_2077_10462_1.pdf" rel="noreferrer">procedural</a>. (pg. 6)</p><p>So if the below is wrong, how can I make it right?<br /> The behavior, i.e. <em>AddStatusUpdate</em> or <em>Checkout</em>, should belong in the WorkItem class correct?<br /> What dependencies should the WorkItem model have?</p><p><img src="../../../i.stack.imgur.com/QKWNn.png" alt="enter image description here"/></p><pre><code>public class WorkItemService : IWorkItemService {
    private IUnitOfWorkFactory _unitOfWorkFactory;

    //using Unity for dependency injection
    public WorkItemService(IUnitOfWorkFactory unitOfWorkFactory) {
        _unitOfWorkFactory = unitOfWorkFactory;
    }

    public void AddStatusUpdate(int workItemId, int statusId) {

        using (var unitOfWork = _unitOfWorkFactory.GetUnitOfWork&lt;IWorkItemUnitOfWork&gt;()) {
            var workItemRepo = unitOfWork.WorkItemRepository;
            var workItemStatusRepo = unitOfWork.WorkItemStatusRepository;

            var workItem = workItemRepo.Read(wi =&gt; wi.Id == workItemId).FirstOrDefault();
            if (workItem == null)
                throw new ArgumentException(string.Format(@&#34;The provided WorkItem Id &#39;{0}&#39; is not recognized&#34;, workItemId), &#34;workItemId&#34;);

            var status = workItemStatusRepo.Read(s =&gt; s.Id == statusId).FirstOrDefault();
            if (status == null)
                throw new ArgumentException(string.Format(@&#34;The provided Status Id &#39;{0}&#39; is not recognized&#34;, statusId), &#34;statusId&#34;);

            workItem.StatusHistory.Add(status);

            workItemRepo.Update(workItem);
            unitOfWork.Save();
        }
    }
}
</code></pre><p>(This example was simplified to be more readable. The code is definitely still clunky, because it&#39;s a confused attempt, but the domain behavior was: update status by adding the new status to the archive history. Ultimately I agree with the other answers, this could just be handled by CRUD.)</p><h2>Update</h2><p>@AlexeyZimarev gave the best answer, a perfect video on the subject in C# by Jimmy Bogard, but it was apparently moved into a comment below because it didn&#39;t give enough information beyond the link.  I have a rough draft of my notes summarizing the video in my answer below.  Please feel free to comment on the answer with any corrections. The video is an hour long but very worth watching.</p><h2>Update &#8211; 2 Years Later</h2><p>I think it&#39;s a sign of DDD&#39;s nascent maturity that even after studying it for 2 years, I still can&#39;t promise that I know the &#34;right way&#34; of doing it. Ubiquitous language, aggregate roots, and its approach to behavior-driven design are DDD&#39;s valuable contributions to the industry. Persistence ignorance and event sourcing causes confusion, and I think philosophy like that holds it back from wider adoption. But if I had to do this code over again, with what I&#39;ve learned, I think it would look something like this:</p><p><a href="../../../i.stack.imgur.com/lNqoQ.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/lNqoQ.png" alt="enter image description here"/></a></p><p>I still welcome any answers to this (very active) post that provide any best-practices code for a valid domain model.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The most helpful answer was given by Alexey Zimarev and got at least 7 upvotes before a moderator moved it into a comment below my original question....</p><p>His answer:</p><blockquote><p>I would recommend you to watch Jimmy Bogard&#39;s NDC 2012 session &#34;Crafting Wicked Domain Models&#34; on Vimeo. He explains what rich domain should be and how to implement them in real life by having behaviour in your entities. Examples are very practical and all in C#.</p><p><a href="http://vimeo.com/43598193">http://vimeo.com/43598193</a></p></blockquote><p>I took some notes to summarize the video for both my team&#39;s benefit and to provide a little more immediate detail in this post. (The video is an hour long, but really worth every minute if you have time. Jimmy Bogard deserves a lot of credit for his explanation.)</p><ul><li>&#34;For most applications... we don&#39;t know that they&#39;re going to be complex when we start. They just become that way.&#34;<ul><li>Complexity grows naturally as code and requirements are added. Applications can start out very simple, as CRUD, but behavior/rules can become baked in.</li><li>&#34;The nice thing is we don&#39;t have to start out complex. We can start with the anemic domain model, that&#39;s just property bags, and with just standard refactoring techniques we can move towards a true domain model.&#34;</li></ul></li><li><strong>Domain models = business objects. Domain behavior = business rules.</strong></li><li>Behavior is often hidden in an application -- it can be in PageLoad, Button1_Click, or often in helper classes like &#39;FooManager&#39; or &#39;FooService&#39;.</li><li>Business rules that are separate from domain objects &#34;require us to remember&#34; those rules.<ul><li>In my personal example above, one business rule is WorkItem.StatusHistory.Add(). We&#39;re not just changing the status, we&#39;re archiving it for auditing.</li></ul></li><li>Domain behaviors &#34;eliminate bugs in an application a lot more easily than just writing a bunch of tests.&#34; Tests require you to know to write those tests. <strong>The domain behaviors offer you the right <em>paths</em> to test</strong>.</li><li>Domain services are &#34;helper classes to coordinate activities between different domain model entities.&#34;<ul><li>Domain services != domain behavior. Entities have behavior, domain services are just intermediaries between the entities.</li></ul></li><li>Domain objects shouldn&#39;t have possession of the infrastructure they need (i.e. IOfferCalculatorService). The infrastructure service should be passed in to the domain model that uses it.</li><li>Domain models should offer to tell you what they can do, and they should only be able to do those things.</li><li>The properties of domain models should be guarded with private setters, so that <strong>only the model can set its own properties, through its own behaviors</strong>. Otherwise it&#39;s &#34;promiscuous.&#34;</li><li>Anemic domain model objects, that are just property bags for an ORM, are only &#34;a thin veneer -- a strongly typed version over the database.&#34;<ul><li>&#34;However easy it is to get a database row into an object, that&#39;s what we&#39;ve got.&#34;</li><li>&#39;Most persistant object models are just that. <strong>What differentiates an anemic domain model versus an application that doesn&#39;t really have behavior, is if an object has business rules, but those rules are not found in a domain model.</strong>&#39;</li></ul></li><li>&#34;For a lot of applications, there&#39;s no real need to build any kind of real business application logic layer, it&#39;s just something that can talk to the database and perhaps some easy way to represent the data that&#39;s in there.&#34;<ul><li>So in other words, if all you&#39;re doing is CRUD with no special business objects or behavior rules, you don&#39;t need DDD.</li></ul></li></ul><p>Please feel free to comment with any other points that you feel should be included, or if you think any of these notes are off the mark. Tried to quote directly or paraphrase as much as possible.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-do-orms-enable-the-creation-of-rich-domain-models/'>Java &#8211; Do ORMs enable the creation of rich domain models</a></li><li class="list-group-item"><a href='../object-oriented-domain-models-php/'>Object-oriented &#8211; Domain Models (PHP)</a></li><li class="list-group-item"><a href='../c-mapping-api-modelsdtos-to-rich-domain-models/'>C# &#8211; Mapping API models(DTOs) to rich domain models</a></li><li class="list-group-item"><a href='../how-to-deal-with-ui-data-requirements-in-ddd/'>How to deal with UI data requirements in DDD</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>