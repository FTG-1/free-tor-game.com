<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Database &#8211; Maintaining user avatars &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079518 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079518" class="post-1079518 software type-software status-publish hentry category-software tag-architecture tag-database tag-nosql"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Database &#8211; Maintaining user avatars</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">database</span><span class="mr-2 badge badge-warning">nosql</span></p><div class="entry-content"><p>The issue at hand is dealing with user avatars that come from their social media accounts. When a user signs up with our app, the user will use his/her social media account and we simply save the URL to user&#39;s avatar in our database.</p><p>We&#39;re now running into an issue because in a NoSQL database, we&#39;re creating many copies of the same data such as user&#39;s avatar URL. There&#39;s a single source of truth about the user information which is his/her user record in our database. So it&#39;s easy enough to update this and detect a change in the avatar URL.</p><p>The question is: what is the best way to handle this change in all other places e.g. comments posted by user, etc. This wouldn&#39;t be an issue in a relational database scenario but we&#39;re using a few NoSQL databases and user avatar URLs are saved in multiple places.</p><p>I can think of four ways to handle this and wanted to see how others have handled this scneario:</p><ol><li><p>We save user&#39;s avatar URL in all related entities such as comments, etc. When the avatar URL changes, simply use a back-end process to update the URL in all related objects. I think this approach would give the best performance because we use whatever URL comes with the data. No need for any kind of real-time processing. However, this approach can be really costly in terms of maintenance e.g. updating hundreds or even thousands of entities as avatars change.</p></li><li><p>Another way to handle this is not to save user avatar URL in any of the entities related to the user other than his/her primary record. We then grab the user&#39;s avatar URL on first request and cache it, say in Redis cache. As we process requests in the application, we simply pull their avatar URLs from the cache and link to appropriate entities on the fly. I see two major problems with this approach. First, it will create a small delay in managing user requests. For example, if a user requests a video with hundreds of comments under it, I&#39;d have to pull the avatars for all users from my cache and some of them may not even be cached so I&#39;d have to make a database call to get their avatars and cache them for future use. The second issue I see with this is the heavy use of cache, which I&#39;m not against at all but in this scenario, it feels like I&#39;m using the most expensive resource to manage such a trivial requirement.</p></li><li><p>A third way is to get a user&#39;s avatar, say from his/her social login and store the file locally. From that point on, we have full control over that file and its URL will never change unless we change it. Three issues with this approach: the first issue is that I don&#39;t think there&#39;s a way to download social media profile images as they don&#39;t provide a link to a file. Second issue is legality. I&#39;m not sure if we&#39;d have the right to download and store a file that belongs to LinkedIn, Facebook, Google, etc. The third issue is that when the user changes his/her avatar in the social media account, user&#39;s avatar in our app won&#39;t update automatically. He/She would have to handle that manually. Not the end of the world but not great user experience either.</p></li><li><p>Use gravatar service. I only know some basic information about this service so I can&#39;t say much about it. My primary concerns are that we&#39;re using yet another third party resource on top of a third party resource which will only complicate things further. Also, not exactly sure how gravatar works but what if the user doesn&#39;t have a gravatar account?</p></li></ol><p>I&#39;d like to see how others handled this scenario. Thanks.</p><p>P.S. Based on a few posts I read here and there, I was under the impression that avatar URLs didn&#39;t change because social media providers would generate a URL for the user&#39;s avatar which is not the file name. So even if the user changes their avatar on their social media account, the URL wouldn&#39;t change. I now know as a fact that this assumption is not correct and avatar URL coming from social media providers do change. It&#39;s happened to me with LinkedIn. A completely different URL is now my avatar URL. Funny thing is that I have not even updated my profile image with them. Somehow, LinkedIn decided to return a different URL to my profile image.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>One of the possible solutions would be to add a route such as <a href="https://example.com/user/<id>/avatar" rel="nofollow noreferrer">https://example.com/user/&lt;id&gt;/avatar</a> which would redirect the browser to the actual avatar.</p><p>For instance, if the real avatar is stored at <a href="https://linkedin.com/avatars/40bd001563085fc35165" rel="nofollow noreferrer">https://linkedin.com/avatars/40bd001563085fc35165</a>, your website will only store this URI once, in <code>users</code> document, associated with the user <code>123</code>. Everywhere in the user interface, i.e. in all entities such as comments, the avatar will be implemented like this:</p><pre><code>&lt;img src=&#34;https://example.com/user/123/avatar&#34; alt=&#34;...&#34; /&gt;
</code></pre><p>During a HTTP request to <a href="https://example.com/user/123/avatar" rel="nofollow noreferrer">https://example.com/user/123/avatar</a>, the server will load the stored URI and respond with:</p><pre><code>HTTP/1.1 302 Found
Location: https://linkedin.com/avatars/40bd001563085fc35165
</code></pre><p>which would effectively force the browser to show the correct image.</p><p>Notes:</p><ul><li><p>In terms of performance, there shouldn&#39;t be too much issues. The request is relatively fast to process, and uses only marginal bandwidth (unlike serving images yourself).</p></li><li><p>It is essential to use HTTP 302 and not HTTP 301; otherwise, users who changed avatars will sometimes continue to see the old avatar, possibly for a long time.</p></li><li><p>Proper client-side caching can be implemented to prevent the browser from requesting the same avatar over and over (usually, when changing an avatar, one wouldn&#39;t be surprised to still see the old one for several minutes on some sites).</p></li></ul><hr/><p>Note that if you&#39;re experiencing this difficulty with the avatar, you&#39;ll probably have the same issue with other pieces of information as well, due to improper normalization/denormalization. While some NoSQL databases encourage you to duplicate data in order to make queries faster and guarantee data consistency within a document, this comes at a cost of not being able to easily change the data scattered all over your database. Therefore:</p><ul><li><p>Make sure you understand when to duplicate data and where to reference a single piece of data from other documents.</p></li><li><p>When applicable, rely on techniques such as the one I presented here, which make it possible to store a piece of data once, while not referencing it directly in other documents. For instance, on Stack Exchange, the zone which displays a user shows not only the user&#39;s name and avatar, but also the badges, the geographical location, the link to the website and a signature. Since those data are not crucial for the website, they can be queried through AJAX after the page is loaded, meaning that a question/answer doesn&#39;t need to contain this information or link to it in any way.</p></li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-whats-the-best-way-to-modularize-a-user-schema-so-its-generic/'>Database &#8211; What&#8217;s the best way to modularize a User schema so it&#8217;s generic</a></li><li class="list-group-item"><a href='../database-am-i-planning-the-database-backend-correctly/'>Database &#8211; Am I planning the database/backend correctly</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>