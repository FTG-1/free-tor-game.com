<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; Model relationships with DDD (or with sense) &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075997 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075997" class="post-1075997 software type-software status-publish hentry category-software tag-design tag-domain-driven-design tag-domain-model"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; Model relationships with DDD (or with sense)</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">domain-model</span></p><div class="entry-content"><p>Here is a simplified requirement:</p><blockquote><p><strong>User creates a <code>Question</code> with multiple <code>Answer</code>s. <code>Question</code> must have at least one <code>Answer</code>.</strong></p><p>Clarification: think <code>Question</code> and <code>Answer</code> as in a <em>test</em>: there is one question, but several answers, where few may be correct. User is the actor who is preparing this test, hence he creates question and answers.</p></blockquote><p>I am trying to model this simple example so to 1) match the real life model 2) to be expressive with the code, so to minimize potential misuse and errors, and to give hints to developers how to use the model.</p><p>Question is an <em>entity</em>, while answer is <em>value object</em>. Question holds answers. So far, I have these possible solutions.</p><p><strong>[A]</strong> Factory inside <code>Question</code></p><p>Instead of creating <code>Answer</code> manually, we can call:</p><pre><code>Answer answer = question.createAnswer()
answer.setText(&#34;&#34;);
...
</code></pre><p>That will create an answer <em>and</em> add it to the question. Then we can manipulate answer by setting it&#39;s properties. This way, only questions can crete an answer. Also, we prevent to have an answer without a question. Yet, we do not have control over creating answers, as that is hardcoded in the <code>Question</code>.</p><p>There is also one problem with the &#39;language&#39; of above code. User is the one who creates answers, not the question. Personally, I don&#39;t like we create value object and depending on developer to fill it with values &#8211; how he can be sure what is required to add?</p><p><strong>[B]</strong> Factory inside Question, take #2</p><p>Some says we should have this kind of method in <code>Question</code>:</p><pre><code>question.addAnswer(String answer, boolean correct, int level....);
</code></pre><p>Similar to above solution, this method takes mandatory data for the answer and creates one that will be also added to the question.</p><p>Problem here is that we <em>duplicate</em> the constructor of the <code>Answer</code> for no good reason. Also, does question really creates an answer?</p><p><strong>[C]</strong> Constructor dependencies</p><p>Let&#39;s be free to create both objects by our selves. Let&#39;s also express the dependency right in constructor:</p><pre><code>Question q = new Question(...);
Answer a = new Answer(q, ...);   // answer can&#39;t exist without a question
</code></pre><p>This gives hints to developer, as answer can&#39;t be created without a question. However, we do not see the &#39;language&#39; that says that answer is &#39;added&#39; to the question. On the other hand, do we really need to see it?</p><p><strong>[D]</strong> Constructor dependency, take #2</p><p>We can do the opposite:</p><pre><code>Answer a1 = new Answer(&#34;&#34;,...);
Answer a2 = new Answer(&#34;&#34;,...);
Question q = new Question(&#34;&#34;, a1, a2);
</code></pre><p>This is opposite situation of above. Here answers can exist without a question (which does not make sense), but question can not exist without answer (which make sense). Also, the &#39;language&#39; here is more clear on that question will <em>have</em> the answers.</p><p><strong>[E]</strong> Common way</p><p>This is what I call the common way, the first thing that ppl usually do:</p><pre><code>Question q = new Question(&#34;&#34;,...);
Answer a = new Answer(&#34;&#34;,...);
q.addAnswer(a);
</code></pre><p>which is &#39;loose&#39; version of above two answers, since both answer and question may exist without each other. There is no special hint that you <em>have</em> to bind them together.</p><p><strong>[F]</strong> Combined</p><p>Or should I combine C, D, E &#8211; to cover all the ways how relationship can be made, so to help developers to use whatever is best for them.</p><h2>Question</h2><p>I know people may choose one of the answers above based on the &#39;hunch&#39;. But I wonder if any of above variant is better then the other with a good reason for that. Also, please don&#39;t think inside the above question, I would like to squeeze here some best practices that could be applied on most cases &#8211; and if you agree, most use cases of creation some entities are similar. Also, lets be technology agnostic here, eg. I do not want to think if ORM is going to be used or not. Just want good, expressive mode.</p><p>Any wisdom on this?</p><p>EDIT</p><p>Please ignore other properties of <code>Question</code> and <code>Answer</code>, they are not relevant for the question. I edited above text and changed the most of the constructors (where needed): now they accept any of necessary property values needed. That may be just a question string, or map of strings in different languages, statuses etc. &#8211; whatever properties are passed, they are not a focus for this ðŸ˜‰ So just assume we are above passing necessary parameters, unless said different. Thanx!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h2>Updated. Clarifications taken into account.</h2><p>Looks like this is a multiple choice domain, which usually has the following requirements</p><ol><li>a question must have at least two choices so that you could choose among</li><li>there must be at least one correct choice</li><li>there should not be a choice without a question</li></ol><p>Based on the above</p><p><strong>[A]</strong> can&#39;t ensure the invariant from point 1, you may end up with a question without any choice</p><p><strong>[B]</strong> has the same disadvantage as <strong>[A]</strong></p><p><strong>[C]</strong> has the same disadvantage as <strong>[A]</strong> and <strong>[B]</strong></p><p><strong>[D]</strong> is a valid approach, but it&#39;s better to pass the choices as a list rather than passing them individually</p><p><strong>[E]</strong> has the same disadvantage as <strong>[A]</strong>, <strong>[B]</strong> and <strong>[C]</strong></p><p>Hence, I would go for <strong>[D]</strong> because it allows to ensure domain rules from points 1, 2 and 3 are followed. Even if you say that it&#39;s very unlikely for a question to remain without any choice for a long period of time, it&#39;s always a good idea to convey domain requirements through the code.</p><p>I would also rename the <code>Answer</code> to <code>Choice</code> as it makes more sense to me in this domain.</p><pre><code>public class Choice implements ValueObject {

    private Question q;
    private final String txt;
    private final boolean isCorrect;
    private boolean isSelected = false;

    public Choice(String txt, boolean isCorrect) {
        // validate and assign
    }

    public void assignToQuestion(Question q) {
        this.q = q;
    }

    public void select() {
        isSelected = true;
    }

    public void unselect() {
        isSelected = false;
    }

    public boolean isSelected() {
        return isSelected;
    }
}

public class Question implements Entity {

    private final String txt;
    private final List&lt;Choice&gt; choices;

    public Question(String txt, List&lt;Choice&gt; choices) {
        // ensure requirements are met
        // 1. make sure there are more than 2 choices
        // 2. make sure at least 1 of the choices is correct
        // 3. assign each choice to this question
    }
}

Choice ch1 = new Choice(&#34;The sky&#34;, false);
Choice ch2 = new Choice(&#34;Ceiling&#34;, true);
List&lt;Choice&gt; choices = Arrays.asList(ch1, ch2);
Question q = new Question(&#34;What&#39;s up?&#34;, choices);
</code></pre><p>A note. If you make the <code>Question</code> entity an aggregate root and the <code>Choice</code> value object a part of the same aggregate, there&#39;s no chances one can store a <code>Choice</code> without it being assigned to a <code>Question</code> (even though you don&#39;t pass a direct reference to the <code>Question</code> as an argument to the <code>Choice</code>&#39;s constructor), because the repositories work with roots only and once you build your <code>Question</code> you have all your choices assigned to it in the constructor.</p><p>Hope this helps.</p><h3>UPDATE</h3><p>If it really bothers you how the choices are created ahead of their question, there are few tricks you might find useful</p><p>1) Rearrange the code so that it looks like they are created after the question or at least at the same time</p><pre><code>Question q = new Question(
    &#34;What&#39;s up?&#34;,
    Arrays.asList(
        new Choice(&#34;The sky&#34;, false),
        new Choice(&#34;Ceiling&#34;, true)
    )
);
</code></pre><p>2) Hide constructors and use a static factory method</p><pre><code>public class Question implements Entity {
    ...

    private Question(String txt) { ... }

    public static Question newInstance(String txt, List&lt;Choice&gt; choices) {
        Question q = new Question(txt);
        for (Choice ch : choices) {
            q.assignChoice(ch);
        }
    }

    public void assignChoice(Choice ch) { ... }
    ...
}
</code></pre><p>3) Use the builder pattern</p><pre><code>Question q = new Question.Builder(&#34;What&#39;s up?&#34;)
    .assignChoice(new Choice(&#34;The sky&#34;, false))
    .assignChoice(new Choice(&#34;Ceiling&#34;, true))
    .build();
</code></pre><p>However, everything depends on your domain. Most of the times the order of objects creation is not important from the problem domain perspective. What is more important is that as soon as you get an instance of your class it is logically complete and ready to use.</p><p><br/></p><h3>Outdated. Everything below is irrelevant to the question after clarifications.</h3><p>First of all, according to DDD domain model should make sense in the real world. Hence, few points</p><ol><li>a question may have no answers</li><li>there should not be an answer without a question</li><li>an answer should correspond to exactly one question</li><li>an &#34;empty&#34; answer doesn&#39;t answer a question</li></ol><p>Based on the above</p><p><strong>[A]</strong> may contradict point 4 because it&#39;s easy to misuse and forget to set the text.</p><p><strong>[B]</strong> is a valid approach but requires parameters that are optional</p><p><strong>[C]</strong> may contradict point 4 because it allows an answer with no text</p><p><strong>[D]</strong> contradicts point 1 and may contradict points 2 and 3</p><p><strong>[E]</strong> may contradict points 2, 3 and 4</p><p>Secondly, we can make use of OOP features to enforce domain logic. Namely we can use constructors for the required parameters and setters for the optional ones.</p><p>Thirdly, I would use the ubiquitous language which is supposed to be more natural for the domain.</p><p>And finally, we can design it all using DDD patterns like aggregate roots, entities and value objects. We can make the Question a root of its aggregate and the Answer a part of it. This is a logical decision because an answer has no meaning outside of a question&#39;s context.</p><p>So, all the above boil down to the following design</p><pre><code>class Answer implements ValueObject {

    private final Question q;
    private String txt;
    private boolean isCorrect = false;

    Answer(Question q, String txt) {
        // validate and assign
    }

    public void markAsCorrect() {
        isCorrect = true;
    }

    public boolean isCorrect() {
        return isCorrect;
    }
}

public class Question implements Entity {

    private String txt;
    private final List&lt;Answer&gt; answers = new ArrayList&lt;&gt;();

    public Question(String txt) {
        // validate and assign
    }

    // Ubiquitous Language: answer() instead of addAnswer()
    public void answer(String txt) {
        answers.add(new Answer(this, txt));
    }
}

Question q = new Question(&#34;What&#39;s up?&#34;);
q.answer(&#34;The sky&#34;);
</code></pre><p>P.S. Answering to your question I made few assumptions about your domain which might not be correct, so feel free to adjust the above with your specifics.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-ddd-domain-model-factory-design/'>Design &#8211; DDD: Domain Model Factory Design</a></li><li class="list-group-item"><a href='../how-to-use-ddd-to-solve-a-common-address-situation/'>How to use DDD to solve a common address situation</a></li><li class="list-group-item"><a href='../ddd-integrating-aggregate-root-with-open-host-service-ohs/'>DDD integrating aggregate root with open host service (OHS)</a></li><li class="list-group-item"><a href='../ddd-must-all-aggregates-model-relationships-or-they-can-be-shallow/'>DDD: must all Aggregates model relationships, or they can be &#8220;shallow&#8221;</a></li><li class="list-group-item"><a href='../c-domain-models-with-complex-properties-construction/'>C# &#8211; Domain Models with complex properties construction</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>