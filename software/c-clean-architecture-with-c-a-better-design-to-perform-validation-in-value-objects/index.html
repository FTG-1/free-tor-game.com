<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Clean architecture with C#: A better design to perform validation in Value Objects &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081910 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081910" class="post-1081910 software type-software status-publish hentry category-software tag-net-core tag-c tag-clean-code tag-domain-driven-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Clean architecture with C#: A better design to perform validation in Value Objects</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">.net core</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">clean code</span><span class="mr-2 badge badge-primary">domain-driven-design</span></p><div class="entry-content"><p>I&#39;m creating an application which&#39;s architecture is <em>based</em> on <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html" rel="nofollow noreferrer">Uncle Bob&#39;s Clean Architecture</a> concepts and <a href="https://www.dddcommunity.org/book/evans_2003/" rel="nofollow noreferrer">DDD</a>. Note that it is <em>BASED</em> on DDD, so I gave myself the freedom to differ from strict DDD.</p><p>To create this application, I am using C# with .Net Standard 2.0</p><p>One of the principles of DDD relates to Value Objects. The definition for Value Objects, according to <a href="https://en.wikipedia.org/wiki/Domain-driven_design" rel="nofollow noreferrer">Wikipedia</a> is as follows:</p><blockquote><p>Value Object</p><p>An object that contains attributes but has no conceptual identity. They should be treated as immutable.</p><p>Example: When people exchange business cards, they generally do not distinguish between each unique card; they only are concerned about the information printed on the card. In this context, business cards are value object</p></blockquote><p>Now, I want that my Value Objects does not allow their creation if some validation does not succeed. When it happens, an exception would be thrown during the instantiation. I really meant to throw an exception there, because the core of the architecture really does not expect any invalid data to reach that point.</p><p>Before going further on this question, to give you guys some more background, <a href="https://web.archive.org/web/20180627192447/https://github.com/andremarcondesteixeira/A-Clean-Architecture-Proposal" rel="nofollow noreferrer">here</a> is my architecture (NOTE: still incomplete):</p><p><a href="../../../i.stack.imgur.com/RUytv.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/RUytv.png" alt="My Clean Architecture Proposal"/></a></p><p>The rules I am following in this architecture is:</p><ol><li>A layer can only know about its immediate innermost neighbor layer&#39;s interfaces</li><li>A layer cannot know anything about any outermost layer</li><li>All communications between layers MUST be done through interfaces</li><li>Each layer must be independently deployable</li><li>Each layer must be independently developable</li></ol><p>To better understand the arrows in this diagram, I recommend reading those Stack Exchanges&#39;s questions:</p><p><a href="https://stackoverflow.com/questions/1874049/explanation-of-the-uml-arrows">https://stackoverflow.com/questions/1874049/explanation-of-the-uml-arrows</a></p><p><a href="https://softwareengineering.stackexchange.com/questions/61376/aggregation-vs-composition">Aggregation vs Composition</a></p><p>Now, the challenge I&#39;m facing right now, is finding a good way to use the validators. I&#39;m not satisfied with my architecture in this point. The problem is the following:</p><p>Since I can have thousands of Value Objects being instantiated at a given time, I don&#39;t want each instance of the Value Objects to have an instance method to perform the validation. I want the validation method to be static, since it&#39;s logic will be the same for every instance. Also, I want the validation logic to be available for the upper layer of the architecture to use to perform validations without trying to instantiating the Value Objects, thus causing an expensive exception to be thrown.</p><p>The problem is: C# <em>DOES NOT ALLOW</em> polymorphism with static methods, so I can&#39;t do something like:</p><pre><code>internal interface IValueObject&lt;T&gt;
{
    T Value { get; }
    static bool IsValid(T value);
}
</code></pre><p>How can I achieve this functionality without relying on static methods polymorphism and, at the same time, not wasting memory?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The answer to your question is just to put the logic in the constructor. Using a  static vs instance method will not effect the performance in the way you think it will, and including methods like <code>isValid</code> is nearly always a sign of an anemic model. But there is a bigger issue at play here:</p><p>I understand the temptation to validate the attributes of each Value Object on construction in order to throw exceptions/catch invariants as soon as possible, but that can lead to all sorts of other issues as your system grows because validation is almost always a product of context (of which a constructor has none). It also affords a certain tendency to create superficial invariants. The best place to enforce rules regarding some piece of data is often <em>at the point</em> of use for that data. This allows the context to play a role in determining what invariants exist.</p><p>For example, rather than enforcing an invariant regarding the data allowed on a <code>BusinessCard</code> during construction (say no <code>SwearWords</code> or something), enforce the invariant upon the <code>transfer</code> of that <code>BusinessCard</code> from a <code>SalesAssociate</code> to a <code>Customer</code>. By <em>defering</em> the enforcement (the decision) to be as late as possible (coupled to the use-case), you are able to use the context to help guide the decision (you have more data at your disposal).</p><p>Of course, this isn&#39;t a law of DDD (or any system) - there may be no conceivable use-case for <code>startDate</code> to <em>ever</em> be greater than <code>endDate</code> for example - but this idea of &#34;deferment&#34; is a cornerstone of good architecture. When you find yourself repeating a check for <code>SwearWords</code> in some other transaction, you will have been given a valuable opportunity: a chance to do some knowledge crunching and possibly refactor your model towards deeper insight. Is there some thread or idea that binds the <code>transfer</code> of a <code>BusinessCard</code> with this new transaction? Can it be extracted and made more explicit? If not, at the very worst we are talking about the invocation of a static (or private) method in two places here to perform the actual check.</p><p>Now, for my silly example there may be absolutely no reason for a <code>BusinessCard</code> to include a <code>SwearWord</code> and, in the end, put the enforcement of this invariant in the constructor to avoid any possible duplication, but I can guarantee that this will not always be the case. Furthermore, it&#39;s far easier to refactor the enforcement &#34;upward&#34; (to apply to all <code>BusinessCards</code> in construction) than finding, at some later point, a reason why it needs to be removed and pushing it &#34;downward&#34; where you will be forced to hunt down each use-case individually and &#34;re-apply&#34; the rule, or worse, figure out some sort of special work-around.</p><p>The quality of the design of a system is not all at about how well it works (there are plenty of poorly designed systems operating just fine), rather how easily it can be <em>changed</em>. When your goal is to design a system with a flexible, maintainable, develop-able, deploy-able architecture, an easy rule of thumb to follow - that I find tends to lead developers in the right direction -
 is to <em>defer</em> as many decisions as possible until <em>absolutely</em> necessary.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-validation-inside-constructor/'>C# &#8211; Validation inside Constructor</a></li><li class="list-group-item"><a href='../c-using-automapper-to-map-dtos-to-domain-objects/'>C# &#8211; Using Automapper to map DTOs to Domain Objects</a></li><li class="list-group-item"><a href='../c-the-best-way-to-apprach-validation-from-the-perspective-of-a-ddd-purist/'>C# &#8211;  the &#8220;best&#8221; way to apprach validation from the perspective of a DDD purist</a></li><li class="list-group-item"><a href='../ddd-with-web-api-validation-in-domain-or-application-layer/'>DDD with web api, validation in domain or application layer</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>