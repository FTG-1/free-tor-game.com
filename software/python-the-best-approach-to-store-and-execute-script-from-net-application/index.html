<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python &#8211;  the best approach to store and execute script from .NET application &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087538 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087538" class="post-1087538 software type-software status-publish hentry category-software tag-asp-net-mvc tag-python tag-scripting"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python &#8211;  the best approach to store and execute script from .NET application</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-mvc</span><span class="mr-2 badge badge-info">python</span><span class="mr-2 badge badge-warning">scripting</span></p><div class="entry-content"><p>I am making an application that will allow user to store and execute simple scripts using Web GUI. Web GUI is ASP.NET MVC and scripts can be of any kind (Python, Perl, AWK, CMD, PowerShell ect. User just needs to provide path to executable). Also there are scripts that do not require executable like XSLT, IronPython ect. Scripts will perform some simple data processing, but it&#39;s nature is totally depended on user, so it cannot be wired into application itself.</p><p><strong>Question is what is the best approach to store these scripts?</strong></p><ol><li>Store all scripts in files and provide script files to interpreters.</li></ol><p>It is relatively easy to make solution, but some metadata and relations to other parts of system will be still stored in Db. This also allows to change scripts externally using user&#39;s favorite text editor and allows to debug scripts.</p><p>But I am concerned if is it safe solution, given that multiple users could be accessing to and executing same files at the same time, since they operate from web GUI.</p><ol start="2"><li><p>Store all scripts in Db and create temporary file when execution is required. Provide tmp file to interpreter and remove it once job is done.</p></li><li><p>Store all scripts in Db and provide them to interpreters via command line (for example python.exe -c ).</p></li></ol><p>Problem with this approach is that I need to heavily escape the script code in order to paste it as command line argument.</p><p><strong>Could you please provide const and pros of these approaches?</strong></p><p>Many thanks!</p><p>P.S.</p><p>Security is not a concern for me. At least not now. All scripst are managed by veryfied authneticated users.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><em>An advice: Do not think of your solution as a monolith. Be open to the idea of it being more than one program.</em></p><hr/><h2>Pros and Cons</h2><p><em>Honeslty, I am unsure if these are pros on cons, I leave it to your judgement...</em></p><blockquote><ol start="3"><li>Store all scripts in Db and provide them to interpreters via command line (for example python.exe -c ).</li></ol></blockquote><ul><li>The scripts cannot use the file system.</li><li>Not metaprogramming friendly.</li></ul><blockquote><ol start="2"><li>Store all scripts in Db and create temporary file when execution is required. Provide tmp file to interpreter and remove it once job is done.</li></ol></blockquote><ul><li>You can allow the scripts to use the file system.</li><li>Metaprogramming friendly.</li></ul><blockquote><ol><li>Store all scripts in files and provide script files to interpreters.</li></ol></blockquote><ul><li>You can allow the scripts to use the file system.</li><li>Not metaprogramming friendly (if you want to protect scripts from each other).</li></ul><p><strong>Errata</strong>: It is possible to allow scripts to communicate/interfere with each other in any option. It is easier on option 1.</p><p>How safe they are? Well, they are about the same. The measures you need to take to make your system secure has nothing to do with the storage of the scripts, but how you run them... except that doesn&#39;t mean what you are thinking.</p><hr/><h2>Security Concerns:</h2><p>Just running arbitrary third party code is security concern. Two concerns actually:</p><ol><li>Do not allow scripts to mess with other scripts</li><li>Do not allow scripts to mess with the underlying system</li></ol><p>For the first concern, it could appear that taking advantage of a database engine and withholding access to it will prevent a malicious script from messing with other scripts. However, the malicious script can still mess with the rest of the system (which might or might not include tampering with the database engine).</p><p>The scripts could cause a lot of damage to your system. Just as an example, one could download malware and configure it run on a scheduled task or on reboot.</p><p>In terms of the second concern, the database is not buying you much security.</p><p>In addition, passing the code via command line will not make it less harmful.</p><hr/><p>For that second concern, your first real option is to run the code as an operating system user with low privileges. Besides that, I would suggest virtualization solutions (containers, virtual machines, or other generic sandboxes).</p><p>Now, if you consider running your server code under a user with low privileges, you will have to use option 3:</p><blockquote><p>Store all scripts in Db and provide them to interpreters via command line (for example python.exe -c ).</p></blockquote><p>That is, because, if you have right to write files, so will the scripts. Thus, better do not have that right.</p><p><strong>Note</strong>: You can&#39;t really block them from the network with this method.</p><hr/><p>The database here might be of any kind. In fact, it could be storing the scripts in plain in your file system. Except, you do not pass the script to the interpreter, instead you read the code to memory and pass it to the interpreter via command line.</p><p><strong>Errata</strong>: The database might be of any kind, but must run as a service, free from the contraint of not being able to write.</p><p>Speaking of reading, grant read access only to what you need.</p><p><em>I remind you that we are using command line because we have to. Using the command line is not what makes it safe.</em></p><hr/><p><strong>Addendum</strong>: <em>Due to the comments, I have considered if it is possible to use option 3 with file write access, without going into what I describe below (using two operating system users).</em> It is vialbe to use option 3, on a single operating system user, with file write access. As long as the operating system user has only right over a constrained area. That would also allow the scripts to communicate/interfere with each other (the same would apply for option 2).</p><hr/><p>On the other hand, if you need to grant write access to the scripts (or if you don&#39;t want to use the command line), you will have to split your server solution in two operating system users. Run code under the first user to take requests, managing scripts, calling code to run as the second user and responding. Run code under the second user to run the scripts.</p><p>Have the code of the first user place the script in a temporary folder, grant write access on the folder to the second user. Make sure that folder is the current path for the script you run.</p><p>The script will be able to use the file system inside that folder, and you can use the first user to wipe it.</p><p>There is still a problem: they can try to fill the disk with a script. Even if you set a small quota for the second user, they may cause a denial of service. To mitigate this, you may have code running as the first user to monitor the file system (not pooling, register a notification from the OS, being asp.net that would be using <a href="https://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher(v=vs.110).aspx" rel="nofollow noreferrer">FileSystemWatcher</a>) and if the script is using too much space you can kill it, and flag it as dangerous.</p><p>You can continue to use option 3 with that setup. Yet, you do not need to. You can use option 2:</p><blockquote><p>Store all scripts in Db and create temporary file when execution is required. Provide tmp file to interpreter and remove it once job is done.</p></blockquote><p>If you do, you may or may not grant write access on the script themselves. It is possible that the script has code that reads or write itself as some sort of metaprogramming technique. You need to consider if you want to allow this.</p><p><em>You need metadata. Either a document oriented database or a relational database will work.</em></p><hr/><p>In fact, if you have the two operating system users solution, you can even use option 1:</p><blockquote><p>Store all scripts in files and provide script files to interpreters.</p></blockquote><p>Just do not grant the second user right to write the scripts. Preventing the scripts to mess with other scripts.</p><p>As I said at the start, in option 1 you can allows the scripts can communicate/interfere with each other. This is happens when one script write to a file, and another one reads. If you want to prevent this, either don&#39;t grant them write access or don&#39;t use option 1.</p><p><strong>Addendum</strong>: There is a possible side effect of option 1 with write access: scripts could create other scripts. If this is a problem, it would be better to keep a list of the &#34;valid&#34; script somewhere else.</p><hr/><h2>Other concerns</h2><p>You have said (regarding option 1):</p><blockquote><p>This also allows to change scripts externally using user&#39;s favorite text editor and allows to debug scripts.</p></blockquote><p>That should not be a concern, because you are providing a web GUI, which the user should be using. If you need to provide a text editor, build it in the GUI. Debugging is probably out of the question.</p><blockquote><p>(...) multiple users could be accessing to and executing same files at the same time, since they operate from web GUI</p></blockquote><p>You can control that from your web code. You may – for example – queue requests to prevent too many script running at once (or the same one running multiple times, if that is really a concern).</p><hr/><p>You have said (regarding option 3):</p><blockquote><p>Problem with this approach is that I need to heavily escape the script code in order to paste it as command line argument.</p></blockquote><p>You could create an executable that reads the code (from where you have it stored) and outputs the code (with whatever preprocessing you need to do) to standard output. Then redirect the standard input  of the interpreter to take the output of that executable. A.k.a <a href="https://en.wikipedia.org/wiki/Redirection_(computing)#Piping" rel="nofollow noreferrer">Piping</a>.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../use-ruby-to-automate-everything/'>Use Ruby to automate everything</a></li><li class="list-group-item"><a href='../c-adding-scripting-capability-to-a-net-application/'>C# &#8211; Adding scripting capability to a .NET application</a></li><li class="list-group-item"><a href='../python-the-best-way-to-store-configurations-of-shell-script-code-to-execute-later/'>Python &#8211;  the best way to store configurations of shell/script code to execute later</a></li><li class="list-group-item"><a href='../the-difference-between-a-macro-and-a-script/'>The difference between a macro and a script</a></li><li class="list-group-item"><a href='../c-how-to-avoid-double-data-validation-in-an-application-with-web-interface/'>C# &#8211; How to avoid double data validation in an application with web interface</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>