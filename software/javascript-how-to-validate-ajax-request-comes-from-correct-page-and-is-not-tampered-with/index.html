<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Javascript &#8211; How to validate ajax request comes from correct page and is not tampered with &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086191 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086191" class="post-1086191 software type-software status-publish hentry category-software tag-ajax tag-html tag-javascript tag-php tag-security"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Javascript &#8211; How to validate ajax request comes from correct page and is not tampered with</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">ajax</span><span class="mr-2 badge badge-info">html</span><span class="mr-2 badge badge-warning">javascript</span><span class="mr-2 badge badge-primary">PHP</span><span class="mr-2 badge badge-danger">Security</span></p><div class="entry-content"><p>I am building a simple Q&amp;A app with PHP, HTML and JS. I have three tables: <code>users</code>,<code>question</code> and <code>answers</code>, each table has it&#39;s own primary key and <code>questions</code> and <code>answers</code> both have foreign key constraints. <code>questions</code> store <code>users.uID</code> to look up author, and <code>answers</code> store <code>question.qID</code>to identify which question they belong to, and also author that wrote the answer, so <code>users.uID</code> is also foreign key.</p><p>And here is my main concern: how to properly implement submit button for answer, that passes the author ID and also question ID that is supposed to be inserted in <code>answers</code> table via ajax request, so it has to get that ID from somewhere. The main concern is not XSRF, but the fact that authorised user could tamper with it, by changing a part of html code if the ID is stored visibly (or invisibly) somewhere.</p><p>User ID is easy, that can be stored in session once retrieved from DB and user logs in and will be reused elsewhere too so no big deal in term of performance costs, and can be accessed by all scripts while hidden from user. But also storing the question ID in session, each time user visits a question, and then replacing that with another question ID when he visits another question seems to me like it is asking for causing heavy load on server at some point.</p><p>Adding hash to the submit button, that is then validated by script that processes the ajax call data looks cumbersome to me too, since you have to store that hash in session too. And using hidden field is not safe either, since user can see that field in source code and can tamper with it.</p><p>So where to efficiently store that question ID, so it is ready when the submit button is pressed and also that user cannot tamper with it, and send ajax call with other ID? Is the session really only option?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>The main concern is not XSRF, but the fact that authorised user could tamper with it, by changing a part of html code if the ID is stored visibly (or invisibly) somewhere.</p></blockquote><p>I understand the desire to make sure that the user does not circumvent the user interface you provided. However, this is not easy to do, and will not result in any improved security.</p><ul><li>You would have to store the relevant user state server-side and compare it with the state provided by the user. Since the same state is now in two places, there&#39;s always the possibility that these states fall out of sync, e.g. if the user aborts an action or if the network connection is interrupted. The user may also have multiple states, e.g. if they are using your web app in multiple browser tabs.</li><li>You could also create a cryptographic signature of the user state, and give the user this signature as a token. The user must transmit the token with each request, so that it can be validated by the server. However, there&#39;s still the possibility of replay attacks if this token isn&#39;t implemented as a nonce.</li></ul><p>All of that is easy to get wrong, and may cause a lot of frustration for your users if it doesn&#39;t work as intended (I&#39;ve encountered a couple of sites that are sometimes unusable unless I delete some cookies). This effort is certainly justified for online banking or similar problem domains where you&#39;d rather be safe than sorry. In other domains, this is more likely to be perceived as user-hostile.</p><p>Instead of checking that the user sticks to the links you provided, check that the user has the necessary <em>permissions</em> for any action they are trying to take.</p><ul><li>If they are generally allowed to view, create, or modify a resource, allow the user to take that action even if they manipulated the URL.</li><li>If they are not allowed to access the resource, deny them even if they can guess the correct URL. A number of data “breaches” had the cause that private data was not protected by a permission model, but only by a “secret” ID that other users weren&#39;t supposed to know – but could be guessed or intercepted by the attacker.</li></ul><p>To defend against abuse of the resources that user is allowed to access:</p><ul><li><p>Use rate limits. E.g. in a Q&amp;A system, a normal user can&#39;t and shouldn&#39;t post 5 answers within 10 minutes.</p></li><li><p>Develop a system for flagging and review of user-generated content, especially if user content is publicly visible.</p></li><li><p>If users are resorting to bots when using your web app, this could mean that you are lacking some crucial functionality. Offer an API that is more convenient than scraping. Sometimes, an export-to-CSV button is all your users are missing.</p></li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../javascript-how-secure-is-localstorage/'>Javascript &#8211; How secure is localstorage</a></li><li class="list-group-item"><a href='../javascript-how-safe-are-hidden-ajax-requests-that-fake-performance/'>Javascript &#8211; How safe are hidden AJAX requests that fake performance</a></li><li class="list-group-item"><a href='../c-i-need-advice-developing-a-sensitive-data-transfer-storage-encryption-system/'>C# &#8211; I need advice developing a sensitive data transfer/storage/encryption system</a></li><li class="list-group-item"><a href='../where-to-store-hashes-salts-keys-in-desktop-applications/'>Where to store hashes, salts, keys in Desktop Applications</a></li><li class="list-group-item"><a href='../single-page-app-vs-multi-page-application/'>Single page app vs multi page application</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>