<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Static variable &#8211; Usage and Implications on Threading &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1066698 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1066698" class="post-1066698 software type-software status-publish hentry category-software tag-c tag-object-oriented tag-static-keyword"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Static variable &#8211; Usage and Implications on Threading</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">object-oriented</span><span class="mr-2 badge badge-warning">static-keyword</span></p><div class="entry-content"><p>I have some confusion regarding the use of static variables/references in a class. It feels like I may not have entirely figured out the implications of keeping something static.</p><p>When I say a variable is public static, is it one instance of the variable per class or one instance per assembly?</p><p>For example, I have a user control (say, for a WPF app). This user control has a public static variable that coordinates various things within the control. If there is a form in a client application that uses this user control, with multiple instances of this control per form, how many instances of the public static variable are created? (My guess is only one,  and it is modified by every control).</p><p>Now, I actually need each instance of the control to have one such variable, not one variable across all the instances of the control in that single form.</p><p>Does using a singleton pattern, with a &#34;lock&#34; keyword solve this issue i.e will it create one variable per instance of the user control?<br /> If not, what issue does the singleton pattern solve?<br /> What are the options in solving this design problem?</p><p>(Note: I have resorted to creating an internal non static global variable and passing it around carefully, instead of going the static route and its working fine. I am looking to see if there is another option.)</p><p>(Please bear with me if the question sounds very naive or unresearched, I did read a bit before posting, but seem stuck on finding an answer that explains it very clearly to me.)</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Completely ignoring any temptation to guess at the specifics of what you&#39;re trying to accomplish with your controls, or why, let me take a quick stab at answering your basic questions.</p><p>Up front; from your description, I think it sounds like your best option is just to have an instance field, not a static one, and not a singleton.  You said &#34;I actually need each instance of the control to have one such variable, not one variable across all the instances of the control in that single form.&#34;  That is kind of a loose definition of an instance variable.  Does it even really need to be public?</p><p>Actually, I would make it an instance <em>property</em>, because chances are pretty good that sooner or later you&#39;ll want to raise some event when the thing changes, or do something else that will end up making a public field feel like an unfortunate decision in retrospect.  Hindsight is always 20/20.  Or at least 20/30 or so.  But in this case, a little <em>foresight</em> says that using a simple automatic property is cheap insurance:</p><p><code>public SomeDataType WidgetSettings{ get; set; }</code></p><p>So; <strong>there is only one instance of a static field/variable for the entire assembly.</strong> Every instance of the class containing that public static variable has a reference to the very same object in memory.  So yes, all of your control instances are accessing the very same object/memory.</p><p>Any time you see &#34;static&#34; and &#34;public&#34; together in the same variable declaration line, it should be reason to pause and think.  The thing is, if the variable is something like a string, or a numeric type, or a simple collection, you will have to use synchronization code <strong>everyplace</strong> that you access that field from.  On the other hand, if it&#39;s a reference to a class with static getters and setters for various attributes, then you can put that synchronization code in the getters and setters, and you can test that class and its attributes in isolation (as a unit) and know that it works properly.  I don&#39;t know if I expressed that as well as I meant to...  But honestly, if you can what you need to do using instance variables and avoiding the whole thread-safety issue altogether, then do that instead.</p><p>If you have a static variable, it is absolutely for certain not thread-safe. At all. Maybe you&#39;re thinking that you&#39;re doing a Winforms app and all of the UI stuff executes on a single thread (because Winforms is not thread-safe), which is true enough if you follow the rules, except that we&#39;re all creative about using timers and background workers and such to loosen things up.  So it is still possible for strange things to happen. So in the worst case, not only are all of your control instances accessing and updating the same variable, they might be trampling all over each other in the process.</p><p>If you&#39;re messing with WPF, then the UI library <strong>is</strong> thread-safe and the potential pitfalls of multithreading combined with static fields apply.</p><p>If the data that the variable points at is a type that requires more than one instruction to write completely, then it is only a matter of time before one control instance writes only half of a new value before the next control instance reads that field and gets a value composed of half of one write and half of a different write.  I think the proper technical term for that situation is something along the lines of &#34;fubar.&#34;  Of course the thread that reads that mangled variable may well try to write back to it before it gets swapped out by the thread scheduler and the original thread gets another go, replacing the first thread&#39;s half-value with its own half-value before the first thread even gets a chance to write the second half of <em>its</em> value.  This is likely to end in tears, or baldness, or more likely both tears and baldness.</p><p>Finally, the singleton has all the same potential thread-safety issues as the static field, because the whole notion of a singleton is that you grab your instance from a factory method, which serves the same single instance up to everybody who asks.  So everybody who asks is, by definition, accessing the very same object.</p><p>In <em>this</em> case, my gut tells me that &#34;singleton&#34; is a code word for &#34;fancy static field, which requires a lot more code and a lot more testing, and still isn&#39;t thread-safe unless you write error-prone and performance-robbing synchronization code to go with it.&#34;</p><p>When a code word has a definition that long, it&#39;s worth seriously looking at a different approach.</p><p>For what it&#39;s worth.  :-)  Without more detail it would be awfully difficult to provide any answers that relate directly to your question.  What type of object is this static field pointing at?  Is it a collection?  Is it some kind of settings or configuration class with multiple properties? Is it an object that communicates with other parts of the system (events) in response to different signals you send it?  Etc.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-implications-of-handles-between-forms/'>C# &#8211; Implications of handles between forms</a></li><li class="list-group-item"><a href='../c-manager-container-class-vs-static-class-methods/'>C# &#8211; Manager/Container class vs static class methods</a></li><li class="list-group-item"><a href='../object-oriented-static-controllers/'>Object-oriented &#8211; Static controllers</a></li><li class="list-group-item"><a href='../java-public-static-method-calls-private-constructor/'>Java &#8211; Public static method calls private constructor</a></li><li class="list-group-item"><a href='../c-entity-framework-and-static-entity-instances/'>C# &#8211; Entity Framework and static entity instances</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>