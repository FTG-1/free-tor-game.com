<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Decoupled architecture in Android &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079953 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079953" class="post-1079953 software type-software status-publish hentry category-software tag-android tag-architecture tag-java tag-n-tier tag-repository"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Decoupled architecture in Android</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">android</span><span class="mr-2 badge badge-info">Architecture</span><span class="mr-2 badge badge-warning">java</span><span class="mr-2 badge badge-primary">n-tier</span><span class="mr-2 badge badge-danger">repository</span></p><div class="entry-content"><p>I am building an app for Android that will have multiple data sources depending on who is using it. N-tier architecture with a repository pattern seems like the right way to go about this but I am struggling trying to stick to some base rules.</p><p>From what I understand I should be able to write the BL without actually knowing anything about the UI or the DAL. My problem is that once I started writing the UI layer I realized that I need the DAL to run on a background thread. This then forces me to modify my BL/DAL to run async w/ callbacks based on a UI layer requirement which screams <strong>&#34;NO&#34;</strong> to me.</p><p>Here are the 4 layers I have right now and their dependencies.</p><p><strong>UI</strong> &#8211; <em>dependencies on BL and Common/Repository</em> = Android Activities/Fragments. UI Layer will tell the BL which concrete repository/DAL type to use</p><p><strong>BL</strong> &#8211; <em>dependencies on Common/Repository interfaces</em> = Separate package with business rules. Uses the concrete repository that was passed from the UI layer to do stuff</p><p><strong>Common/Repository</strong> &#8211; <em>no dependencies</em> = Separate package with models and interfaces that allows all other layers to interact w/o know about each other. Is this even considered a layer? Should the models be concrete classes or interfaces?</p><p><strong>DAL</strong> &#8211; <em>dependencies on Common/Repository package</em> = Separate package with concrete implementations of the repositories. If Common doesn&#39;t have concrete models should each layer have their own concrete models in order to create objects to pass between layers?</p><p>What am I missing? I&#39;m trying to force myself out of my comfort zone on this ðŸ™‚</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>On Android, the canonical answer to this is to use a combination of Activities, Fragments, Adapters, Loaders and Services.</p><p>In my project we&#39;re pretty strict about how we do things.  Activities are used to set up the base view, which is usually just a FrameLayout or something similar.  We have no UI logic whatsoever in there.  An Activity is just used to wire everything up.  UI is all handled by Fragments (except for some special fragments that we treat like an Activity).  Network reads are all done in Loaders and we use Adapters to push the data to the UI.  Adapters are owned by the Fragments, but the Activity wires them up to the Loaders with callbacks.  Services are used for network writes.</p><p>This setup takes a pretty decent amount of time to set up the infrastructure and develop your basic workflow, but once you&#39;ve got a working pattern, you can just kind of coast your way through the rest of it.  Want a Floating Action Button, just include the right fragment and base classes handle the boilerplate.</p><p>So in the end it&#39;s more of an MVP stack than a MVC.  Our views are aware of what a user is trying to do and indicate that via interfaces.  Here&#39;s a typical workflow:</p><p>User is looking at a thing and wants to vote on it.  The fragment that holds the upvote button catches the click.  First it updates the vote count locally to the expected new value.  Note that this isn&#39;t official, and it&#39;s not persisted anywhere.  It just improves latency in the most common case where the vote hasn&#39;t changed.  It casts the parent (Activity or Fragment) to an interface with an <code>upvote()</code> method and calls it.  The Activity (or Fragment) gets the upvote call and passes it on to the service, with a callback.  The service puts the action into a queue (we single-thread writes) and eventually calls the API.  The API returns the new number of votes.  The Service calls the callback, which gets routed into the Loader.  The Loader updates the relevant section of the model, and then signals to the Adapter that new data is available, which the UI then picks up and shows.  Note that if it&#39;s too difficult to patch the model, the Loader could just go re-request it.</p><p>So that&#39;s a pretty big mouthful, but our logic is separated, the entire UI is built via composition, the components are all highly testable, and it&#39;s usually pretty easy to trace out what happened when there&#39;s a bug.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../cqrs-with-repository-pattern-and-inversion-of-control-with-di/'>CQRS with Repository pattern and Inversion of Control (with DI)</a></li><li class="list-group-item"><a href='../design-how-to-implement-the-repository-pattern-for-an-app-that-will-change-its-database-from-sql-to-nosql-on-in-couple-of-years/'>Design &#8211; How to implement the repository pattern for an app that will change its database from sql to nosql on in couple of years</a></li><li class="list-group-item"><a href='../c-avoid-core-layer-referencing-dal-when-defining-repository-interface/'>C# &#8211; Avoid core layer referencing DAL when defining repository interface</a></li><li class="list-group-item"><a href='../clean-architecture-google-facebook-login-and-data-layer/'>Clean Architecture : Google/Facebook Login and data layer</a></li><li class="list-group-item"><a href='../object-oriented-am-i-breaking-oop-practice-with-this-architecture/'>Object-oriented &#8211; Am I breaking OOP practice with this architecture</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>