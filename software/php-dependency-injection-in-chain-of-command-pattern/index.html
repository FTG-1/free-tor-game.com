<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; Dependency Injection in Chain of Command pattern &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087669 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087669" class="post-1087669 software type-software status-publish hentry category-software tag-dependency-injection tag-design-patterns tag-php"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; Dependency Injection in Chain of Command pattern</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">dependency-injection</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">PHP</span></p><div class="entry-content"><p>I have a Chain of Command pattern implemented, with modules that implement an interface:</p><pre><code>interface IRequestHandler
{
    public function handle(&amp;$offset, &amp;$tripData, $request = null);
    public function setSuccessor(OffsetRequestHandler $handler);
}
</code></pre><p>I set up a chain of modules that modify the <code>$offset</code> and <code>$tripData</code> objects if necessary (I guess that it is not <em>exactly</em> a chain of command pattern, but it gets the job done ðŸ™‚</p><p>I would like to start using dependency injection whenever it is possible to ease the process of writing unit tests. My question is: how to handle it, if each module may need different set of services? I can go with Auryn, and let it automatically instantiate all dependencies for each module (at least I hope that I can), but that shouldn&#39;t be necessary in theory&#8230;</p><p><strong>Update:</strong></p><p>To build the chain I take names of classes from the config file, I instantiate them, and I arrange them in a queue. The controller is not aware of the dependencies that each module needs. Right now, there are none, because each module creates needed objects by itself (and this is what I want to change). I don&#39;t want to inject each module with the container, because this will turn into a Service locator pattern.</p><p><strong>Update 2:</strong></p><p><em>The need:</em></p><p>I get a set of data from external resources, and I need to process it to get some metrics. However, the data may be corrupted, sent in batches, or whatever, and my script needs to fix it (as much as possible). The types of problems may depend on the external resource the data comes from. And the situation is dynamic, meaning that new types of problems, and new external resources may appear in the future.</p><p><em>My idea:</em></p><p>Create modules. Each module will address specific problem. Arrange the modules in a queue (as the order of the modules may be important), and execute them injecting the incoming data as a parameter.</p><p>The solution is heavily inspired by this article on <a href="https://www.sitepoint.com/introduction-to-chain-of-responsibility/" rel="nofollow noreferrer">SitePoint</a>.</p><p>But instead of creating the instances one by one like in the example:</p><pre><code>$firstHandler = new FirstHandler();
$secondHandler = new SecondHandler();
$thirdHandler = new ThirdHandler();

//the code below sets all successors through the first handler
$firstHandler-&gt;setSuccessor($secondHandler);
$secondHandler-&gt;setSuccessor($thirdHandler);

$result = $firstHandler-&gt;handle($request);
</code></pre><p>I pull the names of the classes from the config file, and I create them with a <code>foreach</code> loop:</p><pre><code>$modulesQueue = $config-&gt;get(&#34;extensions&#34;);

foreach ( $modulesQueue as $moduleName ) {
    $moduleName = &#34;extensions\\&#34;.$moduleName;
    $startModule-&gt;setSuccessor(new $moduleName());
}
// Starting the chain:
$ret = $startModule-&gt;handle($offset, $tripDataObject, $requestData);
</code></pre><p><em>The problem:</em></p><p>If I create instance of the classes like that, I don&#39;t see what each module needs to have injected (at this moment nothing, as there is no DI applied &#8211; each module instantiate services it needs). So I see two options here: either I switch to manual creation of the modules (which is not flexible at all), or I start using <code>Reflection</code> to find out what each module needs, and provide it.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Ok, so the core problem is to create create command handler objects generically, but constructor injection enforces individual parameters for each command handler.</p><p>This can be easily solved by separating the construction process for the chain from the actual constructor call utilizing a corresponding factory class for each of your handler classes. Each factory constructor stays parameterless, but inside each factory the handler objects will be constructed with the required services injected.</p><p>By using using a strict naming scheme like <code>FirstHandlerFactory</code> for <code>FirstHandler</code>, <code>SecondHandlerFactory</code> for <code>SecondHandler</code> etc, the resulting code will then look like</p><pre><code>foreach ( $modulesQueue as $moduleName ) {
    $factoryName = &#34;extensions\\&#34;.$moduleName.&#34;Factory&#34;;
    $startModule-&gt;setSuccessor((new $factoryName())-&gt;buildModule());
}
</code></pre><p><em>(Note I did not fix that this code does not set up a chain of command, to keep things simple, but I am sure you get the idea.)</em></p><p>The <code>buildModule</code> function then may look like this</p><pre><code> class FirstHandlerFactory
 { 
     function buildModule()
     {
        return new FirstHandler(/* provide the individual services here */);
     }
 }
</code></pre><p>In your unit tests, you will be able to create your handler objects just with mock services injected, as required for the specific test, without using the factories.</p><p>This solution does neither require a DI framework, nor some reflection mechanism.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-how-to-use-dependency-injection-in-conjunction-with-the-factory-pattern/'>Java &#8211; How to use Dependency Injection in conjunction with the Factory pattern</a></li><li class="list-group-item"><a href='../dependency-injection-dependency-chain-pattern/'>Dependency Injection &#8211; Dependency Chain Pattern</a></li><li class="list-group-item"><a href='../c-interface-questions-for-using-command-pattern-and-dependency-injection-together/'>C++ &#8211; Interface questions for using Command Pattern and Dependency Injection together</a></li><li class="list-group-item"><a href='../c-organising-data-access-for-dependency-injection/'>C# &#8211; Organising data access for dependency injection</a></li><li class="list-group-item"><a href='../c-design-pattern-how-to-inject-dependencies-into-a-command-pattern/'>C# &#8211; Design pattern: How to inject dependencies into a Command pattern</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>