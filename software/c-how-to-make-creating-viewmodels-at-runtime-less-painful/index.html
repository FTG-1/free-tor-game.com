<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; How to make creating viewmodels at runtime less painful &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1064542 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1064542" class="post-1064542 software type-software status-publish hentry category-software tag-c tag-design tag-mvvm tag-wpf"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; How to make creating viewmodels at runtime less painful</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">mvvm</span><span class="mr-2 badge badge-primary">wpf</span></p><div class="entry-content"><p><strong>I apologize for the long question, it reads a bit as a rant, but I promise it&#39;s not! I&#39;ve summarized my question(s) below</strong></p><p>In the MVC world, things are straightforward. The Model has state, the View <em>shows</em> the Model, and the Controller <em>does</em> stuff to/with the Model (basically), a controller has no state. To <em>do</em> stuff the Controller has some dependencies on web services, repository, the lot. When you instantiate a controller you care about supplying those dependencies, nothing else. When you execute an action (method on Controller), you use those dependencies to retrieve or update the Model or calling some other domain service. If there&#39;s any context, say like some user wants to see the details of a particular item, you pass the Id of that item as parameter to the Action. Nowhere in the Controller is there any reference to any state. So far so good.</p><p>Enter MVVM. I love WPF, I love data binding. I love frameworks that make data binding to ViewModels even easier (using Caliburn Micro a.t.m.). I feel things are less straightforward in this world though. Let&#39;s do the exercise again: the Model has state, the View <em>shows</em> the ViewModel, and the ViewModel <em>does</em> stuff to/with the Model (basically), a ViewModel <em>does</em> have state! (to clarify; maybe it delegates all the properties to one or more Models, but that means it must have a reference to the model one way or another, which is state in itself) To <em>do</em> stuff the ViewModel has some dependencies on web services, repository, the lot. When you instantiate a ViewModel you care about supplying those dependencies, but also the state. And this, ladies and gentlemen, annoys me to no end.</p><p>Whenever you need to instantiate a <code>ProductDetailsViewModel</code> from the <code>ProductSearchViewModel</code> (from which you called the <code>ProductSearchWebService</code> which in turn returned <code>IEnumerable&lt;ProductDTO&gt;</code>, everybody still with me?), you can do one of these things:</p><ul><li>call <code>new ProductDetailsViewModel(productDTO, _shoppingCartWebService /* dependcy */);</code>, this is bad, imagine 3 more dependencies, this means the <code>ProductSearchViewModel</code> needs to take on those dependencies as well. Also changing the constructor is painful.</li><li>call <code>_myInjectedProductDetailsViewModelFactory.Create().Initialize(productDTO);</code>, the factory is just a Func, they are easily generated by most IoC frameworks. I think this is bad because Init methods are a leaky abstraction. You also can&#39;t use the readonly keyword for fields that are set in the Init method. I&#39;m sure there are a few more reasons.</li><li>call <code>_myInjectedProductDetailsViewModelAbstractFactory.Create(productDTO);</code> So&#8230; this is the pattern (abstract factory) that is usually recommended for this type of problem. I though it was genius since it satisfies my craving for static typing, until I actually started using it. The amount of boilerplate code is I think too much (you know, apart from the ridiculous variable names I get use). For each ViewModel that needs runtime parameters you&#39;ll get two extra files (factory interface and implementation), and you need to type the non-runtime dependencies like 4 extra times. And each time the dependencies change, you get to change it in the factory as well. It feels like I don&#39;t even use a DI container anymore. (I <em>think</em> Castle Windsor has some kind of solution for this [with it&#39;s own drawbacks, correct me if I&#39;m wrong]).</li><li>do something with anonymous types or dictionary. I like my static typing.</li></ul><p>So, yeah. Mixing state and behavior in this way creates a problem which don&#39;t exist at all in MVC. And I feel like there currently isn&#39;t a really adequate solution for this problem. Now I&#39;d like to observe some things:</p><ul><li>People actually use MVVM. So they either don&#39;t care about all of the above, or they have some brilliant other solution.</li><li>I haven&#39;t found an in-depth example of MVVM with WPF. For example, the NDDD-sample project immensely helped me understand some DDD concepts. I&#39;d really like it if someone could point me in the direction of something similar for MVVM/WPF.</li><li>Maybe I&#39;m doing MVVM all wrong and I should turn my design upside down. Maybe I shouldn&#39;t have this problem at all. Well I know other people have asked the same question so I think I&#39;m not the only one.</li></ul><p><strong>To summarize</strong></p><ul><li>Am I correct to conclude that having the ViewModel being an integration point for both state and behavior is the reason for some difficulties with the MVVM pattern as a whole?</li><li>Is using the abstract factory pattern the only/best way to instantiate a ViewModel in a statically typed way?</li><li>Is there something like an in depth reference implementation available?</li><li>Is having a lot of ViewModels with both state/behavior a design smell?</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The issue of dependencies when initiating a new view model can be handled with IOC.</p><pre><code>public class MyCustomViewModel{
  private readonly IShoppingCartWebService _cartService;

  private readonly ITimeService _timeService;

  public ProductDTO ProductDTO { get; set; }

  public ProductDetailsViewModel(IShoppingCartWebService cartService, ITimeService timeService){
    _cartService = cartService;
    _timeService = timeService;
  }
}
</code></pre><p>When setting up the container...</p><pre><code>Container.Register&lt;IShoppingCartWebService,ShoppingCartWebSerivce&gt;().As.Singleton();
Container.Register&lt;ITimeService,TimeService&gt;().As.Singleton();
Container.Register&lt;ProductDetailsViewModel&gt;();
</code></pre><p>When you need your view model:</p><pre><code>var viewmodel = Container.Resolve&lt;ProductDetailsViewModel&gt;();
viewmodel.ProductDTO = myProductDTO;
</code></pre><p>When utilizing a framework such as <a href="http://caliburnmicro.codeplex.com/" rel="nofollow">caliburn micro</a> there is often some form of IOC container already present.</p><pre><code>SomeCompositionView view = new SomeCompositionView();
ISomeCompositionViewModel viewModel = IoC.Get&lt;ISomeCompositionViewModel&gt;();
ViewModelBinder.Bind(viewModel, view, null);
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-need-for-a-factory-class-for-creating-viewmodels/'>Design &#8211;  need for a factory class for creating viewmodels</a></li><li class="list-group-item"><a href='../c-mvvm-pattern-best-design-approach-to-manage-an-application/'>C# &#8211; MVVM pattern &#8211; Best design approach to manage an application</a></li><li class="list-group-item"><a href='../c-what-the-best-way-to-wire-up-entity-framework-database-context-model-to-viewmodel-in-mvvm-wpf/'>C# &#8211; What the best way to wire up Entity Framework database context (model) to ViewModel in MVVM WPF</a></li><li class="list-group-item"><a href='../architecture-mvvm-and-service-pattern/'>Architecture &#8211; MVVM and service pattern</a></li><li class="list-group-item"><a href='../again-mvvm-mvp-story-passing-interface-of-a-view-to-its-view-model-why-it-is-bad/'>Again MVVM / MVP story , passing interface of a view to its view model why it is bad</a></li><li class="list-group-item"><a href='../c-net-mvvm-software-architecture-and-naming-conventions/'>C# .NET MVVM software architecture and naming conventions</a></li><li class="list-group-item"><a href='../state-handling-in-wpf-mvvm/'>State handling in WPF-MVVM</a></li><li class="list-group-item"><a href='../c-giving-viewmodels-access-to-application-wide-model-in-mvvm/'>C# &#8211; Giving Viewmodels access to application wide Model in MVVM</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>