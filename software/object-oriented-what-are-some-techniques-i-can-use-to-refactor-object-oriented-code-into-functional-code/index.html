<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Object-oriented &#8211; What are some techniques I can use to refactor Object Oriented code into Functional code &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082843 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082843" class="post-1082843 software type-software status-publish hentry category-software tag-functional-programming tag-game-development tag-object-oriented"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Object-oriented &#8211; What are some techniques I can use to refactor Object Oriented code into Functional code</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">functional programming</span><span class="mr-2 badge badge-info">game development</span><span class="mr-2 badge badge-warning">object-oriented</span></p><div class="entry-content"><p>I&#39;ve spent about 20-40 hours developing part of a game using JavaScript and HTML5 canvas.  When I started I had no idea what I was doing.  So it started as a proof of concept and is coming along nicely now, but it has no automated tests.  The game is starting to become complex enough that it could benefit from some automated testing, but it seems tough to do because the code depends on mutating global state.</p><p>I&#39;d like to refactor the whole thing using <a href="http://underscorejs.org/">Underscore.js</a>, a functional programming library for JavaScript.  Part of me thinks I should just start from scratch using a Functional Programming style and testing.  But, I think refactoring the imperative code into declarative code might be a better learning experience and a safer way to get to my current state of functionality.</p><p>Problem is, I know what I want my code to look like in the end, but I don&#39;t know how to turn my current code into it.  I&#39;m hoping some people here could give me some tips a la the Refactoring book and Working Effectively With Legacy Code.</p><hr/><p>For example, as a first step I&#39;m thinking about &#34;banning&#34; global state.  Take every function that uses a global variable and pass it in as a parameter instead.</p><p>Next step may be to &#34;ban&#34; mutation, and to always return a new object.</p><p>Any advice would be appreciated.  I&#39;ve never taken OO code and refactored it into Functional code before.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Having authored several projects in functional style JavaScript, allow me to share my experience. I will focus on high level considerations, not specific implementation concerns. Remember, there are no silver bullets, do what works best for your specific situation.</p><h2>Pure Functional vs Functional Style</h2><p>Consider what you want to gain from this functional refactoring. Do you really want a pure functional implementation, or just some of the benefits a functional programming style can bring, such as referential transparency.</p><p>I have found the latter approach, what I call functional style, to mesh well with JavaScript and is usually what I want. It also allows selective non functional concepts to be carefully used in code where they make sense.</p><p>Writing code in a more purely functional style is also possible in JavaScript, but is not always the most appropriate solution. And Javascript can never be purely functional.</p><h2>Functional Style Interfaces</h2><p>In functional style Javascript, the most important consideration is the boundary between functional and the imperative code. Clearly understanding and defining this boundary is essential.</p><p>I organize my code around functional style interfaces. These are collections of logic that behave in a functional style, ranging from individual functions to entire modules. The conceptual separation of interface and implementation is important, a functional style interface may be implemented imperatively, as long as the imperative implementation does not leak across the boundary.</p><p>Unfortunately in Javascript, the burden of enforcing functional style interfaces falls entirely on the developer. Also, language features, such as exceptions, make a truly clean separation impossible.</p><p>Since you will be refactoring an existing codebase, start by identifying existing logical interfaces in your code that can be cleanly moved to a functional style. A surprising amount of code may already be functional style. Good starting points are small interfaces with few imperative dependencies. Everytime you move over code, existing imperative dependencies are eliminated and more code can be moved over.</p><p>Keep iterating, gradually working outwards to push large parts of your project onto the functional side of the boundary, until you are happy with the results. This incremental approach allows testing individual changes and makes identifying and enforcing the boundary easier.</p><h2>Rethink Algorithms, Data Structures, and Design</h2><p>Imperative solutions and design patterns often don&#39;t make sense in functional style. Especially for data structures, direct ports of imperative code to functional style can be ugly and slow. A simple example: would you rather copy every element of a list for a prepend or cons the element onto the existing list?</p><p>Research and evaluate existing functional approaches to problems. Functional programming is more than just a programming technique, it is a different way of thinking about and solving problems. Projects written in the more traditional functional programming languages, such as lisp or haskell, are great resources in this regard.</p><h2>Understand the Language and Builtins</h2><p>This is an important part of understanding the functional imperative boundary and will effect interface design. Understand what features can be safely used in functional style code and which can not. Everything from which builtins may throw exceptions and which, like <code>[].push</code>, mutate objects, to objects being passed by reference and how prototype chains work. A similar understanding of any other libraries you consume in your project is also required.</p><p>Such knowledge allows making informed design decisions, like how to handle bad input and exceptions, or what happens if a callback function does something unexpected? Some of this can be enforced in code, but some just requires documentation on the proper usage.</p><p>Another point is how strict your implementation should be. Do you really want to try enforcing the correct behavior on maximum call stack errors or when the user redefines some builtin function?</p><h2>Using Non Functional Concepts Where Appropriate</h2><p>Functional approaches are not always appropriate, especially in a language like JavaScript. The recursive solution may be elegant until you start getting maximum call stack exceptions for larger inputs, so perhaps an iterative approach would be better. Similarly, I use inheritance for code organization, assignment in constructors, and immutable objects where they make sense.</p><p>As long as the functional interfaces are not violated, do what makes sense and what will be easiest to test and maintain.</p><hr/><h2>Example</h2><p>Here is an example of converting some very simple real code to functional style. I don&#39;t have a very good large example of the process, but this small one touches on a number of interesting points.</p><p>This code builds a trie from a string. Ill start with some code based on the top section of John Resig&#39;s <a href="../../../github.com/jeresig/trie-js/blob/master/build-trie.html" rel="noreferrer">trie-js build-trie</a> module. Many simplifications / formatting changes have been made and my intent is not to comment on the quality of original code (There are much clearer and cleaner ways to build a trie, so why this c style code comes up first in google is interesting. <a href="https://gist.github.com/mattbierner/5882460" rel="noreferrer">Here&#39;s a quick implementation that uses reduce</a>).</p><p>I like this example because I don&#39;t have to take it all the way to a true functional implementation, just to functional interfaces. Here is the starting point:</p><pre><code>var txt = SOME_USER_STRING,
    words = txt.replace(/\n/g, &#34;&#34;).split(&#34; &#34;),
    trie = {};

for (var i = 0, l = words.length; i &lt; l; i++) {
    var word = words[i], letters = word.split(&#34;&#34;), cur = trie;
    for (var j = 0; j &lt; letters.length; j++) {
        var letter = letters[j];
        if (!cur.hasOwnProperty(letter))
            cur[letter] = {};
        cur = cur[ letter ];
    }
    cur[&#39;$&#39;] = true;
}

// Output for text = &#39;a ab f abc abf&#39;
trie = {
    &#34;a&#34;: {
        &#34;$&#34;:true,
        &#34;b&#34;:{
            &#34;$&#34;:true,
            &#34;c&#34;:{&#34;$&#34;:true}
        &#34;f&#34;:{&#34;$&#34;:true}}},
    &#34;f&#34;:{&#34;$&#34;:true}};
</code></pre><p>Let&#39;s pretend this is the entire program. This program does two things: convert a string to a list of words and build a trie from the list of words. These are the existing interfaces in the program. Here is our program with the interfaces more clearly expressed:</p><pre><code>var _get_words = function(txt) {
    return txt.replace(/\n/g, &#34;&#34;).split(&#34; &#34;);
};

var _build_trie_from_list = function(words, trie) {
    for (var i = 0, l = words.length; i &lt; l; i++) {
        var word = words[i], letters = word.split(&#34;&#34;), cur = trie;
        for (var j = 0; j &lt; letters.length; j++) {
            var letter = letters[j];
            if (!cur.hasOwnProperty(letter))
                cur[letter] = {};
            cur = cur[ letter ];
        }
        cur[&#39;$&#39;] = true;
    }
};

// The &#39;public&#39; interface
var build_trie = function(txt) { 
    var words = _get_words(txt), trie = {};
    _build_trie_from_list(words, trie);
    return trie;
};
</code></pre><p>Just by defining our interfaces, we can move <code>_get_words</code> to the functional style side of the boundary. Neither <code>replace</code> or <code>split</code> modifies the original string. And our public interface <code>build_trie</code> is functional style too, even though it interacts with some very imperative code. In fact, this is a fine stopping point in most cases. More code would get overwhelming, so let me overview a few other changes.</p><p>First, make all the interfaces functional style. This is trivial in this case, just have <code>_build_trie_from_list</code> return an object instead of mutating one.</p><p><strong>Handling Bad input</strong></p><p>Consider what happens if we call <code>build_trie</code> with an array of characters, <code>build_trie([&#39;a&#39;, &#39; &#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;,  &#39; &#39;, &#39;f&#39;])</code>. The caller assumed this would behave in a functional style, but instead it throws an exception when <code>.replace</code> is called on the array. This may be the intended behavior. Or we could do explicit type checks and make sure the inputs are as we expected. But I prefer duck typing.</p><p>Strings are just arrays of characters and arrays are just objects with a <code>length</code> property and non-negative integers as keys. So if we refactored and wrote new <code>replace</code> and <code>split</code> methods that operates on array-like objects of strings, they don&#39;t even have to be strings, our code could just do the right thing. (<code>String.prototype.*</code> will not work here, it converts the output to a string). Duck typing is a totally separate from functional programming, but the larger point is that bad input should always be considered.</p><p><strong>Fundamental redesign</strong></p><p>There are also more fundamental considerations. Assume that we want to build the trie in functional style as well. In the imperative code, the approach was to construct the trie one word at a time. A direct port would have us copy the entire trie every time we need to make an insertion to avoid mutating objects. Clearly that is not going to work. Instead, the trie could be constructed node by node, from the bottom up, so that once a node is completed, it never has to be touched again. Or another approach entirely may be better, a quick search shows many existing functional implementations of tries.</p><p>Hope the example clarified things a bit.</p><hr/><p>Overall, I find writing functional style code in Javascript is a worthwhile and fun endeavor. Javascript is a surprisingly capable functional language, albeit too verbose in its default state.</p><p>Good luck with your project.</p><p><strong>A few personal projects written in functional style Javascript:</strong></p><ul><li><a href="http://mattbierner.github.io/parse.js/" rel="noreferrer">parse.js</a> - Parser Combinators</li><li><a href="http://mattbierner.github.io/nu/" rel="noreferrer">Nu</a> - Lazy streams</li><li><a href="http://github.com/mattbierner/atum" rel="noreferrer">Atum</a> - Javascript interpreter written in functional style Javascript.</li><li><a href="http://github.com/mattbierner/khepri" rel="noreferrer">Khepri</a> - Prototype programming language I use for functional Javascript development. Implemented in functional style Javascript.</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../object-oriented-is-functional-programming-a-superset-of-object-oriented/'>Object-oriented &#8211; Is functional programming a superset of object oriented</a></li><li class="list-group-item"><a href='../ring-of-numbers-where-adjacent-entries-sum-up-to-a-prime/'>Ring of numbers where adjacent entries sum up to a prime</a></li><li class="list-group-item"><a href='../object-oriented-how-to-refactor-an-oo-program-into-a-functional-one/'>Object-oriented &#8211; How to refactor an OO program into a functional one</a></li><li class="list-group-item"><a href='../c-functional-vs-object-oriented-style-in-c/'>C# &#8211; Functional vs object-oriented style in C#</a></li><li class="list-group-item"><a href='../what-makes-functional-programming-languages-declarative-as-opposed-to-imperative/'>What makes functional programming languages declarative as opposed to Imperative</a></li><li class="list-group-item"><a href='../object-oriented-return-considered-harmful-can-code-be-functional-without-it/'>Object-oriented &#8211; Return considered harmful? Can code be functional without it</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>