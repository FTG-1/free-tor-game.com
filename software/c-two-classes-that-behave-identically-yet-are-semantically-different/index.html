<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Two classes that behave identically yet are semantically different &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075996 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075996" class="post-1075996 software type-software status-publish hentry category-software tag-c tag-clean-code tag-design tag-object-oriented tag-object-oriented-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Two classes that behave identically yet are semantically different</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">clean code</span><span class="mr-2 badge badge-warning">design</span><span class="mr-2 badge badge-primary">object-oriented</span><span class="mr-2 badge badge-danger">object-oriented-design</span></p><div class="entry-content"><p>I am writing a program which is a similar to <a href="http://edgeguides.rubyonrails.org/active_record_migrations.html" rel="nofollow">Ruby&#39;s Active Record Migrations</a>, in which that every migration has both an &#34;Up&#34; and &#34;Down&#34; in terms of creating a change to the database, &#34;Up&#34; meaning bring the database forward in time, and &#34;Down&#34; reversing that change.</p><p>My program has two main functions to achieve its use-cases</p><ol><li>Get a list of scripts off the filesystem</li><li>Execute the appropriate migrations on the database</li></ol><p>The &#34;Up&#34; and &#34;Down&#34; migrations are stored in their own separate files, but they match with a similar naming scheme</p><ul><li>2014000000000001_CreateTable_up.sql</li><li>2014000000000001_CreateTable_down.sql</li></ul><p>There is a 1:1 correlation between up and down scripts.  Having just an up without the corresponding down script is not valid (and vise verse).</p><p>I have two classes in my project to represent these filesystem files.</p><pre><code>public sealed class UpScript // (and DownScript, which looks identical)
{
    public UpScript(long version, string name, string content)
    {
        Content = content;
        Version = version;
        Name = name;
    }

    public long Version { get; private set; }
    public string Name { get; private set; }
    public string Content { get; private set; }
}
</code></pre><p>The reason that I did not make a single class called <code>Script</code> is I didn&#39;t want to create ambiguity about the purpose of a specific <code>Script</code> instance. <code>UpScript</code> and <code>DownScript</code> classes should not be used interchangeability as they do not conform to the Liskov Substitution Principle.</p><p>The problem that I have here is a few parts of code that are dealing with both either <code>UpScript</code> or <code>DownScript</code> instances look almost identical.  How do I reduce the duplication without losing the expressiveness of having different classes?</p><p>My current ideas with concerns are:</p><p><strong>Abstract base class</strong></p><pre><code>public abstract class Script
{
    protected Script(long version, string name, content)
    {
        // code
    }

    // properties
}

public sealed UpScript : Script
{
    public UpScript(long version, string name, string content)
        : this(version, name, content)
    {}
}

public sealed DownScript : Script
{
    public DownScript(long version, string name, string content)
        : this(version, name, content)
    {}
}
</code></pre><p>This reduces the redundant code in the two classes, however, code that creates and consumes is still very duplicated.</p><p><strong>Single class with <code>Direction</code> property</strong></p><pre><code>public enum Direction { Up, Down }

public sealed class Script
{
    protected Script(Direction direction, long version, string name, string content)
    {
        // ...
    }

    public Direction Direction { get; private set; }

    // ...
}
</code></pre><p>This code reduces the duplication, however, it adds onus on consumes to ensure the proper script is passed to it and it creates ambiguity if you ignore the <code>Direction</code> property.</p><p><strong>Single class with two <code>Content</code> properties</strong></p><pre><code>public sealed class Script
{
    protected Script(long version, string name, string upContent, string downContent)
    {
        // ...
    }

    public string UpContent { get; private set; }
    public string DownContent { get; private set; }
}
</code></pre><p>This reduces duplication and is not ambiguous, however, the usage of the program is to either run the up script, or run the down scripts.  With this scheme, the code that gathers and creates these <code>Script</code> instances is doing twice as much work, I don&#39;t consider not doing this being premature optimization because if the user wants to do an up migration, there&#39;s no point is looking at down scripts.</p><p>With all that said I may be looking at the wrong problem to solve entirely.</p><p>If more information would be helpful in forming a suggestion, you can view <a href="https://github.com/MatthewLymer/ScriptMigrations/tree/master/Migrator/Scripts" rel="nofollow">ScriptMigrations on GitHub</a></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><em>My C# is rusty, hopefully I haven&#39;t glossed over any language constraints.</em></p><p>I would implement <code>UpScript</code> and <code>DownScript</code> as interfaces that have the same members:</p><pre><code>public interface IUpScript {
    public long Version { get; private set; }
    public string Name { get; private set; }
    public string Content { get; private set; }
}
// ...
public interface IDownScript {
    public long Version { get; private set; }
    public string Name { get; private set; }
    public string Content { get; private set; }
}
</code></pre><p>This approach attempts to provide the minimal code needed to create a distinction between up and down, nothing more. Thoughts:</p><ul><li>Classes implementing an interface will have the common properties you&#39;ve defined as in your other approaches but don&#39;t inherit implementation details like a constructor.</li><li>Your implementing classes would be free to extend other classes if they needed.</li><li>It looks as though you don&#39;t need to support multiple implementations of up and down scripts but you&#39;d have no trouble doing so.</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/are-trivial-protected-getters-blatant-overkill/'>Are trivial protected getters blatant overkill</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-how-to-argue-against-this-completely-public-mindset-of-business-object-class-design/'>C# &#8211; How to argue against this &#8220;completely public&#8221; mindset of business object class design</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>