<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Should I use a unique_ptr with an array type, or a vector &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068661 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068661" class="post-1068661 software type-software status-publish hentry category-software tag-c tag-smart-pointer"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Should I use a unique_ptr with an array type, or a vector</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">smart-pointer</span></p><div class="entry-content"><p>I&#39;ve been out of C++ for years, last time I used it was back in gamedesign before C++11. I see all these new pointer types which seem great. But I&#39;m unsure when and how to use them. In the old days I would create a buffer like this:</p><pre><code>uint bufferSize = 1024;
unsigned char *buffer = (unsigned char*)malloc(bufferSize, sizeof(char));
</code></pre><p>It&#39;s not pretty and I&#39;m pretty sure even back then new/delete was already a thing in C++, but I never learned about them in that time. I don&#39;t think raw pointers should be used if avoidable, so I&#39;m trying to get used to writing this now:</p><pre><code>uint bufferSize = 1024;
std::unique_ptr&lt;unsigned char[]&gt; buffer;
buffer = std::make_unique&lt;unsigned char[]&gt;(bufferSize);
</code></pre><p>But this raises the question, should I just map the old raw pointers to <code>unique_ptr</code> like this? There&#39;s also <code>std::vector</code>, which seems like a much more natural fit for any array. Should I use a vector instead? Are there rules of thumb for when to use one or the other (for arrays)?</p><p>To add some more specific information, I&#39;m making a game and I&#39;m setting up a screenbuffer to draw to, I&#39;m starting with ASCII and will likely move on to pixels somewhere in the future. The buffer size will never have to change at runtime, but it would be nice to be able to play with the screen size a bit during development so that&#39;s why I&#39;m not simply declaring a fixed-length array (my bufferSize is actually two consts multiplied; screenWidth and screenHeight). This is just a prototype, it doesn&#39;t have to be scalable or deployable, but I still want to use this chance to learn to write better C++.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><code>sizeof(TYPE)</code> has been a bad idea in C and C++ since forever, assuming you could use <code>sizeof *pointer</code>. The problem is that it duplicates the type-Information without adding a check.</p><p>In C, casting a <code>void*</code> is also a bad idea, as overriding the language should only be done where and when necessary after careful consideration.</p><p>And finally, <code>malloc()</code> only accepts one argument, you want to multiply there instead. Your compiler should warn you though.</p><p>Next, this:</p><pre><code>uint bufferSize = 1024;
unsigned char *buffer = (unsigned char*)malloc(bufferSize * sizeof(char));
</code></pre><p>Is not quite equivalent to the following, barring the allocator used and the automatic management of the buffer:</p><pre><code>uint bufferSize = 1024;
auto buffer = std::make_unique&lt;unsigned char[]&gt;(bufferSize);
</code></pre><p>The additional difference is the value-initialization, the latter does it, the former refrains from it.</p><p>Is that significant?<br/> We cannot say, it depends on the specific circumstances. Maybe you actually want that initialization, or the compiler can optimize it out.</p><p>Or maybe the following matches your needs better:</p><pre><code>uint bufferSize = 1024;
std::unique_ptr&lt;unsigned char[]&gt; buffer(new unsigned char[bufferSize]);
</code></pre><p>Alternative using C++20 <a href="https://en.cppreference.com/w/cpp/memory/unique_ptr/make_unique" rel="nofollow noreferrer"><code>std::make_unique_default_init()</code></a>:</p><pre><code>uint bufferSize = 1024;
auto buffer = std::make_unique_default_init&lt;unsigned char[]&gt;(bufferSize);
</code></pre><p>Anyway, unless you use something like directly above, or you have to pass the buffer on to code expecting a <code>new</code>ed up buffer, <code>std::vector</code> is likely simpler and is liable to be optimized down to the same code.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-3d-point-cloud-render-from-xyz-2d-array-with-texture/'>C++ &#8211; 3d point cloud render from x,y,z 2d array with texture</a></li><li class="list-group-item"><a href='../c-2d-linked-list-vs-multidimensional-array-vector/'>C++ &#8211; 2D linked list vs. multidimensional array/vector</a></li><li class="list-group-item"><a href='../c-stdvector-non-array-implementation/'>C++ &#8211; std::vector Non-Array Implementation</a></li><li class="list-group-item"><a href='../c-key-value-store-development-porting-to-modern-c/'>C++ &#8211; Key / Value store development porting to modern C++</a></li><li class="list-group-item"><a href='../c-how-to-store-various-sized-values-in-a-vector/'>C++ &#8211; How to store various sized values in a vector</a></li><li class="list-group-item"><a href='../object-oriented-factories-vectors-and-smart-pointers-design-question/'>Object-oriented &#8211; Factories, vectors and smart pointers &#8211; Design Question</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>