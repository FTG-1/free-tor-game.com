<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Assert equality in mstest when types may differ &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076117 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076117" class="post-1076117 software type-software status-publish hentry category-software tag-c tag-data-types tag-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Assert equality in mstest when types may differ</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">data types</span><span class="mr-2 badge badge-warning">testing</span></p><div class="entry-content"><p>I&#39;ve been working on some MSTest automated test infrastructure, that is testing a tool that merges data sets into SQL Server database tables. The basic structure of the test is to:</p><ol><li>Define the incoming dataset using anonymous types</li><li>Apply the data using the reconcile tool</li><li>Read records from the output tables</li><li>Compare result rows to input data, column by column</li></ol><p>Example input data:</p><pre><code>public class InputData : List&lt;dynamic&gt; {} // Inspired by Massive etc

InputData input = new InputData()
{
    new { ExternalID = 1, PropertyName = &#34;hello&#34;, Agent = &#34;test&#34; },
    new { ExternalID = (Int64)2, PropertyName = &#34;fred&#34;, Agent = &#34;test&#34; } // Fixes the problem with a cast
};
</code></pre><p>The issue I&#39;m dealing with, is that the type inferred on my anonymous objects will be an Int32, but the corresponding column in my target table is a bigint, and hence the record will have an Int64 value. As a result, when I use Assert.AreEqual across each column, it fails on any int fields:</p><pre><code>Assert.AreEqual failed. Expected:&lt;1 (System.Int32)&gt;. Actual:&lt;1 (System.Int64)&gt;
</code></pre><p>You can see I have cast the int on my second anonymous object, this can be used to fix the issue. The primary aim of these tests is to make the sample data as slim and easy to read/write as possible, and I&#39;d prefer to avoid the visual noise of all those casts.</p><p>I&#39;m thinking about the best way to deal with the assertions. It seems like I should use dedicated assertions based on type. I guess the real question is, how aggressive should I be in converting between types automatically?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><code>Assert.AreEqual</code> is basically just sugar for <code>Assert.IsTrue(object.Equals(...))</code>. If there isn&#39;t a known comparison operator for the two argument types, they&#39;ll compare <code>false</code>.</p><p><code>dynamic</code> is pretty smart about this, so, for example, <code>(dynamic)(int)1 == (decimal)1.0</code> evaluates to <code>true</code>. That only works if you use the <code>==</code> operator, though; it won&#39;t work if you try to use <code>object.Equals</code>, <code>Assert.AreEqual</code>, <code>((dynamic)x).Equals(...)</code> or anything similar. Simply casting to <code>dynamic</code> won&#39;t work, you need to actually use its <code>==</code> operator. The good news is, the dynamic <code>==</code> allows any operand, which means you can get this to compile in a general-purpose assertion; if the comparison is invalid (e.g. comparing <code>int</code> to <code>string</code>, then it will fail at runtime with a <code>RuntimeBinderException</code>.</p><p>The next best thing, if you know they&#39;re going to be numeric types, would be to cast them all to <code>Decimal</code> or <code>Double</code>, although note that if you use <code>Double</code> you&#39;ll have to take into account the possibility of floating-point rounding error, and you should define equality based on some threshold, typically a multiple of <a href="http://msdn.microsoft.com/en-us/library/system.double.epsilon(v=vs.110).aspx" rel="noreferrer">Double.Epsilon</a>. <code>Decimal</code> is a lot simpler unless you know for certain that you&#39;ll be dealing with floating point.</p><p>I don&#39;t think that you really have a lot of other choices. I personally would not recommend string conversion because lots of classes don&#39;t override <code>ToString</code>, so you end up comparing two instances of something like <code>System.Collections.Generic.List``1[System.Int32]</code>, and your assertion declares that these are equal because they have the same string representation when in fact they are not only different instances but contain completely different elements. So don&#39;t do that. String coercion can easily mask serious errors in your tests. Stick to non-lossy, all-or-nothing conversions as above.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-differences-between-given-when-then-gwt-and-arrange-act-assert-aaa/'>C# &#8211; Differences between Given When Then (GWT) and Arrange Act Assert (AAA)</a></li><li class="list-group-item"><a href='../c-when-using-generics-for-both-in-and-out-types-why-is-out-type-generally-last/'>C# &#8211; When using generics for both in and out types, why is out type generally last</a></li><li class="list-group-item"><a href='../c-when-do-the-benefits-of-nullable-value-types-outweigh-the-cost-of-null-pointers/'>C# &#8211; When do the benefits of nullable value types outweigh the cost of null pointers</a></li><li class="list-group-item"><a href='../c-when-writing-a-qt-application-is-good-practice-to-always-prefer-qt-function-implementations-data-types-and-classes-when-they-are-available/'>C++ &#8211; When writing a Qt application is good practice to ALWAYS prefer Qt function implementations, data types, and classes when they are available</a></li><li class="list-group-item"><a href='../database-how-to-test-variable-values-which-differ-due-to-floating-point-inaccuracy-caused-by-different-dbms-types/'>Database &#8211; How to test variable values which differ due to floating point inaccuracy caused by different DBMS types</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>