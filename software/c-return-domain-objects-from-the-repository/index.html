<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Return domain objects from the repository &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077172 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077172" class="post-1077172 software type-software status-publish hentry category-software tag-c tag-domain-driven-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Return domain objects from the repository</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">domain-driven-design</span></p><div class="entry-content"><p>I am more experienced with the Database First approach for Entity Framework.  I am currently looking at a Code First project, which returns domain model objects from the repository.</p><p><strong>Database First</strong></p><p>Please see the code below, which is a Database First repository method I created:</p><pre><code>public dbPerson getPersonByID(int personID)
        {
            return _dbContext.Set&lt;dbPerson&gt;()
                   .Where(x =&gt; x.ID == personID);  
        }
</code></pre><p>dbPerson is a class created by Entity Framework Database First.  The application service calls getPersonByID (contained in repository) and maps the dbPerson class returned by the repository to Person (Domain class).  The Person domain object then calls its own methods.</p><p><strong>Code First</strong></p><p>I am now looking at a code first implementation that appears to call the database and return a domain object i.e. the repository looks like this:</p><pre><code>public Person getPersonByID(int personID)
        {
            return _dbContext.Set&lt;Person&gt;()
                   .Where(x =&gt; x.ID == personID);  
        }
</code></pre><p>In this case; there is no need to map dbPerson to Person in the application service (as there was in my Database First example).</p><p><strong>Question(s)</strong></p><p>1) Is this a benefit of Code First?</p><p>2) Is it an anti pattern to put domain logic in a code first EF entity?</p><p>3) Is it an anti pattern to put domain logic in a database first EF entity? Are these classes suppose to be treated as simple DTOs i.e. with no methods?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It depends. Is the Person class a plain old C# object when instantiated?  I&#39;m not super familiar with EF but in other frameworks like Doctrine or Hibernate you can rely on the framework to instantiate and return a plain old object that doesn&#39;t have any framework magic in it.</p><p>If that&#39;s the case, and there&#39;s nothing about the object or class that ties it to the persistence framework like an inheritance hierarchy,  then yes I think it&#39;s perfectly reasonable to return it from a repository.</p><p>From the comments below, I&#39;d also add the following. I realise that some of these ideas may be swimming against the tide a little bit.</p><p>The idea of code-first vs. db-first is basically a relic inherent in the age of EF and the best practice evolution around ORMs. Particularly, with DDD, you&#39;d always choose code-first and only use db-first when you have a legacy DB that you need to integrate with a new domain / application layer. In that sense, when using DDD, I&#39;d consider that the EF db-first classes should constitute the input to your Anti-Corruption Layer of your domain.</p><p>However, with the code-first paradigm the issue is different. In that scenario, with ORM frameworks like EF, you don&#39;t want to mix your persistence framework with your domain code and that instinct is quite right.</p><p>However it raises the issue of what constitutes &#34;mixing&#34;, and whether or not using plain old objects that the framework knows how to hydrate from the database is enough of a separation of concerns. My view is that if the hydrated objects are plain old objects that can standalone from the framework, then you are still separating your concerns. The reason for this is that the objects returned from the repositories are abstracted from the ORM: client code of the repositories can&#39;t tell the difference if the plain old object came from the ORM or some other thing like a factory or other persistence mechanism, like a cache.</p><p>Some frameworks might require you to make your code-first classes inherit from a framework-provided parent class, or might use reflection or some other run-time dynamism to add methods to your code-first classes, for example to support an ActiveRecord-style API. In those cases, even with code first, I would say it&#39;s probably okay to have your own plain domain classes. But you are adding complexity for the extra abstraction.</p><p>Some ORM frameworks, likely EF as well, will provide proxy-type classes for related entities. So, for example, if you have an Employee entity class that composes a Person entity class, and they are connected to each other via a foreign-key relationship in the database, when you obtain an Employee object from the repository, depending on what kind of database query was used and the configuration of the relationship, the related Person entity data will be lazily loaded from the database. In that case, when you call getPerson() on the Employee object, there&#39;s proxy object returned instead of the real Person object, and the proxy object will fault in the Person data the first time you try to read the data from the object.</p><p>Personally I don&#39;t feel that the use of proxy objects in this way, even though it&#39;s part of the framework&#39;s magic, should cause you to create separate domain objects. Again, if you were to swap out ORMs or use a different persistence store, the repositories could encapsulate / delegate all of that. Concerns about coupling the persistence framework and the domain model can be alleviated in the repositories.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-domain-driven-design-and-wcf-services-architecture/'>C# &#8211; Domain driven design and WCF services architecture</a></li><li class="list-group-item"><a href='../should-i-use-the-repository-in-the-domain-object-or-push-the-domain-object-back-to-the-service-layer/'>Should I use the repository in the Domain Object or push the Domain Object back to the Service Layer</a></li><li class="list-group-item"><a href='../the-best-way-to-create-dtos-from-entities-and-update-entities-from-dtos-in-a-layered-architecture/'>The best way to create DTOs from entities and update entities from DTOs in a layered architecture</a></li><li class="list-group-item"><a href='../c-in-ddd-should-repositories-expose-an-entity-or-domain-objects/'>C# &#8211; in DDD, should repositories expose an entity or domain objects</a></li><li class="list-group-item"><a href='../how-do-entities-dto-doa-work-together-and-whats-their-role-within-a-system/'>How do entities, DTO, DOA work together and what’s their role within a system</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>