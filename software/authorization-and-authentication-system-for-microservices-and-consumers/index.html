<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Authorization and authentication system for microservices and consumers &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068446 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068446" class="post-1068446 software type-software status-publish hentry category-software tag-authentication tag-authorization tag-microservices tag-security"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Authorization and authentication system for microservices and consumers</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">authentication</span><span class="mr-2 badge badge-info">authorization</span><span class="mr-2 badge badge-warning">microservices</span><span class="mr-2 badge badge-primary">Security</span></p><div class="entry-content"><p>We plan to refactor our company system into a micro-service based system. This micro-services will be used by our own internal company applications and by 3rd party partners if needed. One for booking, one for products etc.</p><p>We are unsure how to handle roles and scopes. The idea is to create 3 basic user roles such as Admins, Agents and End-Users and let the consumer apps to fine-tune scopes if needed.</p><ul><li><strong>Admins</strong> can create, update, read and delete all<br /> resources by default (for their company).</li><li><strong>Agents</strong> can create, update and read data for their company.</li><li><strong>End-Users</strong> can create, update, delete and read data, but cannot access same endpoints as agents or admins. They will also be able to create or modify data, just not on a same level as agents or admins. For example, end users can update or read their account info, same as agent will be able to do it for them, but they can&#39;t see or update admin notes.</li></ul><p>Let&#39;s say that agents by default can create, read and update each resource for their company and that is their maximum scope which can be requested for their token/session, but developers of client (API consumer) application have decided that one of their agents can read and create only certain resources.</p><p>Is it a better practice to handle this in our internal security, and let them write that data in our database, or let clients handle that internally by requesting a token with lesser scope, and let them write which agent will have which scope in their database? This way we would have to track only token scopes.</p><p>The downside of this, is that our team would also need to create fine-tuned access mechanisms in our internal applications.</p><p>With this way of thinking, micro-services and their authorization system should not be bothered with clients needs, because they are only consumers and not part of the system (even though some of those consumers are our own internal apps)?</p><p>Is this delegation a good approach?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Authentication and authorization are always good topics</p><p>I will try to explain to you how we deal with authorizations in the current multi-tenant service that I am working. The authentication and authorization are token based, using the JSON Web Token open standard. The service exposes a REST API that any kind of client (web, mobile, and desktop applications) can access. When a user is successfully authenticated the service provides an access token that must be sent on each request to the server.</p><p>So let me introduce some concepts we use based on how we perceive and treat data on the server application.</p><p><strong>Resource</strong>: It is any unit or group of data that a client can access through the service. To all the resources that we want to be controlled we assign a single name. For instance, having the next endpoint rules we can name them as follow:</p><p><strong><code>product</code></strong></p><pre><code>/products
/products/:id
</code></pre><p><strong><code>payment</code></strong></p><pre><code>/payments/
/payments/:id
</code></pre><p><strong><code>order</code></strong></p><pre><code>/orders
/orders/:id
/orders/:id/products
/orders/:id/products/:id
</code></pre><p>So let&#39;s say that so far we have three <strong>resources</strong> in our service; <code>product</code>, <code>payment</code> and <code>order</code>.</p><p><strong>Action</strong>: It is an operation that can be performed on a resource, like, read, create, update, delete, etc. It is not necessary to be just the classic CRUD operations, you can have an action named <code>follow</code>, for instance, if you want to expose a service that propagates some kind of information using WebSockets.</p><p><strong>Ability</strong>: The ability to perform an <code>action</code> on a <code>resource</code>. For instance; read products, create products, etc. It is basically just a resource/action pair. But you can add a name and description to it too.</p><p><strong>Role</strong>: A set of abilities that a user can own. For example, a role <strong><code>Cashier</code></strong> could have the abilities &#34;read payment&#34;, &#34;create payment&#34; or a role <strong><code>Seller</code></strong> can have the abilities &#34;read product&#34;, &#34;read order&#34;, &#34;update order&#34;, &#34;delete order&#34;.</p><p>Finally, a user can have various roles assigned to him.</p><hr/><h2>Explanation</h2><p>As I said before, we use JSON Web Token and the abilities that a user possesses are declared in the payload of the token. So, suppose we have a user with the roles of cashier and seller at the same time, for a small retail store. The payload will look like this:</p><pre><code>{
    &#34;scopes&#34;: {
        &#34;payment&#34;: [&#34;read&#34;, &#34;create&#34;],
        &#34;order&#34;: [&#34;read&#34;, &#34;create&#34;, &#34;update&#34;, &#34;delete&#34;]
    }
}
</code></pre><p>As you can see in the <code>scopes</code> claim we don&#39;t specify the name of the roles (cashier, seller), instead, just the resources and the actions that are implicated are specified. When a client sends a request to an endpoint, the service should check if the access token contains the resource and action required. For example, a <code>GET</code> request to the endpoint <code>/payments/88</code> will be successful, but a <code>DELETE</code> request to the same endpoint must fail.</p><hr/><blockquote><ul><li><p>How to group and name the <strong>resources</strong> and how to define and name the <strong>actions</strong> and <strong>abilities</strong> will be a decision made by the developers.</p></li><li><p>What are the <strong>roles</strong> and what abilities will have those roles, are decisions made by the customers.</p></li></ul></blockquote><hr/><p>Of course, you must add extra properties to the payload in order to identify the user and the customer (tenant) that issued the token.</p><pre><code>{
    &#34;scopes&#34;: {
        ...
    },
    &#34;tenant&#34;: &#34;acme&#34;,
    &#34;user&#34;:&#34;coyote&#34;
}
</code></pre><hr/><p>With this method, you can fine-tune the access of any user account to your service. And the most important, you don&#39;t have to create various predefined and static roles, like <strong>Admin, Agents, and End-Users</strong> as you point out in your question. A <strong>Super User</strong> will be a user that owns a <strong><code>role</code></strong> with all the <strong><code>resources</code></strong> and <strong><code>actions</code></strong> of the service assigned to it.</p><p>Now, What if there are 100 resources and we want a role that gives access to all or almost all of them?. Our token payload would be huge. That is solved by nesting the resources and just adding the parent resource in the access token scope.</p><hr/><p>Authorization is a complicated topic that must be addressed depending on the needs of each application.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../microservices-and-authorization/'>Microservices and authorization</a></li><li class="list-group-item"><a href='../soa-microservices-how-to-handle-authorization-in-inter-services-communications/'>SOA/Microservices: How to handle authorization in inter-services communications</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>