<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#038; REST API: How to check for duplicate before inserting record &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071328 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071328" class="post-1071328 software type-software status-publish hentry category-software tag-database tag-iterator tag-java tag-rest tag-validation"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#038; REST API: How to check for duplicate before inserting record</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database</span><span class="mr-2 badge badge-info">iterator</span><span class="mr-2 badge badge-warning">java</span><span class="mr-2 badge badge-primary">rest</span><span class="mr-2 badge badge-danger">validation</span></p><div class="entry-content"><p>I am developing an application in Java to parse and upload records from a CSV to an online database, via a REST API.</p><p>While I know for sure that there are no duplicate records in each CSV file, I cannot be sure that each CSV file has only been processed once (*see clarification below), so I need to check for duplicates before inserting.</p><p>[CLARIFICATION] I cannot implement a solution by checking that each CSV file has only been processed once. The CSV files contain bank transaction records downloaded from a bank. Therefore I know that each individual CSV file does not contain duplicates. However, multiple CSV files could be downloaded for the same date range, or for overlapping date ranges, etc. &#8211; so I need to check for duplicates at the transaction level rather than the file level.</p><p>Unfortunately I have no control over the back-end database, and I can only use the methods available via the API. This means the usual solutions using SQL (e.g. <a href="https://softwareengineering.stackexchange.com/questions/155539/i-need-an-approach-to-the-problem-of-preventing-inserting-duplicate-records-into">this question</a>) are not suitable.</p><p>Methods available from API (<a href="http://help.moneytrackin.com/index.php/REST_API" rel="nofollow noreferrer">http://help.moneytrackin.com/index.php/REST_API</a>):</p><ul><li><p>listTransactions</p></li><li><p>editTransaction</p></li><li><p>insertTransaction</p></li></ul><p>Methods available but probably not relevant:</p><ul><li><p>listProjects</p></li><li><p>listWriteProjects</p></li><li><p>getBalance</p></li><li><p>getTags</p></li><li><p>newProject</p></li><li><p>deleteProject</p></li><li><p>listTagTransactions</p></li><li><p>deleteTransaction</p></li><li><p>listCurrencies</p></li><li><p>userData</p></li></ul><p>It is not a huge database: only four columns, and a few thousand records.</p><p>It seems like my only option is to iterate over each record to be inserted and compare it to each record from the database:</p><pre><code>get ListOfRecordsInDb from database using listRecords(). Store in HashMap,
    local database or similar data structure??

for each record to be inserted,
    iterate over ListOfRecordsInDb, checking none of them match 
       the record to be inserted
    if no match found, insert record
</code></pre><p>This seems very inefficient. Are there any other options? If not, what is the most efficient way to compare thousands of records, using Java?</p><hr/><p><strong>Answers to comments/questions:</strong></p><blockquote><p>What happens if you call insertTransaction with a transaction that<br /> already exists? Does it duplicate it or does it fail?</p></blockquote><p>The transaction is successfully inserted as a duplicate</p><blockquote><p>Does the CSV file have an &#34;id&#34; column?</p></blockquote><p>No. The available columns are Date, Description, Amount and Balance. The combination of these makes each record unique, so I could potentially create an ID based on these.</p><blockquote><p>Does listRecords() allow pagination, or can it only return all of the<br /> records?</p></blockquote><p>It only returns the records, in XML format.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>I cannot be sure that each CSV file has only been processed once...</p></blockquote><p>You might want to attempt to solve your question by handling this first. If I am getting this right, the crux of your problem doesn&#39;t appear to be individual duplicate transactions (since you mentioned &#34;I know for sure that there are no duplicate records in each CSV file&#34;), but to prevent duplicate processing <em>per</em> file.</p><p>Hence, you can consider adding some kind of state logic in your Java application that knows whether a file has been processed by computing and storing its checksum, e.g. <a href="https://en.wikipedia.org/wiki/Md5sum" rel="nofollow">its MD5 hash</a>. Once you have a matching checksum, you know that there&#39;s a good chance the file has been processed before. You can perform further verification such as by inspecting the number of lines, or other certain unique identifiers of each file.</p><p>Further extending this idea, if there are possibilities of the same transaction appear across different CSV files, then your only other option, besides updating the database schema to handle duplicate records properly, is to store all the processed transactions locally within your Java application. If there can be multiple instances of your application (either on the same computer, or across a network), then you&#39;ll either need yet another centralized database to handle this, or some distributed data grid... by then, the better option is still back to the drawing board to <em>improve</em> on your existing database schema.</p><p><strong>edit</strong></p><p>To flip things around, the other considerations to look into <s>, if changing the database schema to handle duplicates nicely is <strong>entirely <em>don&#39;t-even-think-about-it</em> nigh impossible</strong>,</s> is to evaluate how much data your Java application will need to process at any given time, and how fast the connection is between the database and your application.</p><p>On the lower end, say your application is processing only 10 records per file, averaging one file an hour. The network connection is very good, say almost as good as accessing a locally-hosted database. In this case, I don&#39;t think there&#39;s much of a performance impact from having to query all the records.</p><p>On the extreme end, your application is expected to read thousand-line-long transaction files every 10 seconds, and the network connection is extremely bad, say taking a minute to query all the records. In this case, you have more concern about processing the files in a speedy manner, and this is how you can probably suggest modifying the database schema. :)</p><p>So, assuming all is fine in the lower-end case, what would be an efficient way of comparing a relatively large data set with a smaller input set for duplicates? I&#39;ll suggest marshalling the XML payload you get into a <code>HashSet</code>. Also, I hope you have a <code>Transaction</code> domain class that has properly-implemented <code>hashCode()</code> and <code>equals()</code> methods. A Java 8 potential solution would then be:</p><pre><code>// assuming your database records are marshalled into currentSet
inputSet.stream().filter(v -&gt; !currentSet.contains(v))
                    .forEach( /* these are the new records to send to the database */);
</code></pre><p>Also, the elephant in the room: concurrent insertions. Will there be any? If so, how do you intend to handle it then?</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-i-need-an-approach-to-the-problem-of-preventing-inserting-duplicate-records-into-the-database/'>Database &#8211; I need an approach to the problem of preventing inserting duplicate records into the database</a></li><li class="list-group-item"><a href='../database-how-to-store-fuzzy-dates-into-a-database/'>Database &#8211; How to store &#8220;fuzzy dates&#8221; into a database</a></li><li class="list-group-item"><a href='../c-design-pattern-for-logging-changes-in-parent-child-objects-saved-to-database/'>C# &#8211; Design pattern for logging changes in parent/child objects saved to database</a></li><li class="list-group-item"><a href='../java-dao-design-for-writing-big-xml-file-on-database/'>Java &#8211; DAO design for writing big XML file on database</a></li><li class="list-group-item"><a href='../rest-api-design-how-to-break-down-the-api-object-to-make-more-scalable-and-robust-api/'>REST API Design: How to break down the API object to make more scalable and robust API</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>