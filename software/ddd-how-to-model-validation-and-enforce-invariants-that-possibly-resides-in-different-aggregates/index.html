<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>DDD &#8211; how to model validation and enforce invariants that possibly resides in different aggregates &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084011 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084011" class="post-1084011 software type-software status-publish hentry category-software tag-aggregate tag-domain-driven-design tag-invariants tag-modeling"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">DDD &#8211; how to model validation and enforce invariants that possibly resides in different aggregates</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aggregate</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">invariants</span><span class="mr-2 badge badge-primary">modeling</span></p><div class="entry-content"><p>I have two models in my current design, <em>student</em> and <em>group</em>. Student and group are both aggregate roots.</p><p>A student can be <em>added to a group</em> (method on group aggregate root), and it can be active for either the whole duration of the group or part of it. The group has an invariant which says that &#34;all students added to a given group has to either be active for the full duration of the group, or have start- and end-dates that are inside the groups start and end dates. These connections (group.student) are saved as a child entity (0..*) that belongs to the groups aggregate. So far so good.</p><p>However, Group also has an property called &#34;course-code&#34;, which is a value object conatining a specific code along with additional (for this example irrelevant) data.</p><p><strong>The part I&#39;m struggling with.</strong><br /> One business rule of the domain and system is that a student can only have one active group-connection per course-code at any given date. By that I mean that if a student is added to a group the <em>Group.AddStudent(student, daterange)</em>-method has to check if the student has an active connection to another group with the same course-code at the supplied daterange. This is data that doesn&#39;t belong to a single group aggregate and neither to the student as you currently can&#39;t query student for its active groups by (f.eg) student.groups. I&#39;ve intentionally modeled it like this to avoid a bi-directional relationship.</p><p><strong>What I&#39;ve thought about</strong></p><ol><li>Put the whole action (add to group) in a domain service that can ask repositories for the data and enforce /hold invariants.</li><li>Pass all groups the student is currently connected to to the <em>AddStudentToGroup</em>-method (or possibly just groups on the same course-code).</li><li>Add a property to a student which would hold all courses it&#39;s currently studying with their respective dateranges. This would allow method to ask the passed in student if the supplied date is overlapping any existing range or not. This also has the upside of enabling a student to stand more on its own instead of having a list of group-ids that needs to be loaded each time you require some data about them.</li></ol><p>Someone else who&#39;s encountered a similar situation? How would/did you solve it?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I&#39;m going to forego the discussion about artificial invariants and assume there is a compelling reason why such a convoluted invariant must exist. I will also assume there is absolutely no way to re-assess the rules to come up with a simpler system by way of limiting the possible combinations of active/inactive + courseId + date range. ...</p><p>Okay. Your choices are limited here (and are all really the same thing packaged in different ways). Option one is to wrap everything up in a single aggregate, <code>Course</code>, which has a collection of <code>Group</code> and <code>Student</code> and allow it to be the arbiter of how a <code>Student</code> gets into a <code>Group</code>. Of course this will mean loading a bunch of unnecessary and potentially expensive state each time you intend to change any one of these connections. Depending on the size of your system, the simplicity of a single aggregate may not be feasible.</p><p>Option two is to model the appropriate slice(s) of state in order to limit the amount of data loaded into your system to what is necessary for the desired use case. That is, explicitly model the required slices of state necessary to carryout your use case, populate them, and coordinate them. There is no reason to issue a query from a domain service because you will know up front that the <code>AddStudentToGroup</code> use case requires all of the groups in which a student is currently active for a given date range as well as the group to which you intend to add the student. These queries can be issued <em>first</em> so only the data (model) needs to be passed to the domain service for coordination.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../can-an-aggregate-root-hold-references-of-members-of-another-aggregate-root/'>Can an aggregate root hold references of members of another aggregate root</a></li><li class="list-group-item"><a href='../ddd-how-to-avoid-breaking-encapsulation-and-leaking-technical-concerns-to-the-domain-during-model-rehydration/'>DDD: How to avoid breaking encapsulation and leaking technical concerns to the domain during model rehydration</a></li><li class="list-group-item"><a href='../architecture-balance-between-aggregate-boundaries-and-domain-consistency-in-ddd/'>Architecture &#8211; Balance between aggregate boundaries and domain consistency in DDD</a></li><li class="list-group-item"><a href='../applying-ddd-is-having-multiple-aggregates-representing-the-same-concept-from-a-different-view-a-good-idea/'>Applying DDD, is having multiple aggregates representing the same concept from a different view a good idea</a></li><li class="list-group-item"><a href='../a-problem-with-understanding-aggregates-and-aggregate-roots-in-domain-driven-design-ddd/'>A problem with understanding aggregates and aggregate roots in Domain Driven Design (DDD)</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>