<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Checking &#8220;instanceof&#8221; rather than value using a switch statement &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1063267 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1063267" class="post-1063267 software type-software status-publish hentry category-software tag-java tag-switch-statement tag-syntax"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Checking &#8220;instanceof&#8221; rather than value using a switch statement</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">java</span><span class="mr-2 badge badge-info">switch statement</span><span class="mr-2 badge badge-warning">syntax</span></p><div class="entry-content"><p>Is there some syntax (other than a series of if statements) that allows for the use of a switch statement in Java to check if an object is an instanceof a class?  I.e., something like this:</p><pre><code>switch (object) {
     case instanceof SecondObject:
        break;
     case instanceof ThirdObject:
        break;
}
</code></pre><p>Sidenote:  I recognize that as a design pattern, checking against instanceof and making decisions based on it is not as preferable as using inheritance.  To give some context why this would be useful to me, here&#39;s my situation:</p><p>I&#39;m working on a project that involves a <a href="http://code.google.com/p/kryonet/" rel="noreferrer">kryonet</a> client/server.  For communication over KryoNet, you pass objects that it serializes using kryo.  Anything added to the object increases the size of these packets,<sup>1</sup> so to minimize the network traffic, you keep these objects as light weight as possible.  When you receive a packet, you need to know what to do with it, so I&#39;m making this determination based on what type of packet object the passed object is an instanceof.  This approach is the same undertaken in the examples included with Kryonet&#39;s distribution.  I&#39;d love to clean up the hideous class that translates these packets into action, and figure a switch statement would at least make it look moderately more organized.</p><hr/><p><sup>1</sup>As I wrote the statement above, I had doubts about whether what I was saying was accurate. The <a href="https://softwareengineering.stackexchange.com/a/187692/31260">answer below</a> seems to disagree:</p><blockquote><p>Methods don&#39;t add anything to the runtime size of an object. The<br /> method code is not transmitted, and nothing about the methods requires<br /> any representation in an object&#39;s state. This is not a sound reason<br /> for instanceof testing, etc.</p></blockquote><p>I guess the real issue is I don&#39;t know what happens under the hood for Kryo to serialize an object and I was nervous to do anything that increased the bandwidth.  Your answers have inspired me to do it with inheritance and add the appropriate methods to the objects.  So thank you!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I fully realize that I am 2 years late to the party :-) but probably few clarifications will help other devs.</p><p>What the other answers missed to address was the mentioning of the &#34;Kryonet&#34; which adds additional twist to the problem: usually when kryonet is used it  means that</p><p><strong>a)</strong> the client is an android app and</p><p><strong>b)</strong> the client is some game</p><p>If both conditions are met IMHO using the instanceof if-else sequence is the way to go.</p><p>The usual way of structuring client/server app in our case android game + &#34;pure&#34; java server is to use (at least) 3 projects:</p><ul><li>&#34;common&#34; - which contains code common for the server and the client, most importantly all the message classes (which usually implement some tag/marker interface as <code>GameMessage</code>).</li><li>server - contains the server and includes the <code>common</code> project. Usually all messages are simply registered in Kryonet, i.e. no pooling is used (because on server GC is not considered a problem)</li><li>android client - contains the android app (game) and includes the <code>common</code> project. Because in java games <a href="https://stackoverflow.com/questions/2484079/how-can-i-avoid-garbage-collection-delays-in-java-games-best-practices">creating objects during the game may trigger the GC</a> it is considered the biggest mortal sin (which leads straight to the hell of missed frames) it is considered good practice<sup>1</sup> to use object pooling for the game messages (this requires little customization on the Kryonet/kryo in order to use object pools). All messages are (must be) registered in kryonet in the same order as on the server in order things to work.</li></ul><p>First, lets look at the alternatives and see why they are not fit for the structure/implementation described above:</p><p><strong>1. They say &#39;Use polymorphism and method overriding&#39;</strong></p><p>Take a look <a href="https://stackoverflow.com/questions/5579309/switch-instanceof">here</a> for an example of the proposed solution (accepted answer by jmg). It looks very elegant but there there are at least 2 big problems:</p><ol><li><p>You can&#39;t just use parameterless overrided method like <code>do()</code> because in real implementation you will some need external data to act upon. For example when receiving <code>PlayerAbandonedGame</code> message on the server you will need at least the particular game object as parameter in order to call <code>removePlayer(Player pl)</code> method. <code>NewGameState</code> message will require reference to the particular <code>GameState</code> variable that will be updated and so on. One very ugly solution is overrided method to have single parameter like <code>TheWholeThing</code> which contains all the objects that may be needed. It is needless to say that this not only violates the principle of encapsulation but also &#34;spreads&#34; the game logic across multiple message classes.</p></li><li><p>Remember that we have the <code>common</code> project and all the messages are defined there. Even if server-to-client messages are completely distinct set to client-to-server messages it will be simply stupid to put server or client logic in the <code>common</code> project.</p></li></ol><p><strong>Game message objects are just data containers</strong>. It is up to the server or the client to handle that data in a particular way (or even ignore it as often happens with out of order UDP messages).</p><p><strong>2. They say &#39;Use reflection&#39;</strong></p><p>Our context is &#39;a) the client is an android app&#39;. The reaction of every android developer hearing <code>Use reflection</code> should be to stand up, clear his/hers throat and with his/hers best british accent to say: &#39;Are you completely mAd?!&#39; :-)</p><p>Reflection is very slow on older Android versions, it is slow even now (5.0). Also IMO using reflection is the ugliest possible solution not just for this particular problem. It should be avoided up in the stack, i.e. in app dev.</p><p><strong>Way to go</strong></p><p>Back to the original question: if one really insist on using <code>switch</code> the solution is to have base class like:</p><pre><code>public abstract class GameMessage {
    byte mCode; // not private because of kryo

    public GameMessage(byte code) {
        super();
        mCode = code;
    }

    public byte getCode() {
        return mCode;
    }
}
</code></pre><p>concrete message will look like:</p><pre><code>public class PlayerAbandonedGame extends GameMessage {
    // some fields

    public PlayerAbandonedGame() {
        super((byte) 42);
    }
}
</code></pre><p>and then message handler will look like:</p><pre><code>public synchronized void onMessageReceived(GameMessage msg) {
    switch(msg.getCode()) {
        case 42:
            // do something
            break;
        default:
            mLogger.error(&#34;Unknown message code {}&#34;, msg.getCode());
            // may be even throw an exception?
            break;
    }

    // ...
}
</code></pre><p>Of course it is advisable to use enum values instead of hardcoded numbers...</p><p>Potential drawback is (as mentioned in other answers) if you create new message class and forget to add it to some of the switch statements. The compiler cannot catch this problem and you will hit it only runtime (in the <code>default</code> case).</p><p><strong>Real</strong> (small) drawback is that <code>code</code> field is send each time and adds to the traffic. In reality this adds about 1-10% to the size of the messages (if you use <code>byte</code> for the code field).</p><p><strong>How I do it</strong></p><p>I personally use if-else sequence with instanceof test like:</p><pre><code>public synchronized void onMessageReceived(GameMessage msg) {
    if (msg instanceof MyLetterAttemptResult) {
        handleMyLetterAttemptResult((MyLetterAttemptResult) msg);
        mPools.release(msg);
    } else if (msg instanceof InAutoMatchQueue) {
        handleInAutoMatchQueue((InAutoMatchQueue) msg);
    } else if (msg instanceof AutoMatchRetry) {
        handleAutomatchRetry();
    // more else-ifs
    } else {
        mLogger.error(&#34;Unknown message {}&#34;, msg.getClass().getSimpleName());
        // throw exception may be?
    }
}
</code></pre><p><strong>Isn&#39;t that &#34;code smell&#34;?</strong> You bet it is, but after trying all other alternatives it seems to me that it is best. To reduce the smelliness it is better to try to keep code in the ifs short like above. Just call handle* method and release message back to the pool (if it is pooled).</p><p><strong>Isn&#39;t that slow?</strong> It is a bit slower than the <code>switch(msg.getCode())</code> but not that much. <a href="https://stackoverflow.com/questions/103564/the-performance-impact-of-using-instanceof-in-java">Here is some benchmarking</a> (answer by Dan Mihai Ile). Advantage is that you don&#39;t have the <code>code</code> field send each time over the network. Keep the most frequently used messages at the top so they are found first.</p><p><strong>Isn&#39;t that error prone?</strong> There is a risk if you create new message class and forget to add corresponding <code>else if</code>. The thing is that you have just two separate message handling methods - one on the server and one on the client. Both are the single most important code pieces repectively on the server and the client. You will simply have to not mess it up. Just add the new message class immediately to the unit test that tests <code>onMessageReceived()</code>.</p><p><strong>This is not OOP! I have a better solution!</strong> I will be very happy to discuss it and use it :-). btw, I wonder if @Cameron (the author of this question) found better solution. After all this question is 2 years old...</p><hr/><p><sup>1</sup> For me avoiding the GC is more like &#34;utter crap&#34; than &#34;best practice&#34;. As Eonil commented in <a href="https://stackoverflow.com/questions/2484079/how-can-i-avoid-garbage-collection-delays-in-java-games-best-practices">1</a>: <code>I regard avoiding GC on GC based language is a kind of insane trial.</code></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-use-a-switch-statement-with-enum-efficiently/'>How to use a switch statement with enum efficiently</a></li><li class="list-group-item"><a href='../java-when-is-method-overloading-appropriate/'>Java &#8211; When is method overloading appropriate</a></li><li class="list-group-item"><a href='../design-map-of-functions-vs-switch-statement/'>Design &#8211; Map of functions vs switch statement</a></li><li class="list-group-item"><a href='../searching-algorithm-used-in-switch-statement/'>Searching algorithm used in switch statement</a></li><li class="list-group-item"><a href='../how-to-reduce-a-switch-in-a-switch-statement/'>How to reduce a switch in a switch statement</a></li><li class="list-group-item"><a href='../java-how-does-this-switch-statement-do-multiple-things/'>Java &#8211; How does this switch statement do &#8220;multiple things&#8221;</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>