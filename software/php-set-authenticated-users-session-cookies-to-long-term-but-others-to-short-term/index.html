<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; Set authenticated users session cookie&#8217;s to long term, but others to short term &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086449 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086449" class="post-1086449 software type-software status-publish hentry category-software tag-cookies tag-php tag-session"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; Set authenticated users session cookie&#8217;s to long term, but others to short term</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">cookies</span><span class="mr-2 badge badge-info">PHP</span><span class="mr-2 badge badge-warning">session</span></p><div class="entry-content"><p>We want to extend the session duration for our users. I guess it doesn&#39;t matter for users who are not authenticated. We can create a PHPSESSID cookie for them and if it expires when they close their browser then fine. But for users who are authenticated we want to extend the session duration so they don&#39;t have to sign in repeatedly. We could just extend the session cookie duration for all users (authenticated, and non-authenticated) but as we handle millions of requests a month, this would mean millions of active sessions right? However, the number of users we will have to authenticate is only in the thousands. Can we change the duration of some session cookies? Is this the right approach? Or is there a better method to handle long term session cookies?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Are you actually using sessions to store data for non-authenticated users, or are you just calling <code>session_start()</code> on every page load? If that&#39;s the case, just stop initializing sessions for every visitor, and only do so when a user actually logs in.</p><p><em>Only start a session if one already exists:</em></p><pre><code>if (session_status() === PHP_SESSION_ACTIVE) {
    session_start();
}
</code></pre><p><em>Start session at login:</em></p><pre><code>if ($_SERVER[&#39;REQUEST_METHOD&#39;] == &#39;POST&#39;) {
    if ($_POST[&#39;username&#39;] == &#39;foo&#39; &amp;&amp; $_POST[&#39;password&#39;] == &#39;bar&#39;) {
        session_start();
        $_SESSION[&#39;username&#39;] = $_POST[&#39;username&#39;];
    }
}
</code></pre><p>However, if you are in fact storing session data for even non-authenticated visitors, it gets a little trickier. You can&#39;t just set a custom TTL for individual sessions. You could certainly modify the session expiration length to be several days or weeks, but this would cause PHP to retain the server-side session data for the same length of time.</p><p>Your concern about millions of active sessions is understandable, but the actual impact on your server depends entirely on how you&#39;ve configured PHP to handle sessions. <strong>By default, the sessions are stored on the server&#39;s file system in a temp directory.</strong> Since the session files are minuscule <em>(assuming you aren&#39;t doing something horrific like storing BLOB data in them)</em>, you aren&#39;t likely to use a significant amount of disk space accommodating user sessions for extended lengths of time.</p><p>However, if your site experiences constant and heavy traffic, the disk IO is going to flog your server into submission. In this case, I would think about using memcache or redis as the session engine, in order to ease the load on my server&#39;s hard disk. But you don&#39;t want session data remaining in the server&#39;s physical memory for very long, so set the TTL to something relatively short like 1800 (seconds).</p><p><strong>Now comes the tricky part: persisting long-term sessions...</strong></p><p>When a user logs in, you can send them a custom cookie containing their session id, and with a much longer TTL (or none at all). Then, create a database entry or write a &#34;temp&#34; file containing the <code>serialize()</code>&#39;d session, and indexed by the session id. You would need to keep this db entry or temp file in sync with the session while the user is active, but once they leave and the in-memory session expires, you still have their session data on your hard disk. When they return, days or weeks later, you can read their cookie value, retrieve the serialized session from your database or temp file, reinitialize the user&#39;s session with the original ID, and <code>unserialize()</code> the session data back into <code>$_SESSION</code>.</p><p><strong>IMPORTANT NOTES:</strong> You would need to implement some measures to prevent session stealing, such as comparing the visitor&#39;s IP address and/or user agent (browser) against their values at login. You would also need to have some kind of cron job clear out stagnant session data from your db or temp file directory after a given length of time, otherwise it would just keep getting bigger.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../understanding-http-cookies-in-indy-10-for-delphi-xe2/'>Understanding HTTP Cookies in Indy 10 for Delphi XE2</a></li><li class="list-group-item"><a href='../web-development-user-session-timeout-handling-in-saas-apps-discussing-several-approaches/'>Web-development &#8211; User session timeout handling in SaaS apps &#8211; discussing several approaches</a></li><li class="list-group-item"><a href='../rest-persistent-restful-state-on-client-without-cookies/'>Rest &#8211; Persistent RESTful state on client without cookies</a></li><li class="list-group-item"><a href='../php-make-php-sessions-truly-last-until-the-browser-closes-and-regenerating-session-on-page-requests/'>Php &#8211; Make PHP sessions truly last until the browser closes, and regenerating session on page requests</a></li><li class="list-group-item"><a href='../how-to-keep-user-logged-in-when-using-openid-connect-cookies-in-dotnet-core/'>How to keep user logged in when using OpenID Connect &#038; Cookies in dotnet core</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>