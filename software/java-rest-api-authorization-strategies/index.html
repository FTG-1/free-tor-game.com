<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; REST API authorization strategies &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073511 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073511" class="post-1073511 software type-software status-publish hentry category-software tag-backend tag-java tag-rest tag-security"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; REST API authorization strategies</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">backend</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">rest</span><span class="mr-2 badge badge-primary">Security</span></p><div class="entry-content"><p>There are a lot of questions on here that deal with the mechanics of authentication and authorization of RESTful APIs but none of them appear to go in to details of how to implement secure services at the application level.</p><p>For example let&#39;s say that my webapp (I&#39;ve got Java in mind but this applies to any backend really) has a secure authentication system that allows users of the API to login with a username and password. When the user makes a request, at any point during the request processing pipeline I can call a <code>getAuthenticatedUser()</code> method which will return either the null user if the user isn&#39;t logged in, or a User domain object that represents the logged in user.</p><p>The API allows authenticated users to access their data e.g. a GET to <code>/api/orders/</code> will return that user&#39;s list of orders. Similarly, a GET to <code>/api/tasks/{task_id}</code> will return data relating to that specific task.</p><p>Let&#39;s assume that there are a number of different domain objects that can be associated with a user&#39;s account (orders and tasks are two examples, we could also have customers, invoices etc.). We only want authenticated users to be able to access data about their own objects so when a user makes a call to <code>/api/invoices/{invoice_id}</code> we need to check that the user is authorized to access that resource before we serve it up.</p><p>My question is then, do patterns or strategies exist to deal with this authorization problem? One option I&#39;m considering is creating a helper interface (i.e. <code>SecurityUtils.isUserAuthorized(user, object)</code>), which can be called during request processing to ensure that the user is authorized to fetch the object. This isn&#39;t ideal as it pollutes the application endpoint code with lots of these calls e.g.</p><pre><code>Object someEndpoint(int objectId) {
    if (!SecurityUtils.isUserAuthorized(loggedInUser, objectDAO.get(objectId)) {
        throw new UnauthorizedException();
    }
    ...
}
</code></pre><p>&#8230;and then there&#39;s the question of implementing this method for every domain type which could be a bit of a pain. This might be the only option but I&#39;d be interested to hear your suggestions!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>Please for the love of God do not create a <code>SecurityUtils</code> class!</strong></p><p>Your class will become 10k lines of spaghetti code in a matter of months! You would need to have an <code>Action</code> type (create, read, update, destroy, list, etc.) passed into your <code>isUserAuthorized()</code> method, which would quickly become a thousand-line-long <code>switch</code> statement with increasingly complex logic that would be difficult to unit test. Don&#39;t do it.</p><hr/><p>Generally what I do, at least in Ruby on Rails, is have each domain object be responsible for its own access privileges by having a <strong><em>policy class for each model</em></strong>. Then, the controller asks the policy class if the current user for the request has access to the resource or not. Here&#39;s an example in Ruby, since I&#39;ve never implemented anything like it in Java, but the idea should come across cleanly:</p><pre class="lang-rb prettyprint-override"><code>class OrderPolicy

    class Scope &lt; Struct.new(:user, :scope)

        def resolve

            # A user must be logged in to interact with this resource at all
            raise NotAuthorizedException unless user

            # Admin/moderator can see all orders
            if (user.admin? || user.moderator?)
                scope.all
            else
                # Only allow the user to see their own orders
                scope.where(orderer_id: user.id)
            end
        end
    end

    # Constructor, if you don&#39;t know Ruby
    def initialize(user, order)
        raise NotAuthorizedException unless user
        @user = user
        @order= order
    end

    # Whitelist what data can be manipulated by each type of user
    def valid_attributes
        if @user.admin?
            [:probably, :want, :to, :let, :admin, :update, :everything]
        elsif @user.moderator?
            [:fewer, :attributes, :but, :still, :most]
        else
            [:regualar, :user, :attributes]
        end
    end

    # Maybe restrict updatable attributes further
    def valid_update_attributes
    end

    # Who can create new orders
    def create?
        true # anyone, and they would have been authenticated already by #initialize
    end

    # Read operation
    def show?
        @user.admin? || @user.moderator? || owns_order
    end

    # Only superusers can update resources
    def update?
        @user.admin? || @user.moderator?
    end

    # Only admins can delete, because it&#39;s extremely destructive or whatever
    def destroy?
        @user.admin?
    end

    private

    # A user &#39;owns&#39; an order if they were the person who submitted the order
    # E.g. superusers can access the order, but they didn&#39;t create it
    def owns_order
        @order.orderer_id == @user.id
    end
end
</code></pre><p>Even if you have complex nested resources, some resource must &#39;own&#39; the nested resources, so the top-level logic inherently bubbles down. However, those nested resources need their own policy classes in the event that they can be updated independently of the &#39;parent&#39; resource.</p><p>In my application, which is for my university&#39;s department, <em>everything</em> revolves around the <code>Course</code> object. It&#39;s not a <code>User</code>-centric application. However, <code>User</code>s are enrolled in <code>Course</code>, so I can simply ensure that:</p><p><code>@course.users.include? current_user &amp;&amp; (whatever_other_logic_I_need)</code></p><p>for any resource that a particular <code>User</code> needs to modify, since almost all resources are tied to a <code>Course</code>. This is done in the policy class in the <code>owns_whatever</code> method.</p><p>I haven&#39;t done much Java architecture, but it seems that you could make a <code>Policy</code> interface, where the different resources that need to be authenticated must implement the interface. Then, you have all the necessary methods which can become as complex as you need them to be <em>per domain object</em>. The important thing is to tie the logic to the model itself, but at the same time keep it in a separate class (single responsibility principle (SRP)).</p><p>Your controller actions could look something like:</p><pre><code>public List&lt;Order&gt; index(OrderQuery query) {

    authorize(Order.class)
    // you should be auto-rescuing the NotAuthorizedException thrown by
    //the policy class at the controller level (or application level)

    // if the authorization didn&#39;t fail/rescue from exception, just render the resource
    List&lt;Order&gt; orders = db.search(query);
    return renderJSON(orders);
}

public Order show(int orderId) {

    authorize(Order.class)
    Order order = db.find(orderId);
    return renderJSON(order);
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-custom-use-of-authorization-header-in-a-rest-api/'>Rest &#8211; Custom use of Authorization header in a REST API</a></li><li class="list-group-item"><a href='../rest-is-it-an-implementation-of-a-stateful-mechanism-for-rest-api-authentication/'>Rest &#8211; Is it an implementation of a stateful mechanism for Rest API authentication</a></li><li class="list-group-item"><a href='../rest-should-i-specify-the-userid-in-the-rest-url-structure/'>Rest &#8211; Should I specify the userId in the REST URL structure</a></li><li class="list-group-item"><a href='../rest-prevent-abuse-to-rest-api-endpoint/'>Rest &#8211; Prevent abuse to REST API endpoint</a></li><li class="list-group-item"><a href='../java-rest-api-and-resource-authorization/'>Java &#8211; Rest API and resource authorization</a></li><li class="list-group-item"><a href='../rest-api-design-multiple-resources-and-authorization/'>REST API Design: Multiple resources and authorization</a></li><li class="list-group-item"><a href='../authentication-and-authorization-front-end-vs-back-end-dilemma/'>Authentication and authorization &#8211; front-end vs back-end dilemma</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>