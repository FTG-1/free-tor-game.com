<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>What data should a repository return &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068911 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068911" class="post-1068911 software type-software status-publish hentry category-software tag-asp-net tag-dto tag-onion-architecture tag-repository"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">What data should a repository return</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net</span><span class="mr-2 badge badge-info">dto</span><span class="mr-2 badge badge-warning">onion-architecture</span><span class="mr-2 badge badge-primary">repository</span></p><div class="entry-content"><p>I have a simple project where the controller calls the service, and the service calls the repository in order to get the needed data.</p><p>Assuming that we have these domain models:</p><pre><code>// this model has a RepositoryA built for it
Class A {
   public string Name { get; set; }
   public int B_Id { get; set; }
}

// this model has a RepositoryB built for it
Class B {
   public string Age{ get; set; }
}
</code></pre><p>And this DTO:</p><pre><code>Class MyDto {
   public string Name { get; set; }
   public string Age{ get; set; }
}
</code></pre><p>And knowing (correct me if I&#39;m wrong) that a repository shouldn&#39;t return a DTO, and that the query must be done in a RepositoryA where we have to select both models A &amp; B in order to build a return that contains a mix of properties (complex request with multiple joins on different tables in the real project), what model should the repository return if not the DTO ?? knowing that the DTO is already prepared to receive the mix of properties?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>And knowing (correct me if I&#39;m wrong) that a repository shouldn&#39;t return a DTO</p></blockquote><p>Theoretically, every layer (= project in your solution) should have its own DTO objects. In that sense, your repositories should return a DTO, but this is not the same DTO as the &#34;business logic DTO&#34;.</p><p>However, in reality, we don&#39;t need that much separation. The benefits do not outweigh the effort. In most cases, it suffices to have a single entity-DTO conversion, which tends to happen in the business layer (BLL), which is one layer above the repository layer (DAL).<br/> In that sense, your repositories should not return a DTO. But your business classes should.</p><hr/><blockquote><p>and that the query must be done in a RepositoryA where we have to select both models A &amp; B in order to build a return that contains a mix of properties (complex request with multiple joins on different tables in the real project)</p></blockquote><p>The issue here is one of <strong>realism</strong>. The theory simply can&#39;t be put into practice.</p><p>Theoretically, repositories are designed to be entity-type-specific data providers. In other words, you get <code>A</code> from the <code>ARepository</code> and <code>B</code> from the <code>BRepository</code>.</p><p>However, when dealing with external storage resources (database server), the effort needed to retrieve data is <em>non-negligible</em>. This creates an issue for us. For every entity type we wish to retrieve, we need a separate call via its own repository.</p><p><em><strong>Sidenote</strong>: If you&#39;re either not dealing with an external data resource or you&#39;re not trying to run single queries which will return objects of multiple types, the continuation of this answer is irrelevant to you, as you&#39;ll be perfectly happy with getting each type from its own repository.</em></p><p>Once you&#39;re dealing with more than one entity type in a request, separating these into separate retrieval queries is counterproductive. While it does create a clean code structure, it dramatically impacts performance. This becomes doubly egregious when you realize that a SQL database server is specifically optimized for joining (by using indexes), but the code that calls the database (repository) is somehow incapable of implementing that same graceful data mixing approach.</p><p>Using repositories has becoming an antipattern here. The obstacles you encounter are caused by us <em>deciding to use repositories</em>. And a &#34;solution&#34; that creates a bigger obstacle than it aims to solve is not a solution.</p><hr/><p>A <strong>unit of work</strong> solves a lot of the problems that repositories introduce in terms of transational safety (having all repositories use the same context.</p><p>However, a unit of work does not help with deciding where to write a complex data query (<code>ARepository</code>? <code>BRepository</code>? ...)</p><hr/><p>This is a tough choice. In a way, repositories are really nice, especially in one-entity-type contexts (e.g. simple CRUD functionality). On the other hand, it massively complicates complex data retrieval.</p><p>I haven&#39;t encountered a universally agreed upon solution for this. But I have worked on several project where one (or more) agreements were struck to at least keep the location of the code (especially for complex data queries) somewhat sensical.</p><p>It&#39;s always good to implement a unit of work.</p><p>This is just a list of agreements I&#39;ve encountered over several projects I&#39;ve worked at. I can&#39;t really put one over the other</p><ol><li><p>Complex data queries are put into the repository of their <strong>main</strong> entity type.</p><ul><li>A query which retrieves a list of cars and includes their owners belongs to the <code>CarRepository</code>.</li><li>A query which retrieves a list of people and includes the cars they own belongs to the <code>PersonRepository</code>.</li><li><p><strong>Pro</strong> You can keep the old repository structure but at least make it less of a guessing game where to put the code.</p></li><li><p><strong>Con</strong> There are fringe cases where there is no clear &#34;main&#34; entity type.</p></li></ul></li><li>Complex data queries are put into their own repository. &#34;Old&#34; repositories that focus on a single entity type should only be used in CRUD operations.<ul><li>If you have a method that saves <code>A</code> and <code>B</code> objects, you should have an <code>ABRepository</code> which internally uses <code>ARepository</code> and <code>BRepository</code> (a unit of work is incredibly important here!).</li><li><strong>Pro</strong> it separates the CRUD logic from the reporting logic.</li><li><strong>Con</strong> If you have many combinations (<code>AB</code>, <code>AC</code>, <code>ABC</code>, <code>ACD</code>, ...) the list of repositories is going to grow out of bounds.</li><li>The suggestion to prevent the &#34;con&#34; is to name these repositories after their <em>function</em> (<code>YearlyReportsRepository</code>) and not just their aggregate list of entity types (<code>PersonCarRepository</code>).</li></ul></li></ol><hr/><blockquote><p>what model should the repository return if not the DTO ??</p></blockquote><p><strong>If you choose option 1</strong>, that question has an easy answer.</p><ul><li>A query which retrieves a list of cars and includes their owners belongs to the <code>CarRepository</code>.</li></ul><p>In other words, it returns a <code>IEnumerable&lt;Car&gt;</code> and therefore still follows the idea that &#34;a <code>CarRepository</code> returns cars&#34; (and possibly some related entities, but they are not explicitly part of the return type).</p><ul><li>A query which retrieves a list of people and includes the cars they own belongs to the <code>PersonRepository</code>.</li></ul><p>In other words, it returns a <code>IEnumerable&lt;Person&gt;</code> and therefore still follows the idea that &#34;a <code>PersonRepository</code> returns people&#34; (and possibly some related entities, but they are not explicitly part of the return type).</p><p><strong>If you choose option 2</strong>, then you&#39;re implicitly arguing that a complex data report is something different from a simple CRUD operation. This means that you&#39;d probably end up returning <em>custom classes</em> (<code>CarOwnerResult</code>) from the <em>custom repositories</em> (= not bound to a single entity type).</p><p><em>Note that, if you want to, simple repositories (bound to a single entity type) can still be expected to return only their bound entity type, just like before.</em></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-confused-on-how-to-properly-employ-a-repository-pattern-with-service-business-layer-on-top/'>C# &#8211; Confused on how to properly employ a Repository Pattern with Service/Business Layer on top</a></li><li class="list-group-item"><a href='../object-oriented-what-data-type-should-gateway-return-in-repository-pattern-to-eliminate-refactoring-when-switching-persistence-mechanisms/'>Object-oriented &#8211; What data type should Gateway return in Repository Pattern to eliminate refactoring when switching persistence mechanisms</a></li><li class="list-group-item"><a href='../c-architecture-how-to-pass-models-between-controllers-services-and-repositories/'>C# &#8211; Architecture: How to pass models between controllers, services and repositories</a></li><li class="list-group-item"><a href='../architecture-how-to-structure-microservices-in-your-repository/'>Architecture &#8211; How to structure microservices in your repository</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>