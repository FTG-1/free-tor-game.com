<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Should I Do Calculations in T-SQL or Program &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070786 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070786" class="post-1070786 software type-software status-publish hentry category-software tag-c tag-sql-server tag-tsql"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Should I Do Calculations in T-SQL or Program</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">sql server</span><span class="mr-2 badge badge-warning">tsql</span></p><div class="entry-content"><p>I am creating a stored procedure that is logging some data. The data ultimately needs to end up in 2 tables. The incoming data is coming from a JSON string containing 15 parameters, and the data is then logged to the database using the stored procedure I&#39;m writing. I would like to send the data into 1 stored procedure and INSERT it into both tables.</p><p>The first table is a raw data logging table. It will be used for debug and troubleshooting.</p><p>The second table will be used for report generation. This table requires some simple mathematical calculations to be done on incoming data. For example:</p><p><code>DECLARE @Table2Fld3 DECIMAL = @IncomingFld9 - @IncomingFld4;</code></p><p>I&#39;ll have about 8 of these calculations to do to compute the values for table 2, then I&#39;ll do an INSERT to save the data.</p><p>So my question is, is it a good practice to do these calculations in the T-SQL? Or would it be better for me to create 2 separate stored procedures and do the calculations in my code?</p><p>One trade-off I see is that if I do it all in the code then I have to create 2 database connections.</p><p><strong>EDIT</strong></p><p>I should elaborate on the &#34;2 database connections&#34; comment. The application in question is a windows service that establishes multi-threaded server/client communication. The logging system is asynchronous to the server/client communication. Using that existing system, in order for me to target multiple stored procedures, it would require 2 calls to the logger which would spin up 2 connections to the database.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I prefer to keep plenty (not <em>all</em>, but plenty) of the logic in the database for just a ton of reasons (and without getting into the whole &#34;who needs stored procedures nowadays&#34; argument).</p><p>Do this in your stored procedure.</p><p>These look like simple computations.  Also use a transaction in your sproc to manage the writes to both tables, <em>unless</em> it is okay if your database becomes inconsistent (sometimes the write might succeed in one table, but not the other).  And don&#39;t listen to the guys who try to tell you that &#34;real programmers write their own rollback code,&#34; because that&#39;s just silly.  :-) The only reliable rollback code is the rollback code inside the database engine itself, and it&#39;s easy to use.</p><p>If you do these calculations in your imperative code outside the database and use two stored procedures to write the data, you <em>still</em> have to consider utilizing a database transaction unless it is okay for your database to become inconsistent.  So now (if you do this outside the database) all of a sudden you&#39;re up to at least 4 round-trip calls to the database instead of 1:</p><ol><li>Begin TX</li><li>Write table 1</li><li>Write table 2</li><li>Commit TX</li></ol><p>If the writes are small, it is entirely possible that you&#39;ll have more overhead in the network round trips than in the actual work done by the database.  Even though you can use the same connection to call both stored procedures (must, if you use a transaction), you still have to make multiple, separate calls to the database server across the network.</p><p>Finally, if the logic of the calculations changes, and you&#39;re doing those calculations in your code outside the database, then you have to change that code, recompile it and redeploy the updated program.  But if you have those calculations in your stored procedure, you can rebuild that one stored procedure without having to redeploy (re-install?) your entire application.</p><p>All of these points are exacerbated if we&#39;re talking about a thick client desktop app--which you did not specify--because that means you have to re-install the updated app on every workstation, and while you have it installed on some workstations but not on others, you have different workstations doing different things to your database.  Also, depending on your source control and build practices, you could be looking at a major operation to go back in time and branch your repository to make some changes in your data access layer, not to mention the potential work involved in merging the changes in the branch forward into the DAL in your main source line.</p><p>Do this in the stored procedure, because that is honestly the right place to do it.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-rewriting-c-formula-calculations-in-t-sql/'>C# &#8211; Rewriting C# Formula Calculations in T-SQL</a></li><li class="list-group-item"><a href='../reading-csv-files-located-on-a-linux-server-and-updating-the-tables-in-a-sql-server-database/'>Reading CSV files located on a Linux server and updating the tables in a SQL Server database</a></li><li class="list-group-item"><a href='../c-entity-framework-with-no-direct-table-access/'>C# &#8211; Entity Framework with no direct table access</a></li><li class="list-group-item"><a href='../c-a-clr-sql-server-stored-procedure-calling-an-asp-net-web-api/'>C# &#8211; A CLR SQL Server Stored Procedure calling an ASP.NET Web API</a></li><li class="list-group-item"><a href='../c-deep-sql-relationships-to-a-c-object-model/'>C# &#8211; Deep SQL relationships to a C# object model</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>