<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; Balance between aggregate boundaries and domain consistency in DDD &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085651 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085651" class="post-1085651 software type-software status-publish hentry category-software tag-aggregate tag-architecture tag-design-patterns tag-domain-driven-design tag-object-oriented-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; Balance between aggregate boundaries and domain consistency in DDD</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aggregate</span><span class="mr-2 badge badge-info">Architecture</span><span class="mr-2 badge badge-warning">design-patterns</span><span class="mr-2 badge badge-primary">domain-driven-design</span><span class="mr-2 badge badge-danger">object-oriented-design</span></p><div class="entry-content"><p>Designing an Aggregate and choosing an Aggregate Root getting tricky for me all the time especially when it comes to ensuring right transactional contexts and consistency constraints so I&#39;m wondering whether there are any practices that can make it easier.</p><h2>By example</h2><p>There is a student attendance tracking system that keeps records of student attendances of groups.</p><p><a href="../../../i.stack.imgur.com/Yz4p8.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/Yz4p8.png" alt="enter image description here"/></a></p><ol><li>Course is a top-level component, describes a generic info about the learning course (name, description)</li><li>Every Course has Groups that describe groups a User must sign up to if he/she wants to attend Group Meeting.</li><li>Every Group contains a list of Meetings that describe occurrings of the Group a User can attend. Is defined by (datetimeBegins, datetimeEnds and a set of Attendance objects).</li><li>Attendance is a record holds info about a student attending. Contains a reference to the User and some statistical data.</li></ol><h2>Iteration #1</h2><p>It seemed a good idea to design Aggregate boundaries to match the taxonomy above exactly, where the main pillar was the Course Aggregate Root:</p><p><a href="../../../i.stack.imgur.com/sf0c0.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/sf0c0.png" alt="enter image description here"/></a></p><p>It is nice because:</p><ol><li>Matches the domain taxonomy exactly</li><li>Ensures domain constraints like &#34;Groups cannot be created outside the Course&#34; or &#34;Meetings must be defined inside a Group&#34;.</li></ol><p>But at the same time, it&#39;s very fat, hard to maintain and designed with false invariants in mind that caused transactional failures: nothing about creating a new Meeting item should logically interfere with editing/creating a course for example. It just doesn&#39;t scale. Moreover, usually, you may want to update Group by adding some Sessions having GroupId and it should not require fetching the whole Course.</p><h2>Iteration #2</h2><p>Then I came up with an idea to separate all main concepts into different ARs:<br /> <a href="../../../i.stack.imgur.com/v3c8n.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/v3c8n.png" alt="enter image description here"/></a></p><p>After all, I have not problems with transactions, but, unfortunately, it added more questions than solved problems:</p><ol><li>Since Group and Meeting are separate AR now, how to ensure nobody<br /> will create &#34;deattached&#34; from Course Group or Meeting outside the<br /> Group via their own repositories?</li><li>Having <code>Meeting#attend(UserId userId)</code> method, how to ensure the user is eligible (signed up for the Group) for attending this meeting?</li></ol><h2>Ideas for the Iteration #3</h2><p><a href="../../../i.stack.imgur.com/nBnPJ.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/nBnPJ.png" alt="enter image description here"/></a></p><p>I&#39;m thinking about moving Meeting inside the Group AR, where I can put <code>Group#attend(UserId userId)</code> method. But there is still a problem of ensuring the Group is created inside the Course only.</p><p>I was thinking about hiding (package private&#39;ing/protected&#39;ing) Group constructor and adding <code>Course#createGroup(GroupParams p): Group</code> but I&#39;m not sure if it&#39;s valid to mess two different concepts (Group and Course aggregate roots) in each other.</p><p>Moreover, it doesn&#39;t solve the problem users still can remove  Group via its repository (a Spring&#39;s <code>Repository#delete(Group)</code> in my case). I possibly can solve this by:</p><ul><li>having domain event sourcing i.e. Group repository will emit <code>GroupRemovedEvent</code> so the Course can subscribe to it and modify its <code>List&lt;GroupId&gt; groupIds</code>.</li><li>having a reverse reference from Group to Course, but it may become inconvenient because use case <code>get all groups of the course by CourseId given</code> is a day-to-day operation.</li></ul><p>I would appreciate any ideas on this matter. Thank you.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>As far as I know there are two things your should consider by choosing aggregates.</p><ol><li><strong>Invariants</strong>: For example you have 2 properties x and y and the sum of them must be always 6. Obviously you cannot change them independently, because you would end up in invalid states. After identifying your invariants you will know you consistency boundaries better.</li><li><strong>How much data you want to load into memory</strong>: For example if your aggregate contains a massive list of entities, you need to load all of them you want to modify it, because otherwise it is hard to ensure that all of the invariants are fulfilled. In theory you can lazy load your related entities, so if there is no invariant trying to use them, then they won&#39;t be loaded, but still it might be better to add another aggregate for those entities and refer to them only with ids in your first aggregate.</li></ol></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-domain-driven-design-external-dependencies-in-the-entity-problem/'>C# &#8211; Domain-Driven-Design &#8211; external dependencies in the Entity problem</a></li><li class="list-group-item"><a href='../ensuring-transactional-consistency-with-ddd/'>Ensuring transactional consistency with DDD</a></li><li class="list-group-item"><a href='../confusion-about-the-meaning-of-the-word-aggregate-in-domain-driven-design/'>Confusion about the meaning of the word aggregate in domain driven design</a></li><li class="list-group-item"><a href='../java-updating-nested-objects-in-ddd-aggregate-by-example-delegation-or-direct-access-from-the-root/'>Java &#8211; Updating nested objects in DDD Aggregate by example: delegation or direct access from the root</a></li><li class="list-group-item"><a href='../event-sourcing-and-cross-aggregate-validation/'>Event Sourcing and cross Aggregate validation</a></li><li class="list-group-item"><a href='../ddd-how-to-avoid-overlapping-aggregate-boundaries/'>DDD &#8211; How to avoid overlapping aggregate boundaries</a></li><li class="list-group-item"><a href='../ddd-how-to-model-validation-and-enforce-invariants-that-possibly-resides-in-different-aggregates/'>DDD &#8211; how to model validation and enforce invariants that possibly resides in different aggregates</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>