<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; What kind of interface should a double container offer &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086326 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086326" class="post-1086326 software type-software status-publish hentry category-software tag-c tag-coding-standards tag-stl"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; What kind of interface should a double container offer</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">coding-standards</span><span class="mr-2 badge badge-warning">stl</span></p><div class="entry-content"><p>I want to write a class which offers two sequences of elements to its users. The first one (lets call it &#34;primary&#34;) is the main of the class and will be use 80% of the time. The second one (lets call it &#34;secondary&#34;) is less important, but still need to be in the same class. The question is: what interface should the class offer to its users?</p><p>By looking at STL style, a class with a single sequence of elements should offer begin() and end() functions for traversal and function like insert() and erase() for modifications.</p><p>But how should my class offer the second sequence?</p><p>For now, I have two ideas:</p><ul><li>Expose the two containers to the user (what about the <a href="http://en.wikipedia.org/wiki/Law_of_Demeter" rel="nofollow">Law of Demeter</a> ?)</li><li>Provide the main container with STL interface and expose only the second one.</li></ul><p>Here is an example.</p><pre><code>#include &lt;vector&gt;

class A { 
    public:
        std::vector&lt;int&gt;&amp;  primary();
        std::vector&lt;char&gt;&amp; secondary();

    private:
        std::vector&lt;int&gt;  m_primary;
        std::vector&lt;char&gt; m_secondary;
};

class B { 
    public:
        std::vector&lt;int&gt;::iterator begin();
        std::vector&lt;int&gt;::iterator end();
        std::vector&lt;char&gt;&amp; secondary();

    private:
        std::vector&lt;int&gt;  m_primary;
        std::vector&lt;char&gt; m_secondary;
};

// Classes implementation
// ...

int main() {

    // --------------------------------------------------
    // Case 1
    // --------------------------------------------------

    A a;

    for(auto it = a.primary().begin(); it != a.primary().end(); ++it) {
        // ...
    }   
    for(auto it = a.secondary().begin(); it != a.secondary().end(); ++it) {
        // ...
    }   

    // --------------------------------------------------
    // Case 2
    // --------------------------------------------------

    B b;

    for(auto it = b.begin(); it != b.end(); ++it) {
        // ...
    }   
    for(auto it = b.secondary().begin(); it != b.secondary().end(); ++it) {
        // ...
    }   
}
</code></pre><p>What is the more C++ish way to do that? Is one best than the other or is there an other solution?</p><h2>Context</h2><p>This problem came in the context of an exercise in which I am writing a simple database access framework. Here are the classes involved in the question:</p><ul><li>table</li><li>column</li><li>row</li><li>field</li></ul><p>The table class consists of a sequence of columns and an other sequence of rows. The main use of the table is manipulating (access, add and remove) the rows.</p><p>Deeper in the hierarchy, a row is made of column and field so a user can ask the value (field) corresponding to a given column or column name. Each time a column is add/modify/remove from the table, every rows will need to be modify to reflect the modification.</p><p>I want the interface to be simple, extensible and combining well with existing code (like STL or Boost).</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>Don&#39;t expose your guts, guide visitors</strong> :</p><pre><code>class A { 
    public:

        // we assume you want read-only versions, if not you can add non-const versions
        template&lt; class Func &gt;
        void for_each_primary( Func f ) const { for_each_value( f, m_primary ); }

        template&lt; class Func &gt;
        void for_each_secodary( Func f ) const { for_each_value( f, m_secondary ); }

    private:
        std::vector&lt;int&gt;  m_primary;
        std::vector&lt;char&gt; m_secondary;

        template&lt; class Func, class Container &gt;
        void for_each_value( Func f, const Container&amp; c )
        {
             for( auto i : c )
                 f( i );
        }
};



int main()
{
    A a;
    a.for_each_primary( [&amp;]( int value ) 
         { std::cout &lt;&lt; &#34;Primary Value : &#34; &lt;&lt; value ; } );
    a.for_each_secondary( [&amp;]( int value ) 
         { std::cout &lt;&lt; &#34;Secondary Value : &#34; &lt;&lt; value ; } )
}
</code></pre><p>Note that you could use std::function instead of template parameter if you want to put the implementation in a cpp file, making implementation changes less expensive on compilation times in big projects.</p><p>Also, I didn&#39;t try to compile it now, but I used a lot this pattern in my open-source projects.</p><hr/><p>This solution is a C++11 enhancement of B I guess.</p><p>HOWEVER</p><p>This solution have several issues :</p><ol><li>It requires C++11 to be effective, because it&#39;s efficient for the user of you class ONLY if he can use lambda.</li><li><strong>It relies on the fact that the class implementer really know what algorithms precisely are to be available to users.</strong> If the user need to do complex manipulations to the numbers, jumping from index to index in an unpredictable way for example, then exposing iterators, a copy of the values OR the values would be better.</li></ol><p>In fact, this kind of choice totally depends on what you intend the user to do with this class.</p><p>By default I prefer the solution I gave you because it&#39;s the most &#34;isolated&#34; one, making sure the class know how it&#39;s values can be manipulated by external code. It&#39;s a bit like &#34;extensions points&#34;.
If it&#39;s a map, providing a find function to your class is easy. So <strong>I think that&#39;s the more sane way to expose data</strong> and it&#39;s also made available by lambdas.</p><p>As said, if you need to make sure the user can manipulate the data as he wish, then providing a copy of the container is the next &#34;isolated&#34; option (maybe with a way to reset the container with the copy after that). If a copy would be expensive, then iterators would be better. If not enough then a reference is acceptable but it&#39;s certainly a bad idea.</p><hr/><p>Now assuming you&#39;re using C++11 and don&#39;t want to provide algorithms, the most idiomatic way is using iterators this way (only the user code changes) :</p><pre><code>class B { 
    private:
        std::vector&lt;int&gt;  m_primary;
        std::vector&lt;char&gt; m_secondary;
    public:

        // your code is read-write enabled... make sure it&#39;s not const_iterator you want
        // also I&#39;m using decltypt to allow changing container type without having to manually change functions signatures
        decltype(m_primary)::iterator primary_begin() const;
        decltype(m_primary)::iterator primary_end() const;

        decltype(m_secondary)::iterator secondary_begin() const;
        decltype(m_secondary)::iterator secondary_end() const; 


};

int main()
{
    B b;


    std::for_each( b.primary_begin(), b.primary_end(), []( int&amp; value ) {
        // ...
    });   
    std::for_each( b.secondary_begin(), b.secondary_end(), []( double&amp; value ) {
        // ...
    });   

}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-the-best-way-to-store-a-table-in-c/'>C++ &#8211;  the best way to store a table in C++</a></li><li class="list-group-item"><a href='../c-what-kind-of-base-for-decorator-interface-abstract-class-non-abstract/'>C++ &#8211; What kind of base for Decorator: interface, abstract class, non-abstract</a></li><li class="list-group-item"><a href='../c-how-to-store-various-sized-values-in-a-vector/'>C++ &#8211; How to store various sized values in a vector</a></li><li class="list-group-item"><a href='../c-should-the-getters-and-setters-of-a-stl-container-access-the-container-itself-or-the-elements-inside-it/'>C++ &#8211; Should the getters and setters of a stl container access the container itself or the elements inside it</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>