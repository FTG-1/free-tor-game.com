<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Database &#8211; Strategy for version controlling database changes during development &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084428 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084428" class="post-1084428 software type-software status-publish hentry category-software tag-database tag-design-patterns tag-version-control"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Database &#8211; Strategy for version controlling database changes during development</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">version control</span></p><div class="entry-content"><p>I am redesigning a CRM tool, of sorts, from the ground up. We are creating the application and the database from scratch. In order for developers to stay out of each others&#39; way, each developer has a local copy of the application&#39;s database rather than sharing a single dev database. This avoids the case of developer 1 making a database change that works for them but breaks the application for everyone else until developer 1 checks in their code changes.</p><p>At the suggestion of an answer to a similar such question I saw when we were getting started, we are keeping in source control a folder of sequentially numbered SQL scripts. As a developer makes changes to their database, they script out all of their changes into a SQL file and check it in together with the accompanying application code changes. In theory, that sounds good, but here are some difficulties with it:</p><ol><li>If 5.sql is the latest checked in database change script, any (usually all) developers making new database changes create a file named 6.sql because it&#39;s a first-come-first-serve type situation. But there can only be one 6.sql checked in. So you either have to check which files everyone is planning to check in before creating your next SQL file or just before you check in, check what is already there and rename your file to the next one (which is still technically subject to a conflict if two developers are checking in at the same time).</li><li>When you get latest you have to go run the latest SQL files to bring your database up to date with the latest code you retrieved. This is easy to forget until you run the application and have something blow up. But the bigger problem is it&#39;s hard to remember which file you ran last &#8211; i.e. which version your database is already on.</li><li>No merging or conflict detection. If 2 developers are checking in update scripts at the same time, developer 2&#39;s scripts could have conflicting changes with developer 1s new changes. E.G. Say developer 2 writes a script to change the Person.ModifiedDate column to NOT NULL, but just before developer 2 checks in, developer 1 checks in a script that changes the name of Person.ModifiedDate to Person.LastModifiedDate. Developer 2 will either just rename their file so the filename doesn&#39;t conflict and unwittingly check in what is now a broken script, or will have to follow a protocol that they cannot check in a sql script until applying all of the latest and validating their script. This is a painful process, especially if developer 2 went and applied developer 1&#39;s changes, updated their script(s) and then tried to check in only to find developer 3 has now checked in a script.</li></ol><p>So I&#39;m thinking of writing a console app that runs before build to grab the script files and run them against the database in order. It would just need to store the last file it ran somewhere so it knows whether there are new scripts to run the next time. That seems like it will fix #2, but does anyone use a better strategy that addresses all the issues? So far we have avoided conflicts by working on unrelated pieces of the application but as we move forward that will become harder and harder to do and the current strategy requires too much developer discipline &#8211; know it will end up causing problems.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>These are called database migrations. You&#39;re on the right track. Let me address your issues.</p><blockquote><ol><li>or just before you check in, check what is already there and rename your file to the next one (which is still technically subject to a conflict if two developers are checking in at the same time)</li></ol></blockquote><p>The first person to push to your integration branch wins, and all others must rename. It shouldn&#39;t be a big deal, and you should make sure it&#39;s as simple as renaming a file--you shouldn&#39;t have to reconfigure other things too. I don&#39;t think you should try to avoid this because the alternative is trying to predict which developer is going to finish first which will inevitably cause bottlenecks.</p><blockquote><ol start="2"><li>When you get latest you have to go run the latest SQL files to bring your database up to date with the latest code you retrieved. This is easy to forget until you run the application and have something blow up. But the bigger problem is it&#39;s hard to remember which file you ran last - i.e. which version your database is already on.</li></ol></blockquote><p>This is the benefit of having a tool that runs database migrations for you. There are two very popular migration tools out there: <a href="https://flywaydb.org/" rel="noreferrer">Flyway</a> and <a href="http://www.liquibase.org/" rel="noreferrer">Liquibase</a>. These tools keep track of which migrations have been run, and you should configure them to run when the app starts up. The tool will scan your directory for any scripts it hasn&#39;t seen yet and apply them to the database one by one. It&#39;s pretty much what you&#39;re proposing to make yourself, but it&#39;s already written and mature.</p><blockquote><ol start="3"><li>No merging or conflict detection. If 2 developers are checking in update scripts at the same time, developer 2&#39;s scripts could have conflicting changes with developer 1s new changes.</li></ol></blockquote><p>The tool will help you here too. Your integration tests should run migrations on a clean database, and if there are two migrations with the same version number, the tool will throw an error. So the first person to push a version number the tests should pass, and if another person has the same version number the tests will start failing.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-version-track-changes-to-sql-tables/'>How to version/track changes to SQL tables</a></li><li class="list-group-item"><a href='../database-how-to-manage-database-schema-changes-in-open-source-project-releases/'>Database &#8211; How to manage database schema changes in open source project releases</a></li><li class="list-group-item"><a href='../database-handling-database-schema-changes-when-pushing-new-versions/'>Database &#8211; Handling database schema changes when pushing new versions</a></li><li class="list-group-item"><a href='../database-modeling-software-development-and-version-control/'>Database modeling, software development, and version control</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>