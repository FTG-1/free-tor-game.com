<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Type inference with duck typing &#8211; does this work? Why is it not used &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084400 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084400" class="post-1084400 software type-software status-publish hentry category-software tag-duck-typing tag-programming-languages tag-type-systems"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Type inference with duck typing &#8211; does this work? Why is it not used</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">duck-typing</span><span class="mr-2 badge badge-info">programming-languages</span><span class="mr-2 badge badge-warning">type-systems</span></p><div class="entry-content"><p>Suppose we have a functional language where objects don&#39;t have explicitly defined types, but where named properties can nonetheless be accessed on objects. Is it then possible for the compiler to trace throughout the program which properties could be accessed on which variables and do full type inference on the program so that if the program compiles, it&#39;s guaranteed that all accessed properties must exist? For example, each property name could correspond to a Haskell typeclass and the compiler could check the soundness using Hindley-Milner.</p><p>Note that like with most compilers, the compiler would be checking types on <em>variables</em>, not <em>objects</em>. Therefore it would reject some programs all of whose property accesses are valid. Accepting a program <em>if and only if</em> all its accesses are valid is obviously uncomputable, and that is not what I am suggesting the compiler do.</p><p>Does this method of type checking work? Would it be practical? If so, why is it not used as a compromise between dynamically and statically typed languages?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Suppose we have a functional language where objects don&#39;t have explicitly defined types, but where named properties can nonetheless be accessed on objects. Is it then possible for the compiler to trace throughout the program which properties could be accessed on which variables and do full type inference on the program so that if the program compiles, it&#39;s guaranteed that all accessed properties must exist? For example, each property name could correspond to a Haskell typeclass and the compiler could check the soundness using Hindley-Milner.</p></blockquote><p>Yeah, we can do something a lot like that! But I doubt that it would be practical.</p><p>Let&#39;s take a look at what this might look like. Consider the following ordinary Python function (taken from <a href="https://github.com/fchollet/keras/blob/master/tests/keras/test_sequential_model.py" rel="nofollow noreferrer">https://github.com/fchollet/keras/blob/master/tests/keras/test_sequential_model.py</a>):</p><pre><code>def test_sequential_pop():
    model = Sequential()
    model.add(Dense(num_hidden, input_dim=input_dim))
    model.add(Dense(num_class))
    model.compile(loss=&#39;mse&#39;, optimizer=&#39;sgd&#39;)
    x = np.random.random((batch_size, input_dim))
    y = np.random.random((batch_size, num_class))
    model.fit(x, y, epochs=1)
    model.pop()
    assert len(model.layers) == 1
    assert model.output_shape == (None, num_hidden)
    model.compile(loss=&#39;mse&#39;, optimizer=&#39;sgd&#39;)
    y = np.random.random((batch_size, num_hidden))
    model.fit(x, y, epochs=1)
</code></pre><p>Suppose we want to do duck typing, and we want type inference as well. Python doesn&#39;t have type inference, of course, but Haskell does, and we can convince Haskell to do something a lot like duck typing.</p><p>Duck typing means that we don&#39;t really care about the actual types of all the things we&#39;re using; all we care about is that the things can be used together, in the way we&#39;re using them. In order to make Haskell happy with that, we&#39;ll use implicit parameters in order to create objects and access their properties. Just like we want, the compiler will trace what properties are being accessed on which variables, and so forth.</p><p>Our Haskell code might look like this:</p><pre><code>testSequentialPop = do
    model &lt;- ?newSequential
    ?newDense numHidden (Just inputDim) &gt;&gt;= ?addLayer model
    ?newDense numClass Nothing &gt;&gt;= ?addLayer model
    ?compileModel model &#34;mse&#34; &#34;sgd&#34;
    x &lt;- ?getRandom [batchSize, inputDim]
    y &lt;- ?getRandom [batchSize, numClass]
    ?fitModel model x y 1
    ?popModel model
    ?assert (?length (?layers model) == 1)
    ?assert (?outputShape model == [Nothing, Just numHidden])
    ?compileModel model &#34;mse&#34; &#34;sgd&#34;
    y2 &lt;- ?getRandom [batchSize, numHidden]
    ?fitModel model x y 1
</code></pre><p>So far, so good. This code will compile just fine. If we write the rest of the program, it will run just fine, too.</p><p>So what&#39;s the problem? Let&#39;s ask GHC what the type of <code>testSequentialPop</code> is. GHC says:</p><pre><code>testSequentialPop
  :: (Eq a5, Eq a7, Monad m, Num a2, Num a3, Num a5, Num a7, Num t2,
      Num a9, ?addLayer::t -&gt; a1 -&gt; m a, ?assert::Bool -&gt; m a6,
      ?compileModel::t -&gt; [Char] -&gt; [Char] -&gt; m a8,
      ?fitModel::t -&gt; t1 -&gt; t1 -&gt; a9 -&gt; m b, ?getRandom::[t2] -&gt; m t1,
      ?layers::t -&gt; t3, ?length::t3 -&gt; a5,
      ?newDense::a2 -&gt; Maybe a3 -&gt; m a1, ?newSequential::m t,
      ?outputShape::t -&gt; [Maybe a7], ?popModel::t -&gt; m a4) =&gt;
     m b
</code></pre><p>Ooh, that&#39;s pretty complicated.</p><p>The problem here is that the function has to mention <em>every operation it ever performs</em> on the input objects. If you had a large program that does complicated things with input objects, you could end up with a type which contains hundreds, maybe thousands of constraints.</p><p>Type inference will help things a <em>little</em> bit, but not that much. Type inference sometimes saves programmers from having to calculate types themselves, or from having to type them out in full. Programmers will still have to understand types in order to figure out how functions can be used, and to diagnose what&#39;s causing type errors.</p><hr/><p>That said, there are tools which do something similar to this. For example, Checkmarx makes a static code analysis tool which can detect certain security vulnerabilities, such as SQL injection attacks, by tracing how objects are created and used. A SQL injection attack is essentially a duck typing error: you&#39;re creating an object (a string containing user input), and then performing an operation (using it as a SQL query) on it, even though that object does not support that operation. Checkmarx traces the entire path of this object, from creation to use, and, if it finds any problems, it shows you the entire path.</p><p>I don&#39;t know if it would be feasible to extend this idea so that it works on <em>all</em> operations, rather than just operations that are a security hazard.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-why-does-java-not-do-type-inference/'>Java &#8211; Why does Java not do type inference</a></li><li class="list-group-item"><a href='../when-writing-an-interpreter-how-should-the-type-inference-algorithm-change-the-parsed-ast-should-it/'>When writing an interpreter, how should the type inference algorithm change the parsed AST? Should it</a></li><li class="list-group-item"><a href='../why-is-type-inference-useful/'>Why is type inference useful</a></li><li class="list-group-item"><a href='../python-does-this-code-follow-duck-typing/'>Python &#8211; Does this code follow duck typing</a></li><li class="list-group-item"><a href='../lambda-return-type-inference/'>Lambda Return Type Inference</a></li><li class="list-group-item"><a href='../could-hindley-milner-inference-work-for-the-go-language/'>Could Hindley-Milner inference work for the Go language</a></li><li class="list-group-item"><a href='../a-type-system/'>A type system</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>