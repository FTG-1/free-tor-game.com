<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Pull important messages from DLQ queue and save them in a relational database, to be analyzed and sent back later. Is it a good idea &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080276 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080276" class="post-1080276 software type-software status-publish hentry category-software tag-message-queue tag-queue tag-rabbitmq"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Pull important messages from DLQ queue and save them in a relational database, to be analyzed and sent back later. Is it a good idea</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">message-queue</span><span class="mr-2 badge badge-info">queue</span><span class="mr-2 badge badge-warning">rabbitmq</span></p><div class="entry-content"><p>My project has a integration with a external system. We need to send some <strong>important</strong> informations to this system. For this, we create a micro service to connect to this external system. This micro service receive async messages from our internal systems in a dedicated Queue for that, and the micro service read the messages and try to send them to the external system. Very simple.</p><p>Before explain my doubt, I will put you guys on the context.</p><h1>Context</h1><p>We are <strong>not sure if this external system is reliable</strong>. Sometimes the external system will be off and we need some way to recover from this. So we implement a <strong>retry mechanism</strong>. But we also imagine that this external system could be off for a lot of time and maybe even reject some valid messages until we talk with the support team. So, we also create a durable <strong>Dead Letter Queue</strong> to receive this rejected messages.</p><p>In the worst scenario, it will be a lot of messages on the DLQ queue to analyze the cause of why they are rejected. So my team have the idea to pull the messages from the DLQ queue and persist them as a Json in a database, because we <strong>imagine</strong> that will be necessary to edit them.</p><h1>The question</h1><p>And my question is about this last paragraph: save messages on database. I&#39;m not sure if is a good idea, seems to me that we are just replicating the durable feature from the Queue on a database.</p><p>The idea came from the fact that the messages on the database will be easier to analyze (<strong>maybe</strong> we will need to do that), edit them (<strong>maybe</strong> we will need, <strong>probably not</strong>) and have a more reliable way to manipulate the messages, because one mistake on the RabbitMQ Management and the message is gone. We will also will need some kind of cron job just to read this messages from the database and send them again for the main Queue.</p><p>As you see, there are a lot of <em>maybe</em> and a lot of extra work (database, tables, cron job, etc), and I&#39;m not really comfortable with the solution. Of course we will be more safe if the messages could be analyzed and edited on a relational database, but I&#39;m not sure if we will use this feature on the future.</p><p>I made some research about the use of RabbitMQ for rejected messages that could be analyzed for the team and sent back again to the main Queue, but this is a not a common scenario.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The proper term for the issue you are addressing is &#39;poison message processing&#39;.  Dead letter queues are typically used by messaging systems for undeliverable messages.  A poison message is one that a client application cannot successfully process.  A &#39;poison message queue&#39; is a queue that is configured to receive these messages in order to prevent a message from being read and rolled-back indefinitely.  This is good practice in order to prevent one bad request from causing messages to back up and exceeding queue depth which will start to cause upstream failures.</p><p>In the specific case that you are concerned with where a downstream application is offline, one easy solution is to stop processing messages on the queue.  There are a couple of issues with this.  The main one is that if you have a high volume of messages coming in, you could fill the queue.  Another potential issue is that if that queue is not persistent, having a lot of messages sitting in it puts you at risk for data loss.</p><p>My experience with messaging solutions leads me to this general recommendation: do not rely on queues for preventing data loss.  No matter what the vendor claims about &#39;guaranteed delivery&#39; there are so many pitfalls and challenges in making such a system leak-proof.  If you need to make sure something arrives, you need to have persistent store where you keep enough information to be able to regenerate a message in the case of loss.  Often this is in a database.  This is similar to what you had proposed but instead of pushing messages to a DB when they are being read off of the queue, you persist to a DB at the point of origination.  In addition, I would recommend a ledger-type approach of recording (at least) the final state of each record in that store.  If you need to purge data, you can do so in bulk later on.</p><p>It might seem that if you do this, queues are irrelevant but this is not the case.  Queues are a great way to move and process messages in a distributed system and avoid contention.  By using a DB ledger with queues, you get the best of both worlds.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-deal-with-failing-messages-in-ddd/'>How to deal with failing messages in DDD</a></li><li class="list-group-item"><a href='../fair-distributed-task-scheduling-with-rabbitmq/'>Fair distributed task scheduling with RabbitMQ</a></li><li class="list-group-item"><a href='../design-message-queues-and-multiple-subscribers/'>Design &#8211; Message Queues and Multiple Subscribers</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>