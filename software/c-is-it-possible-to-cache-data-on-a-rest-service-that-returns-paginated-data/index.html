<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Is it possible to cache data on a REST service that returns paginated data &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074248 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074248" class="post-1074248 software type-software status-publish hentry category-software tag-asp-net tag-c tag-dapper tag-pagination tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Is it possible to cache data on a REST service that returns paginated data</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">dapper</span><span class="mr-2 badge badge-primary">pagination</span><span class="mr-2 badge badge-danger">rest</span></p><div class="entry-content"><p>Under the REST architecture principles, a RESTful application should be stateless, therefore each time I invoke an ASP.NET 4  REST service (with GET verb) that pulls tens of thousands of records, the REST service paginates them with in chunks of 10 (with OData v4), which makes the UI lightweight because it only loads 10 records each time, however each time the user calls for the next chunk of 10 records the ASP.NET controller calls the read method on the data access layer (Dapper micro ORM) which in turns pulls the same thousands of records over and over again, even though the controller only returns 10 records each time thanks to OData pagination engine, the data access layer (Dapper) queries for the same thousands of records each time, which is expensive and slow. I know I could modify the query that Dapper uses so the pagination filter goes down to the query level, but I find that&#39;s too much burden to do since the filter OData sends can be quite complex and I don&#39;t have the luxury to generate a semantic tree for generating filters on the WHERE clause, and besides, isn&#39;t that OData work in the first place? Isn&#39;t it possible to simply cache the thousands of records somewhere to avoid calling the database each time if I the same filer is being request over and over again?</p><p>Oh yes, and Entity Framework is an absolute no go, Dapper is mandatory instead.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Isn&#39;t it possible to simply cache the thousands of records somewhere to avoid calling the database each time</p></blockquote><p>Yes, but it is the exact opposite of being <strong>stateless</strong>, which REST is. You&#39;re trying to go against the main ideology of RESTful services.</p><p>Can it be done? On a technical level, if you really want, sure. But this is a case of the <a href="https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem">XY problem</a>. Your proposed solution (Y - caching the data) is a workaround for the actual problem (X - paginating the query to lower the amount of data returned).</p><p>Storing the full dataset only solves half of the problem. If the user only looks at two pages on average, that still means that you retrieved 20 <em>useful</em> rows, and 9980 <em>useless</em> rows (assuming 10,000 rows total). That&#39;s means that <strong>99.8%</strong> of the retrieved data is never used. That&#39;s still a big waste of space.</p><p>Furthermore, you&#39;d have to cache a separate dataset for every unique combination of filters. Which means that you&#39;re likely going to have a ton of duplicate data in memory, because a given record may appear in several differently filtered datasets.<br/> Assuming you have a significant amount of concurrent users and are caching all their requests, I&#39;m starting to think that it&#39;d be more efficient for you to simply store the entire table in-memory once, just to get rid of the duplicates (<strong>I&#39;m not saying that you should do this</strong>, I&#39;m just pointing out that caching everything is going to cause more problems than it&#39;s likely to solve).</p><p>There are many reasons why you shouldn&#39;t be trying to cache the unpaginated data as a solution to a pagination problem.</p><blockquote><p>I know I could modify the query that Dapper uses so the pagination filter goes down to the query level, but I find that&#39;s too much burden to do</p></blockquote><p>Well if you refuse to paginate the dataset, then you obviously can&#39;t expect a paginated dataset. But then you&#39;re excluding the correct solution in favor of an easier unRESTful solution; which is likely to create technical debt for the future.</p><p><a href="https://stackoverflow.com/questions/9848592/dapper-paging">Have a look at this pagination with Dapper example.</a> You&#39;ll have to change the subquery to your own query.</p><pre><code>SELECT  *
FROM    ( SELECT    ROW_NUMBER() OVER ( ORDER BY InsertDate) AS RowNum, *
          FROM      Posts
          WHERE     InsertDate &gt;= &#39;1900-01-01&#39;
        ) AS result
WHERE   RowNum &gt;= 1 // *your pagination parameters
    AND RowNum =&lt; 10  //*
ORDER BY RowNum
</code></pre><p>All you would need to do to implement this for yourself is figure out the row limits (<code>1</code> and <code>10</code> in the example). These can be found by using simple calculations.</p><p><em>Note: I&#39;m assuming that the <code>pageNumber</code> is 1-indexed, because that&#39;s generally how the UI portrays it. <code>pageSize</code> is 10 in your case.</em></p><pre><code>var row_limit_lower = ((pageNumber - 1) * pageSize) + 1;
var row_limit_upper = (pageNumber * pageSize) - 1;
</code></pre><p>Figure out which page number is being requested. Based on that (and a page size, which I infer is always 10 for your application), you can calculate and implement the needed pagination in the query itself, thus preventing the retrieval of many unnecessary rows.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-entity-framework-and-distributed-systems/'>C# &#8211; Entity Framework and distributed Systems</a></li><li class="list-group-item"><a href='../rest-which-pattern-is-suitable-to-send-multiple-type-of-responses-through-rest-web-service/'>Rest &#8211; Which pattern is suitable to send multiple type of responses through REST web service</a></li><li class="list-group-item"><a href='../c-how-to-test-with-multiple-input-combinations/'>C# &#8211; How to test with multiple input combinations</a></li><li class="list-group-item"><a href='../java-how-to-paginate-local-and-remote-data/'>Java &#8211; How to paginate local and remote data</a></li><li class="list-group-item"><a href='../c-correct-usage-of-http-verbs-in-custom-rest-implementation/'>C# &#8211; Correct usage of HTTP VERBS in custom REST implementation</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>