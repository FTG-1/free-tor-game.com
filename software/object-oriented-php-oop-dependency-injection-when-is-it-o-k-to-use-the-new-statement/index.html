<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Object-oriented &#8211; PHP OOP dependency injection &#8211; when is it o.k. to use the &#8220;new&#8221; statement &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085834 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085834" class="post-1085834 software type-software status-publish hentry category-software tag-dependency-injection tag-object-oriented tag-php"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Object-oriented &#8211; PHP OOP dependency injection &#8211; when is it o.k. to use the &#8220;new&#8221; statement</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">dependency-injection</span><span class="mr-2 badge badge-info">object-oriented</span><span class="mr-2 badge badge-warning">PHP</span></p><div class="entry-content"><p>I was told to avoid &#34;new&#34; statements in classes or functions but rather create the objects from classes in the root of the program (maybe with the use of a DI-container) and then inject the objects into the classes.</p><p>Anyway, I think there are many (the majority of) cases where this &#34;rule&#34; can not be true. Let&#39;s see this example:</p><pre><code>&lt;?php
$mailerobject = new PHPMailer();

class send_orderconfirmation {

    public function __construct(Mailer $mailer) {
        $this-&gt;mailer = $mailer;
    }

    public function send_orderconfirmation() {
        $email = &#34;someaddress@somedomain.com&#34;;
        $prename = &#34;Enrique&#34;;
        $name = &#34;Iglesias&#34;;
        $subject = &#34;Your blue pills order&#34;;

        $this-&gt;mailer-&gt;addAddress(&#34;$email&#34;, &#34;$prename $name&#34;);
        $this-&gt;mailer-&gt;Subject = $subject;
    }
}

?&gt;
</code></pre><ul><li>First thing is, when do I create a send_orderconfirmation object? It makes no sense to create this in the root of the program, who knows if it is needed? It&#39;s rather logical that it should be created by a class that processed a new order and now wants to send a confirmation, doesn&#39;t it? But then the new-statement would have to be in this class.</li><li>Second, even more crucial: In the above example, as soon as I use some setters of the mailer object to fill it with data about the e-mail to send (subject, address, recipient name) the object is &#34;polluted&#34; with this data. So the next function that needs the mailerobject would have to clean the object first to make use of it. Also it is not possible to have two mailerobjects at the same time, e.g. if I want to fill two mailer objects concurrently with data.</li></ul><p>What am I missing? Are there legitimate reasons to create objects in classes or do they always have to be injected?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Of course you need to create objects <em>somewhere</em>. In theory, applications are divided into two parts:</p><ul><li>the business logic part - the fun parts, creating rules for behaviour by using classes together,</li><li>the factories - the necessary evil, a magical place where classes are <code>new</code>ed to create objects and wired together.</li></ul><p>Now, the business logic part is where the decoupling matters and <a href="https://en.wikipedia.org/wiki/Coupling_(computer_programming)" rel="noreferrer">loose coupling</a> is an advantage. <strong>But why exactly?</strong></p><p>For one (simple) reason: To be able to switch out dependencies (modules) if a new one having the same API proves to be better (faster, costs less resources, etc.).</p><p>Take a look at a database. You may use some <a href="https://en.wikipedia.org/wiki/Object-relational_mapping" rel="noreferrer">ORM</a> layer, for which you create <a href="https://en.wikipedia.org/wiki/Adapter_pattern" rel="noreferrer">adapters</a>, so your business layer is not entirely dependent on the ORM directly but your abstraction.</p><p>You could obviously <code>new</code> the ORM layer directly in your code, whenever you wanted to use it, but what would happen if one day you decided there&#39;s a better alternative? You would have no choice than to find all the classes where the ORM layer objects are created and replace them and you would probably need to edit the classes as well, because the different ORM might have a slightly different API (the <code>public</code> (static) methods through which the ORM operates). That&#39;s a lot of work.</p><p>If you decided to inject dependencies instead, and even better if you already use an adapter, you are quite likely to <code>new</code> the ORM layer only once or very few times and reuse this <code>new</code>ed object by injecting it into multiple classes, all of them need to access the ORM layer. Not only you don&#39;t have to manually replace the old <code>new</code> with the new one in multiple places, but most likely only in one, but by using adapter you probably will not need to touch the business layer at all.</p><p>The task of using the new ORM which would previously take a few hours could now be done in a few minutes (that is without the time needed for tests), which is amazing.</p><p>The only point of not <code>new</code>ing classes directly in your business layer is to provide decoupling (the <code>new</code> keyword is delegated into the factory part of your application), but <strong>it makes no sense to try to decouple everything</strong>. Trying to do so will only turn your application into a factory hell.</p><p>The rule of thumb when deciding, whether a class should be directly created or rather delegate the creation (or the process of obtaining the instance) to a factory is to realize, whether decoupling will bring you some huge benefit. When you start thinking about a large application as sum of smaller modules (some of these modules may be: cache, database, domain, http), before <code>new</code>ing any class directly, you should think, whether there&#39;s a possibility that a new version might come one day which will be better and which you would like to (potentially) use. If the answer is yes, inject the dependency and don&#39;t create it manually.</p><p>Other very important thing is, if all your application depends on dependency injection and programmers rely on it, a dependency should be injected when a class communicates with the outer world (database, web services). A developer using said class directly knows the class may communicate and alter outside data just by looking at its dependencies, which is amazing, because the class has an API which does not like about what it needs (by creating the needed objects directly), because it is asking for the dependencies from the outside.</p><p>If the dependency is external (pulled through a package manager such as Composer for PHP, NuGet for C# or Maven for Java), you should go through the hassle of hiding the real dependency behind your own abstraction and make your application depend on the abstraction, the interface you designed and are very well aware of how it works and what you can expect from it (the Adapter pattern once again).</p><p>On the other hand imagine a scenario of having a repository, which is supposed to provide a middle layer between the data access layer and your domain (business layer), transfering domain entities to pure data and vice versa. Domain is a pretty strict layer with (usually) well defined rules, where a class is an end product and is likely to be replaced only if business rules change. In a case like that there&#39;s usually only one way of constructing such entity and it is in most cases ok not to write a factory but <code>new</code> the objects directly.</p><p>If we look at your specific example, you&#39;re actually on the right track, where you inject a <code>Mailer</code> object. There&#39;s a great possibility a new <code>Mailer</code> will once come and will be better than the current one (but will have methods with the same names and taking the same arguments). As said before, you will now have to simply <code>new</code> a different class and inject that one instead.</p><p>You are then calling the <code>addAddress</code> method with 2 arguments, the address and name of the sender, but even if the <code>addAddress</code> took a data object like <code>UserEmail</code>, it would still be ok to <code>new</code> the <code>UserEmail</code> class directly in the <code>send_orderconfirmation</code>, because the <code>UserEmail</code> would very likely to be a simple messenger, groupping related data together so a method requires fewer arguments.</p><p>Injecting everything really is a non-sense and there are in fact cases when it&#39;s not only allowed but actually better to create an object directly in place. If someone is against that, you should ask them why and if they cannot provide a meaningul explanation, they&#39;re probably overengineering the application by throwing design patterns here and there just because they look cool.</p><p>Sadly, in programming there are too many edge cases which are impossible to describe in a book any shorter than a few thousand pages, and even then you would probably not cover them all. On top of that, thing you are actually trying to figure out is an architectural problem and solution to these rarely come from reading a few online tutorials (which is something you can do when you want to learn a new language) but rather from aged experience.</p><p>Not only for this specific case but for software development in general, you will most likely need to gain experience and realize what does and what does not work (either for you or your environment). Perhaps someone has already created a workaround how to skip the few years of programming and designing application to learn it, I myself have started programming little over 15 years ago and had to learn it the hard way, by gaining experience.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../dependency-injection-dependency-chain-pattern/'>Dependency Injection &#8211; Dependency Chain Pattern</a></li><li class="list-group-item"><a href='../php-dependency-injection-at-what-point-am-i-allowed-to-create-a-new-object/'>Php &#8211; Dependency injection: At what point am I allowed to create a new object</a></li><li class="list-group-item"><a href='../object-oriented-initialization-of-objects-in-a-system-using-dependency-injection/'>Object-oriented &#8211; Initialization of objects in a system using dependency injection</a></li><li class="list-group-item"><a href='../python-is-circular-dependency-injection-a-good-practice/'>Python &#8211; Is circular Dependency Injection a good practice</a></li><li class="list-group-item"><a href='../java-dependency-injection-should-i-use-a-framework/'>Java &#8211; Dependency injection: should I use a framework</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>