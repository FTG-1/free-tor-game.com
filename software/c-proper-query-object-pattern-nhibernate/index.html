<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Proper Query Object Pattern &#8211; NHibernate &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073299 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073299" class="post-1073299 software type-software status-publish hentry category-software tag-c tag-design-patterns tag-orm"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Proper Query Object Pattern &#8211; NHibernate</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">orm</span></p><div class="entry-content"><p>I was looking to an alternative to Repository Pattern and I&#39;ve read about &#34;Query object pattern&#34; (<a href="http://lostechies.com/jimmybogard/2012/10/08/favor-query-objects-over-repositories/" rel="nofollow">http://lostechies.com/jimmybogard/2012/10/08/favor-query-objects-over-repositories/</a>). However the implementation provided in the link above is not exactly what I was looking for &#8211; I look for something that can be easily injected, easily tested and easily extended/changed (only last point holds in the link-implementation). I thought a bit and I think &#34;I have invented&#34; solution. Suppose I have controller <code>BlogEntriesController</code> (i&#39;m talking about <code>mvc asp</code> application with ORM) and I inject to constructor class:</p><pre><code>public class BlogEntriesQueries
{
    IRetrieveQuery&lt;BlogEntryEntity&gt; PageBlogEntries { get; set; }
    IRetrieveQuery&lt;BlogEntryEntity&gt; ProposedBlogEntries { get; set; }
    IAddQuery&lt;BlogEntryEntity&gt; CreateNewBlogEntry { get; set; }
    ... etc..
}
</code></pre><p>where <code>IRetrieveQuery&lt;T&gt;</code> is smth like:</p><pre><code>public interface IRetrieveQuery&lt;TEntity&gt; where TEntity : EntityBase
     IQueryable&lt;TEntity&gt; CurrentQuery { get; }
     IRetrieveQuery&lt;TEntity&gt; InvokeQuery(IRetrieveQuery&lt;TEntity&gt; subQuery);
     IEnumerable&lt;TEntity&gt; GetQueryResults();
}
</code></pre><p>Then all the work I&#39;d have to do is proper configuration of IoC container to inject queries into controller and proper calls in controller like: <code>_blogQueries.ProposedBlogEntries.GetQueryResults()</code> The question is &#8211; it is good solution &#8211; are there any drawbacks that I don&#39;t see? I think i&#39;d get testability (don&#39;t even have to mock <code>ISession</code> in case of <code>NHibernate</code>) and it&#39;d be easily extensible but I&#39;m not an expert (especially at database applications) by any means.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Query testing can be handled easily without need to mock them. You just need to approach it from slightly different view. Example is <a href="http://ayende.com/blog/154273/limit-your-abstractions-and-how-do-you-handle-testing" rel="nofollow">here</a>.</p><p>Second thing is: Do you really need ability to inject queries? Queries are usually closely tied to business logic they are used to. Are you really going to gain something by complicating your life by abstracting away each query? Every time you create some design, make sure you actually write significant amount of code, which uses this design, so you can evaluate how complex it is to actually use the design.</p><p>Final practical note : Are you sure your queries always work on single entity? Or return said entity? Queries are usually quite complex. You can just use LINQ directly if you don&#39;t need complex queries.</p><p>One more thing I noticed : Are you reusing single query across all calls? Is that really a query? Looks like different form of repository. How are you going to pass parameters for query?</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../required-for-a-scope-in-an-injection-framework/'>Required for a scope in an injection framework</a></li><li class="list-group-item"><a href='../c-patterns-for-handling-changing-property-sets-in-c/'>C++ &#8211; Patterns for Handling Changing Property Sets in C++</a></li><li class="list-group-item"><a href='../c-how-to-make-creating-viewmodels-at-runtime-less-painful/'>C# &#8211; How to make creating viewmodels at runtime less painful</a></li><li class="list-group-item"><a href='../c-implement-generic-dataset-builder-with-c/'>C# &#8211; Implement Generic DataSet Builder with C#</a></li><li class="list-group-item"><a href='../c-confused-on-how-to-properly-employ-a-repository-pattern-with-service-business-layer-on-top/'>C# &#8211; Confused on how to properly employ a Repository Pattern with Service/Business Layer on top</a></li><li class="list-group-item"><a href='../java-pattern-for-validating-rules-having-different-signatures/'>Java &#8211; Pattern for validating rules having different signatures</a></li><li class="list-group-item"><a href='../mvc-encapsulation-for-complex-queries/'>Mvc &#8211; Encapsulation for complex queries</a></li><li class="list-group-item"><a href='../c-how-to-separate-the-viewmodel-from-the-model-yet-associate-them-with-each-other-based-on-the-model/'>C# &#8211; How to separate the ViewModel from the Model, yet associate them with each other based on the Model</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>