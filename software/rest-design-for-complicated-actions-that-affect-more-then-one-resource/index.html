<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>REST design for &#8220;complicated&#8221; actions that affect more then one resource &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085688 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085688" class="post-1085688 software type-software status-publish hentry category-software tag-api tag-design tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">REST design for &#8220;complicated&#8221; actions that affect more then one resource</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">rest</span></p><div class="entry-content"><p>I am trying to design a RESTful (or maybe I should say RESTlike, since I am not designing a fully RESTful API, e.g. not hypertext driven) API as part of a refactoring of an existing <strong>&#34;take-a-number&#34; queuing management system</strong>.</p><p>The basic concepts and workflow are :</p><ul><li><p>A given site (location) can propose several different services, and have several desks. Each desk can provide one or more of the services on the site. (e.g. at a bank, you can have an info desk, desks for common operations such as a deposit, and desks where you can sit to speak to a counselor for more complex things, e.g. open a new account or apply for a mortgage)</p></li><li><p>Whe he enters the building, a <strong>customer prints a ticket by selecting a service on a touch screen</strong>. (e.g. &#34;Open a new account&#34;). From now on the ticket is tracked in the server&#39;s internal state.</p></li><li><p>The ticket <strong>sits in a queue</strong> for a while</p></li><li><p>The <strong>desk operator calls the next customer</strong> by clicking a button. The system determines which is the next ticket suitable for the desk (given that not all desks provide the same services)</p></li><li><p>Once the ticket is called to a desk, there is an event outputed and <strong>a display system shows the ticket number</strong> along with the desk where the customer should go</p></li><li><p>Once the <strong>customer arrives at the desk</strong>, the operator clicks another button so signal the beginning of the actual providing of the service</p></li><li><p>Once the service has been provided and the <strong>customer leaves</strong>, the desk operator clicks yet another button, the ticket is archived and the desk becomes free again. Until the operator calls the next ticket.</p></li></ul><p>There is a central server and 2 types of client apps : the ticket distributor terminal, and the desk GUI client.</p><p>So in terms of REST resources, one of the main resources is the ticket. First, a new ticket is created (POST), and it is attributed a number. That is easy.</p><p>But then I don&#39;t know how to model the transitions to the ticket state that are initiated by the desk client, since they are not just updates of the ticket but trigger business logic that is executed on the server and has side-effects not only on the ticket :</p><ul><li><strong>Call next ticket</strong> (causes a state change on the server, the ticket is taken from the queue, associated with the desk that called it and marked as &#34;being called&#34;)</li><li>Signal the server that the <strong>customer has arrived</strong> at the desk (causes a state change on the server, the ticket is marked as &#34;being served&#34;, still associated with the desk)</li><li>Signal the server that the <strong>customer has leaved</strong> (causes a change on the server, the ticket is separated from the desk, marked as &#34;served&#34;, put into a collection of all the served tickets, and a log entry is written to the DB)</li><li>Signal the server that the customer has not arrived (<strong>no show</strong>) and the ticket is canceled (causes a change on the server, the ticket is separated from the desk, put into a collection of all the canceled tickets, marked as &#34;not served&#34;, and a log entry is written to the DB)</li></ul><p>Etc.</p><p><strong>All those operations should be performed in an atomic way too, and synchronously.</strong></p><p>They map nicely to &#34;actions&#34;, i.e. RPC, and that&#39;s the way it was implemented in the previous versions of the system (namely RMI calls). For example, the desk can &#34;call the next ticket&#34; (an action), and he gets back the next matching ticket.</p><p>How to model them in a RESTful way ?</p><p>Also, is it worth it, or should I simply be a little flexible on the RESTfulness and model them as &#34;actions&#34; or something similar (so basically RPC over HTTP) ?</p><p>Thanks for your thoughts !</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>All operations you are mentioning are changes to the state of the ticket, so why not model them as operations on Ticket resource?</p><ol><li>Customer registration client creates new ticket: <code>POST /tickets</code></li><li>Desk client updates list of tickets, assigning employee to ticket with <code>PATCH</code> request to <code>/tickets/next</code> and JSON body <code>{ &#34;employee_id&#34; : &#34;5&#34; }</code>. Response will be <code>HTTP 301</code> with <code>Location</code> header pointing to specific ticket: <code>/tickets/172</code> This request will also send an async message to following subscribers:<ul><li>display service, which shows the queue status on monitors in the room, to notify that queue has been updated and clients shall retrieve new contents.</li><li>call expiration job, which will update the ticket if customer will not arrive in given time.</li></ul></li><li>If customer arrives at the desk, desk client sends PATCH request to specific ticket <code>/tickets/172</code>, which updates ticket status and sends async message to the mentioned subscribers. In this case, call expiration job will be dismissed for this ticket upon receiving the message.</li><li>Upon serving the ticket, desk client will perform PATCH request to update ticket status.</li><li>If customer does not arrive within given time, call expiration job will perform PATCH request to the URI provided in async message before to update ticket status. During processing of this request async message to display service will remove the ticket from the queue display.</li></ol><p>All these operations are atomic from client&#39;s perspective and details of implementation of atomic operations shall not be exposed. Regarding the logs, they are necessary to maintain API SLA and not as a business function, so they are in fact implementation detail which is not known to the clients and it&#39;s safe not to consider logs as side effects.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-why-is-a-small-fixed-vocabulary-seen-as-an-advantage-to-restful-services/'>Rest &#8211; Why is a small fixed vocabulary seen as an advantage to RESTful services</a></li><li class="list-group-item"><a href='../rest-do-server-side-sessions-violate-rest/'>Rest &#8211; Do server-side sessions violate REST</a></li><li class="list-group-item"><a href='../restful-applications-logic-and-cross-resource-operations/'>RESTful applications logic and cross resource operations</a></li><li class="list-group-item"><a href='../java-how-to-update-user-interface-form-through-database-update/'>Java &#8211; How to update User interface form through database update</a></li><li class="list-group-item"><a href='../rest-should-an-idempotent-service-always-return-the-same/'>Rest &#8211; Should an idempotent service always return the same</a></li><li class="list-group-item"><a href='../rest-how-to-design-a-rest-api-to-handle-non-crud-operations/'>Rest &#8211; How to design a REST API to handle non-CRUD operations</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>