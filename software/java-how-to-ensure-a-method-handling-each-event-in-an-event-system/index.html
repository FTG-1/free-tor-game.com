<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; How to ensure a method handling each event in an event system &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079506 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079506" class="post-1079506 software type-software status-publish hentry category-software tag-design tag-event-programming tag-generics tag-java"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; How to ensure a method handling each event in an event system</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">event-programming</span><span class="mr-2 badge badge-warning">generics</span><span class="mr-2 badge badge-primary">java</span></p><div class="entry-content"><p>I have several types of events, for example:</p><pre><code>abstract class Event {
    static class KeyPress extends Event { ... }
    static class KeyRelease extends Event { ... }
    static class KeyHold extends Event { ... }
    // ...
}
</code></pre><p>And many listeners which respond to some of the above events by registering them in an event handler. It looks like this currently:</p><pre><code>abstract class AbstractListener {
    Set&lt;Class&lt;? extends Event&gt;&gt; eventTypes;
    protected abstract boolean respond(Event event);
}

class DownKeyListener exteneds AbstractListener {
    DownKeyListener () {
        // just prepares to register to receive these events. doesn&#39;t matter how exactly.
        eventTypes.add(KeyPress.class);
        eventTypes.add(KeyHold.class);
        //no KeyRelease e.g.
    }

    boolean respond(Event event) {
        if (event instanceof KeyPress)
            return handleKeyPress(event);
        else if (event instanceof KeyHold)
            return handleKeyHold(event);
        return false;
    }

    private boolean handleKeyPress(KeyPress e) { ... }
    private boolean handleKeyHold(KeyHold e) { ... }
}
</code></pre><p>What I don&#39;t like about this is that there is nothing forcing or checking at least the relation between the registered events and the checks for them and handling in the respond method. This keeps leading to developer bugs. it&#39;s also a lot of code with <code>instanceof</code>s for little benefit (I would say).</p><p>So I though about doing something &#34;smart&#34; like this: create a map between the event types and the handlers so each event that is registered for handling will have a handler:</p><pre><code>abstract class AbstractListener {
    Map&lt;Class&lt;? extends Event&gt;, Function&lt;? extends Event, Boolean&gt; map = new ...
    //             ^ doesn&#39;t ensure these event ^: are the same but at least
    //                                             that someone responds
    // to ensure same event i can do
    protected &lt;T extends Event&gt; void register(Class&lt;T&gt; event, Function&lt;T, Boolean&gt; function) {
        map.put(event, function);
    }

    protected abstract boolean respond(Event event);
}
</code></pre><p>And then:</p><pre><code>class DownKeyListener exteneds AbstractListener {
    DownKeyListener () {
        Map.put(KeyPress.class, keyPressFunction);
        Map.put(KeyHold.class, keyHoldFunction);
    }

    boolean respond(Event event) {
        Function&lt;? extends Event, Boolean&gt; f = map.get(event.getClass());
        return f == null ? false : f.apply(event);
    }

    Function&lt;KeyPress, Boolean&gt; keyPressFunction = event -&gt; ...;
    Function&lt;KeyHold, Boolean&gt; keyHoldFunction = event -&gt; ...;
}
</code></pre><p>Of course this doesn&#39;t work because of generics. <code>apply</code> gives an error and I understand why</p><pre class="lang-none prettyprint-override"><code>The method apply(capture#4-of ? extends Event) in the type Function&lt;capture#4-of ? extends Event,Boolean&gt; is not applicable for the arguments (capture#5-of ? extends Event)
</code></pre><p>I don&#39;t know how to get what I want working correctly. Some things I had in mind:</p><ul><li>Cast the result of <code>map.get</code> to something that will ensure it works properly</li><li>Change the <code>respond</code> method to be generic <code>protected abstract &lt;T extends Event&gt; boolean respond(T event);</code> which give the similar error:</li></ul><pre class="lang-none prettyprint-override"><code>The method apply(capture#3-of ? extends Event) in the type Function&lt;capture#3-of ? extends Event,Boolean&gt; is not applicable for the arguments (T)
</code></pre><p>Anyone has a suggestion on achieving what I want in any way?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You could use a visitor pattern, like so:</p><pre><code>abstract class Event {
    boolean accept(EventVisitor visitor);

    KeyPress extends Event {
        boolean accept(EventVisitor visitor)
        {
            return visitor.process(this);
        }
    }
    KeyRelease extends Event { ... }
    KeyHold extends Event { ... }
    // ...
}

abstract class EventVisitor
{
    boolean process(KeyPress event)
    {
        return false;
    }

    boolean process(KeyRelease event)
    {
        return false;
    }

    // One default process() method for each subclass of Event.

    boolean respond(Event event)
    {
        return event.accept(this);
    }
}
</code></pre><p>and then</p><pre><code>class DownKeyListener extends EventVisitor
{
    void process(KeyPress event)
    {
        return handleKeyPress(event);
    }

    void process(KeyHold event)
    {
        return handleKeyHold(event);
    }
}
</code></pre><p>This solution ensures that</p><ol><li>You avoid all the <code>instanceof</code> needed to dispatch on the event&#39;s type.</li><li>All events that are not explicitly handled by a visitor implementation have a default handling in the abstract class <code>EventVisitor</code>.</li></ol></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-what-is-the-difference-between-callbacks-and-listeners/'>Java &#8211; what is the difference between callbacks and listeners</a></li><li class="list-group-item"><a href='../java-generics-how-to-strike-a-balance-between-expressiveness-and-simplicity/'>Java Generics &#8211; how to strike a balance between expressiveness and simplicity</a></li><li class="list-group-item"><a href='../java-how-to-handle-a-set-of-differing-event-classes-with-differing-handler-interfaces-in-a-single-event-processor/'>Java &#8211; How to handle a set of differing event classes with differing handler interfaces in a single event processor</a></li><li class="list-group-item"><a href='../c-events-in-wcf-service-architecture-server-side/'>C# &#8211; Events in WCF Service Architecture (Server Side)</a></li><li class="list-group-item"><a href='../design-command-handling-fail-feedback-with-cqrs/'>Design &#8211; Command handling fail feedback with CQRS</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>