<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Should I mock ObjectMapper in the unit tests &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075535 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075535" class="post-1075535 software type-software status-publish hentry category-software tag-java tag-mocking tag-testing tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Should I mock ObjectMapper in the unit tests</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">java</span><span class="mr-2 badge badge-info">mocking</span><span class="mr-2 badge badge-warning">testing</span><span class="mr-2 badge badge-primary">unit testing</span></p><div class="entry-content"><p>I have different services in a spring application that have a dependency on Jackson ObjectMapper, the unit tests rely on <code>@InjectMocks</code> to inject all the various dependencies to the class that is under test (including ObjectMapper).</p><p>Is this an acceptable behavior? Is there any accepted best practice about it? Should I continue to mock it and assume that it always returns what I expect, or should I call its real methods and test the output?</p><p>An additional clarification, we actually use ObjectMapper to write objects as strings and store them in String fields that will then be stored in a relational DB. For example,</p><pre class="lang-java prettyprint-override"><code>@Entity
public class EntityThing {
    //...
    
    @Column
    private String json;
</code></pre><p>So, each time we need to store them, we convert the object (made up of many complex fields) to this json string and store it in the db; each time we need to retrieve it, we convert it back to the complex object it was before. Something like:</p><pre class="lang-java prettyprint-override"><code>@Service
public class ThisIsAService {
   private final ObjectMapper mapper;

   public ThisIsAService(final ObjectMapper objectMapper){
       this.mapper = objectMapper;
   }

   public DomainObject fromEntity(EntityThing entity){
       ComplexObject obj = mapper.readValue(json, ComplexObject.class);

       return DomainObject.builder()
                           // ...
                           .oneOfManyFields(obj.getDate())
                           .anotherOfManyFields(obj.getSomethingElse())
                           .build();  
   }

   public EntityThing toEntity(ComplexObject obj){
       return EntityThing.builder()
                          // ...
                          .json(mapper.writeValueAsString(obj)
                          .build();
   }
   }
}
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Never mock things you have no control over. It is fine to mock IO calls because of speed or because of violating independence of tests (this goes for databases as they are shared state). It is fine to use ObjectMapper directly in a service (no matter if it makes the onion boys cry, myself included), but do not mock it, because even if it is a unit test, you want to make sure that the code you do not control, does what you expect it to do.</p><p>Edit: I see that the answer was not clear enough, sorry for that.</p><p>When I talk about unit tests I talk about the black box tests on the core of the application (in the ports and adapters). I do not care how much classes I need to setup for the test of a certain business rule, I will do it. I will however create the fakes for the ports as I know that I have integration tests for them.</p><p>What I mean by integration tests is the test of the adapter. I do not care if it is a test for the password hashing library or a mapping library. Any library lives outside my core domain logic and my domain logic accesses that library through an interface.</p><p>Also, performance of the mocked code is not that fast. With mocked code I ran 16 basicly CRUD tests in 0.8 seconds, which caught me off guard. I thought that the problem with performance came from throwing exceptions in the tests, so I refactored the code to not throw any exceptions. The performance was the same. I then removed the mocking framework and then the tests ran in &lt;0.1 seconds. With all the fakes I can run 70 tests in 0.2 seconds.</p><p>Another reason I do not like mocks is that they assume things that might change. Lets say you have Provider and Consumer classes. In Consumer class tests you mock the Provider responses. All is good, because you have the tests for the provider in place and it behaves as you expect. What happens when you have to change the behavior of the Provider? You might say that you change the tests of the Provider, but that is not true. The tests for the Consumer class are now lies, because the responses you expect from the provider are not true anymore, so you have to change the mocks as well. What happens when you have 5 or 6 Consumers that depend on the Provider? Let&#39;s say 10 tests for each Consumer and Provider. That means that you have to update 70 tests even if the behavior of the Consumers did not change.</p><p>The OP did not hide the library behind an interface. He does not control it. The lib in question is also not slow or so slow that it would need to be mocked for performance, so I don&#39;t think it should be mocked. It could be replaced with a custom mapper later. When testing the OP&#39;s methods I don&#39;t think that the call to the mapper matters, what I care about is that the result of the method is correct.</p><p>Edit 2: Here is a good talk about this topic <a href="https://www.youtube.com/watch?v=EZ05e7EMOLM" rel="nofollow noreferrer">https://www.youtube.com/watch?v=EZ05e7EMOLM</a></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-object-oriented-class-design/'>Java &#8211; Object-Oriented Class Design</a></li><li class="list-group-item"><a href='../unit-testing-how-well-am-i-writing-the-tests/'>Unit-testing &#8211; How well am I writing the tests</a></li><li class="list-group-item"><a href='../unit-testing-how-to-not-test-implementation-when-method-returns-void/'>Unit-testing &#8211; How to not test implementation when method returns void</a></li><li class="list-group-item"><a href='../python-the-best-most-pythonic-way-to-mock-a-private-function/'>Python &#8211;  the best/most Pythonic way to mock a private function</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>