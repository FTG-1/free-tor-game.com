<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; How to create better OO code in a relational database driven application where the database is poorly designed &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074862 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074862" class="post-1074862 software type-software status-publish hentry category-software tag-database tag-design tag-java tag-object-oriented-design tag-web-development"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; How to create better OO code in a relational database driven application where the database is poorly designed</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">java</span><span class="mr-2 badge badge-primary">object-oriented-design</span><span class="mr-2 badge badge-danger">web-development</span></p><div class="entry-content"><p>I am writing a Java web application that consists mainly of a bunch of similar pages in which every page has several tables and a filter that applies to those tables. The data on these tables comes from an SQL database.</p><p>I am using myBatis as ORM, which may not be the best choice in my case, since the database is poorly designed and mybatis is a more database oriented tool.</p><p>I am finding that I am writing a lot of duplicate code because, due to the database&#39;s poor design, I have to write different queries for similar things as those queries can be very different. That is, I cannot easily parametricise the queries. This propagates into my code and instead of populating rows on columns in my table with a simple loop I have code like:</p><p>get <em>A</em> Data (p1, &#8230;, pi);</p><p>get <em>B</em> Data (p1, &#8230;, pi);</p><p>get <em>C</em> Data (p1, &#8230;, pi);</p><p>get <em>D</em> Data (p1, &#8230;, pi);<br /> &#8230;</p><p>And this soon explodes when we have different tables with different columns.</p><p>It also adds to the complexity the fact that I&#39;m using &#34;wicket&#34;, which is, in effect a mapping of objects to html elements in the page. So my Java code becomes an adapter between the database and the front end, which has me creating a lot of wiring, boilerplate code with some logic intermingled in it.</p><p>Would the correct solution be wrapping the ORM mappers with an extralayer that presents a more homogeneous interface to the db or is there a better way to deal with this spaghetti code I&#39;m writing?</p><p>EDIT: More info about the database</p><p>The database holds mainly phone calls information. The poor design consists of:</p><p>Tables with an artificial ID as primary key that has nothing to do with the domain knowledge.</p><p>No unique, triggers, checks or foreign keys whatsoever.</p><p>Fields with a generic name that match different concepts for different records.</p><p>Records that can be categorised only by crossing with other tables with different conditions.</p><p>Columns which should be numbers or dates stored as strings.</p><p>To sum it up, a messy / lazy design all around.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Object orientation is valuable specifically because these types of scenarios arise, and it gives you tools to reasonably design abstractions that allow you to encapsulate complexity.</p><p>The real question here is, <strong>where do you encapsulate that complexity?</strong></p><p>So let me step back a moment and speak to what &#39;complexity&#39; I&#39;m referring to here. Your problem (as I understand it; correct me if I&#39;m wrong) is a persistence model which is not an effectively usable model for the tasks you need to complete with the data. It may be effective and usable for other tasks, but not for <em>your</em> tasks.</p><h2>So what do we do when we have data that does not present a good model for our means?</h2><p>Translate. It&#39;s the only thing you <em>can</em> do. That translation is the &#39;complexity&#39; I refer to above. So now that we accept we&#39;re going to translate the model, we need to decide on a couple of factors.</p><p>Do we need to translate both directions? Are both directions going to be translated the same, as in:</p><p>(Tbl A, Tbl B) -&gt; Obj X (read)</p><p>Obj X -&gt; (Tbl A, Tbl B) (write)</p><p>or do insertion/update/delete activities represent a different type of object such that you read data as Obj X, but data is inserted/updated from Obj Y? Which of these two ways you wish to go, or if no update/insert/delete is possible are important factors in <em>where</em> you want to put the translation.</p><hr/><h2>Where do you translate?</h2><p>Back to the first statement I made in this answer; OO allows you to encapsulate complexity and what I refer to here is the fact that not only should you, but you <em>must</em> encapsulate that complexity if you wish to ensure it doesn&#39;t leak out and seep into all of your code. At the same time, it&#39;s important to recognize you can&#39;t have a <a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html">perfect abstraction</a> so worry less about that than about having a very effective and usable one.</p><p>Again now; your problem is: Where do you put this complexity? Well you have choices.</p><p><strong>You can do it <em>in</em> the database using stored procedures.</strong> This has the drawback of often not playing very well with ORMs but that&#39;s not always true. Stored procedures afford some benefits, including performance often. Stored procedures however can require a lot of maintenance, but it&#39;s up to you to analyze your particular scenario and say if the maintenance will be more or less than other choices. I personally am very skilled with stored procedures, and as such this fact of available talent reduces overhead; never underestimate the value of making decisions based on what you <em>do</em> know. Sometimes the suboptimal solution can be more optimal than the correct solution because you or your team know how to create and maintain it better than the optimal solution.</p><p><strong>Another in-database option is views.</strong> Depending on your database server these may be highly optimal or sub-optimal or not even effective at all, one of the drawbacks can be query times depending on what indexing options are available in your database. Views become an even better choice if you never need to make any data modification (insert/update/delete).</p><p><strong>Stepping past the database you have the old standby of using the repository pattern.</strong> This is a time-tested approach which can be very effective. Drawbacks tend to include boiler plate but well-factored repositories can avoid some amount of this, and even when these do result in unfortunate amounts of boiler plate, repository&#39;s tend to be simple code that&#39;s easy to understand and maintain as well as presenting a good API/abstraction. Also repositories can be good for their unit-testability which you lose with in-database options.</p><p><strong>There are tools like auto-mapper</strong> out there that may make using an ORM plausible where they can do the translation between database-model from orm to usable models, but some of these tools can be tricky to maintain/understand behaving more like magic; though they create a minimum of overhead code resulting in less maintenance overhead when well understood.</p><p><strong>Next you&#39;re stepping further and further from the database</strong>, which means there&#39;s going to be greater amounts of code that are going to deal with the un-translated persistence model, which is going to be genuinely unpleasant. In these scenarios you talk about putting the translation layer in your UI which it sounds like you may be doing now. This is generally a very bad idea, and decays terribly over time.</p><hr/><h2>Now let&#39;s start talking <strong>crazy</strong>.</h2><p><strong>The <code>Object</code> is not the only end-all be-all abstraction that exists.</strong> There have been a profundity of abstractions developed over the many years that computer science has been studied and even before then from the study of math. If we&#39;re going to start getting creative, let&#39;s start talking about known abstractions available that have been studied.</p><p><strong><a href="http://en.wikipedia.org/wiki/Actor_model">There&#39;s the actor model.</a></strong> This is an interesting approach because it says all you do is send messages to other code which effectively delegates all the work to that other code, which is very effective in encapsulating the complexity away from all your code. This could work in so far as you send a message to an actor saying &#34;I need Obj X sent to Y&#34; and you have a receptacle waiting for a response at location Y which then processes Obj X. You could even send a message that instructs &#34;I need Obj X and computation Y, Z done to it&#34; and then you don&#39;t even need to wait; the translation occurs on the other side of that message pass and you can just move on if you don&#39;t need a read of it&#39;s result. This can be slight abuse of the actor model for your purposes, but it all depends; the main goal of Actor Model is asynchrony and concurrency to be handled easily and well, both of those things are however just abstractions which can act as boundaries to encapsulate the complexity we refer to here (or any form of complexity for that matter).</p><p><strong>Another encapsulation boundary is process boundaries.</strong> These can be used for segregating complexity very effectively. You could create the translation code as a web service where the communication is simple HTTP, using SOAP, REST, or if you really want your own protocol (not suggested). STOMP isn&#39;t altogether a bad newer protocol. Or use a normal daemon service with a system-local publicized memory pipe for communicating very quickly again using whichever protocol you choose. This actually has some pretty good benefits:</p><ul><li>You can have multiple processes running that do translation for older and newer version support at the same time allowing you to update the translation service to publicize an object model V2, and then separately at a later point update the consuming code to work with the new object model.</li><li>You can do interesting things like pinning the process to a core for performance, you also get an amount of security safety in this approach by making that the only process running with the security privileges to touch that data.</li><li>You will get a very strong boundary when you&#39;re talking about process boundaries that will stay fixed ensuring minimum leakage of your abstraction for a long time because writing code in the translation space will not be able to be called outside of the translation space since they won&#39;t share process scope, ensuring a fixed set of usage scenarios by contract.</li><li>Ability for asynchronous/non-blocking updates being simpler.</li></ul><p>Drawbacks are obviously more maintenance than is commonly necessary, communication overhead affecting performance and the maintenance.</p><hr/><p>There is a great variety of ways to encapsulate complexity that may allow that complexity to be placed in ever more strange and curious places in your system. Using forms of higher order functions (often times faked using strategy pattern or various other odd forms of object patterns), you can do some very interesting things.</p><p><strong>That&#39;s right, let&#39;s start talking about a monad.</strong> You could create this translation layer in a very independent fashion of small specific functions that do the independent translations necessary, but hide all of those translation functions away not visible so they are hardly accessible to outside code. This has the benefit of reducing reliance on them allowing them to change easily without effecting much external code. You then create a class that accepts higher order functions (anonymous functions, lambda functions, strategy objects, however you need to structure them) which work on any of the nice OO model type objects. You then let the underlying code which accepts those functions do the literal execution using the appropriate translation methods.</p><p>This creates a boundary where all the translation not only <strong>exists on the other side of the boundary</strong> away from all your code; <strong>it is only used on that side</strong> allowing the rest of your code to not even know anything about it other than where the entry point for that boundary is.</p><p>Ok, yeah that really is talking crazy, but who knows; you might just be that crazy (seriously, do not undertake monads with a craziness rating below 88%, there is real risk of bodily injury).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-at-least-one-database-view-per-database-table-is-this-good-or-bad-design-and-why/'>Database &#8211; At least one database view per database table-Is this good or bad design and why</a></li><li class="list-group-item"><a href='../database-one-wide-table-or-multiple-themed-tables/'>Database &#8211; One wide table or multiple themed tables</a></li><li class="list-group-item"><a href='../database-why-does-the-relational-model-for-a-database-matter/'>Database &#8211; Why does the relational model for a database matter</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>