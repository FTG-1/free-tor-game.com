<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Encrypting stored data for multiple unique users to access information &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080125 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080125" class="post-1080125 software type-software status-publish hentry category-software tag-database-design tag-encryption"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Encrypting stored data for multiple unique users to access information</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database-design</span><span class="mr-2 badge badge-info">encryption</span></p><div class="entry-content"><p>Developing a database for many users, and thousands more &#34;people&#34; in the database, one section requires we encrypt the personal data &#8211; Youth&#39;s information, medical information, etc.</p><p>We have users who are able to access the personal data on people <em>within their control</em>, but we are thinking that we will need to also encrypt the data when it&#39;s stored on our server. I believe that if I use each user&#39;s salted passwords to encrypt the data, only that user can access the data (not good). If I have one master key, then it would need to be stored outside of the application to access the data.</p><p>Are there techniques that can encrypt the data in such a way that a data breach on the server won&#39;t show the data in the database in clear text, but that multiple users of certain permissions can decrypt the data they need?</p><ul><li>Must encrypt the data in the database</li><li>Multiple users may need to access the same encrypted data, based on their permissions</li><li>Cannot be derived from the user&#39;s passwords (since some users may leave or change, requiring access to be removed/edited/added)</li><li>HTTPS is already getting used, and I understand encrypting data client-side is a Bad Idea<sup>TM</sup></li><li>If it matter: MySQL is the database system</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Are there techniques that can encrypt the data in such a way that a data breach
 on the server won&#39;t show the data in the database in clear text, but that multiple
 users of certain permissions can decrypt the data they need?</p></blockquote><p>Yes. You need two things:</p><ul><li><p>modify your existing table structure so that all fields that you want encrypted are appropriately altered in size and type. For example a <code>VARCHAR(50)</code> would become <code>VARBINARY(64)</code> in order to employ AES algorithm, that uses a code block of 128 bits (16 bytes) and would output blocks of multiples of 16 bytes.</p></li><li><p>then you add a mapping table for each entity which you need to encrypt. For example you want to encrypt fields in tables <code>User</code> and <code>Report</code>, and want them independent; you add two tables User_Map and Report_Map. If Reports belong to Users as a one-to-many relationship, and access to User 12345 will therefore grant access to its Reports, you only need User_Map (any Report will use the secret key of its User). And so on.</p></li></ul><p>The mapping table holds three columns: Accessor, Accessed, and Key. Accessor identifies whoever is accessing the data (it could be a <code>user_id</code> for example). Accessed identifies the entity which is being accessed (<code>user_id</code> or <code>report_id</code>). Finally <code>key</code> is a cryptographically strong random value associated with the Accessed resource instance at the moment of its creation, encrypted with Accessor&#39;s password.</p><p>All data in the mapped resource is encrypted using that random value, which will never be disclosed and will never be changed; changing it, while possible, would be really awkward.</p><p>So if you have five Books in your table, each of those will have a random value of its own, that exists nowhere in the clear.</p><p>The operations you need to support are:</p><ul><li>access to a resource by Accessor: Accessor has identified and his password is in memory. When accessing resource XYZ, a search for <code>user_id = Accessor_id AND resource_id = XYZ</code> will yield XYZ&#39;s encrypted key. Decrypt it with the password. The key thus obtained will allow decryption/reencryption of XYZ&#39;s data.</li></ul><p>Multiple Accessors can access the same Resource:</p><pre><code>Accessor_id     Accessed_id     Key
1(joe)          101             ENCRYPT(&#39;random101&#39;, &#39;joespassword&#39;);
2(alice)        101             ENCRYPT(&#39;random101&#39;, &#39;alicespassword&#39;);
1(joe)          102             ENCRYPT(&#39;random102&#39;, &#39;joespassword&#39;);
</code></pre><ul><li><p>update Accessor&#39;s password: you need to decrypt all Key values that are encrypted with the old password and reencrypt them with the new one:</p><p>UPDATE Users_Map SET CKey = ENCRYPT(DECRYPT(CKey, :OldPassword), :NewPassword)
 WHERE Accessor_id = :MyId;</p></li><li><p>delete Accessor&#39;s credentials: just kill all tuples with that Accessor_id (note: if all Accessors with access to a given Accessed are eliminated, the Accessed&#39;s data will become unavailable. One user (e.g. root) should have access and not be deletable).</p></li></ul><p>Some operations you might want to support:</p><ul><li><p>access all data <em>accessible to Accessor</em> in a hierarchical way (i.e. you are Accessor&#39;s supervisor): that&#39;s tricky. You need to encrypt and maintain Accessor&#39;s password, which you can only do if Supervisor is logged in. To provide for this, you can supply a asymmetric encryption scheme whereby if user A is supervised by user B, then the t-uple (B_id, A_id, (A&#39;s private key encrypted with B&#39;s public key)) is available in the hierarchic database. This way, it is always possible for a supervisor to access his people&#39;s private keys, and they can update them without needing the supervisor&#39;s intervention.</p></li><li><p>granting rights to a Resource to a user also requires using asymmetric ciphers, because while user A is in possession of the resource instance&#39;s unique key, s/he can neither send it in the clear to user B (it would permanently disclose that resource instance&#39;s plaintext for everyone), nor can s/he encrypt it with B&#39;s password since it is known only to B. The solution is encrypt the instance key with user B&#39;s public key (which can be known), while the private key remains encrypted.</p></li></ul><p>Since sending the private key might be difficult, being <a href="https://stackoverflow.com/questions/5403808/private-key-length-bytes">a couple of kilobytes</a>, you could generate a public/private key pair and encrypt the private key symmetrically using a BCrypt hash of the user&#39;s password. When the user logs in, his private key becomes accessible to him or her, and can be used to unlock all asymmetrically encrypted information, if there is any (if you don&#39;t need grants and hierarchies, there might be no need).</p><h1>Performances and limitations</h1><p>The performance impact is not too large, if we consider that encrypted data are used mainly upon receipt or sending data to a user (which are slow operations in themselves). But this introduces the main limitation - encrypted data cannot be easily used in the system.</p><p>For example, straight search is either impossible or very slow: <a href="http://www.cs.berkeley.edu/~dawnsong/papers/se.pdf" rel="nofollow noreferrer">techniques for encrypted searching</a> exist, but with this scheme, looking for records containing &#34;Hello world&#34; would require changing something like</p><pre><code>SELECT ...
FROM Resource
WHERE searchField LIKE :searchText
</code></pre><p>to</p><pre><code>SELECT ...
FROM Resource
JOIN Record_Map ON (Resource.id = Record_Map.Resource_id)
WHERE DECRYPT(searchField, DECRYPT(Record_Map.Key, :myPassword)) LIKE :searchText
AND Record_Map.Accessor_id = :myId
</code></pre><h1>Security</h1><p>The database contains no plaintext keys or passwords, so capturing a database would not compromise data security. Standard caveats apply: user passwords must not be guessable and must be properly stored and checked (bcrypt is good for that).
Accessing a user&#39;s password only allows accessing the data that user is granted read rights to. Possession of a currently valid password <strong>and</strong> physical access to database would allow recovering the accessible data not only in the present but <em>in the future</em> (provided physical access to the database is secured again).</p><p>Example: Eve steals a copy of the database. She is unable to read anything since she has no passwords. She manages to acquire Alice&#39;s password and is thus able to decrypt Bob&#39;s record, that Alice has access to. Alice changes her password, and updates Bob&#39;s record; after Dane is added to her people, Eve steals a fresh copy of the database. She can still read Bob&#39;s updated record (she has Bob&#39;s key from old database), but not Dane&#39;s (Dane&#39;s key is encrypted with Alice&#39;s new password, that Eve lacks).</p><p>To &#34;re-secure&#34; a record with N managers it is necessary to change its encryption key, which requires updating all N extant mapping records for that record; which requires access to all N passwords at the same time.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-i-need-advice-developing-a-sensitive-data-transfer-storage-encryption-system/'>C# &#8211; I need advice developing a sensitive data transfer/storage/encryption system</a></li><li class="list-group-item"><a href='../php-building-a-web-app-with-encrypted-mysql-database-entries/'>Php &#8211; Building a web app with encrypted MySQL database entries</a></li><li class="list-group-item"><a href='../encrypting-the-data-and-keeping-it-safe-in-unity/'>Encrypting the data and keeping it safe in Unity</a></li><li class="list-group-item"><a href='../whats-safest-way-to-tell-if-decryption-was-successful/'>Whats safest way to tell if decryption was successful</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>