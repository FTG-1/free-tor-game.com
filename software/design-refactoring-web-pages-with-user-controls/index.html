<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; Refactoring web pages with user controls &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082752 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082752" class="post-1082752 software type-software status-publish hentry category-software tag-asp-net tag-design tag-legacy-code tag-refactoring tag-user-control"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; Refactoring web pages with user controls</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">legacy code</span><span class="mr-2 badge badge-primary">refactoring</span><span class="mr-2 badge badge-danger">user control</span></p><div class="entry-content"><p><strong>Is it good design to use many user controls to help refactor a web application?</strong></p><p>In my case, it&#39;s a VB.NET Webforms ASP.NET website. All our pages are organized into <em>sections</em> that, while related and belong on the same page, don&#39;t need to interact with each other. Each section contains many asp controls (text boxes, labels, grid views, buttons, etc). Most are <em>forms</em> the user will fill out to submit or view data. Due to the multiple sections and multiple number of controls per section, the code files can get very large.</p><p>Turning each section into a user control seems like it would be a nice way to refactor the pages. Each section now gets organized in its own file and the code gets taken out of the large page file.</p><p>We&#39;ll probably end up with 100+ user controls that aren&#39;t likely to be reused on other pages, however it seems like a better option compared to <strong>Partial Classes</strong> as it allows us to use <strong>Lazy Loading</strong> with the user controls to improve page load times.</p><p><em>Note: A lot of refactoring is going to happen whether we use user controls or not. If we choose to split up our page using user controls, the code that each control would contain is also going to be refactored, breaking things up into classes and functions where possible. We have the idea that user controls might be a way to help improve on our code in addition to the other refactoring as described in the question.</em></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I&#39;ve found that there is <em>way</em> more repetition of code in a WebForms application than is immediately noticeable. I&#39;ve been banging my head with this exact problem, and I&#39;ve come up with several remedies.</p><h2>DRY Up Your UserControls (And Models, Too!)</h2><p>When you look at each individual page, you see so many differences that you can&#39;t possibly imagine code is being repeated. Look at the data you are saving to the database. On an application I work on, we have about 10 different forms all saving &#34;people&#34; records to the database with the same fields, but different fields are available in each view. At first I thought there was too much custom code, but then I realized it&#39;s all the same data in the same table. I created a generic User Control to edit &#34;people&#34; objects -- Populate form fields based on a domain model, and repopulate the domain model based on the form fields.</p><p>I also created a view-model that encompassed display logic, and then use that to affect the user control.</p><h3>Person Domain Model</h3><pre><code>public enum PersonType
{
    Applicant = 1,
    Foo = 2
}

public class Person
{
    public int Id { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public string TaxId { get; set; }
    public IEnumerable&lt;PersonType&gt; Types { get; private set; }

    public bool IsApplicant
    {
        get { return Types.Contains(PersonType.Applicant); }
    }

    public bool IsSomethingElse
    {
        get { return Types.Contains(PersonType.Foo); }
    }

    public bool RequiresTaxId
    {
        get { return IsApplicant; }
    }
}
</code></pre><h3>Person View-Model</h3><pre><code>public class PersonViewModel
{
    public Person Person { get; private set; }

    public bool ShowTaxIdField { get { return Person.RequiresTaxId; } }

    public PersonViewModel(Person person)
    {
        Person = person;
    }
}
</code></pre><h3>(A Snippet Of) The User Control</h3><pre><code>&lt;p id=&#34;TaxIdField&#34; runat=&#34;server&#34;&gt;
    &lt;asp:Label ID=&#34;TaxIdLabel&#34; runat=&#34;server&#34; AssociatedControlID=&#34;TaxId&#34;&gt;Tax Id:&lt;/asp:Label&gt;
    &lt;asp:TextBox ID=&#34;TaxId&#34; runat=&#34;server&#34; /&gt;
&lt;/p&gt;
</code></pre><h3>The C# Code-Behind</h3><pre><code>public partial class PersonUserControl : System.Web.UI.UserControl
{
    public void SetModel(PersonViewModel model)
    {
        TaxId.Text = model.Person.TaxId;
        TaxIdField.Visible = model.ShowTaxIdField;
        // ...
    }

    public PersonViewModel GetModel()
    {
        var model = new PersonViewModel(new Person()
        {
            TaxId = TaxId.Text.Trim(),
            // ...
        });

        return model;
    }
}
</code></pre><h2>Push Business Logic Into Your Domain Models</h2><p>Removing duplicated code also means moving business logic into your domain models. Does this &#34;person&#34; require a tax Id? Well, the <code>Person</code> class should have a property or method called <code>IsTaxIdRequired</code>. Watch <a href="http://vimeo.com/43598193" rel="nofollow">Crafting Wicked Domain Models</a> for some additional ideas.</p><h3>But I Use DataSets...</h3><p>Stop! Immediately. You are intimately tying your C# code to the underlying database schema. Even if you have to hand write a mapping layer between DataSet objects and your domain models, you&#39;ll still be further ahead because now you can bundle behavior and business rules with your data in one neat, and tidy class. By using DataSets, your Design and Code-Behind files implement business logic! Stop this as soon as you can. Even though the WebForms framework doesn&#39;t strictly adhere to the Model-View-Controller pattern, the C# Code-Behind should be viewed as the &#34;Controller&#34; and the Design file should be seen as the &#34;View&#34;. The only thing left is the &#34;Model&#34;, <em>which should not be a DataSet</em>. DataSet objects give you data, but no behavior leading to repeated business logic.</p><h2>Use Helper Classes For Initializing the User Interface</h2><p>All to often I see this in 15 different UserControls:</p><pre><code>public InitStateDropdownList()
{
    ddlState.DataSource = ...
    ddlState.DataBind();
    ddlState.Items.Insert(0, new ListItem(&#34;Select&#34;, string.Empty));
}
</code></pre><p>Push this into a helper class:</p><pre><code>public static class DropDownListHelper
{
    public static void InitStates(DrowDownList list)
    {
        list.DataSource = // get options from database or session
        list.Items.Insert(0, new ListItem(&#34;Select&#34;, string.Empty));
        list.DataBind();
    }
}
</code></pre><p>And use it:</p><pre><code>DropDownListHelper.InitStates(ddlState);
</code></pre><p>Some people rile against &#34;helper&#34; classes, but it&#39;s surely better than writing what is essentially the same 3 lines of code in multiple places. Even if you can&#39;t create super generic User Controls, at least weed out the repetitive code that initializes components upon page load.</p><h2>When is the BIG Rewrite the Answer?</h2><p>Almost never. For all my complaints about the WebForms framework, it at <em>least</em> compartmentalizes pages and forms, which is a great setup for a long term refactoring job. The key is <strong>adding test coverage</strong>. I&#39;ve had a lot of success using CodedUI Tests and <a href="http://www.specflow.org/" rel="nofollow">SpecFlow</a> for testing WebForms applications, since most if not all business logic is scattered between C# and ASP in 19 different files. At least write some tests to validate existing business rules don&#39;t get broken during the many refactoring sessions you have in your future.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-make-refactoring-a-priority-for-the-team/'>How to make refactoring a priority for the team</a></li><li class="list-group-item"><a href='../best-practice-for-using-a-user-control-across-many-projects/'>Best practice for using a user control across many projects</a></li><li class="list-group-item"><a href='../alternative-way-of-developing-for-asp-net-to-webforms-any-problems-with-this/'>Alternative way of developing for ASP.NET to WebForms &#8211; Any problems with this</a></li><li class="list-group-item"><a href='../c-advise-on-loose-coupling-between-user-controls/'>C# &#8211; Advise on loose coupling between user controls</a></li><li class="list-group-item"><a href='../design-best-way-to-analyse-a-large-class-before-refactoring-it-into-smaller-classes/'>Design &#8211; Best way to analyse a large class before refactoring it into smaller classes</a></li><li class="list-group-item"><a href='../architecture-advice-converting-a-multiple-project-asp-net-webforms-website-to-mvc-using-vs2015/'>Architecture &#8211; Advice converting a multiple-project ASP.NET WebForms website to MVC (using VS2015)</a></li><li class="list-group-item"><a href='../c-is-it-good-practice-to-use-user-controls-to-structure-wpf-forms-even-if-these-user-controls-are-only-used-once/'>C# &#8211; Is it good practice to use user controls to structure WPF forms even if these user controls are only used once</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>