<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Applying DDD, is having multiple aggregates representing the same concept from a different view a good idea &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080277 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080277" class="post-1080277 software type-software status-publish hentry category-software tag-aggregate tag-domain-driven-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Applying DDD, is having multiple aggregates representing the same concept from a different view a good idea</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aggregate</span><span class="mr-2 badge badge-info">domain-driven-design</span></p><div class="entry-content"><p>We&#39;re completely remodelling a system at the company for which I am currently working. We&#39;re applying DDD and for the very first time I have actually got someone on my team who has some prior experience with DDD as well (yay!)</p><p>This new system is extremely user-centric, i.e. pretty much every operation within the system comes from the end-user. Some of these operations may be:</p><ol><li>Create an <strong>Account</strong>. A non-paying user is limited to one active account, pro-members can have as many accounts as they want.</li><li>Add a <strong>Transaction</strong> to an <strong>Account</strong>, but only if a <strong>User</strong> has access to said <strong>Account</strong>.</li><li>Reorder <strong>Division</strong>s in an <strong>Account</strong>, but only if a <strong>User</strong> has access to said <strong>Account</strong>.</li></ol><p>There are a lot of these rules, all point to a single user and this is where me and my colleague came into argument.</p><p>My opinion is, aggregates should be as small as necessary, as cohesive, this makes their testing and understanding easier. E.g. if I model the first rule, I would create a simple aggregate, which could look like this:</p><pre><code>class UserWithActiveAccounts {

    private UserId id;
    private NonNegativeNumber countOfActiveAccounts;
    private MembershipType membershipType;

    public Account createNewAccount(AccountId accountId, NonEmptyString accountName) {
        if (
            MembershipType.FREE.equals(membershipType) &amp;&amp;
            countOfActiveAccounts.GT(NonNegativeNumber.fromValue(1))
        ) {
            throw AccountLimitExceeded.forFreeUserTooManyAccounts(id);
        }

        return Account.withOwner(accountId, accountName, id);
    }
}
</code></pre><p>This aggregate contains only count of currently active accounts and user&#39;s membership type, because that&#39;s what the business rule when creating a new account cares about.</p><p>Then, if I had to model the other 2 user cases, I would need another aggregate, such as <code>UserWithAccessibleAccounts</code>, which would internally contain a <code>List</code> of <code>AccountId</code> values, which I could iterate upon adding a <strong>Transaction</strong> with a specific <code>AccountId</code> to check, whether the operation is allowed or not.</p><pre><code>class UserWithAccessibleAccounts {

    private UserId id;
    private List&lt;AccountId&gt; accessibleActiveAccounts;

    public Transaction addTransaction(
        TransactionId transactionId,
        AccountId toAccountId,
        Number value
    ) {
        if (hasAccessToAccount(toAccountId)) {
            throw CannotAddTransaction.noAccessToAccount(id, toAccountId);
        }

        return Transaction.byUserInAccount(transactionId, value, id, toAccountId);
    }

    private bool hasAccessToAccount(AccountId accountId) {
        return accessibleActiveAccounts.contains(accountId);
    }
}
</code></pre><p>Obviously, with my approach you will have a lot of small aggregates each responsible for a tiny piece of business rule.</p><p>What my colleague would like is to have a large class, such as <code>User</code>, which would contain all operations. Which I am against. I believe it would lead to a god messy class, where it would be much more difficult to track bugs. Also, as this class would grow, each time you would want to run any of the operations on the user, you would need to load a lot of properties which are unrelated to the operation that the user is currently trying to do (such as loading the <code>List</code> of <code>AccountId</code> values when a simple count of them is necessary, in this very simplified example).</p><p>We&#39;re basically trying to solve the problem of:</p><ul><li>either having to come up with a lot of class names for all those small aggregates,</li><li>deal with scalability issue and a humongous class due to pulling all the data for each operation, no matter how small.</li></ul><p>I am inclined to the small aggregates approach, but perhaps I am not looking at it from the correct angle and there&#39;s something about the approach my colleague is suggesting I am simply not seeing.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>First of all. If you want to follow DDD then one of the rules for creating aggregates is that the transactions should not cross aggregate boundaries. But in your approach if a UserWithActiveAccount has a new accessible account then you will have to delete UserWithActiveAccount and create a new UserWithAccessibleAccount in the same transaction. Which is breaking one of the rules of designing aggregates in DDD.</p><p>I can see why you might think it is better to create different user entities. But be aware that you are now creating entities that doesn&#39;t even exist in your domain. And this can easily go wrong at one point. You can easily end up with a big number of user classes that doesn&#39;t exist in the ubiquitous language and then the amount of cognitive load (information needed to understand the code) will be huge.</p><p>Think about having more possible states for the user(user with expired account, user with deleted account ...). You will have to create a new class for each one and then what about a user that can be in two states at the same time? Would create a new class for each combination?</p><p>DDD is all about designing a model that reflects the domain (business) and in your domain there is a user that can have different states but it is still the same user. So I would suggest to have the same in the code. That means a user entity that can have different states.</p><p>Now let&#39;s discuss what can go wrong with this approach:</p><blockquote><p>aggregates should be as small as necessary, as cohesive, this makes their testing and understanding easier.</p></blockquote><p>This is not necessarily true. Keeping the functions small and following some of the coding good practices will keep the class simple and easy to understand. The size of the class doesn&#39;t necessarily mean it is complicated.</p><blockquote><p>Also, as this class would grow, each time you would want to run any of the operations on the user, you would need to load a lot of properties which are unrelated to the operation that the user is currently trying to do (such as loading the List of AccountId values when a simple count of them is necessary, in this very simplified example).</p></blockquote><p>What is the problem with that? Do you have limited memory on the machine where this code will be executed? will this result in a noticeable decrease in performance? If not then there is no reason to do some premature optimization for problem that you will probably never have to deal with. If all the data is well encapsulated in your class, there is no problem if it contains many properties.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../are-ddd-aggregates-really-a-good-idea-in-a-web-application/'>Are DDD Aggregates really a good idea in a Web Application</a></li><li class="list-group-item"><a href='../inter-aggregate-commands-transactions-in-an-eventual-consistency-manner/'>Inter-aggregate commands/transactions in an eventual consistency manner</a></li><li class="list-group-item"><a href='../design-domain-driven-design-can-two-aggregates-have-the-same-root/'>Design &#8211; Domain driven design, can two aggregates have the same root</a></li><li class="list-group-item"><a href='../event-sourcing-one-event-state-of-two-aggregates-changed/'>Event sourcing, one event, state of two aggregates changed</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>