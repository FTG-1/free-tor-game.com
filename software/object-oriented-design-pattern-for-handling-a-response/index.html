<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Object-oriented &#8211; Design pattern for handling a response &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077047 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077047" class="post-1077047 software type-software status-publish hentry category-software tag-clean-code tag-design tag-design-patterns tag-object-oriented tag-php"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Object-oriented &#8211; Design pattern for handling a response</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">clean code</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">design-patterns</span><span class="mr-2 badge badge-primary">object-oriented</span><span class="mr-2 badge badge-danger">PHP</span></p><div class="entry-content"><p>Most of the time when I&#39;m writing some code that handles the response for a certain function call I get the following code structure:</p><p>example: This is a function that will handle the authentication for a login system</p><pre><code>class Authentication{

function login(){ //This function is called from my Controller
$result=$this-&gt;authenticate($username,$password);

if($result==&#39;wrong password&#39;){
   //increase the login trials counter
   //send mail to admin
   //store visitor ip    
}else if($result==&#39;wrong username&#39;){
   //increase the login trials counter
   //do other stuff
}else if($result==&#39;login trials exceeded&#39;)
   //do some stuff
}else if($result==&#39;banned ip&#39;){
   //do some stuff
}else if...

function authenticate($username,$password){
   //authenticate the user locally or remotely and return an error code in case a login in fails.
}    
}
</code></pre><p><strong>Problem</strong></p><ol><li>As you can see the code is build on a <code>if/else</code> structure which means a new failure status will mean that I need to add an <code>else if</code> statement which is a violation for the <em>Open Closed Principle</em>.</li><li>I get a feeling that the function has different layers of abstraction as I may just increase the login trials counter in one handler, but do more serious stuff in another.</li><li>Some of the functions are repeated <code>increase the login trials</code> for example.</li></ol><p>I thought about converting the multiple <code>if/else</code> to a factory pattern, but I only used factory to create objects not alter behaviors. Does anyone have a better solution for this?</p><p><strong>Note:</strong></p><p><strong>This is just an example using a login system.</strong> I&#39;m asking for a general solution to this behavior using a well built OO pattern. This kind of <code>if/else</code> handlers appears in too many places in my code and I just used the login system as a simple easy to explain example. My <em>real</em> use cases are to much complicated to post here. ðŸ˜€</p><p>Please don&#39;t limit your answer to PHP code and feel free to use the language you prefer.</p><hr/><p><strong>UPDATE</strong></p><p>Another more complicated code example just to clarify my question:</p><pre><code>  public function refundAcceptedDisputes() {            
        $this-&gt;getRequestedEbayOrdersFromDB(); //get all disputes requested on ebay
        foreach ($this-&gt;orders as $order) { /* $order is a Doctrine Entity */
            try {
                if ($this-&gt;isDisputeAccepted($order)) { //returns true if dispute was accepted
                    $order-&gt;setStatus(&#39;accepted&#39;);
                    $order-&gt;refund(); //refunds the order on ebay and internally in my system
                    $this-&gt;insertRecordInOrderHistoryTable($order,&#39;refunded&#39;);                        
                } else if ($this-&gt;isDisputeCancelled($order)) { //returns true if dispute was cancelled
                    $order-&gt;setStatus(&#39;cancelled&#39;);
                    $this-&gt;insertRecordInOrderHistory($order,&#39;cancelled&#39;);
                    $order-&gt;rollBackRefund(); //cancels the refund on ebay and internally in my system
                } else if ($this-&gt;isDisputeOlderThan7Days($order)) { //returns true if 7 days elapsed since the dispute was opened
                    $order-&gt;closeDispute(); //closes the dispute on ebay
                    $this-&gt;insertRecordInOrderHistoryTable($order,&#39;refunded&#39;);
                    $order-&gt;refund(); //refunds the order on ebay and internally in my system
                }
            } catch (Exception $e) {
                $order-&gt;setStatus(&#39;failed&#39;);
                $order-&gt;setErrorMessage($e-&gt;getMessage());
                $this-&gt;addLog();//log error
            }
            $order-&gt;setUpdatedAt(time());
            $order-&gt;save();
        }
    }
</code></pre><p><strong>function purpose:</strong></p><ul><li>I am selling games on ebay.</li><li>If a customers wishes to cancel his order and gets his money back<br /> (i.e. a Refund) I must open a &#34;Dispute&#34; on ebay first.</li><li>Once a dispute is opened I must wait for the customer to confirm that<br /> he agrees to the refund (silly as he&#39;s the one who told me to refund,<br /> but that&#39;s how it works on ebay).</li><li>This functions gets all disputes opened by me and checks their statuses periodically to see if the customer has replied to the dispute or not.</li><li>The customer may agree (then I refund) or refuse (then I rollback) or may not respond for 7 days (I close the dispute myself then refund).</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>This is a prime candidate for the <a href="http://www.labelmedia.co.uk/blog/posts/design-patterns-strategy-pattern.html">Strategy pattern</a>.</p><p>For example, this code:</p><pre><code>if ($this-&gt;isDisputeAccepted($order)) { //returns true if dispute was accepted
    $order-&gt;setStatus(&#39;accepted&#39;);
    $order-&gt;refund(); //refunds the order on ebay and internally in my system
    $this-&gt;insertRecordInOrderHistoryTable($order,&#39;refunded&#39;);                        
} else if ($this-&gt;isDisputeCancelled($order)) { //returns true if dispute was cancelled
    $order-&gt;setStatus(&#39;cancelled&#39;);
    $this-&gt;insertRecordInOrderHistory($order,&#39;cancelled&#39;);
    $order-&gt;rollBackRefund(); //cancels the refund on ebay and internally in my system
} else if ($this-&gt;isDisputeOlderThan7Days($order)) { //returns true if 7 days elapsed since the dispute was opened
    $order-&gt;closeDispute(); //closes the dispute on ebay
    $this-&gt;insertRecordInOrderHistoryTable($order,&#39;refunded&#39;);
    $order-&gt;refund(); //refunds the order on ebay and internally in my system
}
</code></pre><p>Could be reduced to</p><pre><code>var $strategy = $this.getOrderStrategy($order);
$strategy-&gt;preProcess();
$strategy-&gt;updateOrderHistory($this);
$strategy-&gt;postProcess();
</code></pre><p>where getOrderStrategy wraps the order in a DisputeAcceptedStrategy, DisputeCancelledStrategy, DisputeOlderThan7DaysStrategy, etc. each of which know how to handle the given situation.</p><p><strong>Edit, to answer question in comments.</strong></p><blockquote><p>could you please elaborate more on your code. What I understood is that getOrderStrategy is a factory method that returns a strategy object depending on the order status, but what are the preProcess() and preProcess() functions. Also why did you pass $this to updateOrderHistory($this)?</p></blockquote><p>You&#39;re focussing on the example, which could be completely inappropriate for your case. I don&#39;t have enough detail to be sure of the best implementation, so I came up with a vague example.</p><p>The one common piece of code you have is insertRecordInOrderHistoryTable, so I chose to use that (with a slightly more generic name) as the central point of the strategy. I pass $this to it, because it is calling a method on this, with $order and a different string per strategy.</p><p>So, basically, I envision each of those looking like this:</p><pre><code>public function updateOrderHistory($auth) {
    $auth.insertRecordInOrderHistoryTable($order, &#39;cancelled&#39;);
}
</code></pre><p>Where $order is a private member of the Strategy (remember I said it should wrap the order) and the second argument is different in each class. Again, this might be entirely inappropriate. You might want to move insertRecordInOrderHistoryTable to a base Strategy class and not pass the Authorization class in. Or you might want to do something entirely different, it was just an example.</p><p>Likewise, I limited the rest of the differing code to pre- and postProcess methods. This is almost certainly not the best you can do with it. Give it more appropriate names. Split it down into multiple methods. Whatever makes the calling code more readable.</p><p>You <em>might</em> prefer to do this:</p><pre><code>var $strategy = $this.getOrderStrategy($order);
$strategy-&gt;setStatus();
$strategy-&gt;closeDisputeIfNecessary();
$strategy-&gt;refundIfNecessary();
$strategy-&gt;insertRecordInOrderHistoryTable($this);                        
$strategy-&gt;rollBackRefundIfNecessary();
</code></pre><p>And have some of your Strategies implement empty methods for the &#34;IfNecessary&#34; methods.</p><p><em>Whatever makes the calling code more readable.</em></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-should-we-validate-a-state-transition-before-attempting-it-in-the-state-pattern/'>Java &#8211; Should we validate a state transition before attempting it in the State Pattern</a></li><li class="list-group-item"><a href='../php-matching-usernames-with-their-password/'>Php &#8211; matching usernames with their password</a></li><li class="list-group-item"><a href='../php-how-should-i-store-usernames-and-passwords-for-user-login-using-php-cassandra/'>Php &#8211; How should I store usernames and passwords for user login using php/cassandra</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>