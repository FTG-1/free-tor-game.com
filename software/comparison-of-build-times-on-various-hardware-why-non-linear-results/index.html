<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Comparison of build times on various hardware; why non-linear results &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076969 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076969" class="post-1076969 software type-software status-publish hentry category-software tag-benchmarking tag-compile-time tag-cpu tag-performance"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Comparison of build times on various hardware; why non-linear results</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">benchmarking</span><span class="mr-2 badge badge-info">compile-time</span><span class="mr-2 badge badge-warning">cpu</span><span class="mr-2 badge badge-primary">performance</span></p><div class="entry-content"><ul><li>Why do the compile times not vary significantly between different era CPUs, even though disk (NVMe vs. HDD) and CPU benchmarks vary significantly in performance?</li><li>Why does disabling hyperthreading affect performance significantly with the Ryzen CPU?</li></ul><p>Over the past few months I have seen some different machines all running Linux with CPUs that varied from about 9 years since release and some recently released.  The newer CPUs received much higher benchmark numbers from <a href="https://www.cpubenchmark.net/" rel="nofollow noreferrer">cpubenchmark.net</a>. Details below including compile times for the Linux 4.4.176 kernel using Ubuntu 18.04.</p><p>To put it simply, CPUs that scored multiple times faster at <a href="https://www.cpubenchmark.net/" rel="nofollow noreferrer">cpubenchmark.net</a> most certainly did not decrease compile times by the same factor.  In fact, sometimes meager improvements were seen.</p><p>What would be the bottleneck to change or fix?  The Ryzen machine has all the latest hardware gadgets.  Or is this a case of synthetic benchmarks vs. reality?</p><p><a href="https://softwareengineering.stackexchange.com/q/59692/47826">This question</a> touches on the topic of benchmarking by compile time comparison, but does not explore the (lack of) variability in build times seen.</p><blockquote><ul><li>Recent Ryzen 2950X system<ul><li>Single Thread Rating: 2208</li><li>Disk: NVMe</li><li>Source: Linux kernel, 4.4.176, compiled with .config from Ubuntu Xenial</li><li>Invocation:  make -j32</li><li>Compile time: 25997u 4910s <strong>17:25</strong> wall time</li></ul></li><li>Same system, with hyperthreading (or whatever AMD calls it) turned <strong>off</strong><ul><li>Source: Linux kernel 4.4.176, same .config file</li><li>Invocation:  make -j16</li><li>Compile time: 10561u 1796s <strong>13:44</strong> wall time</li></ul></li></ul></blockquote><p>That is an over 20% reduction in compile time amounting to a difference of 3 minutes 41 seconds, from 17:25 to 13:44.  Just by disabling the hyperthreading feature.</p><p><strong>New Data</strong>, 2019-03-08</p><p>Compile time actually decreased monotonically, but not linearly, until <code>make -j12</code>, taking <strong>12:46</strong> with a dozen processes.  The compile time then increased slowly and monotonically out to the last run of <code>make -j24</code>.  Hyperthreading was <em>off</em> for these tests.</p><p>Whatever the bottleneck is, is hit after 12 parallel threads.</p><p><strong>New Data</strong> &#8211; 2019-03-27</p><p>After tuning the X.M.P. memory profile, but still with single channel access, the times decreased until a minimum was reached of <strong>10:08.5</strong> at 16 threads; as many threads as cores (no HT enabled).  With one exception the compile times increased slowly to 10:41 at 32 threads.</p><p>Once dual channel memory was enabled, times decreased to <strong>6:47.5</strong> at 17 threads.  After this point, the timings wobbled up and down with another minimum of 6:46.6 at 20 threads.  This is probably a fluke and likely not a definitive point at which a minimum point is reached.  Only a maximum of 24 threads was tested in this case.</p><p>It seems that memory is a huge factor and the bottleneck for this processor.  Tossing more processing threads at the problem once memory is configured optimally does not seem to help or hinder much.</p><p><strong>Conclusion</strong></p><ul><li><p>Memory is a major potential bottleneck for this CPU and must be configured properly to take advantage of the processor.</p></li><li><p>The old rule of as many threads as processors seems to hold.</p></li><li><p>Hyperthreading was not tested beyond the first tests, so no conclusions can be drawn in that area, other than that the default configuration with single channel memory probably starves the hyperthreaded cores for memory accesses.</p></li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Just off the top of my head:</p><ol><li><p>CPU performance is not the only thing that affects compile times.</p></li><li><p>Benchmarks do not always take into account performance factors that affect real programs.</p></li><li><p>Cache affinity can be a larger factor than CPU speed.</p></li><li><p>Compilers don&#39;t always exploit concurrency mechanisms effectively.</p></li><li><p>In general, programs like compilers can be written in such a way that they exploit (or fail to exploit) specific CPU characteristics.</p></li><li><p>Concurrency mechanisms have overhead.  If the software is not getting any benefit from the concurrency offered, the result is a <em>net negative.</em></p></li></ol><p>In short, it&#39;s complicated.  A highly complex task like compilation is not always well-modeled by benchmarks.  You have to consider other real-world factors that affect overall performance, like seek times on hard disks and the manner in which the code is written.</p><p>For a simple, but rather dramatic example of this, see <a href="https://stackoverflow.com/questions/54814597/confusion-about-different-running-times-of-two-algorithms-in-c">here</a>.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-low-latency-unix-linux/'>C++ &#8211; Low Latency Unix/Linux</a></li><li class="list-group-item"><a href='../c-a-question-regarding-linked-list-vs-vector-insert-remove-results-comparison/'>C++ &#8211; A question regarding linked list vs vector insert/remove results comparison</a></li><li class="list-group-item"><a href='../build-times-for-small-incremental-changes-to-c-web-applications/'>Build times for small incremental changes to C# Web Applications</a></li><li class="list-group-item"><a href='../java-in-java-why-use-bit-hacks-when-non-bitwise-technique-it-is-more-readable/'>Java &#8211; In Java, why use bit hacks when non-bitwise technique it is more readable</a></li><li class="list-group-item"><a href='../maintenance-cost-of-simd-programming-code-base/'>Maintenance cost of SIMD programming code base</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>