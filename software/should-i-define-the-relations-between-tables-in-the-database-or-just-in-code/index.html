<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Should I define the relations between tables in the database or just in code &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1066482 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1066482" class="post-1066482 software type-software status-publish hentry category-software tag-mysql tag-rdbms tag-relational-database tag-schema"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Should I define the relations between tables in the database or just in code</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">MySQL</span><span class="mr-2 badge badge-info">rdbms</span><span class="mr-2 badge badge-warning">relational-database</span><span class="mr-2 badge badge-primary">schema</span></p><div class="entry-content"><p>In my experience, many of the projects I have read in the past didn&#39;t have relationship definitions in the database, instead they only defined them in the source code. So I&#39;m wondering what are the advantages/disadvantages of defining relations between tables in the database and in source code? And the broader question is about other advanced features in modern databases like cascade, triggers, procedures&#8230; There are some points in my thoughts:</p><p>In the database:</p><ul><li><p>Correct data from design. Prevent application errors which can cause invalid data.</p></li><li><p>Reduce network round trip to application when inserting/updating data as application has to make more query(s) to check data integrity.</p></li></ul><p>In source code:</p><ul><li><p>More flexible.</p></li><li><p>Better when scaling to multiple databases, as sometimes the relation can be cross-database.</p></li><li><p>More control over data integrity. The database doesn&#39;t have to check every time the application modifies data (complexity can be O(n) or O(n log n) (?)). Instead, it&#39;s delegated to application. And I think handling data integrity in the application will lead to more verbose error messages than using the database. Eg: when you create an API server, if you define the relations in the database, and something goes wrong (like the referenced entity doesn&#39;t exist), you will get an SQL Exception with a message. The simple way will be to return 500 to the client that there is an &#34;Internal server error&#34; and the client will have no idea what is going wrong. Or the server can parse the message to figure out what&#39;s wrong, which is an ugly, error-prone way in my opinion. If you let the application handle this, the server can generate a more meaningful message to client.</p></li></ul><p>Is there anything else?</p><p>Edit: as Kilian points out, my point about performance &amp; data integrity is very misguided. So I edited to correct my point there. I totally understand that letting the database handle it will be a more efficient and robust approach. Please check the updated question and give some thoughts about it.</p><p>Edit: thank you everyone. The answers I received all point out that the constraints/relations should be defined in the database. :). I have one more question, as it is quite out of scope of this question, I&#39;ve just posted it as a separate question: <a href="https://softwareengineering.stackexchange.com/questions/334689/handle-database-error-for-api-server">Handle database error for API server</a>. Please leave some insights.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>TL;DR: Relationship constraints should go in the database.</strong></p><hr/><p><strong>Your application ain&#39;t big enough.</strong></p><p>You are correct, indeed, that enforcing relationships across databases <em>may</em> require enforcing them in the application.</p><p>I would point out, however, that you should first check the documentation of the database software you are using, and check existing product offers. For example, there are clustering offers on top of Postgres and MySQL.</p><p>And even if you end up needing to have <em>some</em> validation in the application, <strong>don&#39;t throw out the baby with the bath water</strong>. After all, the less you have to do, the better off you are.</p><p>Finally, if you are worried about future scalability issues, I am afraid that your application will have to undergo significant changes before it can scale anyway. As a rule of thumb, every time you grow 10x, you have to re-design... so let&#39;s not sink too much money into failing to anticipate scalability issues, and instead use money to actually reach the point where you have those issues.</p><p><strong>Your application ain&#39;t correct enough.</strong></p><p>What is the chance that the database you use have a faulty implementation of the check compared to the chance that <em>your application</em> has a faulty implementation of the check?</p><p>And which one do you alter most often?</p><p>I&#39;d bet on the database being correct, <em>any time</em>.</p><p><strong>Your developers ain&#39;t thinking distributed enough.</strong></p><blockquote><p>Reduce network round trip to application when insert/update data as application has to make more query(s) to check data integrity.</p></blockquote><p><strong>Red Flag</strong>!<sup>1</sup></p><p>If you are thinking:</p><ul><li>check if the record exists</li><li>if not, insert record</li></ul><p>then you <em>failed</em> the most basic concurrency issue: another process/thread might be adding the record as you go.</p><p>If you are thinking:</p><ul><li>check if the record exists</li><li>if not, insert record</li><li>check if the record was inserted as a duplicate</li></ul><p>then you <em>failed</em> to account for MVCC: the view of the database that you have is a snapshot at the time your transaction started; it does <em>not</em> show all the updates that are occurring, and maybe not even committed.</p><p>Maintaining constraints across multiple sessions is a really hard problem, be glad it&#39;s solved in your database.</p><p><sup>1</sup> <em>Unless your database properly implements the Serializable property; but few actually do.</em></p><hr/><p>Last:</p><blockquote><p>And I think, handle data integrity in application will let to more verbose error message than using database. Eg: when you create an API server. If you define relations in database, and something go wrong(like the referenced entity doesn&#39;t exist), you will get an SQL Exception with message.</p></blockquote><p><strong>Do not parse error messages</strong>, if you use any production-grade database it should return structured errors. You&#39;ll have some error code, at least, to indicate what is possibly wrong, and based on this code you can craft a suitable error message.</p><p>Note that most of the times the code is enough: if you have an error code telling you that a referenced foreign key does not exist, then it&#39;s likely that this table only has one foreign key, so you know in the code what the problem is.</p><p>Also, and let&#39;s be honest here, most of the times you will not handle errors that gracefully anyway. Just because there are so many of them and you&#39;ll fail to account for them all...</p><p>... which just ties in to the <em>correctness</em> point above. Each time you see a &#34;500: Internal Server Error&#34; because a database constraint fired and was not handled, it means the database saved you, since you just forgot to handle it in the code.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../when-should-a-database-table-be-broken-into-multiple-tables-with-relations/'>When should a database table be broken into multiple tables with relations</a></li><li class="list-group-item"><a href='../php-should-i-encrypt-data-in-database/'>Php &#8211; Should I encrypt data in database</a></li><li class="list-group-item"><a href='../what-happened-to-database-constraints/'>What happened to database constraints</a></li><li class="list-group-item"><a href='../database-breaking-up-a-monolith-into-soa-and-breaking-referential-integrity/'>Database &#8211; Breaking up a monolith into SOA, and breaking referential integrity</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>