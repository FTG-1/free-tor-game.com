<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Should the classes have separate constructors just for unit testing &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1066891 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1066891" class="post-1066891 software type-software status-publish hentry category-software tag-c tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Should the classes have separate constructors just for unit testing</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">unit testing</span></p><div class="entry-content"><p>I like to write classes with two constructors: a primary constructor used in production code, and a default constructor just for unit tests. I do this because the the primary constructor creates other concrete dependencies that consume external resources. I can&#39;t do all that in a unit test.</p><p>So my classes look like this:</p><pre><code>public class DoesSomething : BaseClass
{
    private Foo _thingINeed;
    private Bar _otherThingINeed;
    private ExternalResource _another;

    public DoesSomething()
    {
        // Empty constructor for unit tests
    }

    public DoesSomething(string someUrl, string someThingElse, string blarg)
    {
         _thingINeed = new Foo(someUrl);
         _otherThingINeed = Foo.CreateBar(blarg);
         _another = BlargFactory.MakeBlarg(_thingINeed, _otherThingINeed.GetConfigurationValue(&#34;important&#34;);
    }
}
</code></pre><p>This is a pattern I follow with many of my classes so that I can write unit tests for them. I always include the comment in the default constructor so others can tell what it&#39;s for. Is this a good way to write testable classes or is there a better approach?</p><hr/><p>It was suggested that this might be a duplicate of &#34;Should I have one constructor with injected dependencies and another that instantiates them.&#34; It&#39;s not. That question is about a different way to create the dependencies. When I use the default unit test constructor the dependencies don&#39;t get created at all. Then, I make most methods public and they don&#39;t use the dependencies. Those are the ones I test.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Never, ever create separate code paths for unit testing. Doing so defeats the purpose of unit testing because you&#39;re testing one code path in your unit tests and executing a different one in production.</p><p>For some reason that seems insufficient because I&#39;m just repeating parts of your question back to you. You already know you&#39;re executing different code in your unit tests. The comment you put in your constructor says that. It&#39;s like asking if it&#39;s appropriate to take someone else&#39;s cell phone because it belongs to them, not to you, and you want to have it.</p><p>Would an argument from consensus help? Don&#39;t do that because no one else does it. Someone who knows better will be shocked. Even worse, someone who doesn&#39;t know better might learn from it, which would be bad, because... I feel like I&#39;m still going in circles. But hopefully it carries some weight that other people say you shouldn&#39;t do that.</p><p>Perhaps I could show you that there is a better way: Dependency inversion and dependency injection. Dependency inversion means that you depend on abstractions (like interfaces) instead of concrete implementations. That&#39;s impossible if your class is creating its own dependencies, which is where dependency injection comes in.</p><p>Instead of creating instances of dependencies, you define abstractions that describe how your class needs to use them. For example, if <code>ExternalResource</code> is something you download files from, you could create an interface like this:</p><pre><code>public interface IFileStorage
{
    byte[] GetFile(string filePath);
}
</code></pre><p>Then you create your class like this:</p><pre><code>public class DoesSomething : BaseClass
{
    private readonly IFileStorage _fileStorage;

    public DoesSomething(IFileStorage fileStorage)
    {
        _fileStorage = fileStorage;
    }
}
</code></pre><p>Now you don&#39;t need a separate constructor. Your unit tests can call the <em>real</em> constructor and pass in a mock or a test double, which means an implementation of <code>IFileStorage</code> that returns exactly what you want it to. That way you can write tests for how your class behaves if the file contains this or that or nothing at all, without using an actual concrete implementation of <code>IFileStorage</code>.</p><p>For example, what if you want to see how your class behaves if <code>IFileStorage</code> returns an empty byte array? You could use a framework like <code>Moq</code> or just do this:</p><pre><code>public class FileStorageThatReturnsEmptyArray : IFileStorage
{
    public byte[] GetFile(string filePath)
    {
        return new byte[] {};
    }
}
</code></pre><p>Then your test subject looks like this:</p><pre><code>var subject = new DoesSomething(new FileStorageThatReturnsEmptyArray());
</code></pre><p>Isn&#39;t that better? Your unit tests are worth something because they test your class end-to-end, allowing it to behave exactly as it does in production.</p><p>True, in production you&#39;ll have a concrete implementation of <code>IFileStorage</code> instead of a test double. But the point is that to <code>DoesSomething</code> it&#39;s all the same. One <code>IFileStorage</code> is the same as another.</p><p>Is that a contradiction, since I just said that you should test the &#34;real&#34; code, but now I&#39;m recommending using mocks? No. The question was about unit tests, which means that you wanted to test <code>DoesSomething</code>, so you would use mocks to test <em>that class</em>. You could write additional unit tests for other classes or integration tests to test them together. In the scope of this answer, if you&#39;re going to test <code>DoesSomething</code> then the point is that you wouldn&#39;t want to deceive yourself by testing a non-production method of that class, thinking that it&#39;s the same as testing the production method. (&#34;Production&#34; and &#34;Non-production&#34; methods aren&#39;t even a thing.)</p><p>I hope that showing how other developers solved this problem helps.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-are-there-any-alternatives-to-dependency-injection-for-stateless-classes/'>C++ &#8211; Are there any alternatives to dependency injection for stateless classes</a></li><li class="list-group-item"><a href='../unit-testing-are-parsers-a-special-case-in-unit-testing/'>Unit-testing &#8211; Are parsers a special case in unit testing</a></li><li class="list-group-item"><a href='../unit-testing-tdd-with-layered-architecture-while-only-unit-testing-domain-logic/'>Unit-testing &#8211; TDD with layered architecture, while only unit testing domain logic</a></li><li class="list-group-item"><a href='../unit-testing-is-testing-behavior-of-many-classes-in-one-test-still-unit-testing/'>Unit-testing &#8211; Is testing behavior of many classes in one test still unit testing</a></li><li class="list-group-item"><a href='../unit-testing-how-should-i-unit-test-a-data-transfer-object/'>Unit-testing &#8211; How Should I Unit Test A Data Transfer Object</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>