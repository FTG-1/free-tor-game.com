<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Splitting large C++ project &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069249 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069249" class="post-1069249 software type-software status-publish hentry category-software tag-build-system tag-c"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Splitting large C++ project</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">build-system</span><span class="mr-2 badge badge-info">c</span></p><div class="entry-content"><p>Like it happens to many, our C++ project grew larger and larger, and it finally hit the point where maintainability starts to be a concern, mostly due to build times: even by using <code>ccache</code>, every change requires anywhere from 30 seconds to 5 minutes to rebuild and test (actually it seems that &#34;linking&#34; is the time-consuming phase, but we are still investigating).</p><p>The project consists mainly of a big scientific library, along with some applications which make use of it. For example, there are applications to augment simulation models, or language bindings (python) for integration into other software packages.</p><p>Now, it would seem natural to split the library into smaller libraries: the code is already organized in &#34;modules&#34;, so this would not be an issue. The problem is with dependency management: we can think of the whole project as a big <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" rel="noreferrer">DAG</a>, where each node is a library module, or external library (due of the project nature, there are many external dependencies on other scientific libraries).</p><p>So ideally, when working on a module, we would like to rebuild only that module, plus maybe the related test app, and link it with its dependencies. This would speed up the development cycle considerably.</p><p>Consequently, the idea is to handle each &#34;module&#34; as an independent project, that will be separately built into a (static) library. I have two concerns with this approach:</p><ul><li>Imagine that I am working on app A that depends on library B, which itself depends on library C. During development, I find that I need a new feature in library C, so I go ahead and code that. I now have to manually rebuild library C, then library B and finally library A before continuing with the development. When the dependency chain grows larger, this can be problematic.</li><li>If the dependencies of one module change, how to manage the impact on the whole DAG (other modules that change as a consequence)?</li></ul><p>I have been researching into several tools that might assist with my scenario. <a href="https://stackoverflow.com/questions/7813030/how-can-i-have-linked-dependencies-in-a-git-repo">Git submodules</a> is one option, but it does not address my concerns above. <a href="https://en.wikipedia.org/wiki/Apache_Ivy" rel="noreferrer">Apache Ivy</a> seems not suitable for what I am trying to achieve. I suspect that the answer involves some powerful build system (we are using <a href="http://doc.qt.io/qt-5/qmake-manual.html" rel="noreferrer">qmake</a>), so I looked into <a href="https://cmake.org/" rel="noreferrer">cmake</a> (but I found its scripting language limited and hard to learn), and then <a href="https://buckbuild.com/" rel="noreferrer">buck</a> and <a href="https://www.pantsbuild.org/" rel="noreferrer">pants</a>.</p><p>I am still unsure if this is the way to go, so I would be grateful if someone could share advice and/or experiences.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You mention static libraries in your question. I&#39;m guessing (perhaps wrongly) that you code a program for Linux.</p><p>You should <strong>use shared libraries</strong> when possible. Then you need much less linking time (at the expense of runtime linking, which usually is fast enough, at start time).</p><blockquote><p>During development, I find that I need a new feature in library C, so I go ahead and code that. I now have to manually rebuild library C, then library B and finally library A before continuing with the development.</p></blockquote><p>This should not be the case with shared libraries (as long as their API did not change).</p><p>Consider perhaps some architecture using <a href="https://en.wikipedia.org/wiki/Plug-in_(computing)" rel="noreferrer">plugins</a>, and which <a href="https://en.wikipedia.org/wiki/Dynamic_loading" rel="noreferrer">dynamically loads</a> them (e.g. with <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/dlopen.html" rel="noreferrer"><code>dlopen</code></a> on POSIX).</p><blockquote><p>it seems that &#34;linking&#34; is the time-consuming phase</p></blockquote><p>You need to be sure that is the case (e.g. by <a href="https://gcc.gnu.org/onlinedocs/gcc/Developer-Options.html" rel="noreferrer">passing</a> <code>-time</code> or even <code>-ftime-report</code> to <code>g++</code>). Then you might use the <a href="https://en.wikipedia.org/wiki/Gold_(linker)" rel="noreferrer">gold linker</a> and/or <a href="https://gcc.gnu.org/wiki/Visibility" rel="noreferrer"><code>visibility</code></a> function <a href="https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html" rel="noreferrer">attribute</a> with <code>g++</code>.</p><p>Be sure that the APIs of your sub-modules or libraries don&#39;t change often.</p><p><strong>Avoid too <em>small</em> C++ source files</strong>, e.g. prefer having ten C++ source files of two thousand lines each rather than a hundred C++ source files of only a two hundreds lines each. A C++ source file can define and implement several (related) functions or classes. Remember that C++ don&#39;t have modules, and that most standard headers (and your own ones) are quite big files  (for example <code>#include &lt;vector&gt;</code> expands to about 10KLOC on my Linux desktop); what counts for compilation time is the size of preprocessed form, and template expansions need a lot of time too. See also <a href="https://softwareengineering.stackexchange.com/a/323745/40065">this</a>.</p><p>BTW, you also need to <strong>use a good <a href="https://en.wikipedia.org/wiki/Build_automation" rel="noreferrer">build automation</a> tool</strong> (such as <a href="http://ninja-build.org/" rel="noreferrer">ninja</a>, <a href="https://www.gnu.org/software/make" rel="noreferrer">GNU make</a> - with parallelisation enabled thru <code>make -j 8</code>, etc...). You could also use distributed build tools (<a href="https://github.com/distcc/distcc" rel="noreferrer">distcc</a>, <a href="https://github.com/icecc/icecream" rel="noreferrer">icecream</a>, ...)</p><p>You might also (with <a href="http://gcc.gnu.org/" rel="noreferrer">GCC</a>) consider using a <a href="https://stackoverflow.com/a/12438040/841108">precompiled header</a>. Then, you&#39;ll probably want to have a single header file including all the other ones. You might want to use the <a href="https://en.wikipedia.org/wiki/Opaque_pointer" rel="noreferrer">PIMPL idiom</a>.</p><p>See also <a href="https://softwareengineering.stackexchange.com/a/360106/40065">this answer</a> to a relevant question.</p><hr/><blockquote><p>every change requires anywhere from 30 seconds to 5 minutes to rebuild and test</p></blockquote><p>BTW, a five minute incremental build time seems rather small to me. Why are you complaining? I&#39;m old enough to have had in the 1990s, on powerful Sun workstations of that time, build times of almost an hour (for a software of a few hundred thousands lines I wrote alone during several years). And I sometimes contribute to GCC itself even these years, whose rebuild time takes several hours.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-big-project-with-many-external-libraries-source-code-organisation/'>C++ &#8211; Big project with many external libraries &#8211; source code organisation</a></li><li class="list-group-item"><a href='../for-which-problems-are-dependency-exclusions-sensible-solutions/'>For which problems are dependency exclusions sensible solutions</a></li><li class="list-group-item"><a href='../c-best-practice-of-c-c-dependency-management-on-build-servers/'>C++ &#8211; Best practice of c/C++ dependency management on build servers</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>