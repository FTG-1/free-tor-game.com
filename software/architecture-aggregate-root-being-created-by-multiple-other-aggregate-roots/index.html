<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; Aggregate root being created by multiple other aggregate roots &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1083940 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1083940" class="post-1083940 software type-software status-publish hentry category-software tag-aggregate tag-architecture tag-domain-driven-design tag-entity"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; Aggregate root being created by multiple other aggregate roots</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aggregate</span><span class="mr-2 badge badge-info">Architecture</span><span class="mr-2 badge badge-warning">domain-driven-design</span><span class="mr-2 badge badge-primary">entity</span></p><div class="entry-content"><p>I know the title is confusing, I didn&#39;t how to word it.</p><p>I&#39;m studying the Domain Driven Design (DDD) and I&#39;m reading the book &#34;NET Microservices Architecture for Containerized NET Applications&#34; from microsoft and I can&#39;t understand well how to identify the aggregate roots.</p><p>In the book they use an example with an Order being the aggregate root and OrderItem being a child entity:<br /> <a href="../../../i.stack.imgur.com/jWm81.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/jWm81.png" alt="Order aggregate example"/></a></p><p>If I understand it correctly the OrderItem has a ProductId which identifies a product that should be another Aggregate Root if I&#39;m not mistaken (note that in the <a href="https://github.com/dotnet-architecture/eShopOnContainers" rel="nofollow noreferrer">source</a> provided by the book there is no Product Aggregate and the product does not exist in the model, but I suppose it&#39;s for simplicity).</p><p>Now I expose the problem imagine we have an Aggregate Root TaxesDetail which OrderItem has a reference to it, and this TaxesDetail is added with the taxes of the product and the taxes of the buyerID and some other values when creating an OrderItem. If only the OrderItem could create the TaxesDetail then TaxesDetail will simply be a child entity, but if we have an Aggregate Root of an Offer that has an OfferItem (with some different field than OrderItem) which in turns have a TaxesDetail then what should the TaxesDetail be?<br /> An AggregateRoot?<br /> A Child Entity? If it&#39;s a child entity then we would have to create an OrderTaxesDetail and an OfferTaxesDetail which will duplicate the code.</p><p>This is just an example but what I&#39;m trying to understand is the concept of Aggregate Root, how to identify one, if it&#39;s possible that multiple Aggregates Root can create the same Aggregate Root&#8230;</p><p>Thanks</p><p><strong>EDIT</strong></p><p>An edit to respond @Christophe since a comment can&#39;t be too long.</p><p>In the case of identity I think if you change and OrderDetail you can just delete the old TaxesDetail and create a new one, I don&#39;t think there is a need to keep track of the older TaxesDetail.</p><p>Now I see how it is a Value Object. In the first point, we can see that it&#39;s <strong>lifespan</strong> is entirely dependant on the Aggregate Roots of OrderDetail and OfferDetail. In the second point, we can see it&#39;s <strong>immutable</strong> if, for example, an OrderDetail it&#39;s changed the TaxesDetail won&#39;t change, the TaxesDetail will be destroyed and constructed with the new properties.</p><p>As you said I had in mind the implementation considerations and how the model was constructed, I didn&#39;t start my design from a domain approach and I was mixing the domain layer with the persistence layer. I should pay more attention the next time.</p><p>Thanks for your help!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h2>First things first</h2><blockquote><p>imagine we have an Aggregate Root TaxesDetail which OrderItem has a
 reference to it, ...</p></blockquote><p>First, take a deep breadth in.  What makes you think that a <code>TaxesDetail</code> could be an aggregate root in the first place ?  And what would be the aggregate ?</p><blockquote><p>If only the OrderItem could create the TaxesDetail then TaxesDetail
 will simply be a child entity, but if we have an Aggregate Root of an
 Offer that has an OfferItem (with some different field than OrderItem)
 which in turns have a TaxesDetail then what should the TaxesDetail be?</p></blockquote><p>Why should it be a an aggretate root ?  What makes a tax detail ?  Does the tax detail have an identity in the first place ?</p><h2>Basic DDD concepts</h2><p>Let&#39;s look at 3 core definitions in Evan&#39;s seminal DDD book:</p><blockquote><p><strong>AGGREGATE</strong>: A cluster of associated objects that are treated as a unit for the purpose of data changes. External references are
 restricted to one member of the AGGREGATE, designated as the root. A
 set of consistency rules applies within the AGGREGATEâ€™S boundaries.</p></blockquote><p>Is a <code>TaxesDetail</code> changed independently of the <code>OrderDetail</code> or <code>OfferDetail</code> to which it is related ?  Or isn&#39;t the <code>TaxeDetails</code> consistency rules related to something else which is already in another aggregate ?  Honestly, I seriously doubt that this could be an aggregate root.</p><blockquote><p><strong>ENTITY</strong>: An object fundamentally defined not by its attributes, but by a
 thread of continuity and identity.</p></blockquote><p>Does a <code>TaxesDetail</code> have its own identity ?  Or asked in another way:  suppose I&#39;d change an <code>OrderDetail</code>:  could I just delete the old <code>TaxesDetail</code> and create a new one with the new value, or is it vital that I keep track of the old TaxesDetail and modify its attributes ?</p><blockquote><p><strong>VALUE OBJECT:</strong> An object that describes some characteristic or attribute but carries no concept of identity.</p></blockquote><p>So what is a TaxesDetail in the end ?  Is it just a taxe code (that defines the rates) and a tax value calculated for an item ?  In this case it would be a value object that refers to a <code>TaxCode</code>.  If you need however to keep the history, it could be an entity in the <code>Order</code> aggregate.</p><h2>Advice</h2><p>DDD starts with DOMAIN. And so must you.  Start your design from a domain approach. Don&#39;t let implementation considerations and reuse fool you:</p><ul><li><p>Here, you were mislead by seeing a <code>TaxesDetail</code> as something that is as well related to and <code>OrderItem</code> as to an <code>OfferItem</code>.  In fact, you take an implementation perspective and see the similarities, assuming that it is the same thing.</p></li><li><p>But if we look at the domain from a business perspective, a tax detail in an offer is purely virtual.  No taxes are due, because nothing guarantees that the offer will be transformed in order. At this stage it&#39;s only a calculated value.</p></li><li><p>Later, when the order is passed, the tax item could start to matter, depending on the jurisdiction, because there is a confirmed business transaction.  If you take taxes like VAT, the order tax would still be an indicated value, since the event that makes the tax item a tax liability item is the earliest of either the delivery or the payment.</p></li></ul><p>So in conclusion, look at your objects independently of any implementation consideration. Check if the object has an identity, and then only look at the clustering in aggregate root.  Only afterwards should you enter into details of which method and property to put where.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../domain-services-vs-factories-vs-aggregate-roots/'>Domain Services vs. Factories vs. Aggregate Roots</a></li><li class="list-group-item"><a href='../c-ddd-identifying-aggregate-root-in-a-simple-example-application-domain/'>C# &#8211; DDD: Identifying aggregate root in a simple example application domain</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>