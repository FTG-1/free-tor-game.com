<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; WPF, Dialog Service as injectable Service or a Static class &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077495 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077495" class="post-1077495 software type-software status-publish hentry category-software tag-c tag-design-patterns tag-wpf"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; WPF, Dialog Service as injectable Service or a Static class</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">wpf</span></p><div class="entry-content"><p><strong>The background</strong></p><p>In MVVM, we tend &#34;not&#34; want to couple windows to view models for various reasons. Though from the very second screen on your application you start hitting this conceptual grey zone.</p><p><strong>The problem</strong></p><p>You see viewmodals tend to want to open windows/Views (its just a fact of life). Windows/dialog APIs tend to like an Owner, because thats just the nature of the Windows Operating system. As can be seen here <a href="https://msdn.microsoft.com/en-us/library/system.windows.window.owner(v=vs.110).aspx" rel="nofollow noreferrer"><code>Window.Owner</code></a></p><blockquote><p>When a child window is opened by a parent window by calling<br /> ShowDialog, an implicit relationship is established between both<br /> parent and child window. This relationship enforces certain behaviors,<br /> including with respect to minimizing, maximizing, and restoring.</p></blockquote><p>This all creates a bit of a dilemma where Viewmodals are natively disconnected from their view/window hence you have to use some sort of decoupled messaging event aggregation, or some other logic to couple the dialog relationship.</p><p>At this point people use frameworks or other regimes which basically consist of weird and contrived world of DI/IOC, view constructors, locators, messages or event aggregation to do all the coupling, spinning up of viewmodals and so forth and keeping the MVVM police happy.</p><p><strong>The current solve</strong></p><p>In the current projects im working on, the principle developer has solved this problem with using typed decoupled messages (pub/sub), which gets picked up in a view constructor with an application wide view mapping regime that maps these messages to view to windows, converts and passes objects to the newly created view models through more messages in what can only be called more spurious plumbing, and at the end of the dialog lifecyles passes back out parameters back into the original typed message which can then be probed bythe original caller.</p><p>This is all very messy (IMO) overly complicated overly engineered and inadequacy designed.</p><p><strong>Dialog Service</strong></p><p>I guess this where the notion of a dialog service comes in. A simple Fluent library that can use viewmaps or implicitly coupled commands to call, spinup windows.</p><pre><code>// Modal Dialog no results
_dialogService.Dialog&lt;Window1Vm&gt;(this)
              .OnInit(vm =&gt; vm.SomeProperty = false)
              .ShowDialog();

// Dialog with some results  
var someResult = _dialogService.Dialog&lt;Window1Vm&gt;(this)
                               .OnInit(vm =&gt; vm.SomeProperty = false)
                               .ShowDialog();

// Dialog with some input params
var someResult = _dialogService.Dialog&lt;Window1Vm&gt;(this)
                               .WithParams(new SomeParamsToPassIn())
                               .ShowDialog();

// And the one the &#34;decoupled police&#34; will be wanting to arrest me for
// Dialog with explicit notation to map a view to a viewmdal
// (I know i should be shot and fed to the wolves)
var dialog1 = _dialogService.Dialog&lt;Window1Vm, Window1&gt;(this)
                            .OnInit(vm =&gt; vm.SomeProperty = false)
                            .ShowDialog();
</code></pre><p>My question is now, should this be an injectable service, or a static class</p><p>The advantages of an injectable service is that, ViewModals and code who need access to this, can just ask for it. Its easy to see who is implimenting this functionatlity via the constructor</p><p>The disadvantages is if you have lists of lists of vms and something in the child list needs to open a window you have to inject it into all the child viewmodals or once again send a message back.</p><p>The advantages of being a static class, is you can call it everywhere, kind of like a true UI cross cutting concern.</p><hr/><p>Personally i think the DI service is the way to go, it has no state logic i.e it can be a singleton. However i have had several comments about this approach (from mainly the principle developer) that messages are just better and it can be called from anywhere, also that static is bad mmkay.</p><p>However i just want to get opinions about if logic, like does this sit better as an injectable service, a static library, or in other peoples experience that might sugest having a totally decouple system like we have is actually a better approach in large systems and the long term</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your current approach sounds like the Mediator Pattern. Which is a recognised solution to this kind of problem and several other cross ViewModel communication issues.</p><p>However, I do agree that it can get messy. especially with something as simple as wanting to open a new window and you have them everywhere.</p><p>Indeed in the thing I am currently working on we use a (professional looking) third party MessageBox which uses a static method. I really would not recommend this though as its a nightmare to test.</p><p>Here is an alternate approach, which allows you to keep the binding in XAML and the View Model Creation and event firing in the ViewModel</p><p>So we have a Behaviour with an Action DependencyProperty that can be bound to:</p><pre><code>public class OpenWindowBehaviour : Behavior&lt;Control&gt;
{
    public Type TypeOfWindow { get; set; }

    public Action&lt;object&gt; OpenWindowWithVM
    {
        get { return (Action&lt;object&gt;)this.GetValue(OpenWindowWithVMProperty); }
        set { this.SetValue(OpenWindowWithVMProperty, value); }
    }

    public static readonly DependencyProperty OpenWindowWithVMProperty = 
        DependencyProperty.Register(
            &#34;OpenWindowWithVM&#34;, 
            typeof(Action&lt;object&gt;), 
            typeof(OpenWindowBehaviour), 
            new PropertyMetadata(null)
            );

    protected override void OnAttached()
    {
        base.OnAttached();
        this.AssociatedObject.Loaded += AssociatedObject_Loaded;
    }

    private void AssociatedObject_Loaded(object sender, RoutedEventArgs e)
    {
        this.OpenWindowWithVM = OpenWindow;
    }

    private void OpenWindow(object ViewModel)
    {
        var constructor = TypeOfWindow.GetConstructors()[0];
        var w = constructor.Invoke(new object[] { }) as Window;
        w.DataContext = ViewModel;
        w.Show();
    }
}
</code></pre><p>We have to wait for the Loaded event, which comes after binding so we can set the bound Action to be our Open New Window code.</p><p>Now in our ViewModel we have an Action &#39;event&#39; and a ICommand which we are going to bind to a button. When the button is pressed we are going to &#39;Move to the next stage&#39; raising our StageChanged pseudo event to which we pass the View Model for stage 2</p><pre><code>public class ViewModel : INotifyPropertyChanged
{
    public Action&lt;object&gt; StageChanged {
        get;
        set;
    }

    public ICommand MoveToNextStage { get; set; }

    public ViewModel()
    {
        MoveToNextStage = new DelegateCommand((o) =&gt;
        {
            if (this.StageChanged != null)
            {
                StageChanged( new Stage2VM());
            }
        });
    }

    public event PropertyChangedEventHandler PropertyChanged;
}
</code></pre><p>our xaml binds the two together, so that pressing the button fires the behaviours event.</p><pre><code>&lt;Window
namespaces.....
&gt;
    &lt;i:Interaction.Behaviors&gt;
        &lt;local:OpenWindowBehaviour 
            TypeOfWindow=&#34;{x:Type local:NewWindow}&#34; 
            OpenWindowWithVM=&#34;{Binding StageChanged, Mode=TwoWay}&#34;/&gt;
    &lt;/i:Interaction.Behaviors&gt;
    &lt;Grid&gt;
        &lt;Button Content=&#34;Click Me&#34; Command=&#34;{Binding MoveToNextStage}&#34;/&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;
</code></pre><p>(I&#39;m using Fody PropertyChanged for the boilerplate and Expression.Blend.Sdk for the Windows.Interactivity Behaviours)</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../who-should-control-navigation-in-an-mvvm-application/'>Who should control navigation in an MVVM application</a></li><li class="list-group-item"><a href='../c-how-to-use-a-messagebox-using-the-mvvm-pattern/'>C# &#8211; How to use a MessageBox using the MVVM pattern</a></li><li class="list-group-item"><a href='../c-net-mvvm-software-architecture-and-naming-conventions/'>C# .NET MVVM software architecture and naming conventions</a></li><li class="list-group-item"><a href='../c-mvvm-with-di-view-model-location-and-shared-service-data/'>C# &#8211; MVVM with DI, view model location and shared service data</a></li><li class="list-group-item"><a href='../wpf-mvvm-loading-data-on-startup/'>WPF MVVM Loading data on startup</a></li><li class="list-group-item"><a href='../wpf-usercontrol-reuse-with-mvvm/'>WPF UserControl Reuse With MVVM</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>