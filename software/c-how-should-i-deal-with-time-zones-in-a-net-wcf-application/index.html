<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; How should I deal with Time Zones in a .NET WCF application &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072991 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072991" class="post-1072991 software type-software status-publish hentry category-software tag-c tag-net tag-time tag-wcf tag-windows-registry"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; How should I deal with Time Zones in a .NET WCF application</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">net</span><span class="mr-2 badge badge-warning">time</span><span class="mr-2 badge badge-primary">wcf</span><span class="mr-2 badge badge-danger">windows-registry</span></p><div class="entry-content"><p>Our company runs a SaaS application where users log in from across the world (although mostly in the US).  We store all our time relevant information as UTC, but we need to display times using local time.  The application is web based, and we would like to &#34;auto-detect&#34; the user&#39;s Time Zone by using javascript to determine their UTC offsets during various times of the year.  The user&#39;s offset info would be passed to our server in their first request and the server will look up all the Time Zones that it knows about and see which valid time zones match.</p><p>I&#39;d like to use the built in TimeZoneInfo object, but I understand that</p><pre><code>TimeZoneInfo.GetSystemTimeZones();
</code></pre><p>relies on the server&#39;s registry settings.  We currently have 18 load balanced web servers that host our WCF service layer, and I <em>believe</em> our TechOps team is vigilant in making sure that all servers are patched with the same service pack at all times.</p><p>I also need to pay special attention to the various US Time Zones, specifically Pacific, Mountain, Central and Eastern.  Can I assume that the string based Id field will <em>not</em> change anytime soon?  For example, if I call</p><pre><code>TimeZoneInfo.FindSystemTimeZoneById(&#34;Pacific Standard Time&#34;)
</code></pre><p>I want the appropriate TimeZoneInfo object to be returned.</p><p>So a few questions:</p><ul><li>What is the best way to deal with time zones, especially when it comes to the changing rules (US time zone rules changed in 2006) and determining offsets.  Should I be trying something else?  Keep in mind that the product team doesn&#39;t want the user to have to select their time zone and they are fine with time zones being inaccurately reported under certain  conditions (e.g. if the user is in Mexico, it is ok to be reported as &#34;Pacific Standard Time&#34; instead of the more accurate &#34;Pacific Standard Time (Mexico)&#34;.</li><li>If I assume that all of our load balanced web servers are always running the same OS version and patch level, can I assume that I will get consistent results?</li><li>Are there any other things I need to consider?</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I think you&#39;re on the right track with using the built in TimeZoneInfo class.  The ID should never change, but the name will (I learned that lesson the hard way when several changed between xp and vista).  I have used a virtually identical approach (UTC only at the service and db layers, local time on the web server &amp; client) and it worked just fine.</p><p>One thing I suggest is to wrap the various TimeZoneInfo methods you intend to use with an interface <code>ITimeZoneConverter</code> or something of that nature, that way if you need to change your implementation later, it should be easier to do.</p><p>Random Annoyance:  The .Net TimeZoneInfo class can&#39;t give you an abbreviation given a timezone.  IE: No &#34;EST&#34; for &#34;Eastern Standard Time&#34;, so if you need that, plan on having a lookup into some sort of resource file or table for that.</p><p>Javascript won&#39;t actually be able to tell you the timezone, just the timezone offset from UTC.   It&#39;s a subtle difference, and in your case it sounds like it won&#39;t matter, but it&#39;s something to keep in mind when looking at what timezones get assigned to your users.</p><p>I have seen some <a href="http://www.pageloom.com/automatic-timezone-detection-with-javascript" rel="nofollow noreferrer">JS libraries such as this one</a> which attempt to guess the timezone on the client side based on offset and most populated timezones.  It is an interesting approach, but I don&#39;t know how well it would work in production.</p><p>Finally, one thing that bit me in the past was that JSON doesn&#39;t actually specify anything about how to format datetimes. (<a href="https://stackoverflow.com/questions/206384/how-to-format-a-json-date">related reading</a>)  If you&#39;re doing a lot of ajax/async requests and intend to convert back and forth between utc &amp; local times, this can be painful.  Make sure you write some good common parsing/offsetting functions and make sure everyone on your team is aware of them and doesn&#39;t re-invent the wheel every time when dealing with these issues.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../mvc-jquery-json-net-service-layer-to-wcf-or-not-to-wcf/'>Mvc &#8211; JQuery / JSON + .Net Service Layer &#8211; to WCF or Not to WCF</a></li><li class="list-group-item"><a href='../should-i-swap-from-wcf-to-nservicebus/'>Should I swap from WCF to NserviceBus</a></li><li class="list-group-item"><a href='../how-to-structure-an-application-that-combines-wcf-and-wpf/'>How to structure an application that combines WCF and WPF</a></li><li class="list-group-item"><a href='../how-to-make-a-legacy-system-time-zone-sensitive/'>How to make a legacy system time-zone sensitive</a></li><li class="list-group-item"><a href='../c-net-wcf-persistent-connection-or-open-close-as-needed/'>C# &#8211; .NET WCF: Persistent connection or Open/Close as needed</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>