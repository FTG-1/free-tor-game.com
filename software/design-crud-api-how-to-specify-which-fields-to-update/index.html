<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; CRUD API: How to specify which fields to update &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072168 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072168" class="post-1072168 software type-software status-publish hentry category-software tag-api tag-api-design tag-crud tag-design tag-web-services"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; CRUD API: How to specify which fields to update</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api</span><span class="mr-2 badge badge-info">api-design</span><span class="mr-2 badge badge-warning">crud</span><span class="mr-2 badge badge-primary">design</span><span class="mr-2 badge badge-danger">web services</span></p><div class="entry-content"><p>Let&#39;s say you have some kind of data structure, which is persisted in some kind of database. For simplicity, let&#39;s call this data structure <code>Person</code>. You are now tasked to design a CRUD API, which allows other applications to create, read, update and delete <code>Person</code>s. For simplicity, let&#39;s assume that this API is accessed via some kind of web service.</p><p>For the C, R and D parts of CRUD, the design is simple. I&#39;ll use C#-like functional notation &#8211; the implementation could be SOAP, REST/JSON, or something else:</p><pre><code>class Person {
    string Name;
    DateTime? DateOfBirth;
    ...
}

Identifier CreatePerson(Person);
Person GetPerson(Identifier);
void DeletePerson(Identifier);
</code></pre><p>What about update? The natural thing to do would be</p><pre><code>void UpdatePerson(Identifier, Person);
</code></pre><p>but how would you specify <em>which</em> fields of <code>Person</code> to update?</p><hr/><p>Solutions that I could come up with:</p><ul><li><p>You could always require a <em>complete</em> Person to be passed, i.e. the client would do something like this to update the date of birth:</p><pre><code>p = GetPerson(id);
p.DateOfBirth = ...;
UpdatePerson(id, p);
</code></pre><p>However, that would require some sort of transactional consistency or locking between the Get and the Update; otherwise, you could overwrite some other change done in parallel by some other client. This would make the API much more complicated. In addition, it&#39;s error prone, since the following pseudo-code (assuming a client language with JSON support)</p><pre><code>UpdatePerson(id, { &#34;DateOfBirth&#34;: &#34;2015-01-01&#34; });
</code></pre><p>&#8212; which <em>looks</em> correct &#8212; would not only change DateOfBirth but also reset all other fields to null.</p></li><li><p>You could ignore all fields that are <code>null</code>. However, how would you then make a difference between <em>not changing</em> <code>DateOfBirth</code> and <em>deliberately changing it to null</em>?</p></li><li><p>Change the signature to <code>void UpdatePerson(Identifier, Person, ListOfFieldNamesToUpdate)</code>.</p></li><li><p>Change the signature to <code>void UpdatePerson(Identifier, ListOfFieldValuePairs)</code>.</p></li><li><p>Use some feature of the transmission protocol: For example, you could ignore all fields not contained in the JSON representation of the Person. However, that usually requires parsing the JSON yourself and not being able to use the built-in features of your library (e.g. WCF).</p></li></ul><p>None of the solutions seems really elegant to me. Surely, this is a common problem, so what is the best-practice solution used by everybody?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>If you don&#39;t have tracking of changes as requirement on this object (e.g. &#34;User John changed name and birth date&#34;), simplest would be to override whole object in DB with one you receive from consumer. This approach would involve slightly more data being send through wire, but you are avoiding read before update.</p><p>If you have activity tracking requirement. Your world is much more complicated and you will need to design how to store information about CRUD actions and how to intercept them. That is the world you don&#39;t want to dive into if you don&#39;t have such requirement.</p><p>As per overriding values by separate transactions, I would suggest to do research around <strong>optimistic</strong> and <strong>pessimistic locking</strong>. They mitigate this common scenario:</p><ol><li>Object is read by user1</li><li>Object is read by user2</li><li>Object written by user1</li><li>Object written by user2 and overwritten changes by user1</li></ol><p>Each user has different transaction, therefore standard SQL with this. Most common is <strong>optimistic locking</strong> (also mentioned by @SJuan76 in comment about versions). Your version your record in DB and during write you first take a look into DB if versions match. If versions don&#39;t match, you know somebody updated the object in the meantime, and you need to response with error message to consumer about this situation. Yes, you have to show this situation to user.</p><p>Notice that you need to read actual record from DB before writing it (for optimistic locking version comparison), so implementing delta logic (write only changed values) may not require additional read query before write.</p><p>Putting in delta logic highly depends on contract with consumer, but notice that easiest for consumer is to construct full payload instead of delta also.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-how-to-correctly-implement-keyvalue-storage-rest-api/'>Rest &#8211; How to correctly implement key=value storage REST API</a></li><li class="list-group-item"><a href='../rest-how-to-design-a-rest-api-to-handle-non-crud-operations/'>Rest &#8211; How to design a REST API to handle non-CRUD operations</a></li><li class="list-group-item"><a href='../rest-design-update-properties-on-an-entity-in-a-restful-resource-based-api/'>Rest &#8211; Design: Update properties on an entity in a RESTful, resource-based, API</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>