<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Programmatically extending Hibernate table/entity definitions in Spring, how &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069166 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069166" class="post-1069166 software type-software status-publish hentry category-software tag-aspect-oriented tag-hibernate tag-java tag-orm tag-spring"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Programmatically extending Hibernate table/entity definitions in Spring, how</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aspect-oriented</span><span class="mr-2 badge badge-info">hibernate</span><span class="mr-2 badge badge-warning">java</span><span class="mr-2 badge badge-primary">orm</span><span class="mr-2 badge badge-danger">spring</span></p><div class="entry-content"><p>I would like to know if there is a way —maybe with AOP— to extend table/entity definitions so that I can add functionality across the board that requires persistence.</p><p>Let me explain what I want to do with a concrete example. Let&#39;s suppose we have a simple ecommerce system:</p><ul><li>User<ul><li>id</li><li>name</li><li>password</li></ul></li><li>Item<ul><li>id</li><li>name</li><li>price</li><li>stock</li></ul></li><li>ShoppingCart<ul><li>id</li><li>user_id</li></ul></li><li>ShoppingCartItems<ul><li>id</li><li>shopping_cart_id</li><li>item_id</li></ul></li><li>Order<ul><li>id</li><li>shopping_cart_id</li></ul></li><li>Purchase<ul><li>id</li><li>order_id</li><li>invoice_number</li></ul></li></ul><p>Now, let&#39;s suppose that we think:</p><blockquote><p>hey, wouldn&#39;t it be great if we could add a field to timestamp all entities?</p></blockquote><p>You would now know things like:</p><ul><li>When a User registered</li><li>When an item was created</li><li>When a shopping cart was created</li><li>When an item was added to a shopping cart</li><li>When an order was placed</li><li>When was the order was processed and paid</li></ul><p>Now you have another great idea:</p><blockquote><p>What if there was a status field for all entities so I could soft-delete or archive items, etc.</p></blockquote><p>And yet another idea:</p><blockquote><p>What if there was a text field called <code>meta</code> to serialize unimportant data, but that could help adding functionality without painful database modifications.</p></blockquote><p>There are solutions I can think of (meeting relational integrity requirement):</p><ol><li><p>Of course, you would need to go back, change your tables, modify your implementations so that when creating/updated you save the <code>timestamp</code> of then operation, same for <code>status</code>, same for <code>meta</code>.</p></li><li><p>And a somewhat convoluted but very modular way. Create some sort of plugin, that creates a table that handles the field, and 1 pivot for each entity. And through events, associate the extended data to the existing entities accordingly.</p></li></ol><p>But what if&#8230; you could just tell Hibernate to extend the table definitions programmatically at run time, and add the persistence behaviors through something like AOP to inject functionality.</p><p>I actually did the first thing (programmatically extending table definitions outside existing implementation) in Doctrine successfully once, but I&#39;m just starting to learn Hibernate. OTOH, I&#39;m just starting to learn Spring and know the basics on AOP, so at least in my mind it is feasible to intercept Hibernate&#39;s configuration process where it understands table definitions.</p><p><strong>So, is this possible with Spring and Hibernate?, how?, can you provide an example?</strong></p><p><strong>Addendum</strong>: The problem is that I need to do this more than once, and it could come from anywhere. AOP was my answer to the multiple inheritance problem since extending classes would be too constrained, however, in the past I did it with Events and worked just as fine&#8230; IIRC the problem is that I had to hack Doctrine in order to do this to fire an event at the time between when the model description was being converted from configuration files into actual models.</p><p>AOP is not a must, just an idea for an approach if such an event or dependency injection mechanism is not already in place. Another approach could be mixins, but I come back to AOP as probably the most elegant solution.</p><p>The main requirement here is to not modify the original model&#39;s code.</p><p><strong>Disclaimer</strong>: I&#39;m not an expert on AOP but I&#39;m fairly familiar to the concepts.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>As far as I can tell, what you are describing can be trivially implemented with an Embeddable class and not need of AOP.</p><pre><code>@Embeddable
class Audit {
  Timestamp created;
  String createdBy;
  String updatedBy;
}
</code></pre><p>Then you can simply add your embeddable object within your entities.</p><pre><code>@Entity
class Order {
   @Embedded
   Audit audit;
}
</code></pre><p>Using inheritance, you might just as well make this available for a set of entities:</p><pre><code>@MappedSuperClass
class MotherOfAllEntities {
   @Embedded
   Audit audit;
}

@Entity
class ChildClass extends MotherOfAllEntities {
}
</code></pre><p>If the information being added is just audit information, as you seem to suggest in your post you may consider using something like <a href="http://docs.jboss.org/envers/docs/" rel="nofollow">Hibernate Envers</a> which seems to be an implementation of what you&#39;re apparently suggesting with your question</p><pre><code>@Entity
@Audited
class Order {
}
</code></pre><p>And Envers will make sure to store audit information about the entity in some other data structure.</p><p>Since Envers seem to be an implementation of something like what you want to do from scratch, you might just as well give it a look to their code and see how they did it, but yet again, if it is to implement what you described, to me it sounds like killing a fly with a bazooka.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-is-spring-hibernate-prefered-instead-of-ejb-3/'>Java &#8211; Is Spring + Hibernate prefered instead of EJB 3</a></li><li class="list-group-item"><a href='../java-best-practice-for-creating-views-in-spring-and-hibernate-web-application/'>Java &#8211; Best practice for creating views in spring and hibernate web application</a></li><li class="list-group-item"><a href='../why-were-annotations-introduced-in-spring-and-hibernate/'>Why were annotations introduced in Spring and Hibernate</a></li><li class="list-group-item"><a href='../audit-trails-and-entity-relationships/'>Audit trails and entity relationships</a></li><li class="list-group-item"><a href='../java-allowing-users-to-add-their-own-custom-fields-in-a-spring-mvc-hibernate-application-whats-an-ideal-approach/'>Java &#8211; Allowing users to add their own custom fields in a Spring MVC Hibernate application &#8211; What&#8217;s an ideal approach</a></li><li class="list-group-item"><a href='../best-practice-for-references-in-dtos-and-entities-in-spring/'>Best practice for references in DTOs and entities in Spring</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>