<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; Spring &#8211; rest API &#8211; How to unit test a rest API which gets data from another service &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082138 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082138" class="post-1082138 software type-software status-publish hentry category-software tag-mocking tag-spring tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; Spring &#8211; rest API &#8211; How to unit test a rest API which gets data from another service</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">mocking</span><span class="mr-2 badge badge-info">spring</span><span class="mr-2 badge badge-warning">unit testing</span></p><div class="entry-content"><p>I am new to rest API&#39;s as well as mocks. Please help me ..</p><p>I have a set of rest API&#39;s for which I need to write unit tests. rest API in turn calls another service , gets the JSON response and sends the response [data] back. Basically it&#39;s querying a list of master data&#39;s like users, suppliers , countries etc etc.</p><p>My question is how can I unit test this ?. Any sample code would help me to start ?</p><p>)</p><p>package mds;<br /> /* all imports removed here  */</p><p>Please note the below, this url refers to external service which returns the data to my rest API under test</p><p>**//external service uri from properties file example value in properties file</p><p>// <a href="https://svcdev7ows.lab1.com/Arches/search/select" rel="nofollow">https://svcdev7ows.lab1.com/Arches/search/select</a>?</p><pre><code>String archesURL = null;** 
</code></pre><p>@Value(&#34;${mds.arches.address}&#34;</p><p>@RestController</p><p>@RequestMapping(&#34;/api&#34;)</p><p>public class MasterdataSearchService<br /> {</p><pre><code>private static final long serialVersionUID = 1L;
private static final String USER_AGENT = &#34;Mozilla/5.0&#34;;
private final String[] excludeFields = { &#34;ir_classname&#34;, &#34;arches_type&#34; };
public static final String KeyRealm = &#34;realm&#34;;

public static final String MDSAdapterId = &#34;app.masterdataservice&#34;;
public static final String irClassName = &#34;ir_classname&#34;;
public static final String masterdataClassParameter = &#34;System.Base.MasterdataClassList.Register&#34;;

static Hashtable&lt;String, String&gt; pathToClassNameMap = new Hashtable&lt;String, String&gt;();

//external service uri from properties file

@Value(&#34;${mds.arches.address}&#34;)

String archesURL = null;

@Value(&#34;#{${mds.ir_class.path}}&#34;)
private Map&lt;String, String&gt; irClassNames;

static String searchOptions = &#34;arches.preview=false&amp;sort=score desc,DefaultRelevance desc&amp;wt=json&#34;;
static ClientHttpRequestFactory requestFactory;

@Autowired
private ResourceLoader resourceLoader;

@RequestMapping(value = &#34;data/{classObject}&#34;, method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
public @ResponseBody String getListOfClassObject (@PathVariable(&#34;classObject&#34;) String classObject,
                                                  @RequestParam(value = &#34;fields&#34;,required=false) List&lt;String&gt; fields,
                                                  @RequestParam(value = &#34;uniquename&#34;,required=false) String uniqueName,
                                                  @RequestParam(value = &#34;name&#34;,required=false) String name,
                                                  @RequestParam(value = &#34;rows&#34;,required=false) int rows) throws JSONException, Exception
{

    //hardcoded for better understanding
    String anId = &#34;71000003015&#34; ;  
    String client= &#34;ups&#34; ;      

    searchTerms.add(new SearchTerm(&#34;ir_classname&#34;, irClassNames.get(classObject)));

    if (!StringUtils.isEmpty(name)) {

        if (classObject.equals(&#34;commoditycodes&#34;)) {
            searchTerms.add(new SearchTerm(&#34;HierarchyPath&#34;, name));
        }
        else {
            searchTerms.add(new SearchTerm(&#34;Name&#34;, name));
        }
    }

    if (!StringUtils.isEmpty(uniqueName)) {
        searchTerms.add(new SearchTerm(&#34;UniqueName&#34;, uniqueName));
    }

    StringBuilder sb = new StringBuilder();


    sb.append(
        archesURL + searchOptions + &#34;&amp;adapter=&#34; + MDSAdapterId + &#34;&amp;tenant=&#34; + anId + &#34;.&#34; + client + &#34;&amp;q=&#34; + &#34;(&#34;);

    for (SearchTerm st : searchTerms) {
        sb.append(st.toString());
    }
    sb.append(&#34;)&#34;);

    if (rows &gt; 0) {
        sb.append(&#34;&amp;rows=&#34; + rows);
    }

    // Get only the fields specified by &#34;field&#34; query parameter
    // else get every fields for the object
    sb.append(getReturnFields(fields));

    JSONArray arr = getJSONArrayFromResponse(sendGet(sb.toString()));

    return arr.toString();

}
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Standard way is to create a mock of the class/method which calls the external service. This mock verifies that the request (URL) is correct and returns back a response - note that it doesn&#39;t call the external service.</p><p>You can do this by encapsulating this sendGet() into it&#39;s own service class with interface. In test code, you instantiate and inject mock implementation of this interface into the controller class instead of the real implementation one (which is used in production).</p><p>If you want an integration test instead of unit test, you can use something like <a href="http://wiremock.org/" rel="nofollow">WireMock</a> to create mock server which handles the external service. This is more work, but can detect more problems with your implementation.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-how-to-unit-test-the-rest-web-service/'>Unit-testing &#8211; How to unit-test the REST web service</a></li><li class="list-group-item"><a href='../unit-testing-should-we-write-a-unit-test-for-class-that-call-another-class-that-have-code-written/'>Unit-testing &#8211; Should we write a unit test for class that call another class that have code written</a></li><li class="list-group-item"><a href='../c-unit-test-for-void-which-copies-data-from-one-location-to-another/'>C# &#8211; Unit Test for Void which copies data from one location to another</a></li><li class="list-group-item"><a href='../unit-testing-how-to-avoid-the-need-to-unit-test-private-methods/'>Unit-testing &#8211; How to avoid the need to Unit test private methods</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>