<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; When should a function take a pointer for a collection to fill vs returning a pointer with a filled collection &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087324 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087324" class="post-1087324 software type-software status-publish hentry category-software tag-c tag-coding-style tag-functions tag-pointers"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; When should a function take a pointer for a collection to fill vs returning a pointer with a filled collection</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">coding-style</span><span class="mr-2 badge badge-warning">functions</span><span class="mr-2 badge badge-primary">pointers</span></p><div class="entry-content"><p>In C++ I frequently see these two signatures used seemingly interchangeably:</p><pre><code>void fill_array(Array&lt;Type&gt;* array_to_fill);
Array&lt;Type&gt;* filled_array();
</code></pre><p>I imagine there is a subtle difference, but I don&#39;t know what it is.<br /> Could someone explain when I might prefer one form over the other?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The first kind of signature is usually preferable.</p><p>The difference is that the second signature requires the array to be created inside the function. In particular, the second signature effectively requires the array to <strong>outlive the scope in which it was created</strong>. So what we&#39;re really comparing are these two snippets:</p><pre><code>function foo1() {
    Array&lt;Type&gt;* array = /* allocate memory and call constructors */
    fill_array(array);
    do_stuff_with_array(array);
    /* free memory and call destructors */
}

function foo2() {
    Array&lt;Type&gt;* array = filled_array(); /* allocation/constructors happen elsewhere */
    do_stuff_with_array(array);
    /* free memory and call destructors */
}
</code></pre><p>The second version is potentially problematic for a few reasons:</p><ol><li><p><strong>It&#39;s error prone.</strong> Functions which return pointers or references to something they created are very easy to get wrong, either in the form of undefined behavior or in the form of a completely unnecessary performance loss. Since you&#39;re working with raw pointers, it&#39;s easy to invoke undefined behavior by returning a pointer to a local variable that&#39;s no longer valid after the function has returned. If the array was being passed around as a regular object or a reference instead, you might suffer an expensive copy when <code>filled_array()</code> returns (the details of when this may or may not happen are complicated, see StackOverflow for all the gory details).</p></li><li><p><strong>You don&#39;t know how <code>filled_array()</code> allocated the memory for the array</strong>, so in principle you don&#39;t know how to deallocate it correctly. You may be able to get away with assuming it was allocated &#34;normally&#34;, but if you don&#39;t control the allocation yourself, you just don&#39;t know for sure. It&#39;s possible some custom allocator was used, and it&#39;s also possible the pointer was saved somewhere so that a totally different function can do the deallocation at a specific time later in the pipeline (I believe this is common in C libraries). While a function that accepts a pointer as an argument could theoretically do this, it&#39;s far less likely.</p></li><li><p><strong>Memory/object reuse.</strong> What if I already have memory allocated for an Array, or an actual Array, when it comes time to call <code>filled_array()</code>? Unfortunately, <code>filled_array()</code> controls both the memory allocation and the value generation logic, so it&#39;s going to allocate more memory whether or not you need it. If you have many functions like this in a row, you&#39;re potentially wasting a huge amount of time and memory on allocations that could be completely skipped if you instead accepted pointers or references to memory controlled by client code. Or more concisely: Avoid writing functions that decide how memory should be managed <em>and</em> do something else with that same memory. Single responsibility principle and all that.</p></li></ol><p>Of course, you <em>should</em> be passing the Array around by reference rather than pointer. And you should be using RAII objects (whether that means &#34;just an Array&#34; or a smart pointer to an Array) as much as possible so that all the allocation and deallocation is managed for you. But these arguments for creating the object at the correct scope still apply, since switching to references and RAII objects alone may only change correctness bugs into performance &#34;bugs&#34; (some of which move semantics can&#39;t automagically fix).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/c-what-are-pros-and-cons-of-using-temporary-references/'>C++ &#8211; What are pros and cons of using temporary &#8220;references&#8221;</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/the-purpose-of-arrays-in-c-when-pointers-could-have-done-the-job/'>The purpose of arrays in C, when pointers could have done the job</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/int-vs-int-n-vs-int-n-in-functions-parameters-which-one-do-you-think-is-better/'>Int * vs int [N] vs int (*)[N] in functions parameters. Which one do you think is better</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/why-are-large-amounts-of-magic-numbers-acceptable-in-css-and-svgs/'>Why are large amounts of magic numbers acceptable in CSS and SVGs</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-ny-difference-between-casting-and-calling-value-in-nullable-objects/'>C# &#8211; ny difference between casting and calling .Value in Nullable<T> objects</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-pre-increment-vs-post-increment/'>C++ &#8211; pre-increment vs. post-increment</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-why-is-accessing-elements-of-a-huge-dynamically-allocated-structure-a-lot-slower-than-a-small-dynamically-allocated-array-in-c/'>C++ &#8211; Why is accessing elements of a huge dynamically allocated structure a lot slower than a small dynamically allocated array in C++</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>