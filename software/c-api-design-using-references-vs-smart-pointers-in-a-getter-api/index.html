<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ API design: using references vs smart pointers in a getter API &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1083817 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1083817" class="post-1083817 software type-software status-publish hentry category-software tag-api-design tag-reference tag-smart-pointer"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ API design: using references vs smart pointers in a getter API</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api-design</span><span class="mr-2 badge badge-info">reference</span><span class="mr-2 badge badge-warning">smart-pointer</span></p><div class="entry-content"><p>I&#39;m trying to design an API for an object manager that registers and retrieves different related objects. When I want to retrieve an object, I can query it by its object id. I&#39;m wondering if I should be returning a smart pointer or a reference in this case. Here&#39;s code to fully illustrate the design and some associated scenarios:</p><pre><code>// relevant classes portions:
class ViewManager
{
   std::unordered_map&lt;int, std::shared_ptr&lt;cView&gt;&gt; mViews;
   cView &amp; getView(const uint32_t v){ return *mViews[v]; }
   std::shared_ptr&lt;cView&gt; getViewPtr(const uint32_t v){ return mViews[v]; }
}
class cView;

int main()
{
   // usage
   ViewManager &amp;viewman = ViewManager::getManager(context);
   viewman.getView(static_hash(&#34;window1&#34;)).doFirstThing(arg1, arg2);
   viewman.getView(static_hash(&#34;window1&#34;)).doSecondThing(something, arg1);
   viewman.getView(static_hash(&#34;window1&#34;)).doThirdThing(x,y,z);

   // the below function takes a std::shared_ptr&lt;cView&gt;
   someOtherFunctionSetView( viewman.getViewPtr(static_hash(&#34;window1&#34;));

}
</code></pre><p>My first question is, should I have getView() return the reference as it is now, or should it return the smart_ptr? In the reference&#39;s case, I feel it&#39;s more convenient to call .doFirstThing(), .doSecondThing(), versus writing out -&gt; to do this. And the -&gt; implies it might be null, so we should check first before using it.</p><p>But then when I need to pass the smart pointer to a function that requires it, I need to create a different getter, getViewPtr() in this case.</p><p>What are some pros and cons of doing only smart pointers, or doing it this way, or are there any other better ways to make usage of the API as clean as possible?</p><p>Another related question I have is, is there a better way of cleanly using this API instead of writing getView() for each line when calling those functions? I actually prefer it this way as it is big and bold that I&#39;m manipulating the same variable over and over. Alternatively, I could write a cView &amp;ref = getView() and use that. Although it would be more efficient, when writing blocks of these for multiple views, it breaks up the flow enough that it becomes harder to read I think? I&#39;ve also seen APIs that just do one getView() and string .doSomething().doSomethingElse().doSomethingElse(), which seems very foreign to me.</p><p>Are there any flaws to any of the designs aside from stylistic choice. As for stylistic choice is there an objective perspective of what would make one style more readable or maintainable vs. another style? Thank you in advance.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Relevant documentation:</p><ul><li><a href="https://en.cppreference.com/w/cpp/memory/shared_ptr/operator%2a" rel="nofollow noreferrer">https://en.cppreference.com/w/cpp/memory/shared_ptr/operator%2a</a></li><li><a href="https://en.cppreference.com/w/cpp/container/unordered_map/at" rel="nofollow noreferrer">https://en.cppreference.com/w/cpp/container/unordered_map/at</a></li><li><a href="https://en.cppreference.com/w/cpp/container/unordered_map/operator_at" rel="nofollow noreferrer">https://en.cppreference.com/w/cpp/container/unordered_map/operator_at</a></li></ul><hr/><p>Both methods appear to use the &#34;operator at&#34;, which is the square brackets (<code>operator[]</code>), sometimes called the indexing operator or subscript operator. This is different from the &#34;<code>.at()</code>&#34; method.</p><ul><li>When using operator-at (<code>[]</code>) on the unordered map, a lookup using a non-existent key will automatically insert a new tuple having the new key and a default value. In order to use operator-at (<code>[]</code>), the unordered map must <em>not</em> be const-qualified, as it requires modification just in case.</li><li>When using the at-method (<code>.at()</code>), a lookup using a non-existent key will throw an exception. The at-method can be used with unordered map whether it is const-qualified or not. This method does not alter the collection of keys owned by this unordered map.</li></ul><hr/><p>Because both methods appear to use the &#34;operator at&#34; (<code>[]</code>), the following applies:</p><ul><li>If the retrieval key doesn&#39;t already exist in the unordered map, a tuple is automatically inserted into the unordered map, using the retrieval key, and a default-constructed smart pointer having value of null.</li><li>If the retrieval key exists but the corresponding pointer is null, the behavior is undefined.</li><li>If the retrieved pointer is valid, the caller can use it.</li></ul><hr/><p>The differences between these methods:</p><ul><li><code>cView&amp; getView(...)</code><ul><li>It does not extend or protect the lifetime of the object while the caller (user) is using it.</li></ul></li><li><code>std::shared_ptr&lt;cView&gt; getViewPtr(...)</code><ul><li>It creates a shared ownership of that object; that shared ownership is handed back to the caller; the caller can potentially choose to keep it, even after the calling method finished. For example, the calling method can store the shared pointer somewhere that survives longer than the method&#39;s duration.</li><li>Therefore, it extends and protects the lifetime of the object.</li></ul></li></ul><hr/><p>Additional considerations if multithreaded execution can possibly occur in the application:</p><ul><li>Because the first variant <code>cView&amp; getView(...)</code> does not extend or protect the lifetime of the object, there is a possibility that the object could be destroyed by another thread which had access to the Manager and had the ability to cause the same object to be destroyed, while the caller (user) on the current thread is still using the object. Therefore, the first variant do not guarantee safety in multithreaded applications.</li><li>However, there are software coding styles in which all objects that are ever added to a Manager will live for at least as long as the Manager itself, only to be destroyed when the Manager&#39;s own destructor is invoked. When such software coding styles are applied, one could reason that for as long as the Manager itself is kept alive, that those objects owned by the Manager will also continue to be alive. Thus, the possibility of premature destruction and dangling reference may not occur in practice.</li></ul><p>These safety issues tend to require human analysis. Currently it is hard to automate such reasoning with automated source code analysis.</p><hr/><p>To reduce typing while doing the equivalent of <code>getView(...)</code>, you can choose to implement your own subscript operator on <code>ViewManager</code>. You can browse to the subscript operator implementation on <code>unordered_map</code> to see how it is done in the C++ standard library source code.</p><p>This is generally permissible, unless there is a possibility of confusion or ambiguity. For example, if <code>ViewManager</code> is responsible for managing two or more collections for different kinds of objects, then it would be inappropriate to implement your own subscript operator on <code>ViewManager</code>.</p><hr/><p>Fluent interface is what enables method chaining. One criteria for method chaining is that all of these &#34;chainable&#34; methods must be setters, not getters. The return type of these methods must be a reference to the object itself, in this case, <code>cView&amp;</code>. These methods will not be able to return something else.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../why-garbage-collection-if-smart-pointers-are-there/'>Why Garbage Collection if smart pointers are there</a></li><li class="list-group-item"><a href='../c-smart-pointers-inside-class-vs-normal-pointers-with-destructor/'>C++ &#8211; Smart Pointers inside class vs Normal Pointers with Destructor</a></li><li class="list-group-item"><a href='../object-oriented-gtkmm-manage-add-vs-smart-pointers/'>Object-oriented &#8211; gtkmm manage/add vs smart pointers:</a></li><li class="list-group-item"><a href='../object-oriented-factories-vectors-and-smart-pointers-design-question/'>Object-oriented &#8211; Factories, vectors and smart pointers &#8211; Design Question</a></li><li class="list-group-item"><a href='../c-when-should-i-use-string_view-in-an-interface/'>C++ &#8211; When should I use string_view in an interface</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>