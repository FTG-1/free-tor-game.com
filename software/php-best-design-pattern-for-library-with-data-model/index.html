<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; Best design pattern for library with data model &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085059 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085059" class="post-1085059 software type-software status-publish hentry category-software tag-design-patterns tag-php"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; Best design pattern for library with data model</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design-patterns</span><span class="mr-2 badge badge-info">PHP</span></p><div class="entry-content"><p>I am refactoring an old Codeigniter library to be php framework agnostic. There are these core parts:</p><ul><li><p>the connection object &#8211; this will come from the &#34;user&#34;; ie, the framework&#39;s connection, or their own connection library. My library will not want to &#34;know about it&#34; except that (at first) it will be a PDO conn object (but things should be written to handle a native driver type)</p></li><li><p>the model object &#8211; runs the queries &amp; returns results array (or error array) to the main lib. As it is now, it is very &#34;thin&#34; and only has transactions, query building &amp; the actual db query</p></li><li><p>the model interface &#8211; I&#39;m a big fan of interfaces, and I see this model as being swappable for a NoSQL model, for example</p></li><li><p>the main library &#8211; in my current CI library, this 1) receives the function request, 2) validates the params passed to it, 3) requests from the model, 4) creates a response array that includes the data &amp; error codes and messages (multilingual configurable, but not really part of this question)</p></li></ul><p>So, in summary, the way it works NOW is in your controller or calling page:</p><p>1) call main lib function<br /> 2) main lib calls model<br /> 3) model returns to main lib<br /> 4) main lib returns to controller</p><hr/><p>NOW starts my real design pattern question:</p><p>I would like to pass my conn object via DI to my main library, but I&#39;d also like to pass my model via DI to the main library to keep things flexible. The flexibility goal I&#39;m after would be to allow people to create their own Native DB or NoSQL models &amp; pass non-PDO conns into this, so keeping them decoupled seems optimal.</p><p>BUT to do this, the only thing I can think of would end up as:</p><p>(controller &#8211; where I might actually execute the query in the lib, not model)</p><pre><code>$conn //from the user
$model = new MyModel();
$lib = new MyLib($conn, $model);
</code></pre><p>or</p><pre><code>$conn //from the user
$model = new MyModel($conn);
$lib = new MyLib($model);
</code></pre><p>which feels more &#34;natural&#34; since the query &amp; conn tend to work together</p><p>Either case feels pretty clumsy for the user, and I can&#39;t help but wonder if I&#39;m not either overdoing this whole DI thing or just have picked the wrong design pattern to go about this.</p><p>Any guidance as to how to best set this up would be greatly appreciated &#8211; spent more time thinking about this than it will take me to refactor the actual code!</p><p>TIA</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I could be waaaaaay off, but...</p><p>It seems that <em>a</em> model is necessary to use the library, you just don&#39;t care which one, right? Further, the library doesn&#39;t care how the model gets its data, or where the data comes from, it just wants an object that meets the criteria of the interface.</p><p>If the library doesn&#39;t need the connection object, then make that the responsibility of the model.</p><pre><code>interface MyFooModelInterface 
{
    public function getItem($id);
    public function addItem($item);
    ...
}
</code></pre><p>And here is a simple class example:</p><pre><code>class MyLib
{
    protected $model;

    public function __construct(MyFooModelInterface $model)
    {
        $this-&gt;model = $model;
    }

    public function getItemById($id)
    {
        return $this-&gt;model-&gt;getItem($id);
    }
}
</code></pre><p>And a Model example:</p><pre><code>class MyModel implements MyFooModelInterface
{
    protected $conn;

    public function __construct(\PDO $conn)
    {
         $this-&gt;conn = $conn;
    }

    public function getItem($id)
    {
        ...
    }
    public function addItem($item)
    {
        ...
    }
}
</code></pre><p>And here is an example of using it:</p><pre><code>// the model is responsible for handling the data retrieval, not the library
$model = new Model($conn);

$lib = new MyLib($model);
return $lib-&gt;getItem($id);
</code></pre><p>Now, if I decide that I want a file-based solution, I can easily swap the model.  To test the model, the connection obj is injected, so that&#39;s easy.  To test the library, the model is also injected, so, again, that&#39;s easy.</p><p>In this case, the model is only responsible for getting the data, while the library is responsible for handling and processing the data.  Neither cares what or how the other one does it.</p><h1>EDIT</h1><p>the library with a factory method to create the model if none was given...</p><pre><code>class MyLib
{
    protected $model;

    public function __construct(MyFooModelInterface $model = null, $conn = null)
    {
        // if we have a model, use it
        if (!is_null($model)) { 
            $this-&gt;model = $model; 
        }

        // if we don&#39;t have a model, but have a connection obj, make a model
        if (is_null($model) &amp;&amp; !is_null($conn)) { 
            $this-&gt;model = $this-&gt;factoryModel($conn); 
        }

        // if we don&#39;t have either, quit and go home
        if (is_null($model) &amp;&amp; is_null($conn)) {
            throw new Exception(&#39;need moar inputs&#39;);
        }
    }

    protected factoryModel($conn)
    {
        $this-&gt;model = new MyModel($conn);
    }

    public function getItemById($id)
    {
        return $this-&gt;model-&gt;getItem($id);
    }
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-pattern-to-parse-array-of-objects/'>Design Pattern to parse array of objects</a></li><li class="list-group-item"><a href='../c-design-pattern-for-library-wrapping-extern-methods/'>C# &#8211; Design Pattern for Library Wrapping Extern Methods</a></li><li class="list-group-item"><a href='../database-getting-data-from-a-database-with-the-mvc-model/'>Database &#8211; Getting data from a database with the MVC model</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>