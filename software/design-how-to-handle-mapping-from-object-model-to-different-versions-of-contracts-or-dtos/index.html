<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; How to handle mapping from object model to different versions of contracts or DTO&#8217;s &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082159 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082159" class="post-1082159 software type-software status-publish hentry category-software tag-architecture tag-design tag-dto tag-versioning"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; How to handle mapping from object model to different versions of contracts or DTO&#8217;s</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">dto</span><span class="mr-2 badge badge-primary">versioning</span></p><div class="entry-content"><p>I&#39;m looking for patterns or best practices for <strong>maintaining different versions of an API contract</strong>. There&#39;s lots of information on the internet about how to version API&#39;s (URL&#39;s vs. headers etc), but this question is related to the <strong>mapping from one object model to different versions of the contract types</strong> (DTO&#39;s), and for that I haven&#39;t been able to find any information really.</p><p>Imagine you have a web project with an endpoint, and a client app (Could be desktop or mobile) that communicates with the web project using that endpoint. The endpoint is only used by your client app, i.e. it&#39;s an internal endpoint, not public. The communication between the web project and the client app works by the client app sending some data to the endpoint, and the web project receives it, processes it and sends back a response object. There&#39;s a <em>contract</em> for how the structure of the data sent to the endpoint and sent back from the endpoint should look like. It&#39;s fairly complex in terms types of the number of object types and their nesting. You can&#39;t control when your users upgrade their client app, and it&#39;s a business requirement to be backwards compatible.</p><p>You have an object model that evolves and that&#39;s no problem since you&#39;ve separated the API contract (The DTO&#39;s) and the object model. You have mapping code that maps from the object model to the contract and vice versa.</p><p>You can make non-breaking changes to the contract, but if you need to make breaking changes, you&#39;ll need a new version of the contract, and you&#39;ll need to make sure you can map from your object model to the new contract. But as you need to be backwards compatible, you also need to make sure you can somehow map from the object model to the previous version of the contract.</p><p><strong>My question is then: How would you architecturally handle this? Do you know of any patterns or best practices that can be used for this?</strong></p><p>The challenge is when you change the object model and create a new contract, you also need to make sure that there is some way that the old contract keeps working. <strong>One way</strong> I see this could be done, is by maintaining a mapping from the object model to each version of the contract.</p><p><strong>Another way</strong> could be to only maintain a mapping from the object model to the latest contract, but then maintain a migration path from the different versions of the contract (So when needing to map from v3 to v1, you would map from object model to latest contract (v3), and then map to v2, and then map to v1).</p><p>Another issue to consider is the amount of <strong>duplication</strong>. When the contract has a lot of types, and you need to just delete a single field from one of the types, this is a breaking change and requires a new version. Would you copy the whole contract (All types) to a new folder in your project, and then delete the one field? This would mean you have an almost identical contract, and a lot of types would be duplicated. Duplication in this instance can be justified, but is there a better way?</p><p>Any pointers, insights and suggestions are appreciated.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The problems you describe exist in identical form in object serialization systems, and these problems have all been worked out over the years. What you describe as a contract can also be viewed as an object serialization format, at a higher level.</p><p>For serialization, generally speaking, you have only a single version of the &#34;contract&#34; implemented. This implementation supports the latest version with no conditional paths taken; i.e. the default, most straightforward code path supports the latest version. To maintain backward compatibility with previous version, conditionals must be introduced based on the type of object change:</p><ul><li>Removing a property (I use the word property as in .net, but it is any public field in an object): Normally you do not need to do anything for backward compatibility.</li><li>Adding a property: If you provide a useful default value for the property, the API user does not need to initialize the new property. I use the word &#34;property&#34; to also refer to data that is orthogonal: one property does not affect another. This is part of good API design and a requirement for backward compatibility.</li><li>Change the type or name of a property: in this case you have to add conditional code to examine the version of the API consumer, and convert the name or type to the new name or type.</li><li>Change the name of a data type: the change is similar; in some cases, you must keep the old data type around so that it can be loaded with data before conversion.</li></ul><p>Now consider API compatibility instead of serialization compatibility. In many ways, this is a more difficult problem, because you must provide the entire API in the exact version needed. While you can add to that API, you cannot change the functionality of the old API in any way. You must keep all old data types and all old properties. The general strategy is this:</p><ul><li>Add new functionality and new data types without interfering with the old API. Adding new properties is no problem.</li><li>Users writing new code will use the newest version.</li><li>Users working with previously written code have no problem as you support the entire old API.</li><li>Keep track of the versioning age: At some point, it becomes too difficult to maintain the old version. At this point, you create a version that has all the old compatibility code stripped out. People using older versions of your API can still link to older libraries.</li></ul><p>The main strategy with API evolution is never change it. This means your API must be very well designed, with thought given to making the most general data types, not the most specific. You must plan ahead for years. It helps to have years of experience in the specific domain. Even with careful planning, the API must change, but at least you can minimize the changes.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../binary-data-formats-how-to-make-ensure-you-can-read-different-format-versions/'>Binary data formats, how to make ensure you can read different format versions</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>