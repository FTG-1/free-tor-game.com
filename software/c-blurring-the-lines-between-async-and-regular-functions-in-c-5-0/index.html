<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Blurring the lines between async and regular functions in C# 5.0 &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079330 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079330" class="post-1079330 software type-software status-publish hentry category-software tag-async tag-asynchronous-programming tag-c tag-net"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Blurring the lines between async and regular functions in C# 5.0</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">async</span><span class="mr-2 badge badge-info">asynchronous-programming</span><span class="mr-2 badge badge-warning">c</span><span class="mr-2 badge badge-primary">net</span></p><div class="entry-content"><p>Lately I can&#39;t seem to get enough of the amazing <a href="http://msdn.microsoft.com/en-us/library/vstudio/hh191443.aspx" rel="noreferrer">async-await</a> pattern of C# 5.0. Where have you been all my life?</p><p>I&#39;m absolutely thrilled with the simple syntax, but I&#39;m having one small difficulty. My problem is that async functions have a totally different declaration from regular functions. Since only async functions can await on other async functions, when I&#39;m trying to port some old blocking code to async, I&#39;m having a domino effect of functions I have to convert.</p><p>People have been referring to this as a <em>zombie infestation</em>. When async gets a bite in your code, it will keep getting bigger and bigger. The porting process is not difficult, it&#39;s just throwing <code>async</code> in the declaration and wrapping the return value with <code>Task&lt;&gt;</code>. But it is annoying to do this over and over again when porting old synchronous code.</p><p>It seems to me it will be much more natural if both function types (async and plain old sync) had the exact same syntax. If this were the case, porting will take zero effort and I could switch painlessly between the two forms.</p><p>I think this could work if we follow these rules:</p><ol><li><p>Async functions won&#39;t require the <code>async</code> declaration anymore. Their return types wouldn&#39;t have to be wrapped in <code>Task&lt;&gt;</code>. The compiler will identify an async function during compilation by itself and do the Task&lt;&gt; wrapping automatically as needed.</p></li><li><p>No more fire-and-forget calls to async functions. If you want to call an async function, you will need to await on it. I hardly use fire-and-forget anyways, and all the examples of crazy race conditions or deadlocks always seem to be based on them. I think they are too confusing and &#34;out of touch&#34; with the synchronous mindset we try to leverage.</p></li><li><p>If you really can&#39;t live without fire-and-forget, there will be special syntax for it. In any case, it won&#39;t be part of the simple unified syntax I&#39;m talking about.</p></li><li><p>The only keyword you need to denote an asynchronous call is <code>await</code>. If you have await, the call is asynchronous. If you don&#39;t, the call is plain old synchronous (remember, we don&#39;t have fire-and-forget anymore).</p></li><li><p>The compiler will identify async functions automatically (since they don&#39;t have a special declaration anymore). Rule 4 makes this very simple to do &#8211; if a function has an <code>await</code> call inside, it is async.</p></li></ol><p>Could this work? or am I missing something? This unified syntax is much more fluid and could solve the zombie infestation altogether.</p><p><strong>Some Examples:</strong></p><pre><code>// assume this is an async function (has await calls inside)
int CalcRemoteBalanceAsync() { ... }

// assume this is a regular sync function (has no await calls inside)
int CalcRemoteBalance() { ... }

// now let&#39;s try all combinations and see what they do:

// this is the common synchronous case - it will block
int b1 = CalcRemoteBalance();

// this is the common asynchronous case - it will not block
int b2 = await CalcRemoteBalanceAsync();

// choosing to call an asynchronous function in a synchronous manner - it will block
// this syntax was used previously for async fire-and-forget, but now it&#39;s just synchronous
int b3 = CalcRemoteBalanceAsync();

// strange combination - it will block since it&#39;s calling a synchronous function
// it should probably show a compilation warning though
int b4 = await CalcRemoteBalance();
</code></pre><p>Note: this is a continuation of an interesting <a href="https://stackoverflow.com/questions/18498942/why-shouldnt-all-functions-be-async-by-default">related discussion</a> in SO</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your question is already answered in the SO question you linked.</p><blockquote><p>The purpose of async/await is to make it easier to write code in a
 world with many high latency operations. <strong>The vast majority of your
 operations are <em>not</em> high latency.</strong></p></blockquote><p>When <a href="http://en.wikipedia.org/wiki/Windows_Runtime" rel="noreferrer">WinRT</a> first came out, the designers were describing how they decided which operations were going to be async.  They decided that anything that was going to take 50ms or more would be async, and the remainder of the methods would be ordinary, non-asynchronous methods.</p><p>How many of the methods had to be rewritten to make them asynchronous?  About 10 percent of them.  The other 90% were not affected at all.</p><p>Eric Lippert goes on to explain in fairly substantial technical detail why they opted not to take a one-size-fits-all approach.  He basically says that <code>async</code> and <code>await</code> are a partial implementation of continuation-passing style, and that optimizing such a style to fit all cases is a hard problem.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-efficient-mixing-of-sync-and-async-methods-within-a-single-method/'>C# &#8211; Efficient mixing of sync and async methods within a single method</a></li><li class="list-group-item"><a href='../c-async-await-pedantry-vs-the-debugger/'>C# async/await: Pedantry vs. the Debugger</a></li><li class="list-group-item"><a href='../javascript-why-are-promises-not-awaited-by-default/'>Javascript &#8211; Why are Promises not &#8220;awaited&#8221; by default</a></li><li class="list-group-item"><a href='../why-do-many-languages-semantically-distinguish-async-functions-from-non-async-ones/'>Why do many languages semantically distinguish &#8220;async&#8221; functions from &#8220;non-async&#8221; ones</a></li><li class="list-group-item"><a href='../c-problem-with-async-await-pattern-in-c-and-javascript-how-to-return-sync-value/'>C# &#8211; Problem with async/await pattern &#8212; in C# and JavaScript &#8212; how to return sync value</a></li><li class="list-group-item"><a href='../c-arent-the-guidelines-of-async-await-usage-in-c-contradicting-the-concepts-of-good-architecture-and-abstraction-layering/'>C# &#8211; Aren&#8217;t the guidelines of async/await usage in C# contradicting the concepts of good architecture and abstraction layering</a></li><li class="list-group-item"><a href='../java-is-the-c-async-task-construct-equivalent-to-javas-executor-future/'>Java &#8211; Is the C# async/Task construct equivalent to Java&#8217;s Executor/Future</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>