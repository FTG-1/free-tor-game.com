<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Updating the db in the repository from a DTO in a layered architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082772 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082772" class="post-1082772 software type-software status-publish hentry category-software tag-dto tag-repository"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Updating the db in the repository from a DTO in a layered architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">dto</span><span class="mr-2 badge badge-info">repository</span></p><div class="entry-content"><p>Given a Person model:</p><pre><code>Person {
    int PersonId;
    string Name;
    string Email;
}
</code></pre><p>and an UpdatePersonDto which just updates the Name</p><pre><code>UpdatePersonDto {
    int PersonId;
    string Name;
}
</code></pre><p>How should the repository handle the update process?</p><ol><li>Accept the <code>UpdatePersonDto</code> object, fetch the current <code>Person</code> object from the DB, map the fields and then update</li><li>Accept the <code>UpdatePersonDto</code> object and perform an update on the DB just using the DTO. The <code>Person</code> domain model is not needed in this case</li><li>Require the <code>Person</code> model and leave the mapping to a higher layer</li><li>Some thing else?</li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>This really depends on many factors. For now, I&#39;m going to assume the following layered architecture:</p><pre><code>Consuming application (e.g. web) &gt; Business &gt; Datalayer &gt; The actual database
</code></pre><hr/><p>For one, it depends where your DTO lives. Is this DTO create on the business level, or the datalayer level?</p><ul><li>If on the business level, then your datalayer doesn&#39;t know the DTO. That means that communication between business and datalayer happens via either domain models, <em>or</em> a custom set of primitive parameters (e.g. <code>Guid personId</code> and <code>string newName</code>).</li><li>If on the datalayer level, then your datalayer can use the DTO, which means that this operates exactly like the &#34;custom set of primitive parameters&#34; situation, with the only difference that instead of custom primitive parameters, you&#39;re passing a custom object which acts as the collection of custom primitive parameters.</li></ul><p><em>Note: it&#39;s of course possible to have DTOs on both layers, but the outcome is the same as if you only had a datalayer DTO.</em></p><hr/><p>Secondly, it depends on what technology you&#39;re using to interact with your database.</p><p>If you&#39;re using Dapper or any other method where you are crafting the actual SQL query, this gives you the option of writing an explicit update query which only touches the fields you want it to.<br/> However, this becomes more cumbersome when you start dealing with multiple update queries which strongly resemble each other or reuse nontrivial logic. Little by little, it starts violating DRY.</p><p>If you&#39;re using Entity Framework or any other similar library that means you have the SQL generated for you, you&#39;ll generally be better off sticking to the recommended approach for the library you&#39;re using. I would assume that any decent library would be able to do targeted updates of only the fields you want to have updated. But since you&#39;re dealing with a query generator (the library), you need to use it the way it expects you to use it.</p><hr/><p>Interacting with relational databases via network calls leads to tradeoffs. You&#39;re going to either have to sacrifice performance or code cleanliness (to some degree).</p><p>As a basic example, consider that repositories were initially intended to operate for one specific entity each. If you want to fetch <code>Person</code> and <code>Car</code> objects, you&#39;ll need to talk to the <code>PersonRepository</code> and <code>CarRepository</code> respectively.<br/> From a development perspective, this is a really neat and clean way of separating different steps. And when you&#39;re dealing with an in-memory list of data, there is no real performance loss.</p><p>However, when dealing with a networked relational database, you want to minimize the amount of calls you make because the network calls always cost overhead. If you&#39;re trying to fetch a list of people and the cars they own, you&#39;re better off launching a single query that fetches both at the same time, and let the database handle the collation of those two entities.</p><p>But does that &#34;get both&#34; call belong to <code>PersonRepository</code> or to <code>CarRepository</code>? That&#39;s no longer clear. This means you&#39;ve compromised your idealistic definition of a repository, because you are now trying to run queries that use multiple entity types at the same time.</p><p>This is why it&#39;s a tradeoff. Because the performance hit would otherwise be too significant, we trade away the &#34;perfect&#34; repositories in favor of better performance. So when you ask:</p><blockquote><p>How should the repository handle the update process?</p></blockquote><p>The real answer is <strong>in whatever way that maximizes what is the most important to you</strong>.</p><blockquote><ol><li>Accept the UpdatePersonDto object, fetch the current Person object from the DB, map the fields and then update</li></ol></blockquote><p>This leads to the cleanest code and ease of development, but it effectively doubles your network calls (fetch + update) which can become a bottleneck.</p><p>Then again, if you&#39;ve got bandwidth to spare and performance is not the #1 priority, but have a limited developer availability, it may be better to favor clean code so you can minimize development and maintenance time as best as you can.</p><blockquote><ol start="2"><li>Accept the UpdatePersonDto object and perform an update on the DB just using the DTO. The Person domain model is not needed in this case</li></ol></blockquote><p>This is the more performant option. It requires handcrafting a update that only targets specific fields, which may lead to more development effort, but it will pay back dividends in performance.</p><blockquote><ol start="3"><li>Require the Person model and leave the mapping to a higher layer</li></ol></blockquote><p>I&#39;m not quite sure how this is different from option 1. I think the only difference here is that you split the &#34;update person&#34; responsibility over two classes.<br/> That <em>could</em> be better codewise, but I don&#39;t think it&#39;s needed (based on my current understanding of your situation) and thus would advise against it.</p><p>Performancewise, I&#39;m expecting this to be equal to option 1.</p><blockquote><ol start="4"><li>Some thing else?</li></ol></blockquote><p>Option 1/2 tackle the most common tradeoff: ease of development versus runtime performance. But it&#39;s possible that you have other things to consider too (e.g. using a particular approach because your company ubiquitously uses this approach). In such a case, you need to find the approach that works best for your list of priorities.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../the-best-way-to-create-dtos-from-entities-and-update-entities-from-dtos-in-a-layered-architecture/'>The best way to create DTOs from entities and update entities from DTOs in a layered architecture</a></li><li class="list-group-item"><a href='../use-dto-pattern-or-serialize-domain-objects/'>Use DTO Pattern or Serialize Domain Objects</a></li><li class="list-group-item"><a href='../architecture-clean-architecture-what-is-the-view-model/'>Architecture &#8211; Clean Architecture: What is the View Model</a></li><li class="list-group-item"><a href='../domain-driven-design-updating-and-persisting-aggregates/'>Domain Driven Design &#8211; Updating and persisting aggregates</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>