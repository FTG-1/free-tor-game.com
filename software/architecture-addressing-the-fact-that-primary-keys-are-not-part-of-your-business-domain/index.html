<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; Addressing the fact that primary keys are not part of your business domain &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070136 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070136" class="post-1070136 software type-software status-publish hentry category-software tag-architecture"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; Addressing the fact that primary keys are not part of your business domain</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span></p><div class="entry-content"><p>In almost all circumstances, primary keys are not a part of your business domain. Sure, you may have some important user-facing objects with unique indices (<code>UserName</code> for users or <code>OrderNumber</code> for orders) but in most cases, there is no <em>business need</em> to overtly identify domain objects by a single value or set of values, to anyone  but perhaps an administrative user. Even in those exceptional cases, especially if you are using <a href="http://en.wikipedia.org/wiki/Globally_unique_identifier">global unique identifiers (GUID)</a>, you will like or want to employ an alternate key rather than expose the primary key itself.</p><p>So, if my understanding of domain-driven design is accurate, primary keys <em>need not</em> and thus <em>should not</em> be exposed, and good riddance. They&#39;re ugly and cramp my style. But if we choose not to include primary keys in the domain model, there are consequences:</p><ol><li>Naively, <a href="http://en.wikipedia.org/wiki/Data_transfer_object">data transfer objects (DTO)</a> that derive exclusively from combinations of domain models will not have primary keys</li><li>Incoming DTO&#39;s will not have a primary key</li></ol><p>So, is it safe to say that if you are really going to stay pure and eliminate primary keys in your domain model, you should be prepared to be able to handle every request in terms of unique indices on that primary key?</p><p>Put in another way, which of the following solutions is the correct approach to dealing with identifying particular objects after removing PK in domain models?</p><ol><li>Being able to identify the objects you need to deal with by other attributes</li><li>Getting the primary key back in the DTO; ie, eliminating the PK when mapping from persistence to domain, then recombining the PK when mapping from domain to DTO?</li></ol><p>EDIT: Let&#39;s make this concrete.</p><p>Say my domain model is <code>VoIPProvider</code> which includes fields like <code>Name</code>, <code>Description</code>, <code>URL</code>, as well as references like <code>ProviderType</code>, <code>PhysicalAddress</code>, and <code>Transactions</code>.</p><p>Now let&#39;s say I want to build a web service that will allow privileged users to manage <code>VoIPProvider</code>s.</p><p>Perhaps a user-friendly ID is useless in this case; after all, VoIP providers are companies whose names tend to be distinct in the computer sense and even distinct enough in the human sense for business reasons. So it may be enough to say that a unique <code>VoIPProvider</code> is completely determined by <code>(Name, URL)</code>. So now let&#39;s say I need a method <code>PUT api/providers/voip</code> so that privileged users can update <code>VoIP</code> providers. They send up a <code>VoIPProviderDTO</code>, which includes many but not all of the fields from the <code>VoIPProvider</code>, including some flattening potentially. However, I can&#39;t read their minds, and they still need to tell me which provider we are talking about.</p><p>It seems I have 2 (maybe 3) options:</p><ol><li>Include a primary key or alternate key in my domain model and send it to the DTO, and vice versa</li><li>Identify the provider we care about via the unique index, like <code>(Name, Url)</code></li><li>Introduce some sort of intermediate object that can always map between persistence layer, domain, and DTO in a way that does not expose implementation details about the persistence layer &#8211; say by introducing an in-memory temporary identifier when going from domain to DTO and back,</li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>This is the way how we solve this (since more than 15 years, when even the term &#34;domain driven design&#34; was not invented):</p><ul><li>when mapping the domain model to a database implementation or a class model in a specific programming language, you have a simple, consistent rule like &#34;for each domain object mapped to a relational table, the primary key is &#34;TablenameID&#34;.</li><li>this primary key is completely artificial, it has always the same type, and <strong>no</strong> business meaning - just a <a href="http://en.wikipedia.org/wiki/Surrogate_key">surrogate key</a></li><li>the &#34;graphical version&#34; of your domain model (the one you use to talk to your domain experts) does not contain primary keys. You don&#39;t expose them directly to the experts (but you expose them to anyone who is actually implementing code for the system).</li></ul><p>So whenever you need a primary key for technical purposes (like mapping relations to a database), you have one available, but as long as you don&#39;t want to &#34;see it&#34;, change your level of abstraction to the &#34;domain experts model&#34;. And you don&#39;t have to maintain &#34;two models&#34; (one with PKs and one without); instead, maintain only a model without PKs and use a code generator to create the DDL for your DB, which adds the PK automatically according to the mapping rules.</p><p>Note that this does not forbid to add any &#34;business keys&#34; like an additional &#34;OrderNumber&#34;, besides the surrogate <code>OrderID</code>. Technically these business keys become alternate keys when mapping to your database. Just avoid using these for creating references to other tables, always prefer using the surrogate keys if possible, this will make things a hell lot easier.</p><p>To your comment: using a surrogate key for identifying records is <em>no</em> business-related operation, it is a purely technical operation. To make this clear, look at your example: as long as you don&#39;t define additional unique-contraints, it would be possible to have two VoIPProvider objects with the same combination of (name,url), but different VoIPProviderIDs.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-validation-and-data-persistence-in-a-domain-model/'>Architecture &#8211; Validation and data persistence in a domain model</a></li><li class="list-group-item"><a href='../database-maintaining-user-avatars/'>Database &#8211; Maintaining user avatars</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>