<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; Would this be a good web application architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087283 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087283" class="post-1087283 software type-software status-publish hentry category-software tag-architecture tag-caching tag-design tag-web-applications tag-xml"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; Would this be a good web application architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">caching</span><span class="mr-2 badge badge-warning">design</span><span class="mr-2 badge badge-primary">web-applications</span><span class="mr-2 badge badge-danger">xml</span></p><div class="entry-content"><p><strong>My problem</strong></p><p>Our MVC based framework does not allow us to cache only part of our output. Ideally we want to cache all static and semi-static parts, and run dynamic parts. In addition, we need to consider data caching that reacts to database changes.</p><p><strong>My idea</strong></p><p>The concept I came up with was to represent a page as a <strong>tree of XML fragment objects</strong>. Some of the fragments are dynamic, and can pull their data directly from models or other sources, but most of the fragments are static scaffolding.</p><p>If a subtree of fragments is completely static, then I imagine that they could <strong>unfold</strong> into XML that would then be cached as the text representation of their parent element.</p><p>This process would ideally continue until we are left with a root element that contains all of the static XML, and has a couple of dynamic XML fragments that are resolved and attached to the relevant nodes of the XML tree just before the page is displayed.</p><p>In addition to separating content into dynamic and static fragments, some fragments could be dynamic and cached. A simple expiry time which propagates up through the XML fragment tree would indicate that a specific fragment should periodically be refreshed. A newspaper section or front page does not need to be updated each second. Minutes or sometimes even longer is sufficient.</p><p>Other fragments would be dynamic and uncached. Typically too many articles are viewed for them to be cached &#8211; the cache would overflow. Some individual articles may be cached if they are extremely popular.</p><p><strong>Functional notes</strong></p><p>The folding mechanism could be to be smart enough to judge when it would be more profitable to fold a dynamic cached fragment and propagate the expiry date to the parent fragment, or to keep it separate and simply attach to the XML tree when resolving the page.</p><p>If some dynamic cached fragments are associated to database objects through mechanisms like a globally unique content id, then changes to the database could trigger changes to the output cache. If fragments store the identifiers of parent fragments, then they could trigger a refolding process that would then include the updated data.</p><p>A set of pure XML with an ordered array of fragment objects (that each store the identifying information of the node to which they should be attached), can be resolved in a fairly simple way by walking the XML tree, and merging the data from the fragments.</p><p>Because it is not necessary to parse and construct the entire tree in memory before attaching nodes, processing should be fairly fast.</p><p>The identifiers of each fragment would be a combination of relevant identity data and the type of fragment object. Cached parent fragments would contain references to these identifiers, in order to then either pull them from the fragment cache, or to run their code.</p><p>The controller&#39;s responsibility is reduced to making changes to the database, and telling the root XML fragment object to render itself.</p><p>I would just like to make it clear that while I say XML, what I really mean is XHTML. The design generates and folds XHTML from the very start, without trying to add an additional step to transform the XML to XHTML. It&#39;s just functionally equivalent to XML.</p><p><strong>UPDATE:</strong></p><p><img src="../../../i.stack.imgur.com/6rRmu.png" alt="Modified MVC"/></p><p>The design is still essentially MVC. Traditionally in Web applications, controllers make changes to models directly, <em>then</em> load all the data from models, and send it to the view.</p><p>The problem with this is that it&#39;s hard to do partial page caching.</p><p>Most web applications spend most of their time in the DB. If the controller has to load the data from models <em>each time</em>, then caching the view has no point, unless you cache the whole view and do no database queries.</p><p>However, in Smalltalk, where the MVC pattern originally came from, views pulled data from models directly. &#34;<em>The view gets its own data from the model.</em>&#34; &#8211; <a href="../../../en.wikipedia.org/wiki/Model%e2%80%93view%e2%80%93controller.html" rel="nofollow noreferrer">MVC on Wikipedia</a></p><p>If views pull their data from the models, and views are composed of other views, then it becomes trivial to cache the <em>output</em> of views. If it does not need loading again, then it doesn&#39;t load, and it doesn&#39;t contact the DB.</p><p>I am treating view output as XML/XHTML because we have a couple of tools that allow us to manipulate XML quite well, making the interweaving of static and dynamic fragments fairly simple.</p><p><strong>The Question</strong></p><p>My question has two parts:</p><ol><li><p>Is this a good design? Are there any obvious flaws I&#39;m missing?</p></li><li><p>Has somebody else thought of this before? References?</p></li><li><p>Is there an existing alternative that I should consider? A cool templating engine maybe?</p></li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>This sounds suspiciously like you&#39;re trying to invent <a href="http://www.asp.net/mvc/tutorials/improving-performance-with-output-caching-cs" rel="nofollow">output caching</a>. I definitely wouldn&#39;t agree that it&#39;s hard to do partial page caching in MVC, it&#39;s just that you would need to use partial Views with their own Controller actions to do it as opposed to having the View itself call its sub-Views, which can be slightly counter-intuitive. (So in ASP.net MVC you&#39;d want to use Html.RenderAction as opposed to Html.RenderPartial). There&#39;s a name for this particular pattern that is currently escaping my recollection.</p><p>I would suggest that the main flaw with your design is that Views will have to know things about the architecture of the site. So they&#39;ll have to know about where to get their data from AND how to get it, they&#39;ll have to know about where to cache it, when to cache it, when not to cache it, etc.</p><p>Realistically you should be trying to separate layers away from knowledge of other layers, as the less knowledge each layer has of another the easier it is to change a layer (i.e. switch DB, add a transparent data caching layer, move a DB call across to a web service, etc.).</p><p>I would suggest that if you&#39;re going to implement such an idea, and there isn&#39;t a native output caching system in your MVC-framework-of-choice, that you add the caching layer to the Controller actions. Unless you&#39;ve got some VERY heavyweight Views that need to do large amounts of recursive rendering of Models (something that&#39;s very rare) the actual HTML generation time is miniscule compared to DB calls and client network latency, so take a more pragmatic approach and cache where you need to cache, i.e. in the application layer.</p><p>If you really need custom output caching then you probably want to just slip in a caching layer above your Controller actions with either a wrapping class (if you&#39;re using a dynamic language) or a different implementation of an interface (if in a static language) that can hijack the calls to the Action and react accordingly.</p><p>As for caching that reacts to DB changes, you&#39;d be better off with a caching layer that takes into account both loading and saving in your repository class, with each save call flushing the cache (or part of the cached set) and each load being gracefully degraded from cache to DB when needed (i.e. use the cache when the cached data is available). That way you keep the database driven behaviour close to the database.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-how-to-handle-complex-views-consisting-of-several-parts-in-mvc-web-application/'>Design &#8211; How to handle complex views (consisting of several parts) in MVC web application</a></li><li class="list-group-item"><a href='../javascript-dealing-with-browser-cache-in-single-page-apps/'>Javascript &#8211; Dealing with browser cache in single-page apps</a></li><li class="list-group-item"><a href='../do-application-level-caches-belong-inside-web-servers/'>Do application-level caches belong inside web servers</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>