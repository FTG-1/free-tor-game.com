<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Designing an scalable message queue architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1065414 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1065414" class="post-1065414 software type-software status-publish hentry category-software tag-design tag-message-queue tag-scalability"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Designing an scalable message queue architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">message-queue</span><span class="mr-2 badge badge-warning">scalability</span></p><div class="entry-content"><p>I have recently started learning the nuances of scalable and enterprise computer architecture, and one of the central components is a messaging queue. In order to learn the most I can from any programming paradigm, I am trying to implement my own version of a messaging queue service.</p><p>So far, my initial design runs on a threaded socket listener, but in order to prevent the same message being downloaded twice by two separate processing nodes, the message queue index register is locked when a read is initiated, and unlocked after the register has been updated. As such, this negates the need for it to be threaded, and means that there is a ceiling for the size of a scalable system based on the processing speed of the server the messaging queue service is running on.</p><p>The way to get around this would be run the message queue service on multiple servers, but this will increase the likelihood of the same message being downloaded twice. The only way to prevent such issues occurring would be to include a revocation callback that (after the servers, or even the threads on a single server, have synchronized their information and detected such a re-issuance) would command the processing node to stop its current job, and re-query the message queue for the next message, but again, there would be a ceiling where most of the traffic being sent would be synchronizations, and revocation callbacks, causing a bottleneck and slowing the processing of information so that a lot of the processing nodes would be performing null operations and wasting time.</p><p>The last way I can think of to get around this problem is to have each message queue server (and each thread on each server) would have a specific offset as to where in the queue it is looking, but that might have issues based upon the type of application, especially if the processing is required to be done in a specific order.</p><p>So, all that being said, are there any designs of message queue architecture&#39;s that could show me how existing enterprise grade message queue services avoid these problems?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In short:</p><h3>This is a hard problem. Don&#39;t reinvent the wheel.</h3><p>Many technologies solve the message queue layer.  They include</p><ul><li><a href="https://zeromq.org/" rel="nofollow noreferrer">ZeroMQ</a></li><li><a href="https://www.rabbitmq.com/" rel="nofollow noreferrer">RabbitMQ</a></li><li><a href="https://kafka.apache.org/" rel="nofollow noreferrer">Apache Kafka</a></li><li><a href="https://redis.io/" rel="nofollow noreferrer">Redis</a>, with BLPOP or <a href="https://redis.io/topics/pubsub" rel="nofollow noreferrer">PUBSUB</a> (I&#39;ve asked how to do this <a href="https://softwareengineering.stackexchange.com/q/204623/53263">here</a>).</li><li>Other <a href="https://www.amqp.org/" rel="nofollow noreferrer">AMQP</a> implementations besides RabbitMQ</li></ul><p>I think it&#39;s out of scope for me to discuss the drawbacks of each, not the least because I don&#39;t claim the expertise to do this well <em>cough</em> don&#39;t use Rabbit <em>cough</em>.</p><h3>Even if you don&#39;t want to use any of these technologies, read their documentation.</h3><p>This will educate you on design patterns that are possible over one system. Reading <a href="https://zeromq.org/get-started/" rel="nofollow noreferrer">ZeroMQ&#39;s documentation</a> will educate you on many classic message queuing architectures they have graciously implemented. Even if you do not use ZeroMQ, knowing these patterns will help you evaluate other queuing technologies by asking if you can implement that pattern there.</p><p>Learn about RabbitMQ/AMQP&#39;s exchange-queue model. Routing may come up for you - this is supported by Redis PUBSUB but I don&#39;t recall being supported by ZeroMQ - and fanouts are something my shop has been using, albeit poorly implemented over a Memcached poll (yuck!), for quite some time.</p><h3>How to choose one?</h3><p>I work at a startup whose SLA is typical for a web-app - some outages are okay, as long as we can quickly restore service with little data loss.  We haven&#39;t had to think about scaling problems like Twitter or Tumblr has, so we haven&#39;t had to think about throughput volume. That being said, if you are implementing an SLA similar to mine, these considerations will come to mind:</p><ul><li>do the client libraries <em>work</em>?  Is it easy to maintain a connection in them?  (ZeroMQ, Redis: yes. RabbitMQ: no).</li><li>is monitoring and management easy from a server console? (Redis: yes, RabbitMQ: yes, ZeroMQ: not that I recall but we did not use it that long)</li><li>do clients support internal queues so little data loss occurs in short outages?  (ZeroMQ, Redis: yes. RabbitMQ: no.)</li></ul><p>Of course, if you are working for, say, a high-frequency trading shop, these will be your lesser concerns. You&#39;ll be more willing to put development time into a client-side library in exchange for higher throughput in the end. But I&#39;m writing this more to warn you that <strong>these technologies tend to market based on their performance, not their out-of-the-box functionality.</strong> If you&#39;re a web-startup, you are <em>far</em> more interested in the latter than the former, and accordingly, something like Redis, which is more optimized for ease of use at good performance than the difficulty of use at great performance, is probably a better choice than RabbitMQ.  (I don&#39;t like RabbitMQ).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-designing-a-scalable-and-robust-retry-mechanism/'>C# &#8211; Designing a scalable and robust retry mechanism</a></li><li class="list-group-item"><a href='../nosql-document-database-as-a-message-queue/'>NoSQL Document Database as a Message Queue</a></li><li class="list-group-item"><a href='../design-system-design-scalable-chat-server/'>Design &#8211; System Design: Scalable Chat Server</a></li><li class="list-group-item"><a href='../database-message-queue-database-vs-dedicated-mq/'>Database &#8211; Message Queue. Database vs Dedicated MQ</a></li><li class="list-group-item"><a href='../design-scalable-solution-with-queue/'>Design scalable solution with queue</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>