<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Possibility of stale data in cache-aside pattern &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087678 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087678" class="post-1087678 software type-software status-publish hentry category-software tag-caching tag-concurrency tag-design-patterns tag-memcached"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Possibility of stale data in cache-aside pattern</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">caching</span><span class="mr-2 badge badge-info">concurrency</span><span class="mr-2 badge badge-warning">design-patterns</span><span class="mr-2 badge badge-primary">memcached</span></p><div class="entry-content"><p>Just to re-cape cache-aside pattern it defines following steps when fetching and updating data.</p><p><strong>Fetching Item</strong></p><ol><li>Return the item from cache if found in it.</li><li>If not found in cache, read from data store.</li><li>Put the read item in cache and return it.</li></ol><p><strong>Updating Item</strong></p><ol><li>Write the item in data store.</li><li>Remove the corresponding entry from cache.</li></ol><p>This works perfectly in almost all cases, but it seems to fail in one theoretical scenario.</p><p>What if step 1 &amp; 2 of <em>updating item</em>, happen between step 2 &amp; 3 of <em>fetching item</em>. In other words, consider that initially data store had the value &#39;A&#39; and it was not in cache. So when fetching item, we read &#39;A&#39; from data store but before we put into the cache, the item was updated to &#39;B&#39; in another thread (So &#39;B&#39; was written in data store and tried to remove the entry from cache, which was not there at that time). Now when the fetching thread puts the item it read (i.e. &#39;A&#39;) in cache. So now &#39;A&#39; will stay cached, and further fetches will return stale data, until item expires or updated again.</p><p>So am I missing something here, is my understanding of pattern is wrong. Or that the scenario is just practically impossible, and there is no need to worry about it.</p><p>Also I would like to know if some changes can be made in the pattern to avoid this problem.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You are correctly pointing out a race condition.</p><p>Cache-aside, as described <a href="https://msdn.microsoft.com/en-us/library/dn589799.aspx">here</a> and <a href="https://blog.cdemi.io/design-patterns-cache-aside-pattern">here</a>, is an imperfect abstraction that is not appropriate for all data storage use cases.</p><blockquote><blockquote><p><strong><em>Consistency.</em></strong> Implementing the Cache-Aside pattern does not guarantee consistency between the data store and the cache. An item in the data store may be changed at any time by an external process, and this change might not be reflected in the cache until the next time the item is loaded into the cache. In a system that replicates data across data stores, this problem may become especially acute if synchronization occurs very frequently.</p></blockquote></blockquote><p>This text refers to the problems when someone modifies the data store without informing the cache its need to invalidate.  (The pattern describes the need for an appropriate eviction policy, which is intended to limit the lifetime of data errors.)</p><p>Yet, the race condition you are pointing out could occur even if all clients are playing by the rules.  When the race condition happens, stale data will be deposited in the cache and remain there until it is otherwise evicted (by standard (e.g. time-based) eviction or because data at that key is one again updated, and this time perhaps without the race.)</p><p>Serving some stale data alongside up-to-date data is a worse kind of consistency breach than merely returning stale information that was at least fully correct taken together at one point in time (a snapshot).  This is sometimes called a form of read or write skew.</p><blockquote><p>Also I would like to know if some changes can be made in the pattern to avoid this problem.</p></blockquote><p>A problem with this pattern is that it spreads a single responsibility (data storage; holding state) across multiple components.  So, a way to fix the race condition you&#39;re pointing out is to change the model so that the cache is a first-class entity having the full responsibility for both reading and writing the data.  The clients would ask the cache for data, the cache, when needed, would fetch the data from the data store and return it to the clients.  The clients would inform the cache of updates, and the cache would update the data store.  The cache would then be in a position to provide the appropriate synchronization so it could avoid race conditions.</p><hr/><p>Ultimately, this pattern is useful for data that doesn&#39;t change often, and for data storage that doesn&#39;t depend on set consistency / transactions over multiple keys.  For example, it might work for certain kinds of document stores, such as  a music library, especially if the library is mostly appended to, keys are never updated, and occasionally documents are deleted but it is ok (from the business perspective) to continue to serve them for the eviction duration after they are deleted.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-using-memcached-is-it-good-practice-to-update-the-cache-when-updating-the-database/'>Architecture &#8211; Using Memcached: is it good practice to update the cache when updating the database</a></li><li class="list-group-item"><a href='../java-synchronizing-local-and-remote-cache-in-distributed-caching/'>Java &#8211; Synchronizing local and remote cache in distributed caching</a></li><li class="list-group-item"><a href='../shared-cache-invalidation-best-practice/'>Shared Cache &#8211; Invalidation Best Practice</a></li><li class="list-group-item"><a href='../cache-concurrency-ensuring-latest-version-in-cache/'>Cache concurrency: ensuring latest version in cache</a></li><li class="list-group-item"><a href='../java-forcing-cache-refresh/'>Java &#8211; Forcing Cache Refresh</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>