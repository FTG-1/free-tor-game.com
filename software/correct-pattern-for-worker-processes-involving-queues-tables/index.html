<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Correct pattern for Worker Processes involving Queues &#038; Tables &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079513 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079513" class="post-1079513 software type-software status-publish hentry category-software tag-azure tag-cloud tag-cloud-computing tag-design-patterns"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Correct pattern for Worker Processes involving Queues &#038; Tables</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">azure</span><span class="mr-2 badge badge-info">cloud</span><span class="mr-2 badge badge-warning">cloud computing</span><span class="mr-2 badge badge-primary">design-patterns</span></p><div class="entry-content"><p>Edit:</p><p>OK, so, people said it is unclear what I am asking. I am asking for feedback on this design. Here is an example user story:</p><p>As a group admin on the website I want to be notified when a user in my group uploads a file to the group.</p><p>Easiest solution would be that in the code handling the upload, we just directly create an email message in there and send it. However, this seems like it isn&#39;t really the appropriate level of separation of concerns, so instead we are thinking to have a separate worker process which does nothing but send notifications. So, the website in the upload code handles receiving the file, extracting some metadata from it (like filename) and writing this to the database. As soon as it is done handling the file upload it then does two things: Writes the details of the notification to be sent (such as subject, filename, etc&#8230;) to a dedicated &#34;notification&#34; table and also creates a message in a queue which the notification sending worker process monitors. The entire sequence is shown in the diagram below.</p><p>My questions are: Do you see any drawbacks in this design? Is there a better design? The team wants to use Azure Worker Roles, Queues and Table storage. Is it the right call to use these components or is this design unnecessarily complex? Quality attribute requirements are that it is easy to code, easy to maintain, easy to debug at runtime, auditable (history is available of when notifications were sent, etc&#8230;), monitor-able. Any other quality attributes you think we should be designing for?</p><p>Original:</p><p>We are creating a cloud application (in Azure) in which there are at least 2 components. The first is the &#34;source&#34; component (for example a UI / website) in which some action happens or some condition is met that triggers a second component or &#34;worker&#34; to perform some job. These jobs have details or metadata associated with them which we plan to store in Azure Table Storage. Here is the pattern we are considering:</p><p><img src="../../../i.stack.imgur.com/fLIs4.png" alt="enter image description here"/></p><p>Steps:</p><ol><li>Condition for job met.</li><li>Source writes job details to table.</li><li>Source puts job in queue.</li></ol><p>Asynchronously:</p><ol start="4"><li>Worker accepts job from queue.</li><li>Worker Records DateTimeStarted in table.</li><li>Queue marks job marked as &#34;in progress&#34;.</li><li>Worker performs job.</li><li>Worker updates table with details (including DateTimeCompleted).</li><li>Worker reports completion to queue.</li><li>Job deleted from queue.</li></ol><p>Please comment and let me know if I have this right, or if there is some better pattern. For example sake, consider the work to be &#34;sending a notification&#34; such as an email whose template fields are filled from the &#34;details&#34; mentioned in the pattern.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I can&#39;t answer whether you should do this or not, but I can try to help with your decision-making process.</p><p>First, what you are proposing is a very standard mechanism for asynchronously processing data. So, you are doing something very conventional, and that is good. I use AWS and have done this a lot with SQS and SNS. I can&#39;t speak to what Azure offers. AWS gives an <a href="http://media.amazonwebservices.com/architecturecenter/AWS_ac_ra_batch_03.pdf" rel="nofollow">example</a> of this pattern for batch processing.</p><p>Here are some advantages to this approach:</p><ul><li><p>The initial request can be faster because there is less work being done. There is some time for putting the message in the queue, but it is <em>probably</em> faster than saving to disk and sending an email.</p></li><li><p>You can make the notifications more fault tolerant, or at the least, not interfere with the initial request which prompted that notification. If your email service goes down for a day, you can keep the message in the queue and the worker can try it again the next day.</p></li><li><p>It will scale well - both in terms of users, and as new features arise.</p></li></ul><p>There are a few downsides:</p><ul><li><p>There is now additional complexity. It would be simpler to just send the email.</p></li><li><p>Correctly handling errors can more complicated. What do you do if you can&#39;t send an email? Retry? Delete the message from the queue and forget? This error handling is important, but your use-case decides how sophisticated you need it to be.</p></li><li><p>You probably want another web service handling this, which adds another component. Though, on small-scale projects, I have put the worker thread in the same web service.</p></li></ul><hr/><p>Separation of Concerns</p><p>You mentioned Separation of Concerns as one reason for your design. Regardless of how you end up architecting this, you should still separate concerns at a class level. Whatever class is receiving this data can call an &#34;notifier&#34; interface. You might have different implementations of this over time: send the email in the same thread, send the email in a different thread without a queue, put the email in a queue. Each time you change your architecture, you keep the servicing code the same.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-worker-object-pool-pattern/'>C# &#8211; &#8220;Worker object pool&#8221; pattern</a></li><li class="list-group-item"><a href='../java-best-way-to-load-application-settings/'>Java &#8211; Best way to load application settings</a></li><li class="list-group-item"><a href='../object-oriented-would-a-composite-design-pattern-be-useful-for-group-membership/'>Object-oriented &#8211; would a composite design pattern be useful for group membership</a></li><li class="list-group-item"><a href='../in-multi-tenant-systems-what-is-the-correct-practice-for-segregating-each-tenants-data-from-each-other/'>In multi-tenant systems what is the correct practice for segregating each tenants data from each other</a></li><li class="list-group-item"><a href='../design-architecture-for-message-processing-with-scheduling-at-scale/'>Design &#8211; Architecture for message processing with scheduling, at scale</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>