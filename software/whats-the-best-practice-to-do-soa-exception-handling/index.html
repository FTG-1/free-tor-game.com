<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>What&#8217;s the best practice to do SOA exception handling &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067271 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067271" class="post-1067271 software type-software status-publish hentry category-software tag-soa tag-soap tag-wcf tag-web-services"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">What&#8217;s the best practice to do SOA exception handling</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">soa</span><span class="mr-2 badge badge-info">soap</span><span class="mr-2 badge badge-warning">wcf</span><span class="mr-2 badge badge-primary">web services</span></p><div class="entry-content"><p>Here&#39;s some interesting debate going on between me and my colleague when coming to handle SOA exceptions:</p><p>On one side, I support what Juval Lowy said in Programming WCF Services 3rd Edition:</p><blockquote><p>As stated at the beginning of this chapter, it is a common illusion<br /> that clients care about errors or have anything meaningful to do when<br /> they occur. Any attempt to bake such capabilities into the client<br /> creates an inordinate degree of coupling between the client and the<br /> object, raising serious design questions. How could the client<br /> possibly know more about the error than the service, unless it is<br /> tightly coupled to it? What if the error originated several layers<br /> below the service—should the client be coupled to those lowlevel<br /> layers? Should the client try the call again? How often and how<br /> frequently? Should the client inform the user of the error? Is there a<br /> user?  By having all service exceptions be indistinguishable from one<br /> another, WCF decouples the client from the service. The less the<br /> client knows about what happened on the service side, the more<br /> decoupled the interaction will be.</p></blockquote><p>On the other side, here&#39;s what my colleague suggest:</p><blockquote><p>I believe it’s simply incorrect, as it does not align with best<br /> practices in building a service oriented architecture and it ignores<br /> the general idea that there are problems that users are able to<br /> recover from, such as not keying a value correctly.  If we considered<br /> only systems exceptions, perhaps this idea holds, but systems<br /> exceptions are only part of the exception domain.  User recoverable<br /> exceptions are the other part of the domain and are likely to happen<br /> on a regular basis.  I believe the correct way to build a service<br /> oriented architecture is to map user recoverable situations to checked<br /> exceptions, then to marshall each checked exception back to the client<br /> as a unique exception that client application programmers are able to<br /> handle appropriately.  Marshall all runtime exceptions back to the<br /> client as a system exception, along with the stack trace so that it is<br /> easy to troubleshoot the root cause.</p></blockquote><p>I&#39;d like to know what you think about this.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>User recoverable exceptions should not be &#34;exceptions&#34;.  Exceptions are for <em>exceptional</em> circumstances.  Transposing a few letters in a form field is something that you should expect and plan for.</p><p>Part of the impetus behind a &#34;Service-Oriented Architecture&#34; is that services are reusable.  Sure, it <em>might</em> be a client sending messages to it... or it might be another service, or an orchestration engine, or an event subscriber, or an automated task or batch job.  These actors can&#39;t <em>possibly</em> be able to reliably recover from a fault, no matter how much detail you put into it.  In many cases they may even be using one-way messaging (i.e. MSMQ), in which case you&#39;re not even <em>allowed</em> to send a fault back; there&#39;s simply no channel for it.</p><p>Once a service has made the decision to send back a fault message, assuming that the originator can actually receive it, then all the originator can sensibly do is roll back the transaction it&#39;s in - if it was smart enough to enlist in one.</p><p>Juval is exactly right.  Marshaling fault messages into client exceptions is fine when you&#39;ve exhausted all other options (i.e. unhandled exception), but there is no point in the service trying to provide all kinds of detail. <em>None</em>.  Users will not read or understand the error message, and if you think having a stack trace is a benefit from the <em>user</em> perspective then you don&#39;t understand the first thing about usability.</p><p>Microsoft <a href="http://msdn.microsoft.com/en-us/library/ee942778.aspx">actually tells you to put exception detail in faults</a>.  But don&#39;t.  Please don&#39;t.  It just encourages you to be lazy and fault when you really should be <em>handling</em> the errors.  I&#39;ve been down that road and it is one of never-ending pain and misery.  It&#39;s especially pernicious in WCF because faulting permanently invalidates the service proxy, and it&#39;s actually very difficult to design client apps to recover from this, particularly if you&#39;re following other &#34;best practices&#34; and doing dependency injection.</p><p>What you <em>should</em> - nay, <strong>must</strong> be doing is <strong>logging all errors on the service side</strong>, generally into persistent storage, and sending notifications as bug reports.  More sophisticated, service-bus architectures will even have an error queue which holds all of the original messages that <em>caused</em> the errors - but at the very least, you want the errors themselves. <strong>You</strong> want them - not your users.  Don&#39;t rely on them to give you the stack traces, because if you do, then you have already failed them.</p><p>&#34;User recoverable exceptions&#34; simply do not exist in an SOA. There is no such thing because you can&#39;t know in advance who the &#34;user&#34; is going to be.  If an exception is recoverable then it should be part of the message - for example, in XML form:</p><pre><code>&lt;customerUpdateResponse customerId=&#34;123&#34; status=&#34;notUpdated&#34;&gt;
    &lt;validationErrors&gt;
        &lt;requiredFieldMissing field=&#34;fullName&#34;/&gt;
        &lt;maxLengthExceeded field=&#34;phone&#34; maxLength=&#34;30&#34; actualLength=&#34;45&#34;/&gt;
    &lt;/validationErrors&gt;
&lt;/customer&gt;
</code></pre><p>This is just off the top of my head, but hopefully you get the idea; if an operation can fail for <em>known, documented</em> reasons then that &#34;failure&#34; becomes <em>part of the specification</em>.  In this case, the message is sending back an <em>event</em> saying <em>what happened</em>, and the client application can interpret this data appropriately.  The important thing is that it is part of the <strong>contract</strong>, not some unexpected &#34;stop the presses&#34; error.</p><p>Now I know that WCF lets you use fault contracts and so on, but honestly, I don&#39;t see the point, it&#39;s just adding complexity where it&#39;s not really needed.  SOAP faults are, honestly, a pain in the butt to deal with from any angle.</p><p>As mentioned earlier, you also have to carefully plan for the case where you can&#39;t send <em>any</em> response.  Fledgling &#34;SOAs&#34; with a smattering of web services tend to be predominantly RPC style, but that&#39;s actually a poor strategy for designing a robust high-performance architecture.  The killer feature of an SOA, in my opinion at least, is publish-subscribe, which allows you to <em>totally</em> decouple the services themselves and only ever share messages.  But this comes at a cost: you have to dispense with two-way communication.  If a service wants to fault after consuming an event, well, great, but nobody&#39;s going to be listening.  Which means that proper logging and exception notification is really, <em>really</em> important.</p><p>A good overall strategy for the second case is to define a generalized message type for unrecoverable errors (technically you could just use the <code>FaultException</code>) and install a component in the pipeline which forwards all faults to a fault queue, thus (a) ensuring that you don&#39;t lose any, and (b) collecting them all into a central location, which will make your life a whole lot easier when you have 30 different web services on 10 different servers.  It&#39;s really very easy to <a href="http://msdn.microsoft.com/en-us/library/ff650331.aspx#ExceptionManagement4">set up a global exception handler</a> in WCF - just attach to the <code>Faulted</code> event of the <code>ServiceHost</code>. You can also <a href="http://codeidol.com/csharp/wcf/Faults/Error-Handling-Extensions/">install your own <code>IErrorHandler</code></a> to do all of this <em>before</em> the fault ever happens - your choice.</p><p>But in summary: Instrument your systems so that you can resolve serious issues proactively and don&#39;t fault for recoverable errors. To the end user, downtime is downtime; make the exception details discoverable for developers and support staff but don&#39;t leak them to users.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-which-net-rest-approach-technology-tool-should-i-use/'>Rest &#8211; Which .NET REST approach/technology/tool should I use</a></li><li class="list-group-item"><a href='../what-security-is-used-by-default-in-wshttpbinding-service-side-or-the-wcf-test-client-client-side/'>What security is used by default in WSHttpBinding (service side) or the WCF Test client (client side)</a></li><li class="list-group-item"><a href='../architecture-how-to-use-the-unit-of-work-and-repository-patterns-in-a-service-oriented-enviroment/'>Architecture &#8211; How to use the unit of work and repository patterns in a service oriented enviroment</a></li><li class="list-group-item"><a href='../how-to-structure-an-application-that-combines-wcf-and-wpf/'>How to structure an application that combines WCF and WPF</a></li><li class="list-group-item"><a href='../c-clients-connect-to-wcf-or-sql-server/'>C# &#8211; Clients connect to WCF or SQL Server</a></li><li class="list-group-item"><a href='../c-net-wcf-persistent-connection-or-open-close-as-needed/'>C# &#8211; .NET WCF: Persistent connection or Open/Close as needed</a></li><li class="list-group-item"><a href='../mvc-advice-on-architecture-wcf-mvc/'>Mvc &#8211; Advice on architecture (WCF / MVC)</a></li><li class="list-group-item"><a href='../design-mvvm-best-practices-with-wpf-client-and-wcf-duplex-service/'>Design &#8211; MVVM best practices with WPF client and WCF duplex service</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>