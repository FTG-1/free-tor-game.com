<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; How to design a C++ program to allow for runtime import of functions &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069386 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069386" class="post-1069386 software type-software status-publish hentry category-software tag-c tag-reflection tag-runtime"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; How to design a C++ program to allow for runtime import of functions</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">reflection</span><span class="mr-2 badge badge-warning">runtime</span></p><div class="entry-content"><p>today, I like to ask you a question towards the capabilities of C++ to realize a specific software architecture.</p><p>Of course, I have used the search but have not found any directly linked answer.</p><p>Basically, my goal is to build a program which allows the user for modeling and simulation of arbitrarily composed physical systems, e.g. a driving car. I assume to have a library of physical models (functions within classes). Each function may have some inputs and return some outputs depending on the underlying physical description, e.g. a combustion engine model, an aerodynamic drag model, a wheel model, etc.</p><p>Now, the idea is to provide the user a framework which allows him to compose any functions according to his needs, i.e. to map any physical behavior. The framework should provide functionalities to connect the outputs and inputs of different functions. Therefore, the framework provides a container class. I call it COMPONENT, which is able to hold one or many model objects (FUNCTION). These containers can also hold other components (cf. composite pattern) as well as the connections (CONNECTOR) between the function parameters. Additionally, the component class provides some general numeric functionalities such as math solver and so on.</p><p>The composition of functions should be done during runtime. In the first instance, the user should be able to set up a composition through importing an XML which defines the composition structure. Later, one could think of adding a GUI.</p><p>To give you a better understanding here is a very simplified example:</p><pre><code>&lt;COMPONENT name=&#34;Main&#34;&gt;
  &lt;COMPONENT name=&#34;A&#34;&gt;
    &lt;FUNCTION name=&#34;A1&#34; path=&#34;lib/functionA1&#34; /&gt;
  &lt;/COMPONENT&gt;
  &lt;COMPONENT name=&#34;B&#34;&gt;
    &lt;FUNCTION name=&#34;B1&#34; path=&#34;lib/functionB1&#34; /&gt;
    &lt;FUNCTION name=&#34;B2&#34; path=&#34;lib/functionB2&#34; /&gt;
  &lt;/COMPONENT&gt;
  &lt;CONNECTIONS&gt;
    &lt;CONNECTOR source=&#34;A1&#34; target=&#34;B1&#34; /&gt;
    &lt;CONNECTOR source=&#34;B1&#34; target=&#34;B2&#34; /&gt;
  &lt;/CONNECTIONS&gt;        
&lt;/COMPONENT&gt;
</code></pre><p>It is not necessary to dive deeper into the framework&#39;s capabilities because my problem is much more general. When the framework code/program is compiled, the physical problem description, as well as the user-defined functions, are not known. When the user selects (via XML or later via a GUI) a function, the framework should read the function information, i.e. should get the information of input and output parameters, in order to offer the user the option to interconnect the functions.</p><p>I know the principles of reflection and I am aware that C++ does not provide this feature. However, I am sure that the concept of &#34;building objects during runtime&#34; is very often required. How should I set up my software architecture in C++ to achieve my goal? Is C++ the right language? What do I overlook?</p><p>Thanks in advance!</p><p>Cheers,<br /> Oliver</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In pure standard C++, you cannot &#34;allow for runtime import of functions&#34;; according to the standard, the set of C++ functions is <em>statically known</em> at build-time (in practice, link-time) since fixed from the union of all <a href="https://en.wikipedia.org/wiki/Translation_unit_(programming)" rel="noreferrer">translation units</a> composing your program.</p><p>In practice, most of the time (excluding embedded systems) your C++ program runs above some <a href="https://en.wikipedia.org/wiki/Operating_system" rel="noreferrer">operating system</a>. Read <a href="http://pages.cs.wisc.edu/~remzi/OSTEP/" rel="noreferrer"><em>Operating Systems: Three Easy Pieces</em></a> for a good overview.</p><p>Several modern operating systems allow <a href="https://en.wikipedia.org/wiki/Dynamic_loading" rel="noreferrer">dynamic loading</a> of <a href="https://en.wikipedia.org/wiki/Plug-in_(computing)" rel="noreferrer">plugins</a>.
POSIX notably specifies <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/dlopen.html" rel="noreferrer"><strong><code>dlopen</code></strong></a> &amp; <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/dlsym.html" rel="noreferrer"><code>dlsym</code></a>. Windows has something different <code>LoadLibrary</code> (and an inferior linking model; you need to explicitly annotate the functions concerned, provided, or used by plugins). BTW on Linux you can practically <code>dlopen</code> a big lot of plugins (see my <a href="https://github.com/bstarynk/misc-basile/blob/master/manydl.c" rel="noreferrer"><code>manydl.c</code> program</a>, with enough patience it can generate then load nearly a million of plugins). So your XML thing could drive the loading of plugins. Your multi-component / multi-connector description reminds me of <a href="http://doc.qt.io/qt-5/signalsandslots.html" rel="noreferrer">Qt signals and slots</a> (which <a href="http://doc.qt.io/qt-5/why-moc.html" rel="noreferrer">requires a <code>moc</code> preprocessor</a>; you might need something like that too).</p><p>Most C++ implementations use <a href="https://en.wikipedia.org/wiki/Name_mangling" rel="noreferrer">name mangling</a>. Because of it, you&#39;ll better declare as <code>extern &#34;C&#34;</code> the functions related to plugins (and defined in them, and accessed by <code>dlsym</code> from the main program). Read the <a href="http://tldp.org/HOWTO/C++-dlopen/" rel="noreferrer">C++ dlopen mini HowTo</a> (for Linux at least).</p><p>BTW, <a href="http://qt.io/" rel="noreferrer">Qt</a> and <a href="http://pocoproject.org/" rel="noreferrer">POCO</a> are C++ frameworks providing some portable and higher-level approach to plugins. And <a href="https://sourceware.org/libffi/" rel="noreferrer">libffi</a> enables you to call functions whose signature is only known at runtime.</p><p>Another possibility is to embed some interpreter, like <a href="http://lua.org/" rel="noreferrer">Lua</a> or <a href="https://www.gnu.org/software/guile/" rel="noreferrer">Guile</a>, in your program (or write your own one, like Emacs did). This is a strong architectural design decision. You may want to read <a href="https://en.wikipedia.org/wiki/Lisp_in_Small_Pieces" rel="noreferrer"><em>Lisp In Small Pieces</em></a> and <a href="https://www.cs.rochester.edu/~scott/pragmatics/" rel="noreferrer"><em>Programming Language Pragmatics</em></a> for more.</p><p>There are variants or mixes of those approaches. You could use some <a href="https://en.wikipedia.org/wiki/Just-in-time_compilation" rel="noreferrer">JIT compilation</a> library (like <a href="https://gcc.gnu.org/onlinedocs/jit/" rel="noreferrer">libgccjit</a> or <code>asmjit</code>). You could generate <em>at runtime</em> some C and C++ code in a temporary file, compile it as a temporary plugin, and dynamically load that plugin (I used such an approach in <a href="http://starynkevitch.net/Basile/gcc-melt/" rel="noreferrer">GCC MELT</a>).</p><p>In all these approaches, memory management is a significant concern (it is a &#34;whole program&#34; property, and what actually is the &#34;envelope&#34; of your program is &#34;changing&#34;).  You&#39;ll need at least some culture about <a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)" rel="noreferrer">garbage collection</a>. Read the <a href="http://gchandbook.org/" rel="noreferrer"><em>GC handbook</em></a> for the terminology. In many cases (arbitrary <a href="https://en.wikipedia.org/wiki/Circular_reference" rel="noreferrer">circular references</a> where <a href="https://en.wikipedia.org/wiki/Weak_reference" rel="noreferrer">weak pointers</a> are not predictable), the <a href="https://en.wikipedia.org/wiki/Reference_counting" rel="noreferrer">reference counting</a> scheme dear to C++ <a href="https://en.wikipedia.org/wiki/Smart_pointer" rel="noreferrer">smart pointers</a> might not be enough. See also <a href="https://stackoverflow.com/a/46991317/841108">this</a>.</p><p>Read also about <a href="https://en.wikipedia.org/wiki/Dynamic_software_updating" rel="noreferrer">dynamic software updating</a>.</p><p>Notice that some programming languages, notably <a href="https://en.wikipedia.org/wiki/Common_Lisp" rel="noreferrer">Common Lisp</a> (and <a href="https://en.wikipedia.org/wiki/Smalltalk" rel="noreferrer">Smalltalk</a>), are more friendly to the idea of runtime importing functions. <a href="http://sbcl.org/" rel="noreferrer">SBCL</a> is a free software implementation of Common Lisp, and compiles to machine code at every <a href="https://en.wikipedia.org/wiki/Read–eval–print_loop" rel="noreferrer">REPL</a> interaction (and is even able to garbage collect machine code, and can <a href="http://sbcl.org/manual/#Saving-a-Core-Image" rel="noreferrer">save</a> an entire core image file which can be later easily restarted).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-what-kind-of-interface-should-a-double-container-offer/'>C++ &#8211; What kind of interface should a double container offer</a></li><li class="list-group-item"><a href='../single-for-loop-runtime-explanation-problem/'>Single for-loop runtime explanation problem</a></li><li class="list-group-item"><a href='../python-how-does-the-python-runtime-actually-work/'>Python &#8211; How does the Python Runtime actually work</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>