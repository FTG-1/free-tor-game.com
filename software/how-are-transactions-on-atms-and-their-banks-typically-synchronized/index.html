<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How are transactions on ATMs and their banks typically synchronized &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087736 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087736" class="post-1087736 software type-software status-publish hentry category-software tag-networking tag-protocol tag-transaction"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How are transactions on ATMs and their banks typically synchronized</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">networking</span><span class="mr-2 badge badge-info">protocol</span><span class="mr-2 badge badge-warning">transaction</span></p><div class="entry-content"><p>There are points of failure:</p><ol><li>ATM gives money then send a deduction request to it&#39;s bank. What happens, if the request will fail? the user got the money but his account hasn&#39;t been deducted &#8211; <strong>fail</strong>.</li><li>ATM send a deduction request to it&#39;s bank, bank deduct the value, send a request back to ATM, the request fail (disappear). the user was deducted but hasn&#39;t got his money &#8211; <strong>fail</strong></li></ol><p>Who knows the solution used in real life?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>Disclaimer:</strong> For the following part, I&#39;m saying <em>most</em>, because I obviously don&#39;t have experience with all banking systems.</p><hr/><p>Just like any system which needs to be really fast, even banks are eventually consistent. When you&#39;re implementing such system, you really want it to be online as much as possible. Any possible downtime will hurt your business, because you&#39;re delaying the customer in whichever situation they currently are. And believe me, slowly responding banking system is a really awful experience also for retailers. It hurts everyone.</p><p>To stay as available and fast as possible, most ATMs and/or card terminals don&#39;t verify your balance and process the transaction against the master in real time. With the amount of transactions, that would flood the system.</p><p>The owners of banks know that, the majority of requests to withdraw money from ATM or to issue a card transaction are going to succeed. Because of this, when you do actually want to withdraw money from ATM, the machine pings the bank&#39;s very quick and scalable read model to very quickly check if you have the desired amount or not. Know that this ping is done on a replica and thus may not be in real-time sync with the master.</p><p>Once the ping is done and your status is verified, the ATM notes that you have made a withdrawal and dispenses the money. Every configured period the ATM then collects all withdrawals made and sends them to appropriate authorities.</p><p>Some ATMs might be (and usually are) more complex, remember some information about your account from the card, so that they don&#39;t have to ping the bank every time. Thanks to this, the ATM alone usually prevents you from withdrawing $500 and $500 right after when your account would only contain e.g. $501 - in this case the first withdrawal is fine, the second is not, because the ATM remembers you had $501, have withdrawn $500 so your theoretical balance is $1. Obviously, if the ATM is one of the dumber ones which ping banking association every time, the replica is still likely to reply with $501 even on the second withdrawal and even the second withdrawal will be allowed. But this is still <em>not</em> a problem.</p><p>Because banks actually don&#39;t mind you to go into negative balance, they even allow these temporary hiccups and implement a reporting system which notifies administrators and support in a case when someone&#39;s balance becomes negative. This in turn may trigger other processes, such as starting to bill your for the time of having a negative account balance,...</p><p>While banking might seem really strict and feels like every single operation must be consistent, availability is a much more important aspect when it comes to banking, therefore banks are programmed that way.</p><hr/><p><strong>To answer your questions directly:</strong></p><blockquote><p>ATM gives money then send a deduction request to it&#39;s bank. What
 happens, if the request will fail? the user got the money but his
 account hasn&#39;t been deducted - fail.</p></blockquote><p>To prevent this problem, the ATMs are implemented to record both withdrawal request (containing information about how much you want to withdraw) and event about withdrawal completion.</p><p>When the <code>WithdrawalRequested</code> event is stored, the ATM starts giving you the money. If it dies right after giving you the money but before storing the <code>WithdrawalCompleted</code> event, this is not a problem.</p><ol><li>After a reboot the ATM will in some way sum all made successful withdrawals, subtract the sum value from original amount of money inserted into the ATM,</li><li>The ATM will find inconsistency, that it&#39;s in fact missing $500, find all entities without <code>WithdrawalCompleted</code> event, and if there&#39;s an incomplete request it [ATM] will simply complete it.</li></ol><p>Ad 2. If the ATM is unable to find a matching withdrawal, it sends a report to authorities that this has happened and it will have to be investigated.</p><p>Now, if you do request withdrawal and the ATM dies before even recording the <code>WithdrawalRequested</code> event, this is not a problem, simply nothing will happen. But if the ATM dies between storing <code>WithdrawalRequested</code> and actually giving you money, as before, after reboot measurements need to be made that the request is not actually sent to authorities, once again by verifying the current state of money in the ATM - in this case the money would match amount of sum of completed withdrawals subtracted from original amount of funds and the request will be simply discarded (still possibly notifying someone that the problem has occurred).</p><blockquote><p>ATM send a deduction request to it&#39;s bank, bank deduct the value, send
 a request back to ATM, the request fail (disappear). the user was
 deducted but hasn&#39;t got his money - fail</p></blockquote><p>This situation will never happen since the ATMs do not issue the command before dispensing the money but after.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-are-rollback-and-roll-forward-transactions-equivalent-for-fault-tolerance/'>Design &#8211; Are rollback and roll-forward transactions equivalent for fault tolerance</a></li><li class="list-group-item"><a href='../distributed-transactions-and-queues-ruby-erlang/'>Distributed transactions and queues, ruby, erlang</a></li><li class="list-group-item"><a href='../java-transactions-and-subresources-with-jax-rs/'>Java &#8211; Transactions and subresources with JAX-RS</a></li><li class="list-group-item"><a href='../what-are-mia-mid-and-dia-interfaces/'>What are mIa, mId and dIa interfaces</a></li><li class="list-group-item"><a href='../database-are-bank-transactions-run-with-db-transactions/'>Database &#8211; Are bank transactions run with DB transactions</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>