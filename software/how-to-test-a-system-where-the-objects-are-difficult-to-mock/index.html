<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to test a system where the objects are difficult to mock &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071096 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071096" class="post-1071096 software type-software status-publish hentry category-software tag-adapter tag-development-process tag-mocking tag-object-oriented-design tag-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to test a system where the objects are difficult to mock</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">adapter</span><span class="mr-2 badge badge-info">development-process</span><span class="mr-2 badge badge-warning">mocking</span><span class="mr-2 badge badge-primary">object-oriented-design</span><span class="mr-2 badge badge-danger">testing</span></p><div class="entry-content"><p>I am working with the following system:</p><pre><code>Network Data Feed -&gt; Third Party Nio Library -&gt; My Objects via adapter pattern
</code></pre><p>We recently had an issue where I updated the version of the library I was using, which, among other things, caused timestamps (which the third party library returns as <code>long</code>), to be changed from milliseconds after the epoch to nanoseconds after the epoch.</p><h3>The Problem:</h3><p>If I write tests that mock the third party library&#39;s objects, my <em>test will be wrong</em> if I have made a mistake about the third party library&#39;s objects. For example, I didn&#39;t realize that the timestamps changed precision, which resulted in a need for change in the unit test, because my mock returned the wrong data. This is <em>not a bug in the library</em>, it happened because I missed something in the documentation.</p><p>The problem is, I cannot be sure about the data contained in these data structures because I <strong>cannot generate real ones without a real data feed.</strong> These objects are big and complicated and have a lot of different pieces of data in them. The documentation for the third party library is poor.</p><h3>The Question:</h3><p>How can I set up my tests to test this behavior? I&#39;m not sure I can solve this issue in a unit test, because the test itself can easily be wrong. Additionally, the integrated system is large and complicated and it&#39;s easy to miss something. For example, in the situation above, I had correctly adjusted the timestamp handling in several places, but I missed one of them. The system seemed to be doing mostly the right things in my integration test, but when I deployed it to production (which has a lot more data), the problem became obvious.</p><p>I do not have a process for my integration tests right now. Testing is essentially: try to keep the unit tests good, add more tests when things break, then deploy to my test server and make sure things seem sane, then deploy to production. This timestamp issue passed the unit tests because the mocks were created wrong, then it passed the integration test because it didn&#39;t cause any immediate, obvious problems. I do not have a QA department.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It sounds like you&#39;re already doing due diligence. But ...</p><p><strong>At the most practical level,</strong> always include a good handful of both &#34;full-loop&#34; integration tests in your suite for your own code, and write more assertions than you think you need. In particular, you should have a handful of tests that perform a full create-read-[do_stuff]-validate cycle.</p><pre><code>[TestMethod]
public void MyFormatter_FormatsTimesCorrectly() {

  // this test isn&#39;t necessarily about the stream or the external interpreter.
  // but ... we depend on them working how we think they work:
  var stream = new StreamThingy();
  var interpreter = new InterpreterThingy(stream);
  stream.Write(&#34;id-123, some description, 12345&#34;);

  // this is what you&#39;re actually testing. but, it&#39;ll also hiccup
  // if your 3rd party dependencies introduce a breaking change.
  var formatter = new MyFormatter(interpreter);
  var line = formatter.getLine();
  Assert.equal(
    &#34;some description took 123.45 seconds to complete (id-123)&#34;, line
  );
}
</code></pre><p>And it sounds like you&#39;re already doing this sort of thing. You&#39;re just dealing with a flaky and/or complicated library. And in that case, it&#39;s good to throw in a few &#34;this is how the library works&#34; types of tests that both verify your understanding of the library and serve as examples of how to use the library.</p><p>Suppose you need to understand <em>and depend on</em> how a JSON parser interprets each &#34;type&#34; in a JSON string. It&#39;s helpful and trivial to include something like this in your suite:</p><pre><code>[TestMethod]
public void JSONParser_InterpretsTypesAsExpected() {
  String datastream = &#34;{nbr:11,str:&#34;22&#34;,nll:null,udf:undefined}&#34;;
  var o = (new JSONParser()).parse(datastream);

  Assert.equal(11, o.nbr);
  Assert.equal(Int32.getType(), o.nbr.getType());
  Assert.equal(&#34;22&#34;, o.str);
  Assert.equal(null, o.nll);
  Assert.equal(Object.getType(), o.nll.getType());
  Assert.isFalse(o.KeyExists(udf));
}
</code></pre><p><strong>But secondly,</strong> remember that automated testing of any kind, and at almost any level of rigor, will still fail to protect you against all bugs. It&#39;s perfectly common to add tests <em>as you discover problems.</em> Not having a QA department, this means a lot of those problems will be discovered by end-users.</p><p>And to a significant degree, <strong>that&#39;s just normal.</strong></p><p><strong>And thirdly,</strong> when a library changes the meaning of a return-value or field without renaming the field or method or otherwise &#34;breaking&#34; dependent code (maybe by changing its type), I&#39;d be pretty damn unhappy with that publisher. And I&#39;d argue that, even though you should probably have read the changelog if there is one, you should probably also pass some of your stress onto the publisher. I&#39;d argue they need the hopefully-constructive criticism ...</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../python-how-to-populate-a-private-container-for-unit-test/'>Python &#8211; How to populate a private container for unit test</a></li><li class="list-group-item"><a href='../unit-testing-do-i-need-unit-test-if-i-already-have-integration-test/'>Unit-testing &#8211; Do I need unit test if I already have integration test</a></li><li class="list-group-item"><a href='../how-to-test-code-that-depends-on-complex-apis-amazon-s3-for-instance/'>How to test code that depends on complex APIs (Amazon S3 for instance)</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>