<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; In C++, how to call an &#8216;init&#8217; routine as a class is loaded &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1083941 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1083941" class="post-1083941 software type-software status-publish hentry category-software tag-c tag-class tag-configuration tag-initialization"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; In C++, how to call an &#8216;init&#8217; routine as a class is loaded</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">class</span><span class="mr-2 badge badge-warning">configuration</span><span class="mr-2 badge badge-primary">initialization</span></p><div class="entry-content"><p>I have a program that loads a bunch of &#34;addons&#34; (different meters that measure and display system values).</p><p>The &#34;addons&#34; have &#34;grown&#34; over time and the code of what addons to &#34;activate&#34;,<br /> and how many of each (if there is more than one of the &#34;device&#34; in the<br /> system (cpu&#39;s, net-interfaces, etc)  is hard-coded into the master.  Ug<br /> (and ick).</p><p>What I want is for each addon-meter to place it&#39;s name and init-routine-addr<br /> into an array as they are loaded.  Right now, what meters that are loaded<br /> are fixed in the master at compile time.  What I want is for the possibility<br /> of dynamic loading, but more importantly, for external &#34;script-extensions&#34;<br /> (that could measure &#34;almost anything&#34; and rely on the master to display<br /> the collected data (like a script that would read outdoor temperature via<br /> some 3rd party device).  In other words &#8212; long after the master has been<br /> compiled, I want to provide the ability for other addon meters to be added<br /> as long as they supply a specific callable API.</p><p>Thus, as a new extension is added, I need some init routine to be called<br /> <em>as it loads</em> that will place the new meter-name and routine to be called<br /> in a class-singleton that has an array of the extension names and<br /> their init-routine addresses (as in a dynamically loaded extension).</p><p>Then when execution starts, each extension will already have have &#34;registered&#34;<br /> itself with a central list that the &#34;master&#34; can look at and know what<br /> to call.</p><p>In Perl, I&#39;ve used something in a &#34;BEGIN{&#8230;} block&#34; in loaded extensions<br /> to call a <code>Plug_Common-&gt;register(&#34;plugin name&#34;, \%Plugin_Description_Data);</code> so when the main routine started it would look in the plugin-registry to see<br /> what was available, dynamically, at runtime.</p><p>The question is, how do I do this in C++?</p><p>I&#39;ve setup register routine, but I&#39;ve no idea how to have the extensions<br /> get their &#34;name &amp; address&#34; registered before the main-master runs.  Theoretically, since some of the extensions could be added via scripts <em>long after</em> the main-master was written &#8212; it wouldn&#39;t be able to know their names in advance.</p><p>Off the top of my head, I can only think of a &#34;user-edited&#34; static text file, that might be able to have the master, &#34;somehow(?!)&#34; call each extensions init and &#39;get_config&#39; routine.  Then I can get rid of all the &#39;extension/meter-specific&#39;-knowledge out of the the master.  I don&#39;t like the text-file idea as it&#39;s too prone to user-error &#8212; having something being able to automatically call a register-function as it is loaded, seems much less likely to have problems like the static-config file being out-of-sync with what extensions can be used on the system.</p><p>Any ideas? (I&#39;d <em>rather</em> not have to build in a copy of something like Perl to handle the dynamic &#34;loadability&#34; of modules&#8230;to me, that would be &#39;ugly&#39;&#8230;</p><p>Seem a bit unreliable for the master program to try to look through some<br /> symbol table at runtime &#8212; especially with C++&#39;s strong typing.  I keep coming up with flaws in virtually every method I think of. :-(.  Anyone know a better way?  ;-)&#8230;</p><hr/><p>Update:<br /> Had a thought (well more than one, but this one is a bit unconventional, but might work)  What if each of the plugins declared a shared pointer to a global list in the master?)  If the shared pointers were used in module level inits, then wouldn&#39;t the shared &#39;use count&#39; be incremented as the modules were loaded?&#8230;hmmm&#8230; I don&#39;t know yet how to get the modules&#39; addresses into the main array (without them getting any execution time), but if I can figure out a way for an initializer statement using the shared_ptr, then since loading it a non-multithreaded (at least at this point) if that pointer could be leveraged to increment and store the address of an init function, in a global array, that might give me my dynamic config?  Right now, the only thing I know for sure is that shared pointers do have an accessible &#39;use_count&#39; &#8212; which would only help me in determining how many plugins had registered.  Maybe there is no way to make this work, but just a thought (at 5:45am after I&#39;ve been up all night&#8230; so, may be completely flawed and I just don&#39;t see it yet&#8230;;-))&#8230;   Anyway, thought I&#39;d add my latest thoughts;  For scripts I&#39;m thinking of splitting off that type of plugin into a separate handler that would have to read some config&#8230; I don&#39;t really like it, but it does isolate those things that wouldn&#39;t load @ program start time&#8230;  Anyone think it is possible to leverage the shared-pointer to do this?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In most plugin systems in C and C++, the loading of plugins works like this:</p><p>The main application specifies a path where the plugins should be located (or allows such a path to be configured). On startup, the application looks for either dynamically loadable libraries (DLLs on Windows, .so on Linux, in case of compiled plugins) or scripts (in case of interpreted/scripted plugins) in the plugin path.<br/> For each plugin that it finds, the application tries to call an init/registration function that allows the plugin to register itself with the application. For interpreted/scripted plugins, this could be the main body of the script.</p><p>To support interpreted/scripted plugins, the application needs to incorporate a scripting engine that understands the language that the plugin is written in.</p><p>When writing a compiled plugin, one of the rules is that you build it as a dynamically loadable library and that you provide the initialization function with the exact name and signature that the main application expects.<br/> Furthermore, any classes that the plugin provides must be derived from an interface specified by the main application for plugins that provide a certain service.</p><p>For a scripted plugin, the requirement is that the initialization function performs the initializations and registrations that are expected by the main application.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-syntax-of-passing-lambda/'>C++ &#8211; Syntax of passing lambda</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>