<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Is it feasible and useful to auto-generate some code of unit tests &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068330 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068330" class="post-1068330 software type-software status-publish hentry category-software tag-design tag-java tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Is it feasible and useful to auto-generate some code of unit tests</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">unit testing</span></p><div class="entry-content"><p>Earlier today I have come up with an idea, based upon a particular real use case, which I would want to have checked for feasability and usefulness. This question will feature a fair chunk of Java code, but can be applied to all languages running inside a VM, and maybe even outside. While there is real code, it uses nothing language-specific, so please read it mostly as pseudo code.</p><p><strong>The idea</strong><br /> Make unit testing less cumbersome by adding in some ways to autogenerate code based on <strong>human</strong> interaction with the codebase. I understand this goes against the principle of TDD, but I don&#39;t think anyone ever proved that doing TDD is better over first creating code and then immediatly therafter the tests. This may even be adapted to be fit into TDD, but that is not my current goal.</p><p>To show how it is intended to be used, I&#39;ll copy one of my classes here, for which I need to make unit tests.</p><pre><code>public class PutMonsterOnFieldAction implements PlayerAction {
    private final int handCardIndex;
    private final int fieldMonsterIndex;

    public PutMonsterOnFieldAction(final int handCardIndex, final int fieldMonsterIndex) {
        this.handCardIndex = Arguments.requirePositiveOrZero(handCardIndex, &#34;handCardIndex&#34;);
        this.fieldMonsterIndex = Arguments.requirePositiveOrZero(fieldMonsterIndex, &#34;fieldCardIndex&#34;);
    }

    @Override
    public boolean isActionAllowed(final Player player) {
        Objects.requireNonNull(player, &#34;player&#34;);
        Hand hand = player.getHand();
        Field field = player.getField();
        if (handCardIndex &gt;= hand.getCapacity()) {
            return false;
        }
        if (fieldMonsterIndex &gt;= field.getMonsterCapacity()) {
            return false;
        }
        if (field.hasMonster(fieldMonsterIndex)) {
            return false;
        }
        if (!(hand.get(handCardIndex) instanceof MonsterCard)) {
            return false;
        }
        return true;
    }

    @Override
    public void performAction(final Player player) {
        Objects.requireNonNull(player);
        if (!isActionAllowed(player)) {
            throw new PlayerActionNotAllowedException();
        }
        Hand hand = player.getHand();
        Field field = player.getField();
        field.setMonster(fieldMonsterIndex, (MonsterCard)hand.play(handCardIndex));
    }
}
</code></pre><p>We can observe the need for the following tests:</p><ul><li>Constructor test with valid input</li><li>Constructor test with invalid inputs</li><li><code>isActionAllowed</code> test with valid input</li><li><code>isActionAllowed</code> test with invalid inputs</li><li><code>performAction</code> test with valid input</li><li><code>performAction</code> test with invalid inputs</li></ul><p>My idea mainly focuses on the <code>isActionAllowed</code> test with invalid inputs. Writing these tests is not fun, you need to ensure a number of conditions and you check whether it really returns <code>false</code>, this can be extended to <code>performAction</code>, where an exception needs to be thrown in that case.</p><p><strong>The goal of my idea</strong> is to generate those tests, by indicating (through GUI of IDE hopefully) that you want to generate tests based on a specific branch.</p><p><strong>The implementation by example</strong></p><ol><li><p>User clicks on &#34;Generate code for branch <code>if (handCardIndex &gt;= hand.getCapacity())</code>&#34;.</p></li><li><p>Now the tool needs to find a case where that holds.</p><p>(I haven&#39;t added the relevant code as that may clutter the post ultimately)</p></li><li><p>To invalidate the branch, the tool needs to find a <code>handCardIndex</code> and <code>hand.getCapacity()</code> such that the condition <code>&gt;=</code> holds.</p></li><li><p>It needs to construct a <code>Player</code> with a <code>Hand</code> that has a capacity of at least 1.</p></li><li><p>It notices that the <code>capacity</code> <em>private int</em> of <code>Hand</code> needs to be at least 1.</p></li><li><p>It searches for ways to set it to 1. Fortunately it finds a constructor that takes the <code>capacity</code> as an argument. It uses 1 for this.</p></li><li><p>Some more work needs to be done to succesfully construct a <code>Player</code> instance, involving the creation of objects that have constraints that can be seen by inspecting the source code.</p></li><li><p>It has found the <code>hand</code> with the least capacity possible and is able to construct it.</p></li><li><p>Now to invalidate the test it will need to set <code>handCardIndex = 1</code>.</p></li><li><p>It constructs the test and asserts it to be false (the returned value of the branch)</p></li></ol><p><strong>What does the tool need to work?</strong><br /> In order to function properly, it will need the ability to scan through all source code (including JDK code) to figure out all constraints. Optionally this could be done through the javadoc, but that is not always used to indicate all constraints. It could also do <em>some</em> trial and error, but it pretty much stops if you cannot attach source code to compiled classes.</p><p>Then it needs some basic knowledge of what the <em>primitive</em> types are, including arrays. And it needs to be able to construct some form of &#34;modification trees&#34;. The tool knows that it needs to change a certain variable to a different value in order to get the correct testcase. Hence it will need to list all possible ways to change it, without using reflection obviously.</p><p>What this tool will not replace is the need to create tailored unit tests that tests all kinds of conditions when a certain method actually works. It is purely to be used to test methods when they invalidate constraints.</p><p><strong>My questions</strong>:</p><ul><li>Is creating such a tool <em>feasible</em>? Would it ever work, or are there some obvious problems?</li><li>Would such a tool be <em>useful</em>? Is it even useful to automatically generate these testcases at all? Could it be extended to do even more useful things?</li><li>Does, by chance, such a project already exist and would I be reinventing the wheel?</li></ul><p>If not proven useful, but still possible to make such thing, I will still consider it for fun. If it&#39;s considered useful, then I <em>might</em> make an open source project for it depending on the time.</p><p>For people searching more background information about the used <code>Player</code> and <code>Hand</code> classes in my example, please refer to <a href="https://github.com/skiwi2/TCG" rel="noreferrer">this repository</a>. At the time of writing the <code>PutMonsterOnFieldAction</code> has not been uploaded to the repo yet, but this will be done once I&#39;m done with the unit tests.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It&#39;s all just software, so given enough effort it&#39;s possible ;-). In a language which supports a decent way of doing code analysis it should be feasible too.</p><p>As for the usefulness, I think it some automation around unit testing is useful to a certain level, depending on how it&#39;s implemented. You need to be clear about where you want to go in advance, and be very aware of the limitations of this type of tooling.</p><p>However, the flow you describe has a huge limitation, because the code being tested leads the test. This means an error in reasoning when developing the code will likely end up in the test as well. The end result will probably be a test which basically confirms the code &#39;does what it does&#39; instead of confirming it does what it should do. This actually isn&#39;t completely useless because it can be used later to verify the code still does what it did earlier, but it isn&#39;t a functional test and you shouldn&#39;t consider your code tested based on such a test. (You might still catch some shallow bugs, like null handling etc.) Not useless, but it can&#39;t replace a &#39;real&#39; test. If that means you&#39;ll still have to create the &#39;real&#39; test it might not be worth the effort.</p><p>You could go slightly different routes with this though. The first one is just throwing data at the API to see where it breaks, perhaps after defining some generic assertions about the code. That&#39;s basically <a href="https://en.wikipedia.org/wiki/Fuzz_testing" rel="nofollow">Fuzz testing</a></p><p>The other one would be to generate the tests but without the assertions, basically skipping step 10. So end up with an &#39;API quiz&#39; where your tools determines useful test cases and asks the tester for the expected answer given a specific call. That way you&#39;re actually testing again. It&#39;s still not complete though, if you forget a functional scenario in your code the tool won&#39;t magically find it and it doesn&#39;t remove all assumptions. Suppose the code should have been <code>if (handCardIndex &gt; hand.getCapacity())</code> instead if &gt;=, a tool like this will never figure that out by itself.
If you want to go back to TDD you could suggest test cases based on just the interface, but that would be even more functionally incomplete, because there isn&#39;t even code from which you can infer some functionality.</p><p>Your main issues are always going to be 1. Carrying errors in code over to the test and 2. functional completeness. Both issues can be suppressed somewhat, be never be eliminated. You&#39;ll always have to go back to the requirements and sit down to verify they are all actually tested correctly. The clear danger here is a false sense of security because your code coverage shows 100% coverage. Sooner or later someone will make that mistake, it&#39;s up to you to decide if the benefits outweigh that risk. IMHO it boils down to a classic trade-off between quality and development speed.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-the-value-of-checking-in-failing-unit-tests/'>Unit-testing &#8211;  the value of checking in failing unit tests</a></li><li class="list-group-item"><a href='../unit-testing-how-should-i-test-boolean-function-with-many-possible-permutations/'>Unit-testing &#8211; How should I test boolean function with many possible permutations</a></li><li class="list-group-item"><a href='../c-method-to-validate-an-object-should-i-have-one-method-encapsulating-all-validation-logic/'>C# &#8211; Method to validate an object &#8211; should I have one method encapsulating all validation logic</a></li><li class="list-group-item"><a href='../unit-testing-in-tdd-should-i-add-unit-tests-to-refactored-code/'>Unit-testing &#8211; In TDD, should I add unit tests to refactored code</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>