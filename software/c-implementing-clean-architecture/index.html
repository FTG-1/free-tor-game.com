<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Implementing clean architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073415 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073415" class="post-1073415 software type-software status-publish hentry category-software tag-c tag-clean-architecture tag-single-page-apps"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Implementing clean architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">clean-architecture</span><span class="mr-2 badge badge-warning">single-page-apps</span></p><div class="entry-content"><p>I just read the book &#39;clean architecture&#39; by Uncle Bob and really like the approach.<br /> But the big disappointment came when I tried to implement it in C#.<br /> I really hope you can help me with some questions.</p><p><a href="../../../i.stack.imgur.com/0FtkB.jpg" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/0FtkB.jpg" alt="enter image description here"/></a></p><p>What I tried was to implement the following component diagram:</p><p><a href="../../../i.stack.imgur.com/7rWiV.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/7rWiV.png" alt="sample from the book &#34;clean architecture&#34;"/></a></p><p>A = Enterprise Business Rules</p><p>B = Application Business Rules</p><p>C = Interface Adapters</p><p>D = Frameworks &amp; Drivers</p><p>But some things seem strange to me:</p><ol><li><p>A presenter converts the &#34;OutputData&#34; (with for example date objects) in &#34;ViewModel&#34; (that has only strings and flags). So the interface &#34;Output Boundary&#34; could have a function &#34;present&#34; with a parameter of type &#34;OutputData&#34; and return a value with type &#34;ViewModel&#34;. But Output data is <strong>not allowed</strong> to have a code reference to &#34;ViewModel&#34;, so how should this work?</p></li><li><p>The outer most layer is the only layer where &#34;Frameworks&#34; are allowed. But in frameworks the &#34;controllers&#34; are usually build into the framework. So do I have to build a wrapper? So I would put controllers of the framework in the outermost layer and my own &#34;architecture controllers&#34; to the adapter layer? Seems like over engineering to me.</p></li></ol><p>If I look at concrete implementations on the web, this does not really answer my questions.</p><p>For example <a href="https://fullstackmark.com/post/18/building-aspnet-core-web-apis-with-clean-architecture" rel="nofollow noreferrer">this</a> guy created a project with three components:</p><blockquote><p><strong>Web.Api</strong> &#8211; Maps to the layers that hold the Web, UI and Presenter concerns. In the context of our API, this means it accepts input in the form of http requests over the network (e.g., GET/POST/etc.) and returns its output as content formatted as JSON/HTML/XML, etc. The Presenters contain .NET framework-specific references and types, so they also live here as per The Dependency Rule we don&#39;t want to pass any of them inward.</p><p><strong>Web.Api.Core</strong> &#8211; Maps to the layers that hold the Use Case and Entity<br /> concerns and is also where our External Interfaces get defined. These<br /> innermost layers contain our domain objects and business rules. The<br /> code in this layer is mostly pure C# &#8211; no network connections,<br /> databases, etc. allowed. Interfaces represent those dependencies, and<br /> their implementations get injected into our use cases as we&#39;ll see<br /> shortly.</p><p><strong>Web.Api.Infrastructure</strong> &#8211; Maps to the layers that hold the Database and<br /> Gateway concerns. In here, we define data entities, database access<br /> (typically in the shape of repositories), integrations with other<br /> network services, caches, etc. This project/layer contains the<br /> physical implementation of the interfaces defined in our domain layer.</p></blockquote><ol start="3"><li><p>He is not the only one out there having a layer called &#34;infrastructure&#34;. But I did not find this layer in the book. Where does it come from? Sometimes people use it for database access, sometimes for services. Where does the term &#34;infrastructure&#34; come from?</p></li><li><p>He puts &#34;Web, UI and Presenter concerns&#34; in the Web-Layer. So he mixes layers.</p></li><li><p>On web applications &#8211; like an SPA with Angular that accesses an API in the background, I think that my web application should have its own &#34;clean architecture&#34; like described <a href="https://medium.com/intive-developers/approach-to-clean-architecture-in-angular-applications-hands-on-35145ceadc98" rel="nofollow noreferrer">here</a>.<br /> My .NET core application on the server also has its own &#34;clean architecture&#34;. This makes sense to me.<br /> But uncle bob states that &#34;the web is a detail&#34;, so this looks like he would treat Angular only as a &#34;detail&#34; and the UI. But probably he did not think of SPAs while he wrote the book&#8230; SPAs can have a part of the business rules. So how do you deal with that?</p></li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>I just read the book &#39;clean architecture&#39; by Uncle Bob and really like the approach. But the big disappointment came when I tried to implement it in C#. I really hope you can help me with some questions.</p></blockquote><p>You don&#39;t implement Clean Architecture. You follow it, as you implement something else.</p><p>Even if all you&#39;re doing is creating <a href="https://codereview.stackexchange.com/questions/148809/a-button-as-a-clean-architecture-plugin">a reference implementation</a> remember, Clean Architecture is not the goal. It&#39;s only a means to get there. It&#39;s certainly not the only one.</p><blockquote><ol><li>A presenter converts the &#34;OutputData&#34; (with for example date objects) in &#34;ViewModel&#34; (that has only strings and flags). So the interface &#34;Output Boundary&#34; could have a function &#34;present&#34; with a parameter of type &#34;OutputData&#34; and return a value with type &#34;ViewModel&#34;. But Output data is not allowed to have a code reference to &#34;ViewModel&#34;, so how should this work?</li></ol></blockquote><p>No, a presenter converts <strong>an</strong> &#34;OutputData&#34; (with for example date objects) in<strong>to</strong> <strong>a</strong> &#34;ViewModel&#34;.</p><p>Pay attention to the little <strong>&lt;DS&gt;</strong> in the corners of some of these <em>not exactly UML</em> boxes. DS stands for Data Structure. You&#39;re not going to find any external references in the Data Structures. All arrows point to the Data Structures. None point out from them. They don&#39;t know about anything but themselves.</p><blockquote><p>So the interface &#34;Output Boundary&#34; could have a function &#34;present&#34; with a parameter of type &#34;OutputData&#34;</p></blockquote><p>Yes.</p><blockquote><p>and return a value with type &#34;ViewModel&#34;.</p></blockquote><p>No. You can&#39;t return <strong>ViewModel</strong> to the <strong>Use Case Interactor</strong> (the only thing that could have called &#34;present&#34;) because the <strong>Use Case Interactor</strong> doesn&#39;t know what a <strong>ViewModel</strong> is.</p><p>What could happen is the <strong>Use Case Interactor</strong> could build an <strong>OutputData</strong> and then pass a reference to it through the <strong>Output Boundry</strong> to the <strong>Presentor</strong> which would use it to construct / update a <strong>ViewModel</strong>.</p><p>It&#39;s helpful to remember that the &lt;&gt; stuff (&lt;I&gt;&amp;&lt;DS&gt;) can&#39;t call anything.</p><p>I&#39;ve talked about this <a href="https://softwareengineering.stackexchange.com/a/380254/131624">before</a> and created this animated gif to show the flow of control:</p><p><a href="../../../i.stack.imgur.com/gHBKl.gif" rel="noreferrer"><img src="../../../i.stack.imgur.com/gHBKl.gif" alt="enter image description here"/></a></p><blockquote><ol start="2"><li>The outermost layer is the only layer where &#34;Frameworks&#34; are allowed. But in frameworks the &#34;controllers&#34; are usually build into the framework. So do I have to build a wrapper? So I would put controllers of the framework in the outermost layer and my own &#34;architecture controllers&#34; to the adapter layer? Seems like over engineering to me.</li></ol></blockquote><p>Give a perfectly sensibly engineered automobile to a 5 year old who wanted a tricycle and you could argue that it&#39;s over engineered. Clean Architecture is not one size fits all. It gives you flexibility and power at the cost of extra effort. It&#39;s up to you to decide when you really need that.</p><p>In this particular case it would give you the flexibility that comes from expressing only your real needs that the framework fulfills thus making life easier for those who come later to replace the framework or repair it when it experiences a breaking change. If you don&#39;t care about any of that now nothing can make this worthwhile. Just call it &#34;technical debt&#34; and move on.</p><blockquote><ol start="3"><li>He is not the only one out there having a layer called &#34;infrastructure&#34;. But I did not find this layer in the book. Where does it come from? Sometimes people use it for database access, sometimes for services. Where does the term &#34;infrastructure&#34; come from?</li></ol></blockquote><p>It comes from <a href="https://dzone.com/articles/onion-architecture-is-interesting" rel="noreferrer">this</a>:</p><p><a href="../../../i.stack.imgur.com/unQYA.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/unQYA.png" alt="enter image description here"/></a></p><p>Look in the outermost lower right hand sector.</p><p>You&#39;ve likely confused <strong><a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html" rel="noreferrer">Clean Architecture</a></strong> with <strong><a href="https://dzone.com/articles/onion-architecture-is-interesting" rel="noreferrer">Onion Architecture</a></strong>. Same idea, different vocabulary (created to drive you to different blogs and books).</p><p>Getting them confused is an understandable mistake. Both of these are rehashes of Alistair Cockburn&#39;s idea of <strong><a href="https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)" rel="noreferrer">Hexagonal Architecture</a></strong> (that he&#39;s also called <strong><a href="https://wiki.c2.com/?PortsAndAdaptersArchitecture" rel="noreferrer">Ports and Adapters</a></strong>).</p><p>Collectively I call them <a href="https://softwareengineering.stackexchange.com/a/357066/131624">The Buzzword Architectures</a> because the main difference between them is the vocabulary that decides who gets your time and money when you learn about them.</p><p>One thing that unifies them is that they all let you create an architecture <a href="https://en.m.wikipedia.org/wiki/Directed_acyclic_graph" rel="noreferrer">free of cycles</a> that still manages to effectively communicate. This helps ensure a code change hits a firewall soon rather than spreading through the code base breaking component after component.</p><blockquote><ol start="4"><li>He puts &#34;Web, UI and Presenter concerns&#34; in the Web-Layer. So he mixes layers.</li></ol></blockquote><p>Nobody&#39;s perfect.</p><blockquote><ol start="5"><li>On web applications - like an SPA with Angular that accesses an API in the background, I think that my web application should have its own &#34;clean architecture&#34; like described here. My .NET core application on the server also has its own &#34;clean architecture&#34;. This makes sense to me. But uncle bob states that &#34;the web is a detail&#34;, so this looks like he would treat Angular only as a &#34;detail&#34; and the UI. But probably he did not think of SPAs while he wrote the book... SPAs can have a part of the business rules. So how do you deal with that?</li></ol></blockquote><p>How much of your application really needs to know that the web exists? The central theme of all these architectures is isolating knowledge. You&#39;re tempted to spread the idea of the web around until all you&#39;re working on is a web app. Sure, it&#39;s quick and easy now. Be sure it&#39;s something you&#39;re willing to live with. Because once you do this, taking it back isn&#39;t easy.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-is-clean-architecture-by-bob-martin-a-rule-of-thumb-for-all-architectures-or-is-it-just-one-of-the-options/'>Architecture &#8211; Is &#8220;Clean Architecture&#8221; by Bob Martin a rule of thumb for all architectures or is it just one of the options</a></li><li class="list-group-item"><a href='../in-clean-architecture-arent-entities-another-type-of-boundary/'>In Clean Architecture, aren&#8217;t Entities another type of Boundary</a></li><li class="list-group-item"><a href='../clean-architecture-and-microservices/'>Clean Architecture and Microservices</a></li><li class="list-group-item"><a href='../uncle-bobs-clean-architecture-dealing-with-anemic-interactors-tiering-and-front-end-mvvm/'>Uncle Bob&#8217;s Clean Architecture &#8211; Dealing with anemic interactors, tiering, and front-end MVVM</a></li><li class="list-group-item"><a href='../architecture-clean-architecture-should-each-view-have-its-own-presenter-and-viewmodel/'>Architecture &#8211; Clean Architecture: Should each view have its own presenter and viewmodel</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>