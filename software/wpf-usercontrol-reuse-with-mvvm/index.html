<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>WPF UserControl Reuse With MVVM &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072067 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072067" class="post-1072067 software type-software status-publish hentry category-software tag-mvvm tag-view tag-wpf"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">WPF UserControl Reuse With MVVM</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">mvvm</span><span class="mr-2 badge badge-info">view</span><span class="mr-2 badge badge-warning">wpf</span></p><div class="entry-content"><p>I&#39;m struggling to find an elegant and idiomatic way of coding the following scenario using the MVVM paradigm in WPF and was wondering how other people would approach it.</p><p>I have a <code>UserControl</code> in my <code>WPF</code> application which I want to reuse in a number of places. The control is a filtered <code>ComboBox</code> setup allowing users to refine their selections. My example is Department &gt; Team &gt; Person.</p><p><a href="../../../i.stack.imgur.com/ymNqj.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/ymNqj.png" alt="Filtered ComboBoxes being used in three different windows"/></a></p><p>In each scenario I might have the control configured in a slightly different manner. e.g. <code>Window 1</code> might have all the departments, teams, and people; <code>Window 2</code> might only display a subset of all departments; <code>Window 3</code> might be locked to the user&#39;s department and team.</p><p><strong>First (and probably worst) Solution:</strong> <em>Give the <code>UserControl</code> its own ViewModel</em></p><p>This works as far as I can drop the control on each window and it appears to immediately require no further work. The filtering logic is the control&#39;s <code>ViewModel</code> as is the loading of all the lookup values. The problem comes when I then want to get the values and when I want to configure it slightly differently for each scenario, largely because I&#39;ve broken the DataContext inheritance chain. I ended up having the control&#39;s <code>ViewModel</code> subscribe to messages for configuration settings and send messages for reporting value selections and it feels like I&#39;m fighting MVVM/WPF rather than working with it.</p><p><strong>Second Solution:</strong> <em>No <code>ViewModel</code> for the <code>UserControl</code> and Rely on the Window&#39;s <code>ViewModel</code></em> This has the advantage of being easy to interact with the <code>UserControl</code> through the Window&#39;s <code>ViewModel</code> but it feels like I&#39;m duplicating a lot of the loading of lookup values logic as well as the filtering logic.</p><p>I feel like there&#39;s an elegant solution of code-behind and MVVM but I can&#39;t seem to find it! How would you go about solving this requirement?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>To begin with, <a href="https://stackoverflow.com/a/28815689/2571982">this answer</a> seriously lacks theoretical support (i.e. explaining <strong>why</strong>). I would very much second <a href="https://stackoverflow.com/a/58070227/10102452">this answer</a> instead. It is much under-voted because it was posted <a href="https://en.wikipedia.org/wiki/Ten_Years_After" rel="nofollow noreferrer">more than a bit later</a>.</p><p>Your approach should definitely also be guided by a bit of <em>philosophy</em>.</p><h1>MVVM (or <em>How to separate business logic from presentation logic</em>)</h1><p>Let&#39;s see what you have come up with. You have a <code>UserControl</code> with <code>DependencyProperty</code>-ies named <code>Departments</code>, <code>People</code>, <code>Teams</code>, etc. How is this <code>UserControl</code> not exposing business logic when it&#39;s <strong>crowded</strong> with <strong>Domain-specific</strong> nouns? Programming is a lot more <a href="https://www.mediawiki.org/wiki/Naming_things" rel="nofollow noreferrer">about names</a> than you may think. Contrast: <code>TextBox.Text</code> and <code>TextBox.Address</code> as names for properties. The second case suddenly introduces a pre-disposition. An expectation that the value of this property serves a very specific purpose. Never underestimate the names of members and the conceptual communication weight involved.</p><h1>What is a UserControl?</h1><p>Based on your linked answer:</p><blockquote><p>A UserControl is simply an easy way to create a Control using
composition. UserControls are still Controls, and therefore should
solely be concerned with matters of UI.</p></blockquote><p>But, is it? Based on this explanation, a <strong>proper</strong> <code>PersonPicker</code> control would have been:</p><pre class="lang-xml prettyprint-override"><code>&lt;PersonPicker
    FirstItemsSource=&#34;{Binding PersonPickerModel.Departments}&#34;
    SecondItemsSource=&#34;{Binding PersonPickerModel.Teams}&#34;
    ThirdItemsSource=&#34;{Binding PersonPickerModel.People}&#34;
    FirstSelectedItem=&#34;{Binding PersonPickerModel.SelectedDepartment}&#34;
    SecondSelectedItem=&#34;{Binding PersonPickerModel.SelectedTeam}&#34;
    ThirdSelectedItem=&#34;{Binding PersonPickerModel.SelectedPerson}&#34;
    IsFirstItemSelectionEnabled=&#34;{Binding PersonPickerModel.IsDepartmentSelectionEnabled}&#34;
    IsSecondItemSelectionEnabled=&#34;{Binding PersonPickerModel.IsDepartmentSelectionEnabled}&#34;
&lt;/PersonPicker&gt;
</code></pre><p>Oh, by the way, the control should also have been named something like <code>ThreeComboBoxControl</code> or <code>ThreeHierarchiesControl</code>. You named it <code>PersonPicker</code> because that is what you <strong>want it for</strong>. While fully <em>re-usable</em>, the control is not a <code>UserControl</code>... it is a <strong>facility</strong>. If you need a facility for your <strong>very own needs</strong>, you sometimes have to concede: Do you really want a reusable <code>UserControl</code>, or a reusable <strong>business tool</strong>? If you decide that it is a business tool, it makes <strong>perfect sense</strong> to have a specific viewmodel for it.</p><h1>View-models are over-interpreted</h1><p>Binding, in WPF, does not care about class types, only about <strong>property names</strong>. As long as an object of type <code>PersonPickerModel</code> exists in your bound <code>DataContext</code>, in your example, and it carries properties with the bound names (and, of course, the property types are compatible), everything will work properly, regardless of whether your <code>PersonPickerModel</code> is named as such, or any other way. You can even define it as an object.</p><p>In short, what you have come up with is an intermediate between a <code>UserControl</code> and a business tool. Even if only for the correctness of it, I suggest you reconsider, what it is that you need between the two. If you need a business tool, keep the names, create a tailor-made viewmodel. Think about this... you have a <code>Window</code> or something else, and:</p><pre><code>&lt;PersonPicker DataContext=&#34;{Binding PersonPickerViewModel}&#34;/&gt;
</code></pre><p>The bindings can be placed <strong>inside the control&#39;s xaml code</strong> because you are only ever going to use it for the very specific reason of picking people. Why do you <strong>have</strong> to be so <strong>verbose</strong> in every place where you are going to reuse your control? Just pass it the ViewModel and leave the rest to that.</p><p>But there is a really clearer reason why this is better than what you are already have.</p><h1>Your solution is imparting a <strong>false sense of reusability</strong>.</h1><p>Designing a truly abstract &#34;proper&#34; UI control is <strong>hard</strong> and not to be underestimated. Look what you have come up with, three adjacent combo-boxes. What do they represent? Departments? Teams? No, it&#39;s <strong>collections</strong>. Why <strong>three</strong>? Why not <strong>four</strong>, or, even better, a <strong>variable number</strong>. A proper control pretending to cover your specific needs would have to offer a variable number of collection handling. What are these collections? Simple strings? More complicated viewmodels?</p><p>So far, we have pretty much come up with a <code>MultiComboBox</code> control. Think about that, a variable number of ComboBoxes, their ItemsSource bound to a different collection, as per your needs, ViewModels can be used for that. You know how to use a <code>ComboBox</code> and you definitely understand its <strong>conceptual representation</strong>, so you will not have a hard time juggling multiple of these. Thereafter, you can expose them in the code-behind through collections of <code>ItemsSource</code> and <code>SelectedItem</code> properties, accessible by index, maybe? You have dozens of possibilities (and loads of <strong>responsibilities</strong>, of course) because a <code>UserControl</code> is <strong>abstract</strong>.</p><p>Designing a <code>UserControl</code> means that nobody cares that you have <em>Departments</em>, <em>Teams</em> or <em>People</em>. Creating &#34;non-generally-but-partially-reusable&#34; <code>UserControl</code>s is a <strong>bad practice</strong> but a <strong>good workaround</strong> so use that to your benefit when MVVM-ing around.</p><p>EDIT:</p><hr/><blockquote><p>I&#39;m not certain... but it feels like the selection in one ComboBox
affecting the items of another could be considered a pure UI concern
and something which belongs in the code-behind- depending on the
selection logic, I guess.</p></blockquote><p>Tomorrow, your requirements suddenly change! You don&#39;t want <code>ComboBox</code>es, you want <code>ListBox</code>es. Think about it, more beautiful. You select a Department in the first list, second list immediately shows you the Teams, you avoid an additional click (at the cost of some more UI space). So you decide to build another control, one with three list boxes (or <code>ListView</code>s for that matter, or anything else). Do you write the filtering logic again? Copy-paste it, maybe?</p><p>Whatever it is that you are referring to as &#34;filtering logic&#34; is <strong>emphatically not a UI concern</strong>. Most basic <code>UserControl</code>s are that basic for a good reason: they try to avoid assumptions about what you would want to do, as much as possible. They simply try to convey the user&#39;s reactions to you, the programmer. Any additional &#34;initiative&#34; only robs you of flexibility.</p><p>A <code>Button</code> is the abstraction for &#34;producing clicks&#34;. A <code>ComboBox</code> is an abstraction for making a selection from a collection. A <code>ListBox</code> too. A <code>ListBox</code> does not offer anything more than a <code>ComboBox</code> in terms of abstractions, it only has a different <strong>fanciness</strong> in terms of presentation. That is your keyword, there! <strong>Presentation</strong> (as in Windows Presentation Foundation).</p><p>Whenever you compose a <code>UserControl</code> from these basic UserControls, you are practically risking <strong>breaking</strong> this elegantly meaningless abstraction. Your <code>UserControls</code> should only &#34;chain&#34; abstractions together. In that sense, the <code>UserControl</code> you are trying to create offers the abstraction of <strong>making three selections at once</strong>. A filtering logic is, again, <strong>emphatically NOT a UI concern</strong>. My simple way to argue about this was that you might need to change the UI and the filtering logic would have to be re-written, instead of simply being <strong>attached</strong>. That&#39;s your other keyword there. <strong>Attached</strong>, like ViewModels attach to controls.</p><p>The only job of your controls should be to model and abstract away user interaction, and user interaction does not include filtering lists anymore than the remote control of a TV includes logic for producing two-digit values (as when you click two numbers in sequence). You press the number 1 twice in a row, within 3-4 seconds, which takes you to channel 11. Do you think this wait for a second input within 3-4 seconds is &#34;coded&#34; into the remote control, so that the number 11 is sent to the TV after 3 seconds? Or... the signal for number 1 actually simply travels in <em>two</em> occurrences, 3-4 seconds apart, with <strong>the TV deciding what to do next</strong>, instead?</p><p>Well, your <code>UserControl</code> is the remote control, the TV is your model. It receives two notifications about the pressing of button <strong>1</strong>, one now, one in three seconds. The <code>UserControl</code> has to ask you for collections and convey potential selections from items of the collections to you, the programmer. This is, pretty much, where its responsibilities end. The rest is... philosophy ;)</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../who-should-control-navigation-in-an-mvvm-application/'>Who should control navigation in an MVVM application</a></li><li class="list-group-item"><a href='../architecture-mvvm-and-service-pattern/'>Architecture &#8211; MVVM and service pattern</a></li><li class="list-group-item"><a href='../again-mvvm-mvp-story-passing-interface-of-a-view-to-its-view-model-why-it-is-bad/'>Again MVVM / MVP story , passing interface of a view to its view model why it is bad</a></li><li class="list-group-item"><a href='../c-net-mvvm-software-architecture-and-naming-conventions/'>C# .NET MVVM software architecture and naming conventions</a></li><li class="list-group-item"><a href='../wpf-mvvm-loading-data-on-startup/'>WPF MVVM Loading data on startup</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>