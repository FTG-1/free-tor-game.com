<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>MVC &#8211; Database search logic in View or Model &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085794 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085794" class="post-1085794 software type-software status-publish hentry category-software tag-design tag-design-patterns tag-mvc tag-ruby-on-rails"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">MVC &#8211; Database search logic in View or Model</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">mvc</span><span class="mr-2 badge badge-primary">ruby-on-rails</span></p><div class="entry-content"><blockquote><h3>Special Note:</h3><p>I asked a very similar question on Stack Overflow, but I have since decided the problem should be solved from a design standpoint rather than an implementation standpoint. I have removed a lot of the coding details from my original problem, as well as concerns about where individual bits of logic should go. I do think I will close my question on Stack Overflow. I am also welcome to advice or criticism if you would like to comment on this decision, as that will only help me in the future. Thanks!</p></blockquote><hr/><hr/><hr/><blockquote><h2>I would like to make sure my code is properly organized/designed according to the following paradigms/patterns:</h2></blockquote><h3>&#8211; Model View Controller</h3><h3>&#8211; Rails Convention over Configuration</h3><h3>&#8211; Skinny Controller, Fat Model</h3><p>I have listed them here in the order I think is most important.</p><hr/><h3>My issue</h3><blockquote><p>I am using Rails to develop my current project and as it stands now, all of my application logic in is the controllers. The models only contain information defining the relationships between tables. After reading several articles, in particular <a href="http://www.sitepoint.com/10-ruby-on-rails-best-practices/" rel="nofollow">this one</a> and <a href="http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model" rel="nofollow">this one too</a>, I started to move some of the logic in my controllers, to my models.</p><p>However, I can&#39;t decide whether or not to move my searching logic (explained in depth, later) from the controller to the model, even after reading more posts/articles like these: <a href="http://zenofcoding.com/2009/01/06/another-way-to-think-about-mvc/" rel="nofollow">MVC Thinking</a>, and <a href="https://stackoverflow.com/questions/3499336/in-mvc-where-do-you-draw-the-line-between-a-controller-and-model?lq=1">Model vs. Controller</a>, <a href="https://stackoverflow.com/questions/29724991/cleaning-up-view-ruby-logic-and-separating-concerns-into-model-controller">Separating concerns</a> and many more not listed here.</p></blockquote><hr/><h3>The scenario</h3><p>Part of some website allows users to search for some <em>things</em>. Let&#39;s call these <em>things</em> &#8211; <strong>neatObjects</strong>.  The user doesn&#39;t know exactly how the results are matched against their input.</p><p>This is similar to the way many searches work. Take YouTube for example: you enter a search input and videos are shown to you that <strong><em>match</em></strong> your input. These videos probably have your input in their title, but you may also see videos whose titles don&#39;t exactly match your input. Your input is probably being tested against video descriptions, tags, authors, and the results may be influenced by your recently watched videos, or searches, as well as many other factors. The point is, the user doesn&#39;t know exactly how these videos are found, but is happy because it works. The same scenario is happening here.</p><blockquote><p>Some development/design team has decided how to match <strong>neatObjects</strong> to user&#39;s inputs, and now some poor full-stack developer who has been given the job of implementation, has to decide how to organize the logic between the controller and the model.</p></blockquote><p>It isn&#39;t important to focus on the details of my particular case, but to be able to talk about concrete examples, I will describe some details:</p><p><strong>View</strong><br /> The view consists of two pages, a user inputs a string on the search page, and then views results that match on the view page.</p><p><strong>Controller</strong><br /> A controller serving the view will need to make the list of results available to the view page.</p><p><strong>Model</strong><br /> The model at least defines the relationship between <strong>neatObjects</strong> and other tables in the database.</p><p><strong>Database</strong><br /> The database stores an <strong>id</strong>, a <strong>description</strong>, an <strong>address</strong>, and a <strong>date_created</strong> in the <strong>neat_objects</strong> table.</p><hr/><h3>The <em>matches</em> test</h3><blockquote><p><strong>A neatObject <em>matches</em> a search string if the search string is contained within its description or its address, ignoring case and leading/trailing whitespace.</strong></p></blockquote><p><strong>This definition is not guaranteed to be permanent.</strong> There are several things that may change our definition. We may need to test against more attributes than just address and description, perhaps if the database guys add a new important attribute, or the UI/UX guys decide users should be able to search by ID. And of course, the opposite of these scenarios would mean we need to remove an attribute from the list of attributes we are testing. There are many situations that could change our definition of a <strong><em>match</em></strong>. We could even have to add or remove logic, perhaps if it is decided that we should only test the first word in the description attribute, or perhaps if we should no longer ignore case.</p><hr/><h2>Sample Implementation</h2><p>The search functionality can easily be implemented in either the <strong>NeatObject</strong> model, or the controller serving the view. I don&#39;t want to get caught up on the code, but I wanted to include it so that each step in this process is outlined. I have included both code samples so that individual parts of either implementation may be referenced by myself or anyone responding to the question, if need be.</p><h3>Search logic in controller:</h3><pre><code>#searches_controller.rb  

#This is the method invoked when second page receives POST request
def search
    @neatObjects = NeatObjects.all.to_a  

    @neatObjects.delete_if { 
        |neatObject| !matches?(neatObject, params[:searchString])
    }
end

def matches?(neatObject, searchString)
    if((neatObject.description.downcase.include? searchString.downcase) ||
       (neatObject.address.downcase.include? searchString.downcase))
        return true
    end
    return false
end
</code></pre><h3>Search logic in Model</h3><pre><code>#NeatObject.rb  

def self.get_matches_for(searchString)
    all.to_a.delete_if { |neighborhood| !matches?(searchString, neighborhood) }
end

def self.matches?(phrase, neighborhood)
    fields = [neighborhood.name, neighborhood.address]

    fields.map!(&amp;:downcase)
    phrase.downcase!

    fields.each do |field|
        if (
            (phrase.include? field) ||
            (field.include? phrase)
           )
            return true
        end
    end

    return false
end  



#searches_controller.rb

def search
    @neatObjects = NeatObject.get_matches_for( params[:searchString] )
end
</code></pre><hr/><hr/><hr/><blockquote><h2>Concerns</h2><p>I can see pros and cons to both the model method and the controller method, but there are things that I&#39;m still unsure about.</p></blockquote><p>When I read over that article I&#39;ve referenced several times (just like I did <a href="http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model" rel="nofollow">here</a>), it was very logical that the model defined a function to return the recently added people.</p><p>The controller in the article didn&#39;t have to implement the logic to determine if a <strong>person</strong> had been recently added. It makes sense that the controller shouldn&#39;t, because that is dependent on the data itself. There might be a completely different implementation of the &#34;recency&#34; test for <strong>messages</strong>. The recent people might include people added this week, while recent messages are only those messages sent today. And what if that test changes?</p><p>I feel controller should just be able to say <code>People.find_recent</code> or <code>Message.find_recent</code> and know it got the correct results. So, it should also be able to say <code>People.find_someOtherTime</code> or <code>People.find_someOtherOtherTime</code>, right? But once you need to handle several cases, you should just put them together in one method, right?</p><p>The author of that article also pointed out something that brought about a lot of confusion and concern for me. He said that you could alter the <code>find_recent</code> method to take in a parameter to specify <code>recent</code> like so: <code>find( :recent )</code>. (Ignore that fact that find is already defined in Rails.) That makes sense, but how many different arguments do you account for? Just recent, and not_recent? Or recent, last_month, last_year, and really_old? At some point this just becomes a search function, right? And then we are back to problem this post is about.</p><blockquote><h2>My biggest concerns/questions:</h2></blockquote><p>I think the matching logic belongs in the model, because there are certain/specific attributes that are used in testing, and those attributes are different depending on the data. We might have different attributes for different tables, and those attributes <strong><em>definitely</em></strong> shouldn&#39;t be defined by the controller, since the data is not dependent on the controller. I know the controller depends on the model, not the other way around, so the model <strong><em>must</em></strong> define those attributes, even if the rest of the logic is in the controller.</p><ul><li><p>If the model defines the attributes that are used when searching, why shouldn&#39;t it also define the entire search function?</p></li><li><p>Should a controller be able to find <strong><em>matches</em></strong> for user input with <code>NeatObject.get_matches_for( searchString )</code>?&#39;</p></li></ul><p>If the controller doesn&#39;t handle the search logic, it still needs to send the user&#39;s input to the model. Does it clean it up before it sends it? (Removing leading/trailing whitespace and downcasing the string.) Does it just send the exact input it got from the user?</p><ul><li>If the model is concerned only with the data, how can one justify passing user input to it? Especially if the model has to clean up that input before it can even use it.</li></ul><p>If the search/matching process was simpler, would the code&#39;s place change? For example, if the searching was simpler:</p><ul><li>If the only attribute being tested was the address and that was unlikely to change, would we just handle the search with the controller?</li></ul><p>What about more complicated:</p><ul><li>If we were making an advanced search feature, where the user decided which attributes to include in the search and also controlled some other factors, there would be a lot of user input just to define the arguments to the search function. Would that be too much logic or user input to place in the model?</li></ul><hr/><hr/><hr/><blockquote><h1>In conclusion</h1></blockquote><ul><li><p>How can I always be sure that I am putting logic in the right place for MVC?</p></li><li><p>What guidelines can be followed when you find a gray area, or are unsure about where logic belongs?</p></li></ul><p>And most importantly and least answerable:</p><ul><li>Does search logic belong in the controller or the model?</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The View is responsible for displaying data and accepting input from the user.</p><p>The Controller is responsible for accepting requests and directing them to the proper method in the model for performing the requested operation, including related operations such as granting or denying security access and form validation.  It is also responsible for directing the resulting output to the View.</p><p><strong>The Model is responsible for everything else that you mentioned in your question</strong></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../mvcs-model-view-controller-store/'>MVCS &#8211; Model View Controller Store</a></li><li class="list-group-item"><a href='../mvc-model-view-controller-does-the-user-interact-with-the-view-or-with-the-controller/'>Mvc &#8211; Model-View-Controller: Does the user interact with the View or with the Controller</a></li><li class="list-group-item"><a href='../mvc-where-to-put-user-interface-domain-model-manipulation-logic-transferring-data-from-the-view-to-domain-model/'>Mvc &#8211; Where to put User Interface/Domain Model manipulation logic (transferring data from the view to Domain Model)</a></li><li class="list-group-item"><a href='../database-getting-data-from-a-database-with-the-mvc-model/'>Database &#8211; Getting data from a database with the MVC model</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>