<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; Data integrity in NoSQL situations &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075464 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075464" class="post-1075464 software type-software status-publish hentry category-software tag-architecture tag-design-patterns tag-node-js tag-nosql tag-relational-database"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; Data integrity in NoSQL situations</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">node.js</span><span class="mr-2 badge badge-primary">nosql</span><span class="mr-2 badge badge-danger">relational-database</span></p><div class="entry-content"><p><strong>Background</strong></p><p>To start off, at work I work with a legacy system that, in its day, was quite spectacular, but now is &#8230;interesting&#8230; to work with. It uses IBM (now Rocket) UniVerse as its backing database. One particular part of it that has caused some issues is its lack of data-integrity checks. By data integrity, I don&#39;t mean file corruption, but rather things like orphaned records or invalid keys. The particular version they use doesn&#39;t support things like triggers and such and so unless the programmer remembered to update their computed indexes, it becomes &#34;broken&#34; and filled with bad data. Now, the other programs have been built to live with this bad data, but it is most annoying when putting it into another database, such as MySQL (using InnoDB as the engine) which actually has constraints on the data.</p><p><strong>The question</strong></p><p>I&#39;m experimenting with MongoDB and NodeJS just to see what all the hype is about. I really like Mongoose as well and its schema system. I&#39;ve been reading a lot about what to store on each record vs in a separate collection. Perhaps its just my own RDBMS bias, but I decided to store each &#34;type&#34; of thing in a separate collection and utilize Mongoose&#39;s &#34;populate&#34; functionality to essentially relate the records together. Now, I am sure someone is going to say that that is going against the whole NoSQL thing, but I haven&#39;t really read anywhere that says that just because something stores documents instead of records and has no set schema on the db level that it can&#39;t be made relational.</p><p>In my experiment, I have &#34;Posts&#34; and &#34;Comments&#34;. I see four ways to store the relation between these two:</p><ul><li>The full data for each comment is put directly onto the post as a subdocument. There are two main cons that I have seen with this: If I decide to put comments on something else (let say a &#34;Page&#34;) as well, I have to essentially repeat myself and it isn&#39;t quite as simple to find out how many comments a user has posted if the comments are actually stored in several collections</li><li>Comments are a separate collection and they store their parent&#39;s key and a Schema name for mongoose to use when populating (the schema name switching wouldn&#39;t be automatic). This isn&#39;t too bad, but its biased towards loading comments first and posts later. Finding out the comments on a post isn&#39;t hard, but requires a manual query.</li><li>Comments are a separate collection and posts have a list of comment ids that relate to them. This is biased towards loading posts first and finding out what a comment is attached to becomes difficult. However, mongoose would let me load the comments without having to write anything additional.</li><li>Comments are a separate collection and have a parent id. Posts also have a list of comment ids. This combines the above two methods and neutralizes their cons and makes for relatively few &#34;manual&#34; queries, but introduces the possibility of data becoming dirty and out of sync like the legacy system that I described above (e.g. a comment says it belongs to one post and another post (or multiple posts) claims that they own that comment).</li></ul><p>I was going down the latter path listed above and I realized that I was starting to enter the realm of this legacy system that had caused so many headaches with its manually updated indexes and possibility for bad data.</p><p>Now, I don&#39;t expect to do a ton with this little experiment of mine, but its the principal of the thing that has me thinking. What would you all recommend to go with on this? I want to be able to keep query counts low, but I also don&#39;t want to have to remember to update all these indexes. There has to be a happy medium somewhere.</p><p>Another option, of course, is to just use MySQL with some nice schema constraints, but that isn&#39;t the point of this particular exercise for me since I&#39;ve done that tons of times already.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>my experience on using node.js with NoSQL resulted in skipping Mongoose and using the <a href="https://github.com/mongodb/node-mongodb-native" rel="nofollow">node-mongodb-native driver</a>.</p><p>Reasons for this is that Mongoose actually conflicts with the node.js way of doing things, this means building your own need-framework by gluing up different tools together. Mongoose looks great if you come from a traditional environment but you will notice quick limitations of things which just go complicated. Better use the native driver and if necessary create a customer helper manager for specific collections.</p><p>Regarding your origin question I would recommend you to take the first concept and put everything in one document. I know that in the beginning it sounds silly as you feel wasting resources. This is something we have learned from data modeling table structures in MySQL. This all is not necessary with document-orientated DBs. Their idea is making things as simple as possible and just store the document you take. Believe me everything else is just waste of time. When I look back how much time I wasted just trying to build a REST API which supports Mongoose populating...</p><p>As conclusion I would recommend to just think about document orientated databases as just a persistence for serialized objects and as long as you do not plan any complicated queries or you plan to have data only once in order to keep it up-to-data avoid wasting your time with trying to rebuilt MySQL.</p><p>Hope it helps you.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-model-for-keeping-track-of-likes-shares-comments-on-blog-posts-over-time/'>Database model for keeping track of likes/shares/comments on blog posts over time</a></li><li class="list-group-item"><a href='../n-accepted-design-pattern-for-storing-a-few-global-variables-in-a-nosql-database/'>N accepted design pattern for storing a few global variables in a NoSQL database</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>