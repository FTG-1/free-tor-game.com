<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>DDD: Is an aggregate root responsible for deleting its child entities from their repository &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068776 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068776" class="post-1068776 software type-software status-publish hentry category-software tag-aggregate tag-domain-driven-design tag-hierarchy"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">DDD: Is an aggregate root responsible for deleting its child entities from their repository</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aggregate</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">hierarchy</span></p><div class="entry-content"><p>I am developing a large software project using DDD (Domain-Driven Design). I have an entity that acts as an aggregate root, let&#39;s call it <code>Root</code>. This entity refers to a collection of child entities of the type <code>Child</code>.</p><p>Because the use of this <code>Child</code> entity is an implementation detail that does not matter to clients of my <code>Root</code> entity, those children are solely managed by the <code>Root</code> entity, meaning the creation of new children and the removal of existing children all takes place in according methods of the <code>Root</code> entity. Pseudocode could look the following</p><pre><code>class Root 
{
    private Collection&lt;Child&gt; children;

    public void addChild(ChildParameters params) 
    {
        this.children.append(new Child(params));
    }

    public void removeChildByCriteria(Criteria removalCriteria)
    {
       Child foundChild = this.children.findByCriteria(removalCriteria);
       if (foundChild) {
           this.children.remove(foundChild);
       }
    }
}
</code></pre><p>I think this is a very clean approach if you only look at the object model. However, this has to be persisted somewhere, so a <code>Repository</code> takes care of storing a <code>Root</code> entity and its children in a database.</p><p>I am struggling now with finding the right place for the logic to remove a persisted child from the repository (and therefore the database). Is it ok to let the implementation of the repository find orphaned children and remove them automatically? Or is the deletion of orphaned children domain logic that should be explicitly coded inside the root entity by passing a repository to the <code>removeChildByCriteria</code> method like</p><pre><code>// ...
public void removeChildByCriteria(Criteria removalCriteria, ChildRepositoryInterface childRepository) 
{
    Child foundChild = this.children.findByCriteria(removalCriteria);
    if (foundChild) {
        this.children.remove(foundChild);
        childRepository.remove(foundChild);
    }
}
// ...
</code></pre><p>Or is it all wrong to place the logic to manage the hierarchy inside the root entity and instead a domain service or domain events and according listeners should be used?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You should review Udi Dahan&#39;s arguments in <a href="http://udidahan.com/2009/09/01/dont-delete-just-dont/" rel="nofollow noreferrer">Don&#39;t Delete - Just Don&#39;t</a>.</p><p>Of course, since then <a href="https://www.eugdpr.org/" rel="nofollow noreferrer">GDPR</a> has become a thing.  So you may want to include <a href="https://en.wikipedia.org/wiki/Right_to_be_forgotten" rel="nofollow noreferrer">Forget Me</a> as a domain concept.</p><blockquote><p>Is it ok to let the implementation of the repository find orphaned children and remove them automatically?</p></blockquote><p>That seems perfectly acceptable to me.</p><p>Evans, in the blue book, writes</p><blockquote><p>A delete operation must remove everything within the AGGREGATE boundary at once.</p></blockquote><p>I&#39;m a bit disappointed at the lack of attention that he pays to the topic in the book.</p><p>Evans describes REPOSITORY as an abstraction of an in memory collection.  Fundamentally, a delete operation breaks the link between the key (identifier) and the aggregate root, which allows the aggregate root to eventually be garbage collected in a domain agnostic way.</p><p>If your backing store were actually a RDBMS, rather than an in memory collection, then a cascade delete is a pretty reasonable approximation.  That could be implemented in the data store itself, or written into your repository/ORM logic.</p><p>But if your delete protocol requires domain <em>specific</em> actions -- sending messages to other systems, and so on, then you should probably have a method within the aggregate that expresses that logic.  Transforming a representation of an active aggregate to a representation of an end-of-lifed aggregate is a domain model responsibility.</p><p>&#34;Delete&#34; could reasonably mean either or both of these actions, but the responsibilities for them are clearly separated.</p><p><strong>EDIT</strong></p><p>I missed this on the first pass</p><blockquote><p>its child entities from their repository?</p></blockquote><p>Child entities don&#39;t normally have a repository of their own.  Once you have decided that an entity belongs to an aggregate, it is subordinate to the aggregate root.  You would normally arrange that <em>all</em> of the entities in the aggregate are loaded by the repository used to load the root.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-work-with-large-aggregate-roots/'>How to work with large aggregate roots</a></li><li class="list-group-item"><a href='../can-clients-call-methods-on-entities-other-than-the-aggregate-root/'>Can clients call methods on entities other than the aggregate root</a></li><li class="list-group-item"><a href='../object-oriented-relations-between-entities-in-ddd/'>Object-oriented &#8211; Relations between entities in DDD</a></li><li class="list-group-item"><a href='../aggregate-relationships-in-domain-driven-design/'>Aggregate relationships in Domain Driven Design</a></li><li class="list-group-item"><a href='../java-updating-nested-objects-in-ddd-aggregate-by-example-delegation-or-direct-access-from-the-root/'>Java &#8211; Updating nested objects in DDD Aggregate by example: delegation or direct access from the root</a></li><li class="list-group-item"><a href='../domain-driven-design-updating-and-persisting-aggregates/'>Domain Driven Design &#8211; Updating and persisting aggregates</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>