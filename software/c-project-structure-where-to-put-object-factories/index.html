<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Project structure: Where to put object factories &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076956 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076956" class="post-1076956 software type-software status-publish hentry category-software tag-c tag-factory tag-visual-studio"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Project structure: Where to put object factories</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">factory</span><span class="mr-2 badge badge-warning">visual studio</span></p><div class="entry-content"><p>I am working on a C# programming project in Visual Studio. I have created various VS library projects inside the VS solution containing the various components of the solution. Without giving it too much thought, I have put the factories for these components into their corresponding VS projects.</p><p>I have now needed to reuse one of these components inside another VS solution and realized that having the factory inside the components VS project may not be the correct way, since in the new project I have different requirements for the factory to construct the object (e.g. parameters, etc.). So this would suggest, that the factory should not form part of the components VS project.</p><p>On the other hand factories appear to be very closely bound to the components/objects they construct. For me this raises the question, where I should put them:</p><p>Should factories be part of the solution using the components library or should it be part of the library?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h2>TLDR</h2><p>It depends on how configurable and extendable you want to have the reusable library (project), without touching it.</p><p>In the end you either have factories in the library itself, or the library does not have them and the client (the user) of the library is responsible for creating them and instantiating the library himself.</p><hr/><h2>Longer answer</h2><p>No matter how object oriented your code is, a part of OO code will always have to be procedural. The part where the object graph is constructed, the <code>new</code>ing of the classes.</p><p>When dealing with construction of classes belonging to another project (this will usually be some common library which contains code useful throughout more projects), you usually have two options how to expose the project to the outer world.</p><p><sub>For this demostration purpose I chose the cache layer, which, from my experience, usually has very similar API throghout many different projects, only the configuration is different.</sub></p><h2>1. Creating a public endpoint of the library to expose it</h2><p>If you were to follow this ideology, all the classes inside your <code>cache</code> library project would be set to <code>internal</code> except one class, perhaps a <code>YourNamespace.Library.Cache</code> class, which would be set to <code>public</code>, thus if you were to use the cache library, the only class you would have publicly access to is one single endpoint.</p><p>The <code>YourNamespace.Library.Cache</code> class constructor could look like this:</p><pre><code>public class Cache : CachingInterface
{
    public Cache(string configuration)
    {
        // this is where the magic happens
    }
}
</code></pre><p>Not saying very much, is it? What exactly is the <strong>magic</strong> I am talking about?</p><p>Notice the <code>configuration</code> string as a parameter. It is a variable in which you define what you want to have, you insert your configuration, and this one public endpoint, the <code>YourNamespace.Library.Cache</code> class, will, in its constructor, parse this string, extract the data it needs from it, and based on the user input construct everything necessary.</p><p>Inside this constructor the <code>Cache</code> endpoint will instantiate the factories belonging to the cache project, it will the use those to instantiate the correct implementations.</p><p>In your main project, the code then could be as simple as this:</p><pre><code>var cache = new YourNamespace.Library.Cache(&#34;type:redis,connection:[schema:tcp,host:localhost,port:3000,database:master],options:[replication:true]&#34;);
</code></pre><p>By parsing the string, the constructor will then see, you want to cache to redis, and provided the configuration, it will use the configuration and pass it onto the internal classes of the cache library, which know what to do with it.</p><blockquote><p>Be aware the configuration does not need to be a string, you may use
 whatever you want.</p></blockquote><p><strong>The placement of the factories</strong></p><p>When using this approach, the factories are inside the cache project. In fact, the one public endpoint, the <code>Cache</code> class, acts as a factory itself.</p><p>The project itself calls <code>new</code> on desired object based on the <code>configuration</code> string and after the construction of the endpoint, should it not throw an exception, you are set to use all the functionality of the library.</p><p><strong>The good</strong></p><ul><li>the construction of a very complex library is simplified to one single endpoint, which only requires some configuration (be it a string, an array,...) described in documentation</li><li>you do not expose the internal parts of the library, so as long as you do not change the endpoint, you can optimize it, release new versions and the clients of this library need not to change anything in their code</li></ul><p><strong>The bad</strong></p><ul><li>if someone uses your library and wants to add his custom caching mechanism (perhaps a faster Redis driver or a completely new caching mechanism), he has to contact the owner of the library the add it</li><li>you need to create thorough documentation, so people know, how to use the endpoint and what configuration it offers</li></ul><h2>2. Exposing everything inside the library and letting the client of the library decide what he wants to construct</h2><p>Using this approach, (almost) all classes inside the cache library will be set to public, all  the interfaces, all the implementations, everything.</p><p>Besides the unit tests part of the cache library, there will probably be no usage of the <code>new</code> keyword inside the cache library. The library itself will not construct anything, it will only provide constructors and methods with predefined types of parameters, to let you know which exact class you will need if you want to instantiate a class.</p><p><strong>The placement of the factories</strong></p><p>Considering the cache library itself does not construct anything, the only place where you will have the factories is your main project, or the project of the client using the library.</p><p>The client himself will be responsible for constructing the object graph, by <code>new</code>ing the dependencies, until he creates the final object representing the cache itself.</p><p><strong>The good</strong></p><ul><li>the library is very easily extendable by the end user, would he want to use some custom implementation of a part of the library, he simply needs to adhere to the contract presented by the type of an object a class requires for its construction, perhaps by implementing an interface or extending a class</li><li>the creator of the library itself does not need to create a lot of documentation describing the construction, because by following the dependency injection principle, it is always pretty clear, which other classes you need in order to construct the class you desire</li><li>the client may very easily manipulate concrete implementations to make the library suitable for the project he is using it in</li></ul><p><strong>The bad</strong></p><ul><li>the construction in client code may become (really) ugly</li></ul><p>You are likely to see something like this in the client code:</p><pre><code>var depOne = new One();
var depTwo = new Two(depOne);
var depThree = new Three(depTwo);
var depFour = new Four(depThree);
// ...
var depTwentySeven = new TwentySeven(depTwentySix);
var cache = new Cache(depTwentySeven);
</code></pre><p>This is an extreme example, the amount of dependencies would probably vary, based on the type of cache you would like to construct, but it can happen.</p><ul><li>because the client is responsible for creating all the dependencies, some of them may use the first pattern I am describing in this example for construction, meaning the client of the cache library is forced to check the documentation of the third party library to know how he is supposed to construct the dependency for the cache library.</li></ul><hr/><h2>Summary</h2><p>Before diving in, you should decide, what it is you want.</p><p>If you want to encapsulate the library and want to have it its own environment and hide its complexity behind a simple abstraction layer, I would say go with a variation the first approach.</p><p>I would also use the first approach when I wanted to reflect all the internal changes in the library in all the projects where the library is used.</p><p>If you want the library to be easily extendable and you are likely to provide custom implementations, go with approach number two, where the library is not responsible for the construction, but gives clues on how the construction should happen.</p><p>But be aware, that change in the library will most likely need more change in the client code.</p><p>There is also always the <strong>third approach</strong>, which is a result of combining the first and second together, where then there are factories in both the library itself and also the client code.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../use-a-factory-class-instead-of-direct-object-construction/'>Use a factory class instead of direct object construction</a></li><li class="list-group-item"><a href='../c-instantiate-an-engine-from-a-second-project-without-having-a-reference-to-the-second-project-causing-a-circular-reference/'>C# &#8211; Instantiate an engine from a second project without having a reference to the second project causing a circular reference</a></li><li class="list-group-item"><a href='../where-should-the-logger-be-in-a-multi-project-asp-net-solution/'>Where should the logger be in a multi-project asp.net solution</a></li><li class="list-group-item"><a href='../c-how-to-structure-an-onion-project/'>C# &#8211; How to structure an Onion project</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>