<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How does a DMA controller work &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1063802 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1063802" class="post-1063802 software type-software status-publish hentry category-software tag-io tag-operating-systems"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How does a DMA controller work</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">io</span><span class="mr-2 badge badge-info">operating systems</span></p><div class="entry-content"><p>From Section 5.1.4 Direct Memory Access in <em>Modern Operating Systems by Andrew S. Tanenbaum, Herbert Bos, 2014</em>,</p><blockquote><p>To simplify the explanation, we assume that the CPU accesses all devices and memory via a single system bus that connects the CPU, the memory, and the I/O devices, as shown in Fig. 5-4.</p></blockquote><p><img src="../../../i.stack.imgur.com/hAwhZ.png" alt="enter image description here"/></p><ol><li><blockquote><p>To  explain how DMA works, let us first look at how disk reads occur<br /> when DMA is not used.</p><ul><li>First the disk controller reads the block (one or more sectors) from the drive serially, bit by bit, until the entire block is in<br /> the<br /> controller’s internal buffer.</li><li>Next, it computes the checksum to verify that no read errors have occurred. Then the controller causes an interrupt. When the<br /> operating<br /> system starts running, it can read the disk block from <strong>the<br /> controller’s buffer</strong> a byte or a word at a time by executing a loop,<br /> with each iteration reading one byte or word from a <strong>controller<br /> device register</strong> and storing it in main memory.</li></ul></blockquote><p>Q: in the second step,</p><ul><li><p>isn&#39;t the data transferred &#34;<strong>from the controller&#39;s buffer</strong>&#34; to the main memory? Why does it say both &#34;<strong>from the controller’s<br /> buffer</strong>&#34; and &#34;<strong>from a controller device register</strong>&#34;?</p></li><li><p>in the second step, can the controller transfer data from its buffer to the main memory, without interrupting to the cpu, and<br /> without involving OS again?</p></li></ul></li><li><blockquote><p>When  DMA  is  used,  the  procedure  is  different.</p><ul><li>First  the  CPU  programs  the DMA controller by setting its registers so it knows what to transfer where (step 1 in Fig. 5-4).<br /> <strong>It also issues a command to the disk controller telling it to read<br /> data from the disk into its internal buffer</strong> and verify the checksum.</li><li>When valid data are in the disk controller’s buffer, DMA can begin. <strong>The DMA controller initiates the transfer by issuing a read<br /> request over the bus to the disk controller</strong> (step 2). This read<br /> request<br /> looks like any other read request, and the disk controller does not<br /> know (or care) whether it came from the CPU or from a DMA controller.<br /> Typically, <strong>the memory address to write to is on the bus’ address<br /> lines, so when the disk controller fetches the next word from its<br /> internal buffer, it knows where to write it.</strong> The write to memory is<br /> another standard bus cycle (step 3).</li><li>When the write is complete, the disk controller sends an acknowledgement signal to the DMA controller, also over the bus<br /> (step<br /> 4). The DMA controller then increments the memory address to use and<br /> decrements the byte count. If  the  byte  count  is  still  greater<br /> than  0,  steps  2  through  4  are  repeated  until  the count<br /> reaches  0.</li><li>At  that  time,  the  DMA  controller  interrupts  the  CPU  to  let  it know that the transfer is now complete. When the operating<br /> system<br /> starts up, it does not have to copy the disk block to memory; it is<br /> already there.</li></ul></blockquote><p>Q: in the second step, the DMA controller requests the disk<br /> controller to transfer data from the disk controller&#39;s buffer to the<br /> main memory. In the first step, the CPU issues a command to the disk controller telling it to read data from the disk into its internal buffer. At the same time, can the CPU also tell the disk controller to transfer data<br /> from the disk controller&#39;s buffer to the main memory, when the disk controller finishes transfer data from the disk to the disk controller&#39;s buffer, so that there is no need for the DMA controller to tell the disk controller to transfer data from the disk controller&#39;s buffer to the main memory? (I can&#39;t understand why we need a DMA controller for data transfer between the disk and the main memory, so guess that I miss something important to understand the quote).</p></li><li><p>A device controller of a device controls the device and performs<br /> operations on the device. What device does a DMA controller control<br /> and perform operations on?</p></li></ol><p>Thanks!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>Q1</strong></p><p>In the first step, we&#39;re NOT using DMA, so the content of the disk controller is read piece by piece by the processor. The processor will of course (assuming the data is actually going to be used for something, and not just being thrown away) store it in the memory of the system.</p><p>The buffer in this case is a piece of memory on the hard-disk (controller) itself, and the controller device register a control register of the hard-disk (controller) itself.</p><p>Not involving the OS (or some other software) would require some kind of DMA operation, and the section of text you are discussing in this part of your question is NOT using DMA. So, no, it won&#39;t happen like that in this case.</p><p><strong>Q2</strong></p><p>So, the whole point of a DMA controller is to &#34;perform the tedious task of storing stuff from the device&#39;s internal buffer into main memory&#34;. The CPU will work with both the DMA controller and the disk device. If the disk could do this itself, there would be no need for a DMA controller.</p><p>And indeed, in modern systems, the DMA capability is typically built into the hard-disk controller itself, in the sense that the controller has &#34;bus mastering&#34; capabilities, which means that the controller itself <em>IS</em> the DMA controller for the device. However, to look at them as two separate devices makes the whole concept of DMA a little less difficult to understand.</p><p><strong>Q3</strong> (kind of)</p><p>If you think of the hard disk as the stack of bricks just delivered to a building site, and the processor is the bricklayer that lays the bricks to build the house. The DMA controller is the labourer that carries the bricks from the stack of bricks to where they are needed for the bricklayer, meaning that the bricklayer can concentrate on doing the actual work of laying bricks (which is skilled work, if you have ever tried it yourself), and the simple work of &#34;fetch and carry&#34; can be done by a less skilled worker.</p><p>Anecdotal evidence:
When I first learned about DMA transfer from disk to memory was about 1997 or so when IDE controllers begun using DMA, and you needed to get a &#34;motherboard IDE controller&#34; driver to allow the IDE to do DMA, and at that time, reading from the hard-disk would take about 6-10% of the CPU time, where DMA in the same setup would use about 1% of the CPU time. Before that time, only fancy systems with SCSI disk controllers would use DMA.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../operating-systems-theory-using-minimum-number-of-semaphores/'>Operating systems theory &#8212; using minimum number of semaphores</a></li><li class="list-group-item"><a href='../c-go-goroutine-and-concurrency/'>C++ &#8211; GO &#8211; Goroutine and Concurrency</a></li><li class="list-group-item"><a href='../are-control-register-and-status-register-and-data-register-part-of-the-device-itself/'>Are &#8220;Control register&#8221; and &#8220;Status register&#8221; and &#8220;Data register&#8221; part of the device itself</a></li><li class="list-group-item"><a href='../can-the-cpu-manipulate-the-pins-of-an-io-port-directly/'>Can the CPU manipulate the pins of an IO port directly</a></li><li class="list-group-item"><a href='../what-does-address-space-means-when-talking-about-io-devices/'>What does &#8220;address space&#8221; means when talking about IO devices</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>