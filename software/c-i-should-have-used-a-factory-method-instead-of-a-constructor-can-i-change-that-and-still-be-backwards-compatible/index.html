<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; I should have used a factory method instead of a constructor. Can I change that and still be backwards-compatible &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080592 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080592" class="post-1080592 software type-software status-publish hentry category-software tag-c tag-design-patterns tag-factory-method tag-refactoring"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; I should have used a factory method instead of a constructor. Can I change that and still be backwards-compatible</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">factory-method</span><span class="mr-2 badge badge-primary">refactoring</span></p><div class="entry-content"><p><strong>The problem</strong></p><p>Let&#39;s say I have a class called <code>DataSource</code> which provides a <code>ReadData</code> method (and maybe others, but let&#39;s keep things simple) to read data from an <code>.mdb</code> file:</p><pre><code>var source = new DataSource(&#34;myFile.mdb&#34;);
var data = source.ReadData();
</code></pre><p>A few years later, I decide that I want to be able to support <code>.xml</code> files in addition to <code>.mdb</code> files as data sources. The implementation for &#34;reading data&#34; is quite different for <code>.xml</code> and <code>.mdb</code> files; thus, if I were to design the system from scratch, I&#39;d define it like this:</p><pre><code>abstract class DataSource {
    abstract Data ReadData();
    static DataSource OpenDataSource(string fileName) {
        // return MdbDataSource or XmlDataSource, as appropriate
    }
}

class MdbDataSource : DataSource {
    override Data ReadData() { /* implementation 1 */ }
}

class XmlDataSource : DataSource {
    override Data ReadData() { /* implementation 2 */ }
}
</code></pre><p>Great, a perfect implementation of the Factory method pattern. Unfortunately, <code>DataSource</code> is located in a library and refactoring the code like this would break all existing calls of</p><pre><code>var source = new DataSource(&#34;myFile.mdb&#34;);
</code></pre><p>in the various clients using the library. Woe is me, why didn&#39;t I use a factory method in the first place?</p><hr/><p><strong>Solutions</strong></p><p>These are the solutions I could come up with:</p><ol><li><p>Make the DataSource constructor return a subtype (<code>MdbDataSource</code> or <code>XmlDataSource</code>). That would solve all my problems. Unfortunately, C# does not support that.</p></li><li><p>Use different names:</p><pre><code>abstract class DataSourceBase { ... }    // corresponds to DataSource in the example above

class DataSource : DataSourceBase {      // corresponds to MdbDataSource in the example above
    [Obsolete(&#34;New code should use DataSourceBase.OpenDataSource instead&#34;)]
    DataSource(string fileName) { ... }
    ...
}

class XmlDataSource : DataSourceBase { ... }
</code></pre><p>That&#39;s what I ended up using since it keeps the code backwards-compatible (i.e. calls to <code>new DataSource(&#34;myFile.mdb&#34;)</code> still work). Drawback: The names are not as descriptive as they should be.</p></li><li><p>Make <code>DataSource</code> a &#34;wrapper&#34; for the real implementation:</p><pre><code>class DataSource {
    private DataSourceImpl impl;

    DataSource(string fileName) {
        impl = ... ? new MdbDataSourceImpl(fileName) : new XmlDataSourceImpl(fileName);
    }

    Data ReadData() {
        return impl.ReadData();
    }

    abstract private class DataSourceImpl { ... }
    private class MdbDataSourceImpl : DataSourceImpl { ... }
    private class XmlDataSourceImpl : DataSourceImpl { ... }
}
</code></pre><p>Drawback: <em>Every</em> data source method (such as <code>ReadData</code>) must be routed by boilerplate code. I don&#39;t like boilerplate code. It&#39;s redundant and clutters the code.</p></li></ol><p>Is there any <em>elegant</em> solution that I have missed?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I would go for a variant to your second option that allows you to phase-out the old, too generic, name <code>DataSource</code>:</p><pre><code>abstract class AbstractDataSource { ... } // corresponds to the abstract DataSource in the ideal solution

class XmlDataSource : AbstractDataSource { ... }
class MdbDataSource : AbstractDataSource { ... } // contains all the code of the existing DataSource class

[Obsolete(&#34;New code should use AbstractDataSource instead&#34;)]
class DataSource : MdbDataSource { // an &#39;empty shell&#39; to keep old code working.
    DataSource(string fileName) { ... }
}
</code></pre><p>The only drawback here is that the new base-class can&#39;t have the most obvious name, because that name was already claimed for the original class and needs to remain like that for backwards compatibility. All the other classes have their descriptive names.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-substitute-for-static-inheritance/'>C# &#8211; substitute for static inheritance</a></li><li class="list-group-item"><a href='../java-how-to-decouple-simple-factory-and-default-implementation/'>Java &#8211; How to decouple simple factory and default implementation</a></li><li class="list-group-item"><a href='../factory-method-vs-factory-method-design-pattern/'>Factory Method vs. Factory Method design pattern</a></li><li class="list-group-item"><a href='../c-what-kind-of-base-for-decorator-interface-abstract-class-non-abstract/'>C++ &#8211; What kind of base for Decorator: interface, abstract class, non-abstract</a></li><li class="list-group-item"><a href='../object-oriented-static-factory-method-in-base-class/'>Object-oriented &#8211; Static factory method in base class</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>