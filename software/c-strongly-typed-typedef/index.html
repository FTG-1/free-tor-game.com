<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ strongly typed typedef &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1064658 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1064658" class="post-1064658 software type-software status-publish hentry category-software tag-c tag-c11 tag-type-safety"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ strongly typed typedef</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">c++11</span><span class="mr-2 badge badge-warning">type-safety</span></p><div class="entry-content"><p>I&#39;ve been trying to think of a way of declaring strongly typed typedefs, to catch a certain class of bugs in the compilation stage. It&#39;s often the case that I&#39;ll typedef an int into several types of ids, or a vector to position or velocity:</p><pre><code>typedef int EntityID;
typedef int ModelID;
typedef Vector3 Position;
typedef Vector3 Velocity;
</code></pre><p>This can make the intent of code more clear, but after a long night of coding one might make silly mistakes like comparing different kinds of ids, or adding a position to a velocity perhaps.</p><pre><code>EntityID eID;
ModelID mID;

if ( eID == mID ) // &lt;- Compiler sees nothing wrong
{ /*bug*/ }


Position p;
Velocity v;

Position newP = p + v; // bug, meant p + v*s but compiler sees nothing wrong
</code></pre><p>Unfortunately, suggestions I&#39;ve found for strongly typed typedefs include using boost, which at least for me isn&#39;t a possibility (I do have c++11 at least). So after a bit of thinking, I came upon this idea, and wanted to run it by someone.</p><p>First, you declare the base type as a template. The template parameter isn&#39;t used for anything in the definition, however:</p><pre><code>template &lt; typename T &gt;
class IDType
{
    unsigned int m_id;

    public:
        IDType( unsigned int const&amp; i_id ): m_id {i_id} {};
        friend bool operator==&lt;T&gt;( IDType&lt;T&gt; const&amp; i_lhs, IDType&lt;T&gt; const&amp; i_rhs );
};
</code></pre><p>Friend functions actually need to be forward declared before the class definition, which  requires a forward declaration of the template class.</p><p>We then define all the members for the base type, just remembering that it&#39;s a template class.</p><p>Finally, when we want to use it, we typedef it as:</p><pre><code>class EntityT;
typedef IDType&lt;EntityT&gt; EntityID;
class ModelT;
typedef IDType&lt;ModelT&gt; ModelID;
</code></pre><p>The types are now entirely separate. Functions that take an EntityID will throw a compiler error if you try to feed them a ModelID instead, for example. Aside from having to declare the base types as templates, with the issues that entails, it&#39;s also fairly compact.</p><p>I was hoping anyone had comments or critiques about this idea?</p><p>One issue that came to mind while writing this, in the case of positions and velocities for example, would be that I can&#39;t convert between types as freely as before. Where before multiplying a vector by a scalar would give another vector, so I could do:</p><pre><code>typedef float Time;
typedef Vector3 Position;
typedef Vector3 Velocity;

Time t = 1.0f;
Position p = { 0.0f };
Velocity v = { 1.0f, 0.0f, 0.0f };

Position newP = p + v*t;
</code></pre><p>With my strongly typed typedef I&#39;d have to tell the compiler that multypling a Velocity by a Time results in a Position.</p><pre><code>class TimeT;
typedef Float&lt;TimeT&gt; Time;
class PositionT;
typedef Vector3&lt;PositionT&gt; Position;
class VelocityT;
typedef Vector3&lt;VelocityT&gt; Velocity;

Time t = 1.0f;
Position p = { 0.0f };
Velocity v = { 1.0f, 0.0f, 0.0f };

Position newP = p + v*t; // Compiler error
</code></pre><p>To solve this, I think I&#39;d have to specialize every conversion explicitly, which can be kind of a bother. On the other hand, this limitation can help prevent other kinds of errors (say, multiplying a Velocity by a Distance, perhaps, which wouldn&#39;t make sense in this domain). So I&#39;m torn, and wondering if people have any opinions on my original issue, or my approach to solving it.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>These are <em>phantom type parameters</em>, that is, parameters of a parameterised type that are used not for their representation, but to separate different “spaces” of types with the same representation.</p><p>And speaking of spaces, that’s a useful application of phantom types:</p><pre><code>template&lt;typename Space&gt;
struct Point { double x, y; };

struct WorldSpace;
struct ScreenSpace;

// Conversions between coordinate spaces are explicit.
Point&lt;ScreenSpace&gt; project(Point&lt;WorldSpace&gt; p, const Camera&amp; c) { … }
</code></pre><p>As you’ve seen, though, there are some difficulties with unit types. One thing you can do is decompose units into a vector of integer exponents on the fundamental components:</p><pre><code>template&lt;typename T, int Meters, int Seconds&gt;
struct Unit {
  Unit(const T&amp; value) : value(value) {}
  T value;
};

template&lt;typename T, int MA, int MB, int SA, int SB&gt;
Unit&lt;T, MA - MB, SA - SB&gt;
operator/(const Unit&lt;T, MA, SA&gt;&amp; a, const Unit&lt;T, MB, SB&gt;&amp; b) {
  return a.value / b.value;
}

Unit&lt;double, 0, 0&gt; one(1);
Unit&lt;double, 1, 0&gt; one_meter(1);
Unit&lt;double, 0, 1&gt; one_second(1);

// Unit&lt;double, 1, -1&gt;
auto one_meter_per_second = one_meter / one_second;
</code></pre><p>Here we’re using <em>phantom values</em> to tag runtime values with compile-time information about the exponents on the units involved. This scales better than making separate structures for velocities, distances, and so on, and might be enough to cover your use case.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-when-to-use-typedef/'>C++ &#8211; When to use typedef</a></li><li class="list-group-item"><a href='../java-limitations-of-polymorphism-in-statically-typed-languages/'>Java &#8211; Limitations of Polymorphism in statically typed languages</a></li><li class="list-group-item"><a href='../c-how-to-maintain-encapsulation-with-composition-in-c/'>C++ &#8211; How to maintain encapsulation with composition in C++</a></li><li class="list-group-item"><a href='../c-where-should-i-place-a-typedef-when-used-in-method-signatures-in-c/'>C++ &#8211; Where should I place a typedef when used in method signatures in C++</a></li><li class="list-group-item"><a href='../can-an-interpreted-statically-typed-language-be-considered-type-safe/'>Can an interpreted statically typed language be considered type safe</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>