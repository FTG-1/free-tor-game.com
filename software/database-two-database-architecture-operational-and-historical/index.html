<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Database &#8211; Two Database Architecture : Operational and Historical &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071061 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071061" class="post-1071061 software type-software status-publish hentry category-software tag-database tag-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Database &#8211; Two Database Architecture : Operational and Historical</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database</span><span class="mr-2 badge badge-info">design</span></p><div class="entry-content"><p>I thought about an uncommon database structure and wonder if anyone has seen it in use before. It&#39;s basically using 2 databases:</p><ul><li>First database hold <em>only</em> the data that is currently valid</li><li>Second database hold the history of everything that has ever been entered, updated or<br /> deleted in the first database</li></ul><p><strong>Scenario</strong></p><p>I&#39;m working on a project where I&#39;m required to log everything that happens and where the data changes frequently.</p><p><strong>Example</strong> (not the real one)</p><p>You have to do the database design for a soccer league. In this league there are players and teams. The players often switch teams.</p><ul><li><em>First requirement</em> : The database must hold the information necessary to play the   next match. This means a list of every players, teams and in which team each player is currently.</li><li><em>Second requirement</em> : The database must hold historical values that we will use to generate statistics. This means the list of all the players that have been part of a team or the list of all the teams a player has been a part of.</li></ul><p><strong>The problem</strong></p><p>These two requirements are kinda the opposite of each other. I have tried to do everything in the same database but it doesn&#39;t make sense. The first requirement only cares about &#34;playing the next match&#34; while the second requirement only cares about &#34;generating statistics&#34;.</p><p>To do everything in the same database, I went with a sort of &#34;insert only&#34; database using the obvious <a href="https://stackoverflow.com/questions/2549839/are-soft-deletes-a-good-idea">soft delete</a> to delete/update information&#8230;</p><p>What initially seemed like an easy task, holding a list of players, teams and the current team of each players, suddenly becomes a lot harder. The application logic required to play the next match is already complicated enough but now the database has a very unhelpful design where the application is required to add &#34;is deleted&#34; check on every single query <em>just to play the next match.</em></p><p>Would you want to be that coach that yell &#34;all players in the team, come to me&#34; and then 2000 players come at you. At which point, you will probably yell &#34;all players <em>that are not deleted</em> in the team, come to me&#34; (while swearing about this stupid design).</p><p><strong>My conclusion</strong></p><p>I came to wonder why you need to put everything in the same database. Not only does the soft delete do a poor job at logging everything unless you add many columns (time_created, who_created_it, time_deleted, who_deleted_it) but it also complicate everything. It complicates the database design and it complicates the application design.</p><p>Also, I receive these 2 requirements as part of one single application that cannot be split but I keep thinking : this is 2 completely distinct applications. Why am I trying to do everything together.</p><p>That&#39;s when I thought about splitting the database in two. An operational database that is used only to play the next match and only contain the information that is currently valid and an historical database that hold all the information that ever existed, when it was created, deleted and who did it.</p><p>The goal is to keep the first database (operational) and the application as simple as possible while having as much information as possible in the second database (historical).</p><p><strong>Questions</strong></p><ul><li>Have you seen that design before? Does it have name?</li><li>Are there any obvious pitfalls that I am missing?</li></ul><p>EDIT 2015-03-16</p><p><strong>Current architecture</strong></p><p>You can basically think about the whole architecture as a 2 steps process.</p><p><em>Step 1 :</em></p><ul><li>Application is running and users are doing some actions</li><li>Each time an event happen, it is recorded automatically (audit solution) in an event table</li><li>Then the correct row, in the operational database is updated</li></ul><p><em>Step 2 :</em></p><ul><li>A job read the latest insertion in the event table and insert this new data in the<br /> historical database.</li><li>Users query the historical database to retrieve the information that they need.</li></ul><p>Just from the event table, you can reconstruct the information to any point in time. The problem is that this event table is not easily queryable. This is where the historical database kicks in; to present the data into a way that it is easy to retrieve exactly what we want.</p><p><strong>Additional problems when putting everything in the same tables</strong></p><p>I have already expressed my concern about the added complexity of checking &#34;is deleted&#34; on each query. But there is another issue : <em>integrity</em>.</p><p>I make heavy use of foreign key and constraint <em>to make sure that at any point in time, the data that is in my database is valid.</em></p><p>Let&#39;s look at an example :</p><p>Constraint : There can only be one goal keeper per team.</p><p>It&#39;s easy to add a unique index that check if there is only one goal keeper per team. But then what happen when you change the goal keeper. You still need to preserve the information about the previous one but now you have 2 goal keepers in the same teams, one active and one inactive, which contradicts your constraint.</p><p>Sure it&#39;s easy to add a check to your constraint, but it&#39;s another thing to manage and think about.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It happens quite often, though the history (sometimes known as audit records) is kept either in the same table, or in a separate one in the same database.</p><p>For example, I used to work with a system where any updates to a table would be implemented as an insert, the old &#39;current&#39; record would have a flag set on it saying it was a historical record, and the timestamp when it was updated written to a column.</p><p>Today I work on a system where every change is written to a dedicated audit table and then the update occurs on the table.</p><p>The latter is more scalable, but not as easy to implement in a generic manner.</p><p>The easiest way to achieve your goal of making queries simple and not requiring adding the &#39;is current&#39; flag is to only allow read queries via a view or stored procedure. Then you make a call to say &#34;get all players&#34; and the stored proc will return only current players (you can implement a 2nd procedure to return players with more control over which ones are returned). This works well for writing too. A stored procedure for updating a player can then write whatever history details are needed and update the player - without the client ever knowing what the history mechanism is. For this reason, stored procedures are better than a view which returns only current players, as it keeps the entire DB access mechanism the same for reading and writing - everything goes through a sproc.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-real-time-multi-user-gaming-platform/'>Database &#8211; Real-Time Multi-User Gaming Platform</a></li><li class="list-group-item"><a href='../database-application-design-with-a-shared-database/'>Database &#8211; Application Design with a Shared Database</a></li><li class="list-group-item"><a href='../database-how-to-store-historical-user-data/'>Database &#8211; How to store historical user data</a></li><li class="list-group-item"><a href='../design-event-driven-microservice-architecture-dealing-with-synchronous-external-neighboring-systems/'>Design &#8211; Event Driven Microservice Architecture &#038; Dealing with synchronous external neighboring systems</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>