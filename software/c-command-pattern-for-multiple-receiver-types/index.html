<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Command pattern for multiple receiver types &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085358 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085358" class="post-1085358 software type-software status-publish hentry category-software tag-c tag-design-patterns"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Command pattern for multiple receiver types</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design-patterns</span></p><div class="entry-content"><p>I have a tree-like structure of objects. Objects have different types but all of them are inherited from the same base class. Now I want to send some kind of command objects to the nodes. Command object has address of the target node and should be passed through root node and intermediate nodes untill it reaches the target node. Target node accepts command and allows it to perform some actions on the node:</p><pre><code>void Node::processCommand (Command&amp; cmd) {
    if(cmd.address == this-&gt;address)
        cmd.execute(this);
    else
        child[cmd.address]-&gt;processCommand(cmd);
}
</code></pre><p>First question: is it a command pattern, or may be some of it&#39;s kind?</p><p>Next, consider I have nodes of classes ClassA and ClassB and I want to send some commands to objects of both classes, and some commands only for objects of ClassB, something like that:</p><pre><code>class CommandForBoth {
    void execute (BaseClass* obj) {
         obj-&gt;doSomething();
    }
}

class CommandForB {
    void execute (ClassB* obj) {
         obj-&gt;doSomethingSpecial();
    }
}
</code></pre><p>Is it possible to implement that without casts and without multiple methods for passing commands of different types, like:</p><pre><code>void Node::processCommand (CommandForBoth&amp; cmd);
void Node::processCommand (CommandForClassA&amp; cmd);
void Node::processCommand (CommandForClassB&amp; cmd);
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h3>Is it a command pattern ?</h3><p>The <strong><a href="http://www.oodesign.com/command-pattern.html" rel="nofollow noreferrer">command pattern</a></strong> implies that:</p><ol><li>All the commands share the same interface.  In C++ this is usually done with inheritance from an abstract <code>Command</code>.</li><li>A <code>Client</code> creates a concrete command and sets the <code>Receiver</code>.</li><li>An <code>Invoker</code> launches the command, which will carry out its actions for the already defined <code>Receiver</code>.</li></ol><p>Your approach does not meet these expectations:</p><ol><li><code>CommandForBoth</code> and <code>CommandB</code> do not share the same interface (but maybe you just didn&#39;t mention it in your snippet).</li><li>Your command doesn&#39;t know its receiver:  instead of the <code>Client</code> defining it at creation, it&#39;s the <code>Invoker</code> who defines the target at execution.</li><li>The <code>Invoker</code> is your initial <code>Node</code>.  But your Invoker might not launch the command,  but forward it to one of it&#39;s child.</li></ol><h3>Or is it a visitor pattern ?</h3><p>A <strong><a href="http://www.oodesign.com/visitor-pattern.html" rel="nofollow noreferrer">visitor pattern</a></strong> is designed for executing operations on an <code>ObjectStructure</code>.  The structure is responsible to activate the visitor for its relevant element.  Each element is responsible to invoke the visitor for their relevant sub-elements.</p><p>This looks very close to what you are doing:</p><ul><li>The initial <code>Node</code> corresponds to the <code>ObjectStructure</code>,</li><li>Each <code>Node</code> corresponds to an <code>Element</code></li><li><code>Node::ProcessCommand(Command)</code> corresponds to <code>Element::accept(Visitor)</code></li><li><code>Command</code> corresponds to <code>Visitor</code></li><li><code>Command::execute(Node)</code> corresponds to <code>Visitor::visit(Node)</code></li></ul><p>The only unusual thing is that in a visitor pattern, the successive chain of <code>accept()</code> is in general performed by the elements to call the visitor for all the children, whereas here, the <code>accept()</code> only looks at the addressing and executes the visitor if the addressing matches.</p><h3>Implementation without cast</h3><p>The visitor pattern has a solution for your casting issue: each <code>Visitor</code> (so for you, each <code>Command</code>) has an override of <code>visit()</code> (so for you: <code>execute()</code>) for each of the different subtypes of <code>Elements</code> (i.e. <code>Nodes</code>) that exist.  In your case, all the overrides but one would implement nothing (or will throw an exception).</p><p>This is a drawback of the visitor pattern, that you may not want.  Alternatively, if the <code>Nodes</code> are  polymorphic, you could easily deviate from the &#34;pure&#34; visitor pattern, and use only one <code>execute(BaseClass*)</code>:</p><pre><code>class CommandForB {
    void execute (BaseClass* obj) {
         ClassB bobj = dynamic_cast&lt;ClassB*&gt;(obj); 
         if (bobj) 
             bobj-&gt;doSomethingSpecial();
         else {  // ouch execute was invoked for an Node it shouldn&#39;t 
                // either do nothing, or log the unexpected situation, 
                // or throw an exception
         }
    }
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-how-to-refactor-the-design-if-it-seems-to-require-multiple-inheritance/'>Java &#8211; How to refactor the design, if it seems to require multiple inheritance</a></li><li class="list-group-item"><a href='../c-subscript-assignment-binary-operator-in-c/'>C++ &#8211; Subscript/assignment binary operator in C++</a></li><li class="list-group-item"><a href='../php-dependency-injection-in-chain-of-command-pattern/'>Php &#8211; Dependency Injection in Chain of Command pattern</a></li><li class="list-group-item"><a href='../c-design-pattern-how-to-inject-dependencies-into-a-command-pattern/'>C# &#8211; Design pattern: How to inject dependencies into a Command pattern</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>