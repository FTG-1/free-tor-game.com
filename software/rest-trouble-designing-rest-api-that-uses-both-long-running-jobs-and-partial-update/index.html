<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Rest &#8211; Trouble designing REST API that uses both long-running jobs, and partial update &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070839 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070839" class="post-1070839 software type-software status-publish hentry category-software tag-api-design tag-iot tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Rest &#8211; Trouble designing REST API that uses both long-running jobs, and partial update</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api-design</span><span class="mr-2 badge badge-info">iot</span><span class="mr-2 badge badge-warning">rest</span></p><div class="entry-content"><p>I&#39;m having a design issue in my REST api, where I have a resource <code>Device</code>, which happens to represent an IoT device, can be partially updated using PATCH, but some of the things that get updated will begin a long running job.</p><p>For instance,</p><p>Here is class Device:</p><pre><code>public class Device
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Ip { get; set; }
    public string Foo {get; set; }
}
</code></pre><p>I can do a PATCH request like so:</p><pre><code>PATCH /api/devices/1234
{
    name: &#34;abc123&#34;,
    Foo: &#34;hello&#34;
}
</code></pre><p>which will update both the Name &amp; Bar properties of the device.</p><p>However, if I want to update the Ip field using partial update like so:</p><pre><code>PATCH /api/devices/1234
{
    name: &#34;abc123&#34;,
    ip: &#34;1.2.3.4&#34;
}
</code></pre><p>The issue is updating the ip on Device triggers an API call to the physical IoT device to set the ip, which causes the device to reboot.</p><p>Usually for long running jobs, I would do something similar to what is described <a href="https://farazdagi.com/2014/rest-and-long-running-jobs/" rel="nofollow noreferrer">here</a>, and return 202 accepted with the URL of the resource so you can track the operation.</p><p>Is it a good idea to do this in conjunction with partial update? Say the ip field is specified in my patch, does it make sense to do something like this:</p><pre><code>PATCH /api/devices/1234
{
    name: &#34;abc123&#34;,
    ip: &#34;1.2.3.4&#34;
}
Response:
{
    location: &#34;/api/tasks/123&#34;
}
</code></pre><p>This way the request can be tracked, so that the client can know when the device has successfully rebooted&#8230; But it feels awkward that the API will only sometimes respond like this. Only if you specify a property that will trigger a long-running job&#8230; Not sure what the best design choice is here.</p><p>Any advice is welcome.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><a href="http://www.tbray.org/ongoing/When/200x/2009/03/20/Rest-Casuistry" rel="nofollow noreferrer">RESTful Casuistry</a> has a pretty good discussion of restart; if you aren&#39;t already familiar with it, you should have a look at it.</p><blockquote><p>Usually for long running jobs, I would do something similar to what is described here, and return 202 accepted with the URL of the resource so you can track the operation.</p><p>Is it a good idea to do this in conjunction with partial update?</p></blockquote><p>Yes.</p><blockquote><p>But it feels awkward that the API will only sometimes respond like this.</p></blockquote><p>Well, there&#39;s nothing necessarily <em>wrong</em> with always reporting that the request has been accepted.</p><p>I&#39;ve come to find that the easiest way to work through this is to think about the messages first, and then worry about the meta data afterwards.</p><p>In HTTP, the response to an <a href="https://www.rfc-editor.org/rfc/rfc7231#section-4.2.1" rel="nofollow noreferrer">unsafe operation</a> is generally a message describing the <a href="https://www.rfc-editor.org/rfc/rfc7231#section-6.3.1" rel="nofollow noreferrer">result of the action</a>.  If you imagine a website submitting a form, you might get a page back saying &#34;the operation succeeded, follow this link to see the result&#34;, or you might get a page back saying &#34;the operation was accepted, follow this link to get the latest status&#34;.</p><p>The same idea expressed another way: you are navigating an integration protocol; sometimes the application transitions to the finished state, other times it transitions to an intermediate pending state.</p><p>The intermediate state really isn&#39;t inherently different from a failed state, where you get a response back describing the fact that the request you submitted was rejected, and here&#39;s what you can do about it.</p><p>The HTTP status code, and the response headers, are <em>not</em> the response; they are meta data lifted from the response.  What we&#39;re really doing there is taking <em>semantics</em> from the response (which targets the consumer), and lifting some of them into the metadata so that the <em>generic</em> components participating in the protocol have a coarse understanding of what&#39;s going on, and can act appropriately.</p><blockquote><p>But it feels awkward that the API will only sometimes respond like this.</p></blockquote><p>Think about the web sites we have today.  Sometimes you click on link, and it takes you to the data you expect; but sometimes instead you are directed to a log in screen because your previous license has expired.</p><p>In other words, we do this sort of thing <em>all the time</em>; there are multiple states that the application might transition to, the server picks one, and the client has to figure out how to make progress.</p><p>The REST answer to the latter is hypermedia, which is to say the client needs to understand the semantics of the links that could be returned by the server, and the server chooses to respond with the appropriate links, including the semantic annotations that distinguish them.</p><p>In your example, most of your use cases have data ready immediately, so the &#34;result of the operation&#34; response will include only the link that informs the client of how to view the result</p><pre><code>&lt;a ref=&#34;http://example.org/viewResult&#34; href=&#34;...&#34;&gt;
</code></pre><p>For the restart case, which is going to take some time, the &#34;result of the operation response will include only the link that informs the client of how to check for progress</p><pre><code>&lt;a rel=&#34;http://example.org/checkProgress&#34; href=&#34;...&#34;&gt;
</code></pre><p>Another way of thinking about this: the presence of the link tells the client that a resource is available, the link relation tells the client what the resource <em>is</em>, the protocol tells the client what actions they can take with that kind of resource (which http methods are supported, what media-types are available, and so on).</p><p><a href="https://www.rfc-editor.org/rfc/rfc5023" rel="nofollow noreferrer">Atom Publishing</a> is a really good example of a protocol defined this way.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-is-is-ok-to-use-a-non-primary-key-as-the-id-in-a-rails-resource/'>Rest &#8211; Is is OK to use a non-primary key as the id in a rails resource</a></li><li class="list-group-item"><a href='../rest-conceptual-mismatch-between-ddd-application-services-and-rest-api/'>Rest &#8211; Conceptual mismatch between DDD Application Services and REST API</a></li><li class="list-group-item"><a href='../rest-best-solution-to-authorize-that-a-user-is-only-allowed-to-modify-act-with-their-own-resources-in-a-rest-api/'>Rest &#8211; Best solution to authorize that a user is only allowed to modify/act with their own resources in a REST API</a></li><li class="list-group-item"><a href='../rest-design-update-properties-on-an-entity-in-a-restful-resource-based-api/'>Rest &#8211; Design: Update properties on an entity in a RESTful, resource-based, API</a></li><li class="list-group-item"><a href='../rest-how-to-design-a-rest-api-that-can-prompt-the-client-about-long-running-operations/'>Rest &#8211; How to design a REST API that can &#8220;prompt&#8221; the client about long-running operations</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>