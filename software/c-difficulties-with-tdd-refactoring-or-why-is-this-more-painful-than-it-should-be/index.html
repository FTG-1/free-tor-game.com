<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Difficulties With TDD &#038; Refactoring (Or &#8211; Why Is This More Painful Than It Should Be?) &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078452 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078452" class="post-1078452 software type-software status-publish hentry category-software tag-agile tag-c tag-refactoring tag-tdd tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Difficulties With TDD &#038; Refactoring (Or &#8211; Why Is This More Painful Than It Should Be?)</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">agile</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">refactoring</span><span class="mr-2 badge badge-primary">tdd</span><span class="mr-2 badge badge-danger">unit testing</span></p><div class="entry-content"><p>I wanted to teach myself to use the TDD approach and I had a project I had been wanting to work on for a while. It wasn&#39;t a large project so I thought it would be a good candidate for TDD. However, I feel like something has gone awry. Let me give an example:</p><p>At a high level my project is an add-in for Microsoft OneNote that will allow me to track and manage Projects more easily. Now, I also wanted to keep the business logic for this as decoupled from OneNote as possible in-case I decided to build my own custom storage and back end some day.</p><p>First I started with a basic plain words acceptance test to outline what I wanted my first feature to do. It looks something like this (dumbing it down for brevity):</p><ol><li>User clicks create project</li><li>User types in title of project</li><li>Verify that the project is created correctly</li></ol><p>Skipping over the UI stuff and some intermediary planning I come to my first unit test:</p><pre><code>[TestMethod]
public void CreateProject_BasicParameters_ProjectIsValid()
{
    var testController = new Controller();
    Project newProject = testController(A.Dummy&lt;String&gt;());
    Assert.IsNotNull(newProject);
}
</code></pre><p>So far so good. Red, green, refactor, etc. Alright now it needs actually save stuff. Cutting out some steps here I wind up with this.</p><pre><code>[TestMethod]
public void CreateProject_BasicParameters_ProjectMatchesExpected()
{
    var fakeDataStore = A.Fake&lt;IDataStore&gt;();
    var testController = new Controller(fakeDataStore);
    String expectedTitle = fixture.Create&lt;String&gt;(&#34;Title&#34;);
    Project newProject = testController(expectedTitle);

    Assert.AreEqual(expectedTitle, newProject.Title);
}
</code></pre><p>I&#39;m still feeling good at this point. I don&#39;t have a concrete data store yet, but I created the interface how I anticipated it would look.</p><p>I&#39;m going to skip a few steps here because this post is getting long enough, but I followed similar processes and eventually I get to this test for my data store:</p><pre><code>[TestMethod]
public void SaveNewProject_BasicParameters_RequestsNewPage()
{
    /* snip init code */
    testDataStore.SaveNewProject(A.Dummy&lt;IProject&gt;());
    A.CallTo(() =&gt; oneNoteInterop.SavePage()).MustHaveHappened();
}
</code></pre><p>This was good until I tried to implement it:</p><pre><code>public String SaveNewProject(IProject project)
{
    Page projectPage = oneNoteInterop.CreatePage(...);
}
</code></pre><p>And THERE is the problem right where the &#34;&#8230;&#34; is. I realize now at THIS point that CreatePage requires a section ID. I didn&#39;t realize this back when I was thinking at the controller level because I was only concerned with testing the bits relevant to the controller. However, all the way down here I now realize I have to ask the user for a location to store the project. Now I have to add a location ID to the datastore, then add one to the project, then add one to the controller, and add it to ALL of the tests that are already written for all of those things. It has become tedious very quickly and I can&#39;t help but feel like I would have caught this quicker if I sketched out the design ahead of time rather than letting it be designed during the TDD process.</p><p>Can someone please explain to me if I&#39;ve done something wrong in this process? Is there anyway this kind of refactoring can be avoided? Or is this common? If it is common are there any ways of making it more painless?</p><p>Thanks all!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>While TDD is (rightly) touted as a way to design and grow your software, it&#39;s still a good idea to think about the design and architecture beforehand. IMO, &#34;sketching out the design ahead of time&#34; is fair game. Often this will be at a higher level than the design decisions you will be led to through TDD, however.</p><p>It&#39;s also true that when things change, you will usually have to update tests. There&#39;s no way to eliminate this completely, but there are some things you can do to make your tests less brittle and minimize the pain.</p><ol><li><p>As much as possible, keep implementation details out of your tests. This means only test through public methods, and where possible favor <a href="http://martinfowler.com/articles/mocksArentStubs.html">state-based over interaction-based verification</a>. In other words, if you test the <em>result</em> of something rather than the <em>steps</em> to get there, your tests should be less fragile.</p></li><li><p>Minimize duplication in your test code, just like you would in production code. <a href="http://codemanship.co.uk/parlezuml/blog/?postid=1182">This post</a> is a good reference. In your example, it sounds like it was painful to add the <code>ID</code> property to your constructor because you invoked the constructor directly in several different tests. Instead, try extracting the creation of the object to a method or initializing it once for each test in a test initialize method.</p></li></ol></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-tdd-what-happens-before-the-first-unit-test/'>Design &#8211; TDD: What happens before the first unit test</a></li><li class="list-group-item"><a href='../unit-testing-how-should-you-tdd-a-yahtzee-game/'>Unit-testing &#8211; How should you TDD a Yahtzee game</a></li><li class="list-group-item"><a href='../unit-testing-in-tdd-should-i-add-unit-tests-to-refactored-code/'>Unit-testing &#8211; In TDD, should I add unit tests to refactored code</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>