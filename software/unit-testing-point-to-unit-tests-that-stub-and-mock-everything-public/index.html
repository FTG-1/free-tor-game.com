<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211;  point to unit tests that stub and mock everything public &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1064663 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1064663" class="post-1064663 software type-software status-publish hentry category-software tag-integration-tests tag-testing tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211;  point to unit tests that stub and mock everything public</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">integration-tests</span><span class="mr-2 badge badge-info">testing</span><span class="mr-2 badge badge-warning">unit testing</span></p><div class="entry-content"><p>When doing unit tests the &#34;proper&#34; way, i.e. stubbing every public call and return preset values or mocks, I feel like I&#39;m not actually testing anything. I&#39;m literally looking at my code and creating examples based on the flow of logic through my public methods. And every time the implementation changes, I have to go and change those tests, again, not really feeling that I&#39;m accomplishing anything useful (be it mid- or long-term). I also do integration tests (including non-happy-paths) and I don&#39;t really mind the increased testing times. With those, I feel like I&#39;m actually testing for regressions, because they have caught multiple, while all that unit tests do is show me that the implementation of my public method changed, which I already know.</p><p>Unit testing is a vast topic, and I feel like I&#39;m the one not understanding something here. What&#39;s the decisive advantage of unit testing vs integration testing (excluding the time overhead)?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>When doing unit tests the &#34;proper&#34; way, i.e. stubbing every public
 call and return preset values or mocks, I feel like I&#39;m not actually
 testing anything. I&#39;m literally looking at my code and creating
 examples based on the flow of logic through my public methods.</p></blockquote><p>This sounds like the method you are testing needs several other class instances (which you have to mock), and calls several methods on its own.</p><p>This type of code is indeed difficult to unit-test, for the reasons you outline.</p><p>What I have found helpful is to split up such classes into:</p><ol><li>Classes with the actual &#34;business logic&#34;. These use few or no calls to other classes and are easy to test (value(s) in - value out).</li><li>Classes that interface with external systems (files, database, etc.). These wrap the external system and provide a convenient interface for your needs.</li><li>Classes that &#34;tie everything together&#34;</li></ol><p>Then the classes from 1. are easy to unit-test, because they just accept values and return a result. In more complex cases, these classes may need to perform calls on their own, but they will only call classes from 2. (and not directly call e.g. a database function), and the classes from 2. are easy to mock (because they only expose the parts of the wrapped system that you need).</p><p>The classes from 2. and 3. cannot usually be meaningfully unit-tested (because they don&#39;t do anything useful on their own, they are just &#34;glue&#34; code). OTOH, these classes tend to be relatively simple (and few), so they should be adequately covered by integration tests.</p><hr/><p><strong>An example</strong></p><p><em>One class</em></p><p>Say you have a class which retrieves a price from a database, applies some discounts and then updates the database.</p><p>If you have this all in one class, you&#39;ll need to call DB functions, which are hard to mock. In pseudocode:</p><pre><code>1 select price from database
2 perform price calculation, possibly fetching parameters from database
3 update price in database
</code></pre><p>All three steps will need DB access, so a lot of (complex) mocking, which is likely to break if the code or the DB structure changes.</p><p><em>Split up</em></p><p>You split into three classes: PriceCalculation, PriceRepository, App.</p><p>PriceCalculation only does the actual calculation, and gets provided the values it needs. App ties everything together:</p><pre><code>App:
fetch price data from PriceRepository
call PriceCalculation with input values
call PriceRepository to update prices
</code></pre><p>That way:</p><ul><li>PriceCalculation encapsulates the &#34;business logic&#34;. It&#39;s easy to test because it does not call anything on its own.</li><li>PriceRepository can be pseudo-unit-tested by setting up a mock database and testing the read and update calls. It has little logic, hence few codepaths, so you do not need too many of these tests.</li><li>App cannot be meaningfully unit-tested, because it is glue-code. However, it too is very simple, so integration testing should be enough. If later App gets too complex, you break out more &#34;business-logic&#34; classes.</li></ul><p>Finally, it may turn out PriceCalculation must do its own database calls. For example because only PriceCalculation knows which data its needs, so it cannot be fetched in advance by App. Then you can pass it an instance of PriceRepository (or some other repository class), custom-tailored to PriceCalculation&#39;s needs. This class will then need to be mocked, but this will be simple, because PriceRepository&#39;s interface is simple, e.g. <code>PriceRepository.getPrice(articleNo, contractType)</code>. Most importantly, PriceRepository&#39;s interface isolates PriceCalculation from the database, so changes to the DB schema or data organisation are unlikely to change its interface, and hence to break the mocks.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-need-help-understanding-mocks-and-stubs/'>C# &#8211; Need help understanding Mocks and Stubs</a></li><li class="list-group-item"><a href='../unit-testing-are-integration-tests-meant-to-be-redundant/'>Unit-testing &#8211; Are Integration Tests Meant to be Redundant</a></li><li class="list-group-item"><a href='../unit-testing-are-database-integration-tests-bad/'>Unit-testing &#8211; Are (database) integration tests bad</a></li><li class="list-group-item"><a href='../php-how-to-pass-a-mock-object-into-a-class-for-unit-tests/'>Php &#8211; How to pass a mock object into a class for unit tests</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>