<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Simple &#8216;defrag&#8217; logic that minimizes changes &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070950 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070950" class="post-1070950 software type-software status-publish hentry category-software tag-algorithms"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Simple &#8216;defrag&#8217; logic that minimizes changes</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">algorithms</span></p><div class="entry-content"><p>edit:</p><p>so clearly I didn&#39;t explain this well, so let me try again with examples.  I have a &#39;pipe&#39; of a given size with signals routed through it at given offsets.  The pipe can get fragmented with signals in different offsets making it impossible to fit a new signal.  I want an algorithm that will tell me how to arrange the signals to defragment the pipe; but with a minimal number of signals actually being moved!  So for the example..</p><p>Say I have a pipe of size 16.  It has the following signals with the sizes and offsets described.</p><pre><code>offset 0: A (size of 4; fills slots 0-3)
offset 5: C (size of 2, fills slot 5-6)
offset 8: B (size of 4, fills 8-11)
offset 14: D (size 2, fills 14-15)

Pipe: AAAA_CC_BBBB__DD
</code></pre><p>In this case I have 1 slot open at offsets 4 &amp; 7, and two at offset 12-13.  Now lets say I want to add a size 4 signal to this pipe.  There is no continuous space for it now, but I know I have enough space for it if I defragment.  The &#39;obvious&#39; solution is to group all the signals together at the &#39;top&#39; like this:</p><pre><code>offset 0:  A (size 4, fills 0-3)
offset 4:  B (size 4, fills 4-7)
offset 8:  C (size 2, fills 8-9)
offset 10: D (size 2, fills 10-11)

Pipe: AAAABBBBCCDD____
</code></pre><p>this leaves slots 12-15 free for my new signal.  However, to do this I repositioned 3 signals(B-D).  For each signal I moved I have to send commands down to hardware and wait for a non-trivial amount of time.</p><p>If I was smarter I could realize there is another approch.  I could reposition like this:</p><pre><code>offset 0:  A(size 4, fills 0-3)
offset 8:  B(size 4, fills 8-11)
offset 12: C(size 2, fills 12-13)
offset 14: D(size 2, fills 14-15).

Pipe: AAAA____BBBBCCDD
</code></pre><p>I can now fit my new signal in offsets 4-7; AND I only had to reposition one signal(B).  Thus saving on hardware calls.</p><p>I&#39;m wondering if there is a good algorithm to detect sitations like this; where I can &#39;fit&#39; a signal onto a pipe with the minimum number of signals moved.  The aproch thta comes to mind is an N! algorithm; which basically amounst to &#34;generate every possible distribution, calculate how many moves it resulted in&#34;.  I&#39;m loking for a faster approch.</p><p>The approch does <em>not</em> have to be 100% perfect, I&#39;m looking primarily to minimize the average case, so long as the worst case isn&#39;t made too horrendous.  I know that I will never have more then 255 signals on a given pipe; so I may be able to &#39;get away&#39; with N! as bad as that sounds.  I also know each signal&#39;s size is a power of 2, as is the pipe size.</p><p>also, are there any briliant algorithms for placing of signals that minimize fragmentation?</p><hr/><p>Question answered; see below.</p><p>I wanted to expain on the answer slightly to better explain how defragmentation would occure for anyone reading; buddy does explan it I wanted to point out a simpler approch to conceptualize and explain the defraging part in more detail since that was the original question.</p><p>I&#39;m explaining my approch, which is a slightly different/simpler approch but effectively keeps the &#39;buddy&#39; concept.  I&#39;m not precomputing blocks or labeling them, this is too much effort to implement and maintain.  For me the CPU cost of calculating where a signal will go is pretty trivial compared to actual placing/deletion of signals; so I can afford to lose a tiny, linear, amount of CPU by not pre-computing to simplfy my logic.   So the process is:</p><p>for insertion:</p><p>All signals are kept in signal boundaries equal to the signal size, so a signal will start on offset where offest % signalsize=0.  For actuall offset we walk through and figure out intervals that keep this boundry.  So if my signal is size 4 on a 16 size pipe I&#39;ll look at intervals 0-4, 5-7, 8-11, 12-15.</p><p>For each interval check if all space in that interval is free.  In the simple case we have a interval with no signals in it and we just put the signal at that interval.  Important, we look at the intervals in order and place our signal in <em>the first free</em> interval, this ensure we break the smallest possible &#39;block&#39; (using buddy terms) when we add our signal.  This should be equivlent to the buddy approch described by im3l96; except without precomputation of blocks.</p><p>if no interval is completely free we have to defrag.  For this we find the the signal with the most unused slots.  If multuple intervals have the same number of slots unused select the first interval.  We then find the largest signal in this interval and recursively call same insert algorithm for the smaller signal (except mark the interval we selcted to insert our first signal as unavailable somehow).  This moves the signal to somewhere else that it will fit.  We then find the next smallest signal in our selected interval and do the same until we moved all signals.  Worst case of 2^n-1 signals moved; where N is the number of potential signal sizes &lt;=our signal  (assuming signals are multuple of 2 then N=log2(signalSize)).</p><p>Here is an example.  * stands for a slot marked as unavailable when we recursively call this method (ie the interval that the calling method wanted to place it&#39;s signal in, and thus doesn&#39;t want the recursive call to try to place a signal into)</p><p>Here is an exaple, simplest case I could come up with that still demonstrates full complexity.  Note: the following structure would be hard to create, but <em>could</em> result from the buddy approch if someone tried very very hard.</p><pre><code>FFFFFFFF__AA_B__EEEE_HGGCC_DII_J
</code></pre><p>Someone passes in a signal Z of size 8</p><p>we select offset 8:</p><p>defragInsert(z, size 8)</p><pre><code>effective structure: FFFFFFFF__AA_B__EEEE_HGGCC_DII_J

placing signal in interval: __AA_B__
</code></pre><p>defragInput(A, size 2)</p><pre><code>effective structure: FFFFFFFF********EEEE_HGGCC_DII_J
place signal in interval (offset 20)  _H
</code></pre><p>defragInput(H, size1)</p><pre><code>effective structure: FFFFFFFF********EEEE**GGCC_DII_J
place signal between C &amp; D
</code></pre><p>return defragInput(H, size1)</p><pre><code>effective structure: FFFFFFFF********EEEE__GGCCHDII_J
place H at offset 20 now that it&#39;s open
</code></pre><p>return defragInput(A, size 2)</p><p>effective structure: FFFFFFFF_<em>_</em>_B__EEEEAAGGCCHDII_J<br /> move B now&#8230;</p><p>defragInput(B, size1)</p><p>effective structure: FFFFFFFF*<strong>**</strong>*EEEEAAGGCCHDII_J<br /> place B between I &amp; J</p><p>return defragInput(B, size1)</p><p>effective structure: FFFFFFFF_<strong>__</strong>_EEEEAAGGCCHDIIBJ<br /> add B</p><p>return defragInsert(z, size 8)</p><pre><code>fianl structure: FFFFFFFFzzzzzzzzEEEEAAGGCCHDIIBJ
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The problem is similar to memory allocation, so my propose solution is to use <a href="http://en.wikipedia.org/wiki/Buddy_memory_allocation" rel="nofollow">http://en.wikipedia.org/wiki/Buddy_memory_allocation</a>. Using buddy allocator minimise fragmentation from happening in the first place by choosing the smallest contiguous free space in the pipe for a signal.</p><p>Using the example, here&#39;s how the space will be allocated for size 8 pipe:</p><pre><code>Initial state
Pipe: ----------------

A (size 4), smallest available is 16, so split that into 2x4 and 1x8
Pipe: AAAA ---- --------

C (size of 2), smallest available is 4, split that into 2x2 
Pipe: AAAA CC -- --------

B (size of 4), smallest available is 8, split that into 2x4
Pipe: AAAA CC -- BBBB ----

D (size 2), smallest available is 2
Pipe: AAAA CC DD BBBB ----
</code></pre><p>Freeing space is a matter of checking the &#34;buddy&#34; of space being freed; if buddy&#39;s also free, then they can be merged to form bigger contiguous space. So, if the space are being freed in the order of the signals coming in, then it&#39;ll look like this:</p><pre><code>Free A (buddy of space being freed is not free)
Pipe: ---- CC DD BBBB ----

Free C (buddy is not free)
Pipe: ---- -- DD BBBB ----

Free B (buddy is free, merge)
Pipe: ---- -- DD --------

Free D (buddy is free, merge)
Pipe: ----------------
</code></pre><p>It&#39;s quite simple and fast too because there&#39;s only little fragmentation, especially because the size of the signals are power of 2.</p><p>If it&#39;s <em>really</em> needed then defragmenting/compaction can be done easily too, it&#39;s just a matter of finding allocated blocks of same size with free buddies and merge them (moving one allocated block will create a larger free block).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../an-algorithm-to-find-simple-cycles/'>An algorithm to find simple cycles</a></li><li class="list-group-item"><a href='../detect-order-changes-in-a-list/'>Detect Order Changes in a List</a></li><li class="list-group-item"><a href='../running-time-of-simple-for-loops/'>Running time of simple for-loops</a></li><li class="list-group-item"><a href='../simple-and-clean-way-of-comparing-three-numbers/'>Simple and clean way of comparing three numbers</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>