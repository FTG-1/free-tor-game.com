<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# Generics &#8211; How to avoid redundant method &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070123 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070123" class="post-1070123 software type-software status-publish hentry category-software tag-c tag-generics"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# Generics &#8211; How to avoid redundant method</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">generics</span></p><div class="entry-content"><p>Let&#39;s assume I have two classes that look like this (the first block of code and the general problem are related to C#):</p><pre><code>class A 
{
    public int IntProperty { get; set; }
}

class B 
{
    public int IntProperty { get; set; }
}
</code></pre><p>These classes cannot be changed in any way (they are part of a 3rd party assembly). Therefore, I cannot make them implement the same interface, or inherit the same class that would then contain IntProperty.</p><p>I want to apply some logic on the <code>IntProperty</code> property of both classes, and in C++ I could use a template class to do that quite easily:</p><pre><code>template &lt;class T&gt;
class LogicToBeApplied
{
    public:
        void T CreateElement();

};

template &lt;class T&gt;
T LogicToBeApplied&lt;T&gt;::CreateElement()
{
    T retVal;
    retVal.IntProperty = 50;
    return retVal;
}
</code></pre><p>And then I could do something like this:</p><pre><code>LogicToBeApplied&lt;ClassA&gt; classALogic;
LogicToBeApplied&lt;ClassB&gt; classBLogic;
ClassA classAElement = classALogic.CreateElement();
ClassB classBElement = classBLogic.CreateElement();   
</code></pre><p>That way I could create a single generic factory class that would work for both ClassA and ClassB.</p><p>However, in C#, I have to write two classes with two different <code>where</code> clauses even though the code for the logic is exactly the same:</p><pre><code>public class LogicAToBeApplied&lt;T&gt; where T : ClassA, new()
{
    public T CreateElement()
    {
        T retVal = new T();
        retVal.IntProperty = 50;
        return retVal;
    }
}

public class LogicBToBeApplied&lt;T&gt; where T : ClassB, new()
{
    public T CreateElement()
    {
        T retVal = new T();
        retVal.IntProperty = 50;
        return retVal;
    }
}
</code></pre><p>I know that if I want to have different classes in the <code>where</code> clause, they need to be related, i.e. to inherit the same class, if I want to apply the same code to them in the sense that I described above. It is just that it is very annoying to have two completely identical methods. I also do not want to use reflection because of the performance issues.</p><p>Can somebody suggest some approach where this can be written in a more elegant fashion?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Add a proxy interface (sometimes called an <em>adapter</em>, occasionally with subtle differences), implement <code>LogicToBeApplied</code> in terms of the proxy, then add a way to construct an instance of this proxy from two lambdas: one for the property get and one for the set.</p><pre><code>interface IProxy
{
    int Property { get; set; }
}
class LambdaProxy : IProxy
{
    private Function&lt;int&gt; getFunction;
    private Action&lt;int&gt; setFunction;
    int Property
    {
        get { return getFunction(); }
        set { setFunction(value); }
    }
    public LambdaProxy(Function&lt;int&gt; getter, Action&lt;int&gt; setter)
    {
        getFunction = getter;
        setFunction = setter;
    }
}
</code></pre><p>Now, whenever you need to pass in an IProxy but have an instance of the third party classes, you can just pass in some lambdas:</p><pre><code>A a = new A();
B b = new B();
IProxy proxyA = new LambdaProxy(() =&gt; a.Property, (val) =&gt; a.Property = val);
IProxy proxyB = new LambdaProxy(() =&gt; b.Property, (val) =&gt; b.Property = val);
proxyA.Property = 12; // mutates the proxied `a` as well
</code></pre><p>Additionally, you can write simple helpers to construct LamdaProxy instances from instances of A or B. They can even be extension methods to give you a &#34;fluent&#34; style:</p><pre><code>public static class ProxyExtension
{
    public static IProxy Proxied(this A a)
    {
      return new LambdaProxy(() =&gt; a.Property, (val) =&gt; a.Property = val);
    }

    public static IProxy Proxied(this B b)
    {
      return new LambdaProxy(() =&gt; b.Property, (val) =&gt; b.Property = val);
    }
}
</code></pre><p>And now construction of proxies looks like this:</p><pre><code>IProxy proxyA = new A().Proxied();
IProxy proxyB = new B().Proxied();
</code></pre><p>As for your factory, I&#39;d see if you can refactor it into a &#34;main&#34; factory method that accepts an IProxy and performs all logic on it and other methods that just pass in <code>new A().Proxied()</code> or <code>new B().Proxied()</code>:</p><pre><code>public class LogicToBeApplied
{
    public A CreateA() {
      A a = new A();
      InitializeProxy(a.Proxied());
      return a; // or maybe return the proxy if you&#39;d rather use that
    }

    public B CreateB() {
      B b = new B();
      InitializeProxy(b.Proxied());
      return b;
    }

    private void InitializeProxy(IProxy proxy)
    {
        proxy.IntProperty = 50;
    }
}
</code></pre><p>There&#39;s no way to do the equivalent of your C++ code in C# because C++ templates rely on <a href="https://en.wikipedia.org/wiki/Structural_type_system" rel="noreferrer">structural</a> typing. As long as two classes have the same method name and signature, in C++ you can call that method generically on both of them. C# has <a href="https://en.wikipedia.org/wiki/Nominal_type_system" rel="noreferrer">nominal</a> typing - the <em>name</em> of a class or interface is part of its type. Therefore, the classes <code>A</code> and <code>B</code> cannot be treated the same in any capacity unless an explicit &#34;is a&#34; relationship is defined through either inheritance or interface implementation.</p><p>If the boilerplate of implementing these methods per class is too much, you can write a function that takes an object and <em>reflectively</em> builds a <code>LambdaProxy</code> by looking for a specific property name:</p><pre><code>public class ReflectiveProxier 
{
    public object proxyReflectively(object proxied)
    {
        PropertyInfo prop = proxied.GetType().GetProperty(&#34;Property&#34;);
        return new LambdaProxy(
            () =&gt; prop.GetValue(proxied),
            (val) =&gt; prop.SetValue(proxied, val));
     }
}
</code></pre><p>This fails abysmally when given objects of incorrect type; reflection inherently introduces the possibility of failures the C# type system cannot prevent. Luckily you can avoid reflection until the maintenance burden of the helpers becomes too great because you&#39;re not required to modify the IProxy interface or the LambdaProxy implementation to add the reflective sugar.</p><p>Part of the reason this works is that <code>LambdaProxy</code> is &#34;maximally generic&#34;; it can adapt any value that implements the &#34;spirit&#34; of the IProxy contract because the implementation of LambdaProxy is completely defined by the given getter and setter functions. It even works if the classes have different names for the property, or different types that are sensibly and safely representable as <code>int</code>s, or if there&#39;s some way to map the concept that <code>Property</code> is supposed to represent to any other features of the class. The indirection provided by the functions gives you maximal flexibility.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/c-single-responsibility-principle-how-to-avoid-code-fragmentation/'>C# &#8211; Single Responsibility Principle &#8211; How to Avoid Code Fragmentation</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-how-to-create-a-common-interface-for-classes-with-different-subsets-of-members/'>C# &#8211; How to create a common interface for classes with different subsets of members</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-manager-container-class-vs-static-class-methods/'>C# &#8211; Manager/Container class vs static class methods</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-implement-generic-dataset-builder-with-c/'>C# &#8211; Implement Generic DataSet Builder with C#</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-force-derived-class-to-implement-static-method-c/'>C# &#8211; Force Derived Class to Implement Static Method C#</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-splitting-units-tests-by-requirement-or-method/'>C# &#8211; Splitting units tests by requirement or method</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>