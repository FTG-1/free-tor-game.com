<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; MVC &#8211; Sharing Contextual Information between views &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078111 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078111" class="post-1078111 software type-software status-publish hentry category-software tag-asp-net-mvc tag-c tag-mvc"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; MVC &#8211; Sharing Contextual Information between views</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-mvc</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">mvc</span></p><div class="entry-content"><p>Please excuse the long post. There is a question, just bear with me.</p><p><strong>A Little Context</strong></p><p>We have a site which is required to adapt considerably based on a variety of user settings, the group the user belongs to, where they come from and other things. We used to include the relevant bits on the model for the page, so if the page had a table which would show if the user was over a certain age, then on the model we would do something like:</p><pre><code>//model
public PageModel
{
    public bool ShowTable {get;set;}
}

//controller
public PageController
{
    public ActionResult ShowPage()
    {
        var model = new PageModel() {
            ShowTable = User.Age &gt; 21
        };
        return View(model);
    }
}

//view
@if(Model.ShowTable)
{ 
    &lt;table&gt;Some Html here&lt;/table&gt;
}
</code></pre><p>This quickly became very complicated to know what we should be showing which users. To try and address this problem, we centralised all the logic about when a particular thing should be shown or hidden. We called this class <code>UserConfiguration</code> and it (mostly) just contained a series of functions returning booleans indicating what should be shown. This allowed us to set up a series of Specs and Tests of what a user should be shown. This <code>UserConfigratuion</code> was then put on a base class, which all page models were required to inherit from, so what we have currently is something like this:</p><pre><code>//UserConfiguration 
public UserConfiguration
{
    private readonly User _user;

    public UserConfiguration(User user) {
        _user = user
    }

    public bool ShowTable() {
        return _user.Age &gt; 21;
    }
}

//model base
public ModelBase
{
    public UserConfiguration {get;set;}
}

//model
public PageModel : ModelBase
{
    // whatever data is needed for the page
}

//controller
public PageController
{
    public ActionResult ShowPage()
    {
        var userConfiguration = new UserConfiguration(User);
        var model = new PageModel {
            UserConfiguration = userConfiguration
        };
        return View(model);
    }
}

//view
@if(Model.UserConfiguration.ShowTable())
{ 
    &lt;table&gt;Some Html here&lt;/table&gt;
}
</code></pre><p>This has helped, mostly because it allowed us to create a series of tests of what a user should and should not see etc. However, it is not a very clean solution, having to put together this additional class and include it on the model. It also has ramifications for rendering Partial Views. If the model has a property <code>IEnumerable&lt;Foo&gt; Foos</code> on it, that we want to render in a partial, but that partial <em>also</em> relies on the user configuration, we have a problem. You can&#39;t just pass the foos to the Partial as the model, because then the partial doesn&#39;t have access to the <code>UserConfiguration</code>. So what would be the best way to access this information. The way I see it, in the context of asp.net MVC there are 4 ways available:</p><p>1) Have a new model for the partial e.g.</p><pre><code>// parent view
@{
    var foosModel = new foosModel {
        Foos = Model.Foos,
        UserConfiguration = Model.UserConfiguration
    }
}

@Html.RenderPartial(&#34;FooList&#34;, foosModel)

// child partial view
@if(Model.UserConfiguration.ShowTable) {
    foreach(var foo in Model.Foos) {
        //Some HTML
    }
}
</code></pre><p>This is the probably the &#34;most pure&#34; solution, adhering best to the principles of MVC, but involves a lot of (arguably unnecessary) models, causing project bloat.</p><p>2) Expose the UserConfiguration through the ViewData. e.g :</p><pre><code>// parent view
@Html.RenderPartial(&#34;FooList&#34;, Model.Foos, new ViewDataDictionary { { &#34;UserConfiguration&#34;, Model.UserConfiguration } })

// child partial view
@{ 
    var userConfig = (UserConfiguration)ViewData[&#34;UserConfiguration&#34;];
}
@if(userConfig.ShowTable) {
    foreach(var foo in Model) {
        //Some HTML
    }
}
</code></pre><p>I don&#39;t really like this because it isn&#39;t type safe and relies on magic strings to get it from the ViewData.</p><p>3) Put the UserConfiguration in the ViewBag. Same issues as above really</p><p>4) Modify the page model, and expose the UserConfiguration via a property of the page itself, as per <a href="http://haacked.com/archive/2011/02/21/changing-base-type-of-a-razor-view.aspx/" rel="noreferrer">http://haacked.com/archive/2011/02/21/changing-base-type-of-a-razor-view.aspx/</a></p><p>I feel since the UserConfiguration is ambient contextual information it makes sense to expose it via the class as in option 4 above. Is there generally accepted best practice in MVC for exposing this kind of data? Has anyone tried anything like option 4 in the past and were there any &#39;gotcha&#39;s&#39;</p><p>tl;dr: What is the best way of exposing contextual information to the views on your site, in MVC in general or asp.net MVC in particular?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You should go with #5: None of the above.</p><p>I&#39;ve started creating extension methods for the <code>IPrincipal</code> interface, which gives me strongly typed declarations of what the current user can do. You could even create a <code>UserConfiguration</code> DTO that you stuff in the Session for use by these extension methods.</p><p>First, the extension methods:</p><pre class="lang-cs prettyprint-override"><code>namespace YourApplication.Helpers
{
    public static class UserConfigurationExtensions
    {
        private HttpContext CurrentContext
        {
            get
            {
                return System.Web.HttpContext.Current;
            }
        }

        private static UserConfiguration Config
        {
            get
            {
                if (CurrentContext == null)
                    return null;

                return CurrentContext.Session[&#34;UserConfiguration&#34;] as UserConfiguration;
            }
        }

        public static bool CanViewTable(this IPrincipal user)
        {
            return Config.ShowTable;
        }
    }
}
</code></pre><p>Now when the user has successfully logged in, create the instance of <code>UserConfiguration</code> and stash it in the <code>Session</code>:</p><pre class="lang-cs prettyprint-override"><code>public class AccountController : Controller
{
    [HttpPost]
    public ActionResult Login(LoginFormModel model)
    {
        if (ModelState.IsValid)
        {
            // Log in
            Session[&#34;UserConfiguration&#34;] = new UserConfiguration(...);
        }

        return RedirectToAction(&#34;Index&#34;, &#34;Home&#34;);
    }
}
</code></pre><p>Next, add the namespace in which the extension methods exist to your default namespaces in the Razor templates.</p><p><strong>YourApplication/Views/Web.config</strong></p><pre class="lang-xml prettyprint-override"><code>&lt;?xml version=&#34;1.0&#34;?&gt;

&lt;configuration&gt;
  &lt;!-- ... --&gt;

  &lt;system.web.webPages.razor&gt;
    &lt;namespaces&gt;
      &lt;add namespace=&#34;YourApplication.Helpers&#34;/&gt;
    &lt;/namespaces&gt;
  &lt;/system.web.webPages.razor&gt;

  &lt;!-- ... --&gt;
&lt;/configuration&gt;
</code></pre><p>Now close and reopen the Visual Studio solution. Then your Razor templates have new methods available:</p><pre><code>@if (User.CanViewTable())
{
    foreach(var foo in Model)
    {
        //Some HTML
    }
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-build-mvc-views-that-work-with-polymorphic-domain-model-design/'>How to build MVC Views that work with polymorphic domain model design</a></li><li class="list-group-item"><a href='../javascript-pure-front-end-javascript-with-web-api-versus-mvc-views-with-ajax/'>Javascript &#8211; Pure Front end JavaScript with Web API versus MVC views with ajax</a></li><li class="list-group-item"><a href='../mvc-strongly-typed-views-viewmodel-and-mvc/'>Mvc &#8211; Strongly typed views, ViewModel and MVC</a></li><li class="list-group-item"><a href='../mvc-partial-model-updates-from-view/'>Mvc &#8211; Partial Model Updates From View</a></li><li class="list-group-item"><a href='../c-is-it-good-practice-to-save-an-entire-viewmodel-in-session-c-asp-net-mvc/'>C# &#8211; Is it good practice to save an entire ViewModel in Session (C# ASP.NET MVC)</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>