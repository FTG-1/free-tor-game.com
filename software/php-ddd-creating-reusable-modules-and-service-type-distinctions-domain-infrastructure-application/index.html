<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; DDD: Creating reusable modules and service type distinctions (Domain, Infrastructure, Application) &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073565 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073565" class="post-1073565 software type-software status-publish hentry category-software tag-architecture tag-design-patterns tag-domain-driven-design tag-enterprise-architecture tag-php"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; DDD: Creating reusable modules and service type distinctions (Domain, Infrastructure, Application)</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">domain-driven-design</span><span class="mr-2 badge badge-primary">enterprise-architecture</span><span class="mr-2 badge badge-danger">PHP</span></p><div class="entry-content"><p>So after reading &#34;Implementing Domain-Driven Design by Vaughn Vernon&#34; I&#39;ve decided to refactor my code for better re usability by isolating what I believe to be core domain concepts into separate modules.</p><p>Each module contains their own set of distinct architectural layers which include the Domain, Infrastructure and the Application/Presentation layer (per Vaughn&#39;s recommendation I&#39;ve decided to further separate the responsibilities of the Application layer from routes, MVC controllers + templates which exist in the Presentation Layer).</p><p>I&#39;ve decided to place each of these layers within their own package; and each package is referencing the layer beneath it as a dependency. ie:  Presentation Layer depends on the Application Layer, Application depends on Infrastructure, etc.   Since the Repository is a part of the Domain, each Repository Interface exists within the Domain layer/package with implementation being a responsibility of the Infrastructure layer/package (Doctrine, etc).</p><p><strong>I&#39;m hoping that by restructuring my code in this way I&#39;ll be able to swap out the Application layer and reuse my Domain across multiple Web Applications.</strong></p><p>The code finally looks like it&#39;s starting to shape again however what still confuses me is this distinction between Application, Infrastructure and Domain Services.</p><p>One common example of a Domain Service is something which you would use to hash passwords. This makes sense to me from a SRP perspective since the User entity shouldn&#39;t concern itself with the many different hashing algorithms which might be used to store a user&#39;s credentials.</p><p>So with that in mind I treated this new Domain service the same way as my Repositories; by defining an interface in the Domain and leaving the implementation up to Infrastructure layer. However, now I&#39;m wondering about what should be done with the Application Services.</p><p>As it stands now, each Entity has its own Application Service, i.e. the User Entity has a UserService within the Application Layer.  The UserService in this case is responsible for parsing primitive data types and handling a common use-case &#34;UserService::CreateUser(string name, string email, etc) : User.</p><p>What concerns me is the fact that I&#39;ll need to re-implement this logic across multiple applications should I decide to swap out the Application layer.  So I guess this leads me to my next few questions:</p><ol><li><p>Are Domain Services merely an Interface which exist to provide a layer of abstraction between the Infrastructure Layer and your Model? ie: Repositories + HashingServices, etc.</p></li><li><p>I mentioned having an Application Service which looks like this:</p><ul><li><p>Access/Application/Services/UserService::CreateUser(string name, string email, etc): User</p></li><li><p>The method signature accepts primitive data type arguments and returns a new User Entity (not a DTO!).</p></li></ul><p>Does this belong in the Infrastructure layer as an implementation of some interface defined within the Domain layer <strong>or is the Application Layer in fact more appropriate due to primitive data type arguments, etc</strong>?</p><p>example:</p><pre><code>Access/Domain/Services/UserServiceInterface 
</code></pre><p>and</p><pre><code>Access/Infrastructure/Services/UserService implements UserServiceInterface
</code></pre></li><li><p>How should separate modules handle unidirectional relationships.  Should module A reference module B&#39;s application layer (as it&#39;s doing now) or the infrastructure implementation (via separated interface)?</p></li><li><p>Do Application Layer Services require a Separate Interface?  If the answer is yes then where should they be located?</p></li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Are Domain Services merely an Interface which exist to provide a layer
 of abstraction between the Infrastructure Layer and your Model? ie:
 Repositories + HashingServices, etc.</p></blockquote><p>Domain services responsibilities include several things. The most obvious is housing logic that doesn&#39;t fit into a single entity. For example, you may need to authorize a refund for a certain purchase, but to complete the operation you need data from the <code>Purchase</code> entity, <code>Customer</code> entity, <code>CustomerMembership</code> entity.</p><p>Domain services also my provide operations needed by the domain to complete its functionality such as <code>PasswordEncryptionService</code>, but the implementation of this service will reside in the infrastructure layer since it will mostly be a technical solution.</p><p>Infrastructure services are services which so an infrastructure operation such as opening a network connection, copy file from file system, talk to an external web service or talk to database.</p><p>Application services are the implementation of a use case in the application you are building. If you are cancelling a flight reservation you would:</p><ol><li>Query the database for the Reservation object.</li><li>invoke Reservation-&gt;cancel.</li><li>Save object to DB.</li></ol><p>The application layer is the client of the domain. The domain has no idea what your use case is. It just exposes the functionality through its aggregates and domain services. The application layer however mirrors what you are trying to achieve by orchestrating the domain and infrastructure layers.</p><blockquote><p>I mentioned having an Application Service which looks like this:
 Access/Application/Services/UserService::CreateUser(string name,
 string email, etc): User
 The method signature accepts primitive data type arguments and returns
 a new User Entity (not a DTO!).</p></blockquote><p>PHP might not be the best place to start learning about DDD since many of the PHP frameworks out there (Laravel, Symfony, Zend,..etc) tend to promote RAD. They are focused more on CRUD and translating forms to entities. CRUD != DDD</p><p>Your presentation layer should be responsible for reading the form inputs from the request object and invoking the correct application service.
The application service will create the user and invoke the User repository to save the new user. You may optionally return a DTO of the user back to the presentation layer.</p><blockquote><p>How should separate modules handle unidirectional relationships.
 Should module A reference module B&#39;s application layer (as it&#39;s doing
 now) or the infrastructure implementation (via separated interface)?</p></blockquote><p>The word module in DDD lingo has a different meaning than what you are describing. A module should house related concepts. For example, an order module in the domain layer could house the Order aggregate, OrderItem entity, OrderRepositoryInterface and MaxOrderValidationService.</p><p>An Order module in the application layer could house the OrderApplicationServie, CreateOrderCommand and OrderDto.</p><p>If you are talking about layers then each layer should preferably depend on interfaces of other layers whenever possible. The presentation layer should depend on interfaces of the application layer. Application layer should reference interfaces of the repositories or domain services.</p><p>I personally don&#39;t create interfaces for entities and value objects coz I believe interfaces should be related to a behavior, but YMMV :)</p><blockquote><p>Do Application Layer Services require a Separate Interface? If the
 answer is yes then where should they be located?</p></blockquote><p>It depends :)
for complex applications I build interfaces coz we apply rigorous unit, integration and acceptance testing. Loose coupling is key here and the interfaces are in the same layer (application layer).</p><p>For simple app I build against the app services directly.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-from-a-ddd-perspective-is-a-report-generating-service-a-domain-service-or-an-infrastructure-service/'>Java &#8211; From a DDD perspective is a report generating service a domain service or an infrastructure service</a></li><li class="list-group-item"><a href='../ddd-modularizing-the-application-and-domain-layers-without-breaking-the-dip/'>DDD, modularizing the application and domain layers without breaking the DIP</a></li><li class="list-group-item"><a href='../rest-conceptual-mismatch-between-ddd-application-services-and-rest-api/'>Rest &#8211; Conceptual mismatch between DDD Application Services and REST API</a></li><li class="list-group-item"><a href='../design-ddd-repositories-in-application-or-domain-service/'>Design &#8211; DDD repositories in application or domain service</a></li><li class="list-group-item"><a href='../object-oriented-in-ddd-is-a-domain-service-essentially-just-a-facade-and-or-mediator-pattern/'>Object-oriented &#8211; In DDD, is a Domain Service essentially just a Facade and/or Mediator Pattern</a></li><li class="list-group-item"><a href='../ddd-domain-events-vs-application-events/'>DDD &#8211; Domain events vs application events</a></li><li class="list-group-item"><a href='../c-should-an-interface-be-defined-in-the-infrastructure-layer-if-its-only-used-by-an-implementing-class-in-that-layer/'>C# &#8211; Should an interface be defined in the infrastructure layer if it&#8217;s only used by an implementing class in that layer</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>