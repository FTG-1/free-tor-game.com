<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; Are mocks in unit tests dangerous in dynamic languages &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085816 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085816" class="post-1085816 software type-software status-publish hentry category-software tag-dynamic-programming tag-mocking tag-php tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; Are mocks in unit tests dangerous in dynamic languages</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">dynamic programming</span><span class="mr-2 badge badge-info">mocking</span><span class="mr-2 badge badge-warning">PHP</span><span class="mr-2 badge badge-primary">unit testing</span></p><div class="entry-content"><p>I&#39;ve started relying heavily on a mocking framework in php for my unit tests.</p><p>My concern is that with a dynamic language, there is no way of enforcing a return type. When mocking, you have to ensure that the return type of your mocked method is correct.</p><p>Take for example the following interface</p><pre><code>interface MyInterface {

  /**
   * @return SomeObject
   */
   public function myMethod();

}
</code></pre><p>If we are unit testing a class which requires an instance of <code>MyInterface</code>, we would mock the <code>myMethod</code> function to return a known <code>SomeObject</code>.</p><p>My concern is what happens if we accidentally have our mocked method return a different type of object, e.g. <code>SomeOtherObject, and SomeOtherObject and SomeObject are not the same duck type (don&#39;t have the same methods). We&#39;ll now have code that is relying on having</code>SomeOtherObject<code>, when all implementations of</code>MyInterface<code></code>myMethod<code>will return</code>SomeObject`.</p><p>For example, we could write the following production code;</p><pre><code>$someOtherObject = $myInterfaceImp-&gt;myMethod();
$newObj = new NewObject($someOtherObject);
</code></pre><p>Hopefully the issue is obvious. We are passing what we think is <code>SomeOtherObject</code> into a constructor. Our tests will pass, but its very likely that in production we will get failures as <code>myMethod()</code> will actually be returning <code>SomeObject</code>. We then try passing this into the constructor, and get an error if there is a type check, or a non existent method is called.</p><p>Unless we write very detailed integration and acceptance tests using the real implementations (basically we&#39;d have to ensure they covered all the testing we do an the unit level) we may not ever realise that we have an issue until we receive some runtime error in production.</p><p>Other than developer discipline, is there any way to mitigate the risk of incorrect mocks and implementations?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The answer to this question &#34;are mocks in unit tests dangerous in dynamic languages?&#34; is &#34;Hell yes!&#34;</p><p>The following <a href="http://www.thoughtworks.com/insights/blog/mockists-are-dead-long-live-classicists" rel="noreferrer">article</a> explains the dangers.</p><p>They describe a scenario where an interfaces method name changed. For example, changing a methods name from <code>error()</code> to <code>errors()</code>. If we are mocking the <code>error()</code> method in our tests, they will never turn red to alert us that we have a problem.</p><p>Instead, mocks should be used sparingly. Behaviours of the unit under test should be tested rather than testing implementation details, which happens as a consequence of using mocks in unit tests. Real classes should be used as dependencies, instead of an over reliance on mocks.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-interfacing-application-code-with-unit-tests/'>C++ &#8211; Interfacing application code with unit tests</a></li><li class="list-group-item"><a href='../c-brittle-unit-tests-due-to-need-for-excessive-mocking/'>C# &#8211; Brittle unit tests due to need for excessive mocking</a></li><li class="list-group-item"><a href='../unit-testing-the-most-appropriate-testing-method-in-this-scenario/'>Unit-testing &#8211;  the most appropriate testing method in this scenario</a></li><li class="list-group-item"><a href='../unit-testing-unit-tests-work-but-there-are-still-bugs/'>Unit-testing &#8211; Unit Tests work but there are still bugs</a></li><li class="list-group-item"><a href='../unit-testing-are-integration-tests-meant-to-repeat-all-unit-tests/'>Unit-testing &#8211; Are integration tests meant to repeat all unit tests</a></li><li class="list-group-item"><a href='../unit-testing-how-should-i-unit-test-a-function-that-uses-setters/'>Unit-testing &#8211; How should I unit test a function that uses setters</a></li><li class="list-group-item"><a href='../php-how-to-pass-a-mock-object-into-a-class-for-unit-tests/'>Php &#8211; How to pass a mock object into a class for unit tests</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>