<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Rest &#8211; How to structure files for API versioning &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076748 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076748" class="post-1076748 software type-software status-publish hentry category-software tag-api tag-domain-driven-design tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Rest &#8211; How to structure files for API versioning</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">rest</span></p><div class="entry-content"><p>My first time trying to implement API versioning here, and I need some guidelines on how to do it&#8230;</p><p>I know there are many ways of doing API versioning.<br /> I&#39;m already decided on doing it by uri (i.e, I&#39;ll have something like <code>put mydomain.com/api/v1/resources/:resourceId</code>)<br /> The question is not about &#39;referencing&#39; the right version. Instead, what I&#39;m trying to understand is how to organize and structure the artifacts&#8230;</p><p>My concrete problem is the following:</p><p>I have an endpoint <code>put stores/:storeId</code> which is already being used by a front-end application. Then I realised it would be safer and simpler for validation if I took storeId implicitly from <code>req.user</code>. So my endpoint would change to be just <code>put stores</code></p><p>If it was already in production, the front-end application would have to change. That made think I should be prepared for situations like this, and started to look into how to version my API.</p><p>But if an endpoint is controlling some artifacts and its behaviour changes, it seems to me that in order to isolate the previous endpoint from future changes necessary to newer versions, all the artifacts used by the previous endpoint should also be versioned. Right?</p><p>Because if we don&#39;t and we have different API versions expecting different behaviours from a same factory or repository, that would be a problem.</p><p>If that assumption is correct, so how would I structure my artifacts? Should I replicate the whole structure for each API version? Or should I version only the elements that change from version to version?</p><p>I&#39;ll try to give a concrete exemple below:</p><p><strong>My Back-end&#39;s file structure</strong></p><p>I&#39;m using DDD and have my domain layer artifacts structured like:</p><pre><code>src/domain/entityType/modelName/artifacts
</code></pre><p>where:</p><ul><li>domain could be the Core domain (with the main models and rules),<br /> Actors domain (modelling the actors and permissions) or a Support<br /> domain (entities for logging and other support  roles)</li><li>entityType would be a service, factory or repository</li><li>modelName are the main business entities of the domain artifacts would be files for the Mongoose schema, rules specifications, adapters, and the source code for factories, repositories or services that use those artifacts, with their respective test files as well</li></ul><p><strong>Example</strong></p><p>For example, I could have a service which would allocate tasks to an employee. That service would be structured in:</p><pre><code>src/core/services/taskAllocation/
</code></pre><p>where I would have <code>taskAllocation.service.js</code>, <code>taksAllocation.rules.js</code></p><p>And taskAllocation.service.js would reference <code>taskAllocation.rules.js</code> and also <code>src/core/repositories/employee/employee.repo.js</code> and <code>src/core/repositories/tasks/tasks.repo.js</code></p><p>And my application layer is structured like:</p><pre><code>src/routes/domainName/modelName
</code></pre><p>where I&#39;ll have <code>modelName.router.js</code>, <code>modelName.controller.js</code>, <code>modelName.validations.js</code> (with rules for input validations)</p><p>The router contains the use cases associated to the specific modelName. And the controller will access and coordinate those src/domain entities defined above.</p><p>For the case in the example, there would be a folder <code>src/routes/employess/employees.router.js</code>. That would be accessed through an endpoint <code>post employees/:id/tasks</code>, which would call <code>employeesController.allocateTasksById(req.employee.id)</code>, which would call the respective service method in <code>taskAllocation.service.js</code> at the domain layer.</p><p><strong>The replication problem</strong></p><p>This is how I have done so far.<br /> Now suppose I will create versions for the API, like:<br /> <code>src/routes/v1/domainName/modelName</code> and <code>src/routes/v2/domainName/modelName</code><br /> And the only difference in those APIs is now my original <code>put stores/:storeId</code> is deprecated and <code>put stores</code> should be used instead, which uses <code>storeId</code> from <code>req.user.storeId</code>.<br /> No artifact has changed. The change is restricted to the application layer.</p><p>But if I keep both controllers (from API v1 and v2) accessing the same domain layer artifacts, someday someone could change some artifact and invalidate v1. It seems to me that the artifacts should be replicated (that would be an &#34;accidental&#34; duplication, right?, not a true one&#8230;)</p><p>And I thought about 2 options: either I version and replicate the whole src/domainName structure, like <code>src/v1/domainName</code>, or I could version and replicate only the domain artifacts referenced by the changed endpoint, which would be:</p><pre><code>src/core/repositories/employees/v2
src/core/repositories/tasks/v2
src/core/services/tasksAllocation/v2
</code></pre><p>Well, as I said, it&#39;s my first time api-versioning&#8230;<br /> In all the articles I&#39;ve read about api versioning, I only saw the &#34;naming&#34; problem being talked about. I&#39;ve never seen anything about managing and structuring the artifacts.<br /> So guide me here, please.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Personally, I wouldn&#39;t store multiple API versions in one codebase. This leads to many trouble when there are differences in the business rules of different versions.</p><p>Instead, I create <strong>maintenance</strong> Git branches for each running API version. For example:</p><ul><li><code>master</code>: the current API version (e.g <code>1.4</code>)</li><li><code>maintenance/1.3</code>: the code of <code>1.3.x</code> version</li><li><code>maintenance/1.2</code>: the code of <code>1.2.x</code> version</li></ul><p>On the production environment, each maintenance branch is deployed to a dedicated server(s). A load balancer stands in front of them to route the traffic to the correct server(s) based on the version in the URI.</p><p>When new patches are released, I used cherry-pick to apply the fix to all branches that the patches apply to. Because my product API is also consumed by external clients, we have a communication channel to announce to the clients when an old version was deprecated.</p><p>The most important thing is to follow the semver and keep the backwards compatibility inside one maintenance branch.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-formulate-the-domain-model-in-domain-driven-design-properly-bounded-contexts-domains/'>How to formulate the Domain Model in Domain Driven Design properly (Bounded Contexts, Domains)</a></li><li class="list-group-item"><a href='../rest-how-to-structure-a-rest-api-response-for-a-flux-redux-frontend/'>Rest &#8211; How to structure a REST API response for a Flux/Redux frontend</a></li><li class="list-group-item"><a href='../architecture-how-to-structure-a-domain-driven-design-in-an-onion-architecture/'>Architecture &#8211; How to structure a Domain Driven Design in an Onion Architecture</a></li><li class="list-group-item"><a href='../c-domain-driven-design-in-net-project-structure/'>C# &#8211; Domain Driven Design in Net &#8211; Project Structure</a></li><li class="list-group-item"><a href='../c-how-to-structure-an-onion-project/'>C# &#8211; How to structure an Onion project</a></li><li class="list-group-item"><a href='../architecture-how-to-get-in-touch-with-another-bounded-context-w-o-rest-api/'>Architecture &#8211; How to get in touch with another Bounded Context w/o REST API</a></li><li class="list-group-item"><a href='../which-layer-do-ddd-repositories-belong-to/'>Which layer do DDD Repositories belong to</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>