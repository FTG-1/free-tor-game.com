<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Why isn&#8217;t there a typeclass for functions &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080571 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080571" class="post-1080571 software type-software status-publish hentry category-software tag-haskell tag-standard-library"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Why isn&#8217;t there a typeclass for functions</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">haskell</span><span class="mr-2 badge badge-info">standard-library</span></p><div class="entry-content"><p>In a learning problem I&#39;ve been messing around with, I realised I needed a typeclass for functions with operations for applying, composing etc. Reasons&#8230;</p><ol><li><p>It can be convenient to treat a representation of a function as if it were the function itself, so that applying the function implicitly uses an interpreter, and composing functions derives a new description.</p></li><li><p>Once you have a typeclass for functions, you can have derived typeclasses for special kinds of functions &#8211; in my case, I want invertible functions.</p></li></ol><p>For example, functions that apply integer offsets could be represented by an ADT containing an integer. Applying those functions just means adding the integer. Composition is implemented by adding the wrapped integers. The inverse function has the integer negated. The identity function wraps zero. The constant function cannot be provided because there&#39;s no suitable representation for it.</p><p>Of course it doesn&#39;t need to spell things as if it the values were genuine Haskell functions, but once I had the idea, I thought a library like that must already exist and maybe even using the standard spellings. But I can&#39;t find such a typeclass in the Haskell library.</p><p>I found the <a href="http://www.haskell.org/ghc/docs/latest/html/libraries/base-4.6.0.1/Data-Function.html">Data.Function</a> module, but there&#39;s no typeclass &#8211; just some common functions that are also available from the Prelude.</p><p>So &#8211; why isn&#39;t there a typeclass for functions? Is it &#34;just because there isn&#39;t&#34; or &#34;because it&#39;s not so useful as you think&#34;? Or maybe there&#39;s a fundamental problem with the idea?</p><p>The biggest possible problem I&#39;ve thought of so far is that function application on actual functions would probably have to be special-cased by the compiler to avoid a looping problem &#8211; in order to apply this function I need to apply the function application function, and to do that I need to call the function application function, and to do that&#8230;</p><p><strong>More Clues</strong></p><p>Example code to show what I&#39;m aiming for&#8230;</p><pre><code>{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE FlexibleInstances #-}
{-# LANGUAGE GADTs #-}

--  In my first version, Doable only had the one argument f. This version
--  seemed to be needed to support the UndoableOffset type.
--
--  It seems to work, but it also seems strange. In particular,
--  the composition function - a and b are in the class, but c isn&#39;t,
--  yet there&#39;s nothing special about c compared with a and b.
class Doable f a b where
  fwdApply :: f a b -&gt; a -&gt; b
  compDoable :: f b c -&gt; f a b -&gt; f a c

--  In the first version, I only needed a constraint for
--  Doable f a b, but either version makes sense.
class (Doable f a b, Doable f b a) =&gt; Undoable f a b where
  bwd      :: f a b -&gt; f b a

  bwdApply :: f a b -&gt; b -&gt; a
  bwdApply f b = fwdApply (bwd f) b

--  Original ADT - just making sure I could wrap a pair of functions
--  and there were no really daft mistakes.
data UndoableFn a b = UFN { getFwd :: a -&gt; b, getBwd :: b -&gt; a }

instance Doable UndoableFn a b where
  fwdApply = getFwd
  compDoable f g = UFN ((getFwd f) . (getFwd g)) ((getBwd g) . (getBwd f))

instance Undoable UndoableFn a b where
  bwd f    = UFN (getBwd f) (getFwd f)
  bwdApply = getBwd

--  Making this one work led to all the extensions. This representation
--  can only represent certain functions. I seem to need the typeclass
--  arguments, but also to need to restrict which cases can happen, hence
--  the GADT. A GADT with only one constructor still seems odd. Perhaps
--  surprisingly, this type isn&#39;t just a toy (except that the whole thing&#39;s
--  a toy really) - it&#39;s one real case I need for the exercise. Still a
--  simple special case though.
data UndoableOffset a b where
  UOFF :: Int -&gt; UndoableOffset Int Int

instance Doable UndoableOffset Int Int where
  fwdApply (UOFF x) y = y+x
  compDoable (UOFF x) (UOFF y) = UOFF (x+y)

instance Undoable UndoableOffset Int Int where
  bwdApply (UOFF x) y = y-x
  bwd (UOFF x) = UOFF (-x)

--  Some value-constructing functions
--  (-x) isn&#39;t shorthand for subtraction - whoops.
undoableAdd :: Int -&gt; UndoableFn Int Int
undoableAdd x = UFN (+x) (\y -&gt; y-x)

undoableMul :: Int -&gt; UndoableFn Int Int
undoableMul x = UFN (*x) (`div` x)

--  With UndoableFn, it&#39;s possible to define an invertible function
--  that isn&#39;t invertible - to break the laws. To prevent that, need
--  the UFN constructor to be private (and all public ops to preserve
--  the laws). undoableMul is already not always invertible.
validate :: Undoable f a b =&gt; Eq a =&gt; f a b -&gt; a -&gt; Bool
validate f x = (bwdApply f (fwdApply f x)) == x

--  Validating a multiply-by-zero invertible function shows the flaw
--  in the validate-function plan. Must try harder.
main = do putStrLn . show $ validate (undoableAdd 3) 5
          putStrLn . show $ validate (undoableMul 3) 5
          --putStrLn . show $ validate (undoableMul 0) 5
          fb1 &lt;- return $ UOFF 5
          fb2 &lt;- return $ UOFF 7
          fb3 &lt;- return $ compDoable fb1 fb2
          putStrLn $ &#34;fwdApply fb1  3 = &#34; ++ (show $ fwdApply fb1  3)
          putStrLn $ &#34;bwdApply fb1  8 = &#34; ++ (show $ bwdApply fb1  8)
          putStrLn $ &#34;fwdApply fb3  2 = &#34; ++ (show $ fwdApply fb3  2)
          putStrLn $ &#34;bwdApply fb3 14 = &#34; ++ (show $ bwdApply fb3 14)
</code></pre><p>The application involves a kind of unification where unified values aren&#39;t equal, but are related via those invertible functions &#8211; Prolog-style logic but with <code>a = f(b)</code> constraints rather than <code>a = b</code>. Most of the composition will result from optimizing a union-find structure. The need for inverses should be obvious.</p><p>If no item in a unified set has an exact value, then a particular item can only be quantified relative to another item in that unified set. That&#39;s why I don&#39;t want to use &#34;real&#34; functions &#8211; computing those relative values. I could drop the whole function aspect and just have absolute and relative quantities &#8211; I probably only need numbers/vectors and <code>(+)</code> &#8211; but my inner architecture astronaut wants his fun.</p><p>The only way I break the links apart again is via backtracking, and everything is pure &#8211; union-find will be done using keys into an <code>IntMap</code> as &#34;pointers&#34;. I have simple union-find working, but as I haven&#39;t added the invertible functions yet, there&#39;s no point listing it here.</p><p><strong>Reasons I can&#39;t use Applicative, Monad, Arrow etc</strong></p><p>The main operations I need the function abstraction class to provide are application and composition. That sounds familiar &#8211; e.g. the <code>Applicative</code> <code>(&lt;*&gt;)</code>, <code>Monad</code> <code>(&gt;&gt;=)</code> and <code>Arrow</code> <code>(&gt;&gt;&gt;)</code> are all composition functions. However, the types that implement the function abstraction in my case will contain some data structure that represents a function, but which isn&#39;t (and can&#39;t contain) a function, and which can only represent some limited set of functions.</p><p>As I mentioned in the explanation of the code, sometimes I can only quantify one item relative to another because no item in a &#34;unified&#34; cluster has an exact value. I want to be able to derive a representation of that function, which in general will be the composition of several provided functions (walking up to a common ancestor in the union/find tree) and of several inverse functions (walking back down to the other item).</p><p>Simple case &#8211; where the original &#34;functions&#34; are limited to integer-offset &#34;functions&#34;, I want the composed result as an integer-offset &#34;function&#34; &#8211; add the component offsets. That&#39;s a big part of why the composition function needs to be in the class as well as the application function.</p><p>This means I cannot provide the operations <code>pure</code>, <code>return</code> or <code>arr</code> for my types, so I can&#39;t use <code>Applicative</code>, <code>Monad</code> or <code>Arrow</code>.</p><p>This isn&#39;t a failure of those types &#8211; it&#39;s a mismatch of abstractions. The abstraction I want is of a simple pure function. There&#39;s no side-effecting, for example, and no need to build a convenient notation for sequencing and composing the functions other than an equivalent of the standard (.) that applies to all functions.</p><p>I <em>could</em> instance <code>Category</code>. I&#39;m confident that all my functiony-things will be able to provide an identity, though I probably don&#39;t need it. But as <code>Category</code> doesn&#39;t support application, I&#39;d still need a derived class anyway to add that operation.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Well, I don&#39;t know of any baked in ideas that market themselves as representing &#34;function-y&#34; things. But there are several that come close</p><h3>Categories</h3><p>If you have a simple function concept that has identities and composition, than you have a category.</p><pre><code>class Category c where
  id :: c a a
  (.) :: c b c -&gt; c a b -&gt; c a c
</code></pre><p>The disadvantage is that you cannot create a nice category instance with a set of objects (<code>a</code>, <code>b</code>, and <code>c</code>). You can create a custom category class I suppose.</p><h3>Arrows</h3><p>If your functions have a notion of products and can inject arbitrary functions, than arrows are for you</p><pre><code> class Arrow a where
   arr :: (b -&gt; c) -&gt; a b c
   first :: a b c -&gt; a (b, d) (c, d)
   second :: a b c -&gt; a (d, b) (d, c)
</code></pre><p><code>ArrowApply</code> has a notion of application which looks important for what you want.</p><h3>Applicatives</h3><p>Applicatives have your notion of application, I&#39;ve used them in an AST to represent function application.</p><pre><code>class Functor f =&gt; Applicative f where
  pure :: a -&gt; f a
  (&lt;*&gt;) :: f (a -&gt; b) -&gt; f b -&gt; f c
</code></pre><p>There are many other ideas. But a common theme is to build up some data structure representing your function, and than pass it to an interpretation function.</p><p>This also how many free monads work. I&#39;d suggest poking at these if you&#39;re feeling brave, they&#39;re a powerful tool for the stuff that you&#39;re suggesting and essentially let you build up a datastructure using <code>do</code> notation and then collapse it into a side effecting computation with different functions. But the beauty is that these functions just operation on the datastructure, and aren&#39;t really aware of how you made it all. This is what&#39;d I&#39;d suggest for your example of an interpreter.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../why-isnt-length-generic-by-default/'>Why isn&#8217;t `length` generic by default</a></li><li class="list-group-item"><a href='../c-implement-haskell-typeclass-with-c-interface/'>C# &#8211; Implement Haskell typeclass with C# interface</a></li><li class="list-group-item"><a href='../c-why-do-all-functions-take-only-ranges-not-containers/'>C++ &#8211; Why do all <algorithm> functions take only ranges, not containers</a></li><li class="list-group-item"><a href='../why-isnt-bounded-a-subclass-of-enum-in-haskell/'>Why isn&#8217;t Bounded a subclass of Enum in Haskell</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>