<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Which algorithm is performant for matrix multiplication of 4&#215;4 matrices of affine transformations &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068878 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068878" class="post-1068878 software type-software status-publish hentry category-software tag-algorithms tag-matrix"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Which algorithm is performant for matrix multiplication of 4&#215;4 matrices of affine transformations</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">algorithms</span><span class="mr-2 badge badge-info">matrix</span></p><div class="entry-content"><p>I am wondering what is a good, performant algorithm for matrix multiplication of 4&#215;4 matrices. I am implementing some affine transformations and I am aware that there are several algorithms for efficient matrix multiplication, like Strassen. But are there some algorithms that are especially efficient for matrices that small? Most sources I had a glance at are looking at which are asymptotically the most efficient.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Wikipedia lists four algorithms for <a href="https://en.wikipedia.org/wiki/Computational_complexity_of_mathematical_operations#Matrix_algebra" rel="noreferrer">matrix multiplication of two nxn matrices</a>.</p><p>The classic one that a programmer would write is O(n<sup>3</sup>) and is listed as the &#34;Schoolbook matrix multiplication&#34;.  Yep.  O(n<sup>3</sup>) is a bit of a hit.  Lets look at the next best one.</p><p>The <a href="https://en.wikipedia.org/wiki/Strassen_algorithm" rel="noreferrer">Strassen algorithim</a> is O(n<sup>2.807</sup>).  This one would work - it has some restrictions to it (such as the size is a power of two) and it has a caveat in the description:</p><blockquote><p>Compared to conventional matrix multiplication, the algorithm adds a considerable O(n<sup>2</sup>) workload in addition/subtractions; so below a certain size, it will be better to use conventional multiplication.</p></blockquote><p>For those who are interested in this algorithm and its origins, looking at <a href="https://softwareengineering.stackexchange.com/questions/199627/how-did-strassen-come-up-with-his-matrix-multiplication-method">How did Strassen come up with his matrix multiplication method?</a> can be a good read. It gives a hint at the complexity of that initial O(n<sup>2</sup>) workload that is added and why this would be more expensive than just doing the classic multiplication.</p><p>So it really is O(n<sup>2</sup> + n<sup>2.807</sup>) with that bit about lower exponent <em>n</em> being ignored when writing out big O. It appears that if you are working on a nice 2048x2048 matrix, this could be useful.  For a 4x4 matrix, its probably going to find it slower as that overhead eats up all the other time.</p><p>And then there&#39;s the <a href="https://en.wikipedia.org/wiki/Coppersmith–Winograd_algorithm" rel="noreferrer">Coppersmith–Winograd algorithm</a> which is O(n<sup>2.373</sup>) with quite a few bits of improvements. It also comes with a caveat:</p><blockquote><p>The Coppersmith–Winograd algorithm is frequently used as a building block in other algorithms to prove theoretical time bounds. However, unlike the Strassen algorithm, it is not used in practice because it only provides an advantage for matrices so large that they cannot be processed by modern hardware.</p></blockquote><p>So, its better when you are working on super large matrixes, but again, not useful for a 4x4 matrix.</p><p>This is again reflected in wikipedia&#39;s page in <a href="https://en.wikipedia.org/wiki/Matrix_multiplication_algorithm#Sub-cubic_algorithms" rel="noreferrer">Matrix multiplication: Sub-cubic algorithms</a> which gets at the why of things running faster:</p><blockquote><p>Algorithms exist that provide better running times than the straightforward ones. The first to be discovered was Strassen&#39;s algorithm, devised by Volker Strassen in 1969 and often referred to as &#34;fast matrix multiplication&#34;. It is based on a way of multiplying two 2 × 2-matrices which requires only 7 multiplications (instead of the usual 8), at the expense of several additional addition and subtraction operations. Applying this recursively gives an algorithm with a multiplicative cost of O(n<sup>log<sub>2</sub>7</sup>) ≈ O(n<sup>2.807</sup>). Strassen&#39;s algorithm is more complex, and the numerical stability is reduced compared to the naïve algorithm, but it is faster in cases where n &gt; 100 or so and appears in several libraries, such as BLAS.</p></blockquote><p>And that gets to the core of why the algorithms are faster - you trade off some numerical stability and some additional setup. That additional setup for a 4x4 matrix is much more than the cost of doing the  more multiplication.</p><p>And now, to answer your question:</p><blockquote><p>But are there some algorithms that are especially efficient for matrices that small?</p></blockquote><p>No, there are no algorithms that are optimized for 4x4 matrix multiplication because the O(n<sup>3</sup>) one works quite reasonably until you start finding that you are willing to take a <em>big</em> hit for overhead. For your specific situation, there may be some overhead that you could incur knowing specific things beforehand about your matrixes (like how much some data will be reused), but really the easiest thing to do is write good code for the O(n<sup>3</sup>) solution, let the compiler handle it, and profile it later on to see if you actually have the code being the slow spot in the matrix multiplication.</p><p>Related on Math.SE: <a href="https://math.stackexchange.com/q/473875/49763">Minimal number of multiplications required to invert a 4x4 matrix</a></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/c-algorithms-for-operator/'>C# Algorithms for * Operator</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/effective-and-simple-matching-for-2-unequal-small-scale-point-sets/'>Effective and simple matching for 2 unequal small-scale point sets</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-optimal-fixed-size-sequential-sorting-algorithms/'>C++ &#8211; Optimal fixed-size sequential sorting algorithms</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/using-a-different-algorithm-depending-on-the-size-of-the-input/'>Using a different algorithm depending on the size of the input</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>