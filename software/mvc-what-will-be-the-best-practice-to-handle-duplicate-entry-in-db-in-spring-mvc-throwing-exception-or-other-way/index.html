<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Mvc &#8211; What will be the best practice to handle duplicate entry in DB in Spring MVC, throwing Exception or other way &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1065024 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1065024" class="post-1065024 software type-software status-publish hentry category-software tag-design tag-mvc tag-spring"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Mvc &#8211; What will be the best practice to handle duplicate entry in DB in Spring MVC, throwing Exception or other way</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">mvc</span><span class="mr-2 badge badge-warning">spring</span></p><div class="entry-content"><p>I am currently working a School Management project using Spring stack, Kotlin as programming language and Neo4j for storage solution.</p><p>Here is the scenario, I am creating a Class entry in the DB. Lets assume the properties of the Class entity object are <code>Name: Nine, Section: A, Shift: Morning</code>. When I am going to save in DB I have to make sure that there is no such Class that has same properties.</p><p>My question is, after duplication check how I suppose to propagate the massage to the other layer or to the client side ? Throw an <code>Exception</code> in the layer where it found the duplication or any other normal flow ?</p><p>Here is what I am currently handling this scenario. Providing <code>Kotlin</code> code.</p><p><strong>Controller</strong></p><pre><code>open fun post(@RequestBody cls: Course, request: HttpServletRequest): ResponseEntity&lt;*&gt; {        

    try {
        createdClass = classService.save(cls)
    }
    catch (ex: DuplicateCourseException) {            
        return responseConflict(cls)
    }catch (ex: DuplicateKeyException){
        return responseConflict(cls)
    }
    return responseOK(createdClass)
}
</code></pre><p><strong>Service Layer</strong></p><pre><code>open fun save(course: Course): Course {
// Checking the DB 
    val foundDuplicate = classRepo.findListByOrganizationName(course.organization?.name)
            .filter {
                it.name == course.name
                it.section == course.section
                it.shift == course.shift
            }
            .isEmpty()
            .not()
    if (foundDuplicate) {
        // Custom Exception
        throw DuplicateCourseException(&#34;Duplicate Class Found&#34;)
    }
    return classRepo.save(course)
}
</code></pre><p>Or just checking from the Controller, like following code</p><pre><code>open fun post(@RequestBody cls: Course, request: HttpServletRequest): ResponseEntity&lt;*&gt; {        

    if (classService.checkClassAlreadyExist(cls)) {
         return responseConflict(cls)
     }
   createdClass = classService.save(createdClass)         
   return responseOK(createdClass)
}
</code></pre><p>Or I could use some <code>DTO</code> to communicate between service layer and controller. And that <code>DTO</code> have some properties, that can tell the status of duplicate entry found. I am also aware that <code>ControllerAdvice</code> can handle Exception more elegantly.</p><p>So I would need suggestion what will be the best way to handle duplicate entry in DB ?</p><p><strong>=======UPDATE=======</strong></p><p>In my case apply uniqueness constraint in DB may not be possible. For example A class properties may be <code>Name: Nine, Section: A, Shift: Morning</code> and another class property <code>Name: Nine, Section: A, Shift: Day</code>. In this case constraint is the combination of the entity&#39;s values. Same combination should not be exist in DB. So I might have to check  uniqueness from application layer.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Working with Spring worthwhile to stick to its features and capabilities. Unless they were incompatible with your requirements, in which case the usage of Spring would be questionable.</p><p><strong>1. Error Handling</strong></p><p>You already have mentioned the approach proposed by Spring. <em><a href="https://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc" rel="nofollow noreferrer">@ControllerAdvice</a></em>. You can implement a dedicated component for error handling or use the annotations directly in the controllers.</p><p>This will reduce significantly the duplicity of <em>try/catch</em> blocks in all the  Controllers.</p><p><strong>2. Throwing errors</strong></p><p>It&#39;s a common question: <em>Do I delegate the data integrity control <strong>only</strong> to the DB?</em></p><p>I&#39;m usually against. To me, the DB constraints are the last line of defence, not the only. Usually, the constraints reflect business rules so I&#39;m in favour of making these rules explicit and readable along the code.</p><p>Don&#39;t get me wrong, I&#39;m not suggesting to remove DB constraints. <strong>They must be</strong>. If there were more systems accessing to the DB, they will prevent you from unexpected data integrity violations.</p><p>Whether you use <em><a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/dao/DataIntegrityViolationException.html" rel="nofollow noreferrer">Spring&#39;s Data Integrity Violation Exceptions</a></em>, business exceptions or domain model exceptions, if you have implemented #1, the error handling makes these differences irrelevant.</p><p>The place where the exceptions should be thrown depends on you. Due to these sort of exceptions are related to the business, I would not throw them from the <em>Controllers</em>. They should be as agnostic to the business as possible.</p><p>I would suggest doing the validations and the error throw from the domain layer. The layer closer to the DAL. One important thing is to be consistent with the implementation. Wherever you decide to do the validation, stick to such strategy.</p><p><strong>3. The validation</strong></p><p>Instead of retrieving all the collection</p><pre><code>classRepo.findListByOrganizationName(course.organization?.name) 
  .filter { it.name == course.name 
       it.section == course.section 
       it.shift == course.shift }
   .isEmpty() .not()
</code></pre><p>Why don&#39;t you simply do a <em>count</em> of the rows?</p><pre><code>classRepo.countByOrganizationName(...)
</code></pre><p>or</p><pre><code>classRepo.existByOrganizationName(...)
</code></pre><p><strong>4. The question</strong></p><blockquote><p>how I suppose to propagate the massage to the other layer or to the
 client side ?</p></blockquote><p>Depends. If upper layers are just going to catch it for throwing its own exception, then just let it go up to the <em>@ControllerAdvice</em>. Feeding the exception stacktrace with more traces won&#39;t make your code better.</p><p>But, if the upper layers can deal with it and there&#39;s a <em>Plan B</em> for the failed execution, then catch it.</p><p>You will find that Spring DAO&#39;s exceptions are RuntimeException for a good reason ;-).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../mvc-the-proper-way-to-pass-the-parameters-into-a-mvc-system/'>Mvc &#8211;  the proper way to pass the parameters into a MVC system</a></li><li class="list-group-item"><a href='../java-what-should-be-the-best-way-to-run-a-long-operation-in-java-spring/'>Java &#8211; What should be the best way to run a long operation in Java Spring</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>