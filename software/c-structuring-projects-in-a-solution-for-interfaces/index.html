<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Structuring projects in a solution for interfaces &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070384 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070384" class="post-1070384 software type-software status-publish hentry category-software tag-c tag-interfaces tag-project-structure"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Structuring projects in a solution for interfaces</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">interfaces</span><span class="mr-2 badge badge-warning">project-structure</span></p><div class="entry-content"><p>I had this idea that I would achieve some good automation and separation of concerns as follows:</p><ol><li>Define an interface, <code>IDataProvider</code>, in a class in a <code>DataMuncher</code> project that needs to both consume and output data.</li><li>In separate projects, have different implementations of that interface, e.g., in <code>LunarData.csproj</code> would be <code>LunarDataProvider : IDataProvider</code>, and in <code>SolarData.csproj</code> would be <code>SolarDataProvider : IDataProvider</code>.</li><li>In <code>DataMuncher</code>, reflect over the assembly and linked assemblies and find all classes implementing <code>IDataProvider</code>.</li><li>Create instances of the <code>IDataProvider</code>-implementing classes that were found, ask them what data they can provide, and if their data matches up with what was similarly learned from <code>IDataConsumer</code> classes, request the appropriate data, and send it onward to the consumers.</li></ol><p>The idea is that if I need to add a new data provider, I can do so with only the barest touch on any other projects. I just create a new project, add a class that implements <code>IDataProvider</code>, and whether I&#39;m manufacturing the data (as might occur in a unit test), reading from a text file, connecting to a database, or calling a web API, or any other means of getting the data, as long as I return it in the form required by the interface, it can be consumed. Thus, the quirks of the data are not exposed to the rest of the system and no proper nouns are propagated to other parts when they shouldn&#39;t be.</p><p>However, I&#39;ve run into a wee bit of a problem where the provider classes need to depend on the <code>DataMuncher</code>, but the <code>DataMuncher</code> needs to depend on the provider classes (in order to do what ultimately amounts to self dependency-injection).</p><p>So for this scenario to work I need at least 3 projects: one where the interface is defined, one where it&#39;s implemented (dependent), and one that is dependent on both of them that does what amounts to dependency injection, call this the <code>DataHub</code> project. But that seems like a lot of complexity.</p><p>One suggestion was made to just put the interface definition and the data source implementations all in the same project. This would enable the implementing project to have no outside dependencies, and would avoid the need for another coordinating project to which many projects must refer. It also reduces the number of projects in the solution, which is also a possible benefit. (E.g., <code>DataProviders.cs</code> would have all three: <code>IDataProvider</code> plus <code>LunarDataProvider</code> and <code>SolarDataProvider</code>.</p><p>What would you do in this scenario? I saw value in having one project per implementation, but I have to admit that I don&#39;t have a plethora of experience with various project structures that would have given me an idea of what works best. I also saw value in the division between projects forcing the separation of implementation internals from other projects, so that no one implementation would ever, even by mistake, use code or classes from another implementation. With one project each, a review of the project reference dependency graph could easily establish that the separate implementations are properly isolated from each other. This makes sure the code is truly modular and properly encapsulated.</p><p>Another benefit of separate projects is that if the data source doesn&#39;t need to access, say, a database, there are no references to database libraries. Perhaps it&#39;s file-based, and doesn&#39;t need any dependencies. Then, the reference graph can be examined for correctness and anything strange will stick out much better: rather than &#34;hmmm, I guess one of the 10 implementations uses that library&#34;, &#34;why is X using Y!?!&#34;</p><p>I also considered, still with three projects, defining the interface in the <code>DataHub</code>, but this would prevent it, due to circular reference problems, from doing the reflection to find data sourcesâ€”the recipient of the benefit of the interface, <code>DataMuncher</code>, would have to perform that task, and instead of <code>LunarData</code> having a reference to <code>DataMuncher</code>, it would be the other way around. This is now more references, and the <code>DataHub</code> class now also has to have a lot of projects referencing it (again, instead of the other way around). All these extra references suggest that perhaps the single project with interface <em>and</em> implementations is better.</p><p>Some guidance or ideas would be appreciated.</p><p>Hmmmm &#8230; it just occurred to me, 20 minutes after posting, that perhaps I should simply use a dependency injection library. That would use a pattern that is well established, and would remove some of the questions by reducing the number of reasonable ways to structure things. Still thinking on this &#8230;</p><p><strong>For Reference</strong></p><p>First we go fetch all the types available in all referenced assemblies that implement <code>IDataProvider</code>:</p><pre><code>var types = GetType()
   .Assembly
   .GetReferencedAssemblies()
   .SelectMany(assemblyName =&gt; Assembly.Load(assemblyName).GetTypes())
   .Where(type =&gt; (typeof (IDataProvider)).IsAssignableFrom(type))
   .ToList();
</code></pre><p>Then we can create instances of these:</p><pre><code>var instantiatedTypes = types
   .Select(Activator.CreateInstance)
   .ToList()
   .AsReadOnly();
</code></pre><p>This list of instantiated types then need to be passed to the core of the system, as a parameter to the <code>DataMuncher</code> class (or perhaps a method).</p><pre><code>public sealed class DataMuncher {
   public DataMuncher(
      IEnumerable&lt;IDataProvider&gt; dataProviders,
      IEnumerable&lt;IDataConsumer&gt; dataConsumers
   ) {
      var consumersAndData = dataConsumers
         .Select(consumer =&gt; new { consumer, dataspec = consumer.GetDesiredDataSpecification() })
         .Select(cas =&gt; new {
            cas.consumer,
            cas.dataspec,
            data = dataProviders
               .Select(provider =&gt; provider.RetrieveData(cas.dataspec))
         })
         .ToList();
      consumersAndData.ForEach(cas =&gt; cas.consumer.ReceiveData(cas.data));
   }
}
</code></pre><p>This is very rough, just to show the idea. Don&#39;t bother code reviewing this particular code, it is only here to show the basic idea and get assistance in how to structure the interfaces.</p><p>Note: I have been reading <a href="http://www.taimila.com/blog/.net-solution-structure-of-an-enterprise-application/" rel="nofollow noreferrer">.Net solution structure of an enterprise application</a> and it is possibly helping, but I don&#39;t have a conclusion yet.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You can have one project holding the DataMuncher and the IDataProvider. Reference it from one or more Data Provider projects, implement the IDataProvider there.</p><p>From your application&#39;s composite root have the concrete Data Provider injected into your DataMuncher before use.</p><p>What is not clear from your post is why DataMuncher was/is dependant on the Data Providers. If you invert this dependency properly things would get simple. DataMuncher defines the contract, the Data Provider project(s) provide an implementation.</p><p>Your app&#39;s composition root configures when to use which implementation.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-separating-java-projects/'>Java &#8211; Separating java projects</a></li><li class="list-group-item"><a href='../1-interface-2-implementations-and-an-ejb-exception/'>1 Interface 2 Implementations and an EJB exception</a></li><li class="list-group-item"><a href='../c-organising-data-access-for-dependency-injection/'>C# &#8211; Organising data access for dependency injection</a></li><li class="list-group-item"><a href='../interfaces-between-multiple-projects/'>Interfaces between multiple projects</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>