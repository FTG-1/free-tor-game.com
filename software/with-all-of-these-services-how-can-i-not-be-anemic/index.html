<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>With all of these services, how can I not be anemic &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1066495 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1066495" class="post-1066495 software type-software status-publish hentry category-software tag-domain-driven-design tag-domain-model"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">With all of these services, how can I not be anemic</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">domain-driven-design</span><span class="mr-2 badge badge-info">domain-model</span></p><div class="entry-content"><p>Where do we draw the line between delegation and encapsulation of business logic? It seems to me that the more we delegate, the more <a href="http://www.martinfowler.com/bliki/AnemicDomainModel.html">anemic</a> we become. However, delegation also promotes reuse and the DRY principal. So what is appropriate to delegate and what should remain in our domain models?</p><p>Take the following concerns as examples:</p><p><strong>Authorization</strong>. Should the domain object be responsible for maintaining its access control rules (such as a CanEdit property) or should that be delegated to another component/service solely responsible for managing access, e.g. IAuthorizationService.CanEdit(object)? Or should it be a combination of the two? Perhaps the domain object has a CanEdit property which delegates to an internal IAuthorizationService to perform the actual work?</p><p><strong>Validation</strong>. The same discussion as above relates to validation. Who maintains the rules and who is responsible for evaluating them? On the one hand, the state of the object should belong to that object and validity is a state but we don&#39;t want to rewrite the code used to evaluate rules for every domain object. We <em>could</em> use inheritance in this case&#8230;</p><p><strong>Object Creation</strong>. Factory class versus factory methods versus &#39;newing&#39; up an instance. If we use a separate factory class, we are able to isolate and encapsulate creation logic but at the expense of opening our object&#39;s state to the factory. This can be managed if our domain layer is in a separate assembly by exposing an internal constructor used by the factory but this becomes a problem if there are multiple creation patterns. And, if all the factory is doing is calling the right constructor, what&#39;s the point of having the factory?</p><p>Factory methods on the class eliminate the issue with opening up the object&#39;s internal state but since they are static, we aren&#39;t able to break dependencies through injection of a factory interface like we can with a separate factory class.</p><p><strong>Persistence</strong>. One could argue that if our domain object is going to expose CanEdit while delegating the responsibility to perform the authorization check to another party (IAuthorizationService) why not have a Save method on our domain object that does the same thing? This would allow us to evaluate the internal state of the object to determine if the operation can be performed without breaking encapsulation. Of course it requires that that we inject the repository instance into our domain object, which smells a bit to me, so do we raise a domain event instead and allow a handler to perform the persistance operation?</p><p>See where I&#39;m going with this?</p><p>Rockford Lhotka has a great discussion about his reasons for going the Class-in-Charge route for his CSLA framework and I have a bit of history with that framework and can see his idea of business objects paralleling domain objects in many ways. But trying to become more adherent to good DDD ideals, I&#39;m wondering when collaboration becomes too much.</p><p>If I end up with an IAuthorizationService, IValidator, IFactory and IRepository for my aggregate root, what&#39;s left? Is having a Publish method that changes the state of the object from Draft to Published enough to consider the class a non-anemic domain object?</p><p>Your thoughts?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Most of the confusion seems to be around functionality that should not exist in the domain model at all:</p><ul><li><p><strong>Persistence</strong> should never be in the domain model.  Never ever.  That&#39;s the reason you rely on abstract types such as <code>IRepository</code> if part of the model ever needs to do something like retrieve a different part of the model, and use dependency injection or some similar technique to wire up the implementation.  So strike that from the record.</p></li><li><p><strong>Authorization</strong> is not <em>generally</em> part of your domain model, unless it is actually part of the domain, e.g. if you&#39;re writing security software.  The mechanics of who is allowed to perform what in an application are normally handled at the &#34;edge&#34; of the business/domain tier, the public parts that the UI and Integration pieces are actually allowed to talk to - the Controller in MVC, the Services or the messaging system itself in an SOA... you get the picture.</p></li><li><p><strong>Factories</strong> (and I assume you mean abstract factories here) aren&#39;t exactly <em>bad</em> to have in a domain model but they are almost always unnecessary.  Normally you only have a factory when the inner mechanics of object creation might change.  But you only have one implementation of the domain model, which means that there will only ever be one kind of factory which always invokes the same constructors and other initialization code.</p><p>You can have &#34;convenience&#34; factories if you want - classes that encapsulate common combinations of constructor parameters and so on - but honestly, generally speaking, if you&#39;ve got a lot of factories sitting in your domain model then you&#39;re just wasting lines of code.</p></li></ul><p>So once you turf all of those, that just leaves validation.  That&#39;s the only one that&#39;s kind of tricky.</p><p><strong>Validation</strong> <em>is</em> part of your domain model but it is also a part of every other component of the application.  Your UI and database will have their own, similar yet different validation rules, based on a similar yet different conceptual model.  It&#39;s not really specified whether or not objects need to have a <code>Validate</code> method but even if they do, they&#39;ll usually delegate it to a validator class (not interface - validation is <strong>not</strong> abstract in the domain model, it is fundamental).</p><p>Keep in mind that the validator is still technically part of the model; it doesn&#39;t need to be attached to an aggregate root because it doesn&#39;t contain any data or state.  Domain models are conceptual things, usually physically translating to an assembly or a collection of assemblies.  Don&#39;t stress out over the &#34;anemic&#34; issue if your delegation code resides in very close proximity to the object model; it still counts.</p><p>What this all really comes down to is that if you&#39;re going to do DDD, you have to understand what the domain <em>is</em>.  If you&#39;re still talking about things like persistence and authorization then you&#39;re on the wrong track.  The domain represents the running state of a system - the physical and conceptual objects and attributes.  Anything that is not directly relevant to the objects and relationships themselves does not belong in the domain model, period.</p><p>As a rule of thumb, when considering whether or not something belongs in the domain model, ask yourself the following question:</p><p><strong>&#34;Can this functionality ever change for purely technical reasons?&#34;</strong> In other words, not due to any observable change to the real-world business or domain?</p><p>If the answer is &#34;yes&#34;, then it doesn&#39;t belong in the domain model. It&#39;s not part of the domain.</p><p>There&#39;s a very good chance that, someday, you&#39;ll change your persistence and authorization infrastructures.  Therefore, they aren&#39;t part of the domain, they&#39;re part of the application.  This also applies to algorithms, like sorting and searching; you shouldn&#39;t go and shove a binary search code implementation into your domain model, because your domain is only concerned with the abstract concept of a search, not how it works.</p><p>If, after you&#39;ve stripped away all the stuff that doesn&#39;t matter, you find that the domain model is truly <em>anemic</em>, then that should serve as a pretty good indication that DDD is simply the wrong paradigm for your project.</p><p>Some domains really <em>are</em> anemic.  Social bookmarking apps don&#39;t really have much of a &#34;domain&#34; to speak of; all your objects are basically just data with no functionality.  A Sales and CRM system, on the other hand, has a pretty heavy domain; when you load up a <code>Rate</code> entity then there is a reasonable expectation that you can actually <em>do stuff</em> with that rate, such as apply it to an order quantity and have it figure out the volume discounts and promo codes and all that fun stuff.</p><p>Domain objects that just hold data usually <em>do</em> mean that you have an anemic domain model, but that doesn&#39;t <em>necessarily</em> mean that you&#39;ve created a bad design - it might just mean that the domain itself is anemic and that you should be using a different methodology.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../are-domain-objects-in-domain-driven-design-only-supposed-to-be-write-only/'>Are Domain Objects in Domain Driven Design only supposed to be write-only</a></li><li class="list-group-item"><a href='../unit-testing-unit-testing-in-a-no-setter-world/'>Unit-testing &#8211; Unit Testing in a &#8220;no setter&#8221; world</a></li><li class="list-group-item"><a href='../should-internal-entities-in-an-aggregate-respond-to-domain-events-directly/'>Should internal entities in an aggregate respond to domain events directly</a></li><li class="list-group-item"><a href='../is-domain-persistence-model-isolation-usually-this-awkward/'>Is domain/persistence model isolation usually this awkward</a></li><li class="list-group-item"><a href='../ending-up-with-too-many-services-in-ddd/'>Ending up with too many services in DDD</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>