<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Is it okay to have objects that cast themselves, even if it pollutes the API of their subclasses &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068578 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068578" class="post-1068578 software type-software status-publish hentry category-software tag-inheritance tag-java tag-type-casting"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Is it okay to have objects that cast themselves, even if it pollutes the API of their subclasses</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">inheritance</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">type casting</span></p><div class="entry-content"><p>I have a base class, <code>Base</code>.  It has two subclasses, <code>Sub1</code> and <code>Sub2</code>.  Each subclass has some additional methods.  For example, <code>Sub1</code> has <code>Sandwich makeASandwich(Ingredients... ingredients)</code>, and <code>Sub2</code> has <code>boolean contactAliens(Frequency onFrequency)</code>.</p><p>Since these methods take different parameters and do entirely different things, they&#39;re completely incompatible, and I can&#39;t just use polymorphism to solve this problem.</p><p><code>Base</code> provides most of the functionality, and I have a large collection of <code>Base</code> objects.  However, all <code>Base</code> objects are either a <code>Sub1</code> or a <code>Sub2</code>, and sometimes I need to know which they are.</p><p>It seems like a bad idea to do the following:</p><pre><code>for (Base base : bases) {
    if (base instanceof Sub1) {
        ((Sub1) base).makeASandwich(getRandomIngredients());
        // ... etc.
    } else { // must be Sub2
        ((Sub2) base).contactAliens(getFrequency());
        // ... etc.
    }
}
</code></pre><p>So I came up with a strategy to avoid this without casting. <code>Base</code> now has these methods:</p><pre><code>boolean isSub1();
Sub1 asSub1();
Sub2 asSub2();
</code></pre><p>And of course, <code>Sub1</code> implements these methods as</p><pre><code>boolean isSub1() { return true; }
Sub1 asSub1();   { return this; }
Sub2 asSub2();   { throw new IllegalStateException(); }
</code></pre><p>And <code>Sub2</code> implements them in the opposite way.</p><p>Unfortunately, now <code>Sub1</code> and <code>Sub2</code> have these methods in their own API.  So I can do this, for example, on <code>Sub1</code>.</p><pre><code>/** no need to use this if object is known to be Sub1 */
@Deprecated
boolean isSub1() { return true; }

/** no need to use this if object is known to be Sub1 */
@Deprecated
Sub1 asSub1();   { return this; }

/** no need to use this if object is known to be Sub1 */
@Deprecated
Sub2 asSub2();   { throw new IllegalStateException(); }
</code></pre><p>This way, if the object is known to be only a <code>Base</code>, these methods are un-deprecated, and can be used to &#34;cast&#34; itself to a different type so I can invoke the subclass&#39;s methods on it.  This seems elegant to me in a way, but on the other hand, I&#39;m kind of abusing Deprecated annotations as a way to &#34;remove&#34; methods from a class.</p><p>Since a <code>Sub1</code> instance really <em>is a</em> Base, it does make sense to use inheritance rather than encapsulation.  Is what I&#39;m doing good?  Is there a better way to solve this problem?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It doesn&#39;t always make sense to add functions to the base class, as suggested in some of the other answers. Adding too many special case functions can result in binding otherwise unrelated components together.</p><p>For example I might have an <code>Animal</code> class, with <code>Cat</code> and <code>Dog</code> components. If I want to be able to print them, or show them in the GUI it might be overkill for me to add <code>renderToGUI(...)</code> and <code>sendToPrinter(...)</code> to the base class.</p><p>The approach you are using, using type-checks and casts, is fragile - but at least does keep the concerns separated.</p><p>However if you find yourself doing these types of checks/casts often then one option is to implement the visitor / double-dispatch pattern for it. It looks kind of like this:</p><pre><code>public abstract class Base {
  ...
  abstract void visit( BaseVisitor visitor );
}

public class Sub1 extends Base {
  ...
  void visit(BaseVisitor visitor) { visitor.onSub1(this); }
}

public class Sub2 extends Base {
  ...
  void visit(BaseVisitor visitor) { visitor.onSub2(this); }
}

public interface BaseVisitor {
   void onSub1(Sub1 that);
   void onSub2(Sub2 that);
}
</code></pre><p>Now your code becomes</p><pre><code>public class ActOnBase implements BaseVisitor {
    void onSub1(Sub1 that) {
       that.makeASandwich(getRandomIngredients())
    }

    void onSub2(Sub2 that) {
       that.contactAliens(getFrequency());
    }
}

BaseVisitor visitor = new ActOnBase();
for (Base base : bases) {
    base.visit(visitor);
}
</code></pre><p>The main benefit is that if you add a subclass, you&#39;ll get compile errors rather than silently missing cases. The new visitor class also becomes a nice target for pulling functions into. For example it might make sense to move <code>getRandomIngredients()</code> into <code>ActOnBase</code>.</p><p>You can also extract the looping logic: For example the above fragment might become</p><pre><code>BaseVisitor.applyToArray(bases, new ActOnBase() );
</code></pre><p>A little further massaging and using Java 8&#39;s lambdas and streaming would let you get to</p><pre><code>bases.stream()
     .forEach( BaseVisitor.forEach(
       Sub1 that -&gt; that.makeASandwich(getRandomIngredients()),
       Sub2 that -&gt; that.contactAliens(getFrequency())
     ));
</code></pre><p>Which IMO is pretty much as neat looking and succinct as you can get.</p><p>Here is a more complete Java 8 example:</p><pre><code>public static abstract class Base {
    abstract void visit( BaseVisitor visitor );
}

public static class Sub1 extends Base {
    void visit(BaseVisitor visitor) { visitor.onSub1(this); }

    void makeASandwich() {
        System.out.println(&#34;making a sandwich&#34;);
    }
}

public static class Sub2 extends Base {
    void visit(BaseVisitor visitor) { visitor.onSub2(this); }

    void contactAliens() {
        System.out.println(&#34;contacting aliens&#34;);
    }
}

public interface BaseVisitor {
    void onSub1(Sub1 that);
    void onSub2(Sub2 that);

    static Consumer&lt;Base&gt; forEach(Consumer&lt;Sub1&gt; sub1, Consumer&lt;Sub2&gt; sub2) {

        return base -&gt; {
            BaseVisitor baseVisitor = new BaseVisitor() {

                @Override
                public void onSub1(Sub1 that) {
                    sub1.accept(that);
                }

                @Override
                public void onSub2(Sub2 that) {
                    sub2.accept(that);
                }
            };
            base.visit(baseVisitor);
        };
    }
}

Collection&lt;Base&gt; bases = Arrays.asList(new Sub1(), new Sub2());

bases.stream()
     .forEach(BaseVisitor.forEach(
             Sub1::makeASandwich,
             Sub2::contactAliens));
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-naming-methods-that-do-the-same-thing-but-return-different-types/'>Java &#8211; Naming methods that do the same thing but return different types</a></li><li class="list-group-item"><a href='../java-checking-instanceof-rather-than-value-using-a-switch-statement/'>Java &#8211; Checking &#8220;instanceof&#8221; rather than value using a switch statement</a></li><li class="list-group-item"><a href='../java-n-alternative-to-instanceof-when-filtering-a-java-stream-by-class/'>Java &#8211; n alternative to instanceof when filtering a Java stream by class</a></li><li class="list-group-item"><a href='../java-data-validation-separated-class-or-not/'>Java &#8211; Data validation: separated class or not</a></li><li class="list-group-item"><a href='../java-why-does-java-have-void-methods/'>Java &#8211; Why does Java have `void` methods</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>