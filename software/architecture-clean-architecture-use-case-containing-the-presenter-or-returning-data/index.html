<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; Clean Architecture: Use case containing the presenter or returning data &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1063580 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1063580" class="post-1063580 software type-software status-publish hentry category-software tag-architectural-patterns tag-architecture tag-clean-architecture tag-onion-architecture"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; Clean Architecture: Use case containing the presenter or returning data</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">architectural-patterns</span><span class="mr-2 badge badge-info">Architecture</span><span class="mr-2 badge badge-warning">clean-architecture</span><span class="mr-2 badge badge-primary">onion-architecture</span></p><div class="entry-content"><p>The <a href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html" rel="noreferrer">Clean Architecture</a> suggests to let a use case interactor call the actual implementation of the presenter (which is injected, following the DIP) to handle the response/display. However, I see people implementing this architecture, returning the output data from the interactor, and then let the controller (in the adapter layer) decide how to handle it. Is the second solution leaking application responsibilities out of the application layer, in addition to not clearly defining input and output ports to the interactor?</p><h2>Input and output ports</h2><p>Considering <a href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html" rel="noreferrer">the Clean Architecture</a> definition, and especially the little flow diagram describing relationships between a controller, a use case interactor, and a presenter, I&#39;m not sure if I correctly understand what the &#34;Use Case Output Port&#34; should be.</p><p>Clean architecture, like hexagonal architecture, distinguishes between primary ports (methods) and secondary ports (interfaces to be implemented by adapters). Following the communication flow, I expect the &#34;Use Case Input Port&#34; to be a primary port (thus, just a method), and the &#34;Use Case Output Port&#34; an interface to be implemented, perhaps a constructor argument taking the actual adapter, so that the interactor can use it.</p><h2>Code example</h2><p>To make a code example, this could be the controller code:</p><pre><code>Presenter presenter = new Presenter();
Repository repository = new Repository();
UseCase useCase = new UseCase(presenter, repository);
useCase-&gt;doSomething();
</code></pre><p>The presenter interface:</p><pre><code>// Use Case Output Port
interface Presenter
{
    public void present(Data data);
}
</code></pre><p>Finally, the interactor itself:</p><pre><code>class UseCase
{
    private Repository repository;
    private Presenter presenter;

    public UseCase(Repository repository, Presenter presenter)
    {
        this.repository = repository;
        this.presenter = presenter;
    }

    // Use Case Input Port
    public void doSomething()
    {
        Data data = this.repository.getData();
        this.presenter.present(data);
    }
}
</code></pre><h2>On the interactor calling the presenter</h2><p>The previous interpretation seems to be confirmed by the aforementioned diagram itself, where the relation between the controller and the input port is represented by a solid arrow with a &#34;sharp&#34; head (UML for &#34;association&#34;, meaning &#34;has a&#34;, where the controller &#34;has a&#34; use case), while the relation between the presenter and the output port is represented by a solid arrow with a &#34;white&#34; head (UML for &#34;inheritance&#34;, which is not the one for &#34;implementation&#34;, but probably that&#39;s the meaning anyway).</p><p>Furthermore, in <a href="https://stackoverflow.com/questions/28892833/clean-architecture-robert-martin-how-to-connect-use-cases#answer-28929194">this answer to another question</a>, Robert Martin describes exactly a use case where the interactor calls the presenter upon a read request:</p><blockquote><p>Clicking on the map causes either the placePinController to be invoked. It gathers the location of the click, and any other contextual data, constructs a placePinRequest data structure and passes it to the PlacePinInteractor which checks the location of the pin, validates it if necessary, create a Place entity to record the pin, constructs a EditPlaceReponse object and passes it to the EditPlacePresenter which brings up the place editor screen.</p></blockquote><p>To make this play well with MVC, I could think that the application logic that traditionally would go into the controller, here is moved to the interactor, because we don&#39;t want any application logic to leak outside the application layer. The controller in the adapters layer would just call the interactor, and maybe do some minor data format conversion in the process:</p><blockquote><p>The software in this layer is a set of adapters that convert data from the format most convenient for the use cases and entities, to the format most convenient for some external agency such as the Database or the Web.</p></blockquote><p>from the original article, talking about Interface Adapters.</p><h2>On the interactor returning data</h2><p>However, my problem with this approach is that the use case must take care of the presentation itself. Now, I see that the purpose of the <code>Presenter</code> interface is to be abstract enough to represent several different types of presenters (GUI, Web, CLI, etc.), and that it really just means &#34;output&#34;, which is something a use case might very well have, but still I&#39;m not totally confident with it.</p><p>Now, looking around the Web for applications of the clean architecture, I seem to only find people interpreting the output port as a method returning some DTO. This would be something like:</p><pre><code>Repository repository = new Repository();
UseCase useCase = new UseCase(repository);
Data data = useCase.getData();
Presenter presenter = new Presenter();
presenter.present(data);

// I&#39;m omitting the changes to the classes, which are fairly obvious
</code></pre><p>This is attractive because we&#39;re moving the responsibility of &#34;calling&#34; the presentation out of the use case, so the use case doesn&#39;t concern itself with knowing what to do with the data anymore, rather just with providing the data. Also, in this case we&#39;re still not breaking the dependency rule, because the use case still doesn&#39;t know anything about the outer layer.</p><p>However, the use case doesn&#39;t control the moment when the actual presentation is performed anymore (which may be useful, for example to do additional stuff at that point, like logging, or to abort it altogether if necessary). Also, notice that we lost the Use Case Input Port, because now the controller is only using the <code>getData()</code> method (which is our new output port). Furthermore, it looks to me that we&#39;re breaking the &#34;tell, don&#39;t ask&#34; principle here, because we&#39;re asking the interactor for some data to do something with it, rather than telling it to do the actual thing in the first place.</p><h2>To the point</h2><p>So, is any of these two alternatives the &#34;correct&#34; interpretation of the Use Case Output Port according to the Clean Architecture? Are they both viable?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>The Clean Architecture suggests to let a use case interactor call the actual implementation of the presenter (which is injected, following the DIP) to handle the response/display. However, I see people implementing this architecture, returning the output data from the interactor, and then let <strong>the controller</strong> (in the adapter layer) decide how to handle it.</p></blockquote><p>That&#39;s certainly not <a href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html" rel="noreferrer">Clean</a>, <a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/" rel="noreferrer">Onion</a>, or <a href="http://alistair.cockburn.us/Hexagonal+architecture" rel="noreferrer">Hexagonal</a> Architecture. That is <a href="https://www.raywenderlich.com/132662/mvc-in-ios-a-modern-approach" rel="noreferrer">this</a>:</p><p><a href="../../../i.stack.imgur.com/GdAeb.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/GdAeb.png" alt="enter image description here"/></a></p><p>Not that <a href="https://en.wikipedia.org/wiki/Model–view–controller" rel="noreferrer">MVC</a> has to be done that way</p><p><a href="../../../i.stack.imgur.com/Z77ko.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/Z77ko.png" alt="enter image description here"/></a></p><p><a href="https://softwareengineering.stackexchange.com/a/321923/131624">You can use many different ways to communicate between modules and call it MVC</a>. Telling me something uses MVC doesn&#39;t really tell me how the components communicate. That isn&#39;t standardized. All it tells me is that there are at least three components focused on their three responsibilities.</p><p>Some of those ways have been given <a href="https://blogs.msdn.microsoft.com/erwinvandervalk/2009/08/14/the-difference-between-model-view-viewmodel-and-other-separated-presentation-patterns/" rel="noreferrer">different names</a>: <a href="../../../i.stack.imgur.com/Y82D3.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/Y82D3.png" alt="enter image description here"/></a></p><p>And every one of those can justifiably be called MVC.</p><p>Anyway, none of those really capture what the buzzword architectures (Clean, Onion, and Hex) are all asking you to do.</p><p><a href="../../../i.stack.imgur.com/RXfYa.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/RXfYa.png" alt="enter image description here"/></a></p><p>Add the data structures being flung around (and flip it upside down for some reason) and <a href="https://youtu.be/Nsjsiz2A9mg?t=41m42s" rel="noreferrer">you get</a>:</p><p><a href="../../../i.stack.imgur.com/GnDJo.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/GnDJo.png" alt="enter image description here"/></a></p><p>One thing that should be clear here is that the response model does not go marching through the controller.</p><p>If you are eagle eye&#39;d, you might have noticed that only the buzzword architectures completely avoid <a href="https://en.wikipedia.org/wiki/Circular_dependency" rel="noreferrer">circular dependencies</a>. That means the impact of a code change won&#39;t spread by cycling through components. The change will stop when it hits code that doesn&#39;t care about it.</p><p>Wonder if they turned it upside down so that the flow of control would go through clockwise. More on that, and these &#34;white&#34; arrow heads, later.</p><blockquote><p>Is the second solution leaking application responsibilities out of the application layer, in addition to not clearly defining input and output ports to the interactor?</p></blockquote><p>Since communication from Controller to Presenter is meant to go through the application &#34;layer&#34; then yes making the Controller do part of the Presenters job is likely a leak. This is my chief criticism of <a href="https://www.objc.io/issues/13-architecture/viper/" rel="noreferrer">VIPER architecture</a>.</p><p>Why separating these is so important could probably be best understood by studying <a href="https://martinfowler.com/bliki/CQRS.html" rel="noreferrer">Command Query Responsibility Segregation</a>.</p><blockquote><p>#Input and output ports</p></blockquote><blockquote><p>Considering the Clean Architecture definition, and especially the little flow diagram describing relationships between a controller, a use case interactor, and a presenter, I&#39;m not sure if I correctly understand what the &#34;Use Case Output Port&#34; should be.</p></blockquote><p>It&#39;s the API that you send output through, for this particular use case.  It&#39;s no more than that. The interactor for this use case doesn&#39;t need to know, nor want to know, if output is going to a GUI, a CLI, a log, or an audio speaker. All the interactor needs to know is the very simplest API possible that will let it report the results of it&#39;s work.</p><blockquote><p>Clean architecture, like hexagonal architecture, distinguishes between primary ports (methods) and secondary ports (interfaces to be implemented by adapters). Following the communication flow, I expect the &#34;Use Case Input Port&#34; to be a primary port (thus, just a method), and the &#34;Use Case Output Port&#34; an interface to be implemented, perhaps a constructor argument taking the actual adapter, so that the interactor can use it.</p></blockquote><p>The reason the output port is different from the input port is that it must not be OWNED by the layer that it abstracts. That is, the layer that it abstracts must not be allowed to dictate changes to it. Only the application layer and it&#39;s author should decide that the output port can change.</p><p>This is in contrast to the input port which is owned by the layer it abstracts. Only the application layer author should decide if it&#39;s input port should change.</p><p>Following these rules preserves the idea that the application layer, or any inner layer, does not know anything at all about the outer layers.</p><hr/><blockquote><p>#On the interactor calling the presenter</p></blockquote><blockquote><p>The previous interpretation seems to be confirmed by the aforementioned diagram itself, where the relation between the controller and the input port is represented by a solid arrow with a &#34;sharp&#34; head (UML for &#34;association&#34;, meaning &#34;has a&#34;, where the controller &#34;has a&#34; use case), while the relation between the presenter and the output port is represented by a solid arrow with a &#34;white&#34; head (UML for &#34;inheritance&#34;, which is not the one for &#34;implementation&#34;, but probably that&#39;s the meaning anyway).</p></blockquote><p>The important thing about that &#34;white&#34; arrow is that it lets you do this:</p><p><a href="../../../i.stack.imgur.com/8kkCl.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/8kkCl.png" alt="enter image description here"/></a></p><p>You can let the flow of control go in the opposite direction of dependency! That means the inner layer doesn&#39;t have to know about the outer layer and yet you can dive into the inner layer and come back out!</p><p>Doing that has nothing to do with using the &#34;interface&#34; keyword. You could do this with an abstract class. Heck you could do it with a (ick) concrete class so long as it can be extended.  It&#39;s simply nice to do it with something that focuses only on defining the API that Presenter must implement. The open arrow is only asking for polymorphism. What kind is up to you.</p><p>Why reversing the direction of that dependency is so important can be learned by studying the <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle" rel="noreferrer">Dependency Inversion Principle</a>. I mapped that principle onto these diagrams <a href="https://codereview.stackexchange.com/q/148809/40367">here</a>.</p><blockquote><p>#On the interactor returning data</p></blockquote><blockquote><p>However, my problem with this approach is that the use case must take care of the presentation itself. Now, I see that the purpose of the Presenter interface is to be abstract enough to represent several different types of presenters (GUI, Web, CLI, etc.), and that it really just means &#34;output&#34;, which is something a use case might very well have, but still I&#39;m not totally confident with it.</p></blockquote><p>No that&#39;s really it. The point of making sure the inner layers don&#39;t know about the outer layers is that we can remove, replace, or refactor the outer layers confident that doing so wont break anything in the inner layers. What they don&#39;t know about won&#39;t hurt them. If we can do that we can change the outer ones to whatever we want.</p><blockquote><p>Now, looking around the Web for applications of the clean architecture, I seem to only find people interpreting the output port as a method returning some DTO. This would be something like:</p></blockquote><blockquote><p><code> Repository repository = new Repository();</code><br/> <code> UseCase useCase = new UseCase(repository);</code><br/> <code> Data data = useCase.getData();</code><br/> <code> Presenter presenter = new Presenter();</code><br/> <code> presenter.present(data);</code><br/> <code> // I&#39;m omitting the changes to the classes, which are fairly obvious</code></p></blockquote><blockquote><p>This is attractive because we&#39;re moving the responsibility of &#34;calling&#34; the presentation out of the use case, so the use case doesn&#39;t concern itself with knowing what to do with the data anymore, rather just with providing the data. Also, in this case we&#39;re still not breaking the dependency rule, because the use case still doesn&#39;t know anything about the outer layer.</p></blockquote><p>The problem here is now whatever knows how to ask for the data has to also be the thing that accepts the data. Before the Controller could call the Usecase Interactor blissfully unaware of what the Response Model would look like, where it should go, and, heh, how to present it.</p><p>Again, please study <a href="https://martinfowler.com/bliki/CQRS.html" rel="noreferrer">Command Query Responsibility Segregation</a> to see why that&#39;s important.</p><blockquote><p>However, the use case doesn&#39;t control the moment when the actual presentation is performed anymore (which may be useful, for example to do additional stuff at that point, like logging, or to abort it altogether if necessary). Also, notice that we lost the Use Case Input Port, because now the controller is only using the getData() method (which is our new output port). Furthermore, it looks to me that we&#39;re breaking the &#34;tell, don&#39;t ask&#34; principle here, because we&#39;re asking the interactor for some data to do something with it, rather than telling it to do the actual thing in the first place.</p></blockquote><p>Yes! Telling, not asking, will help keep this object oriented rather than procedural.</p><blockquote><p>#To the point</p></blockquote><blockquote><p>So, is any of these two alternatives the &#34;correct&#34; interpretation of the Use Case Output Port according to the Clean Architecture? Are they both viable?</p></blockquote><p>Anything that works is viable. But I wouldn&#39;t say that the second option you presented faithfully follows Clean Architecture. It might be something that works. But it&#39;s not what Clean Architecture asks for.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../clean-architecture-may-the-controller-talk-to-the-presenter-directly/'>Clean Architecture: May the Controller talk to the Presenter directly</a></li><li class="list-group-item"><a href='../architecture-clean-architecture-calling-a-usecase-from-the-controller/'>Architecture &#8211; Clean Architecture: Calling a Usecase from the Controller</a></li><li class="list-group-item"><a href='../architecture-clean-architecture-is-the-input-boundary-necessary/'>Architecture &#8211; Clean Architecture: Is the Input Boundary necessary</a></li><li class="list-group-item"><a href='../php-clean-architecture-how-to-pass-request-data-towards-inner-domain-level-use-cases/'>Php &#8211; Clean Architecture &#8211; How to pass request data towards inner, domain level Use Cases</a></li><li class="list-group-item"><a href='../architecture-clean-architecture-use-case-spanning-multiple-ui-elements/'>Architecture &#8211; Clean Architecture: Use case spanning multiple UI elements</a></li><li class="list-group-item"><a href='../unit-testing-clean-architecture-use-case-testing/'>Unit-testing &#8211; Clean Architecture use case testing</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>