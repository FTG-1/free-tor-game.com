<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; Where is the line between unit testing application logic and distrusting language constructs &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067558 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067558" class="post-1067558 software type-software status-publish hentry category-software tag-tdd tag-testing tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; Where is the line between unit testing application logic and distrusting language constructs</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">tdd</span><span class="mr-2 badge badge-info">testing</span><span class="mr-2 badge badge-warning">unit testing</span></p><div class="entry-content"><p>Consider a function like this:</p><pre><code>function savePeople(dataStore, people) {
    people.forEach(person =&gt; dataStore.savePerson(person));
}
</code></pre><p>It might be used like this:</p><pre><code>myDataStore = new Store(&#39;some connection string&#39;, &#39;password&#39;);
myPeople = [&#39;Joe&#39;, &#39;Maggie&#39;, &#39;John&#39;];
savePeople(myDataStore, myPeople);
</code></pre><p>Let us <em>assume</em> that <code>Store</code> has its own unit tests, or is vendor-provided.  In any case, we trust <code>Store</code>.  And let us further assume that error handling &#8212; eg, of database disconnection errors &#8212; is not the responsibility of <code>savePeople</code>.  Indeed, let us assume that the <em>store itself</em> is magical database that cannot possibly error in any way. <em>Given</em> these assumptions, the question is:</p><p><strong>Should <code>savePeople()</code> be unit tested, or would such tests amount to testing the built-in <code>forEach</code> language construct?</strong></p><p>We could, of course, pass in a mock <code>dataStore</code> and assert that <code>dataStore.savePerson()</code> is called once for each person.  You could certainly make the argument that such a test provides security against implementation changes: eg, if we decided to replace <code>forEach</code> with a traditional <code>for</code> loop, or some other method of iteration.  So the test is not <em>entirely</em> trivial.  And yet it seems awfully close&#8230;</p><hr/><p>Here&#39;s another example that may be more fruitful.  Consider a function that does nothing but coordinate other objects or functions.  For example:</p><pre><code>function bakeCookies(dough, pan, oven) {
    panWithRawCookies = pan.add(dough);
    oven.addPan(panWithRawCookies);
    oven.bakeCookies();
    oven.removePan();
}
</code></pre><p>How should a function like this be unit tested, assuming you think it should?  It&#39;s hard for me to imagine any kind of unit test that doesn&#39;t simply mock <code>dough</code>, <code>pan</code>, and <code>oven</code>, and then assert that methods are called on them.  But such a test is doing nothing more than duplicating the exact implementation of the function.</p><p>Does this inability to test the function in a meaningful black box way indicate a design flaw with the function itself?  If so, how could it be improved?</p><hr/><p>To give even more clarity to the question motivating the <code>bakeCookies</code> example, I&#39;ll add a more realistic scenario, which is one I&#39;ve encountered when attempting to add tests to and refactor legacy code.</p><p>When a user creates a new account, a number of things need to happen: 1) a new user record needs to be created in the database  2) a welcome email needs to be sent 3) the user&#39;s IP address needs to be recorded for fraud purposes.</p><p>So we want to create a method that ties together all the &#34;new user&#34; steps:</p><pre><code>function createNewUser(validatedUserData, emailService, dataStore) {
  userId = dataStore.insertUserRecord(validateduserData);
  emailService.sendWelcomeEmail(validatedUserData);
  dataStore.recordIpAddress(userId, validatedUserData.ip);
}
</code></pre><p>Note that if any of these methods throws an error, we want the error to bubble up to the calling code, so that it can handle the error as it sees fit.  If it&#39;s being called by the API code, it may translate the error into an appropriate http response code.  If it&#39;s being called by a web interface, it may translate the error into an appropriate message to be displayed to the user, and so on.  The point is <em>this function</em> doesn&#39;t know how to handle the errors that may be thrown.</p><p>The essence of my confusion is that to unit test such a function it seems necessary to repeat the exact implementation in the test itself (by specifying that methods are called on mocks in a certain order) and that seems wrong.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><em>Should <code>savePeople()</code> be unit tested?</em> Yes. You aren&#39;t testing that <code>dataStore.savePerson</code> works, or that the db connection works, or even that the <code>foreach</code> works. You are testing that <code>savePeople</code> fulfills the promise it makes through its contract.</p><p>Imagine this scenario: someone does a big refactor of the code base, and accidentally removes the <code>forEach</code> part of the implementation so that it always only saves the first item. Wouldn&#39;t you want a unit test to catch that?</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-on-the-effectiveness-of-unit-testing/'>Java &#8211; On the effectiveness of unit testing</a></li><li class="list-group-item"><a href='../unit-testing-unit-testing-an-api-client-and-wrappers/'>Unit-testing &#8211; Unit testing an API client and wrappers</a></li><li class="list-group-item"><a href='../unit-testing-should-one-test-the-values-of-an-enum-using-unit-tests/'>Unit-testing &#8211; Should one test the values of an enum using unit tests</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>