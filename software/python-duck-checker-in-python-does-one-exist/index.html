<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python &#8211; Duck checker in Python: does one exist &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079982 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079982" class="post-1079982 software type-software status-publish hentry category-software tag-python tag-type-systems"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python &#8211; Duck checker in Python: does one exist</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">python</span><span class="mr-2 badge badge-info">type-systems</span></p><div class="entry-content"><p>Python uses duck-typing, rather than static type checking.  But many of the same concerns ultimately apply: does an object have the desired methods and attributes?  Do those attributes have valid, in-range values?</p><p>Whether you&#39;re writing constraints in code, or writing test cases, or validating user input, or just debugging, inevitably <em>somewhere</em> you&#39;ll need to verify that an object is still in a proper state&#8211;that it still &#34;looks like a duck&#34; and &#34;quacks like a duck.&#34;</p><p>In statically typed languages you can simply declare &#34;<code>int x</code>&#34;, and anytime you create or mutate <code>x</code>, it will always be a valid <code>int</code>. <strong>It seems feasible to decorate a Python object to ensure that it is valid under certain constraints, and that every time that object is mutated it is <em>still</em> valid under those constraints.</strong> Ideally there would be a simple declarative syntax to express &#34;hasattr length and length is non-negative&#34; (not in those words.  Not unlike Rails validators, but less human-language and more programming-language). You could think of this as ad-hoc interface/type system, or you could think of it as an ever-present object-level unit test.</p><p><strong>Does such a library exist to declare and validate constraint/duck-checking on Python-objects?</strong> Is this an unreasonable tool to want? ðŸ™‚</p><p>(Thanks!)</p><hr/><p>Contrived example:</p><pre><code>rectangle = {&#39;length&#39;: 5, &#39;width&#39;: 10}

# We live in a fictional universe where multiplication is super expensive.  
# Therefore any time we multiply, we need to cache the results.

def area(rect):
    if &#39;area&#39; in rect:
        return rect[&#39;area&#39;]
    rect[&#39;area&#39;] = rect[&#39;length&#39;] * rect[&#39;width&#39;]
    return rect[&#39;area&#39;]

print area(rectangle)
rectangle[&#39;length&#39;] = 15
print area(rectangle) # compare expected vs. actual output!

# imagine the same thing with object attributes rather than dictionary keys.
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Today, python offers a wide spectrum of tests than can be done for testing duck-type coding.</p><h1>Type Annotations</h1><h2>Implementations</h2><p>For starters, static, compile time type-checking ability was added to Python 3 in 2015.</p><p>Now, there are multiple third-party libraries that provide an implementations for the new type-checking hooks.</p><ol><li><a href="http://mypy.readthedocs.org/en/latest/" rel="nofollow" title="MyPy">MyPy</a> â€” data type-checking only (fulfills Python 3 type annotation capability)</li><li><a href="https://andreacensi.github.io/contracts/" rel="nofollow" title="PyContracts">PyContracts</a> â€” same Python 3 type  as in MyPy above, plus allows conjunctive value constraint(s), which is like what you are talking about.</li></ol><p>MyPy is pretty slick.</p><p>It even supports <a href="http://mypy.readthedocs.org/en/latest/function_overloading.html" rel="nofollow" title="overloaded">overloaded</a> function parameter constraints, so that a function can have different return value type if it takes different parameter value types, for instance, using @overload decorator.</p><h2>Examples</h2><p>If in your example above, &#39;length&#39; and &#39;width&#39; values were passed as discrete parameters, like:</p><pre class="lang-python prettyprint-override"><code>def area(length: &#39;int,&gt;0&#39;, width: &#39;int,&gt;0&#39;) -&gt; int:
    pass
</code></pre><p>then, PyContracts could easily do individual type/value checks.</p><p>PyContracts can work with the dictionary you specified too, as-is.</p><pre class="lang-python prettyprint-override"><code>def area(rect: &#39;dict(str: int)&#39;) -&gt; int:
    pass
</code></pre><hr/><h2>Problems with PyDBC</h2><p>Though it was slick for its time, nowadays, the drawbacks I see with <a href="http://www.nongnu.org/pydbc/" rel="nofollow">PyDBC</a> are:</p><ol><li>There is a slight performance hit to running these precondition/postcondition tests. They&#39;re dynamic, run time tests. Python 3 type annotations are done using static analysis.</li><li>Rewriting code at runtime, for one purpose, in a one-off way, that is scattered throughout your program, can be too brittle to be worth the bargain. Works fine with one use. What if some other technique/tool does that too? One can get into conflicts where the only way to get out of them is to drop one tool or another after depending upon it a long time. Cleaner ways to do this have evolved for Python since PyDBC was invented.</li><li>Explicit declarative constructs, like Python function decorators and Python 3 type annotations, are going to be instantly recognizable/understood by any programmer familiar with Python. They won&#39;t spot the implicitly invoked functions. Once they are told, they may forget, may copy or rename the primary function and forget the precondition/postcondition sidekicks. Automated tools are going to treat those extra 2 functions as independent, when they intent is that they are not.</li><li>The <strong>metaclass</strong> <em>attribute</em> feature of Python 2 no longer works in Python 3. It is ignored. Instead, metaclass= is specified in class declarations in Python 3. Nowadays, new projects start in Python 3 and Python 2 is legacy.</li><li>Python 3 has reworked the type system slightly going from early Python 2 to recent Python 3. A Python 2 metaclass-based solution may not work with Python 3 without rewriting/retesting it.</li><li>Metaclasses are not module-wide now, can only be specified per class, and there can only be one metaclass per class. So it is a preciously applied feature of a class.</li></ol><hr/><h1>Unit Testing</h1><p>To take things farther, into the realm of checking post-conditions, which is appropriate for testing in the fashion of TDD or BDD, one might be better off writing unit testsâ€”particularly if the desire is to test side effects.</p><h2>TDD unit tests with unittest</h2><p>Python comes with a unittest package that works fine for verifying external behavior effects of a class are correct.</p><p><a href="https://docs.python.org/3/library/unittest.html" rel="nofollow">https://docs.python.org/3/library/unittest.html</a></p><p>It&#39;s very handy to use. If you want to test all of your boundary cases (like dimensions&lt;=0), normal case, and any exceptions it supports in the future, it&#39;s the right place for it.</p><h2>BDD testing</h2><p>There are some third-party programming tools for BDD (behavior-driven design). Which ones are popular/supported will probably change over time.</p><p>In my opinion, BDD test scenarios tend to be easier to read/understand. They&#39;re readable, possibly even slightly extendable, by non-Python programmers. The step language is pretty simple.</p><h2>doctest comments/tool</h2><p>Alternatively, one could include executable examples in the area function&#39;s doc string and test it by running doctestâ€”a standard feature of Python for far more than a decade.</p><p><a href="https://en.wikipedia.org/wiki/Doctest" rel="nofollow">https://en.wikipedia.org/wiki/Doctest</a></p><p>By using doctest, tests would be part of the documentation, inline and generated, as both useful examples and convenient tests.</p><p>Those are appropriate ways to check that external state/logic of the function is working properly, given fully met preconditions. They tend to offer different side benefits as well.</p><hr/><h1>Decorators</h1><p>One can also use Python 3 decorators to declare preconditions and post conditions. The @precondition would be checked on entry. The @postcondition would be checked on exit.</p><p>This would allow you to enforce design by contract (DBC) with very little code at all.</p><p>To illustrate this listing 10, the @require decorator sample function, in this Dr. Dobb&#39;s magazine article, which shows how to implement a powerfully declarative, yet fully reusable, precondition-checking decorator in just 10 lines of regular Python code.</p><p><a href="http://www.drdobbs.com/web-development/python-24-decorators/184406073" rel="nofollow">http://www.drdobbs.com/web-development/python-24-decorators/184406073</a></p><p>You could write a post condition verification decorator based on this @require example, and name them @precondition and @postcondition.</p><p>Just be careful. The example uses eval, and there is no parameter sanity-checking or constraining, so someone might put something. Really awkward. Of course, that&#39;s a possibility other places as well, but I feel like I should raise awareness since eval/exec uses should always kept in mind as a concern.</p><hr/><p>Python 3 includes a library called <strong>functools</strong> that actually offers 2 capabilities handy for your problem.</p><p><a href="https://docs.python.org/3/library/functools.html" rel="nofollow">https://docs.python.org/3/library/functools.html</a></p><ol><li>It has a decorator that provides a LRU (least recently used) cache for memoization of a decorated function&#39;s return values: @functools.lru_cache</li><li>It eases writing decorator functions.</li></ol><p>On the 1st point, that strikes your need to test the memoization feature; supplied, pretested functionality. Memoization is a very handy efficiency tool. In addition to reusing existing code, using lru_cache decorator is going to make your area function much more transparent.</p><p>Anyone would be able to see that there is memoization (results caching) going on, without needing to read all of its source code, just by seeing the lru_cache decorator. They would know it&#39;s tested code too, not some embedded, one-off logic.</p><p>For the second, if you needed something more robust, complex, or implementation specific than the Dr. Dobb&#39;s example, functools may speed your efforts.</p><p>Particularly, you should look at the <strong>@functools.wraps</strong> decorator. It not only saves a couple of lines of code, but makes the metadata more intuitively correct an useful.</p><hr/><h1>Error-Proofing</h1><p>The following suggestions made above will make the example correct, less error-prone as-is not to mention if modified, easier to read/understand its usage and behavior, well-tested.</p><ul><li>Removing the area result-caching from the rect: dict parameter gets rid of calculation/state error. Replacing it with the standard library&#39;s @functools.lru_cache decorator has none of the drawbacks and virtually all of the benefits. The performance savings is still there. A function should do one thing, and do it well. Callers could store the value returned by the lru_cache memoized area function in an object if desired. In fact, an object could store it in an instance variable. It could even do so in a property read by a getter, fulfilling the DRY (don&#39;t repeat yourself) principle. So nothing good is being lost or precluded by extracting the memoization, making it an extrinsic quality. Separation of concerns is key to designing good, reusable, reliable, testable functions.</li><li>For generic handling, like record-processing, a dict (or tuple/obj) makes sense. For something like this, explicit/discrete parameters are more easily understood/tested because they&#39;re self-documenting. The new type annotation syntax is simple &amp; efficient for authors to read/change anytime, and  tools to verify when developers feel like it.</li><li>Docstring with doctest compatible examples and unittest test cases will make sure the function works, and stays working.</li><li>Writing @precondition and @postcondition decorators is easy to do and can make the code more readable.</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../python-forgiveness-vs-permission-and-duck-typing/'>Python Forgiveness vs. Permission and Duck Typing</a></li><li class="list-group-item"><a href='../python-duck-typing-data-validation-and-assertive-programming-in-python/'>Python &#8211; Duck typing, data validation and assertive programming in Python</a></li><li class="list-group-item"><a href='../python-how-should-you-cleanly-restrict-object-property-types-and-values-in-python/'>Python &#8211; How should you cleanly restrict object property types and values in Python</a></li><li class="list-group-item"><a href='../python-does-this-code-follow-duck-typing/'>Python &#8211; Does this code follow duck typing</a></li><li class="list-group-item"><a href='../type-inference-with-duck-typing-does-this-work-why-is-it-not-used/'>Type inference with duck typing &#8211; does this work? Why is it not used</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>