<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>An elegant way to detect the end of an asynchronous recursive file search &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085567 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085567" class="post-1085567 software type-software status-publish hentry category-software tag-asynchronous-programming tag-file-handling tag-node-js tag-recursion tag-search"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">An elegant way to detect the end of an asynchronous recursive file search</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asynchronous-programming</span><span class="mr-2 badge badge-info">file handling</span><span class="mr-2 badge badge-warning">node.js</span><span class="mr-2 badge badge-primary">recursion</span><span class="mr-2 badge badge-danger">search</span></p><div class="entry-content"><p>Given a recursive subroutine in single threaded environment which starts numerous asynchronous I/O operations and registers callback functions for each of them. This callbacks will be called on the completion of the operations.</p><p>Which ways are recommended to detect when all of the I/O operations are finished, in other words all of the callback have been called.</p><p>Since the code runs on a single thread, the most primitive solution would be to initialize a counter variable to 0, and increment this counter before every I/O operations and decrement it at tail of the callback functions. One can use events or actions (like in elm), however that solution would be very similar.</p><p>One possible optimization: if multiple I/O operation chained together (So one and only one I/O operation is started  in the other I/O operations callback function), than it would be suffice to increment the counter at the beginning of the chain and decrement at the end of the chain, However one should aware the case when multiple I/O operation is started in one callback function, then all branch should be handled as a different chain.</p><p>Are there any more elegant way to handle this?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Recursive file search is akin to <a href="https://en.wikipedia.org/wiki/Tree_traversal" rel="nofollow noreferrer">walking a tree structure</a>. You can go depth-first or breadth-first, you know you have traversed the entire tree when the stack/queue you are using for pending items is empty. BUT With async APIs, like that of nodejs, recursion is a bit tricky than simply calling the function again.</p><p>I&#39;m going to give a rough idea:</p><ol><li><p>Define a stack for directories that are to be searched, add starting/root directory to it.</p></li><li><p>Define a function that takes a directory path and returns a readable Stream. This stream emits each found child directory/file, complete with stats.</p></li><li><p>Take/pop a directory from #1 and convert it into stream using #2.</p></li><li><p>On stream from #3, subscribe to <code>data</code> events and if a directory, add/push it to #1. Also send the data to whatever is consuming the search results.</p></li><li><p>On stream from #3, subscribe to <code>end</code> event and goto #3.</p></li><li><p>When you goto #3 and find there is nothing more to pop from #1, the search is completed.</p></li></ol><p>In essence, each pass waits for listing and stating files of 1 directory, before the next pass.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-deal-with-asynchronous-functions-when-you-really-just-want-things-synchronized/'>How to deal with asynchronous functions when you really just want things synchronized</a></li><li class="list-group-item"><a href='../javascript-what-determines-which-javascript-functions-are-blocking-vs-non-blocking/'>Javascript &#8211; What determines which Javascript functions are blocking vs non-blocking</a></li><li class="list-group-item"><a href='../dealing-with-the-node-js-callback-pyramid/'>Dealing with the node.js callback pyramid</a></li><li class="list-group-item"><a href='../php-design-pattern-a-single-class-with-multiple-purposes-or-multiple-extended-classes-each-with-their-own-purpose-in-php/'>Php &#8211; Design Pattern: A single class with multiple purposes, or multiple extended classes each with their own purpose in PHP</a></li><li class="list-group-item"><a href='../java-elegant-way-to-count-the-number-of-files-in-zip-archive/'>Java &#8211; Elegant way to count the number of files in Zip archive</a></li><li class="list-group-item"><a href='../node-js-and-cpu-intensive-web-applications/'>Node.js and CPU intensive web applications</a></li><li class="list-group-item"><a href='../is-there-really-a-fundamental-difference-between-callbacks-and-promises/'>Is there really a fundamental difference between callbacks and Promises</a></li><li class="list-group-item"><a href='../why-do-many-languages-semantically-distinguish-async-functions-from-non-async-ones/'>Why do many languages semantically distinguish &#8220;async&#8221; functions from &#8220;non-async&#8221; ones</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>