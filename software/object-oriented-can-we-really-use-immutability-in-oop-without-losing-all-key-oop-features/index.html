<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Object-oriented &#8211; Can we really use immutability in OOP without losing all key OOP features &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078288 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078288" class="post-1078288 software type-software status-publish hentry category-software tag-functional-programming tag-immutability tag-object-oriented"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Object-oriented &#8211; Can we really use immutability in OOP without losing all key OOP features</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">functional programming</span><span class="mr-2 badge badge-info">immutability</span><span class="mr-2 badge badge-warning">object-oriented</span></p><div class="entry-content"><p>I see the benefits of making objects in my program immutable. When I am really deeply thinking about a good design for my application I often naturally arrive at many of my objects being immutable. It often comes to the point where I would like to have <strong>all</strong> my objects immutable.</p><p><a href="https://softwareengineering.stackexchange.com/questions/232711/complete-immutability-and-object-oriented-programming">This question</a> deals with the same idea but no answer suggests what is a good approach to immutability and when to actually use it. Are there some good immutable design patterns? The general idea seems to be &#34;make objects immutable unless you absolutely need them to change&#34; which is useless in practice.</p><p>My experience is that immutability drives my code more and more to the functional paradigm and this progression always happens:</p><ol><li>I start needing persistent (in the functional sense) data structures like lists, maps etc.</li><li>It is extremely inconvenient to work with cross references (e.g. tree node referencing its children while children referencing their parents) which makes me not use cross references at all, which again makes my data structures and code more functional.</li><li>Inheritance stops to make any sense and I start to use composition instead.</li><li>The whole basic ideas of OOP like encapsulation start to fall apart and my objects start to look like functions.</li></ol><p>At this point I am practically using nothing from the OOP paradigm anymore and can just switch to a purely functional language. Thus my question: is there a consistent approach to good immutable OOP design or is it always the case that when you take the immutable idea to its fullest potential, you always end up programming in a functional language not needing anything from the OOP world anymore? Are there any good guidelines to decide which classes should be immutable and which should remain mutable to ensure that OOP does not fall apart?</p><p>Just for convenience, I will provide an example. Let&#39;s have a <code>ChessBoard</code> as an immutable collection of immutable chess pieces (extending abstract class <code>Piece</code>). From the OOP point of view, a piece is responsible for generating valid moves from its position on the board. But to generate the moves the piece needs a reference to its board while board needs to have reference to its pieces. Well, there are some tricks to create these immutable cross-references depending on your OOP language but they are pain to manage, better not have a piece to reference its board. But then the piece cannot generate its moves since it does no know the state of the board. Then the piece becomes just a data structure holding the piece type and its position. You can then use a polymorphic function to generate moves for all kinds of pieces. This is perfectly achievable in functional programming but almost impossible in OOP without runtime type checks and other bad OOP practices&#8230; Then, a move is just a function which makes a new board from an old board, again a functional idea having perfect sense but having nothing to do with OOP anymore.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Can we really use immutability in OOP without losing all key OOP features?</p></blockquote><p>Don&#39;t see why not. Been doing it for years before Java 8 got all functional anyway. Ever heard of Strings? Nice and immutable since the start.</p><blockquote><ol><li>I start needing persistent (in the functional sense) data structures like lists, maps etc.</li></ol></blockquote><p>Been needing those all along as well. Invalidating my iterators because you mutated the collection while I was reading it is just rude.</p><blockquote><ol start="2"><li>It is extremely inconvenient to work with cross references (e.g. tree node referencing its children while children referencing their parents) which makes me not use cross references at all, which again makes my data structures and code more functional.</li></ol></blockquote><p>Circular references are a special kind of hell. Immutability wont save you from it.</p><blockquote><ol start="3"><li>Inheritance stops to make any sense and I start to use composition instead.</li></ol></blockquote><p>Well here I&#39;m with you but don&#39;t see what it has to do with immutability. The reason I like composition isn&#39;t because I love the dynamic strategy pattern, it&#39;s because it lets me change my level of abstraction.</p><blockquote><ol start="4"><li>The whole basic ideas of OOP like encapsulation start to fall apart and my objects start to look like functions.</li></ol></blockquote><p>I shudder to think what your idea of &#34;OOP like encapsulation&#34; is.  If it involves getters and setters then just please stop calling that encapsulation because it&#39;s not. It never was. It&#39;s manual Aspect Oriented Programming. A chance to validate and a place to put a breakpoint is nice but it&#39;s not encapsulation. Encapsulation is preserving my right to not know or care what&#39;s going on inside.</p><p>Your objects are supposed to look like functions.  They&#39;re bags of functions. They&#39;re bags of functions that move together and redefine themselves together.</p><p>Functional programming is en vogue at the moment and people are shedding some misconceptions about OOP. Don&#39;t let that confuse you into believing this is the end of OOP. Functional and OOP can live together quite nicely.</p><ul><li><p>Functional programming is being formal about assignments.</p></li><li><p>OOP is being formal about function pointers.</p></li></ul><p>Really that it. Dykstra told us <code>goto</code> was harmful so we got formal about it and created structured programming. Just like that, these two paradigms are about finding ways to get things done while avoiding the pitfalls that come from doing these troublesome things casually.</p><p>Let me show you something:</p><p>f<sub>n</sub>(x)</p><p>That is a function. It&#39;s actually a continuum of functions:</p><p>f<sub>1</sub>(x)<br/> f<sub>2</sub>(x)<br/> ...<br/> f<sub>n</sub>(x)</p><p>Guess how we express that in OOP languages?</p><p><code>n.f(x)</code></p><p>That little <code>n</code> there chooses what implementation of <code>f</code> is used AND it decides what some of the constants used in that function are (which frankly means the same thing). For example:</p><p>f<sub>1</sub>(x) = x + 1<br/> f<sub>2</sub>(x) = x + 2</p><p>That is the same thing closures provide. Where closures refer to their enclosing scope, object methods refer to their instance state. Objects can do closures one better. A closure is a single function returned from another function. A constructor returns a reference to a whole bag of functions:</p><p>g<sub>1</sub>(x) = x<sup>2</sup> + 1<br/> g<sub>2</sub>(x) = x<sup>2</sup> + 2</p><p>Yep you guessed it:</p><p><code>n.g(x)</code></p><p>f and g are functions that change together and move around together. So we stick them in the same bag. This is what an object really is. Holding <code>n</code> constant (immutable) just means it&#39;s easier to predict what these will do when you call them.</p><p>Now that&#39;s just the structure. The way I think about OOP is a bunch of little things that talk to other little things.  Hopefully to a small select group of little things. When I code I imagine myself AS the object. I look at things from the point of view of the object. And I try to be lazy so I don&#39;t over work the object. I take in simple messages, work on them a little, and send out simple messages to only my best friends. When I&#39;m done with that object I hop into another one and look at things from it&#39;s perspective.</p><p>Class Responsibility Cards were the first to teach me to think that way. Man I was confused about them back then but damn if they aren&#39;t still relevant today.</p><blockquote><p>Let&#39;s have a ChessBoard as an immutable collection of immutable chess pieces (extending abstract class Piece). From the OOP point of view, a piece is responsible for generating valid moves from its position on the board. But to generate the moves the piece needs a reference to its board while board needs to have reference to its pieces.</p></blockquote><p>Arg! Again with the needless circular references.</p><p>How about: A <code>ChessBoardDataStructure</code> turns x y cords into piece references. Those pieces have a method that takes x, y and a particular <code>ChessBoardDataStructure</code> and turns it into a collection of brand spanking new <code>ChessBoardDataStructure</code>s. Then shoves that into something that can pick the best move. Now <code>ChessBoardDataStructure</code> can be immutable and so can the pieces. In this way you only ever have one white pawn in memory. There are just several references to it in just the right x y locations. Object oriented, functional, and immutable.</p><p>Wait, <a href="https://softwareengineering.stackexchange.com/a/349366/131624">didn&#39;t we talk about chess already?</a></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../what-are-the-consequences-of-immutable-classes-with-references-to-mutable-classes/'>What are the consequences of immutable classes with references to mutable classes</a></li><li class="list-group-item"><a href='../object-oriented-what-functional-features-are-worth-a-little-oop-confusion-for-the-benefits-they-bring/'>Object-oriented &#8211; What Functional features are worth a little OOP confusion for the benefits they bring</a></li><li class="list-group-item"><a href='../object-oriented-complete-immutability-and-object-oriented-programming/'>Object-oriented &#8211; Complete immutability and Object Oriented Programming</a></li><li class="list-group-item"><a href='../java-whats-the-proper-way-to-model-this-real-world-activity-that-seems-to-need-circular-references-in-oop/'>Java &#8211; What&#8217;s the proper way to model this real-world activity that seems to need circular references in OOP</a></li><li class="list-group-item"><a href='../java-clean-oop-way-of-mapping-an-object-to-its-presenter/'>Java &#8211; Clean OOP way of mapping an object to its presenter</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>