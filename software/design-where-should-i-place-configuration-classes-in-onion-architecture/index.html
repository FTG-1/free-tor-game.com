<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; Where should I place configuration classes in Onion Architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078388 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078388" class="post-1078388 software type-software status-publish hentry category-software tag-design tag-onion-architecture"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; Where should I place configuration classes in Onion Architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">onion-architecture</span></p><div class="entry-content"><p>We are redesigning one of our API projects from an n-layered architecture into onion architecture. In the previous design, we had configuration classes in a common library project being referenced across all the layers (UI, Logic and Data Access layers). How should these configuration classes be fit into an onion architecture?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>My guiding principle here is to ask what I consider the most important design question:</p><p>What knows about what?</p><p><a href="https://i.stack.imgur.com/SnQOt.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/SnQOt.png" alt="enter image description here"/></a></p><p>Here&#39;s an onion diagram.</p><p>It&#39;s not that much different from this:</p><p><a href="https://i.stack.imgur.com/hmmjU.jpg" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/hmmjU.jpg" alt="enter image description here"/></a></p><p>But this one shows the flow of control in and out of layers. Note the purple arrow in the lower right corner. That&#39;s important here because the flow of control dictates the order of construction if your objects are immutable.</p><p>The <code>Controller</code> can call the <code>Use Case Interactor</code> which can call the <code>Presenter</code>. To do that they need references to what they call. That&#39;s what they know. Those references only exist once those objects have been constructed. So what must be constructed first? The last object in the flow of control.</p><p>This dictates that construction of an onion of immutable objects must start and end with the outside layer. But what if your flow of control is... interesting?</p><p><a href="https://i.stack.imgur.com/qKcMP.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/qKcMP.png" alt="enter image description here"/></a></p><p>Here we see control dive into the middle, come out the other side, only to dive back in. Do we have to construct everything here step by step following the flow backwards?</p><p>No, You can fold that flow until it only dives in and comes out once. You don&#39;t have to follow every possible flow of control. Just ensure that EVERYTHING that needs it&#39;s reference passed down to the lower layer has been constructed as you descend and EVERYTHING that needs it&#39;s reference passed up the the higher layer as you ascend has been constructed.</p><p>If we diagram the construction so it can be visualized with the flow of control it might look like this:</p><p><a href="https://i.stack.imgur.com/Cxoyk.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/Cxoyk.png" alt="enter image description here"/></a></p><p>I&#39;ve separated the layers based on the order in which persistent immutable objects can be built due to their dependencies. Once built that horizontal line dividing the layers in two is no longer needed. But if you want immutable objects then this is required so that everything gets the references they need so they can talk.</p><p>That does put a design restriction on your immutable objects. But this pattern works well with <a href="https://martinfowler.com/bliki/CQRS.html" rel="nofollow noreferrer">Command Query Responsibility Segregation</a>.</p><p>Of course none of this dictates what you do with your transitive objects that pop in and out of existence as your program runs. Also, mutable objects are allowed to learn and retain references to objects that were created after them. That&#39;s how events work in the observer pattern. No, this is only about having the ability to construct a persistent (lives throughout the run time of the program), immutable (unchanging), object graph that can communicate from end to end yet still follow the dependency inversion principle so inner layers won&#39;t need to change just because the outer layers did.</p><p>Now you can do all of this as a pile of procedural code in main. Or you can break it up a little using every tool in your language. That&#39;s a good idea because the point of these layers is that they can be pealed off and replaced without touching the other layers. It&#39;s nice if the constructing code can do something similar.</p><p>You can even use some DI library that will force you to <a href="http://www.netobjectives.net/files/books/esad/essential-skills-separate-use-from-construction.pdf" rel="nofollow noreferrer">separate construction from behavior code</a> by making you write it in another language. You just don&#39;t have to.</p><p>If you&#39;ll forgive some psudo code, my basic DI pattern is this:</p><pre><code>void main() {
            
    InterfaceAdapterOutputs iao = makeDescendingFrameworksAndDrivers();
    ApplicationBROutputs abro = makeDescendingInterfaceAdapters(iao);
    EnterpriseBROutputs ebro = makeDescendingApplicationBR(abro);
    EnterpriseBRInputs ebri = makeEnterpriseBR(ebro);
    ApplicationBRInputs abri = makeAscendingApplicationBR(ebri);
    InterfaceAdapterInputs iai = makeAscendingInterfaceAdapters(abri);
    FrameworksAndDriverInputs fadi = makeAscendingFrameworksAndDrivers(iai);

    fadi.start();
}
</code></pre><p>Now sure that&#39;s way too abstract but that&#39;s the pattern. Normally I&#39;d have this broken up as more than just layers but also feature segments (kinda like my icon). But this should make you feel like your own language has the power to make all this work without any special magic needing to be added.</p><p>I only mention all this because these needs may limit where you can reasonably put your creational code. The better you understand these needs the more flexibility you find in meeting them.</p><p>So where do you put your configuration classes? Again, ask &#34;What knows about what?&#34;</p><p>The Entities have business rule classes, input and output interfaces that change together within the layer. The use cases know about that layer, and must change according to it&#39;s whims. And so must the business rules <strong>configuration classes</strong> (and tests, and logging, and ...). There are actually many things that slave to the inner layer but don&#39;t care about the rest of your application. This means grouping them together so they could be easily separated from the rest of the system is likely a good idea. The same can be said for each layer.</p><p>There are also configuration classes that know about multiple layers. Those should be grouped with the most outside layer that they know about. But other than these you could organize your configuration code into onion layers much the same as the rest of your code. Just don&#39;t group <code>Use Case</code> code with <code>Entity</code> construction code. While the dependency relationship is the same that&#39;s very different code. It should be separated.</p><p><a href="https://i.stack.imgur.com/Iylau.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/Iylau.png" alt="enter image description here"/></a></p><p>However, I am NOT a fan of organizing exclusively by layer. As I said, my code base would diagram more like my icon, with feature sections. This is the <a href="https://www.google.com/search?q=package+by+feature+vs+package+by+layer&amp;rlz=1C1CHBF_enUS752US752&amp;oq=package+by+feature+vs&amp;aqs=chrome.0.0j69i57j0.8935j0j7&amp;sourceid=chrome&amp;ie=UTF-8" rel="nofollow noreferrer">package by feature not by layer principle</a>. But within my features things are separated by layer.
So for me, any one onion diagram could be one feature.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/architecture-how-to-structure-a-domain-driven-design-in-an-onion-architecture/'>Architecture &#8211; How to structure a Domain Driven Design in an Onion Architecture</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-onion-architecture-layer-placement-of-business-logic/'>C# &#8211; Onion architecture: layer placement of business logic</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/avoiding-repository-pattern-implementing-onion-architecture-with-dbcontext-only/'>Avoiding Repository pattern &#8211; implementing Onion Architecture with DbContext only</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>