<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to prevent dependency injection from killing object oriented programming &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073743 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073743" class="post-1073743 software type-software status-publish hentry category-software tag-dependency-injection tag-object-oriented-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to prevent dependency injection from killing object oriented programming</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">dependency-injection</span><span class="mr-2 badge badge-info">object-oriented-design</span></p><div class="entry-content"><p>Recently lots of people adopted DI in their projects (I am working with aspnet core). The problem I have is that DI turns my code towards procedural paradigm. For example in OOP way I would do:</p><pre><code>class Something
{
    Something(Other object, Dependency dep); // created manually or by factory obj

    DoStuff();
}
</code></pre><p>However with DI I cannot create Something class directly, because I need to satisfy dependencies. Now my code generally looks like that:</p><pre><code>class Something
{
    Something(Dependency dep); // resolved from di container

    DoStuff(Object obj); // executed manually
}
</code></pre><p>As a result my objects have no methods, they are just bags of properties that are processed by different services. On the other hand I would have to create giant objects with lots of dependencies just to execute simple task, that needs 1% of created object graph.</p><p>How to fix my design?<br /> This approach has obvious downsides, for instance I cannot pass Something class around, because it needs Object to DoStuff, so I have to pack it into some other class. There are many other problems, like functionality scattered across many files, difficulties in implementing security (because you can request &#34;inner&#34; service from DI) or encapsulation (Object must have all properties public because they are manipulated by external class.</p><hr/><p>Edit:<br /> Small example for better illustration:</p><p>Api I would write before DI:</p><pre><code>class ShoppingCartFactory {
    ShoppingCart Create(id);
}

// encapsulates cart logic
class ShoppingCart {
    // internal dependencies passed to cart from factory
    ShoppingCart(DeliveryLoader, ItemMetadataLaoder);


    // methods encapsulation functionality
    Modify(item, quantity);
    Save();
    Empty();
    GetDeliveryOptions(); // loads possible transports from db
    LoadItemMetadata(); // loads prices, availability etc. for items

    // public properties
    ImmutableList&lt;CartItem&gt; items; // immutable list of items
    Delivery selectedDelivery; // transport selected by client
}
</code></pre><p>When client clicks shopping cart delivery options are displayed only once, and subsequent requests do not need them. Therefore with this approach I have to create ShoppingCartDeliveryCreator dependency for each request.</p><p>So instead I have to write something like that:</p><pre><code>// instead of having properties on cart Object now I have 3 separate classes
// in previous example user of api had no idea how cart works inside
// now he needs to find all classes associated with cart
// also service class needs to take id in each method
// or needs some method like `Contextualize(id)`
class ShoppingCartService {
    // executes logic on db
    ShoppingCart Read(id);
    ShoppingCart Modify(id, item, quenatity);
    ShoppingCart Empty(id);
    ShoppingCart Save(id, shoppingCart);
}
class ShoppingCartDeliveryCreator (...)
class ShoppingCartItemMetadataLoader (...)

// no logic
class ShoppingCart {
    List&lt;CartItem&gt; items; // cannot be immutable, because Service needs to manipulate it
    Delivery selectedDelivery; // same
}
</code></pre><p>You cannot do anything with ShoppingCart class, You always need one of the services. Also as Derek Elkins pointed out</p><blockquote><p>One of the consequences of systematically using Dependency Injection is that your class hierarchy becomes completely flat.</p></blockquote><p>I am not sure if this is good thing. I made lots of research and experiments, however I am not convinced to this style of programming. To get any idea of how something works You need to examine all that code, guess what it is doing and then you may have thin idea how it works. With old example you could just look on the class and You would see all the options, or You could check all classes that take ShoppingCart.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>As Doc Brown mentioned, using Dependency Injection containers is not Dependency Injection.  Dependency Injection is just parameterization, and Dependency Injection containers are just meant to &#34;simplify&#34; <em>wiring up</em> dependencies. Your issue seems to be mostly driven by (perceived) limitations of whatever DI container framework you&#39;re using.</p><p>I don&#39;t understand how your objects being &#34;bags of properties&#34; is a &#34;result&#34; of dependency injection.  Some objects <em>are</em> going to just be &#34;bags of properties&#34; and thus will have no dependencies.  These are often called &#34;POJO/POCO&#34; objects for &#34;Plain Old Java/C# Objects&#34;.  Obviously, this can&#39;t be <em>all</em> your objects as nothing would need dependencies then.</p><p>You also mention &#34;giant objects with lots of dependencies&#34; that &#34;needs [only] 1% of [the] created object graph&#34;.  This is somewhat contradictory. If it only needs 1% of the &#34;created object graph&#34;, why is it depending on that remaining 99%?  If your dependencies need dependencies for things other than what you need of the dependencies, this suggests that your dependencies aren&#39;t well-factored.  In OOD terms, a violation of the Single Responsibility Principle.  One of the consequences of systematically using Dependency Injection is that your class hierarchy becomes completely flat.  Any &#34;hierarchy&#34; that is needed arises from how things are wired together (which no longer needs to be strictly hierarchical). Each of your classes should depend on only what it needs via relatively narrow interfaces.  If each class provides only one &#34;service&#34;, then dependencies will never instantiate more of the object graph than they need. There are plenty of good reasons for class to provide multiple &#34;services&#34;, and this can lead to dependencies that are extraneous to some downstream consumer of the &#34;service&#34;, but this will be very obvious and presumably done for some explicit reason. If not, factor the class into multiple classes that each provide only one of the &#34;services&#34;. (The &#34;services&#34; usually correspond pretty closely to the interfaces a class implements. So if you have a class that implements multiple interfaces, this is an indication that the class is providing multiple &#34;services&#34;.)</p><p>At any rate, for the limited example of code you provided, there&#39;s a pretty clear solution. Firstly, it&#39;s quite possible that whatever DI container framework you&#39;re using explicitly provides for this, but let&#39;s assume not. What do consumers of <code>Something</code> actually need? The need something that will give them <code>Something</code>s when given <code>Other</code>s. (Or to be more precise, something that will give them an instances of an interface representing whatever &#34;services&#34; <code>Something</code>s provide. They shouldn&#39;t care if they actually are <code>Something</code>s.). That is, they need a <code>SomethingFactory</code>.  So classes that need <code>Something</code>s should depend on <code>SomethingFactory</code> and then use that to create <code>Something</code>s. In code:</p><pre><code>class Something : ISomething {
    public Something(Other object, Dependencies dependencies) {...}
    // ...
}

interface ISomethingFactory {
    ISomething CreateSomething(Other object);
}

class SomethingFactory : ISomethingFactory {
    private readonly Dependencies _dependencies;
    public SomethingFactory(Dependencies dependencies) {
        _dependencies = dependencies;
    }
    public ISomething CreateSomething(Other object) {
        return new Something(object, _dependencies);
    }
}

class SomethingConsumer {
    public SomethingConsumer(ISomethingFactory somethingFactory) {...}
}
</code></pre><p>This approach gives you almost exactly the same experience as directly writing <code>new Something(object)</code> plus not having to worry about extraneous dependencies.  There is no reason from what you&#39;ve described (or generally) why Dependency Injection would lead to you needing to make all properties public or use a &#34;procedural style&#34; or anything like that.  You could take any OO program written &#34;naturally&#34; and mechanically convert it to one using dependency injection.  Simply go through what you would &#34;naturally&#34; write in &#34;OO&#34; style, and replace any uses of <code>new</code> with either passed in dependencies or factories as I&#39;ve illustrated above.  Other than having to pass around some extra parameters, the structure of the code will be practically identical to what it was before. If you feel you need to make much more extensive changes than this, you are misunderstanding something. (This may <em>suggest</em> more extensive changes, but they should not be necessary.)</p><p>As a note, the fact that you are using any particular DI container should <em>not</em> be evident from the vast majority of your code.  You should <em>not</em> be passing around the DI container and instantiating objects with it willy-nilly. The DI container should only be used (if used at all) to simplify the <em>top-level</em> code that wires everything together. I&#39;m not sure what you mean by &#34;you can request &#39;inner&#39; service from DI&#34;, but it sounds like you&#39;re doing something like this.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../dependency-injection-dependency-chain-pattern/'>Dependency Injection &#8211; Dependency Chain Pattern</a></li><li class="list-group-item"><a href='../java-dependency-injection-should-i-use-a-framework/'>Java &#8211; Dependency injection: should I use a framework</a></li><li class="list-group-item"><a href='../design-concerns-about-constructor-dependency-injection-logic/'>Design &#8211; concerns about constructor dependency injection logic</a></li><li class="list-group-item"><a href='../handling-disposables-with-dependency-injection/'>Handling disposables with dependency injection</a></li><li class="list-group-item"><a href='../unit-testing-how-far-should-i-go-with-dependency-injection-and-mocking/'>Unit-testing &#8211; How far should I go with dependency injection and mocking</a></li><li class="list-group-item"><a href='../how-to-use-dependency-injection-and-avoid-temporal-coupling/'>How to use dependency injection and avoid temporal coupling</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>