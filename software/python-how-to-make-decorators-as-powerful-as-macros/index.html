<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python &#8211; How to make decorators as powerful as macros &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080149 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080149" class="post-1080149 software type-software status-publish hentry category-software tag-language-design tag-lisp tag-pattern-matching tag-python"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python &#8211; How to make decorators as powerful as macros</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">language-design</span><span class="mr-2 badge badge-info">lisp</span><span class="mr-2 badge badge-warning">pattern matching</span><span class="mr-2 badge badge-primary">python</span></p><div class="entry-content"><p>Quick background: I am designing a Pythonic language that I want to be as powerful as Lisp while remaining easy to use. And by &#34;powerful&#34;, I mean &#34;flexible and expressive&#34;.</p><p>I&#39;ve just been introduced to Python function decorators, and I like them. I found <a href="https://softwareengineering.stackexchange.com/questions/213858/python-decorators-and-lisp-macros">this question</a> that suggests decorators are <em>not</em> as powerful as Lisp macros. The third answer to <a href="http://forums.udacity.com/questions/5007147/is-it-true-that-python-decorators-are-similar-to-lisp-macros" rel="noreferrer">this question</a> says that the reason they&#39;re not is because they can only operate on functions.</p><p>But what if you could use decorators on arbitrary expressions? (In my language, expressions are first-class, just like functions and everything else, so doing that would be fairly natural.) Would that make decorators as powerful as Lisp macros? Or would I have to use syntax rules, like <a href="http://docs.racket-lang.org/guide/pattern-macros.html" rel="noreferrer">Racket</a> and <a href="http://www.cs.utah.edu/~rafkind/papers/honu-2012.pdf" rel="noreferrer">Honu</a>, or some other technique?</p><p><strong>EDIT</strong></p><p>I was asked to provide an example of the syntactic construct. For an &#34;expression decorator&#34;, it would simply be a decorator on an expression (where &#34;$(&#8230;)&#34; creates an expression object):</p><pre><code>@Decorator(&#34;Params&#34;)
$(if (true):
    printf(&#34;Was true&#34;)
else:
    printf(&#34;Wasn&#39;t true&#34;))
</code></pre><p>Also, if I <em>do</em> need to use syntax rules, as mentioned above, it would use a pattern matching syntax:</p><pre><code># Match a bool expression, a comma, and a string.
macro assert(expr:bool lit string) { e , s }:
    if (!e):
        error s
    else:
        printf(&#34;All good&#34;)
</code></pre><p>The above would match this:</p><pre><code>assert i == 0, &#34;i should have been 0&#34;
</code></pre><p>That&#39;s a rough sketch, but it should give you an idea.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Short answer: You can&#39;t.</p><p>Not in Python or anything close to what it is today, at any rate. The reason is straightforward: Functions are objects. Expressions are not. Expressions describe activities--the activity of operating on objects and producing a result. While the input and output of expressions are objects, the expressions themselves are not. Because they are not objects, they cannot be decorated.</p><p>This limitation on Python metaprogramming is pretty baked into the language. It&#39;s not impossible to change Python semantics. Modules like <a href="https://github.com/clarete/forbiddenfruit" rel="nofollow noreferrer">forbiddenfruit</a> let you monkeypatch built in objects in ways that are officially &#34;impossible.&#34; Modules like <a href="https://pypi.python.org/pypi/MacroPy" rel="nofollow noreferrer">MacroPy</a>, <a href="https://pypi.python.org/pypi/karnickel" rel="nofollow noreferrer">karnickel</a>, and the now apparently defunct <a href="https://code.google.com/p/metapython/" rel="nofollow noreferrer">MetaPython</a> do provide some macro facilities through AST rewriting and related techniques. None of these is certified for production use, however, and most of them pop up, support one or two language iterations, and then evaporate. The double-back-flip-with-twist moves necessary to make them ever work at all just are not sustainable over any period of time, in any generality, or in the context of &#34;code you can depend on.&#34;</p><p>There are modules that successfully use introspection and reflection to inspect what is currently happening in a program. My <a href="https://pypi.python.org/pypi/say" rel="nofollow noreferrer">say</a> module, for example, works well across many Python 2 and Python 3 versions, and even alternate Python implementations like PyPy. But few Python meta-modules can actually change program semantics. <a href="https://www.python.org/~guido/" rel="nofollow noreferrer">GvR</a> has been pretty resistant to metaprogramming facilities. The <code>with</code> statement semantics, for example, were constrained for the particular purpose of limiting how much metaprogramming it can support.</p><p>But, that&#39;s Python as it exists today. You might imagine your Python++ language having arbitrary code blocks (the mythical multi-line lambda, often mentioned but never actually seen in Python) that can be decorated. Lambdas are objects, and code blocks are very object-ify-able. You probably would not want the overhead of making <em>every</em> expression into an object, but it&#39;s not hard to imagine an environment in which any expression that was interesting to encode in a block could be done so, then decorated.</p><p>Two standard (i.e. non-Lispy) and quite Pythonic languages that have worked to integrate metaprogramming and advanced macro facilities are <a href="http://julia.readthedocs.org/en/latest/manual/metaprogramming/" rel="nofollow noreferrer">Julia</a> and <a href="https://nim-lang.org/docs/macros.html" rel="nofollow noreferrer">Nim</a> (formerly known as Nimrod). The way they address program representation and transformation are very powerful, and would be good study points for your design.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../is-macros-support-in-a-programming-language-considered-harmful/'>Is macros support in a programming language considered harmful</a></li><li class="list-group-item"><a href='../how-useful-are-lisp-macros/'>How useful are Lisp macros</a></li><li class="list-group-item"><a href='../python-decorators-in-python/'>Python &#8211; Decorators in Python</a></li><li class="list-group-item"><a href='../byte-code-weaving-vs-lisp-macros/'>Byte code weaving vs Lisp macros</a></li><li class="list-group-item"><a href='../does-macros-support-make-scala-a-lisp-dialect/'>Does macros support make Scala a Lisp dialect</a></li><li class="list-group-item"><a href='../python-decorators-and-lisp-macros/'>Python decorators and Lisp macros</a></li><li class="list-group-item"><a href='../python-class-decorators-in-python-practical-use-cases/'>Python &#8211; Class decorators in Python: practical use cases</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>