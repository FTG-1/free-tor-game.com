<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; Event Sourcing , sagas, bus and eventual consistency &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079254 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079254" class="post-1079254 software type-software status-publish hentry category-software tag-architectural-patterns tag-architecture tag-cqrs tag-event-sourcing tag-eventual-consistency"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; Event Sourcing , sagas, bus and eventual consistency</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">architectural-patterns</span><span class="mr-2 badge badge-info">Architecture</span><span class="mr-2 badge badge-warning">cqrs</span><span class="mr-2 badge badge-primary">event-sourcing</span><span class="mr-2 badge badge-danger">eventual-consistency</span></p><div class="entry-content"><p>I am currently learning about Event Sourcing via the book <a href="http://rads.stackoverflow.com/amzn/click/073562609X" rel="noreferrer">Microsoft .NET &#8211; Architecting Applications for the Enterprise</a>. Event sourcing is, in my own words, an architectural pattern of storing &#34;events&#34; instead of &#34;current entities&#34;. Current entities can be created by looping over the events belonging to it.</p><p>The problem of performance of creation of current entities can be mitigated by creating an extra storage where periodically the current entities are &#34;snapshotted&#34; (created from the previous snapshot and the events that happened after it).</p><p>In the book the architecture belonging to Event Source is setup as follows:</p><p><a href="../../../i.stack.imgur.com/IwQI2.jpg" rel="noreferrer"><img src="../../../i.stack.imgur.com/IwQI2.jpg" alt="Event Sourcing in the book"/></a></p><p>Here all events (related to a Waterpolo match) are stored in a NoSQL RavenDB store. We also see a bus to keep track of events and a saga which belong to groups of events.</p><p>I have a few questions about Event Sourcing (I decided to ask them all at once since all questions relate to the description in the book):</p><ul><li>I am wondering in what way these events would be stored. I can imagine that the data in events can change over time (extra properties, new event names) and that events need to be easily related to each other and itself. How does the actual structure of the database and data access code look to facilitate change and data retrieval?</li><li>What is a saga? Why is it called a saga? Are they persisted and if so, how?</li><li>How does a bus work? What are the advantages over just writing events directly to an event store?</li><li>In the above architecture where commands and queries are separated (CQRS) and the commands are implemented using Event Sourcing while queries read from the snapshot, what happens when data needs to be displayed during the initiation of a command? (E.g., showing bank account data while a user wants to make a deposit, based on this data.) How, in practice, do we make sure the data displayed is up to date?</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>Event storage</strong></p><p>Event storage will depend on your application but it is a lot easier if you use a flexible storage for your events (so a NoSQL DB, JSON or XML). How you deal with updates will depend on several factors you need to take into account such as requirements for availability and timeframes for updates, amount of events, etc...</p><ul><li>Update your events when your application updates: as part of the deployment of a new application, update all your previous events to the new schema</li><li>Version your events: have a version-id on your event. When an event is read from the database some piece of code knows how to &#39;upgrade&#39; older events to the current structure. Like the first option, but basically &#39;on demand&#39;</li><li>Throw away your old events: when your application updates, make a snapshot of all entities and throw away (or archive) the old events.</li><li>Never throw away old events: basically keep &#39;PurchaseOrder&#39; forever. When you need another field, use a new event such as &#39;PurchaseOrderWithCouponCode&#39;.</li></ul><p><strong>Saga&#39;s</strong></p><p>A saga is basically a long-running event chopped up into pieces. This might be due to different reasons: it could be because you want to have an action that results in multiple events handled in parallel to avoid blocking with a transaction, because you need to coordinate several external systems, or because you need to coordinate with events that cross a bounded context. You need to persist them because of that reason: a saga can be started, launch a few events and at some non-deterministic point can have to resume by launching more events. Udi Dahan has a good <a href="http://udidahan.com/2009/04/20/saga-persistence-and-event-driven-architectures/" rel="noreferrer">introduction</a> on this.</p><p><strong>Message buses</strong></p><p>There is a lot that can be said about buses. They abstract a large part of the storage of events for you and can handle more complicated scenario&#39;s, for example when you have multiple applications that need to work with the event store. For small applications you can write directly into the event store (and the code that would do that could be considered a bus...)</p><p><strong>Data up to date</strong></p><p>Short answer: you don&#39;t. Event sourcing works around this in several ways because you are &#39;eventually consistent&#39;. In this example, you could simply display a message to the users that it might take up to ten minutes for deposits to show up...</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../ddd-saga-event-sourcing-can-a-compensate-action-simply-be-a-delete-on-the-event-store/'>DDD, Saga &#038; Event-sourcing: Can a Compensate Action simply be a delete on the event store</a></li><li class="list-group-item"><a href='../event-sourcing-and-persistence/'>Event sourcing and persistence</a></li><li class="list-group-item"><a href='../c-event-sourcing-merging-aggregate-root-and-projection/'>C# &#8211; Event sourcing: merging aggregate root and projection</a></li><li class="list-group-item"><a href='../how-to-store-sagas-with-event-sourcing/'>How to store Sagas with Event Sourcing</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>