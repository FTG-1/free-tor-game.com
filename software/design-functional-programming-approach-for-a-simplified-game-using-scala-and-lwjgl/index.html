<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; Functional Programming approach for a simplified game using Scala and LWJGL &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072371 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072371" class="post-1072371 software type-software status-publish hentry category-software tag-design tag-functional-programming tag-game-development tag-scala"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; Functional Programming approach for a simplified game using Scala and LWJGL</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">functional programming</span><span class="mr-2 badge badge-warning">game development</span><span class="mr-2 badge badge-primary">scala</span></p><div class="entry-content"><p>I, a Java imperative programmer, would like to understand how to generate a simple version of Space Invaders based on Functional Programming design principles (in particular Referential Transparency). However, each time I try to think of a design, I get lost in the morass of extreme mutability, the same mutability which is shunned by the functional programming purists.</p><p>As an attempt to learn Functional Programming, I decided to attempt to create a very simple 2D interactive game, Space Invader (note the lack of plural), in <a href="http://www.scala-lang.org/" rel="nofollow noreferrer">Scala</a> using the <a href="http://lwjgl.org/" rel="nofollow noreferrer">LWJGL</a>. Here are the requirements for the basic game:</p><ol><li><p>User ship at the bottom of the screen moved left and right by the &#34;A&#34; and &#34;D&#34; keys respectively</p></li><li><p>User ship bullet fired straight up activated by the space bar with a minimum pause between shots to be .5 seconds</p></li><li><p>Alien ship bullet fired straight down activated by a random time of .5 to 1.5 seconds between shots</p></li></ol><p>Things intentionally left out from the original game are WxH aliens, degradable defense barriers x3, high speed saucer ship at at the top of the screen.</p><p>Okay, now to the actual problem domain. For me, all the deterministic parts are obvious. It&#39;s the non-deterministic parts that seem to be blocking my ability to consider how to approach. The deterministic parts are the bullet&#39;s trajectory once they exist, the continuous motion of the alien and the explosion due to a hit on either (or both) of the player&#39;s ship or the alien. The non-deterministic parts (to me) are handling the stream of user input, handling fetching a random value for determining alien bullet firings and handling the output (both graphics and sound).</p><p>I can do (and have done) lots of this type of game development over the years. However, all of it was from the imperative paradigm. And <a href="http://lwjgl.org/" rel="nofollow noreferrer">LWJGL</a> even provides a very simple <a href="http://www.cokeandcode.com/info/tut2d.html" rel="nofollow noreferrer">Java version of Space invaders</a> (of which I began moving to Scala using Scala as Java-without-semicolons).</p><p>Here are some links that talk around this area of which none seem to have directly dealt with the ideas in a way a person coming from Java/Imperative programming would understand:</p><ol><li><p><a href="http://prog21.dadgum.com/23.html" rel="nofollow noreferrer">Purely Functional Retrogames, Part 1 by James Hague</a></p></li><li><p><a href="https://stackoverflow.com/questions/1209097/good-resources-on-using-functional-programming-in-game-development">Similar Stack Overflow post</a></p></li><li><p><a href="http://www.clojure-games.org/code" rel="nofollow noreferrer">Clojure/Lisp Games</a></p></li><li><p><a href="https://stackoverflow.com/questions/952841/exemplary-haskell-game-code">Haskell Games on Stack Overflow</a></p></li><li><p><a href="http://www.haskell.org/haskellwiki/Yampa" rel="nofollow noreferrer">Yampa&#39;s (in Haskell) Functional Reactive Programming</a></p></li></ol><p>It appears that there are some ideas in the Clojure/Lisp and Haskell games (with source). Unfortunately, I am not able to read/interpret the code into mental models that make any sense to my simpleminded Java imperative brain.</p><p>I&#39;m so excited by the possibilities offered by FP, I can just taste the multi-threaded scalability capabilities. I feel like if were able to grok how something as simple as the time + event + randomness model for Space Invader can be implemented, segregating the deterministic and non-deterministic parts in a properly designed system without it turning into what feels like advanced mathematical theory; i.e. Yampa, I&#39;d be set. If learning the level of theory Yampa seems to require to successfully generate simple games is necessary, then the overhead of acquiring all the necessary training and conceptual framework will vastly outweigh my understanding of the benefits of FP (at least for this over-simplified learning experiment).</p><p>Any feedback, proposed models, suggested methods of approaching the problem domain (more specific than the generalities covered by James Hague) would be greatly appreciated.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>An idiomatic Scala/LWJGL implementation of Space Invaders wouldn’t look that much like a Haskell/OpenGL implementation. Writing a Haskell implementation might be a better exercise in my opinion. But if you want to stick with Scala, here are some ideas for how to write it in functional style.</p><p>Try to use immutable objects only. You could have a <code>Game</code> object which holds a <code>Player</code>, a <code>Set[Invader]</code> (be sure to use <a href="http://www.scala-lang.org/api/current/#scala.collection.immutable.Set" rel="nofollow"><code>immutable.Set</code></a>), etc. Give <code>Player</code> an <code>update(state: Game): Player</code> (it could also take <code>depressedKeys: Set[Int]</code>, etc), and give the other classes similar methods.</p><p>For randomness, <a href="http://www.scala-lang.org/api/current/#scala.util.Random" rel="nofollow"><code>scala.util.Random</code></a> isn’t immutable like Haskell’s <a href="http://hackage.haskell.org/package/random/docs/System-Random.html" rel="nofollow"><code>System.Random</code></a>, but you could make your own immmutable generator. This one is inefficient but it demonstrates the idea.</p><pre class="lang-scala prettyprint-override"><code>case class ImmutablePRNG(val seed: Long) extends Immutable {
    lazy val nextLong: (Long, ImmutableRNG) =
        (seed, ImmutablePRNG(new Random(seed).nextLong()))
    ...
}
</code></pre><p>For keyboard/mouse input and rendering, there’s no way around calling impure functions. They’re impure in Haskell too, they’re just encapsulated in <code>IO</code> etc. so that your actual function objects are technically pure (they don’t read or write state themselves, they <em>describe</em> routines which do, and the runtime system executes those routines).</p><p>Just don’t put I/O code in your immutable objects like <code>Game</code>, <code>Player</code> and <code>Invader</code>. You can give <code>Player</code> a <code>render</code> method, but it should look like</p><pre class="lang-scala prettyprint-override"><code>render(state: Game, buffer: Image): Image
</code></pre><p>Unfortunately this doesn’t fit well with LWJGL since it’s so state-based, but you could build your own abstractions on top of it. You could have an <code>ImmutableCanvas</code> class that holds an AWT <a href="http://docs.oracle.com/javase/7/docs/api/java/awt/Canvas.html" rel="nofollow"><code>Canvas</code></a>, and its <code>blit</code> (and other methods) could clone the underlying <code>Canvas</code>, pass it to <a href="http://lwjgl.org/javadoc/org/lwjgl/opengl/Display.html#setParent%28java.awt.Canvas%29" rel="nofollow"><code>Display.setParent</code></a>, then perform the rendering and return the new <code>Canvas</code> (in your immutable wrapper).</p><hr/><p><strong>Update</strong>: Here is some Java code showing how I would go about this. (I would have written almost the same code in Scala, except that an immutable set is built-in and a few for-each loops could be replaced with maps or folds.) I made a player which moves around and fires bullets, but I didn’t add enemies since the code was getting long already. I made just about everything <a href="http://en.wikipedia.org/wiki/Copy-on-write" rel="nofollow">copy-on-write</a> – I think this is the most important concept.</p><pre class="lang-java prettyprint-override"><code>import java.awt.*;
import java.awt.geom.*;
import java.awt.image.*;
import java.awt.event.*;
import javax.swing.*;
import java.util.*;

import static java.awt.event.KeyEvent.*;

// An immutable wrapper around a Set. Doesn&#39;t implement Set or Collection
// because that would require quite a bit of code.
class ImmutableSet&lt;T&gt; implements Iterable&lt;T&gt; {
  final Set&lt;T&gt; backingSet;

  // Construct an empty set.
  ImmutableSet() {
    backingSet = new HashSet&lt;T&gt;();
  }

  // Copy constructor.
  ImmutableSet(ImmutableSet&lt;T&gt; src) {
    backingSet = new HashSet&lt;T&gt;(src.backingSet);
  }

  // Return a new set with an element added.
  ImmutableSet&lt;T&gt; plus(T elem) {
    ImmutableSet&lt;T&gt; copy = new ImmutableSet&lt;T&gt;(this);
    copy.backingSet.add(elem);
    return copy;
  }

  // Return a new set with an element removed.
  ImmutableSet&lt;T&gt; minus(T elem) {
    ImmutableSet&lt;T&gt; copy = new ImmutableSet&lt;T&gt;(this);
    copy.backingSet.remove(elem);
    return copy;
  }

  boolean contains(T elem) {
    return backingSet.contains(elem);
  }

  @Override public Iterator&lt;T&gt; iterator() {
    return backingSet.iterator();
  }
}

// An immutable, copy-on-write wrapper around BufferedImage.
class ImmutableImage {
  final BufferedImage backingImage;

  // Construct a blank image.
  ImmutableImage(int w, int h) {
    backingImage = new BufferedImage(w, h, BufferedImage.TYPE_INT_RGB);
  }

  // Copy constructor.
  ImmutableImage(ImmutableImage src) {
    backingImage = new BufferedImage(
        src.backingImage.getColorModel(),
        src.backingImage.copyData(null),
        false, null);
  }

  // Clear the image.
  ImmutableImage clear(Color c) {
    ImmutableImage copy = new ImmutableImage(this);
    Graphics g = copy.backingImage.getGraphics();
    g.setColor(c);
    g.fillRect(0, 0, backingImage.getWidth(), backingImage.getHeight());
    return copy;
  }

  // Draw a filled circle.
  ImmutableImage fillCircle(int x, int y, int r, Color c) {
    ImmutableImage copy = new ImmutableImage(this);
    Graphics g = copy.backingImage.getGraphics();
    g.setColor(c);
    g.fillOval(x - r, y - r, r * 2, r * 2);
    return copy;
  }
}

// An immutable, copy-on-write object describing the player.
class Player {
  final int x, y;
  final int ticksUntilFire;

  Player(int x, int y, int ticksUntilFire) {
    this.x = x;
    this.y = y;
    this.ticksUntilFire = ticksUntilFire;
  }

  // Construct a player at the starting position, ready to fire.
  Player() {
    this(SpaceInvaders.W / 2, SpaceInvaders.H - 50, 0);
  }

  // Update the game state (repeatedly called for each game tick).
  GameState update(GameState currentState) {
    // Update the player&#39;s position based on which keys are down.
    int newX = x;
    if (currentState.keyboard.isDown(VK_LEFT) || currentState.keyboard.isDown(VK_A))
      newX -= 2;
    if (currentState.keyboard.isDown(VK_RIGHT) || currentState.keyboard.isDown(VK_D))
      newX += 2;

    // Update the time until the player can fire.
    int newTicksUntilFire = ticksUntilFire;
    if (newTicksUntilFire &gt; 0)
      --newTicksUntilFire;

    // Replace the old player with an updated player.
    Player newPlayer = new Player(newX, y, newTicksUntilFire);
    return currentState.setPlayer(newPlayer);
  }

  // Update the game state in response to a key press.
  GameState keyPressed(GameState currentState, int key) {
    if (key == VK_SPACE &amp;&amp; ticksUntilFire == 0) {
      // Fire a bullet.
      Bullet b = new Bullet(x, y);
      ImmutableSet&lt;Bullet&gt; newBullets = currentState.bullets.plus(b);
      currentState = currentState.setBullets(newBullets);

      // Make the player wait 25 ticks before firing again.
      currentState = currentState.setPlayer(new Player(x, y, 25));
    }
    return currentState;
  }

  ImmutableImage render(ImmutableImage img) {
    return img.fillCircle(x, y, 20, Color.RED);
  }
}

// An immutable, copy-on-write object describing a bullet.
class Bullet {
  final int x, y;
  static final int radius = 5;

  Bullet(int x, int y) {
    this.x = x;
    this.y = y;
  }

  // Update the game state (repeatedly called for each game tick).
  GameState update(GameState currentState) {
    ImmutableSet&lt;Bullet&gt; bullets = currentState.bullets;
    bullets = bullets.minus(this);
    if (y + radius &gt;= 0)
      // Add a copy of the bullet which has moved up the screen slightly.
      bullets = bullets.plus(new Bullet(x, y - 5));
    return currentState.setBullets(bullets);
  }

  ImmutableImage render(ImmutableImage img) {
    return img.fillCircle(x, y, radius, Color.BLACK);
  }
}

// An immutable, copy-on-write snapshot of the keyboard state at some time.
class KeyboardState {
  final ImmutableSet&lt;Integer&gt; depressedKeys;

  KeyboardState(ImmutableSet&lt;Integer&gt; depressedKeys) {
    this.depressedKeys = depressedKeys;
  }

  KeyboardState() {
    this(new ImmutableSet&lt;Integer&gt;());
  }

  GameState keyPressed(GameState currentState, int key) {
    return currentState.setKeyboard(new KeyboardState(depressedKeys.plus(key)));
  }

  GameState keyReleased(GameState currentState, int key) {
    return currentState.setKeyboard(new KeyboardState(depressedKeys.minus(key)));
  }

  boolean isDown(int key) {
    return depressedKeys.contains(key);
  }
}

// An immutable, copy-on-write description of the entire game state.
class GameState {
  final Player player;
  final ImmutableSet&lt;Bullet&gt; bullets;
  final KeyboardState keyboard;

  GameState(Player player, ImmutableSet&lt;Bullet&gt; bullets, KeyboardState keyboard) {
    this.player = player;
    this.bullets = bullets;
    this.keyboard = keyboard;
  }

  GameState() {
    this(new Player(), new ImmutableSet&lt;Bullet&gt;(), new KeyboardState());
  }

  GameState setPlayer(Player newPlayer) {
    return new GameState(newPlayer, bullets, keyboard);
  }

  GameState setBullets(ImmutableSet&lt;Bullet&gt; newBullets) {
    return new GameState(player, newBullets, keyboard);
  }

  GameState setKeyboard(KeyboardState newKeyboard) {
    return new GameState(player, bullets, newKeyboard);
  }

  // Update the game state (repeatedly called for each game tick).
  GameState update() {
    GameState current = this;
    current = current.player.update(current);
    for (Bullet b : current.bullets)
      current = b.update(current);
    return current;
  }

  // Update the game state in response to a key press.
  GameState keyPressed(int key) {
    GameState current = this;
    current = keyboard.keyPressed(current, key);
    current = player.keyPressed(current, key);
    return current;
  }

  // Update the game state in response to a key release.
  GameState keyReleased(int key) {
    GameState current = this;
    current = keyboard.keyReleased(current, key);
    return current;
  }

  ImmutableImage render() {
    ImmutableImage img = new ImmutableImage(SpaceInvaders.W, SpaceInvaders.H);
    img = img.clear(Color.BLUE);
    img = player.render(img);
    for (Bullet b : bullets)
      img = b.render(img);
    return img;
  }
}

public class SpaceInvaders {
  static final int W = 640, H = 480;

  static GameState currentState = new GameState();

  public static void main(String[] _) {
    JFrame frame = new JFrame() {{
      setSize(W, H);
      setTitle(&#34;Space Invaders&#34;);
      setContentPane(new JPanel() {
        @Override public void paintComponent(Graphics g) {
          BufferedImage img = SpaceInvaders.currentState.render().backingImage;
          ((Graphics2D) g).drawRenderedImage(img, new AffineTransform());
        }
      });
      addKeyListener(new KeyAdapter() {
        @Override public void keyPressed(KeyEvent e) {
          currentState = currentState.keyPressed(e.getKeyCode());
        }
        @Override public void keyReleased(KeyEvent e) {
          currentState = currentState.keyReleased(e.getKeyCode());
        }
      });
      setLocationByPlatform(true);
      setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
      setVisible(true);
    }};

    for (;;) {
      currentState = currentState.update();
      frame.repaint();
      try {
        Thread.sleep(20);
      } catch (InterruptedException e) {}
    }
  }
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../introducing-functional-programming-constructs-in-non-functional-programming-languages/'>Introducing functional programming constructs in non-functional programming languages</a></li><li class="list-group-item"><a href='../scala-or-clojure-functional-programming-best-practices/'>Scala or Clojure Functional Programming best practices</a></li><li class="list-group-item"><a href='../design-everything-is-a-map-am-i-doing-this-right/'>Design &#8211; &#8220;Everything is a Map&#8221;, am I doing this right</a></li><li class="list-group-item"><a href='../why-big-data-needs-to-be-functional/'>Why Big Data Needs To Be Functional</a></li><li class="list-group-item"><a href='../what-makes-functional-programming-languages-declarative-as-opposed-to-imperative/'>What makes functional programming languages declarative as opposed to Imperative</a></li><li class="list-group-item"><a href='../data-structure-for-two-dimensional-board-games-in-functional-languages/'>Data structure for two-dimensional board games in Functional languages</a></li><li class="list-group-item"><a href='../what-are-the-functional-equivalents-of-imperative-break-statements-and-other-loop-checks/'>What are the functional equivalents of imperative break statements and other loop checks</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>