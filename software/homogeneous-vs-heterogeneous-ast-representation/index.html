<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Homogeneous vs. heterogeneous AST representation &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069445 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069445" class="post-1069445 software type-software status-publish hentry category-software tag-compiler tag-data-structures tag-trees"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Homogeneous vs. heterogeneous AST representation</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">compiler</span><span class="mr-2 badge badge-info">data structures</span><span class="mr-2 badge badge-warning">trees</span></p><div class="entry-content"><p><strong>What are the reasons to choose a homogeneous vs. a heterogeneous AST representation for implementing a complex domain-specific programming language?</strong></p><p>Just to be very clear about what I&#39;m asking, here is some extra background:</p><p>By homogeneous, I mean a tree constructed of nodes which are a single <em>generic type</em>. For example, I think this question is really language independent, but using a C++-like struct for illustration, I&#39;d consider this a minimal homogeneous abstract syntax tree node:</p><pre><code>struct Node {
  int tag;
  void *data;

  Node *first_child;
  Node *next_sibling;
};
</code></pre><p>By heterogeneous, I mean a tree constructed of nodes which are multiple <em>individual types</em> (e.g. one for each grammar production). For example, I don&#39;t want to assume a particular language, but again using C++-like structs for illustration, I&#39;d consider these types part of a hierarchy used to build a heterogenous abstract syntax tree tree:</p><pre><code>struct Node {};

struct Integer_Node : Node {
  int value;
};

struct Plus_Node : Node {
  Node *right;
  Node *left;
};

struct If_Statement : Node {
  Node *Condition;
  Node *Then_Expression;
  Node *Else_Expression;  
};

// ... more types, depending on the language ...
</code></pre><p>Over the years, I&#39;ve implemented several small, special-purpose compilers, usually in a very ad-hoc way. I&#39;ve never used much of a real &#34;AST&#34; because usually syntax-direct translation has been good enough.</p><p>Now I&#39;m in the process of designing and implemented a new, much more complex language, where I will be building an AST and then walking over it with multiple passes for verification, semantic analysis, and so forth.</p><p>For example, it seems that using a homogeneous scheme reduces the amount of code up front, but I wonder if a heterogeneous scheme will pay off better in the long run for reasons I&#39;m not considering. On the other hand, the heterogeneous scheme seems like it allows benefiting from the compiler&#39;s static type checking, virtual method dispatch, etc, but I wonder if any of that is really very useful when developing semantic passes and so forth.</p><p><em>Basically, I&#39;m hoping to gain some insight from those who may have some real experience here. I&#39;ve read many compiler books and have a moderate amount of basic compiler-writing experience, but I haven&#39;t seen this particular dichotomy addressed in any literature I can get my hands on.</em></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>For me, the big advantage of the heterogeneous AST is that it forms a kind of forced, annotated <code>switch</code> statement (assuming a C-like language).</p><p>For the homogeneous AST you usually end up with some kind of routine or class with a big <code>switch</code> statement. You need to keep track of which child node is what yourself. &#34;First child is the conditional, second the true-block, third the false-block.&#34; Whenever you change the code, you easily find yourself making a mental picture of your DSL syntax over and over again.</p><p>Of course you can document heavily, but a good program ought to be self-documenting as much as possible. The heterogeneous AST does just that.</p><p>Furthermore, you can easily turn a heterogeneous AST into a homogeneous one, but not the other way around. Add the tag info (which is a good idea, unless your language supports a cheap <code>is-a</code> query). You can add <code>Node(int index)</code> methods to return the named fields. So you lose nothing in generality by using the heterogeneous AST.</p><p>I won&#39;t mention that the heterogeneous AST is ideal for the Visitor pattern, as it is just as easy to use the Strategy pattern with the homogeneous <code>switch</code> routine. It <em>is</em> easier to add specific functionality to the heterogeneous AST itself, though. If you want to turn it into an interpreter, all you need to do is add some kind of &#34;eval&#34; methods.</p><p>I would consider a homogeneous AST if there are <em>limiting</em> circumstances. If you need to port the compiler to a system with no OOP language available, or if you need to optimize for speed. The homogeneous AST is easier to combine with an FSM. The latter can also be an advantage if you want to have a general multi-purpose compiler that loads syntax rules on the fly. But it is easier to start out with a heterogeneous AST that will generate those tables, after the compiler has been thoroughly tested.</p><p>So, all in all, I would say that neither tree offers specific advantages in terms of &#34;does this tree help or hinder in, say, &#39;semantic passes&#39;?&#34; The advantage of the heterogeneous AST is, in my experience, to reduce the amount of thought and concentration you have to put into coding the tedious stuff of the compiler. There is a lot of repetitiveness and bookkeeping going on, so let the computer do the work for you as much as possible, is my motto.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../implementing-the-visitor-pattern-for-an-abstract-syntax-tree/'>Implementing the Visitor Pattern for an Abstract Syntax Tree</a></li><li class="list-group-item"><a href='../design-how-do-we-keep-dependent-data-structures-up-to-date/'>Design &#8211; How do we keep dependent data structures up to date</a></li><li class="list-group-item"><a href='../c-traversing-an-ast-using-visitors/'>C++ &#8211; Traversing an AST using Visitors</a></li><li class="list-group-item"><a href='../how-exactly-is-an-abstract-syntax-tree-created/'>How exactly is an Abstract Syntax Tree created</a></li><li class="list-group-item"><a href='../c-ast-processing-and-usefulness-of-visitor-pattern/'>C++ &#8211; AST processing and usefulness of visitor pattern</a></li><li class="list-group-item"><a href='../what-method-should-i-use-to-populate-a-tree-as-im-consuming-data-that-is-contained-within-the-tree/'>What method should I use to populate a tree as I&#8217;m consuming data that is contained within the tree</a></li><li class="list-group-item"><a href='../how-are-individual-lines-of-code-and-functions-stored-in-a-concrete-syntax-tree/'>How are individual lines of code and functions stored in a Concrete Syntax Tree</a></li><li class="list-group-item"><a href='../how-does-a-compiler-work-when-its-not-directly-compiling-to-machine-code/'>How does a compiler work when it&#8217;s not directly compiling to machine code</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>