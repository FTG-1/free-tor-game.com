<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Analyzing stack and heap using GDB and C++ &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085553 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085553" class="post-1085553 software type-software status-publish hentry category-software tag-c"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Analyzing stack and heap using GDB and C++</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span></p><div class="entry-content"><p>I have a simple c++ code as the following:</p><pre><code>#include &lt;iostream&gt;

int main() {
    int a = 5;
    int *b = (int *) malloc(40);
    return 0;
}
</code></pre><p>Setting a breakpoint using GDB on line 5 and running <code>disas</code> will output the following:</p><pre><code>Dump of assembler code for function main():
   0x0000000100000f60 &lt;+0&gt;: push   %rbp
   0x0000000100000f61 &lt;+1&gt;: mov    %rsp,%rbp
   0x0000000100000f64 &lt;+4&gt;: sub    $0x10,%rsp
   0x0000000100000f68 &lt;+8&gt;: mov    $0x28,%eax
   0x0000000100000f6d &lt;+13&gt;:    mov    %eax,%edi
   0x0000000100000f6f &lt;+15&gt;:    movl   $0x0,-0x4(%rbp)
   0x0000000100000f76 &lt;+22&gt;:    movl   $0x5,-0x8(%rbp)
=&gt; 0x0000000100000f7d &lt;+29&gt;:    callq  0x100000f90
   0x0000000100000f82 &lt;+34&gt;:    xor    %ecx,%ecx
   0x0000000100000f84 &lt;+36&gt;:    mov    %rax,-0x10(%rbp)
   0x0000000100000f88 &lt;+40&gt;:    mov    %ecx,%eax
   0x0000000100000f8a &lt;+42&gt;:    add    $0x10,%rsp
   0x0000000100000f8e &lt;+46&gt;:    pop    %rbp
   0x0000000100000f8f &lt;+47&gt;:    retq  
</code></pre><p>Here are my questions:</p><p>1- Is all the stack needed for my app within this output? if I&#39;m not mistaking the stack is pointed by <code>rbp</code> and moves down?</p><p>2- <code>b</code> is on the heap correct? I can see the address of it using <code>x b</code>.</p><p>3- Why does <code>x a</code> result in an error <code>Cannot access memory at address 0x5</code>? is it because 5 isn&#39;t actually anywhere on the memory? I can see it&#39;s part of the instruction <code>movl   $0x5,-0x8(%rbp)</code></p><p>Edit (more questions):</p><p>4- I have read that <code>int a = 5;</code> means variable <code>a</code> is created on the stack (memory) with the value 5, is this correct? when I look at the generated assembly, the value <code>5</code> is directly within the instruction set (<code>movl   $0x5,-0x8(%rbp)</code>, there is no reference to a memory location. If it IS on the memory then how can I see it&#39;s memory address? if it is NOT then why do I read that <code>a</code> is on the stack (memory)?</p><p>5- I know heap is also on the memory, is it visible from the above assembly?</p><p>6- I guess my biggest confusion and question is the relation between memory management and generated assembly, can I always point out what/where the heap/stack are given a assembly code? if not what else is needed?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>1- Is all the stack needed for my app within this output? if I&#39;m not mistaking the stack is pointed by rbp and moves down?</p></blockquote><p>This question is somewhat ill-formed as written. Because your app is only a single function, all variables in the <code>main()</code> function are on the stack shown here. However, your app was likely built with some indicator of what its stack size should be and the OS allocated that much stack for your application, even if you didn&#39;t use all of it.</p><p>The <code>rbp</code> and <code>rsp</code> registers <a href="https://stackoverflow.com/questions/41912684/what-is-the-purpose-of-the-rbp-register-in-x86-64-assembler">work in concert</a> to keep data and return addresses and values on the stack.</p><blockquote><p>2- b is on the heap correct? I can see the address of it using x b.</p></blockquote><p>The variable <code>b</code> is on the stack, but the memory that it points to, which you allocated with <code>malloc()</code> is on the heap.</p><blockquote><p>3- Why does x a result in an error Cannot access memory at address 0x5? is it because 5 isn&#39;t actually anywhere on the memory? I can see it&#39;s part of the instruction movl   $0x5,-0x8(%rbp)</p></blockquote><p>Note that the <code>x</code> command expects its argument to be an address. When you say <code>x b</code> you&#39;re saying you want gdb to show the memory pointed to by <code>b</code>. When you say <code>x a</code> you&#39;re saying you want gdb to show the memory pointed to by <code>a</code>. But <code>a</code> isn&#39;t a pointer. The <code>x</code> command is attempting to show you memory at address 5, which is a non-readable page of memory, so you get an error.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-custom-heap-allocators/'>C++ &#8211; Custom heap allocators</a></li><li class="list-group-item"><a href='../java-analyzing-memory-usage-java-vs-c-negligible/'>Java &#8211; Analyzing Memory Usage: Java vs C++ Negligible</a></li><li class="list-group-item"><a href='../java-heap-allocation-faster-than-c/'>Java Heap Allocation Faster than C++</a></li><li class="list-group-item"><a href='../c-debugging-memory-corruption/'>C++ &#8211; Debugging memory corruption</a></li><li class="list-group-item"><a href='../c-does-it-make-sense-for-an-object-declared-on-the-heap-to-declare-one-of-its-members-on-the-heap/'>C++ &#8211; Does it make sense for an object declared on the heap to declare one of its members on the heap</a></li><li class="list-group-item"><a href='../c-memory-segmentation-stack-heap-etc/'>C++ &#8211; Memory segmentation &#8211; stack, heap, etc.</a></li><li class="list-group-item"><a href='../c-how-does-gdb-pause-an-execution/'>C++ &#8211; How does GDB pause an execution</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>