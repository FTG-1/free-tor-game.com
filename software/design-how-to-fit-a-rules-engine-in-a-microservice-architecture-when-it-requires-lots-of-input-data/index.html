<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; How to fit a rules engine in a microservice architecture when it requires lots of input data &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067868 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067868" class="post-1067868 software type-software status-publish hentry category-software tag-architecture tag-business-rules tag-design tag-enterprise-architecture tag-microservices"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; How to fit a rules engine in a microservice architecture when it requires lots of input data</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">business-rules</span><span class="mr-2 badge badge-warning">design</span><span class="mr-2 badge badge-primary">enterprise-architecture</span><span class="mr-2 badge badge-danger">microservices</span></p><div class="entry-content"><h2>Current situation</h2><p>We are implementing (and now maintaining) an online shopping web application in a microservice architecture.</p><p>One of the requirements is that the business must be able to apply rules on what our customers add to their cart, in order to customize their experience and the eventual order. Quite obviously, a business rules engine had to be put in place, and we implemented a specific &#34;microservice&#34; for this (if we could still call it so).</p><p>Over the course of a year, this rules engine has become more and more complex, requiring more and more data (e.g. content of the cart but also user information, his role, his existing services, some billing information etc.) to be able to compute those rules.</p><p>For the moment, our <code>shopping-cart</code> microservice is gathering all this data from other microservices. Even though part of this data is used by <code>shopping-cart</code>, most of the time it is mainly used to feed the rules engine.</p><h2>New requirements</h2><p>Now arrives the need for other applications/microservices to reuse the rules engine for similar requirements. In the current situation, they would thus have to transmit the same kind of data, call the same microservices and build (almost) the same resources to be able to call the rules engine.</p><h2>Continuing as is, we will face several issues:</h2><ul><li>everyone (calling the rules engine) has to reimplement the fetching of the data, even if they don&#39;t need it for themselves;</li><li>the requests to the rules engine are complex;</li><li>continuing in this direction, we will have to transport this data all around the network for many requests (think of μs A calling μs B calling the rules engine, but A already has some of the data the rules engine needs);</li><li><code>shopping-cart</code> has become huge due to all the data fetching;</li><li>I probably forget many…</li></ul><p><strong>What can we do to avoid these troubles?</strong></p><p>Ideally, we would avoid adding more complexity to the rules engine. We must also make sure that it does not become a bottleneck – for example some data is rather slow to fetch (10s or even more) so we implemented pre-fetching in <code>shopping-cart</code> such that the data is more likely to be there before we call the rules engine, and keep an acceptable user experience.</p><h2>Some ideas</h2><ol><li>Let the rules engine fetch the data it needs. This would add even more complexity to it, violating the single responsibility principle (<em>even more…</em>);</li><li>Implement a proxy μs before the rules engine to fetch the data;</li><li>Implement a &#34;data fetcher&#34; μs that the rules engine calls to fetch all the data it needs at once (composite inquiry).</li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Let&#39;s take a step back for a second and assess our starting place before writing out this likely-to-be-novel-length answer. You have:</p><ul><li>A large monolith (the rules engine)</li><li>A large quantity of non-modularized data that gets sent around in bulk</li><li>It&#39;s hard to get data to and from the rules engine</li><li>You can&#39;t remove the rules engine</li></ul><p>Ok, this is not that great for microservices. An immediately glaring problem is you guys seem to be misunderstanding what microservices are.</p><blockquote><p>everyone (calling the rules engine) has to reimplement the fetching of the data, even if they don&#39;t need it for themselves;</p></blockquote><p>You need to define some sort of API or communication method that your microservices use and have it be common. This might be a library all of them can import. It might be defining a message protocol. It might be using an existing tool (<a href="https://www.google.com/search?#q=microservice+message+bus">look for microservice message buses</a> as a good starting place).</p><p>The question of interservice communication is not a &#34;solved&#34; problem per se, but it&#39;s also not a &#34;roll your own&#34; problem at this point. A lot of existing tooling and strategies can make your life a ton easier.</p><p>Regardless of what you do, pick a <strong>single</strong> system and try to adapt your communication APIs to use this. Without some a defined way for your services to interact you are going to have all of the disadvantages of microservices and monolithic services and none of the advantages of either.</p><p>Most of your issues stem from this.</p><blockquote><p>the requests to the rules engine are complex;</p></blockquote><p>Make them less complex.</p><p>Find ways to make them less complex. Seriously.  Common datamodels, split up your single rules engine into smaller ones, or something. Make your rules engine work better. Don&#39;t take the &#34;jam everything into the query and just keep making them complicated&#34; approach -- seriously look at what you are doing and why.</p><p>Define some sort of protocol for your data. My <em>guess</em> is you guys have no defined API plan (as per the above) and have started writing REST calls ad hoc whenever needed. This gets increasingly complex as you now have to maintain every microservice every time something gets updated.</p><p>Better yet, you aren&#39;t exactly the <em>first</em> company to ever implement an online shopping tool. Go research other companies.</p><h2>Now what...</h2><p>After this, you at least triaged some of the biggest issues.</p><p>The next issue is this question of your rules engine. I hope that this is reasonably stateless, such that you can scale it. If it is, while suboptimal you at least aren&#39;t going to die in a blaze of glory or build insane workarounds.</p><p>You want your rules engine to be stateless. Make it such that it processes data only. If you find it as a bottleneck, make it so you can run several behind a proxy/load balancer.  Not ideal, but still workable.</p><p>Spend some time considering whether any of your microservices really should be put into your rules engine. If you are increasing your system overhead so significantly just to achieve a &#34;microservices architecture&#34; you need to spend more time planning this out.</p><p>Alternatively, can your rules engine be split into pieces? You may get gains just be making pieces of your rules engine specific services.</p><blockquote><p>We must also make sure that it does not become a bottleneck – for example some data is rather slow to fetch (10s or even more)</p></blockquote><p>Assuming this problem exists after solving the above issues you need to seriously investigate why this is happening. You have a nightmare unfolding but instead of figuring out why (10 seconds? for sending <em>shopping</em> portal data around? Call me cynical, but this seems a bit absurd) you seem to be patching the symptoms rather than looking at the problem causing the symptoms in the first place.</p><p>You&#39;ve used the phrase &#34;data fetching&#34; over and over. Is this data in a database? If not, consider doing this - if you are spending so much time &#34;manually&#34; fetching data it seems like using a real database would be a good idea.</p><p>You may be able to have a design with a database for the data you fetch (depending on what this is, you&#39;ve mentioned it many times), a few rules engines, and your client(s).</p><p>One last note is you want to make sure you use proper versioning of your APIs and services. A minor release should not break backwards compatibility. If you find yourself releasing all your services at the same time for them to work, you don&#39;t have a microservice architecture, you have a distributed monolithic architecture.</p><p>And ultimately, microservices aren&#39;t a one-size-fits-all solution. Please, for the sake of all that is holy, don&#39;t just do it because it&#39;s the new hip thing.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/rest-large-file-data-transfer-in-a-microservice-architecture/'>Rest &#8211; Large file / data transfer in a Microservice Architecture</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/is-it-a-microservice-if-the-services-pull-data-from-the-same-database-file-storage/'>Is it a microservice if the services pull data from the same database/file storage</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/data-security-between-users-in-a-microservice-architecture/'>Data Security Between Users in a Microservice Architecture</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/dynamic-data-aggregation-in-a-microservice-architecture/'>Dynamic data aggregation in a microservice architecture</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/architecture-microservice-architecture-for-multiple-composite-data-entities/'>Architecture &#8211; Microservice architecture for multiple composite data entities</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>