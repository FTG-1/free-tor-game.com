<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Transaction handling in DAO or Service layer in pure JDBC without frameworks &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1066392 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1066392" class="post-1066392 software type-software status-publish hentry category-software tag-dao tag-database tag-java tag-mysql tag-transaction"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Transaction handling in DAO or Service layer in pure JDBC without frameworks</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">dao</span><span class="mr-2 badge badge-info">database</span><span class="mr-2 badge badge-warning">java</span><span class="mr-2 badge badge-primary">MySQL</span><span class="mr-2 badge badge-danger">transaction</span></p><div class="entry-content"><p>I have an application which works with pure JDBC. I have a dilemma where should <a href="https://docs.oracle.com/javase/tutorial/jdbc/basics/transactions.html" rel="noreferrer">transaction handling</a> go, in <strong>Service</strong> or <strong>DAO</strong> layer. I have found that in most cases it <a href="https://softwareengineering.stackexchange.com/questions/163569/how-to-manage-2-dao-methods-in-a-single-transaction">should be implemented in Service layer</a> since DAO must be as simple as possible and exists solely to provide a connection to the Database. I like this approach, but all the solutions and examples that I&#39;ve found works with Spring or other frameworks and use annotations to mark it as <code>@Transactional</code>.</p><p>In pure JDBC in my <strong>DAO layer</strong> I have a <code>DaoFactory</code>, I take a connection object from it in each DAO class (<code>UserDao</code>, <code>CarDao</code>), which implements a connection pooling, and use this object to connect to the database and perform CRUD operations. In <strong>Service layer</strong>, I create an instance of specific DAO that I need and do actions/calculations on top of it.</p><p>Where do I implement transaction handling here?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><em>Sorry for the rather long answer.</em></p><p>I think, for a modern application approach, you should consider the connection to be injected into the dao, not taken from a factory.</p><p>Your problem is, as I understand it, that from the perspective from the service layer, you want small grained DAO functionality (CRUD) that should be combined to more complex database operations on the service layer. You want to ensure the integrity of the complex operations using db transactions. The issue arising is the visibility of transaction handling and database access outside the dao classes. Your business code gets dirty with transaction and connection handling code, distracting away from the BL to happen.</p><p>This is a common problem also on ORM based approaches. For example on plain Hibernate applications, you need to decide, if you are already in a running session or if you need to start a new session. If you encapsulate the hibernate code into seperate classes, you need to handle the opening and closing of the session in a smart way to avoid code duplication.</p><p>Another arising issue is the stacking of methods: If each methods handles the connection/transaction, you cannot easily have one method call another.</p><p>I have some ideas for you, that you may want to consider:</p><p>First on the stacking issue:</p><ul><li>Wrapping the connection/transaction methods with reference counting<ul><li>The connections are given out using a connection/transaction provider. commit and rollback are methods of the provider. If you open a transaction twice, you need to commit it twice to do the actual commit. On rollback, you may want to reconsider the strategy and rollback immediately ignoring the references.</li></ul></li></ul><p>This allows to start transactions and connections on any level of your code, calling beginTransaction is idempotent regarding the database, but will raise a counter. You need to take care a lot, not to skip a commit on your code, otherwise your transaction boundaries are not going to be executed.</p><p>Using this method will clutter your code at every level with obtainConnection/startTransaction/commit/rollback/returnConnection calls. There is a lot of boilerplate here.</p><p>Yet, keep this method in mind, I solved the stacking issue with this for my frameworks. Now, we need to find ways to remove all this connection clutter from our code. Find the following approaches useful, with an emphasis on the third one.</p><ol><li><p><em>Dependency injection of connection:</em> Your DAOs are not singletons but throw-away objects, receiving the connection on creation time. The calling code will control the connection creation for you.</p><ul><li>PRO: easy to implement</li><li>CON: DB connection preparation / error handling in the business layer</li><li>CON: DAOs are not singletons and you produce a lot of trash on the heap (your implementation language may vary here)</li><li>CON: Will not allow stacking of service methods</li></ul></li><li><p><em>Bind the connection/transaction to the running thread:</em> Your DAOs can be singletons. You bind runtime information in a thread local context object. The business layer will initialize the context for the DAO. For web applications, this can happen on request start.</p><ul><li>PRO: DAOs can be singletons</li><li>PRO: easy to implement</li><li>PRO: given a matching call-lifecycle, the database setup is not visible to the service layer</li><li>CON: if your call-lifecycle has no good initialization point, this is more complicated.</li><li>CON: each call-lifecycle has one transaction, stopping and re-starting a transaction can be a mess.</li><li>CON: Connection handling still visible outside the DAO layer</li><li>CON: Nesting call-lifecycles in the same thread will pose the stacking issue again.</li></ul></li><li><p><em>Use Proxy classes to implement the connection handling transparently on a context object in the thread during service method invocation:</em></p><ul><li>The DAO and Service objects are singletons, the services are wrapped with a proxy. The invocation handler of the proxy will prepare the connection object outside the service class.</li><li>The service class decides with an annotation on the method, if there should be one transaction or immediate commits.</li><li>Service can define a transaction boundary inside a service class using lambda functions.</li><li>PRO/CON</li><li>PRO: No more connection / transaction handling inside DAO or Service  class</li><li>PRO: Service is in full control over transaction boundaries by annotations on method calls.</li><li>PRO: DAO will find connection in context and will not care on transaction boundaries.</li><li>PRO: DAO functions can be fine grained and combined to complex operations without additional coding.</li><li>PRO: Services and DAO are singletons.</li><li>PRO: Stacking is solved by approach given above, doing reference counting. Since the invocation handler is the place to obtain the connection, you will not suffer from lost commit/close as the invocation handler will take care of it on return from the proxied object.</li><li>PRO: works with call-lifecycles like on web applications</li><li>PRO: This is how the frameworks do it :-)</li><li>CON: Complex, yet straight forward implementation (you need annotations, proxy, interfaces, context, a factory for your proxied service implementations, possibly major refactorings of your code)</li></ul></li></ol><p>I have implemented all three approaches (without Spring etal). The last one is especially very powerful and cleans up your service infrastructure a lot. You will demystify the frameworks - it is fun to do :-)</p><p>Yet: Depending on your needs, you may be better off with a lightweight framework provided by some project.</p><p>For the case where you need to implement a transaction boundary inside an otherwise transaction-less service function, you can:</p><ul><li>refactor the function into it&#39;s own service method with the appropriate transaction annotation</li><li>write a class that executes a lambda function in a transactional context and returns you the result</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-are-there-any-real-benefits-to-a-dao-layer/'>Database &#8211; Are there any real benefits to a DAO layer</a></li><li class="list-group-item"><a href='../best-solution-for-a-large-database-transaction/'>Best solution for a large database transaction</a></li><li class="list-group-item"><a href='../java-simple-and-composite-transactional-services-question-about-separation-of-concerns-and-transactions/'>Java &#8211; Simple and Composite transactional services: Question about separation of concerns and transactions</a></li><li class="list-group-item"><a href='../java-transactions-and-subresources-with-jax-rs/'>Java &#8211; Transactions and subresources with JAX-RS</a></li><li class="list-group-item"><a href='../whats-the-correct-approach-to-dao-layer-in-presence-of-orm-framework/'>What&#8217;s the correct approach to DAO layer in presence of ORM framework</a></li><li class="list-group-item"><a href='../java-separating-business-logic-from-db-logic-with-transactions/'>Java &#8211; Separating Business logic from DB-logic with transactions</a></li><li class="list-group-item"><a href='../java-injecting-dao-dependencies-into-service-class-in-core-java/'>Java &#8211; Injecting DAO dependencies into Service Class in Core Java</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>