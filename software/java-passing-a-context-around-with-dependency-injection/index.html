<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Passing a Context around with dependency injection &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068738 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068738" class="post-1068738 software type-software status-publish hentry category-software tag-dependency-injection tag-google-guice tag-java"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Passing a Context around with dependency injection</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">dependency-injection</span><span class="mr-2 badge badge-info">google-guice</span><span class="mr-2 badge badge-warning">java</span></p><div class="entry-content"><p>In the project I&#39;m working on, I&#39;m using Guice and trying to do as much as possible with Dependency Injection. However, there&#39;s one little snag; many of my objects rely on an object <code>Context</code>. This is an immutable object but has some information which most of the other objects need to function properly. It never changes for classes that are all working within the same <code>Context</code>, but my application must be able to support different <code>Context</code>s at the same time, in the same scope. I can think of three ways to solve my problem:</p><ol><li><p>Currently, I&#39;ve found myself writing lots of code with AssistedInject, which almost always has methods like <code>Factory.create(Context c)</code>. All my code that depends on <code>Context</code> is being created in this manner, even if they are otherwise simple.</p></li><li><p>I&#39;m starting to consider using <code>Provider</code>s, and changing every line of <code>factory.create(context)</code> to <code>obj = provider.get(); obj.setContext(c);</code> but I don&#39;t want to rely on my code to do both calls, I like that the compiler makes sure that every object has it&#39;s <code>context</code> and that the <code>context</code> cannot change (it never will).</p></li><li><p>My research pointed me to this thread: <a href="https://stackoverflow.com/questions/16316719/guice-assisted-injection-deeper-down-the-dependency-hierarchy">https://stackoverflow.com/questions/16316719/guice-assisted-injection-deeper-down-the-dependency-hierarchy</a> The idea of pairing each <code>Context</code> to a <code>childInjector</code> which has one line <code>bind(Context.class).toInstance(ContextFactory.makeInstance(args))</code>, but I&#39;m not sure how to ensure that everything is using the correct child injector. This seems like it might be best, but other than that thread (which isn&#39;t my scenario) I&#39;m not sure how to do it, or if it&#39;s right for my situation.</p></li></ol><p>Here&#39;s an <a href="http://sscce.org/" rel="nofollow noreferrer">sscce</a> of what might be done by option 3:</p><pre><code>public class GuiceChildTest {
    public static void main(String... args) {
        Injector inj = Guice.createInjector(new ParentModule());
        Injector fooChildOne = inj.createChildInjector(new FooModule(new Foo(10)));
        Injector fooChildTwo = inj.createChildInjector(new FooModule(new Foo(20)));

        Bar bar = fooChildOne.getInstance(Bar.class);
        System.out.println(bar.baz());

        bar = fooChildTwo.getInstance(Bar.class);
        System.out.println(bar.baz());
    }

    private static class ParentModule extends AbstractModule {
        @Override
        protected void configure() {
        }
    }

    private static class Bar {
        private MyInterface intf;
        @Inject
        public Bar(MyInterface in) {
            this.intf = in;
        }

        public int baz() {
            return intf.doSomething();
        }
    }

    private static class FooModule extends AbstractModule {
        private Foo f;
        public FooModule(Foo f) {
            this.f = f;
        }

        @Override
        protected void configure() {
            bind(MyInterface.class).toInstance(f);
        }   
    }   

    private static class Foo implements MyInterface {
        private int i;
        public Foo(int i) {
            this.i = i;
        }
        @Override
        public int doSomething() {
            return i;
        }
    }

    private static interface MyInterface {
        int doSomething();
    }
}
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Let&#39;s address the fundamentals of <a href="http://en.wikipedia.org/wiki/Dependency_injection" rel="nofollow">Dependency Injection</a> with a brief review of the <a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle" rel="nofollow">dependency injection principle</a></p><blockquote><p>When following this principle, the conventional dependency relationships established from high-level, policy-setting modules to low-level, dependency modules are inverted (i.e. reversed), thus rendering high-level modules independent of the low-level module implementation details. The principle states</p><ul><li>High-level modules should not depend on low-level modules. Both should depend on abstractions.</li><li>Abstractions should not depend on details. Details should depend on abstractions.</li></ul></blockquote><p>It appears that the first two approaches you mentioned may not be fully following DI principles because the higher order objects appear to need to know what type of <code>Context</code> they should have.</p><p>And before I continue, I should admit a bias that will potentially offend fanatical DI proponents:</p><blockquote class="spoiler"><p> DI can get over-emphasized and zealous adherence to the principles can get in the way of writing maintainable code that&#39;s appropriate for the environment that it operates within.  And that&#39;s not necessarily a dig against DI, but rather against any technique that ends up being blindly applied.  I&#39;m not saying that <em>you</em> are blindly applying DI, but there are many who fall into that category.</p></blockquote><p><sub>Spoiler used to protect those who are overly sensitive to such claims</sub></p><p>So before calling methods 1 &amp; 2 &#34;bad&#34;, we need to ask if they are meeting your current needs.  Those approaches involve some measure of boilerplate code that&#39;s copied around.  This can be okay if you don&#39;t find yourself needing to change that template on a frequent basis.</p><p>Likewise, if the objects can use one and only one type of Context, then you may not <em>need</em> to worry about DI in this case as there isn&#39;t necessarily something else you&#39;d inject into the object.  &#34;But what about testing?!&#34; is the usual retort to that pragmatic claim, which is answered with an equally pragmatic answer of &#34;Can those objects use / do they need a different Context for testing?&#34;  If yes, then use DI.  If not, then ... carry on.</p><p>The 3rd option you propose gets you further away from the boilerplate code and gets you closer to a DI approach.  Your hesitation appears to be:</p><blockquote><p>but I&#39;m not sure how to ensure that everything is using the correct child injector</p></blockquote><p>I think the solution to that challenge is to wrap your Context creation within a <a href="http://en.wikipedia.org/wiki/Factory_(object-oriented_programming)" rel="nofollow">Factory</a> and absolve the higher order objects from knowing what they need to call.</p><p>So if I understood your code sample correctly, instead of this:</p><pre><code>Bar bar = fooChildOne.getInstance(Bar.class);
</code></pre><p>you would have something like:</p><pre><code>Bar bar = new Bar(ContextFactory.getInstance(Bar.class));
</code></pre><p>In the suggestion, we&#39;re passing the Context returned from the <code>ContextFactory</code> into <code>Bar</code>&#39;s constructor.  It may be <sup>1</sup> trivial to simplify that example with:</p><pre><code>public class Bar(){
    Bar(){
        return Bar(ContextFactory.getInstance(Bar.class));
    }
}
</code></pre><p>or:</p><pre><code>public class Bar(){
    Bar(){
        this.Context = ContextFactory.getInstance(Bar.class);
    }
}
</code></pre><p><sup>1</sup> <sub>My Java is rusty, so I don&#39;t know if you can chain constructors like that first example.</sub></p><p>And you could potentially tighten things up a bit by using reflection within the <code>ContextFactory</code> to determine the correct Context for <code>Bar</code> or optionally pass in additional parameters to the <code>ContextFactory</code> if <code>Bar</code> can handle multiple types of Context in regular operation.</p><h3>TL;DR</h3><p>Use the third option you proposed and wrap Context creation within a <a href="http://en.wikipedia.org/wiki/Factory_(object-oriented_programming)" rel="nofollow">Factory</a>.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/java-dependency-injection-field-injection-vs-constructor-injection/'>Java &#8211; Dependency Injection: Field Injection vs Constructor Injection</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/dependency-injection-with-parameterless-constructor/'>Dependency Injection WIth Parameterless Constructor</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/unit-testing-dependency-injection-with-default-construction/'>Unit-testing &#8211; Dependency Injection with default Construction</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>