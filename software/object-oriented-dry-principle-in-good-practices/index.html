<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Object-oriented &#8211; DRY principle in good practices &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082438 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082438" class="post-1082438 software type-software status-publish hentry category-software tag-design-patterns tag-object-oriented tag-php"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Object-oriented &#8211; DRY principle in good practices</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design-patterns</span><span class="mr-2 badge badge-info">object-oriented</span><span class="mr-2 badge badge-warning">PHP</span></p><div class="entry-content"><p>I am trying to follow the DRY principle in my programming as hard as I can. Recently I have been learning design patterns in OOP and I have ended up repeating myself quite a bunch.</p><p>I have created a Repository pattern along with a Factory and Gateway patterns to handle my persistence. I&#39;m using a database in my application but that shouldn&#39;t matter since I should be able to swap out the Gateway and switch to another kind of persistence if I wished.</p><p>The problem I&#39;ve ended up creating for myself is that I create the same objects for the number of tables I have. For example these will be the objects I need to handle a table <code>comments</code>.</p><pre><code>class Comment extends Model {

    protected $id;
    protected $author;
    protected $text;
    protected $date;
}

class CommentFactory implements iFactory {

    public function createFrom(array $data) {
        return new Comment($data);
    }
}

class CommentGateway implements iGateway {

    protected $db;

    public function __construct(\Database $db) {
        $this-&gt;db = $db;
    }

    public function persist($data) {

        if(isset($data[&#39;id&#39;])) {
            $sql = &#39;UPDATE comments SET author = ?, text = ?, date = ? WHERE id = ?&#39;;
            $this-&gt;db-&gt;prepare($sql)-&gt;execute($data[&#39;author&#39;], $data[&#39;text&#39;], $data[&#39;date&#39;], $data[&#39;id&#39;]);
        } else {
            $sql = &#39;INSERT INTO comments (author, text, date) VALUES (?, ?, ?)&#39;;
            $this-&gt;db-&gt;prepare($sql)-&gt;execute($data[&#39;author&#39;], $data[&#39;text&#39;], $data[&#39;date&#39;]);
        }
    }

    public function retrieve($id) {

        $sql = &#39;SELECT * FROM comments WHERE id = ?&#39;;
        return $this-&gt;db-&gt;prepare($sql)-&gt;execute($id)-&gt;fetch();
    }

    public function delete($id) {

        $sql = &#39;DELETE FROM comments WHERE id = ?&#39;;
        return $this-&gt;db-&gt;prepare($sql)-&gt;execute($id)-&gt;fetch();
    }
}

class CommentRepository {

    protected $gateway;
    protected $factory;

    public function __construct(iFactory $f, iGateway $g) {
        $this-&gt;gateway = $g;
        $this-&gt;factory = $f;
    }

    public function get($id) {

        $data = $this-&gt;gateway-&gt;retrieve($id);
        return $this-&gt;factory-&gt;createFrom($data);
    }

    public function add(Comment $comment) {

        $data = $comment-&gt;toArray();
        return $this-&gt;gateway-&gt;persist($data);
    }
}
</code></pre><p>Then my controller looks like</p><pre><code>class Comment {

    public function view($id) {

        $gateway = new CommentGateway(Database::connection());
        $factory = new CommentFactory();
        $repo = new CommentRepository($factory, $gateway);

        return Response::view(&#39;comment/view&#39;, $repo-&gt;get($id));
    }
}
</code></pre><p>So I thought I was using design patterns correctly and keeping good practices, but the problem with this thing is that when I add a new table, I have to create the same classes just with other names. This raises suspicion in me that I may be doing something wrong.</p><p>I thought of a solution where instead of interfaces I had abstract classes which using the class name figure out the table they need to manipulate but that doesn&#39;t seem like the right thing to do, what if I decide to switch to a file storage or memcache where there are no tables.</p><p>Am I approaching this correctly, or is there a different perspective I should be looking at?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The problem you are addressing is quite fundamental.</p><p>I have experienced the same problem when I worked for a company that
made a large J2EE application that consisted of several hundred web pages and over a million and a half lines of Java code. This code used ORM (JPA) for persistence.</p><p>This problem get worse when you use 3rd party technologies in every layer of the architecture and the technologies all require their own data representation.</p><p>Your problem can not be solved at the level of the programming language you are using. Using patterns is good but as you see it cause repetition of code (ore more accurately put: repetition of designs).</p><p>The way I see it there are only 3 possible solutions. In practice these solutions come down to the same.</p><p>Solution 1: Use some other persistence framework that allows you to state only <em>what</em> must be persisted. There is probably such a framework around. The problem with this approach is that it is rather naive because not all you patterns will be persistence related. You wil also want to use patterns for user interface code so you&#39;d then need a GUI framework that can re-use the data representations of the persistence framework you choose. If you can not re-use them you&#39;ll need to write boiler plate code to bridge the data representations of the GUI framework and the persistence framework.. and this is contrary to the DRY principle again.</p><p>Solution 2: Use another - more powerful - programming language that has constructs that allow you to express the repetitive design so you can re-use the design-code. This is probably not an option for you but suppose for a moment it is. Then again when you start creating a user interface on top of the persistence layer you&#39;ll want the language again to be powerful enough to support creating the GUI without having to write boiler plate code. It is unlikely that there is a language powerful enough to do what you want since most languages rely on 3rd party frameworks for GUI building that each require their own data representation to work.</p><p>Solution 3: Automate the repetition of code and design using some form of code generation. Your worry is about having to hand-code repetitions of patterns and designs since hand-coding repetitive code/design violate the DRY principle.
Nowadays there are very powerful code generator frameworks out there. There are even &#34;language workbenches&#34; that allow you to quickly (half a day when you have no experience) create your own programming language and generate any code (PHP/Java/SQL - any thinkable text file) using that language. I have experience with XText but MetaEdit and MPS seem to be fine as well. I strongly advice you
to check one of these language workbenches out. To me it was the most liberating experience in my professional life.</p><p>Using Xtext you can have your machine generate the repetitive code. 
Xtext even generates a syntax highlighting editor for you with code completion for your own language specification. From that point you simply take your gateway and factory class and turn them into code templates by punching holes in them.
You feed them to your generator (which is called by a parser of your language that is also completely generated by Xtext) and the generator will fill in the holes in your templates. The result is generated code. From that point on you can take out any repetition of code anywhere (GUI code persistence code etc).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/is-mapper-a-valid-design-pattern-or-is-it-a-variation-of-the-factory-pattern/'>Is &#8220;Mapper&#8221; a valid design pattern or is it a variation of the &#8220;Factory&#8221; pattern</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/object-oriented-xerox-solid-example-in-php/'>Object-oriented &#8211; Xerox SOLID example in PHP</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/introducing-fowlers-table-data-gateway-to-refactor-poorly-designed-systems/'>Introducing Fowler&#8217;s Table Data Gateway to refactor poorly designed systems</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/use-a-factory-class-instead-of-direct-object-construction/'>Use a factory class instead of direct object construction</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/java-using-mvc-style-where-is-the-best-place-to-put-sql-functionality/'>Java &#8211; Using MVC style, where is the best place to put SQL functionality</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>