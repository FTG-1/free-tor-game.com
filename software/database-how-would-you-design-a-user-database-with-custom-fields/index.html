<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Database &#8211; How would you design a user database with custom fields &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1065037 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1065037" class="post-1065037 software type-software status-publish hentry category-software tag-database tag-database-design tag-nosql tag-sql"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Database &#8211; How would you design a user database with custom fields</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database</span><span class="mr-2 badge badge-info">database-design</span><span class="mr-2 badge badge-warning">nosql</span><span class="mr-2 badge badge-primary">sql</span></p><div class="entry-content"><p>This question is around how should I design a database, it can be relational / nosql databases, depending on what will be the better solution</p><hr/><p>Given a requirement where you&#39;ll need to create a system that will involve a database to track &#34;Company&#34; and &#34;User&#34;. A single user always only belong to one company</p><ul><li>A user can only belong to one company</li><li>A company can have many users</li></ul><p>The design for &#34;Company&#34; table is quite straightforward.<br /> Company will have the following attributes / columns: (let&#39;s keep it simple)</p><pre><code>ID, COMPANY_NAME, CREATED_ON
</code></pre><p><strong>First scenario</strong></p><p>Simple &amp; straight forward, users all have the same attribute, so this can be easily done in relational style, user table:</p><pre><code>ID, COMPANY_ID, FIRST_NAME, LAST_NAME, EMAIL, CREATED_ON
</code></pre><p><strong>Second scenario</strong></p><p>What happen if different companies want to store different profile attribute for their user. Each company will have a defined set of attributes that would apply to all users of that company.</p><p>For example:</p><ul><li>Company A wants to store: LIKE_MOVIE (boolean), LIKE_MUSIC (boolean)</li><li>Company B wants to store: FAV_CUISINE (String)</li><li>Company C wants to store: OWN_DOG (boolean), DOG_COUNT (int)</li></ul><p><em>Approach 1</em></p><p>the brute force way is to have a single schema for the user and let them have nulls when they dont belong to the company:</p><pre><code>ID, COMPANY_ID, FIRST_NAME, LAST_NAME, EMAIL, LIKE_MOVIE, LIKE_MUSIC, FAV_CUISINE, OWN_DOG, DOG_COUNT, CREATED_ON
</code></pre><p>Which is kinda nasty because you will end up with a lot of NULLS and user rows that have columns that are irrelevant to them (ie. all users belonging to Company A has NULL values for FAV_CUISINE, OWN_DOG, DOG_COUNT)</p><p><em>Approach 2</em></p><p>a second approach, is to have &#34;free form field&#34;:</p><pre><code>ID, COMPANY_ID, FIRST_NAME, LAST_NAME, EMAIL, CUSTOM_1, CUSTOM_2, CUSTOM_3, CREATED_ON
</code></pre><p>Which would be nasty on its own since you have no idea what custom fields are, the data type will not be reflective of the values stored (eg. we&#39;ll store int value as VARCHAR).</p><p><em>Approach 3</em></p><p>I have looked into PostgreSQL JSON field, in which case you will have:</p><pre><code>ID, COMPANY_ID, FIRST_NAME, LAST_NAME, EMAIL, CUSTOM_PROFILE_JSON, CREATED_ON
</code></pre><p>In this case, how would you be able to apply different schemas to a user?<br /> A user with Company A will have schema that looks like</p><pre><code> {&#34;LIKE_MOVIE&#34;:&#34;boolean&#34;, &#34;LIKE_MUSIC&#34;: &#34;boolean&#34;}
</code></pre><p>While a user with Company C will have a different schema:</p><pre><code> {&#34;OWN_DOG &#34;:&#34;boolean&#34;, &#34;DOG_COUNT&#34;: &#34;int&#34;}
</code></pre><hr/><p>How should I solve this issue? How can I design database properly to allow for this flexible schema for a single &#34;object&#34; (User) based on the relationship they have (Company)?</p><p>relational solution? nosql solution?</p><hr/><p><strong>Edit:</strong> I&#39;ve also thought about a &#34;CUSTOM_PROFILE&#34; table which will essentially store user attributes in rows rather than columns.</p><p>There are 2 problems with this approach:</p><p>1) The data grows <em>per user</em> grow as rows rather than columns &#8211; and this mean to get a full picture of the user, a lot of joins need to be done, multiple joins to the &#34;custom profile&#34; table on the different custom attributes</p><p>2) The data value is always stored as VARCHAR to be generic, even if we know the data is supposed to be integer or boolean etc</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Please consider this as an alternative. The previous two examples will both require that you make changes to the schema as the application&#39;s scope grows in addition the &#34;custom_column&#34; solution is difficult to extend and maintain. Eventually you&#39;ll end up with Custom_510 and then just imagine how awful this table will be to work with.</p><p>First let&#39;s use your Companies schema.</p><pre><code>[Companies] ComnpanyId, COMPANY_NAME, CREATED_ON
</code></pre><p>Next we&#39;ll also use your Users schema for top level required attributes that will be used/shared by all companies.</p><pre><code>[Users] UserId, COMPANY_ID, FIRST_NAME, LAST_NAME, EMAIL, CREATED_ON
</code></pre><p>Next we build a table where we will define our dynamic attributes that are specific to each companies custom user attributes. So here an example value of the Attribute column would be &#34;LikeMusic&#34;:</p><pre><code>[UserAttributeDefinition] UserAttributeDefinitionId, CompanyId, Attribute
</code></pre><p>Next we define a UserAttributes table that will hold user attribute values</p><pre><code>[UserAttributes] UserAttributeDefinitionId, UserId, Value
</code></pre><p>This can be modified in many ways to be better for performance. You can use multiple tables for UserAttributes making each one specific to the data type being stored in Value or just leave it as a VarChar and work with it as a keyvalue store.</p><p>You also may want to move CompanyId off of the UserAttributeDefiniton table and into a cross reference table for future proofing.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../object-oriented-db-schema-for-acl-involving-3-subdomains/'>Object-oriented &#8211; DB Schema for ACL involving 3 subdomains</a></li><li class="list-group-item"><a href='../architecture-saving-user-profiles-in-sql-database/'>Architecture &#8211; Saving user profiles in SQL database</a></li><li class="list-group-item"><a href='../database-would-these-two-scenarios-be-good-candidates-for-a-nosql-database/'>Database &#8211; Would these two scenarios be good candidates for a NoSQL database</a></li><li class="list-group-item"><a href='../how-to-design-a-relational-database-for-user-following-other-users/'>How to design a relational database for user following other users</a></li><li class="list-group-item"><a href='../how-to-design-a-relational-database-where-users-can-create-custom-fields/'>How to design a relational database where users can create custom fields</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>