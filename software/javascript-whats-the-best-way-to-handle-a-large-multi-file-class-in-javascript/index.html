<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Javascript &#8211; What&#8217;s the best way to handle a large multi-file class in Javascript &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075131 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075131" class="post-1075131 software type-software status-publish hentry category-software tag-class tag-file-structure tag-javascript tag-project-structure tag-typescript"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Javascript &#8211; What&#8217;s the best way to handle a large multi-file class in Javascript</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">class</span><span class="mr-2 badge badge-info">file structure</span><span class="mr-2 badge badge-warning">javascript</span><span class="mr-2 badge badge-primary">project-structure</span><span class="mr-2 badge badge-danger">typescript</span></p><div class="entry-content"><p>I have a very large class of 59 methods and about 3000 lines of code. I know that&#39;s far larger than most people would want, but the class represents a virtual machine, and most of the methods are run time functions, so I think this is one of the times when a large class is warranted.</p><p>The question I have is how can I best organise the source code of this class, as I would like to split it up into multiple files.</p><p>I originally used <a href="https://johnresig.com/blog/simple-javascript-inheritance/" rel="noreferrer">John Resig&#39;s class pattern</a>. I would export an object literal from each file, combine them together, and then create the class. This works very adequately, but I want to move to ES classes.</p><p>I&#39;ve experimented with the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes#Mix-ins" rel="noreferrer">Mixin pattern from MDN</a>. Each file could export a function, and then I can combine them together with <code>reduce</code>.</p><pre><code>export default Base =&gt; class extends Base { ... }
</code></pre><pre><code>const inherit = ( ...fns ) =&gt; fns.reduce( ( v, f ) =&gt; f( v ) )

const Glk = inherit( GlkAPI, DateTime, Fref, Misc, Stream, Style, Window )
</code></pre><p>This is functional, but it&#39;s convoluted, and it adds a lot of layers to the inheritance tree, which is not good for performance.</p><p>So I&#39;m wondering if there are any better options.</p><p>Things I&#39;ve considered:</p><ol><li><p>Doing a build time concatenation. The resulting file could be very nice, as if it were a single file to start with, but I&#39;d lose the ability to lint the source code, as the inside of a class is not valid outside of that context. Or I could add a dummy class wrapper around each file, but then I&#39;d need to trim it out when combining, and that&#39;s not a simple concatenation.</p></li><li><p>Use <a href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html" rel="noreferrer">Typescript declaration merging</a>. This sounds good in principle, but I don&#39;t think you can merge classes together, and merging a class with a namespace wouldn&#39;t work either as the namespace properties would become static class properties.</p></li><li><p>Create one simple class and then manually augment the <code>prototype</code> with functions exported from the other files. I guess this is my leading option, but I&#39;m wondering what other projects with big classes have done.</p></li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In situations like this, when I have one part of my program that needs to stand alone as a single, self-contained module but contains many thousands of lines of code, I prefer to take a compositional approach to keep things clean and manageable.</p><p>Instead of trying to keep all of your functionality in one class, why not break it out into several &#34;internal&#34; classes that your main VirtualMachine class instantiates in its constructor and delegates to?  Each class would be in its own file, and you can give your VirtualMachine class a <a href="https://en.wikipedia.org/wiki/Facade_pattern" rel="noreferrer">facade</a> interface to abstract the fact that it delegates to multiple objects internally to do what it needs to do (i.e. you can keep its interface the same as it is now even though its functionality is broken up into multiple classes internally).</p><p>I know you said that it makes sense for all of the code in question to be in one class, but even so large classes often have discreet subsystems that are responsible for specific things.  Maybe the examples you provided (Stream, Style, Window, etc) handle specific concerns in your larger VirtualMachine class?  In my opinion it&#39;s fine to break these out into separate classes that are only meant to be instantiated and used together in your main class.</p><p>If your classes all need access to some shared state, break that out into a separate class as well, instantiate it in the VirtualMachine class constructor, and pass it to all the other classes via their constructors when you create them.</p><p>The main benefit of taking this approach over the others you mentioned is that it can be done with a simple and well-understood language construct (a class) and common design patterns (<a href="https://en.wikipedia.org/wiki/Delegation_pattern" rel="noreferrer">delegation</a> and <a href="https://en.wikipedia.org/wiki/Object_composition" rel="noreferrer">composition</a>), instead of relying on build magic or esoteric language features to work.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-whats-the-best-way-to-organize-our-unit-tests/'>Unit-testing &#8211; What&#8217;s the best way to organize our unit tests</a></li><li class="list-group-item"><a href='../java-seeing-so-many-instantiable-classes-without-state/'>Java &#8211;  seeing so many instantiable classes without state</a></li><li class="list-group-item"><a href='../javascript-how-to-modularize-and-package-a-client-side-javascript-library-today/'>Javascript &#8211; How to modularize and package a client-side Javascript library today</a></li><li class="list-group-item"><a href='../c-is-using-multiple-static-classes-with-maximum-one-public-method-is-a-good-idea/'>C# &#8211; Is using multiple static classes with maximum one public method is a good idea</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>