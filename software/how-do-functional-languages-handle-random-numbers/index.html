<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How do functional languages handle random numbers &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067144 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067144" class="post-1067144 software type-software status-publish hentry category-software tag-functional-programming tag-functions tag-random"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How do functional languages handle random numbers</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">functional programming</span><span class="mr-2 badge badge-info">functions</span><span class="mr-2 badge badge-warning">random</span></p><div class="entry-content"><p>What I mean about that is that in <em>nearly</em> every tutorial I&#39;ve read about functional languages, is that one of the great things about functions, is that if you call a function with the same parameters twice, you&#39;ll <strong>always</strong> end up with the same result.</p><p>How on earth do you then make a function that takes a seed as a parameter, and then returns a random number based on that seed?</p><p>I mean this would seem to go against one of the things that are so good about functions, right? Or am I completely missing something here?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You can&#39;t create a pure function called <code>random</code> that will give a different result every time it is called. <em>In fact, you can&#39;t even &#34;call&#34; pure functions. You apply them.</em> So you aren&#39;t missing anything, but this doesn&#39;t mean that random numbers are off-limits in functional programming. Allow me to demonstrate, I&#39;ll use Haskell syntax throughout.</p><p>Coming from an imperative background, you may initially expect random to have a type like this:</p><pre><code>random :: () -&gt; Integer
</code></pre><p>But this has already been ruled out because random cannot be a pure function.</p><p>Consider the idea of a value. A value is an immutable thing. It never changes and every observation that you can make about it is consistent for all time.</p><p>Clearly, random can&#39;t produce a Integer value. Instead, it produces a Integer random variable. It&#39;s type might look like this:</p><pre><code>random :: () -&gt; Random Integer
</code></pre><p>Except that passing an argument is completely unnecessary, functions are pure, so one <code>random ()</code> is as good as another <code>random ()</code>. I&#39;ll give random, from here on, this type:</p><pre><code>random :: Random Integer
</code></pre><p>Which is all well and fine, but not very useful. You may expect to be able to write expressions like <code>random + 42</code>, but you can&#39;t, because it won&#39;t typecheck. You can&#39;t do anything with random variables, yet.</p><p>This raises an interesting question. What functions should exist to manipulate random variables?</p><p>This function can&#39;t exist:</p><pre><code>bad :: Random a -&gt; a
</code></pre><p>in any useful way, because then you could write:</p><pre><code>badRandom :: Integer
badRandom = bad random
</code></pre><p>Which introduces an inconsistency. badRandom is supposedly a value, but it is also a random number; a contradiction.</p><p>Maybe we should add this function:</p><pre><code>randomAdd :: Integer -&gt; Random Integer -&gt; Random Integer
</code></pre><p>But this just a special case of a more general pattern. You should be able to apply any function to random thing in order to get other random things like so:</p><pre><code>randomMap :: (a -&gt; b) -&gt; Random a -&gt; Random b
</code></pre><p>Instead of writing <code>random + 42</code>, we can now write <code>randomMap (+42) random</code>.</p><p>If all you had was randomMap, you wouldn&#39;t be able to combine random variables together. You couldn&#39;t write this function for instance:</p><pre><code>randomCombine :: Random a -&gt; Random b -&gt; Random (a, b)
</code></pre><p>You might try to write it like this:</p><pre><code>randomCombine a b = randomMap (\a&#39; -&gt; randomMap (\b&#39; -&gt; (a&#39;, b&#39;)) b) a
</code></pre><p>But it has the wrong type. Instead of ending up with a <code>Random (a, b)</code>, we end up with a <code>Random (Random (a, b))</code></p><p>This can be fixed by adding another function:</p><pre><code>randomJoin :: Random (Random a) -&gt; Random a
</code></pre><p>But, for reasons that may eventually become clear, I&#39;m not going to do that. Instead I&#39;m going to add this:</p><pre><code>randomBind :: Random a -&gt; (a -&gt; Random b) -&gt; Random b
</code></pre><p>It&#39;s not immediately obvious that this actually solves the problem, but it does:</p><pre><code>randomCombine a b = randomBind a (\a&#39; -&gt; randomMap (\b&#39; -&gt; (a&#39;, b&#39;)) b)
</code></pre><p><em>In fact, it&#39;s possible to write randomBind in terms of randomJoin and randomMap. It&#39;s also possible to write randomJoin in terms of randomBind. But, I&#39;ll leave doing this as an exercise.</em></p><p>We could simplify this a little. Allow me to define this function:</p><pre><code>randomUnit :: a -&gt; Random a
</code></pre><p>randomUnit turns a value into a random variable. This means that we can have random variables that aren&#39;t actually random. This was always the case though; we could have done <code>randomMap (const 4) random</code> before. The reason defining randomUnit is a good idea is that now we can define randomMap in terms of randomUnit and randomBind:</p><pre><code>randomMap :: (a -&gt; b) -&gt; Random a -&gt; Random b
randomMap f x = randomBind x (randomUnit . f)
</code></pre><p>Ok, now we are getting somewhere. We have random variables that we can manipulate. However:</p><ul><li>It&#39;s not obvious how we might actually implement these functions,</li><li>It&#39;s quite cumbersome.</li></ul><h2>Implementation</h2><p>I&#39;ll tackle pseudo random numbers. It is possible implement these functions for real random numbers, but this answer is already getting quite long.</p><p>Essentially, the way this is going to work is that we are going to pass a seed value around everywhere. Whenever we generate a new random value, we will produce a new seed. At the end, when we&#39;re done constructing a random variable, we will want to sample from it using this function:</p><pre><code>runRandom :: Seed -&gt; Random a -&gt; a
</code></pre><p>I&#39;m going to define the Random type like this:</p><pre><code>data Random a = Random (Seed -&gt; (Seed, a))
</code></pre><p>Then, we just need to provide implementations of randomUnit, randomBind, runRandom and random which is quite straight-forward:</p><pre><code>randomUnit :: a -&gt; Random a
randomUnit x = Random (\seed -&gt; (seed, x))

randomBind :: Random a -&gt; (a -&gt; Random b) -&gt; Random b
randomBind (Random f) g =
  Random (\seed -&gt;
    let (seed&#39;, x) = f seed
        Random g&#39; = g x in
          g&#39; seed&#39;)

runRandom :: Seed -&gt; Random a -&gt; a
runRandom seed (Random f) = (snd . f) seed
</code></pre><p>For random, I&#39;m going to assume there&#39;s already a function of the type:</p><pre><code>psuedoRandom :: Seed -&gt; (Seed, Integer)
</code></pre><p>In which case random is just <code>Random psuedoRandom</code>.</p><h2>Making things less cumbersome</h2><p>Haskell has syntactic sugar to make things like this nicer on the eyes. It&#39;s called do-notation and to use it all we have to do it create an instance of Monad for Random.</p><pre><code>instance Monad Random where
  return = randomUnit
  (&gt;&gt;=) = randomBind
</code></pre><p>Done. <code>randomCombine</code> from before could now be written:</p><pre><code>randomCombine :: Random a -&gt; Random b -&gt; Random (a, b)
randomCombine a b = do
  a&#39; &lt;- a
  b&#39; &lt;- b
  return (a&#39;, b&#39;)
</code></pre><p>If I was doing this for myself, I would even go one step further than this and create an instance of Applicative. (Don&#39;t worry if this makes no sense).</p><pre><code>instance Functor Random where
  fmap = liftM

instance Applicative Random where
  pure = return
  (&lt;*&gt;) = ap
</code></pre><p>Then randomCombine could be written:</p><pre><code>randomCombine :: Random a -&gt; Random b -&gt; Random (a, b)
randomCombine a b = (,) &lt;$&gt; a &lt;*&gt; b
</code></pre><p>Now that we have these instances, we can use <code>&gt;&gt;=</code> instead of randomBind, join instead of randomJoin, fmap instead of randomMap, return instead of randomUnit. We also get a whole load of functions for free.</p><p>Is it worth it? You could argue, that getting to this stage, where working with random numbers isn&#39;t completely horrendous was quite difficult and long-winded. What did we get in exchange for this effort?</p><p>The most immediate reward is that we can now see exactly which parts of our program are dependent on randomness and which parts are entirely deterministic. In my experience, forcing a strict separation like this simplifies things immensely.</p><p>We&#39;ve assumed so far that we just want a single sample from each random variable that we generate, but if it turns out that in the future we&#39;d actually like to see more of the distribution, this is trivial. You can just use runRandom lots of times on the same random variable with different seeds. This is, of course, possible in imperative languages, but in this case, we can be certain that we aren&#39;t going to perform unanticipated IO every time we sample a random variable and we don&#39;t have to be careful about initializing state.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-how-should-i-test-randomness/'>Unit-testing &#8211; How should I test randomness</a></li><li class="list-group-item"><a href='../c-how-to-generate-random-numbers-without-making-new-random-objects/'>C# &#8211; How to generate random numbers without making new Random objects</a></li><li class="list-group-item"><a href='../how-to-decide-what-code-to-put-into-a-function/'>How to decide what code to put into a function</a></li><li class="list-group-item"><a href='../is-higher-rank-parametric-polymorphism-useful/'>Is higher-rank parametric polymorphism useful</a></li><li class="list-group-item"><a href='../c-functional-vs-object-oriented-style-in-c/'>C# &#8211; Functional vs object-oriented style in C#</a></li><li class="list-group-item"><a href='../c-when-programming-in-functional-style-do-you-have-a-single-application-state-that-you-weave-through-the-application-logic/'>C# &#8211; When programming in Functional style, do you have a single application state that you weave through the application logic</a></li><li class="list-group-item"><a href='../java-testing-a-function-that-uses-random-number-generator/'>Java &#8211; Testing a function that uses random number generator</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>