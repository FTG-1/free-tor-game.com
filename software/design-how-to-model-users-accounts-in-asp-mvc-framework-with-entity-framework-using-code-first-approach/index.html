<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; How to model users accounts in ASP MVC Framework with Entity Framework using code-first approach &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1066498 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1066498" class="post-1066498 software type-software status-publish hentry category-software tag-asp-net-mvc tag-codefirst tag-design tag-entity-framework"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; How to model users accounts in ASP MVC Framework with Entity Framework using code-first approach</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-mvc</span><span class="mr-2 badge badge-info">codefirst</span><span class="mr-2 badge badge-warning">design</span><span class="mr-2 badge badge-primary">entity-framework</span></p><div class="entry-content"><p>How do you design your code-first approach in entity framework when your code should include user data (name, password&#8230;) without repeating/overwriting what the MVC framework will generate in terms of user tables, classes, authorization and authentication</p><p>As simple example, if i have an application that will manage user projects, my models will contain the following classes, and have the following relationship:</p><pre><code>- One user may be assigned one or MANY projects
- One project may be assigned to one or MANY users
</code></pre><p>( just to show the many to many ERD relationship nature)</p><pre><code>class User{
    //implementation of the class members and 
    // navigation properties to alow Entity Framework to create the DB tables
}

class Project{
    //implementation of the class members and 
    // navigation properties to alow Entity Framework to create the DB tables
}
</code></pre><p>Now the problem i am facing is that EF and ASP .net MVC framework takes care of creating user tables, profiles and roles entities&#8230;</p><p>I am not sure whether it is possible to design my classes in a way to show an automatic (conventional)  relationship with the rest of the tables created by MVC.</p><p>In the case this needs to be done by writting custom Authentication classes, can you please explain how? because i have found many articles that discuss the same issue but without pointing out the relationship between the project classes and the MVC created classes / tables, plus  if the developer choses to use the MVC way he will end up with two data contexts, even after merging both tables in one sql server catalog.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>If I&#39;m reading your question correctly, then what you&#39;re looking for is <strong>SimpleMembership</strong>.</p><p>Here&#39;s <a href="http://weblogs.asp.net/jongalloway//simplemembership-membership-providers-universal-providers-and-the-new-asp-net-4-5-web-forms-and-asp-net-mvc-4-templates" rel="nofollow noreferrer">an explanation of SimpleMembership</a>; from the section <em>Easy to with[sic] Entity Framework Code First</em>:</p><blockquote><p>SimpleMembership ... allows[<em>changed</em>] you to use any table as a user store. That means you&#39;re in control of the user profile information, and you can access it however you&#39;d like ....</p></blockquote><p>So you can define your own <code>User</code> class to hold extra user data and relationships, e.g.:</p><pre><code>[Table(&#34;UserProfile&#34;)]
public class UserProfile
{
    // required fields:
    [Key]
    [DatabaseGeneratedAttribute(DatabaseGeneratedOption.Identity)]
    public int      UserId { get; set; }
    public string   UserName { get; set; }

    // your extra fields:
    public List&lt;Project&gt; Projects { get; set; }
    // more here...
}
</code></pre><p><strong>and the regular, built-in Membership stuff is used for handling logins, passwords, and everything else behind the scenes.</strong></p><p>There&#39;s a little more to be done to integrate it, but it wasn&#39;t too bad when I used it.</p><p><em>Note that this works from MVC4 on.</em></p><hr/><h3>Edit to address questions asked in the comments:</h3><p>From what I can tell looking at my code (it&#39;s been a while since I worked on the project and, between it being my first MVC project and other projects scrambling my brain since then, things are a bit fuzzy):</p><p>It looks like I ended up creating my own context that inherited from the <code>DbContext</code> class (as outlined in <a href="http://weblogs.asp.net/thangchung/customize-the-simplemembership-in-asp-net-mvc-4-0" rel="nofollow noreferrer">this tutorial</a>) and contained all my application data; e.g.:</p><pre><code>public class MyContext : DbContext
{
    public MyContext()
        : base(&#34;DefaultConnection&#34;)
    {

    }

    public DbSet&lt;UserProfile&gt; UserProfiles { get; set; }
    public DbSet&lt;Projects&gt; Projects { get; set; }
    // more here
}
</code></pre><p>(IIRC, by inheriting from the <code>DbContext</code> type we get all the built-in membership stuff.)</p><p>Then the rest of the app had to be configured to use this context (as given in the tutorial). (All of my controllers create an instance of my derived context, but this could be set up using dependency injection as well.)</p><p>It looks like the database connection is initialized in the <code>InitializeSimpleMembershipAttribute</code> by default -- this attribute gets applied to all the controllers.</p><p>I ran into the issue stated in <a href="https://stackoverflow.com/questions/17839032/you-must-call-the-websecurity-initializedatabaseconnection-method-before-you-c">this question</a> with this setup, so to fix it I followed the advice in the accepted answer and moved the database connection initialization code to a central point (Global.asax.cs) that ran only once when the web app started.</p><p>I&#39;m afraid that I can&#39;t remember many more details than this, so you&#39;ll probably have to do a bit more research (and probably troubleshooting) to get this working, but it should give you a decent idea of what to look for.</p><p>I ended up reading a lot of tutorials on <a href="http://www.asp.net/" rel="nofollow noreferrer">asp.net</a>, so you might check that site out if you&#39;ve not already.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-entity-framework-and-eager-loading-and-enterprise-application-with-ddd-aproach/'>C# &#8211; Entity framework and Eager loading and enterprise application with DDD aproach</a></li><li class="list-group-item"><a href='../web-development-how-to-split-up-asp-mvc-project-using-code-first-entity-framework/'>Web-development &#8211; How to split up ASP MVC Project using Code-First Entity Framework</a></li><li class="list-group-item"><a href='../how-to-get-around-the-circular-reference-issue-with-json-and-entity/'>How to get around the Circular Reference issue with JSON and Entity</a></li><li class="list-group-item"><a href='../how-to-handle-field-level-acces-security-when-using-entity-framework/'>How to handle field level Acces Security when using Entity Framework</a></li><li class="list-group-item"><a href='../c-code-first-approach-and-business-classes-validation/'>C# &#8211; Code First Approach and Business Classes Validation</a></li><li class="list-group-item"><a href='../entity-framework-code-first-c-class-separation-and-eav/'>Entity Framework Code First, C# class separation and EAV</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>