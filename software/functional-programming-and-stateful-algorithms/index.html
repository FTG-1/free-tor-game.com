<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Functional programming and stateful algorithms &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077702 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077702" class="post-1077702 software type-software status-publish hentry category-software tag-algorithms tag-functional-programming tag-haskell"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Functional programming and stateful algorithms</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">algorithms</span><span class="mr-2 badge badge-info">functional programming</span><span class="mr-2 badge badge-warning">haskell</span></p><div class="entry-content"><p>I&#39;m learning functional programming with <strong>Haskell</strong>. In the meantime I&#39;m studying Automata theory and as the two seem to fit well together I&#39;m writing a small library to play with automata.</p><p>Here&#39;s the problem that made me ask the question. While studying a way to evaluate a state&#39;s reachability I got the idea that a simple recursive algorithm would be quite inefficient, because some paths might share some states and I might end up evaluating them more than once.</p><p>For example, here, evaluating <strong>reachability</strong> of <em>g</em> from <em>a</em>, I&#39;d have to exclude <em>f</em> both while checking the path through <em>d</em> and <em>c</em>:</p><p><img src="../../../i.stack.imgur.com/4JG7I.png" alt="digraph representing an automaton"/></p><p>So my idea is that an algorithm working in parallel on many paths and updating a shared record of excluded states might be great, but that&#39;s too much for me.</p><p>I&#39;ve seen that in some simple recursion cases one can pass state as an argument, and that&#39;s what I have to do here, because I pass forward the list of states I&#39;ve gone through to avoid loops. But is there a way to pass that list also backwards, like returning it in a tuple together with the boolean result of my <code>canReach</code> function? (although this feels a bit forced)</p><p><strong>Besides the validity of my example case</strong>, what other techniques are available to solve this kind of problems? I feel like these must be common enough that there have to be solutions like what happens with <code>fold*</code> or <code>map</code>.</p><p>So far, reading <a href="http://learnyouahaskell.com/" rel="nofollow noreferrer">learnyouahaskell.com</a> I didn&#39;t find any, but consider I haven&#39;t touched monads yet.</p><p>(<em>if interested, I posted my code on <a href="https://codereview.stackexchange.com/q/32266/7439">codereview</a></em>)</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Functional programming doesn&#39;t get rid of state. It only makes it explicit! While it&#39;s true that functions like map will often &#34;unravel&#34; a &#34;shared&#34; data structure, if all you want to do is write a reachability algorithm then it&#39;s just a matter of keeping track of what nodes you already visited:</p><pre class="lang-hs prettyprint-override"><code>import qualified Data.Set as S
data Node = Node Int [Node] deriving (Show)

-- Receives a root node, returns a list of the node keyss visited in a depth-first search
dfs :: Node -&gt; [Int]
dfs x = fst (dfs&#39; (x, S.empty))

-- This worker function keeps track of a set of already-visited nodes to ignore.
dfs&#39; :: (Node, S.Set Int) -&gt; ([Int], S.Set Int)
dfs&#39; (node@(Node k ns), s )
  | k  `S.member` s = ([], s)
  | otherwise =
    let (childtrees, s&#39;) = loopChildren ns (S.insert k s) in
    (k:(concat childtrees), s&#39;)

--This function could probably be implemented as just a fold but Im lazy today...
loopChildren :: [Node] -&gt; S.Set Int -&gt; ([[Int]], S.Set Int)
loopChildren []  s = ([], s)
loopChildren (n:ns) s =
  let (xs, s&#39;) = dfs&#39; (n, s) in
  let (xss, s&#39;&#39;) = loopChildren ns s&#39; in
  (xs:xss, s&#39;&#39;)

na = Node 1 [nb, nc, nd]
nb = Node 2 [ne]
nc = Node 3 [ne, nf]
nd = Node 4 [nf]
ne = Node 5 [ng]
nf = Node 6 []
ng = Node 7 []

main = print $ dfs na -- [1,2,5,7,3,6,4]
</code></pre><p>Now, I must confess that keeping track of all this state by hand is pretty annoying and error prone (it&#39;s easy to use s&#39; instead of s&#39;&#39;, it&#39;s easy to pass the same s&#39; to more than one computation...). This is where monads come in: they don&#39;t add anything you couldn&#39;t already do before but they let you pass the state variable around implicitly and the interface guarantees that it happens in a single-threaded manner.</p><hr/><p>Edit: I&#39;ll attempt to give a more reasoning of what I did now: first of all, instead of just testing for reachability I coded a depth-first search. The implementation is going to look pretty much the same but the debugging looks a bit better.</p><p>In a stateful language, the DFS would look kind of like this:</p><pre class="lang-python prettyprint-override"><code>visited = set()  #mutable state
visitlist = []   #mutable state
def dfs(node):
   if isMember(node, visited):
       //do nothing
   else:
       visited[node.key] = true           
       visitlist.append(node.key)
       for child in node.children:
         dfs(child)
</code></pre><p>Now we need to find a way to get rid of the mutable state. First of all we get rid of the &#34;visitlist&#34; variable by making dfs return that instead of void:</p><pre class="lang-python prettyprint-override"><code>visited = set()  #mutable state
def dfs(node):
   if isMember(node, visited):
       return []
   else:
       visited[node.key] = true
       return [node.key] + concat(map(dfs, node.children))
</code></pre><p>And now comes the tricky part: getting rid of the &#34;visited&#34; variable. The basic trick is to use a convention where we pass the state as an additional parameter to functions that need it and have those functions return the new version of the state as an extra return value if they want to modify it.</p><pre class="lang-hs prettyprint-override"><code>let increment_state s = s+1 in
let extract_state s = (s, 0) in

let s0 = 0 in
let s1 = increment_state s0 in
let s2 = increment_state s1 in
let (x, s3) = extract_state s2 in
-- and so on...
</code></pre><p>To apply this pattern to the dfs, we need to change it to receive the &#34;visited&#34; set as an extra parameter and to return the updated version of &#34;visited&#34; as an extra return value. Additionally, we need to rewrite the code so that we are always passing forward the &#34;most recent&#34; version of the &#34;visited&#34; array:</p><pre class="lang-python prettyprint-override"><code>def dfs(node, visited1):
   if isMember(node, visited1):
       return ([], visited1) #return the old state because we dont want to  change it
   else:
       curr_visited = insert(node.key, visited1) #immutable update, with a new variable for the new value
       childtrees = []
       for child in node.children:
          (ct, curr_visited) = dfs(child, curr_visited)
          child_trees.append(ct)
       return ([node.key] + concat(childTrees), curr_visited)
</code></pre><p>The Haskell version does pretty much what I did here, except that it goes all the way and uses an inner recursive function instead of mutable &#34;curr_visited&#34; and &#34;childtrees&#34; variables.</p><hr/><p>As for monads, what they basically accomplish is implicitly passing the &#34;curr_visited&#34; around, instead of forcing you to do it by hand. Not only does this remove clutter from the code, but it also prevents you from making mistakes, such as forking state (passing the same &#34;visited&#34; set to two subsequent calls instead of chaining the state).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../functional-methods-on-collections/'>Functional Methods on Collections</a></li><li class="list-group-item"><a href='../c-how-to-find-duplicate-strings/'>C# &#8211; How to find duplicate strings</a></li><li class="list-group-item"><a href='../banana-split-and-fusion-in-functional-programming/'>Banana split and fusion in functional programming</a></li><li class="list-group-item"><a href='../functional-programming-and-text-adventures/'>Functional programming and Text adventures</a></li><li class="list-group-item"><a href='../functional-programming-what-to-learn-and-who-uses-it/'>Functional programming &#8211; what to learn and who uses it</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>