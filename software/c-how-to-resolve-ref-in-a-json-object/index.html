<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; How to resolve $ref in a JSON object &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067074 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067074" class="post-1067074 software type-software status-publish hentry category-software tag-c tag-json tag-serialization"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; How to resolve $ref in a JSON object</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">json</span><span class="mr-2 badge badge-warning">serialization</span></p><div class="entry-content"><p>I have written a single page application that uses rest services to retrieve JSON objects.  The JSON objects being returned are C# objects serialized using the Newtonsoft.JSON library.  The returned JSON object contains $ref pointers to specific $id objects within the same JSON object (<a href="https://stackoverflow.com/questions/15312529/resolve-circular-references-from-json-object">The question here shows an example</a>).  I need to access the actual data that the $ref points to, but I do not know how to access it without locating the original source.</p><p>I&#39;ve found solutions such as writing a new contract serializer and writing my own implementation of resolving the references.  I feel like there should be an easier solution than these two.  I&#39;ve also explored the Newtonsoft JSON serialization settings; I&#39;ve tried setting PreserveReferenceHandling to None, but I haven&#39;t had any success there.</p><p>I&#39;m looking for solutions other than the ones I&#39;ve mentioned.  I&#39;m hoping there&#39;s a simple solution that requires very little code to implement and no additional frameworks.</p><p>UPDATE</p><p>I&#39;ve been reading some more about this and discovered that $ref is a JSON Pointer fragment.  The reference number is an ID that references an item from a different schema.  That appears to be the solution, but a schema needs to be defined for it to work.</p><p><a href="https://www.rfc-editor.org/rfc/rfc6901" rel="nofollow noreferrer">RFC for JSON Pointer Fragments</a></p><p><a href="http://jsonary.com/documentation/json-schema/?section=keywords/Referencing" rel="nofollow noreferrer">Info about JSON Pointer Fragments</a></p><p>References:<br /> <a href="https://stackoverflow.com/questions/15312529/resolve-circular-references-from-json-object">Resolve circular JSON references</a><br /> <a href="http://james.newtonking.com/json/help/?topic=html/SerializationSettings.htm" rel="nofollow noreferrer">Serialization Settings</a></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I was able to resolve the &#34;$ref&#34; links in my json code by adapting the code, this blogger posted, to be Angular compliant.</p><p><a href="http://willseitz-code.blogspot.com/2013/01/javascript-to-deserialize-json-that.html" rel="nofollow">http://willseitz-code.blogspot.com/2013/01/javascript-to-deserialize-json-that.html</a></p><p>I created an angular service to resolve the &#34;$ref&#34; I get from NewtonSofts JSON serializer.</p><pre><code>// http://willseitz-code.blogspot.com/2013/01/javascript-to-deserialize-json-that.html
(function () {
&#39;use strict&#39;;

angular
    .module(&#39;app&#39;)
    .factory(&#39;jsonPointerParseService&#39;, jsonPointerParseService);

jsonPointerParseService.$inject = [];

function jsonPointerParseService() {
    var hashOfObjects = {};

    var service = {
        pointerParse: pointerParse
    };

    return service;

    function collectIds(obj) {
        if (jQuery.type(obj) === &#34;object&#34;) {
            if (obj.hasOwnProperty(&#34;$id&#34;)) {
                hashOfObjects[obj.$id] = obj;
            }
            for (var prop in obj) {
                collectIds(obj[prop]);
            }
        } else if (jQuery.type(obj) === &#34;array&#34;) {
            obj.forEach(function (element) {
                collectIds(element);
            });
        }
    }

    function setReferences(obj) {
        if (jQuery.type(obj) === &#34;object&#34;) {
            for (var prop in obj) {
                if (jQuery.type(obj[prop]) === &#34;object&#34; &amp;&amp;
                    obj[prop].hasOwnProperty(&#34;$ref&#34;)) {
                    obj[prop] = hashOfObjects[obj[prop][&#34;$ref&#34;]];
                } else {
                    setReferences(obj[prop]);
                }
            }
        } else if (jQuery.type(obj) === &#34;array&#34;) {
            obj.forEach(function (element, index, array) {
                if (jQuery.type(element) === &#34;object&#34; &amp;&amp;
                    element.hasOwnProperty(&#34;$ref&#34;)) {
                    array[index] = hashOfObjects[element[&#34;$ref&#34;]];
                } else {
                    setReferences(element);
                }
            });
        }
    }

    // Set the max depth of your object graph because JSON.stringify will not be able to
    // serialize a large object graph back to 
    function setMaxDepth(obj, depth) {
        // If this is not an object or array just return there is no need to 
        // set its max depth.
        if (jQuery.type(obj) !== &#34;array&#34; &amp;&amp; jQuery.type(obj) !== &#34;object&#34;) {
            return obj;
        }

        var newObj = {};

        // If this object was an array we want to return the same type in order
        // to keep this variable&#39;s consistency.
        if (jQuery.type(obj) === &#34;array&#34;) {
            newObj = [];
        }

        // For each object or array cut off its tree at the depth value by 
        // recursively diving into the tree.
        angular.forEach(obj, function (value, key) {
            if (depth == 1) {
                newObj = null;
            }
            else if (jQuery.type(value) === &#34;array&#34;) {
                if (setMaxDepth(value, depth - 1)) {
                    newObj[key] = setMaxDepth(value, depth - 1)
                } else {
                    newObj = [];
                }
            } else if (jQuery.type(value) === &#34;object&#34;) {
                if (setMaxDepth(value, depth - 1)) {
                    newObj[key] = setMaxDepth(value, depth - 1)
                } else {
                    newObj = [];
                }
            } else {
                newObj[key] = value;
            }
        }, newObj);

        return newObj;
    }

    function pointerParse(obj, depth) {
        var newObj = obj;

        hashOfObjects = {};
        collectIds(newObj);
        setReferences(newObj);

        if (depth) {
            newObj = setMaxDepth(newObj, depth);
        }

        return newObj;
    }
}
})();
</code></pre><p>Usage would be like so:</p><pre><code> var newObj = jsonPointerParseService.pointerParse(obj);
</code></pre><p>Please keep in mind, this is an Angular service.  So I inject it into whichever controller needs to have these references resolved, and make the call to pointerParse() accordingly.</p><p>Please note though that if you want to post this object back to the server, your browsers JSON.stringify() call has to be able to handle an object with circular references.  By default, in my case, Angular does not call JSON.stringify() with the parameters required to be able to stringify an object with circular references.  So, in this case I would suggest posting only a small portion of data and not this entire object back or instantiating your own call to stringify an object like this.</p><p>Lastly, I must say that dealing with $ref is a pain and I decided to preserve reference handling with only arrays.  This seemed to work well for me.  I still had to access array values with $values however I didnt have to worry about resolving references and didnt have to worry about the server blowing up trying to serialize all of the object circular references to json.</p><pre><code>json.SerializerSettings.ReferenceLoopHandling = Newtonsoft.Json.ReferenceLoopHandling.Serialize;

json.SerializerSettings.PreserveReferencesHandling = Newtonsoft.Json.PreserveReferencesHandling.Arrays;
</code></pre><p>Update: Even with only resolving arrays there are still references that you may need to resolve. In those instances use the pointerParse() function to take care of them.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-storing-object-graphs-with-class-evolution-in-java-with-transformation-long-time-archiving/'>Java &#8211; Storing object-graphs with class-evolution in Java with transformation (long time archiving)</a></li><li class="list-group-item"><a href='../java-serialization-for-long-ish-term-storage/'>Java Serialization for long-ish-term storage</a></li><li class="list-group-item"><a href='../c-help-me-resolve-this-circular-dependency/'>C# &#8211; Help me resolve this circular dependency</a></li><li class="list-group-item"><a href='../serialize-entity-framework-objects-without-lazy-loading/'>Serialize Entity Framework Objects Without Lazy Loading</a></li><li class="list-group-item"><a href='../c-canonical-way-to-handle-json-data-format-changes/'>C# &#8211;  canonical way to handle JSON data format changes</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>