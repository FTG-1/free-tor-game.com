<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; How to use unit tests and TDD to test an app that relies mostly on database CRUD operations &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076020 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076020" class="post-1076020 software type-software status-publish hentry category-software tag-java tag-jpa tag-tdd tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; How to use unit tests and TDD to test an app that relies mostly on database CRUD operations</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">java</span><span class="mr-2 badge badge-info">jpa</span><span class="mr-2 badge badge-warning">tdd</span><span class="mr-2 badge badge-primary">unit testing</span></p><div class="entry-content"><p>At work, one of my projects is mostly about taking data passed in from an external client and persisting it in a database.  It&#39;s a Java enterprise app using JPA and most of our logic revolves around CRUD operations.</p><p>The majority of our bugs involve JPA in one way or another.</p><ul><li>Example 1: If you click the save button twice, JPA might try to insert the same entity into the database a second time, causing a primary key violation.</li><li>Example 2: You retrieve an entity from the database, edit it and try to update its data.  JPA may try to create a new instance instead of updating the old one.</li></ul><p>Often the solution is needing to add/remove/change a JPA annotation.  Other times it has to do with modifying the DAO logic.</p><p><strong>I can&#39;t figure out how to get confidence in our code using unit tests and TDD. I&#39;m not sure if it&#39;s because unit tests and TDD are a bad fit, or if I&#39;m approaching the problem wrong.</strong></p><p>Unit tests seem like a bad fit because I can only discover these problems at runtime and I need to deploy to an app server to reproduce the issues.  Usually the database needs to be involved which I consider to be outside the definition of a unit test: These are integration tests.</p><p>TDD seems like a bad fit because the deploy + test feedback loop is so slow it makes me very unproductive.  The deploy + test feedback loop takes over 3 minutes, and that&#39;s just if I run the tests specifically about the code I&#39;m writing.  To run all the integration tests takes 30+ minutes.</p><p>There is code outside this mold and I always unit test that whenever I can.  But the majority of our bugs and the biggest time sinks always involve JPA or the database.</p><hr/><p><a href="https://softwareengineering.stackexchange.com/questions/174733/is-wrapping-a-third-party-code-the-only-solution-to-unit-test-its-consumers?lq=1">There is another question that is similar</a>, but if I followed the advice I&#39;d be wrapping the most unstable part of my code (the JPA) and testing everything but it. In the context of my question, I&#39;d be in the same bad situation. What&#39;s the next step after wrapping the JPA? IMO that question is (perhaps) a step to answer my question, but not an answer to it.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>One option is to use an in-memory testing database such as <a href="http://h2database.com/html/main.html">H2</a>; it tends to be about about 10x faster than a standard disk-using database, and with lower startup/teardown times.</p><p>Whether it will help does largely depend on whether the JPA issues you are having are general enough that they will still fail on different database. Not much point running tests faster if they miss the bulk of the problems.</p><p>But if you can do 10 runs with H2 for every one with the full system, it could pay off.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-do-we-need-test-data-or-can-we-rely-on-unit-tests-and-manual-testing/'>Unit-testing &#8211; Do we need test data or can we rely on unit tests and manual testing</a></li><li class="list-group-item"><a href='../c-how-to-unit-test-audio/'>C# &#8211; How to unit test audio</a></li><li class="list-group-item"><a href='../unit-testing-how-to-know-if-i-have-enough-unit-test-coverage-to-remove-an-integration-test/'>Unit-testing &#8211; How to know if I have enough unit test coverage to remove an integration test</a></li><li class="list-group-item"><a href='../unit-testing-how-to-unit-test-a-class-which-requires-a-web-service-call/'>Unit-testing &#8211; How to unit test a class which requires a web service call</a></li><li class="list-group-item"><a href='../unit-testing-is-it-sufficient-to-use-acceptance-and-integration-tests-instead-of-unit-test/'>Unit-testing &#8211; Is it sufficient to use acceptance and integration tests instead of unit test</a></li><li class="list-group-item"><a href='../unit-testing-how-to-unit-test-use-tdd-methods-for-etls-and-reporting-projects/'>Unit-testing &#8211; How to unit test \ use TDD methods for ETL&#8217;s and reporting projects</a></li><li class="list-group-item"><a href='../unit-testing-how-to-unit-test-logic-in-crud-app/'>Unit-testing &#8211; How to unit test logic in crud app</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>