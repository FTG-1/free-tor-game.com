<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; How many threads is too many to maintain a chat server &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073044 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073044" class="post-1073044 software type-software status-publish hentry category-software tag-java tag-multithreading"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; How many threads is too many to maintain a chat server</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">java</span><span class="mr-2 badge badge-info">multithreading</span></p><div class="entry-content"><p>I&#39;m writing a chat server and client. For the chat server I have 3 &#34;services&#34; all running on their own threads:</p><ul><li><code>ConnectionListener</code> that loops over <code>accept</code>, and adds any new clients to a <code>ConcurrentLinkedQueue</code></li><li><code>MessageListener</code> that waits for incoming messages from clients; also adding them to another <code>ConcurrentLinkedQueue</code></li><li><code>MessageBroadcaster</code> that sits on the other end of <code>MessageListener</code>&#39;s queue, and sends out any received messages to the clients in <code>ConnectionListener</code>&#39;s queue.</li></ul><p>I think that&#39;s all the background tasks that I&#39;ll need, but say in the future, I have another task that I think should operate concurrently in the background. At that point, the server will be using 4 threads for 4 separate background tasks.</p><p>Is there a point where I should reconsider my design? What is a better way of arranging this?</p><p>My question stems from 2 concerns:</p><ul><li>I hear threads are expensive. While that isn&#39;t an issue yet, I don&#39;t want to get into the habit of spawning a new thread for everything if there&#39;s a better way.</li><li>I&#39;m not sure if I should sacrifice &#34;separation of concerns&#34; to save using threads. In theory, the message receive/broadcast jobs could be combined; although they&#39;re separate duties.</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>I hear threads are expensive. While that isn&#39;t an issue yet, I don&#39;t want to get into the habit of spawning a new thread for everything if there&#39;s a better way.</p></blockquote><p>Threads have overhead. The longer a thread lives, the less of a concern the overhead is. For example, let us assume a thread has a <em>ton</em> of overhead and requires 100ms to spin up. However, the thread lives for an hour. That is a tiny fraction of its life, so who cares? If you can bury the thread initialization in application startup when users expect delays anyway, all the better. If the thread lived for less than a second, then the overhead is a bit much and maybe you should consider alternatives.</p><p>That being said, do not spawn threads to do nothing. Each thread should have a purpose.</p><blockquote><p>I&#39;m not sure if I should sacrifice &#34;separation of concerns&#34; to save using threads. In theory, the message receive/broadcast jobs could be combined; although they&#39;re separate duties.</p></blockquote><p>In my experience, multithreaded applications <em>need</em> multiple threads. Combining concerns with e.g. a listener and a broadcaster in this case will increase complexity to the point of it being unmanageable. It <em>will</em> create bugs. The key here is <em>where do the threads block?</em> If you have a listener that blocks on accepting a socket, it makes no sense for it also to handle requests. One of its concerns will suffer: requests will be delayed, or new connections might fail. Just create more threads.</p><hr/><p>Note 1: you should be using thread primitives, not raw threads. Since you tagged this question <a href="../../questions/tagged/java.html" class="post-tag" title="show questions tagged &#39;java&#39;" rel="tag">java</a> I will point to the specific class: <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html" rel="nofollow noreferrer">ExecutorService</a>. The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executors.html" rel="nofollow noreferrer">Executors</a> class provides several factory methods to make it easy to create them for various tasks. The basic idea is you submit tasks (<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Future.html" rel="nofollow noreferrer">Future</a> or <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html" rel="nofollow noreferrer">Runnable</a>) and let the framework manage the threads.</p><p>This has two primary advantages:</p><ol><li><p>Managing threads can be <em>hard</em>. While it appears easy, there is a lot of boilerplate logic that is easy to screw up, resulting in weird, difficult to replicate (and fix) bugs. Push this responsibility into a robust framework that is well-tested and used in millions of other programs. If there were bugs then Oracle (or Microsoft for .NET, or whatever other vendor) would have found them by now.</p></li><li><p>Your program&#39;s purpose is not &#34;to manage threads&#34; it is &#34;to run a chat server.&#34; Let the framework handle the threading concerns, and focus on the chat server aspect. By focusing on the <em>tasks</em> and not the <em>threads</em>, your code is more concise, expressive, and clear.</p></li></ol><p>I wrote up an answer to this old Stack Overflow question that shows a use case for this. I do not want to derail the focus on this answer too much, so you can read more here as well as search both Programmers and SO: <a href="https://stackoverflow.com/q/4858305/439793">Creating an unknown amount of threads in Java?</a></p><hr/><p>Note 2: given that this appears to be a desktop/server application as opposed to embedded, there is not much need to be concerned with spawning threads. Modern CPUs (amd64, Intel Core) have multiple cores on-die, typically between two and six. Some models are <a href="http://en.wikipedia.org/wiki/Hyper-threading" rel="nofollow noreferrer">hyperthreaded</a> or <a href="http://en.wikipedia.org/wiki/Superscalar" rel="nofollow noreferrer">superscalar</a>, adding more logical cores that can execute code concurrently. Add in <a href="http://en.wikipedia.org/wiki/Preemption_(computing)#Time_slice" rel="nofollow noreferrer">time slicing</a> with today&#39;s high clock speeds, and there is no need to concern oneself with spawning too many threads as long as the threads are reasonable. In the case of your question, the threads appear to be performing small bits of work and possibly blocking on I/O. You are not spawning a million threads for <a href="https://handbrake.fr/" rel="nofollow noreferrer">digital video encoding</a>, for example.</p><p>Even on embedded architectures, speed and concurrency are not as strong as desktop and server CPUs but should have no problem handling a few threads. My smart phone and tablet both have many applications running in the background and have zero performance problems even with many applications and threads running.</p><hr/><p>Note 3: if you are interested in learning more about the tradeoffs of a single-threaded algorithm vs. splitting it into pieces and using concurrency, there are a few topics worth exploring. Given the problem described in your question this is not an immediate need, but could make for some interesting and educational reading.</p><ul><li><p><a href="https://en.wikipedia.org/wiki/MapReduce" rel="nofollow noreferrer">MapReduce</a> is an algorithm for splitting a task into pieces that do not rely on each other, performing those tasks, and joining the results together.</p></li><li><p><a href="https://dba.stackexchange.com/questions/tagged/parallelism">Parallelism in databases</a> involves multiple threads querying data and joining the results. There has been a lot of research into the tradeoffs of using multiple threads for a single database query and a lot of information is out there. Outside of schema/query optimization this is very useful information from a more theoretical perspective.</p></li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-is-there-such-a-thing-as-too-much-asynchronous-code/'>C# &#8211; Is there such a thing as too much asynchronous code</a></li><li class="list-group-item"><a href='../how-to-preserve-order-of-incoming-requests-on-a-multithreaded-server/'>How to preserve order of incoming requests on a multithreaded server</a></li><li class="list-group-item"><a href='../wcf-service-best-way-to-accept-requests-from-a-client-and-do-background-work/'>WCF service &#8211; best way to accept requests from a client and do background work</a></li><li class="list-group-item"><a href='../thread-synchronization-for-multiple-threads-accessing-a-message-stream/'>Thread synchronization for multiple threads accessing a message stream</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>