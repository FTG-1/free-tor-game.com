<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Avoiding Division by Zero Using Float Comparison &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1065959 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1065959" class="post-1065959 software type-software status-publish hentry category-software tag-comparison tag-floating-point"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Avoiding Division by Zero Using Float Comparison</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">comparison</span><span class="mr-2 badge badge-info">floating point</span></p><div class="entry-content"><p>Source code analyzers (like SonarQube) complain about float (or double) equality comparisons because equality is a tricky thing with floats; the values compared can be the results of computations which often have minute rounding effects, so that <code>0.3 - 0.2 == 0.1</code> often returns false while mathematically it should always return true (as tested with Python 2.7).  So this complaint makes perfect sense to warn about potentially dangerous code.</p><p>A typical approach for such situations is to check for a margin, an epsilon, which should compensate all rounding effects, e. g.</p><pre><code>if abs(a - b) &lt; epsilon then â€¦
</code></pre><p>On the other hand one can often see code which avoids a division-by-zero problem by checking the divisor for equality with zero before the division takes place:</p><pre><code>if divisor == 0.0 then
    // do some special handling like skipping the list element,
    // return 0.0 or whatever seems appropriate, depending on context
else
    result = divident / divisor
endif
</code></pre><p>This seems to handle the div-by-zero issue but is not compliant with the source code analyzer who still complains about the spot <code>divisor == 0.0</code>.  On first sight it looks like a problem with the analyzer.  It seems like a false positive.  Float-equality checks for 0.0 should be allowed, shouldn&#39;t they?</p><p>After some consideration I thought about the case that the divisor was the result of a computation which <em>should</em> have resulted in 0.0 (like <code>0.3 - 0.2 - 0.1</code>) and which now was something in the range of <code>1e-17</code> or <code>0.00000000000000001</code>.</p><p>There are two approaches for this now:</p><ol><li>The value is not exactly 0.0, hence the division can take place, the resulting value will be a &#34;normal&#34; floating point number (probably; consider 1e200 / 1e-200 which is <code>inf</code>).  Let it happen, the caller has to take care of the results.</li></ol><p>or</p><ol start="2"><li>The value <em>should have been</em> 0.0, it logically <em>is</em> in this case, the computer just doesn&#39;t notice it, so whatever special handling of the zero case was intended should take place here as well.</li></ol><p>If we vote for the second option, we could use the epsilon approach and be fine.  But that would treat true non-zero values which are just very small like zero-ish values.  We have no way of distinguishing the two cases.</p><p>This leads to the next consideration whether such a true non-zero value which is very close to 0.0 nevertheless should be divided by or whether it <em>should</em> be handled like the zero case (i. e. receive the special handling).  After all, dividing by such a small value will result in very <em>large</em> values which will often be problematic (in graphs or similar).  This is surely up to the context and cannot be answered in general.</p><p>I also considered whether the existence of zero(-ish) values in the input was maybe not the root of the problem but just an effect in itself, i. e. maybe the root of the trouble lay deeper:  Maybe an algorithm which expects a float and which is supposed to divide by it should never receive values which can become zero(-ish) in the first place.</p><p>I can think of use cases with integers where one may need to check for them being zero before dividing (e. g. an index whose difference to a reference index is used as divisor, when both become the same in some iteration, the difference is <code>0</code>), but I couldn&#39;t think of a good example where a float value could become zero-ish.  Maybe if such a thing occurred, it was just a logical error?</p><p>So, now my questions are:</p><ol><li>Is there a theory about the topic of float-zero-checks to avoid division-by-zero problems addressing my considerations?  I found nothing on the Internet about it yet.</li><li>Can someone provide a reasonable example of a context and an algorithm therein which is supposed to expect float values which can become zero and by which it should divide?  And depending on that context which solution (epsilon, pure <code>== 0.0</code>-check, maybe a different approach) would you prefer there?</li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I side with OP&#39;s personal theory that it is not a normal practice to allow a computer program to proceed with a division-by-zero operation, or to only perform a minimal check before the division.</p><p>The exception is when you are implementing something that is too general - a programming language (such as MATLAB) where you (as the programmer) do not know the context / application / use-case / physical meaning of the mathematical operations it is asked to perform. This may be because the formula it is evaluating is provided by the customer, and you do not know the customer&#39;s use-case of that formula. In that case you use a special representation such as Inf or NaN as a placeholder.</p><p>If, however, the formula is provided as part of a statistical toolbox, then you should be able to provide an explanation when the situation arises. See the &#34;weighted averaging when the total weight is zero&#34; example below.</p><hr/><p>There is a way to &#34;invert&#34; a divisor underflow test. Mathematically if <code>b</code> is not zero, and <br/><code>abs(a) / abs(b) &gt; abs(c)</code> where <code>c</code> is the largest representable floating point value, then <br/><code>abs(a) &gt; abs(c) * abs(b)</code>. <strong>However, in practice it requires a more careful implementation than that</strong>.
You may be able to find a mathematical library function that allows you to pass in <code>(a, b)</code> and it will return whether the division will overflow, underflow, or otherwise have poor precision.</p><hr/><p>Source code analyzers look for patterns in the code; they are not sophisticated enough to decide whether someone&#39;s workaround logic is sufficient for the application&#39;s design purpose. (In fact even the average programmer may be unqualified to make that decision.) Source code analyzers are supposed to be augmented with a person qualified to make that decision.</p><hr/><p>A denominator of zero can occur in a lot of mathematical manipulations: formulas, infinite series (summation of sequence), etc. There are many mathematical methods to calculate the result despite having denominators that approach zero (i.e. not exactly zero, but are smaller than the machine-representable value). These means the formulas are <em>not to be evaluated verbatim</em> - they are transformed using some calculus methods, and for each formula there may be several alternative versions which is chosen to avoid the division-by-zero issue.</p><hr/><p>Another situation arises in weighted averaging of data. If you perform a query that selects a subset of data, and when:</p><ol><li>the sum of weights for the subset of data turns out to be zero, or</li><li>when the subset is indeed empty, i.e. the query returns no result</li></ol><p>then the proper way to phrase that situation is &#34;insufficient samples (data) for the query&#34;, etc.</p><hr/><p>In basic trigonometry, some representations (slope) are very sensitive to division problems, whereas an alternative representation (bearing, i.e. angle) would not be sensitive. For example, to represent a line on a 2D plane, where vertical and near-vertical lines need to be represented as robustly as horizontal and near-horizontal lines, you can:</p><ol><li>have a toggle between lines that are steep vs. those that are not. For lines steeper than 45 degrees, you would use <code>(x / y)</code> instead of <code>(y / x)</code> as the &#34;flipped&#34; slope of the line, so as to avoid the division by small numbers.</li><li>Use an alternative representation such as <code>a*x + b*y + c == 0</code> and store the parameters <code>(a, b, c)</code> with the requirement that <code>(a^2 + b^2)</code> must equal <code>1.0</code> for normal case, and <code>0.0</code> if the line is <strong>degenerate</strong> (not-a-line).</li></ol><p>It is worth mentioning that <strong>degeneracy</strong> is unavoidable in many different contexts (and in context-specific ways). For example, if user passes in a &#34;line&#34; <code>from point (x1, y1) to point (x2, y2)</code> and asks to calculate its slope, and it happens that <code>(x1 == x2 and y1 == y2)</code>, then there is no slope, because there is no line, because there is only a single point in the user&#39;s input.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../why-do-you-need-float-double/'>Why do you need float/double</a></li><li class="list-group-item"><a href='../implementing-base-10-floating-point-division/'>Implementing base-10 floating point division</a></li><li class="list-group-item"><a href='../how-lua-handles-both-integer-and-float-numbers/'>How Lua handles both integer and float numbers</a></li><li class="list-group-item"><a href='../python-why-does-pythons-math-ceil-return-a-float/'>Python &#8211; Why does Python&#8217;s math.ceil return a float</a></li><li class="list-group-item"><a href='../javascript-does-comparing-equality-of-float-numbers-mislead-junior-developers-even-if-no-rounding-error-occurs-in-the-case/'>Javascript &#8211; Does comparing equality of float numbers mislead junior developers even if no rounding error occurs in the case</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>