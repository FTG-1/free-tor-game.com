<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python decorators and Lisp macros &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073153 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073153" class="post-1073153 software type-software status-publish hentry category-software tag-clojure tag-lisp tag-macros tag-python"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python decorators and Lisp macros</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">clojure</span><span class="mr-2 badge badge-info">lisp</span><span class="mr-2 badge badge-warning">macros</span><span class="mr-2 badge badge-primary">python</span></p><div class="entry-content"><p>When looking Python decorators someone made the statement, that they are as powerful as Lisp macros (particularly Clojure).</p><p>Looking at the examples given in <a href="http://www.python.org/dev/peps/pep-0318/">PEP 318</a> it looks to me as if they are just a fancy way of using plain old higher-order functions in Lisp:</p><pre class="lang-py prettyprint-override"><code>def attrs(**kwds):
    def decorate(f):
        for k in kwds:
            setattr(f, k, kwds[k])
        return f
    return decorate

@attrs(versionadded=&#34;2.2&#34;,
       author=&#34;Guido van Rossum&#34;)
def mymethod(f):
    ...
</code></pre><p>I haven’t seen any code transforming in any of the examples, like described in <a href="http://bryangilbert.com/code/2013/07/30/anatomy-of-a-clojure-macro/">Anatomy of a Clojure Macro</a>. Plus, Python’s missing <a href="https://en.wikipedia.org/wiki/Homoiconicity">homoiconicity</a> <em>could</em> make code transformations impossible.</p><p>So, how do these two compare and can you say they are about equal in what you can do? Evidence seems to point against it.</p><p><strong>Edit:</strong> Based on a comment, I’m looking for two things: comparison on “as powerful as” and on “as easy to do awesome things with”.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>A <em>decorator</em> is basically just a <em>function</em>.</strong></p><p>Example in Common Lisp:</p><pre class="lang-lisp prettyprint-override"><code>(defun attributes (keywords function)
  (loop for (key value) in keywords
        do (setf (get function key) value))
  function)
</code></pre><p>In above the function is a symbol (which would be returned by <code>DEFUN</code>) and we put the attributes on the symbol&#39;s <em>property list</em>.</p><p>Now we can write it around a function definition:</p><pre class="lang-lisp prettyprint-override"><code>(attributes
  &#39;((version-added &#34;2.2&#34;)
    (author &#34;Rainer Joswig&#34;))

  (defun foo (a b)
    (+ a b))

)  
</code></pre><p>If we want to add a fancy syntax like in Python, we write a <em>reader macro</em>. A reader macro allows us to program on the level of s-expression syntax:</p><pre class="lang-lisp prettyprint-override"><code>(set-macro-character
 #\@
 (lambda (stream char)
   (let ((decorator (read stream))
         (arg       (read stream))
         (form      (read stream)))
     `(,decorator ,arg ,form))))
</code></pre><p>We then can write:</p><pre class="lang-lisp prettyprint-override"><code>@attributes&#39;((version-added &#34;2.2&#34;)
             (author &#34;Rainer Joswig&#34;))
(defun foo (a b)
  (+ a b))
</code></pre><p>The Lisp <em>reader</em> reads above to:</p><pre class="lang-lisp prettyprint-override"><code>(ATTRIBUTES (QUOTE ((VERSION-ADDED &#34;2.2&#34;)
                    (AUTHOR &#34;Rainer Joswig&#34;)))
            (DEFUN FOO (A B) (+ A B)))
</code></pre><p>Now we have a form of <em>decorators</em> in Common Lisp.</p><p><strong>Combining macros and reader macros.</strong></p><p>Actually I would do above translation in real code using a macro, not a function.</p><pre class="lang-lisp prettyprint-override"><code>(defmacro defdecorator (decorator arg form)
  `(progn
     ,form
     (,decorator ,arg &#39;,(second form))))

(set-macro-character
 #\@
 (lambda (stream char)
   (declare (ignore char))
   (let* ((decorator (read stream))
          (arg       (read stream))
          (form      (read stream)))
     `(defdecorator ,decorator ,arg ,form))))
</code></pre><p>The use is as above with the same reader macro. The advantage is that the Lisp compiler still sees it as a so-called <em>top-level form</em> - the *file compiler treats top-level forms specially, for example it adds information about them into the compile-time <em>environment</em>. In the example above we can see that the macro looks into the source code and extracts the name.</p><p>The Lisp <em>reader</em> reads the above example into:</p><pre class="lang-lisp prettyprint-override"><code>(DEFDECORATOR ATTRIBUTES
  (QUOTE ((VERSION-ADDED &#34;2.2&#34;)
           (AUTHOR &#34;Rainer Joswig&#34;)))
  (DEFUN FOO (A B) (+ A B)))
</code></pre><p>Which then gets macro expanded into:</p><pre class="lang-lisp prettyprint-override"><code>(PROGN (DEFUN FOO (A B) (+ A B))
       (ATTRIBUTES (QUOTE ((VERSION-ADDED &#34;2.2&#34;)
                           (AUTHOR &#34;Rainer Joswig&#34;)))
                   (QUOTE FOO)))
</code></pre><p><strong>Macros are very different from <em>reader macros</em>.</strong></p><p>Macros get the source code passed, can do whatever they want and then return source code. The input source does not need to be valid Lisp code. It can be anything and it could be written totally different. The result has to be valid Lisp code then. But if the generated code is using a macro too, then the syntax of the code embedded in the macro call could again be a different syntax. A simple example: one could write a math macro which would accept some kind of mathematical syntax:</p><pre class="lang-lisp prettyprint-override"><code>(math y = 3 x ^ 2 - 4 x + 3)
</code></pre><p>The expression <code>y = 3 x ^ 2 - 4 x + 3</code> is not valid Lisp code, but the macro could for example parse it and return valid Lisp code like this:</p><pre class="lang-lisp prettyprint-override"><code>(setq y (+ (* 3 (expt x 2))
           (- (* 4 x))
           3))
</code></pre><p>There are many other use cases of macros in Lisp.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-useful-are-lisp-macros/'>How useful are Lisp macros</a></li><li class="list-group-item"><a href='../what-are-the-typical-applications-of-lisp-macros/'>What are the typical applications of Lisp macros</a></li><li class="list-group-item"><a href='../python-decorators-in-python/'>Python &#8211; Decorators in Python</a></li><li class="list-group-item"><a href='../byte-code-weaving-vs-lisp-macros/'>Byte code weaving vs Lisp macros</a></li><li class="list-group-item"><a href='../does-macros-support-make-scala-a-lisp-dialect/'>Does macros support make Scala a Lisp dialect</a></li><li class="list-group-item"><a href='../python-how-to-make-decorators-as-powerful-as-macros/'>Python &#8211; How to make decorators as powerful as macros</a></li><li class="list-group-item"><a href='../would-rebol-or-red-benefit-from-lisp-style-macros/'>Would Rebol (or Red) benefit from Lisp-style Macros</a></li><li class="list-group-item"><a href='../what-practical-problem-results-from-lack-of-hygienic-macros-in-clojure/'>What practical problem results from lack of hygienic macros in Clojure</a></li><li class="list-group-item"><a href='../how-to-a-compiler-be-written-for-a-language-that-allows-rewriting-code-at-runtime-such-as-lisp-macros/'>How to a compiler be written for a language that allows rewriting code at runtime (such as Lisp macros)</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>