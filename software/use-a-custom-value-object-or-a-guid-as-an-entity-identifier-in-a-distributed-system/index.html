<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Use a custom value object or a Guid as an entity identifier in a distributed system &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082749 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082749" class="post-1082749 software type-software status-publish hentry category-software tag-distributed-computing tag-domain-driven-design tag-identity tag-soa tag-value-object"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Use a custom value object or a Guid as an entity identifier in a distributed system</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">distributed computing</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">identity</span><span class="mr-2 badge badge-primary">soa</span><span class="mr-2 badge badge-danger">value-object</span></p><div class="entry-content"><h2>tl;dr</h2><p>I&#39;ve been told that in domain-driven design, an identifier for an entity could be a custom value object, i.e. something other than <code>Guid</code>, <code>string</code>, <code>int</code>, etc. Can this really be advisable in a distributed system?</p><h2>Long version</h2><p>I will invent an situation analogous to the one I am currently facing.</p><p>Say I have a distributed system in which a central concept is an egg. The system allows you to order eggs and see spending reports and inventory-centric data such as quantity on hand, usage, valuation and what have you. There area variety of services backing these behaviors. And say there is also another app which allows you to compose recipes that link to a particular egg type.</p><p>Now egg type is broken down by the speciesâ€”ostrich, goose, duck, chicken, quail. This is fine and dandy because it means that users don&#39;t end up with ostrich eggs when they wanted quail eggs and whatnot. However, we&#39;ve been getting complaints because jumbo chicken eggs are not even close to equivalent to small ones. The price is different, and they really aren&#39;t substitutable in recipes. And here we thought we were doing users a favor by not overwhelming them with too many options.</p><p>Currently each of the services (say, <code>OrderSubmitter</code>, <code>EggTypeDefiner</code>, <code>SpendingReportsGenerator</code>, <code>InventoryTracker</code>, <code>RecipeCreator</code>, <code>RecipeTracker</code>, or whatever) are identifying egg types with an industry-standard integer representation the species (let&#39;s call it <code>speciesCode</code>). We realize we&#39;ve goofed up because this change could effect every service.</p><p>There are two basic proposed solutions:</p><ol><li>Use a predefined identifier type like <code>Guid</code> as the <code>eggTypeID</code> throughout all the services, but make <code>EggTypeDefiner</code> the only service that knows that this maps to a <code>speciesCode</code> and <code>eggSizeCode</code> (and potentially to an <code>isOrganic</code> flag in the future, or whatever).</li><li>Use an <code>EggTypeID</code> value object which is a combination of <code>speciesCode</code> and <code>eggSizeCode</code> in every service.</li></ol><p>I&#39;ve proposed the first solution because I&#39;m hoping it better encapsulates the definition of what an egg type is in the <code>EggTypeDefiner</code> and will be more resilient to changes, say if some people now want to differentiate eggs by whether or not they are &#34;organic&#34;.</p><p>The second solution is being suggested by some people who understand DDD better than I do in the hopes that less enrichment and lookup will be necessary that way, with the justification that in DDD using a value object as an ID is fine. Also, they are saying that <code>EggTypeDefiner</code> is not a domain and <code>EggType</code> is not an entity and as such should not have a <code>Guid</code> for an ID.</p><p>However, I&#39;m not sure the second solution is viable. This &#34;value object&#34; is going to have to be serialized into JSON and URLs for GET requests and used with a variety of technologies (C#, JavaScript&#8230;) which breaks encapsulation and thus removes any behavior of the identifier value object (is either of the fields optional? etc.) Is this a case where we want to avoid something that would normally be fine in DDD because we are trying to do DDD in a distributed fashion?</p><h3>Summary</h3><p>Can it be a good idea to use a custom value object as an identifier in a distributed system (solution #2)?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>If I were to simplify it a bit to core requirements, it seems that what the problem comes down to are the following:</p><ol><li>Design egg type in such a way that it can be extended in the future to hold additional attributes</li><li>Whether such extensions can be backward compatible or not (and whether they should be backward compatible or not)</li></ol><p>I would think that the backward compatibility problem is going to be the real issue to solve. Let&#39;s walk through the example you provided:</p><blockquote><p>Currently each of the services (say, OrderSubmitter, EggTypeDefiner,
 SpendingReportsGenerator, InventoryTracker, RecipeCreator,
 RecipeTracker, or whatever) are identifying egg types with an
 industry-standard integer representation the species (let&#39;s call it
 speciesCode). We realize we&#39;ve goofed up because this change could
 effect every service.</p></blockquote><p>Stepping away from the implementation for a second, let&#39;s say the egg type now included a species code and a size code. Now let&#39;s say that a new attribute needed to be added with the assumption that no matter how many attributes are added now, new ones could be added in the future. How should the existing services that are already referencing to existing egg types behave?</p><p>One approach, which may be quite acceptable in this case, could be that any new attribute is an &#39;optional&#39; attribute, which means that there is either a default or a &#34;doesn&#39;t matter&#34; flag and existing services continue to operate based on the existing set of attributes. This issue is easier solved if we assume that attributes will only be added (your case, and never modified or removed, which is a more involved versioning issue).</p><p>If this approach is acceptable, then I would design an object type (typically a class) that holds these various properties, and ensure that serialization and deserialization into various formats is backward compatible.</p><p>For example, let&#39;s assume the following (assume pseudocode):</p><pre><code>class EggType
{
    string speciesCode;
    string sizeCode;
}

string SerializeForURL()
{
    return speciesCode + &#34;.&#34; + sizeCode;
}
</code></pre><p>Now, let&#39;s say we added a new property, called colorCode. But since this is optional, we would assume that an egg type can be created without providing a colorCode. If that&#39;s the case, the code should handle the case where colorCode is provided vs where not provided. Let&#39;s say if one of the services which uses this egg type places orders for new eggs from the farms, that service will have to be modified to support this, otherwise, new eggs will be random colors regardless of what was ordered. However, let&#39;s say there is a service that collects sales data on what is sold, it can simply not aggregate by colorCode (if the code is not yet updated), and not report it up the management chain, until that change is made. This decision of when to support can then rest on respective services.</p><p>We could then modify the serializeForUrl() to be something like this:</p><pre><code>string SerializeForURL()
{
    return speciesCode + &#34;.&#34; + sizeCode + &#34;.&#34; + colorCode;
}
</code></pre><p>In the deserialization method, we could check whether there are two attributes or three. If two, colorCode is not provided, but if three, then colorCode is indeed provided.</p><p>It is easier in the case of JSON, because the value for colorCode would be null.</p><p>I would prefer this approach over GUIDs any day, for multiple reasons:</p><ul><li>Makes it harder to manage change in egg type: It does not allow isolation of these attributes from each other, even though they are really independent of each other. (i.e. if you modify the GUID, all the services need to understand it, even though all it might be doing is adding a property, such as colorCode, which many services may not care about at all.)</li><li>All the systems are now dependent on a global list of GUIDs and how they translate into egg type - unnecessary coupling in my opinion.</li><li>Easier to debug: programmers are one of the users of the code, and they need to be able to easily read code as well as trace logs, audit data, whatever.</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../best-practices-for-generating-new-identifiers-for-persistent-objects/'>Best practices for generating new identifiers for persistent objects</a></li><li class="list-group-item"><a href='../unique-value-object-vs-entity/'>Unique Value Object vs Entity</a></li><li class="list-group-item"><a href='../in-domain-driven-design-how-to-convert-a-database-table-with-a-primary-key-into-a-value-object/'>In domain driven design, how to convert a database table with a primary key into a Value Object</a></li><li class="list-group-item"><a href='../single-source-of-truth-within-an-enterprise-distributed-system/'>Single source of truth within an enterprise distributed system</a></li><li class="list-group-item"><a href='../c-entity-unique-identifier-in-domain-driven-design/'>C# &#8211; Entity unique identifier in domain driven design</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>