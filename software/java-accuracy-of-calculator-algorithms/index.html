<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Accuracy of &#8220;calculator algorithms&#8221; &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077975 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077975" class="post-1077975 software type-software status-publish hentry category-software tag-algorithms tag-java"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Accuracy of &#8220;calculator algorithms&#8221;</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">algorithms</span><span class="mr-2 badge badge-info">java</span></p><div class="entry-content"><p>I am building a library class that provides functionality for mathematical operations on <a href="http://docs.oracle.com/javase/8/docs/api/java/math/BigDecimal.html" rel="nofollow"><code>BigDecimals</code></a> (and a few on <a href="http://docs.oracle.com/javase/8/docs/api/java/math/BigInteger.html" rel="nofollow"><code>BigIntegers</code></a>). Now, BigIntegers are quite easy to master and pleasant to use. BigDecimals can be tricky, but in the end, it finally pays off.</p><p>I want my class to provide results accurate up to a <em>specified</em> level of accuracy (like, number of places after the decimal point). This is where <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Math.html" rel="nofollow"><code>Math</code></a> fails me because it supports operations on <code>double</code>. Now <code>double</code> supports <strong>15-16 significant digits</strong> <em>(not 15-16 places after decimal.)</em> Hence, I&#39;ve decided to upgrade to <code>Bigdecimal</code>.</p><p>But now, the problem is <em>where can I find algorithms that support arbitrary precision calculations?</em> Moreover, I would like to make my <code>BigMath</code>(so I call it) analogous to its sibling in the <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/package-summary.html" rel="nofollow">java.lang</a> package. Then it struck me that if I opt for algorithms used by scientific calculators, then I <em>might</em> achieve the required level of accuracy.</p><p>So here are my (related) questions:</p><ol><li><strong><em>Can</em> I achieve the required level of accuracy using calculator algorithms?</strong></li><li>If yes, then <strong>where can I <em>find</em> the required algorithms?</strong></li><li><strong>Are there any <em>caveats</em> lurking in my approach?</strong></li></ol><hr/><p><strong>UPDATE:</strong><br /> Right now, I have just added support for the <code>sqrt(BigDecimal)</code> method. It makes use of the Newtonian method (and a special trick to generate a <em>good</em> estimate).</p><p>So, here&#39;s the <em>entire</em> <code>BigMath</code> class:</p><pre><code>package in.blogspot.life_on_the_heap.bigmath;

import java.math.BigDecimal;
import java.math.BigInteger;
import java.math.MathContext;

/**
 * @author ambigram_maker
 */
public class BigMath {

    public static void main(String[] args) {
        BigDecimal number = new BigDecimal(&#34;91.91&#34;);
        BigDecimal sqrt = sqrt(number);
        System.out.println(&#34;number = &#34; + number);
        System.out.println(&#34;sqrt(number) = &#34; + sqrt);
        System.out.println(&#34;number = &#34; +
                                   sqrt.multiply(sqrt, getContext(sqrt, DEFAULT_PREC))
                                           .stripTrailingZeros());
    }

    public static final BigDecimal TWO = BigDecimal.valueOf(2L);

    /*
     * The default number of places after the decimal. This is also the
     * *minimum* precision provided by this class.
     */
    private static final int DEFAULT_PREC = 20;
    /*
     * Maintains the &#34;precision&#34; or the number of digits after the decimal.
     */
    private static int precision = DEFAULT_PREC;

    public static void setPrecision(int precision_) {
        if (precision_ &lt; DEFAULT_PREC) {
            precision = DEFAULT_PREC;
        } else {
            precision = precision_;
        }
    }

    public static int getPrecision() {
        return precision;
    }

    public static BigDecimal sqrt(BigDecimal decimal) {
        return sqrt(decimal, precision);
    }

    public static BigDecimal sqrt(BigDecimal decimal, int P_A_D) {
        // quick exit checks:
        if (decimal.compareTo(BigDecimal.ZERO) &lt; 0) {
            return BigDecimal.valueOf(Double.NaN);
        }
        BigDecimal
                answer,     // The storage for the guesses.
                original,   // The result of squaring the guesses
                epsillon;   // The tolerance of this method.
        MathContext context = getContext(decimal, P_A_D);
        {
        /*
         * Obtain a good estimate of the square-root for the initial guess.
         * This is done by obtaining the &#34;top&#34; half of the bits of the decimal.
         */
            BigInteger integer = decimal.toBigInteger();
            answer = new BigDecimal
                             (integer.shiftRight(integer.bitLength() &gt;&gt;&gt; 1));
        }
        original = answer.multiply(answer);
        epsillon = getEpsillon(P_A_D);
        while (original.subtract(decimal).abs().compareTo(epsillon) &gt; 0) {
            answer = answer.subtract(original.subtract(decimal)
                                             .divide(TWO.multiply(answer),
                                                            context));
            original = answer.multiply(answer);
        }
        return answer.round(context);
    }

    public static BigDecimal getEpsillon(int precision) {
        return new BigDecimal(&#34;1E-&#34; + precision);
    }

    private static MathContext getContext(BigDecimal decimal, int precision) {
        int beforePoint = (decimal.toString()).indexOf(&#39;.&#39;);
        if (beforePoint == -1) beforePoint = decimal.toString().length();
        return new MathContext(beforePoint + precision);
    }
}
</code></pre><p>The output is the desired one:</p><pre><code>number = 91.91
sqrt(number) = 9.586970324351692703533
number = 91.91
</code></pre><p>Because I am quite happy with the result, I am determined to move ahead. Hence, I seek advice.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>As people are hinting in the comments, if you want to do this for the fun of doing it, that&#39;s one thing, but if you want a library of scientific functions to <em>use</em>, you should use one that&#39;s already been written by experts.  There&#39;s a list at <a href="http://en.wikipedia.org/wiki/Arbitrary-precision_arithmetic#Libraries">http://en.wikipedia.org/wiki/Arbitrary-precision_arithmetic#Libraries</a></p><p>The open-source libraries listed there are also a place to look for (if not find!) readable code.</p><p>Algorithms like this are part of <em>numerical analysis</em>; see Wikipedia for that, too.  The famous <a href="http://en.wikipedia.org/wiki/Numerical_Recipes">&#34;Numerical Recipes&#34;</a> books give both code and discussion for many kinds of calculations.</p><p>If you&#39;re talking about physical electronic calculators (as opposed to programs that are also called &#34;calculators&#34;), there are three reasons why I doubt you could use calculator code as a prototype for your arbitrary precision math library.</p><ul><li><p>I don&#39;t know of any calculator company that has released the software and hardware designs of its calculators.</p></li><li><p>I&#39;ve never heard of an electronic calculator with arbitrary precision arithmetic.  A typical scientific calculator has a fixed precision.  There will be no clue within the code how to extend a given function to a given larger precision (whereas the writers of, e.g., GNU MPFR will have solved these problems).  For instance, what precision intermediate results will it need?  How many more times will you need to go through the loops?  Is the algorithm one that will work reasonably fast, or will it slow down too much, as you add precision?</p></li><li><p>A given calculator may have very advanced math hardware (to do Taylor series for instance) or very primitive hardware (can&#39;t even multiply two-digit numbers).   The code will probably be hand-written machine code without more-readable source code.  You&#39;d need to understand and emulate both the functions of the hardware and code in your software.  An interesting hobby but maybe not the one you were thinking of.</p></li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-visualvm-sampling-accuracy/'>Java &#8211; VisualVM Sampling &#038; Accuracy</a></li><li class="list-group-item"><a href='../web-development-algorithms/'>Web Development Algorithms</a></li><li class="list-group-item"><a href='../how-to-measure-algorithm-accuracy/'>How to measure algorithm accuracy</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>