<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Maintaining a growing, diverse codebase with continuous integration &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082494 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082494" class="post-1082494 software type-software status-publish hentry category-software tag-continuous-integration"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Maintaining a growing, diverse codebase with continuous integration</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">continuous integration</span></p><div class="entry-content"><p>I am in need of some help with philosophy and design of a continuous integration setup.</p><p>Our current CI setup uses buildbot.  When I started out designing it, I inherited (well, not strictly, as I was involved in its design a year earlier) a bespoke CI builder that was tailored to run the entire build at once, overnight.  After a while, we decided that this was insufficient, and started exploring different CI frameworks, eventually choosing buildbot.  One of my goals in transitioning to buildbot (besides getting to enjoy all the whiz-bang extras) was to overcome some of the inadequacies of our bespoke nightly builder.</p><p>Humor me for a moment, and let me explain what I have inherited.  The codebase for my company is almost 150 unique c++ Windows applications, each of which has dependencies on one or more of a dozen internal libraries (and many on 3rd party libraries as well).  Some of these libraries are interdependent, and have depending applications that (while they have nothing to do with each other) have to be built with the same build of that library.  Half of these applications and libraries are considered &#34;legacy&#34; and unportable, and must be built with several distinct configurations of the IBM compiler (for which I have written unique subclasses of <code>Compile</code>), and the other half are built with visual studio.  The code for each compiler is stored in two separate Visual SourceSafe repositories (which I am simply handling using a bunch of <code>ShellCommand</code>s, as there is no support for VSS).</p><p>Our original nightly builder simply took down the source for everything, and built stuff in a certain order.  There was no way to build only a single application, or pick a revision, or to group things.  It would launched virtual machines to build a number of the applications.  It wasn&#39;t very robust, it wasn&#39;t distributable.  It wasn&#39;t terribly extensible.  I wanted to be able to overcame all of these limitations in buildbot.</p><p>The way I did this originally was to create entries for each of the applications we wanted to build (all 150ish of them), then create triggered schedulers that could build various applications as groups, and then subsume those groups under an overall nightly build scheduler.  These could run on dedicated slaves (no more virtual machine chicanery), and if I wanted I could simply add new slaves.  Now, if we want to do a full build out of schedule, it&#39;s one click, but we can also build just one application should we so desire.</p><p>There are four weaknesses of this approach, however.  One is our source tree&#39;s complex web of dependencies.  In order to simplify config maintenace, all builders are generated from a large dictionary.  The dependencies are retrieved and built in a not-terribly robust fashion (namely, keying off of certain things in my build-target dictionary).  The second is that each build has between 15 and 21 build steps, which is hard to browse and look at in the web interface, and since there are around 150 columns, takes forever to load (think from 30 seconds to multiple minutes).  Thirdly, we no longer have autodiscovery of build targets (although, as much as one of my coworkers harps on me about this, I don&#39;t see what it got us in the first place).  Finally, aformentioned coworker likes to constantly bring up the fact that we can no longer perform a full build on our local machine (though I never saw what that got us, either, considering that it took three times as long as the distributed build; I think he is just paranoically phobic of ever breaking the build).</p><p>Now, moving to new development, we are starting to use g++ and subversion (not porting the old repository, mind you &#8211; just for the new stuff).  Also, we are starting to do more unit testing (&#34;more&#34; might give the wrong picture&#8230; it&#39;s more like <strong>any</strong>), and integration testing (using python).  I&#39;m having a hard time figuring out how to fit these into my existing configuration.</p><p>So, where have I gone wrong philosophically here?  How can I best proceed forward (with buildbot &#8211; it&#39;s the only piece of the puzzle I have license to work on) so that my configuration is actually maintainable?  How do I address some of my design&#39;s weaknesses?  What really works in terms of CI strategies for large, (possibly over-)complex codebases?</p><p><strong>EDIT:</strong></p><p>I thought I explained my problem, but obviously I wasn&#39;t clear enough.  I am <em>not</em> looking for suggestions for changing CI platforms.  It is <strong>not</strong> going to happen, and answers suggesting that will not get accepted.  What I <em>want</em> to know is how other people manage complicated codebases using CI.  I have a <strong>dozen squared</strong> different products, and I have dependencies scattered to the wind, and they&#39;re all different.  THIS is what I want to know how to deal with.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Although I haven&#39;t faced a situation as bad as you describe, I have been maintaining a CI configuration with tens of components, between which there are some &#39;simple&#39; dependencies.  I hope that my approach may give you some hints with which to proceed.  The problem is definitely not related only to the choice of CI server, but also to the overall build process and project structure.</p><p>I shall break down the problem into 2 parts: Building and CI.</p><p><strong>Building</strong></p><p>For &#34;Building&#34; I means the process of, changing the source code on hand to the final artifact.  Our company mainly uses Java in development, and the build tool we used is Maven. You will probably unable to use that due to nature of your project, but there are some valuable concept in Maven worth noting:</p><p>1) In Maven world, each artifact (a lib, the real program etc) needs to be clearly isolated and decoupled.  Dependencies between artifact should be clear.  I should emphasize, messy dependency, especially circular dependencies between your build artifacts are going to make the build process a mess.</p><p>For example, I saw some java projects before that, although after whole build process there are several JARs (you may consider it as lib/dll in Java) built, they are in fact inter-dependent. Like, A.jar is using things in B.jar, and vice versa.  Such kind of &#39;modularization&#39; is totally meaningless. A.jar and B.jar always needs to be deployed and used together.  The implication is, later if you want to make them separated into different projects (for reuse in other projects for example), u will not be able to do so, coz you cannot determine which project, A or B, to build first.</p><p>Yes, it needs to be catered in your software&#39;s design, but I always believe that, instead of paying time to make a complicated building tools/model works in a messy project, I&#39;d rather spend time to reorganize the design to make use a simple building model.</p><p>2) Dependencies should be declarative.  There are lots of build process I saw before, which they includes all libs it needs locally in the project.  It will make build process extremely troublesome if some of the libs are in fact other artifacts that you need to build.</p><p>3) &#34;Centralized&#34; storage for the artifacts for getting dependencies, or to deploy artifacts once it is compiled.  It doesn&#39;t need to be &#34;centralized&#34; for whole office (it will be great if it is), just a local directory will already be fine.</p><p>More elaboration on 2 and 3. Just to give an example, I have come across a project that involved 3 independent projects.  The each project is built base on the source, plus the libs under the the lib/ directory in the source directory.  Project A will build several libs, which is in turn used by project B and C.  There are quite some drawbacks: build procedure is complicated and harder to automate; the source control is getting bloated with unnecessary duplicated JARs reused in different project</p><p>In Maven&#39;s world, what it is done is, project B and C do not really contains A.jar (and other dependencies, like other 3rd party lib) in the project source.  It is declarative. For example, in the build configuration of project B, it simply declare that it need: A.lib v1.0, xyz.lib v2.1 etc, and the build script will look up the lib from /A/1.0/A.jar and /xyz/2.1/xyz.lib</p><p>For non-Maven world, this artifact dir just need to be one or two directory with agreed directory structure.  You may put all 3rd party libs to a share location and let developers sync or copy to their local machines.  In my C++ projects I did many years before, what I am doing is setting the lib and header to ${artifact_dir}/lib_name/ver, and with artifact_id declared as environment variable.</p><p>When project A is built, it will have a copy of its result in that artifact_dir, so that when we build project B, B can get the result of A automatically, without manual copying.</p><p>4) Non mutable release.  Once you release A.lib 1.0, that&#39;s it, you won&#39;t expect A.lib 1.0&#39;s content change after 1 month just bcos there are some bug fixes.  In such case, it should be A.lib 1.1.  The artifact of a changing code base should consider a special &#34;version&#34;, for which in Maven we call it snapshot.</p><p>Non-mutable release is more an ethic issue.  But what it solved is clear: When u have lots of projects, using the same lib, u know which version of that lib you are using, and you will be sure that, same version of lib used in different projects, are indeed the same.  I think many of us have go thru the problem of:  Why project X and Y is both using lib A but the build result is different? (and turns out that the lib A using by X and Y is in fact different after digging into the content or file size of the lib).</p><hr/><p>All these ensure that your projects can build independently, without much manual tricks like, build project A first, copy A.lib to project B, and then build project B...</p><p>After going through an exercise like this, for example, when you build project A, it will try to get the dependencies from the centralized artifact storage.  In case some dependencies (which are other projects of your company, e.g. project B) is not found, what u need to do is, get the source of project B, build it (which will deploy to the centralized storage upon success), and then build project A again.</p><hr/><p><strong>CI</strong></p><p>With a easy build system, with clear dependencies, CI will be much easier.  I will expect your CI server serves the following requirement:</p><p>1) Monitor the source control, only checkout+build when there is changes in source</p><p>2) Able to setup dependencies between projects</p><p>With a clear dependency for projects, you simply need to setup projects in CI according to your actual projects, setup CI project dependency according to your projects&#39; dependency.  Your CI server should be set to build dependent projects before building any project (and of course, build only happens if the project source really have change).</p><p>If everything goes right, you should have a huge, complex, but still manageable CI (and even more important, a manageable project structure)</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../patterns-for-continuous-integration-and-dvcs/'>Patterns for Continuous Integration and DVCS</a></li><li class="list-group-item"><a href='../with-continuous-integration-in-net-is-it-acceptable-to-reference-dlls-of-rarely-changing-assemblies/'>With continuous integration in .NET, is it acceptable to reference DLLs of rarely-changing assemblies</a></li><li class="list-group-item"><a href='../responsibilities-of-build-script-and-build-server/'>Responsibilities of Build Script and Build Server</a></li><li class="list-group-item"><a href='../simple-explanation-of-continuous-integration/'>Simple explanation of Continuous Integration</a></li><li class="list-group-item"><a href='../continuous-integration-with-bamboo-and-maven-managing-version-numbers/'>Continuous Integration with Bamboo and Maven, Managing Version Numbers</a></li><li class="list-group-item"><a href='../continuous-integration-deployment-test-on-commit-pull-request-or-what/'>Continuous Integration / Deployment: Test on commit, pull request, or what</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>