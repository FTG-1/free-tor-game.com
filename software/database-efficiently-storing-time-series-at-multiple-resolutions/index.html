<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Database &#8211; Efficiently storing time series at multiple resolutions &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1083769 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1083769" class="post-1083769 software type-software status-publish hentry category-software tag-database tag-performance"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Database &#8211; Efficiently storing time series at multiple resolutions</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database</span><span class="mr-2 badge badge-info">performance</span></p><div class="entry-content"><h1>Introduction and context</h1><p>I am refactoring a system that stores energy data (gas/electricity consumption, electricity delivery). Data comes from a sensor that posts the absolute data every 15 minutes in a schema that is subject to change in the future (read: requires document storage).</p><h1>Current situation</h1><p>The raw data is stored in a MongoDB database. A background process reads this data, and converts it to structured delta data which is stored in a MySQL database, in different resolutions.</p><p>MongoDB schema:<br /> <code>| device_id (uint) | timestamp (ISODate) | data (unspecified object) |</code></p><p>MySQL schema: (multiple tables: <code>hour</code>, <code>day</code>, <code>month</code>, <code>year</code>)<br /> <code>| device_id (uint) | timestamp (datetime) | gas_consumption | electricity_consumption | ... |</code></p><p>If the MongoDB <code>data</code> field changes it&#39;s definition, the background process will detect the version of the data and process accordingly. The MySQL database may be recreated from the MongoDB data, possibly with a new schema (if the future may require it).</p><h1>Envisioned situation</h1><p>In the new situation, I&#39;d like to use a time series database (as this is suggested by lots of external parties). There are two features that I&#39;d like to implement on an atomic (database) level:</p><ul><li><strong>Gap filling for missing data.</strong> It is possible for the quarterly data to be missing a couple of points. Since the absolute values are known, this data should be filled linearly distributed.</li><li><strong>Storing different resolutions.</strong> The data will be queried over multiple resolutions (hour to year), and all of these queries should be fast.</li></ul><p>Requirements:</p><ul><li>Should scale up to one million devices (data input).</li><li>Should scale up to 50k concurrent users (data queries).</li><li>Aggregated data should be available as soon as possible. (up to 1 hour is acceptable)</li><li>Data may not deteriorate. (full history should be available at the highest resolution)</li><li>Old data may be updated (on the highest resolution, and that change should be reflected onto lower resolutions). This is very uncommon, but should be possible. (If this turns out to be a big issue, this requirement might be handled in another way, but that is not the preferred solution).</li><li>Free as in free beer.</li><li><strong>The data has to be accessible from NodeJS</strong>, since all code is written in NodeJS.</li><li>It would be preferable if the latest data point (the current year for example) would be filled with the sum of the previous tiers before it is over, otherwise this has to be requested from the quarters table. Example: on July 1st 2017 the data point for 2017 should contain the sum of the year up to that date, along with an indication of the elapsed time. (This is a nice to have).</li></ul><p>The typical query looks like this (pseudo-code):<br /> <code>SELECT &lt;fields&gt; BETWEEN &lt;start-date&gt; AND &lt;end-date&gt; WITH RESOLUTION &lt;time-resolution&gt;</code>.</p><h1>Current considerations</h1><p>I&#39;ve looked at some databases that support time series (InfluxDB, MongoDB, Graphite, RRDtool, Redis, OpenTSDB, &#8230;) but I can&#39;t find one that natively supports the different resolutions and/or the gap filling.</p><p>MongoDB might be an option, but the write is fire-and-forget, which means that missing data might not be detected. For the raw data, this is not an issue, as long as it doesn&#39;t happen very often. For the processed data, this is a big issue, as the rest of the application assumes that the data in those tables is sequential, even in a very uncommon edge case.</p><p>MySQL could also be an option (e.g. not changing the initial implementation), but I feel like the time series databases are optimized for time series database by a reason.</p><h1>Question</h1><p>Is the current situation a good approach? And if it isn&#39;t, what would be a better one? I feel like my use case is not that unique in the world of storing time series, but I can&#39;t seem to find any resource online that can give me a push in the right direction.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I worked on a similar application for the California Energy Commission (UT3, or <a href="http://www.utonline.org/" rel="nofollow noreferrer">Universal Translator</a> 3). A couple points:</p><ul><li>The &#34;filling in&#34; algorithm may not be correct mathematically. The data in question is typically average values. The correct way to resample in time, average value data, is to use a time weighted average. It is a type of integration.</li><li>On the other hand, you may have some instantaneous type data, that needs a different type of numerical integration. I suggest you study the mathematical properties needed more closely.</li><li>The best performance will come from using a custom database that stores only the original, non-resampled data, in a binary form. A &#34;custom database&#34; can consist of a set of read-only files, each of which contains a data stream. A time-series specific database is probably fast enough.</li><li>The re-sampling algorithms are fast enough that they can be performed in real-time on the client.</li><li>If the end user sampling frequency is much lower than the original data, of course it makes sense to cache the resampled streams on the server. Access to the original data makes client based designs (like Universal Translator) more appealing for some uses.</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-data-architecture-for-event-log-metrics/'>Database &#8211; Data architecture for event log metrics</a></li><li class="list-group-item"><a href='../database-options-for-data-analytics-for-time-series-store/'>Database &#8211; options for data analytics for time series store</a></li><li class="list-group-item"><a href='../database-how-to-efficiently-store-big-time-series-data/'>Database &#8211; How to efficiently store big time series data</a></li><li class="list-group-item"><a href='../database-when-should-we-use-mongodb/'>Database &#8211; When should we use MongoDB</a></li><li class="list-group-item"><a href='../database-what-time-series-database-can-support-high-cardinality/'>Database &#8211; What time series database can support high cardinality</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>