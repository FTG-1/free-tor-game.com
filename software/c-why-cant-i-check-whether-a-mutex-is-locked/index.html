<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Why can&#8217;t I check whether a mutex is locked &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1063757 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1063757" class="post-1063757 software type-software status-publish hentry category-software tag-c"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Why can&#8217;t I check whether a mutex is locked</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span></p><div class="entry-content"><p>C++14 seems to have omitted a mechanism for checking whether an <code>std::mutex</code> is locked or not. See this SO question:</p><p><a href="https://stackoverflow.com/questions/21892934/how-to-assert-if-a-stdmutex-is-locked">https://stackoverflow.com/questions/21892934/how-to-assert-if-a-stdmutex-is-locked</a></p><p>There are several ways around this, e.g. by using;</p><pre><code>std::mutex::try_lock()
std::unique_lock::owns_lock()
</code></pre><p>But neither of these are particularly satisfying solutions.</p><p><code>try_lock()</code> is permitted to return a false negative and has undefined behaviour if the current thread has locked the mutex. It also has side-effects. <code>owns_lock()</code> requires the construction of a <code>unique_lock</code> on top of the original <code>std::mutex</code>.</p><p>Obviously I could roll my own, but I&#39;d rather understand the motivations for the current interface.</p><p>The ability to check the status of a mutex (e.g. <code>std::mutex::is_locked()</code>) does not seem like an esoteric request to me, so I suspect the Standard Committee deliberately omitted this feature rather than it being an oversight.</p><p>Why?</p><p><strong>Edit:</strong> Ok so maybe this use case isn&#39;t as common as I had expected, so I&#39;ll illustrate my particular scenario. I have a machine learning algorithm which is distributed on multiple threads. Each thread operates asynchronously, and returns to a master pool once it has completed an optimisation problem.</p><p>It then locks a master mutex. The thread must then pick a new parent from which to mutate an offspring, but may only pick from parents which do not currently have offspring that are being optimised by other threads. I therefore need to perform a search to find parents that are not currently locked by another thread. There is no risk of the status of the mutex changing during the search, as the master thread mutex is locked. Obviously there&#39;s other solutions (I&#39;m currently using a boolean flag) but I thought the mutex offers a logical solution to this problem, as it exists for the purpose of inter-thread synchronization.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I can see at least two severe problems with the suggested operation.</p><p>The first one was already mentioned in a comment by @<a href="https://softwareengineering.stackexchange.com/users/123788/gnasher729">gnasher729</a>:</p><blockquote><p>You can&#39;t really reasonably check whether a mutex is locked, because one nanosecond after the check it can get unlocked or locked. So if you wrote <code>if (mutex_is_locked ()) …</code> then <code>mutex_is_locked</code> could return the correct result, but by the time the <code>if</code> is executed, it is wrong.</p></blockquote><p>The only way to be sure that the “is currently locked” property of a mutex doesn&#39;t change is to, well, lock it yourself.</p><p>The second problem I see is that unless you lock a mutex, your thread doesn&#39;t synchronize with the thread that had previously locked the mutex. Therefore, it isn&#39;t even well-defined to speak about “before” and “after” and whether the mutex is locked or not is kind of asking whether Schrödiger&#39;s cat is currently alive without attempting to open the box.</p><p>If I understand correctly, then both problems would be moot in your particular case thanks to the master mutex being locked. But this doesn&#39;t seem like a particularly common case to me so I think that the committee did the right thing by not adding a function that might be somewhat useful in very special scenarios and cause damage in all others. (In the spirit of: “Make interfaces easy to use correctly and difficult to use incorrectly.”)</p><p>And if I may say, I think that the setup you currently have is not the most elegant and could be refactored to avoid the problem altogether. For example, instead of the master thread checking all potential parents for one that is not currently locked, why not maintain a queue of ready parents? If a thread wants to optimize another one, it pops the next one off the queue and as soon as it has new parents, it adds them to the queue. That way, you don&#39;t even need the master thread as a coordinator.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-whether-to-use-pedantic-flag-in-g-or-not/'>C++ &#8211; Whether to use -pedantic flag in g++ or not</a></li><li class="list-group-item"><a href='../c-why-cant-a-compiler-avoid-importing-a-header-file-twice-by-its-own/'>C++ &#8211; Why can&#8217;t a compiler avoid importing a header file twice by its own</a></li><li class="list-group-item"><a href='../c-why-cant-we-declare-extern-c-for-c-macros/'>C++ &#8211; Why can&#8217;t we declare &#8216;extern C&#8217; for C++ macro&#8217;s</a></li><li class="list-group-item"><a href='../c-opengl-multithreading-and-throwing-destructors/'>C++ &#8211; OpenGL, multithreading, and throwing destructors</a></li><li class="list-group-item"><a href='../c-in-qt-or-c-how-should-i-check-whether-the-int-variable-has-been-defined/'>C++ &#8211; In Qt or C++, how should I check whether the `int` variable has been defined</a></li><li class="list-group-item"><a href='../c-how-to-test-and-benchmark-mutex-implementations/'>C++ &#8211; How to test and benchmark mutex implementations</a></li><li class="list-group-item"><a href='../c-how-to-check-whether-existing-code-base-can-deadlock/'>C++ &#8211; How to check whether existing code base can deadlock</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>