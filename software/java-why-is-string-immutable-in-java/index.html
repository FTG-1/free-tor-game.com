<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Why is String immutable in Java &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1064125 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1064125" class="post-1064125 software type-software status-publish hentry category-software tag-immutability tag-java tag-language-design tag-programming-languages tag-strings"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Why is String immutable in Java</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">immutability</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">language-design</span><span class="mr-2 badge badge-primary">programming-languages</span><span class="mr-2 badge badge-danger">strings</span></p><div class="entry-content"><p>I couldn&#39;t understand the reason of it. I always use String class like other developers, but when I modify the value of it, new instance of String created.</p><p>What might be the reason of immutability for String class in Java?</p><p>I know there are some alternatives like StringBuffer or StringBuilder. It&#39;s just curiosity.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h2>Concurrency</h2><p>Java was defined from the start with considerations of concurrency. As often been mentioned shared mutables are problematic. One thing can change another behind the back of another thread without that thread being aware of it.</p><p>There are a host of multithreaded C++ bugs that have croped up because of a shared string - where one module thought it was safe to change when another module in the code had saved a pointer to it and expected it to stay the same.</p><p>The &#39;solution&#39; to this is that every class makes a defensive copy of the mutable objects that are passed to it. For mutable strings, this is O(n) to make the copy.  For immutable strings, making a copy is O(1) because it isn&#39;t a copy, its the same object that can&#39;t change.</p><p>In a multithreaded environment, immutable objects can always be safely shared between each other.  This leads to an overall reduction in memory usage and improves memory caching.</p><h2>Security</h2><p>Many times strings are passed around as arguments to constructors - network connections and protocals are the two that most easily come to mind.  Being able to change this at an undetermined time later in the execution can lead to security issues (the function thought it was connecting to one machine, but was diverted to another, but everything in the object looks like it connected to the first... its even the same string).</p><p>Java lets one use reflection - and the parameters for this are strings.  The danger of one passing a string that can get modified through the way to another method that reflects.  This is very bad.</p><h2>Keys to the Hash</h2><p>The hash table is one of the most used data structures.  The keys to the data structure are very often strings.  Having immutable strings means that (as above) the hash table does not need to make a copy of the hash key each time.  If strings were mutable, and the hash table didn&#39;t make this, it would be possible for something to change the hash key at a distance.</p><p>The way the Object in java works, is that everything has a hash key (accessed via the hashCode() method). Having an immutable string means that the hashCode can be cached.  Considering how often Strings are used as keys to a hash, this provides a significant performance boost (rather than having to recalculate the hash code each time).</p><h2>Substrings</h2><p>By having the String be immutable, the underlying character array that backs the data structure is also immutable.  This allows for certain optimizations on the <code>substring</code> method the be done (they aren&#39;t <em>necessarily</em> done - it also introduces the possibility of some memory leaks too).</p><p>If you do:</p><pre><code>String foo = &#34;smiles&#34;;
String bar = foo.substring(1,5);
</code></pre><p>The value of <code>bar</code> is &#39;mile&#39;.  However, both <code>foo</code> and <code>bar</code> can be backed by the same character array, reducing the instantiation of more character arrays or copying it - just using different start and end points within the string.</p><pre>foo |    | (0, 6)
    v    v
    smiles
     ^  ^
bar  |  |  (1, 5)
</pre><p>Now, the downside of that (the memory leak) is that if one had a 1k long string and took the substring of the first and second character, it would also be backed by the 1k long character array.  This array would remain in memory even if the original string that had a value of the entire character array was garbage collected.</p><p>One can see this in <a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/6-b14/java/lang/String.java">String from JDK 6b14</a> (the following code is from a GPL v2 source and used as an example)</p><pre><code>   public String(char value[], int offset, int count) {
       if (offset &lt; 0) {
           throw new StringIndexOutOfBoundsException(offset);
       }
       if (count &lt; 0) {
           throw new StringIndexOutOfBoundsException(count);
       }
       // Note: offset or count might be near -1&gt;&gt;&gt;1.
       if (offset &gt; value.length - count) {
           throw new StringIndexOutOfBoundsException(offset + count);
       }
       this.offset = 0;
       this.count = count;
       this.value = Arrays.copyOfRange(value, offset, offset+count);
   }

   // Package private constructor which shares value array for speed.
   String(int offset, int count, char value[]) {
       this.value = value;
       this.offset = offset;
       this.count = count;
   }

   public String substring(int beginIndex, int endIndex) {
       if (beginIndex &lt; 0) {
           throw new StringIndexOutOfBoundsException(beginIndex);
       }
       if (endIndex &gt; count) {
           throw new StringIndexOutOfBoundsException(endIndex);
       }
       if (beginIndex &gt; endIndex) {
           throw new StringIndexOutOfBoundsException(endIndex - beginIndex);
       }
       return ((beginIndex == 0) &amp;&amp; (endIndex == count)) ? this :
           new String(offset + beginIndex, endIndex - beginIndex, value);
   }
</code></pre><p>Note how the substring uses the package level String constructor that doesn&#39;t involve any copying of the array and would be much faster (at the expense of possibly keeping around some large arrays - though not duplicating large arrays either).</p><p>Do note that the above code is for Java 1.6.  The way the substring constructor is implemented was changed with Java 1.7 as documented in <a href="http://java-performance.info/changes-to-string-java-1-7-0_06/">Changes to String internal representation made in Java 1.7.0_06 </a> - the issue bing that memory leak that I mentioned above.  Java likely wasn&#39;t seen as being a language with lots of String manipulation and so the performance boost for a substring was a good thing.  Now, with huge XML documents stored in strings that are never collected, this becomes an issue... and thus the change to the <code>String</code> not using the same underlying array with a substring, so that the larger character array may be collected more quickly.</p><h2>Don&#39;t abuse the Stack</h2><p>One <em>could</em> pass the value of the string around instead of the reference to the immutable string to avoid issues with mutability.  However, with large strings, passing this on the stack would be... abusive to the system (putting entire xml documents as strings on the stack and then taking them off or continuing to pass them along...).</p><h2>The possibility of deduplication</h2><p><sub>Granted, this wasn&#39;t an initial motivation for why Strings should be immutable, but when one is looking at the rational of why immutable Strings are a good thing, this is certainly something to consider.</sub></p><p>Anyone who has worked with Strings a bit knows that they can suck memory. This is especially true when you&#39;re doing things like pulling data from databases that sticks around for awhile. Many times with these stings, they are the same string over and over again (once for each row).</p><blockquote><p>Many large-scale Java applications are currently bottlenecked on memory. Measurements have shown that roughly 25% of the Java heap live data set in these types of applications is consumed by String objects. Further, roughly half of those String objects are duplicates, where duplicates means string1.equals(string2) is true. Having duplicate String objects on the heap is, essentially, just a waste of memory. ...</p></blockquote><p>With Java 8 update 20, <a href="http://openjdk.java.net/jeps/192">JEP 192</a> (motivation quoted above) is being implemented to address this. Without getting into the details of how string deduplication works, it is essential that the Strings themselves are immutable. You can&#39;t deduplicate StringBuilders because they can change and you don&#39;t want someone changing something from under you. Immutable Strings (related to that String pool) means that you can go through and if you find two strings that are the same, you can point one string reference to the other and let the garbage collector consume the newly unused one.</p><h2>Other languages</h2><p>Objective C (which predates Java) has <code>NSString</code> and <code>NSMutableString</code>.</p><p>C# and .NET made the same design choices of the default string being an immutable.</p><p><a href="http://lua-users.org/wiki/ImmutableObjects">Lua</a> strings are also immutable.</p><p><a href="https://docs.python.org/3/library/stdtypes.html#text-sequence-type-str">Python</a> as well.</p><p>Historically, Lisp, Scheme, Smalltalk all <a href="http://en.wikipedia.org/wiki/String_interning">intern the string</a> and thus have it be immutable. More modern dynamic languages often use strings in some way that requires that they be immutable (it may not be a <em>String</em>, but it is immutable).</p><h2>Conclusion</h2><p>These design considerations have been made again and again in a multitude of languages.  It is the general consensus that immutable strings, for all of their awkwardness, are better than the alternatives and lead to better code (fewer bugs) and faster executables overall.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-why-doesnt-java-8-include-immutable-collections/'>Java &#8211; Why doesn&#8217;t Java 8 include immutable collections</a></li><li class="list-group-item"><a href='../how-to-make-complex-objects-immutable/'>How to make complex objects immutable</a></li><li class="list-group-item"><a href='../c-immutable-string-in-array-reference-type-vs-value-type/'>C# &#8211; immutable string in array, reference type vs value type</a></li><li class="list-group-item"><a href='../java-changing-the-value-of-string-object-in-java/'>Java &#8211; changing the value of String object in java</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>