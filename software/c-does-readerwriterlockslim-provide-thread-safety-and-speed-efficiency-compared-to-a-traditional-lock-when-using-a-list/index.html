<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Does ReaderWriterLockSlim provide thread safety and speed efficiency (compared to a traditional lock) when using a List &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074197 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074197" class="post-1074197 software type-software status-publish hentry category-software tag-c tag-concurrency tag-locks"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Does ReaderWriterLockSlim provide thread safety and speed efficiency (compared to a traditional lock) when using a List</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">concurrency</span><span class="mr-2 badge badge-warning">locks</span></p><div class="entry-content"><p>I have a list, to which I write once in every update Loop and then I spawn some tasks which create read that List and create a duplicate to manipulate that data.<br /> More or less it&#39;s <code>List.ToList()</code> call to create a new list instead of using it by reference. Each task manipulates that data in it&#39;s own and produces it&#39;s results.<br /> Currently I am using a traditional lock in the form of</p><pre><code>lock(LockObject){
//write stuff
}
</code></pre><p>when writing and</p><pre><code>lock(LockObject){
localList=List.ToList();
}
</code></pre><p>when reading.</p><p>Would using the <code>ReaderWriterLockSlim</code> object instead of the way I am doing it now provide me with any benefits speed-wise? Also is the <code>ToList()</code> method considered a read in this case?</p><p><strong>Clarification Edit</strong></p><ol><li>The readers create a copy because they manipulate the data<br /> differently, each one of them removes or adds data to the List on<br /> their own way. (some might add previous data they still need while<br /> others remove data they do not need. Also the update loop occurs<br /> once every few seconds so it is common.</li><li>Sometimes if the data input is really fast an update/write loop might start before all the readers have completed their processing (but if they get the updated data instead is no problem for me).</li><li>Basically the readers are there for presenting current data to<br /> others. So if data is changed before they even start presenting them<br /> that&#39;s ok. As long as they do not try to process data while they are<br /> being update (which would probably throw an exception)</li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It depends. Using a reader/writer lock rather than a critical section can be beneficial if read operations are noticeably more common than write operations. But I think you could probably achieve more by changing your application architecture.</p><p>If writes are rare, you can probably get much better performance by treating the collection as immutable and producing an entirely new list when it changes. You can then use <a href="https://msdn.microsoft.com/en-us/library/bb297966(v=vs.110).aspx" rel="nofollow">Interlocked.CompareExchange</a> to update the reference to the list in a thread-safe way. This should prevent readers needing to make a defensive copy (which should be a huge win if reading is more common than writing) and remove the need for locking.</p><p>Alternatively, if writing is more common than reading, it may be worth evaluating a ConcurrentStack as a replacement for the list. This provides an atomic ToArray method that can be used to make copies without needing locks. Alternatively, if order isn&#39;t important in your list, a ConcurrentBag may perform better.</p><p><em>Edit after clarification</em></p><p>I still think you would be better off copying the list when you modify it, as this allows you to do away with the lock entirely. Even if the readers need to change the list contents during processing, this would be better refactored to use a streaming style, e.g. LINQ to Objects, so that these operations do not actually duplicate the data. See Martin Fowler <a href="http://martinfowler.com/articles/refactoring-pipelines.html" rel="nofollow">Refactoring with Loops and Collection Pipelines</a> for more about converting existing code to this style.</p><p>Failing that, I imagine you&#39;d see a small gain switching to the reader/writer lock, but unless lock contention is unusually problematic for your application I doubt it&#39;ll be noticeable.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-explain-why-multi-threading-is-difficult/'>How to explain why multi-threading is difficult</a></li><li class="list-group-item"><a href='../java-algorithm-to-create-custom-concurrenthashmap/'>Java &#8211; Algorithm to create custom ConcurrentHashMap</a></li><li class="list-group-item"><a href='../c-accessing-shared-data-without-blocking-in-tpl/'>C# &#8211; Accessing shared data without blocking in TPL</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>