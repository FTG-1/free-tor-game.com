<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Synchronization of data across microservices &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076559 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076559" class="post-1076559 software type-software status-publish hentry category-software tag-domain-driven-design tag-message-queue tag-microservices tag-synchronization"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Synchronization of data across microservices</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">domain-driven-design</span><span class="mr-2 badge badge-info">message-queue</span><span class="mr-2 badge badge-warning">microservices</span><span class="mr-2 badge badge-primary">synchronization</span></p><div class="entry-content"><p>We have 2 to 3 dozen microservices that serve our customers.<br /> These services are deployed in a Kubernetes cluster, and they&#39;re only accessible to the outside world through 3 or 4 API gateways.</p><p>We found that sometimes the same data is needed by two or more microservices, so we evaluated a couple of strategies to solve this problem and have implemented a solution in pieces.<br /> Like any design, we are not 100% sure if we&#39;re using the right approach, and whether we&#39;re missing potential pitfalls in the design.</p><p><strong>Case 1:</strong><br /> When a service of lesser business importance <code>ServiceL</code> needs data from a service of higher business importance <code>ServiceH</code>, then<br /> <code>ServiceL</code> calls <code>ServiceH</code> directly to get the necessary data.</p><p><strong>Case 2:</strong><br /> When a service of lesser business importance <code>ServiceL</code> needs data from many important services <code>ServiceH1</code>, <code>ServiceH2</code>, etc), then<br /> <code>ServiceH1</code>, <code>ServiceH2</code> publish messages with that data to RabbitMQ.<br /> The publishing of messages is fire-and-forget, so the services are not blocked.<br /> <code>ServiceL</code> subscribes to these messages and stores the data in its own data store.<br /> We are okay with the delay in the data becoming available to <code>ServiceL</code>.</p><p><strong>Case 3:</strong><br /> When a service of higher business importance <code>ServiceH</code> needs data from a less-important service <code>ServiceL</code>, then <code>ServiceL</code> publishes a message with that data to RabbitMQ via a fire-and-forget or blocking mechanism, depending on urgency of syncing the data.<br /> <code>ServiceH</code> consumes the message and stores it in its data store.<br /> Often the data is needed by <code>ServiceH</code> for reports and summary, and we are okay with the summary not being perfectly up to date at all times (eventually consistent) .</p><p><strong>Case 4:</strong><br /> When data is needed by two services and both of them not only read data but also modify it, then we believe the domain identification is wrong in which case we redesign them, often merging these two microservices into one.</p><p><strong>Additional Info for Case 2 &amp; 3:</strong><br /> Now when we use a messaging framework like RabbitMQ for syncing data across services, over a period of time we observed data is getting out of sync between services.<br /> When data gets out of sync, we could see the statistics from RabbitMQ and replay messages, but we believe this brings in unnecessary complexity.<br /> We&#39;ve ended up running jobs once a day to sync the data from the source service to the destination service, where the data is retrieved from the applicable services and not directly from their data stores.</p><p>Is this a good approach to sync data between microservices? Are there any pitfalls?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I would take a look at one of Microsoft&#39;s newer projects code named &#34;<a href="https://github.com/Microsoft/AMBROSIA" rel="nofollow noreferrer">Ambrosia</a>&#34; <em>(link will take you to their Github page where the project is being developed open source)</em> which focuses on providing a solution to this exact problem and several other major data consistency problems when developing distributed services.</p><p>The cliff-notes version is that they provide <strong><em>Virtual Resiliency</em></strong> which they desribe as the holding the following meaning:</p><blockquote><p>Virtual Resiliency is a mechanism in a (possibly distributed) programming and execution environment, typically employing a log, which exploits the replayably deterministic nature and serializability of an application to automatically mask failure.</p></blockquote><p>With one of the key benefits of utilizing the Ambrosia project being, that you are then provided with a layer of abstraction over the top of all the Transient Fault handling and Data Consistency problems, which are encountered thanks to the transport layer&#39;s reliability! This means that your developers <strong>DO NOT</strong> have to write any fault handling or data consistency into your code base as the underlying Ambrosia framework manages all of those cross cutting issues, as well as handling reconnecting any disconnected connections <em>(tunnels, ssh, etc).</em></p><p>All of the information below, is taken straight from the project&#39;s Github page, and you can thus find this information and much, much more detailed sample use cases, etc. by following the link in the first paragraph above! I hope that this helps you guys out! It has been working great for the projects I currently am running in cloud native context!</p><hr/><h2>How it works</h2><blockquote><p>The figure below outlines the basic architecture of an AMBROSIA application, showing two communicating AMBROSIA services, called Immortals. Each inner box in the figure represents a separate process running as part of the Immortal. Each instance of an Immortal exists as a software object and thread of control running inside of an application process. An Immortal instance communicates with other Immortal instances through an Immortal Coordinator process, which durably logs the instance&#39;s RPCs and encapsulates the low-level networking required to send RPCs. The position of requests in the log determines the order in which they are submitted to the application process for execution and then re-execution upon recovery. <a href="../../../i.stack.imgur.com/tkdMz.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/tkdMz.png" alt="The Ambrosia System Architecture"/></a></p></blockquote><h2>Ambrosia Architecture</h2><blockquote><p>In addition, the language specific AMBROSIA binding provides a state serializer. To avoid replaying from the start of the service during recovery, the Immortal Coordinator occasionally checkpoints the state of the Immortal, which includes the application state. The way this serialization is provided can vary from language to language, or even amongst bindings for the same language.</p></blockquote></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../messaging-between-microservices-on-aws/'>Messaging between microservices on AWS</a></li><li class="list-group-item"><a href='../database-the-proper-way-to-synchronize-data-across-microservices/'>Database &#8211;  the proper way to synchronize data across microservices</a></li><li class="list-group-item"><a href='../microservices-and-master-data-management-are-they-compatibile/'>Microservices and &#8220;Master Data Management&#8221; &#8211; are they compatibile</a></li><li class="list-group-item"><a href='../design-how-to-handle-shared-data-across-microservices/'>Design &#8211; How to handle shared data across microservices</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>