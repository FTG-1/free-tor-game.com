<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Populate User info between services on microservices architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074042 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074042" class="post-1074042 software type-software status-publish hentry category-software tag-angularjs tag-django tag-microservices"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Populate User info between services on microservices architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">angularjs</span><span class="mr-2 badge badge-info">django</span><span class="mr-2 badge badge-warning">microservices</span></p><div class="entry-content"><p>I&#39;m working on a microservices architecture which contains a couple a REST API as a services and a SPA as an interface. In addition, there are an &#34;special&#34; (is not speacial at all, it just special because without auth you can&#39;t use the rest of APIs) API which performs authentication and manage Users info. The rest of services stores information about who has perform some action storing the <code>user_id</code>.</p><p>The problem is that I want to transform this <code>user_id</code> into a &#34;username&#34; or &#34;Name + Surname&#34; or something like that on web views. This info is &#34;owned&#34; by authentication service. I saw <a href="https://softwareengineering.stackexchange.com/questions/277011/how-do-you-handle-shared-concepts-in-a-microservice-architecture">this question</a> but I need more specific response. Some options could be:</p><ul><li><p>On SPA request authentication service to get user information. The only way I can imagine to get this done is to create an endpoint to get all users info with just one request and then replace it on views on a generic way. The problem is, that &#34;generic way&#34; to replace it is that simple. I addition, I am coupling a service views with authentication service.</p></li><li><p>On server side requesting authentication service and replacing <code>user_id</code> with a complete <code>User</code> object. I don&#39;t know how to do that because request another service synchronously breaks microservices creating a bottleneck. So, maybe something like a intermediate Redis with user info shared between microservices? If so, how update it with new information? And it is a bad practice to share a database between microservices, isn&#39;t it?</p></li></ul><p>Which is the best option? How can I implement it?</p><p>EDIT: The question is more about how to get all the users info not the logged in user info.</p><p>For example: I have a <code>Video</code> model with comments and each comment has been made by an user. So the &#34;Video service&#34; return the comments with a <code>user_id</code> associated and I want to show the user name instead of the <code>user_id</code> on web views for all comments.</p><p>All microservices involved are using MySQL.</p><p>In addition, I&#39;m already using JWT and I get all the information need it from the JWT body. The question is how to get the rest users info when he &#34;is watching a video&#34;.</p><p>The authentication service contains just username and email, so I don&#39;t want to create another service to store this information. So the second option where I mention a Redis as a intermediate database I mean, that the authentication service have MySQL as his own database and can (don&#39;t know how) publish certainly info about users to a Redis share between services.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It should depend on the way the data is <em>stored</em> and <em>used</em>.</p><p><strong>Storage:</strong></p><ul><li><p>Some architectures will have a separate database for accounts, and another one for user information. This makes particularly sense in a context where you have to store a lot of personal information: not just the list of e-mails and first and last names, but also phone numbers, addresses, name of the person to contact in case of emergency, pet&#39;s name and age... you name it. Polluting the authentication database with this information may not be a good idea: separating both will make it possible to easily upgrade the first without affecting the second.</p></li><li><p>Others would combine both. If you store only sparse information about the users, it may not make sense to have a dedicated service just to serve three to four fields. Without impacting performance too much, the authentication service may include person&#39;s information in the response.</p></li></ul><p><strong>Usage:</strong></p><ul><li><p>Sometimes, the only thing the applications would care is to know if the user is legitimate, as well as sticking an ID to the user (especially for audit purposes). For instance, if your service is hosting videos uploaded by the user, in most cases the only thing you care about is the user&#39;s IDâ€”to know which videos belong to the user and to log that the user accessed those videos, used that much traffic, and should later pay that much for the service usage. When and if you actually need personal information (such as sending a permalink to the video to the user by e-mail), you can easily query a different web service for that.</p></li><li><p>In other cases, it may make little sense to just authenticate a user without knowing at least her name.</p></li></ul><p>Sometimes, you&#39;ll need to use a mixed approach. You will have two web services, one for authentication, and another one containing personal information, and you&#39;ll add a third service which will call the other two to provide aggregated info. Without knowing the internals of Google infrastructure, I would imagine that this is how Google&#39;s OAuth service works.</p><p>In a case of a web application showing, among other content, the names of users, there are three possible approaches we&#39;ve identified through the comments and in our chat discussion:</p><ul><li><p>Send HTML template to the user, letting the browser to do one AJAX request per person to fill the info such as the pseudonym or the first and last name.</p><p>This approach has the benefits of being straightforward in AngularJS, and allows aggressive client-side caching, and doesn&#39;t require any additional server-side programming (AJAX calls lead directly to the web service).</p><p>However, there is a huge drawback: scalability. It may work well if you have, say, half a dozen persons on a page. On the other hand, if you expect (and according to the chat discussion, you do) dozens of persons, this means dozens of AJAX requests. Browsers do (or rather <a href="https://stackoverflow.com/a/985704/240613">did, in 2009</a>) a bad job at doing a lot of requests in parallel, so this could quickly become an issue. Additionally, clients may be using a crappy PC with a crappy internet connection, or may even be visiting your website from a six-years old smartphone from Himalayas.</p></li><li><p>Send HTML template to the user, letting the browser to request in a single AJAX request the data about all the persons which figure on the page.</p><p>The benefit is to do one request instead of a few dozens.</p><p>The drawbacks, however, are that caching is very difficult to impossible to implement, and that you&#39;ll end up with very long and weird URIs such as <a href="http://example.com/persons/2,7,14,...,541" rel="noreferrer">http://example.com/persons/2,7,14,...,541</a>.</p></li><li><p>Do the query to the web service server-side, i.e. from the web application itself, and aggregate the results within the HTML.</p><p>I would personally chose this approach. Making dozens of small calls to the web service within the same data center <a href="https://softwareengineering.stackexchange.com/a/275741/6605">wouldn&#39;t matter performance-wise</a>. Additionally, you can do them in parallel (map-reduce), asynchronously, while performing some other actions needed to render the HTML page.</p><p>The only drawback I can see here is that the person&#39;s data won&#39;t be cached on client side (i.e. the HTML content would be considered dynamic). I can hardly imagine <em>that</em> being an actual bottleneck.</p></li></ul><p>A few notes:</p><blockquote><p>I don&#39;t know how to do that because request another service synchronously breaks microservices creating a bottleneck.</p></blockquote><p>Then you call it asynchronously, and handle failure (with timeouts among others); this is actually what microservices architecture is all aboutâ€”to make services call each other, while avoiding bottlenecks. <em>Building Microservices</em> book by Sam Newman explains those aspects in detail in chapter 11: <em>Microservices at scale</em>, and introduces the concept of circuit breakers which prevent one faulty or slow service from affecting the performance of all the services and applications which rely on it.</p><p>One benefit of well-designed microservices architecture is that the overall system can still work if one or several services are unavailable. For instance, if the comments service used on an e-commerce website stops working, this shouldn&#39;t prevent you from selling products, which includes showing product pagesâ€”without users&#39; comments, obviouslyâ€”as well as providing the cart and the shipment and paying features.</p><p>Note that if the called service is too slow, you may need to scale it. In order to scale it horizontally, you need to call it through a reverse proxy.</p><blockquote><p>I have a Video model with comments and each comment has been made by an user. So the &#34;Video service&#34; return the comments with a <code>user_id</code> associated and I want to show the user name instead of the <code>user_id</code> on web views for all comments.</p></blockquote><p>This is exactly the case where you can query a web service from another one. If you have a web service which handles the comments, one approach is to return just the IDs of the authors in the response; another approach is to aggregate this data with the information from person&#39;s service to have not just the IDs of the authors, but also, for instance, their first and last names, as well as the URI of their avatar.</p><p>In the case of a web application, you <em>have</em> to provide aggregated data. Giving simply the IDs of the authors and expecting the browser to do AJAX requests to retrieve the first and last names of every user is crazy: simply provide this information directly in order to have decent client-side performance and to avoid wasting client&#39;s bandwidth.</p><blockquote><p>And it is a back practice to share a database between microservices, isn&#39;t it?</p></blockquote><p>The mainstream opinion is that yes, sharing the database between multiple services is a bad idea. Although one may disagree with this opinion, in your specific case, I don&#39;t see any reason to share the database.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-communication-between-microservices-distinguishing-internal-calls-safely/'>Architecture &#8211; Communication between microservices &#8211; distinguishing internal calls safely</a></li><li class="list-group-item"><a href='../user-related-logging-in-the-microservices-architecture/'>User-related logging in the microservices architecture</a></li><li class="list-group-item"><a href='../user-registration-flow-in-microservices/'>User registration flow in microservices</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>