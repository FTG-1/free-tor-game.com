<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Is the strong exception safety guarantee with a pass-by-value argument which can throw on destruction possible &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085312 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085312" class="post-1085312 software type-software status-publish hentry category-software tag-c tag-error-handling tag-exception-handling tag-exceptions"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Is the strong exception safety guarantee with a pass-by-value argument which can throw on destruction possible</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">error handling</span><span class="mr-2 badge badge-warning">exception handling</span><span class="mr-2 badge badge-primary">exceptions</span></p><div class="entry-content"><p>Suppose you have a type with a throwing destructor, and a function receiving it by value.<br /> Can that operation ever provide anything better than the basic exception guarantee?<br /> Or formulated differently, may one disregard the destruction of the argument which was passed by value when determining whether an operation has commmit-and-rollback-semantics?</p><pre><code>#include &lt;cstdlib&gt;

struct X {
    ~X() noexcept(0) {
        if(rand()%6 == 0) throw 0;
    }
    // some state
};

void update(database db, X arg) noexcept;

X x;
update(db, x);
</code></pre><p>Personally, based on <a href="https://en.wikipedia.org/wiki/Exception_safety" rel="nofollow">the definition from wikipedia</a></p><blockquote><ol start="2"><li><strong>Strong exception safety</strong>, also known as <strong>commit or rollback semantics</strong>: Operations can fail, but failed operations are guaranteed to have no side effects, so all data retain their original values</li></ol></blockquote><p>I don&#39;t think it&#39;s useful to describe <code>update</code> as being strongly exception-safe, even though <em>the function itself</em> cannot even throw.</p><p>I would appreciate either someone showing me the folly of my current understanding, or giving a better argument.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I&#39;m not really sure in retrospect, but if <code>update</code> was generic or if <code>X</code> was abstract (ex: cloned and destroyed) -- i.e., if <code>update</code> could not know anything concrete about <code>X</code>, then for all practical purposes I&#39;d describe it as having a strong exception-safety guarantee. At the very least that&#39;s as close to a strong exception-safety guarantee you&#39;ll ever get in an abstract context without x-raying a data type.</p><p>However, <code>X</code> is concrete, so that makes this question a lot more fuzzy. I&#39;m still tempted to say that <code>update</code> &#34;has a strong exception safety guarantee&#34; since it is doing everything it can possibly do to enforce it. Does that sound like crazy talk? It does to me, but I can&#39;t really put it much better.</p><p>Especially in the context of a team environment where one author implements <code>update</code> and the other implements <code>X</code>, nothing could ever provide a strong exception-safety guarantee since <code>X</code> could be modified in ways that breaks the guarantee in ways completely beyond the control of <code>update</code>. For practical purposes, I think if <code>update</code> does everything it possibly can and should to roll back its own side effects in exceptional paths, it practically provides a strong exception safety guarantee.</p><p>Otherwise the strong exception safety guarantee becomes something impractical to ever provide in so many scenarios. Things could change outside the function&#39;s control. Things could be abstract in ways beyond the function&#39;s knowledge. The whole guarantee would be almost impossible to provide anywhere. In that case might we say that the strong exception guarantee of <code>update</code> propagates a responsibility to <code>X</code> to comply, or is it <code>update</code> that is required to know how <code>X</code> will be implemented at all times? I don&#39;t know. This is all very impractical either way, and I don&#39;t like impracticalities.</p><p>So I&#39;m gonna go with the crude, yeah, <em>&#34;<code>update</code> is exception-safe, but <code>X</code> gone fubar and messed up everything. It&#39;s not <code>update&#39;s</code> fault at least. Don&#39;t sue the author of update! Sue the author of <code>X</code>!&#34;</em>. I&#39;d like to describe <code>X</code> as simply being fubar here, and <code>update</code> as possibly providing a strong exception safety guarantee which is being screwed by the fact that <code>X</code> is fubar. That is, unless there is a very hard interface-level understanding that <code>X&#39;s</code> destructor is designed to throw, in which case I have no idea how to describe it except as a &#34;big problem&#34;. I think we need some fine print and disclaimers to come with these guarantees. <em>update provides a strong exception-safety guarantee provided that [...]. No refunds if this is not the case!</em></p><p>This is like a philosophical question to me, interesting to think about but maybe one with no perfect answer. And what are guarantees anyway? Can we guarantee anything? I might guarantee that drinking beer would make me drunk and that could seem true all the time, but what if an extraterrestrial intervenes and uses some kind of alien technology which makes me sober no matter how much I drink? I can&#39;t <em>guarantee</em> that this won&#39;t happen. I can only say that this is highly improbable and that if such event were to happen, I would be powerless against it. I did my part. I drank my beer. I&#39;m supposed to get drunk. I strongly guarantee it. But it&#39;s not for certain. There&#39;s always some probability, however astronomically remote, that the guarantee might not hold true. How about thread safety? Well, what if the alien spaceship comes and zaps our hardware and rearranges instructions in memory such that a formely thread-safe function is now no longer thread-safe at runtime? I can&#39;t guarantee that this won&#39;t happen. But I will guarantee thread-safety regardless without even going into such fine print about alien space ships, because it makes people feel nice and reassured, and what I&#39;m saying is that I&#39;m doing everything within my power and knowledge to enforce that guarantee.</p><p>Descartes once said, &#34;I think therefore, I am.&#34; How does he know? What if he isn&#39;t? He could be an &#34;am not&#34; but perhaps &#34;nots&#34; can &#34;think&#34;. I don&#39;t even know if I exist. What does thinking even mean anyway? It&#39;s like a word people use to describe some process that appears to go on introspectively and appears as though we, who may not even exist, are making decisions.</p><p>What if we are all just bits and bytes on some machine? Like that blonde or brunette in the Matrix. By the way, how can a blonde or especially brunette be stored in such a small stream of characters? Are they like UTF2048? It was some kind of alien stream of characters but there didn&#39;t appear to be too many unique characters. Perhaps it&#39;s some kind of function call. Anyway, I&#39;m not sure we can guarantee anything. It&#39;s all relative to what we believe to be true.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   </div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>