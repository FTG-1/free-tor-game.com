<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design: Method that loads data from one of two file formats &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071672 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071672" class="post-1071672 software type-software status-publish hentry category-software tag-class-design tag-file-handling"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design: Method that loads data from one of two file formats</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">class-design</span><span class="mr-2 badge badge-info">file handling</span></p><div class="entry-content"><p>Say I have a class Person:</p><pre><code>class Person
{
  string FullName;
  int Age;
}
</code></pre><p>And I need to load a list of Person&#39;s from a plain text file.  The text file could be in one of two formats.  I want a method such as LoadFromFile(string path) that will 1) detect the file format 2) parse appropriately for the file type and 3) return a list of Persons.</p><p>The quick and dirty solution would be to have a single method LoadFromFile where I read the header of the file, I can determine which file type it is, and then, keeping the file open, switch on the type and read it appropriately.</p><p>On the other hand, the fact that it&#39;s two different &#34;types&#34; of files makes me think it&#39;s a good candidate for polymorphism.  This would be especially good if there was a third file type.  However, having separate classes makes it seem like it would be harder to keep the file open from the &#34;type detection&#34; phase to the &#34;parse phase&#34;.  Though maybe wanting to keep the file open is just premature optimization.</p><p>I want the client code to simply call LoadFromFile(path) and have it detect the file type and load appropriately.</p><p>What is a good design for this (in terms of class names and method names)?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>Strategy Pattern</strong></p><p>The strategy pattern defines a family of algorithms, encapsulates each one, and makes them interchangeable. Strategy lets the algorithm vary independently from clients that use it.</p><p>Here&#39;s some excellent examples of the strategy pattern</p><ul><li><a href="http://phalanx.spartansoft.org/2009/11/06/implementing-strategy-design-pattern-in-cshar/" rel="nofollow">http://phalanx.spartansoft.org/2009/11/06/implementing-strategy-design-pattern-in-cshar/</a></li><li><a href="http://www.dofactory.com/Patterns/PatternStrategy.aspx#_self2" rel="nofollow">http://www.dofactory.com/Patterns/PatternStrategy.aspx#_self2</a></li></ul><p>As you can see from the 1st link above, you can detect the file type in the header in your main method, and then feed the correct version of the Strategy into the context and then call the context.</p><p>If you really want to you could write a Factory Method to automatically create your context.</p><ul><li><a href="http://www.dofactory.com/Patterns/PatternFactory.aspx#_self2" rel="nofollow">http://www.dofactory.com/Patterns/PatternFactory.aspx#_self2</a></li></ul><p>So you could call something like the following</p><pre><code>var context = FileFactory.CreateContext(myFile);
context.Parse();
</code></pre><p>A factory method might be a little overkill for this however, this would be a judgement call on your part.  However using the strategy pattern as above gives you the flexibility to add any number of new file types to parse.  Additionally the factory will give you the ability to abstract away all of the polymorphism from your logic code.</p><p><strong>Edit</strong></p><p>Here is what you would end up with using a strategy pattern combined with a Factory Method.</p><pre><code>public interface IFileParserStrategy
{
    IList&lt;Person&gt;  Parse(String path);
}


public class FileFormatNo1 : IFileParserStrategy
{    
   private string _path; 
    public FileFormatNo1(String path){
      _path = path;
    }

    public IList&lt;Person&gt; Parse()
    {
        // Actual Logic for handling File Format #1 
        // and returning a IList&lt;Person&gt;   
    }
}

public class FileFormatNo2 : IFileParserStrategy
{     
    private string _path; 
    public FileFormatNo1(String path){
      _path = path;
    }

    public IList&lt;Person&gt; Parse(String path)
    {
        // Actual Logic for handling File Format 2
        // and returning a IList&lt;Person&gt;   
    }
}

public interface IFileParserContext 
{ 
    public IList&lt;Person&gt; Parse();
}

public class FileParserContext : IFileParserContext
{
    private IFileParserStrategy _strategy;

     public FileParserContext(IFileParserStrategy fileParserStrategy)
     {
         _strategy = fileParserStrategy;
     }

     public IList&lt;Person&gt; Parse()
     {
         return _strategy.Parse();
     }
}

public static class FileParserFactory
{
    public static IFileParserContext CreateContext(String path)
    {
           FileParserContext context = null;

           var checkFileFormat = File.ReadAllLines();

            if(checkFileFormat.Contains(&#34;FileFormatNo1&#34;))
              context = new FileParserContext(new FileFormatNo1(path));

            if(checkFileFormat.Contains(&#34;FileFormatNo2&#34;))
               context = new FileParserContext(new FileFormatNo2(path));

             if(context == null)
                throw new FileFormatException(&#34;File is not in a readable state&#34;);

             return context;            
    }       
}


public static void Main()
{    
    var filePath = &#34;someFile.txt&#34;;
    var context = FileParserFactory.CreateContext(filePath);    
    var personList = context.Parse();
}
</code></pre><p><strong>Update</strong></p><p>You could modify the above strategy to pass around a FileStream if you only wanted to open the file once.  You could modify FileParserFactory.CreateContext to accept a FileStream for its parameter, and refactor the strategies to accept the FileStream instead of the filePath.</p><pre><code>public static void Main()
{    
    var filePath = &#34;someFile.txt&#34;;
    List&lt;Person&gt; personList;

    using(var fileStream = new FileStream(filePath, FileMode.Open, FileAccess.Read, FileShare.Read)) 
    {
        var context = FileParserFactory.CreateContext(fileStream);    
        personList = context.Parse();
    }        
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-class-design-multiple-calls-from-one-method-or-one-call-from-multiple-methods/'>C# &#8211; Class Design &#8212; Multiple Calls from One Method or One Call from Multiple Methods</a></li><li class="list-group-item"><a href='../object-oriented-data-classes-getters-and-setters-or-different-method-design/'>Object-oriented &#8211; Data classes: getters and setters or different method design</a></li><li class="list-group-item"><a href='../java-how-to-design-an-application-that-read-files-using-mvc-pattern/'>Java &#8211; How to design an application that read files using MVC pattern</a></li><li class="list-group-item"><a href='../php-design-pattern-a-single-class-with-multiple-purposes-or-multiple-extended-classes-each-with-their-own-purpose-in-php/'>Php &#8211; Design Pattern: A single class with multiple purposes, or multiple extended classes each with their own purpose in PHP</a></li><li class="list-group-item"><a href='../object-oriented-one-boilerplate-class-or-many-similar-classes/'>Object-oriented &#8211; One boilerplate class or many similar classes</a></li><li class="list-group-item"><a href='../c-is-it-bad-practice-to-read-large-file-in-constructor/'>C++ &#8211; Is it bad practice to read large file in constructor</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>