<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Upstreaming microservices errors &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079017 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079017" class="post-1079017 software type-software status-publish hentry category-software tag-error-handling tag-microservices"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Upstreaming microservices errors</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">error handling</span><span class="mr-2 badge badge-info">microservices</span></p><div class="entry-content"><p>As per the microservice architecure, there should be one codebase per microservice with no shared API whatsoever. This enforces a high level of decoupling and every microservice is bounded within its own context.</p><p>But these microservices, over time, will communicate with each other. Service A talks to Service B and Service B talks to Service C, etc&#8230;</p><p>Given this scenario:</p><ul><li>-&gt; means request</li></ul><p>Client -&gt; Service A -&gt; Service B</p><p>Think of Service A being an Account Service and Service B being a User Service. In order for Service A to create an account, it asks Service B if the user exists.</p><p>In the case where Service B fails (no user found, system error), how should Service A expose this error to the Client? I could only think of two choices:</p><p><strong>Solution 1: Expose the error as is, use Service B&#39;s error code</strong></p><p>Pros: Easy to do. Just catch and rethrow the error thrown by Service B</p><p>Cons: If every microservice would need it own codebase, that means a microservice has its own definition of errors. Solution 1 breaks the principles of having microservices since now it appears like Service A knows the error codes of Service B.</p><p><strong>Solution 2: Catch the error in Service A and produce a much more service specific error</strong></p><p>Pros: This produces a much clearer error for the client</p><p>Cons: Service A will need to catch and expect that Server B is capable of returning a bunch of errors, adding coupling between Service A and B.</p><p>The way I see it, both solutions couple each microservice further.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Exceptions should be treated just like domain models. Each service works with their own domain models and should have their own set of exception models as well. When communicating with external systems, the service should convert external exceptions to its domain exceptions as soon as possible. Basically I&#39;m saying go with solution #2.</p><p>Lets consider the communication from service A -&gt; B. Service A should first of all have an interface defined to decouple the business logic from the implementation of requests to B. In your example A is an account service and B is a user service. So let&#39;s call the interface <code>UserService</code>. This interface would have a set of (ideally) compiler-checked exceptions.</p><pre><code>interface UserService
    def getUser(id): User throws UserNotFoundException, UserServiceException
</code></pre><p>You should implement HTTP client for service B so that any service that needs to depend on service B imports the common HTTP client. The error responses from requests to service B will be defined in this HTTP client component. That way they&#39;re only defined once.</p><pre><code>class BHttpClient
    def getUserById(id) = 
        response = http.get(&#34;/users/${id}&#34;).send
        if (response.status == 404) throw new UnknownUserException
        else if (response.status == 500) throw new InternalServerException
        else return json.parse[User](response.content)
</code></pre><p>The implementation of <code>UserService</code>, <code>HttpUserService</code> will use that HTTP client to communicate with B, should catch HTTP and transport exceptions from the client and wrap them in the appropriate &#34;domain&#34; exception.</p><pre><code>class HttpUserService(client: BHttpClient) implements UserService
    def getUser(id) = 
        try {
            client.getUserById(id)
        } catch {
            case e: UnknownUserException =&gt; throw new UserNotFoundException(e)
            case e: InternalServerException =&gt; throw new UserServiceException(e)
        }
</code></pre><blockquote><p>Cons: Service A will need to catch and expect that Server B is capable of returning a bunch of errors, adding coupling between Service A and B.</p></blockquote><p>Service A will catch errors from the http client in <code>HttpUserService</code> and wrap them in meaningful errors for service A. The business logic in service A is decoupled from service B through the <code>UserService</code> interface. <code>HttpUserService</code> is coupled to <code>BHttpClient</code>, but decoupled from service B because you can mock service B at the transport level.</p><p>Even if you choose to use a different architecture like @Laiv describes in the comments, you&#39;ll still want to decouple yourself from message and events you receive by converting the message models and exceptions into domain exceptions in each service. I don&#39;t agree with @Laiv, that it&#39;s as cut and dry as asynchronous message architecture or you might as well implement a monolith. There are still big gains that can be made by a synchronous, distributed service oriented architecture like you&#39;ve described. The first and hardest step of getting the right architecture is to decouple the components. By dividing into microservices early, you can more easily adopt an asynchronous approach later if you need it.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../the-best-practice-when-it-comes-to-naming-microservices/'>The best practice when it comes to naming microservices</a></li><li class="list-group-item"><a href='../rest-microservices-and-data-storage/'>Rest &#8211; Microservices and data storage</a></li><li class="list-group-item"><a href='../architecture-microservices-monolithfirst/'>Architecture &#8211; Microservices: MonolithFirst</a></li><li class="list-group-item"><a href='../logging-architecture-in-microservices/'>Logging architecture in microservices</a></li><li class="list-group-item"><a href='../microservices-and-master-data-management-are-they-compatibile/'>Microservices and &#8220;Master Data Management&#8221; &#8211; are they compatibile</a></li><li class="list-group-item"><a href='../database-aggregation-of-data-from-two-microservices/'>Database &#8211; Aggregation of data from two Microservices</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>