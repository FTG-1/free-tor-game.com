<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; .NET WCF: Persistent connection or Open/Close as needed &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077549 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077549" class="post-1077549 software type-software status-publish hentry category-software tag-c tag-net tag-vb-net tag-wcf tag-web-services"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; .NET WCF: Persistent connection or Open/Close as needed</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">net</span><span class="mr-2 badge badge-warning">vb.net</span><span class="mr-2 badge badge-primary">wcf</span><span class="mr-2 badge badge-danger">web services</span></p><div class="entry-content"><p>I have a .NET WCF web service currently running in production right now. I would say 95% of the time it works flawlessly and as intended. However; there are times when I am throwing an exception that says.</p><pre><code>CommunicationException: 
An unsecured or incorrectly secured fault was received from the other party. See the inner FaultException for the fault code and detail.
</code></pre><p>I have been looking around online for the cause of this, and it seems like this is happening when an exception is being thrown on the Host Service side, and it is not being handled properly and being passed back to the client. In this case my service is the client and a third party is the Host. I cannot feasibly ask the third party to change their code to handle this better.</p><p>Here is the assumption on my part: Once this exception is thrown, it closes the channel between client and host. Because I am not properly disposing of this connection, I have to wait for it to time-out before I can bring it back. This seems to be about 30 seconds, which is slightly too long to expect the users to wait for. I think I have found a possible workaround.</p><p>In my currently implementation I am instantiating my client at the start of my program and making it a global resource that can be called anywhere as needed. I am wondering if is better to use an approach like</p><pre><code>using(WCFServiceClient client = new WCFServiceClient ())
{ 
    //More codes here 
}
</code></pre><p>and use that at each place that my client needs to communicate to the host. Essentially only having the connection opened when I needed it, and disposing of it right afterward.</p><p>The downside here, I would assume, is that there is extra overhead that is going on behind the scenes to open this connection and close it every time. So to me it comes down to whether or not the throughput is high enough to where my process would be effected by waiting for this overhead at each request. Right now I think that there is only about 12 calls to the host a minute, but the catch is they come in groups of three and the three requests all happen in the same second, so this is where the overhead might be the deal breaker.</p><p>Does anyone know what the best practice is?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>So, I&#39;m not sure if what I&#39;m about to tell you is still correct but according to  Mark Seeman in his book &#34;<a href="http://www.manning.com/seemann/" rel="nofollow">Dependency Injection in .NET</a>&#34; he states that:</p><blockquote><p>Although the correct usage pattern concerning ADO.NET connections should be common knowledge, it&#39;s far less known that the same is true for WCF Clients. They should be closed as soon as we&#39;re finished with a particular set of operations on a service.</p></blockquote><p>Based on that view point, I believe you should close your connection after each request.</p><p>That being said, you&#39;ve commented that they are always in batches of 3. It could be a worth while exercise introducing a cache/queue into your system where you collect the requests then open your connection, process all entries in the cache/queue, and then close the connection.</p><p>This combination of both aspects could give you a solution to your issue, however you could still find that the error occurs if it is generated from the server side. In which case you still need to implement some error handling into it.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-do-net-4-0-code-contracts-have-a-role-to-play-in-solo-programmer-projects/'>C# &#8211; Do .NET 4.0 Code Contracts have a role to play in solo-programmer projects</a></li><li class="list-group-item"><a href='../how-to-structure-an-application-that-combines-wcf-and-wpf/'>How to structure an application that combines WCF and WPF</a></li><li class="list-group-item"><a href='../c-define-wcf-client-endpoints-in-a-test-project/'>C# &#8211;  define WCF client endpoints in a test project</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>