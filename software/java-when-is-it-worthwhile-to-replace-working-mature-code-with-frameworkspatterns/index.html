<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; When is it worthwhile to replace working mature code with frameworks+patterns &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086220 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086220" class="post-1086220 software type-software status-publish hentry category-software tag-java tag-patterns-and-practices tag-programming-practices"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; When is it worthwhile to replace working mature code with frameworks+patterns</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">java</span><span class="mr-2 badge badge-info">patterns-and-practices</span><span class="mr-2 badge badge-warning">programming practices</span></p><div class="entry-content"><div><aside class="s-notice s-notice__info post-notice js-post-notice mb16" role="status"><div class="d-flex fd-column fw-nowrap"><div class="d-flex fw-nowrap"><div class="flex--item mr8"> <svg aria-hidden="true" class="svg-icon iconLightbulb" width="18" height="18" viewBox="0 0 18 18"><path d="M15 6.38A6.48 6.48 0 007.78.04h-.02A6.49 6.49 0 002.05 5.6a6.31 6.31 0 002.39 5.75c.49.39.76.93.76 1.5v.24c0 1.07.89 1.9 1.92 1.9h2.75c1.04 0 1.92-.83 1.92-1.9v-.2c0-.6.26-1.15.7-1.48A6.32 6.32 0 0015 6.37ZM4.03 5.85A4.49 4.49 0 018 2.02a4.48 4.48 0 015 4.36 4.3 4.3 0 01-1.72 3.44c-.98.74-1.5 1.9-1.5 3.08v.1H7.2v-.14c0-1.23-.6-2.34-1.53-3.07a4.32 4.32 0 01-1.64-3.94ZM10 18a1 1 0 000-2H7a1 1 0 100 2h3Z"></path></svg></div><div class="flex--item wmn0 fl1 lh-lg"><div class="flex--item fl1 lh-lg"> <b>Want to improve this post?</b> Provide detailed answers to this question, including citations and an explanation of why your answer is correct. Answers without enough detail may be edited or deleted.</p></div></p></div></p></div></p></div></aside></div><p><strong>Intro/Question</strong></p><p>I fear that frameworks in many cases have become a fashion or trend and are being abused. In many ways people are sacrificing speed just because they want to keep up with every single lib that comes out. I am for a more conservative approach that only makes use of new libraries and frameworks when it absolutely makes sense.</p><p>Related: <a href="https://softwareengineering.stackexchange.com/q/49488/94281">When NOT to use a framework</a></p><p><strong>Update/Disclaimer (May 18, 2017)</strong></p><p>I&#39;ve come to the conclusion that rapid application development, ease, and maintainability are the targets. So frameworks (new and old) should be used  provided they help in reaching a final product quicker. Only when special cases exist (actual measurable performance issues) should we switch to custom code&#8230; or when the project itself is legacy and the cost of completely rewriting are too high.</p><p><strong>Case</strong></p><p>We have a Tomcat6 Servlet production that has been ongoing development since 2008 and there are many hours of work behind it. The code is very mature but it does not use any frameworks.</p><p>A new team member loves using frameworks and patterns for everything. Except for the love of frameworks, they also love cutting edge new releases and even proposed migrating from Tomcat6 to somethiong newer (JBOSS,GLASSFISH, or TOMCAT8).</p><p>I would never move a core production service to a container/server/web-server that just came out.</p><p>Not against refactoring code to keep it clean though!</p><p>I am against adding frameworks and patterns that add delay to production code servicing thousands of requests per second.</p><p><strong>Serialization to stream (JSON/XML) while maintaining backwards compatibility</strong></p><p>When a request comes, we produce both XML and JSON documents containing data related to the request params.</p><p>Since we maintain backwards compatibility for older clients changes must not break older support. Since we also support both JSON and XML, we make use of the Jackson but also KXML libraries.</p><p>For both formats we have 2 different serialization methods that use the <strong>streaming API</strong>. Except for being faster, I also find it is MUCH more flexible for maintaining backwards compatibility.</p><p>I like to use a sysyem of Major and Minor version. All minor changes to the backend that cause changes to the serialized document I add with IF statements in the serialization method. Once quite a few changes have accomulated (over 1 year), we add a new serialization method. So, all requests specifying version=1.00 to 1.99 are sent to serializeJSON1. All requests using version 2 to 2.99 are sent to serializeJSON2.</p><p>I&#39;ve heard the argument that we should use ANNOTATIONS and MAP to objects.<br /> I find this very distastefull as I have read streaming is the fastest.</p><p>The streaming API allows you to make necessary changes on the fly while MAPPING would require to store multiple versions of the same data as different objects, or jump through other hoops.</p><pre><code> output.startTag(null, TagTable.PRODUCT);

 output.startTag(null, TagTable.ID);
 output.text(ID);
 output.endTag(null, TagTable.ID);

 output.startTag(null, TagTable.DESCRIPTION);

 if (locale != null &amp;&amp; Translations.containsKey(locale) &amp;&amp; version &gt;= 1)
     output.text(this.DescriptionURL + &#34;/&#34; + locale);
 else
     output.text(this.DescriptionURL);

 output.endTag(null, TagTable.LONGDESCRIPTION);

 if (version &gt;= 1 &amp;&amp; version &lt; 1.5) {
     output.startTag(null, TagTable.POPULARITY);
     output.text(String.valueOf((int) this.pop));
     output.endTag(null, TagTable.POPULARITY);
 } else if (version &gt;= 1.5) {
     output.startTag(null, TagTable.RATING);
     output.text(String.valueOf((int) this.rating));
     output.endTag(null, TagTable.RATING);
 }
</code></pre><p>In the specific 3 cases above I really don&#39;t see the point to replace working mature code with frameworks/libs/patterns that may add additional overhead and cost additional development time.</p><p>So, when is it worthwhile to replace working mature code with frameworks+patterns??</p><p>Comments?</p><p><strong>Update: Some benchmarks</strong></p><p>For the first two examples posted previously, using REST and HASHMAPs does not make overly that big a difference in performance but does make the code more readable.</p><p>Now for the more interesting issue about serialization when used in a hotspot.<br /> Since the actual servlet in question had too much other code I made a toy example to test streaming vs mapping. The code is available at: <a href="https://stackoverflow.com/questions/21781540/">https://stackoverflow.com/questions/21781540/</a></p><p>By all means test it, change it, run it.</p><p>What is very interesting is that the Just in time optimizer in java ends up making the difference negligable over time. So, here is how the percentage between mapping and streaming changes the more iterations there are.</p><pre><code>Iter    Stream  Mapping
0       36,71%  63,29%
20      44,75%  55,25%
40      45,65%  54,35%
60      45,95%  54,05%
80      46,24%  53,76%
100     47,09%  52,91%
120     47,09%  52,91%
140     47,37%  52,63%
160     47,64%  52,36%
180     47,92%  52,08%
200     47,64%  52,36%
220     47,92%  52,08%
240     47,92%  52,08%
260     47,92%  52,08%
280     48,19%  51,81%
300     48,45%  51,55%
320     48,45%  51,55%
340     48,45%  51,55%
360     48,45%  51,55%
380     48,45%  51,55%
400     48,45%  51,55%
1000    48,72%  51,28%
2000    49,24%  50,76%
3000    49,24%  50,76%
4000    49,49%  50,51%
5000    49,75%  50,25%
6000    49,75%  50,25%
7000    49,75%  50,25%
8000    49,75%  50,25%
9000    49,75%  50,25%
</code></pre><p>I also re-ran one more time have first 20 iterations more detailed:</p><pre><code>0   39,76%  60,24%
1   41,18%  58,82%
2   40,83%  59,17%
3   40,12%  59,88%
4   40,48%  59,52%
5   40,83%  59,17%
6   40,83%  59,17%
7   40,83%  59,17%
8   40,48%  59,52%
9   40,12%  59,88%
10  41,52%  58,48%
11  42,53%  57,47%
12  42,86%  57,14%
13  42,86%  57,14%
14  43,18%  56,82%
15  43,50%  56,50%
16  43,50%  56,50%
17  43,82%  56,18%
18  43,82%  56,18%
19  43,82%  56,18%
20  44,75%  55,25%
</code></pre><p>After 10,000 iterations (or calling JSON generation code 1000 times) here is the screenshot from VisualVM profiling (<a href="https://db.tt/AFRBCjbI" rel="nofollow noreferrer">visualVM snapshot NPS file</a>):</p><p><img src="../../../i.stack.imgur.com/gjl61.png" alt="enter image description here"/></p><p>So, if this optimization behavior holds up in Tomcat servlets as well, it means there really is <strong>no point NOT to use mapping</strong> (and many other convenience functions/libs since the JVN will optimize over time).</p><p><strong>Conclusions</strong></p><p>Based on the answers/comments, I think at the end of the day whether to rewrite working production code is affected by business requirement, and specific cost-benefit analysis for each project.</p><p>Based on the benchmarking, it turns out avoiding some libs/frameworks may make no difference in the long run due to JIT JVM optimizations.</p><p><strong>Update: After leaving code running all night</strong></p><p><img src="../../../i.stack.imgur.com/7ESGK.png" alt="enter image description here"/></p><p>After 275,137 iterations and approximately 30,000 MS:</p><pre><code>Mapping -   19,80%
Streaming -  80,20%
</code></pre><p>I really wonder what JIT optimizations happen here and whether the behavior holds for a servlet.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>They say</p><blockquote><p>a bird in the hand is better than 2 in the bush</p></blockquote><p>Applied here, I take it to mean its better to have something that works and is maintainable than to tear it all down for some fantasy daydream of &#34;but it&#39;ll be vaguely better if we use X Y or Z cool new technology for the sake of using the cool new technology&#34;.</p><p>I mean, you could have rewritten it in a functional language a few years ago, or Ruby on Rails a couple of years ago, or Node.js a year ago or... whatever comes along next that gets attention in the technical blogosphere. None of these things would create you a stable product that satisfies the &#39;must use new stuff&#39; people as they will be considered old technologies before they&#39;re even finished and they&#39;ll want to re-rewrite!</p><p>So I have to ask &#34;what&#39;s your problem?&#34;. You have good code that might be a bit mucky here and there, but in my extensive experience, when you start a big rewrite you end up with code that&#39;s a bit mucky (often quickly implemented due to inexperience with the tooling or done under time pressure that you will come back to and fix up nicely, promise.)</p><p>When you use a framework is when you are doing a new project and you want a load of code written for you, that&#39;s the time to go framework, to re-use all that boring boilerplate that you&#39;d have to write yourself. You never go for a framework because its there to be used, especially when you have an existing framework that you know (even if you don&#39;t call it a framework because its grown by itself, it&#39;s effectively still one).</p><p>One thing to note, I do find a lot of the people who insist on using any kind of new technology want to for 1 of 2 reasons: they either want to boost their CV, or they do not want to learn the existing technology you use (after all, learning tech x is way more fun than actually doing work on existing product). I treat all calls with suspicion as in either case their intention is not in the best interest of the product or the business.</p><p>Heavy refactoring...that&#39;s a different story, and usually a good one.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-are-xml-schemas-bad-for-constantly-evolving-file-formats/'>Java &#8211; Are XML Schemas bad for constantly evolving file formats</a></li><li class="list-group-item"><a href='../java-why-does-java-require-a-servlet-container-for-simple-rpc-service/'>Java &#8211; Why does Java require a servlet container for simple RPC service</a></li><li class="list-group-item"><a href='../java-storing-object-graphs-with-class-evolution-in-java-with-transformation-long-time-archiving/'>Java &#8211; Storing object-graphs with class-evolution in Java with transformation (long time archiving)</a></li><li class="list-group-item"><a href='../javascript-jsp-in-javascript-file-or-multiple-ajax-requests/'>Javascript &#8211; JSP in Javascript file or multiple AJAX requests</a></li><li class="list-group-item"><a href='../java-how-should-i-design-json-serializable-data-classes-to-respect-future-nonnull-fields/'>Java &#8211; How Should I Design JSON Serializable Data Classes To Respect Future @NonNull Fields</a></li><li class="list-group-item"><a href='../java-ways-of-creating-expected-object-for-assert/'>Java &#8211; Ways of creating expected object for assert</a></li><li class="list-group-item"><a href='../designs-and-practices-to-guard-against-erroneous-null-entries-from-database/'>Designs and practices to guard against erroneous null entries from database</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>