<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; &#8220;how bad&#8221; is unrelated code in try-catch-finally block &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070497 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070497" class="post-1070497 software type-software status-publish hentry category-software tag-coding-style tag-design tag-exception-handling"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; &#8220;how bad&#8221; is unrelated code in try-catch-finally block</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">coding-style</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">exception handling</span></p><div class="entry-content"><p>This is a related Q:<br /> <a href="https://softwareengineering.stackexchange.com/questions/146379/is-use-of-finally-clause-for-doing-work-after-return-bad-style-dangerous">Is use of finally clause for doing work after return bad style/dangerous?</a></p><p>In the referenced Q, the finally code is related to the structure used and the necessity of pre-fetching.  My question is a little different, and I believe it&#39;s germane to the broader audience.  My particular example is a C# winform app, but this would apply to C++ / Java finally usage as well.</p><p>I&#39;m noticing quite a few try-catch-finally blocks where there is a lot of code unrelated to exceptions and exception handling / cleanup buried within the block.  And I will admit my bias towards having very tight try-catch-finally blocks with the code closely related to the exception and handling. Here are some examples of what I&#39;m seeing.</p><p>Try blocks will have lots of preliminary calls and variables being set leading up to the code that could throw.  Logging information will get setup and run in the try block as well.</p><p>Finally blocks will have form / module / control formatting calls (despite the app being about to terminate, as expressed in the catch block), as well as creating new objects such as panels.</p><p>Roughly:</p><pre>    methodName( ... )
    {
        try
        {
            // Lots of code for the method ...
            // code that could throw ...
            // Lots more code for the method and a return ...
        }
        catch( something )
        { // handle exception }
        finally
        {
            // some cleanup due to exception, closing things
            // more code for the stuff that was created (ignoring that any exceptions could have thrown) ...
            // maybe create some more objects
        }
    }
</pre><p>The code works, so there is some value to it.  It is not well encapsulated and the logic is a bit convoluted.  I&#39;m (painfully) familiar with the risks in shifting code around as well as refactoring, so my question boils down to wanting to know others&#39; experience with similarly structured code.</p><p>Does the bad style justify making the changes?  Has anyone been badly burned from a similar situation?  Would you care to share the details of that bad experience?  Leave it be because I&#39;m over-reacting and it&#39;s not that bad of style?  Gain the maintenance benefits of tidying things up?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I&#39;ve been through a very similar situation when I had to deal with a terrible legacy Windows Forms code written by developers that clearly didn&#39;t know what they were doing.</p><p>First of all, you&#39;re not overacting. This is bad code. Like you said, the catch block should be about aborting and preparing to stop. It&#39;s not time to create objects (specially Panels). I can&#39;t even start explaining why this is bad.</p><p>That being said...</p><p><strong>My first advice is:</strong> if it&#39;s not broken, don&#39;t touch it!</p><p>If your job is to maintain the code you have to do your best not to break it. I know it&#39;s painful (I&#39;ve been there) but you have to do your best not to break what is already working.</p><p><strong>My second advice is:</strong> if you have to add more features, try keeping the existing code structure as much as possible so you don&#39;t break the code.</p><p>Example: if there&#39;s a hideous switch-case statement that you feel could be replaced by proper inheritance, you must be careful and think twice before you decide to start moving things around.</p><p>You will definitely find situations where a refactoring is the right approach but beware: <strong>refactoring code is more likely to introduce bugs</strong>. You have to make that decision from the application owners perspective, not from the developer perspective. So you have to think if the effort (money) necessary to fix the problem is worth a refactoring or not. I&#39;ve seen many times a developer spending several days fixing something that is not really broken just because he thinks &#34;the code is ugly&#34;.</p><p><strong>My third advice is:</strong> you will get burned if you break the code, it doesn&#39;t matter if it&#39;s your fault or not.</p><p>If you&#39;ve been hired to give maintenance it doesn&#39;t really matter if the application is falling apart because somebody else made bad decisions. From the user perspective it was working before and now you broke it. <strong>You</strong> broke it!</p><p>Joel puts very well in his article explaining several reasons why you should not rewrite legacy code.</p><p><a href="http://www.joelonsoftware.com/articles/fog0000000069.html" rel="noreferrer">http://www.joelonsoftware.com/articles/fog0000000069.html</a></p><p>So you should feel really bad about that kind of code (and you should never write anything like that) but maintaining it is a whole different monster.</p><p><strong>About my experience:</strong> I had to maintain the code for about 1 year and eventually I was able to rewrite it from scratch but not all at once.</p><p>What happened is that the code was so bad that new features were impossible to implement. The existing application had serious performance and usability issues. Eventually I was asked to make a change that would take me 3-4 months (mostly because working with that code took me way more time than usual). I thought I could rewrite that whole piece (including implementing the desired new feature) in about 5-6 months. I brought this proposition to the stakeholders and they agree to rewrite it (luckily for me).</p><p>After I rewrote this piece they understood I could deliver much better stuff than what they already had. So I was able to rewrite the entire application.</p><p>My approach was to rewrite it piece by piece. First I replaced the entire UI (Windows Forms), then I started to replace the communication layer (Web Service calls) and last I replaced the entire Server implementation (it was a thick client / server kind of application).</p><p>A couple years later and this application has turned into a beautiful key tool used by the entire company. I&#39;m 100% sure that would&#39;ve never been possible had I not rewritten the whole thing.</p><p>Even though I was able to do it the important part is that the stakeholders approved it and I was able to convince them it was worth the money. So while you have to maintain the existing application just do your best not to break anything and if you&#39;re able to convince the owners about the benefit of rewriting it then try to do it like Jack the Ripper: by pieces.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-abstract-exception-super-type/'>C# &#8211; Abstract exception super type</a></li><li class="list-group-item"><a href='../using-a-try-finally-without-catch-vs-enum-state-validation/'>Using a try-finally (without catch) vs enum-state validation</a></li><li class="list-group-item"><a href='../is-it-a-acceptable-approach-to-put-try-catch-wherever-null-pointer-exception-occurs/'>Is it a acceptable approach to put try catch wherever null pointer exception occurs</a></li><li class="list-group-item"><a href='../java-exception-handling-in-java-web-application/'>Java &#8211; Exception Handling in Java web application</a></li><li class="list-group-item"><a href='../object-oriented-where-should-pdoexceptions-be-dealt-with/'>Object-oriented &#8211; Where should PDOExceptions be dealt with</a></li><li class="list-group-item"><a href='../java-is-nesting-try-catch-statements-still-a-code-smell-if-nested-within-a-loop/'>Java &#8211; Is nesting try-catch statements still a code smell if nested within a loop</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>