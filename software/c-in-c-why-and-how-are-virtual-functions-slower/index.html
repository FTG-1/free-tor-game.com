<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; In C++ why and how are virtual functions slower &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1063647 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1063647" class="post-1063647 software type-software status-publish hentry category-software tag-abstract-class tag-c tag-functions tag-pointers"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; In C++ why and how are virtual functions slower</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">abstract class</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">functions</span><span class="mr-2 badge badge-primary">pointers</span></p><div class="entry-content"><p>Can anyone explain in detail, how exactly the virtual table works and what pointers are associated when virtual functions are called.</p><p>If they are actually slower, can you show the time that the virtual function takes to execute is more than normal class methods? It is easy to lose track of how/what is happening without seeing some code.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Virtual methods are commonly implemented via so-called virtual method tables (vtable for short), in which function pointers are stored. This adds indirection to the actual call (gotta fetch the address of the function to call from the vtable, then call it -- as opposed to just calling it right ahead). Of course, this takes some time and some more code.</p><p>However, it is not necessarily the primary cause of slowness. The real problem is that the compiler (generally/usually) <em>cannot know</em> which function will be called. So it can&#39;t inline it or perform any other such optimizations. This alone might add a dozen pointless instructions (preparing registers, calling, then restoring state afterwards), and might inhibit other, seemingly unrelated optimizations. Moreover, if you branch like crazy by calling many different implementations, you suffer the same hits you&#39;d suffer from branching like crazy via other means: The cache and branch predictor won&#39;t help you, the branches will take longer than a perfectly predictable branch.</p><p><strong>Big but</strong>: These performance hits are usually too tiny to matter. They&#39;re worth considering if you want to create a high-performance code and consider adding a virtual function that would be called at alarming frequency.
However, <em>also</em> keep in mind that replacing virtual function calls with other means of branching (<code>if .. else</code>, <code>switch</code>, function pointers, etc.) won&#39;t solve the fundamental issue -- it may very well be slower. The problem (if it exists at all) isn&#39;t virtual functions but (unnecessary) indirection.</p><p>Edit: The difference in the call instructions is described in other answers. Basically, the code for a static (&#34;normal&#34;) call is:</p><ul><li>Copy some registers on the stack, to allow the called function to use those registers.</li><li>Copy the arguments into predefined locations, so that the called function can find them regardless from where it is called.</li><li>Push the return address.</li><li>Branch/jump to the function&#39;s code, which is a compile-time address and hence hardcoded in the binary by the compiler/linker.</li><li>Get the return value from a predefined location and restore registers we want to use.</li></ul><p>A virtual call does exactly the same thing, except that the function address is not known at compile time. Instead, a couple of instructions ...</p><ul><li>Get the vtable pointer, which points to an array of function pointers (function addresses), one for each virtual function, from the object.</li><li>Get the right function address from the vtable into a register (the index where the correct function address is stored is decided at compile-time).</li><li>Jump to the address in that register, rather than jumping to a hardcoded address.</li></ul><p>As for branches: A branch is anything which jumps to another instruction instead of just letting the next instruction execute. This includes <code>if</code>, <code>switch</code>, parts of various loops, function calls, etc. and sometimes the compiler implements things that don&#39;t seem to branch in a way that actually needs a branch under the hood. See <a href="https://stackoverflow.com/q/11227809/395760">Why is processing a sorted array faster than an unsorted array?</a> for why this may be slow, what CPUs do to counter this slowdown, and how this isn&#39;t a cure-all.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../static-methods-or-static-functions/'>Static methods or static functions</a></li><li class="list-group-item"><a href='../c-how-to-explain-that-writing-universally-cross-platform-c-code-and-shipping-products-for-all-oses-is-not-that-easy/'>C++ &#8211; How to explain that writing universally cross-platform C++ code and shipping products for all OSes is not that easy</a></li><li class="list-group-item"><a href='../c-compiler-structures-such-as-virtual-method-table-etc/'>C++ compiler structures such as Virtual method Table etc</a></li><li class="list-group-item"><a href='../java-limitations-of-polymorphism-in-statically-typed-languages/'>Java &#8211; Limitations of Polymorphism in statically typed languages</a></li><li class="list-group-item"><a href='../c-recompiling-dlls-and-adding-more-during-run-time-what-are-the-options/'>C++ &#8211; Recompiling dll&#8217;s and adding more during run time &#8211; what are the options</a></li><li class="list-group-item"><a href='../method-extraction-vs-underlying-assumptions/'>Method extraction vs underlying assumptions</a></li><li class="list-group-item"><a href='../c-what-is-the-order-of-function-pointers-inside-vtable/'>C++ : What is the order of function pointers inside vtable</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>