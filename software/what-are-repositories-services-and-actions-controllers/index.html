<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>What are Repositories, Services, and Actions/Controllers &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1064497 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1064497" class="post-1064497 software type-software status-publish hentry category-software tag-design-patterns tag-object-oriented-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">What are Repositories, Services, and Actions/Controllers</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design-patterns</span><span class="mr-2 badge badge-info">object-oriented-design</span></p><div class="entry-content"><p>I started a project using Slim3 and PHP using limited knowledge of application architecture. The plan was to create the project and separate application concerns. It was all going well, but things got confusing fast as the application grew.</p><p>The whole idea for doing this was to make development easier. It does in a way, but I find it&#39;s complex at times to keep tabs on the data flow.</p><p>I need some advice on what Repositories, Services and Controllers/Actions are. And how they should work in a system. My current understanding of them is below:</p><p><strong>Repository</strong></p><p>Repositories are used between the service layer and the model layer. For example, in a <code>UserRepository</code> you would create methods that contains the code to read/write from the database. In PHP, PDO would be used, or an ORM, within the repo methods. For example:</p><pre><code>class UserRepository
{
    public function findByID($id) { ... }
    public function findByEmail($email) { ... }
    public function findByMobile($mobile) { ... }
    public function createEmail($email, $firstname, $lastname, $password) { ... }
    public function createMobile($mobile, $firstname, $lastname, $password) { ... }
}
</code></pre><p>I&#39;ve put a few example methods in there. But there would likely be many more.</p><p><strong>Services</strong></p><p>The service layer encapsulates application logic. For example, the <code>UserService</code> would be responsible for creating an account, and performing the required logic in order to register the user. Services can also be third party, for example creating a service for Facebook&#39;s SDK, or ORM.</p><p>An example service:</p><pre><code>class UserService
{
    public function createMobile($mobile, $firstname, $lastname, $password)     {
    /*
     * Call a validation service to validate input
     */
    ...

    /*
     * Use UserRepository&#39;s findByMobile() to check if account exists
     */
    ...

    /*
     * Use UserRepository&#39;s createMobile() to create account
     */
    ...

    /*
     * Call SMS service to send verification code
     */
    ...
    }

    public function createEmail(...) { ... }
    public function getFollowers (...) { ... }
}
</code></pre><p><strong>Actions</strong></p><p>I&#39;m not sure if this is a real term. It&#39;s used in the Slim Framework documentation and seems to represent a thin controller.</p><p>An Action contains very little logic and is used to make calls to services. Rarely does the Action make direct calls to the repositories unless there&#39;s a valid reason. The Action will perform basic checks on the data returned from the services in order to send a response back to the client.</p><p>They&#39;re tied to individual routes. I&#39;m using them like so:</p><pre><code>class ActivateEmailAction extends Action {

    public function __invoke(Request $request, Response $response, $args = [])
    {
        if(!$this-&gt;ci-&gt;ActivationService-&gt;activateEmail($args[&#39;token&#39;])){
            return $response-&gt;withJson([
                &#39;status&#39; =&gt; &#39;error&#39;,
                &#39;data&#39; =&gt; null,
                &#39;message&#39; =&gt; &#39;Invalid verification token&#39;
            ]);
        };

        return $response-&gt;withJson([
            &#39;status&#39; =&gt; &#39;success&#39;,
            &#39;data&#39; =&gt; null,
            &#39;message&#39; =&gt; null
        ]);
    }
}
</code></pre><p>Am I using these patterns correctly? The flow I seem to have adopted is like so:</p><ol><li>Everything starts at the route. For example a request is made to <code>/create</code>. The route is registered to an Action.</li><li>Action decides what services to call</li><li>Services perform the logic, make calls to other services and repositories if required</li><li>Service hands back data to the Action</li><li>Action returns a response</li></ol><p>Any advice would be much appreciated.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I actually like the way you are implementing this.</p><p>Some answers:</p><blockquote><p>What are repositories, services and actions/controllers?</p></blockquote><ul><li><p><strong>Repositories:</strong> The repository is a gateway between your domain/business layer and a data mapping layer, which is the layer that accesses the database and does the operations. Basically the repository is an abstraction to you database access.</p></li><li><p><strong>Service:</strong> The service should provide an API to your business logic, therefore being an abstraction to your repository, here is where I disagree, just a little, with @Cerad, the services should be the only ones with access to the repositories, otherwise it violates the Dependency Inversion Principle (D in SOLID), because the business layer is an abstraction of your data access layer.</p></li><li><p><strong>Actions/Controllers:</strong> The A/C objects works as a gateway between your input and the domain logic, is decides what to do with the input and how to output the response.</p></li></ul><blockquote><p>I find it&#39;s complex at times to keep tabs on the data flow.</p></blockquote><p>Yes, sometimes it is, but as I read, and don&#39;t remember well, that it is better to have organized and principle based code than to have latter difficulties on ugly code, it makes it more manageable, readable and maintainable.</p><h2>Finally:</h2><p>The architectural model you are using is the Layered Architecture, everything is separated in layers, and the upper layers are abstractions of the lower ones, that&#39;s why every layer should only reference the immediate lower layer.</p><p>Hope this helps.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../why-would-i-want-a-unitofwork-layer-if-the-service-business-logic-layer-is-specific-enough/'>Why would I want a UnitOfWork layer if the service/business logic layer is specific enough</a></li><li class="list-group-item"><a href='../global-try-catch-in-presentation-layer/'>Global try-catch in presentation layer</a></li><li class="list-group-item"><a href='../rest-which-pattern-is-suitable-to-send-multiple-type-of-responses-through-rest-web-service/'>Rest &#8211; Which pattern is suitable to send multiple type of responses through REST web service</a></li><li class="list-group-item"><a href='../java-simple-and-composite-transactional-services-question-about-separation-of-concerns-and-transactions/'>Java &#8211; Simple and Composite transactional services: Question about separation of concerns and transactions</a></li><li class="list-group-item"><a href='../php-ddd-creating-reusable-modules-and-service-type-distinctions-domain-infrastructure-application/'>Php &#8211; DDD: Creating reusable modules and service type distinctions (Domain, Infrastructure, Application)</a></li><li class="list-group-item"><a href='../how-do-entities-dto-doa-work-together-and-whats-their-role-within-a-system/'>How do entities, DTO, DOA work together and whatâ€™s their role within a system</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>