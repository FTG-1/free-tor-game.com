<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; IOC Between Presentation and Infrastructure Layer &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079598 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079598" class="post-1079598 software type-software status-publish hentry category-software tag-c tag-dependency-injection tag-design-patterns tag-inversion-of-control"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; IOC Between Presentation and Infrastructure Layer</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">dependency-injection</span><span class="mr-2 badge badge-warning">design-patterns</span><span class="mr-2 badge badge-primary">inversion-of-control</span></p><div class="entry-content"><p><strong>Question</strong>:<br /> I would like to set forth dependency mapping from a *.config file from a project that has no reference to the project that contains the concrete class.</p><p><strong>Scenario</strong>:<br /> I&#39;ll be using terms from C#, Microsoft Unity and Visual Studio: I&#39;ve got a presentation layer with a web service project and a winform project, an infrastructure layer that communicates with repositories, and there is a core business logic layer that defines interfaces that the infrastructure must implement.</p><p><strong>Projects</strong>:<br /> <strong>Presentation</strong>:<br /> DIApplication.WebServices &#8211; references the Core + DependencyResolution projects<br /> DIApplication.Winform &#8211; references the Core + DependencyResolution projects</p><p><strong>Infrastructure</strong>:<br /> DIApplication.Data &#8211; Communicates with repositories, references the Core<br /> DIApplication.DependencyResolution &#8211; Registers to the dependencies from Core to Data projects. These are the only two projects it references</p><p><strong>Core</strong>:<br /> DIApplication.Core &#8211; Defines interfaces, references nothing</p><p><strong>Example</strong>:<br /> For an example I&#39;ll say I have DIApplication.Core.IRepository interface and DIApplication.Data.RepositoryA class and DIApplication.Data.RepositoryB class.</p><p>It&#39;s fine to say that the DependencyResolution project will register the dependencies:</p><pre><code>//If Application == WebService
container.RegisterType&lt;IRepository , RepositoryA &gt;();
//Else
container.RegisterType&lt;IRepository , RepositoryB &gt;();
</code></pre><p>But what I would like to do is that the Webservices Web.config maps IRepository to RepositoryA, while the Winforms App.config maps IRepository to RepositoryB</p><p>Webservices:</p><pre>&lt; register type=&#34;DIApplication.Core.IRepository, DIApplication.Core&#34; mapTo=&#34; DIApplication.Data.RepositoryA, DIApplication.Data&#34; /&gt;</pre></p><p>Winforms:</p><pre>&lt; register type=&#34;DIApplication.Core.IRepository, DIApplication.Core&#34; mapTo=&#34; DIApplication.Data.RepositoryB, DIApplication.Data&#34; /&gt;</pre></p><p>The problem (I believe) is that neither DIapplication.Webservices or Winforms knows about DIapplication.Data, so it breaks on the final portion of this call in DIApplication.DependencyResolution:</p><pre>IUnityContainer container = new UnityContainer();
UnityConfigurationSection section = (UnityConfigurationSection)ConfigurationManager.GetSection(&#34;unity&#34;);
section.Configure(container);</pre><p>With the error:</p><pre>The given assembly name or codebase was invalid. (Exception from HRESULT: 0x80131047) 
</pre></p><p>Is there any way to get around this without having to include a reference to DIApplication.Data within both DIApplication.Webservices and Winforms?</p><p>Maybe I&#39;m looking at this the wrong way. I know that it kind of breaks the notion of separation of concern, where the presentation layer shouldn&#39;t know nor care how data is being persisted to repositories, just that it is. But I also want to drive the dependencies based on what project is running.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The context of your application decides everything.</p><p>To illustrate why this is true, let us first start with the purpose for inversion of control or IOC.  The purposes behind IOC are extensibility and horizontal scaling.</p><p>In extensibility, the application needs to decide what implementation to use under a particular set of circumstances.  For example, if the user chooses to pay via PayPal, it needs to choose the PayPalPaymentProvider implementation rather than the Authorize.NET implementation.</p><p>For horizontal scaling, the implementation is decoupled from the application code so that you can easily scale up by writing new implementations and setting those within the context of your application.  For example, if my application currently uses MySql, but I&#39;m now to the point where MySql isn&#39;t performing well because my application has become too popular, using IOC I can simply write a new database implementation that is SQL specific and throw out the MySql code without having to change any application logic at all.</p><p>All of that being said, let&#39;s add the fact the presentation layer is nearly always tied to a specific environment that it needs to run under.  Unless you either write your own application host or OS or you abstract your entire UI into its own project that is then hosted by a context project, the project that contains your UI IS going to be the decision maker for everything implementation related.</p><p>Now, to answer your question.  You do not need to have a reference to the DIApplication.Data project in your DIApplication.Webservices or DIApplication.Winforms projects and you don&#39;t want to reference it directly because then it defeats the purpose of using the IOC.  However, you will need to copy the dll for DIApplication.Data into the context of your applications so that it can read the assembly.  Defining what implementation you want to use for the IOC in the web.config and app.config is good practice.</p><p>However, for the IOC to be able to read and instantiate the concrete implementation, it must be able to find it.  The idea here is that you could swap out that dll with a different concrete implementation, change the configuration file to point to the new concrete instance and everything would continue to work without needing to rebuild the application at all, much less having to change any code.</p><p>So, to summarize the answer, all you should really need to do at this point is use a post-build action to copy the concrete implementation into the bin folders for your Windows Forms and Web applications.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../is-it-a-good-idea-to-register-views-and-view-models-as-singletons-in-an-ioc-container/'>Is it a good idea to register views and view models as singletons in an IOC container</a></li><li class="list-group-item"><a href='../c-di-ioc-abstract-factory-galore/'>C# &#8211; DI / IoC Abstract Factory Galore</a></li><li class="list-group-item"><a href='../c-breaking-the-ubiquitous-language-by-having-an-ioc-container-in-domain-model/'>C# &#8211; Breaking the &#8220;ubiquitous language&#8221; by having an IoC Container in Domain Model</a></li><li class="list-group-item"><a href='../ioc-unity-and-passing-parameters-or-a-way-to-avoid-doing-so/'>IoC, Unity and passing parameters (or a way to avoid doing so)</a></li><li class="list-group-item"><a href='../php-ddd-creating-reusable-modules-and-service-type-distinctions-domain-infrastructure-application/'>Php &#8211; DDD: Creating reusable modules and service type distinctions (Domain, Infrastructure, Application)</a></li><li class="list-group-item"><a href='../c-dependency-injection-for-a-library-with-internal-dependencies/'>C# &#8211; Dependency injection for a library with internal dependencies</a></li><li class="list-group-item"><a href='../c-avoid-core-layer-referencing-dal-when-defining-repository-interface/'>C# &#8211; Avoid core layer referencing DAL when defining repository interface</a></li><li class="list-group-item"><a href='../c-onion-architecture-layer-placement-of-business-logic/'>C# &#8211; Onion architecture: layer placement of business logic</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>