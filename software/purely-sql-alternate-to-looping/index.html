<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Purely SQL alternate to looping &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079396 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079396" class="post-1079396 software type-software status-publish hentry category-software tag-algorithms tag-loops tag-sql"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Purely SQL alternate to looping</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">algorithms</span><span class="mr-2 badge badge-info">loops</span><span class="mr-2 badge badge-warning">sql</span></p><div class="entry-content"><p>Historically, I probably would have written a script (php or something) to loop through all spreadsheet rows and perform some calculations.</p><p>I&#39;m looking for a pure SQL solution on the presumption that SQL has better options than loops.</p><p>How should I approach this problem while using a pure SQL approach?</p><hr/><p><strong>DATA OVERVIEW:</strong><br /> We have a list (currently in a spreadsheet) of items for which we want to check trending.<br /> Let&#39;s pretend that that spreadsheet contains these three items; 111111, 222222, and 888888.</p><p>In the DB, we have a table of vendors&#39; inventory snapshots. Here&#39;s a simplified example:<br /> <a href="http://sqlfiddle.com/#!3/90424/1" rel="nofollow">(see the fiddle here)</a>.</p><pre><code>CREATE TABLE inventory_snapshots
    ([id] int, [vendor_id] int, [item] int, [brand] varchar(1), [inventory_version] int, [quantity] int);

INSERT INTO inventory_snapshots
    ([id], [vendor_id], [item], [brand], [inventory_version], [quantity])
VALUES
    (1, 111, 111111, &#39;A&#39;, 5, 45),
    (2, 111, 111111, &#39;B&#39;, 5, 43),
    (3, 111, 222222, &#39;X&#39;, 5, 12),
    (4, 222, 111111, &#39;B&#39;, 4, 5),
    (5, 222, 888888, &#39;C&#39;, 4, 50),
    (6, 222, 111111, &#39;D&#39;, 5, 10),
    (7, 222, 888888, &#39;C&#39;, 5, 100),
    (8, 111, 111111, &#39;A&#39;, 6, 40),
    (9, 111, 222222, &#39;X&#39;, 6, 10);
</code></pre><p>Notice that a vendor can have multiple rows of an item in a given inventory version because of brand differences.</p><p><strong>GOAL:</strong><br /> Our goal is to see the trending over all vendors.<br /> That means comparing a list (currently in spreadsheet form) of items against the DB to retrieve:</p><ul><li>item number</li><li>starting qty (sum of qty&#39;s from the MIN version number for each</li><li>vendor, items grouped by vendor_id,inventory_version) total increases<br /> (sum of each vendors version-over-version increases in qty) total</li><li>increases (sum of each vendors version-over-version increases in qty)</li><li>ending qty (sum of qty&#39;s from the MAX version number for each vendor,<br /> items grouped by vendor_id,inventory_version)</li></ul><p>For another example, see the comment in <a href="http://sqlfiddle.com/#!3/90424/1" rel="nofollow">the fiddle.</a></p><p><strong>SUMMARY:</strong></p><p>It sounds like SQL Server <em>can</em> do some looping, but that it&#39;s impractical.</p><p>What&#39;s a better way to approach this?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Depending on your version of SQL Server, windowing functions will do what you want. 2008 has limited support but 2012 adds nearly all of the standard. The over clause is used for things exactly like this, it is also available in the express versions as well.</p><p><a href="http://technet.microsoft.com/en-us/library/ms189461.aspx" rel="nofollow">http://technet.microsoft.com/en-us/library/ms189461.aspx</a></p><p>Windowing functions are used to perform high-level aggregation, ranking and statistical analysis. They are often used to split and show similarities in a data set.</p><p>The over clause can partition a column and provide a running sum like you describe in a T-SQL Statement.</p><pre><code>SELECT [id], [vendor_id], [item], [brand], [inventory_version], SUM([quantity])
    OVER (PARTITION BY [vendor_id], [item]
        ORDER BY [vendor_id], [item], [inventory_version]) AS qty_Totals
FROM inventory_snapshots
ORDER BY [vendor_id], [item], [inventory_version]
</code></pre><p>Code is untested but should work. What it does is take the recordset, partitions it by the vendor_id and item. This effectively resets the sumation to 0 when that combination changes. We make sure to order the results in a logical manner to show the running totals easily. This will show the progression of item versions per manufacturer starting at the lowest and going straight through to the last.</p><p>Hopefully this clears things up a bit.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-is-there-still-a-need-for-writing-sql/'>Design &#8211; Is there still a need for writing SQL</a></li><li class="list-group-item"><a href='../are-there-any-sql-servers-that-support-compiled-queries/'>Are there any SQL servers that support compiled queries</a></li><li class="list-group-item"><a href='../sql-algorithm-for-finding-availability-of-a-resource/'>SQL &#8211; Algorithm for finding availability of a resource</a></li><li class="list-group-item"><a href='../sql-algorithm-for-most-overlapping-events/'>SQL algorithm for most overlapping events</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>