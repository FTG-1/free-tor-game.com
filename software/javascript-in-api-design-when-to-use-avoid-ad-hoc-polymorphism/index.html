<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Javascript &#8211; In API design, when to use/avoid ad hoc polymorphism &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077570 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077570" class="post-1077570 software type-software status-publish hentry category-software tag-api tag-api-design tag-javascript"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Javascript &#8211; In API design, when to use/avoid ad hoc polymorphism</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api</span><span class="mr-2 badge badge-info">api-design</span><span class="mr-2 badge badge-warning">javascript</span></p><div class="entry-content"><p>Sue is designing a JavaScript library, <code>Magician.js</code>. Its linchpin is a function which pulls a <code>Rabbit</code> out of the argument passed.</p><p>She knows its users may want to pull a rabbit out of a <code>String</code>, a <code>Number</code>, a <code>Function</code>, perhaps even a <code>HTMLElement</code>. With that in mind, she <em>could</em> design her API like so:</p><h1>The strict interface</h1><pre><code>Magician.pullRabbitOutOfString = function(str) //...
Magician.pullRabbitOutOfHTMLElement = function(htmlEl) //...
</code></pre><p>Each function in the above example would know how to handle the argument of the type specified in the function name/parameter name.</p><p>Or, she could design it like so:</p><h1>The &#34;ad hoc&#34; interface</h1><pre><code>Magician.pullRabbit = function(anything) //...
</code></pre><p><code>pullRabbit</code> would have to account for the variety of different expected types that the <code>anything</code> argument could be, as well as (of course) an unexpected type:</p><pre><code>Magician.pullRabbit = function(anything) {
  if (anything === undefined) {
    return new Rabbit(); // out of thin air
  } else if (isString(anything)) {
    // more
  } else if (isNumber(anything)) {
    // more
  }
  // etc.
};
</code></pre><p>The former (strict) seems more explicit, perhaps safer, and perhaps more performant &#8212; as there are little or no overheads for type checking or type conversion. But the latter (ad hoc) feels simpler looking at it from the outside, in that it &#34;just works&#34; with whatever argument the API consumer finds convenient to pass to it.</p><p><strong>For the answer to this question</strong>, I&#39;d like to see specific pros and cons to either approach (or to a different approach altogether, if neither is ideal), that Sue should know which approach to take when designing her library&#39;s API.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h3>Some pros and cons</h3><p>Pros for polymorphic:</p><ul><li>A smaller polymorphic interface is easier to read. I only have to remember one method.</li><li>It goes with the way the language is meant to be used - Duck typing.</li><li>If it&#39;s clear which objects I want to pull a rabbit out of, there shouldn&#39;t be ambiguity anyway.</li><li>Doing a lot of type checking is considered bad even in static languages like Java, where having plenty of type checks for the type of the object makes ugly code, should the magician really need to differentiate between the type of objects he&#39;s pulling a rabbit out of?</li></ul><p>Pros for ad-hoc:</p><ul><li>It&#39;s less explicit, can I pull a string out of a <code>Cat</code> instance? Would that just work? if not, what is the behavior? If I don&#39;t limit the type here, I have to do so in the documentation, or in the tests which might make a worse contract.</li><li>You have all the handling of pulling a rabbit in one place, the Magician (some might consider this a con)</li><li>Modern JS optimizers differenciate between monomorphic (works on only one type) and polymorphic functions. They know how to optimize the monomorphic ones <em>much</em> better so the <code>pullRabbitOutOfString</code> version is likely to be <em>much</em> faster in engines like V8. <a href="https://www.youtube.com/watch?v=UJPdhx5zTaw" rel="nofollow noreferrer">See this video for more information.</a> <strong>Edit:</strong> I wrote a perf myself, it turns out that <a href="http://jsperf.com/monomorphic-vs-polymorphic-methods" rel="nofollow noreferrer">in practice, this is not always the case</a>.</li></ul><h2>Some alternative solutions:</h2><p>In my opinion, this sort of design isn&#39;t very &#39;Java-Scripty&#39; to begin with. JavaScript is a different language with different idioms from languages like C#, Java or Python. These idioms originate in years of developers trying to understand the language&#39;s weak and strong parts, what I&#39;d do is try to stick with these idioms.</p><p>There are two nice solutions I can think of:</p><ul><li>Elevating objects, making objects &#34;pullable&#34;, making them conform to an interface on run-time, then having the Magician work on pullable objects.</li><li>Using the strategy pattern, teaching the Magician dynamically how to handle different type of objects.</li></ul><h2>Solution 1: Elevating Objects</h2><p>One common solution to this problem, is to &#39;elevate&#39; objects with the ability to have rabbits pulled out of them.</p><p>That is, have a function that takes some type of object, and adds pulling out of a hat for it. Something like:</p><pre><code>function makePullable(obj){
   obj.pullOfHat = function(){
       return new Rabbit(obj.toString());
   }
}
</code></pre><p>I can make such <code>makePullable</code> functions for other objects, I could create a <code>makePullableString</code>, etc. I&#39;m defining the conversion on each type. However, after I elevated my objects, I have no type to use them in a generic way. An interface in JavaScript is determined by a duck typing, if it has a <code>pullOfHat</code> method I <em>can</em> pull it with the Magician&#39;s method.</p><p>Then Magician could do:</p><pre><code>Magician.pullRabbit = function(pullable) {
    var rabbit = obj.pullOfHat();
    return {rabbit:rabbit,text:&#34;Tada, I pulled a rabbit out of &#34;+pullable};
}
</code></pre><p>Elevating objects, using some sort of mixin pattern seems like the more JS thing to do.
(Note this is problematic with value types in the language which are string, number, null, undefined and boolean, but they&#39;re all box-able)</p><p><a href="http://jsfiddle.net/zzVLd/" rel="nofollow noreferrer">Here is an example of what such code might look like</a></p><h2>Solution 2: Strategy Pattern</h2><p>When discussing this question in the JS chat room in StackOverflow my friend <a href="https://stackoverflow.com/users/1386166/phenomnomnominal">phenomnomnominal</a> suggested the use of the <a href="http://en.wikipedia.org/wiki/Strategy_pattern" rel="nofollow noreferrer">Strategy pattern</a>.</p><p>This would allow you to add the abilities to pull rabbits out of various objects at run time, and would create very JavaScript&#39;y code. A  magician can <em>learn</em> how to pull objects of different types out of hats, and it pulls them based on that knowledge.</p><p>Here is how this might look in CoffeeScript:</p><pre><code>class Magician
  constructor: ()-&gt; # A new Magician can&#39;t pull anything
     @pullFunctions = {}

  pullRabbit: (obj) -&gt; # Pull a rabbit, handler based on type
    func = pullFunctions[obj.constructor.name]
    if func? then func(obj) else &#34;Don&#39;t know how to pull that out of my hat!&#34;

  learnToPull: (obj, handler) -&gt; # Learns to pull a rabbit out of a type
    pullFunctions[obj.constructor.name] = handler
</code></pre><p>You can see the equivalent JS code <a href="http://coffeescript.org/#try:class%20Magician%0A%20%20pullFunctions%20=%20%7B%7D%0A%0A%20%20pullRabbit:%20%28obj%29%20-%3E%0A%20%20%20%20func%20=%20pullFunctions%5Bobj.constructor.name%5D%0A%20%20%20%20if%20func?%20then%20func%28obj%29%20else%20%22Don%27t%20know%20how%20to%20pull%20that%20out%20of%20my%20hat!%22%0A%20%20%0A%20%20learnToPull:%20%28obj,%20handler%29%20-%3E%0A%20%20%20%20pullFunctions%5Bobj.constructor.name%5D%20=%20handler" rel="nofollow noreferrer">here</a>.</p><p>This way, you benefit from both worlds, the action of how to pull isn&#39;t tightly coupled to either the objects, or the Magician and I think this makes for a very nice solution.</p><p>Usage would be something like:</p><pre><code>var m = new Magician();//create a new Magician
//Teach the Magician
m.learnToPull(&#34;&#34;,function(){
   return &#34;Pulled a rabbit out of a string&#34;;
});
m.learnToPull({},function(){
   return &#34;Pulled a rabbit out of a Object&#34;;
});

m.pullRabbit(&#34; Str&#34;);
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-net-core-api-design-interfaces-vs-dtos/'>C# .Net Core API design &#8211; interfaces vs DTOs</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>