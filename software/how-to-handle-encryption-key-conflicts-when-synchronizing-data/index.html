<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to handle encryption key conflicts when synchronizing data &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086422 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086422" class="post-1086422 software type-software status-publish hentry category-software tag-data tag-encryption tag-usability"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to handle encryption key conflicts when synchronizing data</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">data</span><span class="mr-2 badge badge-info">encryption</span><span class="mr-2 badge badge-warning">usability</span></p><div class="entry-content"><p>Assume that there is data that gets synchronized between several devices. The data is protected with a symmetric encryption algorithm and a key. The key is stored on each device and encrypted with a password. When a user changes the password only the key gets re-encrypted.</p><p>Under normal circumstances, when there is a good network connection to other peers, the current key gets synchronized and all data on the new device gets encrypted with the same key.</p><p>But how to handle situations where a new device doesn’t have a network connection and e.g. creates its own new, but incompatible key? How to keep the usability as high as possible under such circumstances?</p><ol><li><p>The application could detect that there is no network and hence refuse to start. That’s very bad usability in my opinion, because the application isn’t functional at all in this case. I don’t consider this a solution.</p></li><li><p>The application could ignore the missing network connection and create a new key. But what to do when the application gains a network connection? There will be several incompatible keys and some parts of the underlying data could only be encrypted with one key and other parts with another key.</p></li><li><p>The situation would get worse if there would be more keys than just two and the application would’ve to ask every time for a password when another object that should get decrypted with another key would be needed.</p></li><li><p>It is very messy and time consuming to try to re-encrypt all data that is encrypted with another key with a <em>main</em> key. What should be the main key at all in this case? The oldest key? The key with the most encrypted objects? What if the key got synchronized but not all objects that got encrypted with this particular key? How should the user know for which particular password the application asks and why it takes probably very long to re-encrypt the data? It’s very hard to describe encryption “issues” to users.</p></li></ol><p>So far I didn’t find an acceptable solution, nor some kind of generic strategy. Do you have some hints about a concrete strategy or some books / papers that describe synchronization of symmetrically encrypted data with keys that could cause conflicts?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>While I don&#39;t know of any books/papers that discuss this exact problem,
it seems to me that
any solution to &#34;the synchronization problem&#34;,
paired with any solution to &#34;the avoid-re-encrypting-file-with-new-key problem&#34;,
should solve your original problem.
Each of those sub-problems have several solutions.</p><p><strong>The synchronization problem</strong></p><p>You have one &#34;common file&#34; (in this case, a symmetric key)
that, ideally, you want to be the same across all devices.
However, for one reason or another,
the data is somehow different from one device to the next -- <a href="http://en.wikipedia.org/wiki/Split-brain_(computing)" rel="nofollow noreferrer">split-brain syndrome</a> --
and you want all the devices connected to the network to
somehow reach a consensus as to whether to use version A from now on,
or use version B from now on, or perhaps some entirely new version C from now on.</p><p>There are three popular approaches:</p><ul><li>Restructure the application to give people the functionality they want, without ever having such a &#34;master key&#34;. In this case, the standard approach is to use public-key systems that let every device generate its own unique private key, then generate the public key from the private key, then (somehow) distribute the public keys.</li><li>Use some sort of <a href="http://en.wikipedia.org/wiki/quorum_(distributed_computing)" rel="nofollow noreferrer">quorum protocol</a> to come to consensus.</li><li>Somehow time-tag each version, and when any node discovers that there are two versions, it picks the newest version. (I suppose it could pick the oldest version, but that makes it difficult to upgrade).</li></ul><p>One of many possible solutions goes like this:</p><ul><li>If the common file does not already exist locally, and I can&#39;t seem to connect to any other devices and download the one they are using, go ahead and create a new version of the common file.</li><li>Later, when connected to the network and we see other devices, somehow (?) download the version of the common file of each of those other connected devices. If there is at least a quorum of other devices (say, 2 other devices), then start using the version of the common file used by most connected devices (the plurality). If there is a tie among the top N versions of this file, then pick one of those top N versions at random and start using it.</li></ul><p>In particular, if every device has a different version of this file,
then the <a href="http://en.wikipedia.org/wiki/birthday_problem" rel="nofollow noreferrer">&#34;birthday problem&#34;</a> practically guarantees that, after enough iterations of this algorithm, eventually 2 devices will pick the same version of the file,
and eventually all the online devices will converge on the same version of the file.</p><p><strong>The avoid-re-encrypting-file-with-new-key problem</strong></p><blockquote><p>All problems in computer science can be solved by another level of
indirection. But that usually will create another problem. --
attributed to David Wheeler in the book <em>Beautiful Code</em> (2007)</p></blockquote><p>As I understand it,</p><ul><li>You have (encrypted) data that is synchronized between multiple devices</li><li>You want to allow a person to change the passphrase on a device to some other passphrase of his own choosing, but you want this to be more-or-less &#34;instant&#34; rather than taking many minutes to decrypt and re-encrypt all the data.</li><li>Each device has its own passphrase that can be used to access the data on the device</li><li>You don&#39;t want unauthorized people to be able to decrypt the data (and &#34;has the passphrase for this device&#34; is an adequate proxy for &#34;is authorized to decrypt the data on this device&#34;).</li><li>You want to allow a person to create new encrypted data files before the device is ever connected to a network -- and therefore before the devices knows any shared encryption keys -- and later when the device is connected to the network, those files are synchronized to other devices where other people can decrypt and read those files.</li></ul><p>The standard way of doing that is to store the data in <a href="http://en.wikipedia.org/wiki/openpgp" rel="nofollow noreferrer">OpenPGP</a> format (as standardized in <a href="https://www.rfc-editor.org/rfc/rfc4880" rel="nofollow noreferrer">RFC 4880</a>). <a href="https://stackoverflow.com/questions/597188/encryption-with-multiple-different-keys">a</a> <a href="http://www.gnupg.org/gph/en/manual.html#AEN111" rel="nofollow noreferrer">b</a> <a href="https://crypto.stackexchange.com/questions/2666/hash-decrypts-key-key-decrypts-cipher-why">c</a> <a href="https://security.stackexchange.com/questions/8245/gpg-file-size-with-multiple-recipients">d</a> <a href="https://crypto.stackexchange.com/questions/425/how-can-two-different-passphrases-unlock-the-same-content">e</a></p><p>You already have one layer of indirection -- a person types a passphrase, which is used to decrypt the device-specific password.</p><p>The OpenPGP process uses a second layer of indirection:
Every file is encrypted with its own unique symmetric key.</p><p>It works something like this:</p><p>Every time new data is created or edited, a completely new symmetric key is generated,
the new key itself is encrypted with the user&#39;s public key and that encrypted key is stored in the header of the encrypted file. The data is encrypted with that new symmetric key and stored afterward in that encrypted file.
(This can all be done before the device ever connects to the network).</p><p>Later that encrypted file is synchronized unmodified over the network.
(Except the <em>sender</em> somehow obtains the <em>receiver&#39;s</em> device-specific key,
encrypts the file-specific symmetric key with the receiver&#39;s key,
and then adds that encrypted key to the file header).</p><p>To decrypt that file and read the data,</p><ul><li>A person types in the device-specific passphrase</li><li>The device uses that passphrase to decode a file containing the device-specific key. (This is exactly what you are doing already).</li><li>The device pulls the encrypted file-specific key out of the header of the file, and uses the device-specific key to decrypt the file-specific key. (This is a second layer of indirection).</li><li>Then the device uses the file-specific key to decrypt the data in the file.</li></ul><p>To make the system easier to change/migrate,</p><ul><li><p>Use an encrypted file format (such as OpenPGP) that specifies exactly which encryption algorithm was used for this particular file. That allows future software to detect which encryption algorithm was used to create a particular file. Then the device can decrypt today&#39;s shiny new files using today&#39;s shiny new preferred algorithm. The device can also decrypt dusty old files with yesterday&#39;s dusty old algorithms -- and optionally re-encrypt using today&#39;s shiny new preferred algorithm.</p></li><li><p>Use an encrypted file format (such as OpenPGP) that allows you to store the particular file-specific symmetric key in the header several times, each time encrypted with a different public key or device-specific key.</p></li></ul><p>When a user changes the passphrase, only the device-specific key gets re-encrypted, just like what you are doing already.</p><p>If for any reason the device-specific key needs to change,
then the device must re-encrypt the file-specific key in the header of each and every encrypted file it holds. That&#39;s probably faster than decrypting and re-encrypting the entire file.</p><p>Have you considered using some off-the-shelf implementation of OpenPGP, such as &#34;Pretty Good Privacy&#34; or &#34;GNU Privacy Guard&#34;?</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-i-need-advice-developing-a-sensitive-data-transfer-storage-encryption-system/'>C# &#8211; I need advice developing a sensitive data transfer/storage/encryption system</a></li><li class="list-group-item"><a href='../encrypting-the-data-and-keeping-it-safe-in-unity/'>Encrypting the data and keeping it safe in Unity</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>