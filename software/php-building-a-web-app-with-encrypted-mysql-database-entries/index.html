<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; Building a web app with encrypted MySQL database entries &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1064956 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1064956" class="post-1064956 software type-software status-publish hentry category-software tag-database tag-encryption tag-php tag-security tag-web"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; Building a web app with encrypted MySQL database entries</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">database</span><span class="mr-2 badge badge-info">encryption</span><span class="mr-2 badge badge-warning">PHP</span><span class="mr-2 badge badge-primary">Security</span><span class="mr-2 badge badge-danger">web</span></p><div class="entry-content"><p>I have some experience in building PHP based websites with MySQL access, storing encrypted user details, but all other fields being plain text. My most recent project will require sensitive data to be stored in the database. All of which I&#39;m hosting myself.</p><p>I want to set up a system where a user can access his own entries and see the plain text results, but even if he was able to access someone else&#39;s they would be encrypted, unintelligible strings.</p><p>I have an idea of how to accomplish this, but perhaps it&#39;s not optimal or there exist tools to do this already in a more efficient way.</p><ol><li>Store username as plain text, and password encrypted with sha1(). Or both encrypted with sha1().</li><li>Take the user&#39;s password (not the encrypted one, but the one he typed in and use it do define a key specific to that username and password, which will then be stored as a session variable.</li><li>Encrypt, or decrypt all of that users data with that key.</li></ol><p>In my opinion even if someone gained access to the database and saw a list of plain text usernames and encrypted passwords they couldn&#39;t figure out the specific key since it&#39;s not stored anywhere. Therefore even if access was gained, they couldn&#39;t decipher the content of the sensitive database fields. Of course I&#39;m building in ways to stop them accessing the database anyway, but as a catch-all effort this seems like a good set of steps.</p><p>Could the experts please comment on this, and offer some advice? Thanks a lot.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>According to <strong><code>MySQL</code></strong>, <strong>AES encryption</strong> (<strong><code>Advanced Encryption Standard</code></strong>) is the best method available for providing reversible encryption and decryption in SQL.</p><p>Formerly known as Rijndael, the <code>AES_ENCRYPT</code> and <code>AES_DECRYPT</code> functions are now built-in to <code>MySQL</code> so you can take user data, encrypt it with a salt, store it in your database, then extract it again later and decrypt it.</p><p>Define your salt</p><p>You&#39;ll need to apply a salt to the data that you encrypt. This is a special code that the encryption algorithm uses which works a bit like a key.</p><p>You&#39;ll need to provide the exact same key back to decrypt the data, and if an attacker should gain access to your database, they won&#39;t be able to decipher it without knowing the salt.</p><p>If you define your salt in PHP like this, you&#39;ll be able to pull the constant into your SQL statements more easily.</p><blockquote><p><strong><code>if(!define(&#39;SALT&#39;)) define(&#39;SALT&#39;,&#39;897sdn9j98u98jk&#39;);</code></strong></p></blockquote><p>To insert data into your MySQL database and encrypt the sensitive information, you&#39;ll need to issue a command like this, along with your salt.</p><blockquote><p><strong><code>INSERT INTO your_table (username,email,shoe size) VALUES (&#39;$username&#39;, AES_ENCRYPT(&#39;$email&#39;,&#39;&#34;.SALT.&#34;&#39;), AES_ENCRYPT(&#39;$shoesize&#39;,&#39;&#34;.SALT.&#34;&#39;));</code></strong></p></blockquote><p>This will insert the username in plain text, as it&#39;s non-sensitive, but encrypt the user&#39;s email and shoesize, to prevent them from being viewed without access to the salt.</p><p>At some point, you&#39;re going to need to access some of the data you stored in its encrypted form, and you can do this very easily using the AES_DECRYPT function of MySQL and the same salt you used when you encrypted the data and inserted it.</p><blockquote><p><strong><code>SELECT username, AES_DECRYPT(&#39;email&#39;,&#39;&#34;.SALT.&#34;&#39;) AS email,
 AES_DECRYPT(&#39;shoesize&#39;,&#39;&#34;.SALT.&#34;&#39;) AS shoesize FROM your_table WHERE username =&#39;fred&#39;;</code></strong></p></blockquote><p>If you SELECT the encrypted data without running it through AES_DECRYPT or with the wrong or no salt, you&#39;ll get an ugly, unreadable string of odd characters. This means if an attacker manages to access your database, but does not have access to your server to view the salt, they won&#39;t be able to read any of the data you&#39;ve stored. At least, not without going to great lengths to try and decrypt the data.</p><p>Updating encrypted records is very similar to insertion. Basically, you just apply the same salt and re-issue the AES_ENCRYPT command to re-encrypt the data again and lock it away safely.</p><blockquote><p><strong><code>UPDATE your_table SET email = AES_ENCRYPT(&#39;$email&#39;,&#39;&#34;.SALT.&#34;&#39;), shoesize = AES_ENCRYPT(&#39;$shoesize&#39;,&#39;&#34;.SALT.&#34;&#39;) WHERE username= &#39;fred&#39;;</code></strong></p></blockquote><p>Searching encrypted data using both AES_ENCRYPT and AES_DECRYPT</p><p>Things get a little bit more complicated when you need to search for data that&#39;s encrypted and then display it in its unencrypted form.</p><p>Say you wanted to search for a user using their email address, but you&#39;d encrypted that in the database. First, you&#39;d need to encrypt the email address you want to search for with AES_ENCRYPT and your salt, and then you&#39;d need to use AES_DECRYPT to ensure that MySQL decrypted it, returning it in a readable format.</p><p>You can achieve this, using code a bit like this:</p><blockquote><p><strong><code>SELECT user_username, 
 AES_DECRYPT(email,&#39;&#34;.SALT.&#34;&#39;) AS email,
 AES_DECRYPT(shoesize,&#39;&#34;.SALT.&#34;&#39;) AS shoesize 
 FROM your_table WHERE
 (email = AES_ENCRYPT(&#39;$q&#39;,&#39;&#34;.SALT.&#34;&#39;));</code></strong></p></blockquote><p>For further informations, please see this link: <a href="http://dev.mysql.com/doc/refman/5.1/en/encryption-functions.html" rel="noreferrer">http://dev.mysql.com/doc/refman/5.1/en/encryption-functions.html</a></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../php-should-i-encrypt-data-in-database/'>Php &#8211; Should I encrypt data in database</a></li><li class="list-group-item"><a href='../c-i-need-advice-developing-a-sensitive-data-transfer-storage-encryption-system/'>C# &#8211; I need advice developing a sensitive data transfer/storage/encryption system</a></li><li class="list-group-item"><a href='../passwords-be-encrypted-if-they-are-being-stored-in-a-secure-database/'>Passwords be encrypted if they are being stored in a secure database</a></li><li class="list-group-item"><a href='../c-what-kind-of-user-info-is-ok-to-be-stored-as-plain-text-in-sql-database/'>C# &#8211; What kind of user info is ok to be stored as plain text in SQL Database</a></li><li class="list-group-item"><a href='../encrypting-stored-data-for-multiple-unique-users-to-access-information/'>Encrypting stored data for multiple unique users to access information</a></li><li class="list-group-item"><a href='../where-to-store-hashes-salts-keys-in-desktop-applications/'>Where to store hashes, salts, keys in Desktop Applications</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>