<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Handling errors for non-exceptional cases in modern C++ &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085305 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085305" class="post-1085305 software type-software status-publish hentry category-software tag-c tag-c11 tag-c14 tag-error-handling"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Handling errors for non-exceptional cases in modern C++</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">c++11</span><span class="mr-2 badge badge-warning">c++14</span><span class="mr-2 badge badge-primary">error handling</span></p><div class="entry-content"><p>To hone my skills &#8211; and for the pleasure of it &#8211; I am writing a small game for my kids in modern C++ (C++11, C++14 and the part of C++17 already supported by Visual Studio), which is a nice break from my usual (enterprise) programming tasks.</p><p>I need a small interpreter for user input and of course I must handle erroneous input (think &#34;csat magic missile&#34; instead of &#34;cast magic missile&#34;). This is not exceptional, rather it is the norm that user input can be for some reason not well formed.</p><p>So I am looking for the recommended approach for handling this. I have read the <a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#S-errors" rel="nofollow noreferrer">C++ Core Guidelines</a> or <a href="https://softwareengineering.stackexchange.com/questions/147059/the-modern-way-to-perform-error-handling">other</a> questions on the site, and I have experimented with various approaches in my code.</p><p>In the end I have settled on changing all the relevant return types to something like</p><pre><code>std::tuple&lt;my_true_return_type, RetCode&gt; my_function(...);
</code></pre><p>where RetCode is an enum:</p><pre><code>enum RetCode{
SUCCESS,
WRONG_NUMBER_OF_INPUTS,
....
};
</code></pre><p>and each function call is done like:</p><pre><code>std::tie(result, error_code) = my_function(...);
</code></pre><p>This seems more or less in line with the guidelines and I can be rather systematic with it.</p><p>My only issue with this solution is that it may happen that I am able to detect an error before even constructing my_true_return_type and in this case I have to default construct it anyway, only to discard it at the calling point.</p><p>Something like</p><pre><code>if (an_erroneous_condition){
    // I have to default-construct a return type object, 
    // which I didn&#39;t really need 
    return std::make_tupe(my_true_return_type(), FAILURE); 
}
</code></pre><p>I could instead go for a Nullable return type (like the Maybe monad in Haskell), but at some cost.</p><p>In that case, I would have a relatively complex return type:</p><pre><code>std::tuple&lt;SomeNullableType&lt;my_true_return_type, ...&gt;, RetCode&gt;
</code></pre><p>and the resulting complexity at the calling point.<br /> Furthermore there is not yet a nullable type in the standard library <a href="https://www.reddit.com/r/cpp/comments/5oe74y/status_of_stdexpected_proposal/" rel="nofollow noreferrer">AFAIK</a>, or in Boost (there has been the proposal of Boost.Outcome but is still under evolution), so I would need to find another solution, or roll my one which is fun, too, but doesn&#39;t seem stricly needed for the purpose of coding a simple game. And in all probability my solution would be half-baked, not production ready.</p><p>If I go back to the exception route I get a simplified return code and I don&#39;t have to construct any object which I don&#39;t need, but it seems to me that exceptions are to be <a href="http://www.stroustrup.com/bs_faq2.html#exceptions-why" rel="nofollow noreferrer">reserved for exceptional cases</a> and not for what I expect to be very common occur</p><p>So my question is:</p><ul><li>how to handle, according to current best practice, and taking full advantage of all modern C++ technique, errors which are not exceptional situations?</li><li>if my way is reasonable, what can I do to ensure that the cost of the &#34;useless&#34; default constructed return type is minimized?</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Boost::variant and Boost::optional would be the libraries I recommend looking at.  They are tremendously effective at minimizing the extra costs of construction because they wont initialize a member unless there&#39;s data to initialize it with.</p><p>That being said, I would look at this from a higher level point of view.  Error handling is often terse, and it is a <em>major</em> complaint among users.  If it isn&#39;t terse, it&#39;s verbose! (anyone try to debug a boost template error that&#39;s 100 lines long?!)</p><p>Exceptional errors are handled tersely because they are exceptional.  The developer cannot be expected to flesh out how all of the exceptional errors should be handled.  Instead, they are rewarded for casting a wide net, catching lots of different errors, and then trying to return to a reasonable sane state before continuing.</p><p>IF you have non-exceptional errors, then that means you&#39;re thinking of them as part of your program&#39;s flow.  Give them the credit they deserve.  Don&#39;t just ask &#34;how can I catch these errors,&#34; but ask &#34;how would the user want to handle a mistake like this?&#34;</p><p>I often write parsers where providing a filename and line number is the difference between a hateful customer and an appreciative one.  So I make sure all of my error handling code can pass filenames and line numbers through them, even going so far as to make a &#34;stack trace&#34; of objects being manipulated at the moment the error occurred.</p><p>In the case of user input, the user likely not only wants to know that an error occurred, but have some feedback suggesting what the computer <em>thinks</em> the user wanted to do in the first place.  If you typed <code>csat magic missile</code>, the user may appreciate you passing around enough information to realize <code>csat</code> is the offending word, and that it has a very short hamming-distance from <code>cast</code>, so it was likely a typo.  This means you will likely want to be able to pass the incompletely parsed data into a smart algorithm that can try to heuristically guess what the user was thinking.</p><p>Once you start thinking that way, you&#39;ll find that many of the technical details such as constructors and memory utilization solve themselves.  Now, instead of error handling being &#34;that thing we do because we have to,&#34; it&#39;s a vibrant part of your program.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-the-modern-way-to-perform-error-handling/'>Design &#8211; The modern way to perform error handling&#8230;</a></li><li class="list-group-item"><a href='../c-return-magic-value-throw-exception-or-return-false-on-failure/'>C# &#8211; Return magic value, throw exception or return false on failure</a></li><li class="list-group-item"><a href='../java-ive-been-told-that-exceptions-should-only-be-used-in-exceptional-cases-how-to-know-if-the-case-is-exceptional/'>Java &#8211; I&#8217;ve been told that Exceptions should only be used in exceptional cases. How to know if the case is exceptional</a></li><li class="list-group-item"><a href='../c-intersection-of-geometric-entities/'>C++ &#8211; Intersection of geometric entities</a></li><li class="list-group-item"><a href='../c-idiomatic-usage-of-exceptions-in-c/'>C++ &#8211; Idiomatic usage of exceptions in C++</a></li><li class="list-group-item"><a href='../c-list-initialization-by-empty-braced-init-list-value-initialization-or-by-initializer_list-vs-explicit-default-initialization-for-list-types/'>C++ &#8211; List initialization by empty braced-init-list (value-initialization or by initializer_list) vs explicit default initialization, for &#8220;list&#8221; types</a></li><li class="list-group-item"><a href='../c-calling-a-static-method-from-constructors-member-initializer-list/'>C++ &#8211; Calling a static method from constructor&#8217;s member initializer list</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>