<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; Unit testing an API client and wrappers &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071860 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071860" class="post-1071860 software type-software status-publish hentry category-software tag-adapter tag-api tag-mocking tag-testing tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; Unit testing an API client and wrappers</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">adapter</span><span class="mr-2 badge badge-info">api</span><span class="mr-2 badge badge-warning">mocking</span><span class="mr-2 badge badge-primary">testing</span><span class="mr-2 badge badge-danger">unit testing</span></p><div class="entry-content"><p>I&#39;ve been going round in circles trying to figure out the best way to unit test an API client library I&#39;m developing. The library has a <code>Client</code> class which basically has a 1:1 mapping with the API, and an additional <code>Wrapper</code> class which provides a more user-friendly interface over the top of the <code>Client</code>.</p><pre><code>Wrapper --&gt; Client --&gt; External API
</code></pre><p>I first wrote a bunch of tests against both <code>Client</code> and <code>Wrapper</code>, effectively just testing that that they forward to the appropriate functions of whatever the operate on (<code>Wrapper</code> operates on <code>Client</code>, and <code>Client</code> operates on a HTTP connection). I started feeling uncomfortable with this, however, because I feel like I&#39;m testing the implementation of these classes, rather than the interface. In theory, I could change the classes to have another perfectly valid implementation, but my tests would fail because the functions I expected to be called aren&#39;t being called. That sounds like fragile tests to me.</p><p>After this, I thought about the interface of the classes. The tests should verify that the classes actually do the job they&#39;re meant to do, rather than how they do it. So how can I do this? The first thing that comes to mind is stubbing the external API requests. However, I&#39;m nervous about oversimplifying the external service. A lot of the examples of stubbed APIs I&#39;ve seen just give canned responses, which sounds like a really easy way to only test that your code happens to run correctly against your fake API. The alternative is mocking the service, which is just infeasible, and would need to be kept up to date whenever the real service changes &#8211; that feels like overkill and waste of time.</p><p>Finally, I read this from <a href="https://softwareengineering.stackexchange.com/a/252752/80257">another answer on the programmers SE</a>:</p><blockquote><p>The job of a remote API client is to issue certain calls &#8211; no more, no less. Therefore, its test should verify that it issues those calls &#8211; no more, no less.</p></blockquote><p>And now I&#39;m more or less convinced &#8211; when testing <code>Client</code>, all I need to test is that it makes the correct requests to the API (Of course, there&#39;s always the possibility that the API will change but my tests continue to pass &#8211; but that&#39;s where integration tests would come in useful). Since <code>Client</code> is just a 1:1 mapping with the API, my concern before about changing from one valid implementation to another doesn&#39;t really apply &#8211; there&#39;s only one valid implementation for each method of <code>Client</code>.</p><p>However, I&#39;m still stuck with the <code>Wrapper</code> class. I see the following options:</p><ol><li><p>I stub out the <code>Client</code> class and just test that the appropriate methods are called. In this way, I&#39;m doing the same as above but treating the <code>Client</code> as a stand-in for the API. This puts me right back where I started. Once again, this gives me the uncomfortable feeling of testing implementation, not interface. The <code>Wrapper</code> could very well be implemented using a completely different client.</p></li><li><p>I create a mock <code>Client</code>. Now I have to decide how far to go with mocking it &#8211; creating a complete mock of the service would take a lot of effort (more work than has gone into the library itself). The API itself is simple, but the service is quite complex (it&#39;s essentially a datastore with operations on that data). And again, I will have to keep my mock in sync with the real <code>Client</code>.</p></li><li><p>I just test that the appropriate HTTP requests are being made. This means that <code>Wrapper</code> will be calling through a real <code>Client</code> object to make those HTTP requests, so I&#39;m not actually testing it in isolation. This makes it a bit of a terrible unit test.</p></li></ol><p>So I&#39;m not particularly happy with any of these solutions. What would you do? Is there a right way to go about this?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><strong>TLDR</strong>: Despite the difficulty, you should stub the service and use for client unit testing.</p><hr/><p>I&#39;m not as certain that the &#34;job of a remote API client is to issue certain calls, no more, no less...&#34;, unless the API only consists of endpoints which always return a fixed status, and neither consume nor produce any data. This would not be the most useful API...</p><p>You&#39;d also want to check that the client not only <em>sends</em> the correct requests, but that it properly handles response content, errors, redirects, etc. And test for all these cases.</p><p>As you note, you should have integration tests that cover the full stack from wrapper -&gt; client -&gt; service -&gt; DB and beyond, but to answer your main question, unless you have an environment where integration tests can be run as part of every CI build without a lot of headaches (shared test databases, etc.), you should invest the time in creating a stub of the API.</p><p>The stub will let you create a working implementation of the service, but without having to implement any layer below the service itself.</p><p>You could consider using a DI-based solution to accomplish this, with an implementation of the Repository pattern underneath the REST resources:</p><ul><li>Replace all functional code in the REST handlers with calls to an IWhateverRepository.</li><li>Create a ProductionWhateverRepository with the code that was extracted from the REST resources, and a TestWhateverRespository which returns canned responses for use during unit testing.</li><li>Use the DI container to inject either the ProductionWhateverRepository or TestWhateverRepository DLL/class, etc. depending on configuration.</li></ul><p>Anyway, unless stubbing and/or refactoring the service is out of the question either politically or practically, I&#39;d probably undertake something similar to the above. If not possible, then I&#39;d make sure to have really good integration coverage and run them as often as possibly given your available test setup.</p><p>HTH</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-the-most-appropriate-testing-method-in-this-scenario/'>Unit-testing &#8211;  the most appropriate testing method in this scenario</a></li><li class="list-group-item"><a href='../java-how-and-should-i-unit-test-an-entire-package/'>Java &#8211; how and should I &#8216;unit test&#8217; an entire package</a></li><li class="list-group-item"><a href='../unit-testing-is-it-actually-worth-unit-testing-an-api-client/'>Unit-testing &#8211; Is it actually worth unit-testing an API client</a></li><li class="list-group-item"><a href='../unit-testing-how-to-avoid-the-need-to-unit-test-private-methods/'>Unit-testing &#8211; How to avoid the need to Unit test private methods</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>