<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; How to handle &#8220;conditional fields&#8221; in Java &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074529 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074529" class="post-1074529 software type-software status-publish hentry category-software tag-builder-pattern tag-java tag-patterns-and-practices"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; How to handle &#8220;conditional fields&#8221; in Java</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">builder-pattern</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">patterns-and-practices</span></p><div class="entry-content"><p>I&#39;ve run into several situations where a POJO where whether a field value is meaningful depends on the value of another field.  An example, using Lombok (which we try to use to avoid boilerplate):</p><pre><code>@Data
@Builder
public class SomePojo {
    // an enum whose values are DEFAULT_LOCATION, STANDARD_INPUT, FILE
    private final SourceType sourceType;

    // meaningful only if sourceType == FILE
    private final String path;

    private final String attributes;  
}
</code></pre><p>(This is just an example; the case I&#39;m now looking at has nothing to do with files.  If it makes a difference, the class&#39;s purpose is to be the return type of a method that needs to return several pieces of information to the caller.)</p><p>Although the class could be used as is, what are the best practices for dealing with this situation? Specifically:</p><ol><li><p>Should I write a custom getter method for <code>path</code> that throws an exception if <code>sourceType != FILE</code>?</p></li><li><p>Should I write a custom builder that throws an exception if the builder tries to set <code>path</code> when it sets <code>sourceType</code> to something other than <code>FILE</code>?</p></li><li><p>Should I write custom <code>equals()</code> and <code>hashCode()</code> that don&#39;t look at <code>path</code> if <code>sourceType != FILE</code>?</p></li><li><p>Should my builder or constructor set <code>path</code> to some fixed value if <code>sourceType != FILE</code>? Doing so would eliminate the need for special <code>equals()</code> and <code>hashCode()</code>.</p></li><li><p>Should I make path an <code>Optional&lt;String&gt;</code>?  Would it be enough to do this without doing any of #1-4?</p></li><li><p>Is it preferable to define a new class hierarchy to encapsulate the <code>sourceType</code> and <code>path</code> fields (so there would be three subclasses of some base class and only one of them would have a <code>path</code>)? Let&#39;s assume that there aren&#39;t any polymorphic methods in this hierarchy.</p></li></ol><p><b>MORE:</b> I agree with the comment that if a method returns a variant record, there&#39;s a good chance that the method is doing too much, and that needs to be checked.  But this isn&#39;t always the case.  A very simple example would be a method that searches a string to see if it contains a substring, and returns the position of the substring if present.  (Java&#39;s method to do this returns a special value as the &#34;position&#34; if the substring isn&#39;t present, which I&#39;d argue is a bad practice because it can introduce errors if a caller fails to check this case and treats the resulting position as a number. <code>Optional</code> would help in this case, but not in a case where there are more than two states to return.)  This seems to be a natural use case for returning either (FOUND, <code>position</code>) or (NOT_FOUND) which wouldn&#39;t have a position.  The case I&#39;m working with isn&#39;t quite that simple, but it&#39;s been examined thoroughly and has already been torn up a couple of times by colleagues in design reviews, so I&#39;m pretty sure that it&#39;s not a method that does too much.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>tl;dr As others have said, #6 is, design-wise, the best approach, and likely the best approach on other axes as well. The remainder of this is presenting various ways of doing #6 and how you might choose between them.</p><p>In a language with algebraic data types (or similar) such as most popular statically typed functional languages (Haskell, SML, O&#39;Caml, F#) but also Scala, Swift, Rust, it would be straightforward to represent such a type.  In Haskell syntax:</p><pre class="lang-hs prettyprint-override"><code>data Source
  = StdIn { attributes :: String }
  | DefaultLocation { attributes :: String }
  | File { attributes :: String, path :: String }
</code></pre><p>This can be encoded in virtually all object-oriented languages using dynamic dispatch:</p><pre class="lang-java prettyprint-override"><code>interface Source {
    string getAttributes();
}
class StdInSource implements Source {
    private string attributes;
    StdIn(string attributes) { this.attributes = attributes; }
    string getAttributes() { return this.attributes; }
}
// Similarly for DefaultLocationSource and FileSource, the latter taking also the path
</code></pre><p>Of course, as is, the only thing you can do given a <code>Source</code> is <code>getAttributes</code> and you probably want to do more than that. With algebraic data types, you could pattern match to recover the information in each case and dispatch on which case. This can be captured in the Java rendition:</p><pre><code>interface Source {
    &lt;A&gt; A match(Function&lt;string, A&gt; stdInCase, 
                Function&lt;string, A&gt; defaultLocationCase,
                BiFunction&lt;string, string, A&gt; fileCase);
}

// With now code like:
class StdInSource implements Source {
    // same as before
    &lt;A&gt; A match(Function&lt;string, A&gt; stdInCase, 
                Function&lt;string, A&gt; defaultLocationCase,
                BiFunction&lt;string, string, A&gt; fileCase) {
        return stdInCase.apply(this.attributes);
    }
}
</code></pre><p>This approach more or less captures the behavior of the algebraic data type, but it also captures some of the downsides. The <code>match</code> method is basically the <code>accept</code> method of the Visitor pattern. If we bundled all those <code>Function</code>s together into a class instead of having a bunch of parameters, the resulting object would basically be a visitor.  The Visitor pattern leads to some constraints on extensibility, roughly corresponding to the closed nature of algebraic data types.</p><p>In the ideal case for object-oriented programming, there would be some general service you want provided by <code>Source</code> and any implementors of the interface would be implementation details that don&#39;t matter to you. Let&#39;s say you only care about getting an input stream from these sources, then you can easily make an interface like:</p><pre><code>interface Source {
    InputStream getStream();
}
</code></pre><p>With such an interface, it&#39;s completely straightforward to add an additional option, say, for reading from an in-memory source. If you need to know whether a <code>Source</code> is a file or not so you know to close the file or something, that decision should be pushed into the objects by adding a <code>close</code> method to <code>Source</code> interface and letting the implementors decide what to do with it. Standard OOP advice is to always off-load these decisions onto objects and this is often good advice. It can become absurd though. Are you going to make a subclass of <code>Boolean</code> every time you do an <code>if</code>?</p><p>Roughly speaking, my viewpoint is that some objects are &#34;data&#34;. These should be &#34;value objects&#34;; immutable, inert, and mostly transparent. Other objects represent &#34;services&#34; and should be active, encapsulated, and often will be stateful. In my opinion, OOP practice largely focuses on this latter perspective. The algebraic data type approach is more appropriate for &#34;data&#34;-y objects, and often inappropriate for &#34;service&#34;-y objects. On the other hand, pushing decisions (and behavior) onto &#34;data&#34;-y objects is often the opposite of what you want to do. In this vein, it&#39;s interesting to see what an FP approach to extensibility would be.</p><p>The key thing is &#34;data&#34; doesn&#39;t have behavior. How a piece of data is interpreted is up to the consumer. Just because I have <code>File { attributes = &#34;&#34;, path = &#34;foo&#34; }</code> doesn&#39;t mean a consumer has to open file &#34;foo&#34;. That may be the intended, &#34;standard&#34; interpretation but other interpretations can exist side-by-side. It is a common theme in FP practice to use data to <em>describe</em> what you want to do, and then only later interpret it. One benefit of this approach is it becomes very easy to do &#34;global&#34; transformations/analyses of &#34;the plan&#34;. So the &#34;plan&#34; is &#34;data&#34;-y, but the interpreter of &#34;the plan&#34; is &#34;service&#34;-y. Indeed, it&#39;s easy to have a nice narrow, generic interface a la the <code>getStream</code> version of <code>Source</code>; namely, <code>interpret(Plan thePlan)</code>.</p><p>Data-oriented FP techniques are good for building/transforming/optimizing/analyzing a description of what to do which can then be used to orchestrate the behavior of active objects implemented with service-oriented OOP techniques. This frees the active objects from having to learn about their context are react appropriately which is often tricky and modularity-destroying code. As an example, it&#39;s very easy to take a list of (descriptions of) transformations representing a pipeline and recognize where certain transformations can be combined together or cancelled out. It&#39;s very difficult, on the other hand, for a particular (instance of a) transformation to tell that it actually cancels out the work of its upstream transformation, and it and the upstream transformation should be removed.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-best-practice-what-can-be-the-hashcode-method-implementation-if-custom-field-used-in-equals-method-are-null/'>Java &#8211; Best Practice: What can be the hashCode() method implementation if custom field used in equals() method are null</a></li><li class="list-group-item"><a href='../java-design-for-object-with-optional-and-modifiable-attributtes/'>Java &#8211; Design for object with optional and modifiable attributtes</a></li><li class="list-group-item"><a href='../java-how-to-implement-a-step-builder-for-which-the-order-of-setters-doesnt-matter/'>Java: How to implement a step builder for which the order of setters doesn&#8217;t matter</a></li><li class="list-group-item"><a href='../java-builder-with-constructor-or-factory-method/'>Java &#8211; Builder with constructor or factory method</a></li><li class="list-group-item"><a href='../java-when-to-call-the-constructor-and-when-to-call-the-method-in-java/'>Java &#8211; When to call the constructor and when to call the method in Java</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>