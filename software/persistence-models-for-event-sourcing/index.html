<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Persistence models for Event Sourcing &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086816 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086816" class="post-1086816 software type-software status-publish hentry category-software tag-event-programming tag-event-sourcing tag-persistence"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Persistence models for Event Sourcing</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">event-programming</span><span class="mr-2 badge badge-info">event-sourcing</span><span class="mr-2 badge badge-warning">persistence</span></p><div class="entry-content"><p>I am intrigued by the <a href="http://martinfowler.com/eaaDev/EventSourcing.html" rel="nofollow">Event Sourcing pattern</a> but am struggling to design an event sourcing model and put it in concrete form.</p><p>First off, I want to make sure that I understand the main use cases of this pattern. As I <em>understand</em> it, one uses event sourcing is to capture state changes in your app at different points in time so that you can:</p><ul><li>Replay events to rewind your app to a previous state; or</li><li>Replay events in another environment to recreate production at some point in time and troubleshoot it</li></ul><p><strong>So first off, if I have misunderstood the main use case(s) for event sourcing, or if I am missing any major ones, please begin by correcting me!</strong></p><hr/><p>Assuming I&#39;m more or less on track, my real mental roadblock lies with the event persistence model.</p><ul><li><strong>How many databases are there in an event sourcing system?</strong> Are there two databases (one for storing main entities, and another for storing the events)? Or is there just one database where all entities <em>are</em> the persisted events themselves?</li><li><strong>How do you capture events (and persist them!) for things that are totally outside the app&#39;s control?</strong> For example: the state of some 3rd party API that your app integrates with, or a message broker (and the state of all its messages/queues) that your app integrates with, runtime command-line arguments passed into your app, etc.?</li><li><strong>How does the replay mechanism <em>actually</em> work?</strong> So you have some entities. You have events describing state changes to those entities. You can read those events (and/or the entities they represent) out of the database, but then you need something to actually write those events somewhere else. So does this &#34;replayer&#34; just treat each subsequent event as an update to an existing entity?</li></ul><hr/><h3>My best attempt (thus far):</h3><p>The entity(ies):</p><pre><code>// Groovy pseudo-code
class Order {
    Long id
    Long userId
    Long paymentMethodId    // Perhaps an ID to a 3rd party system that
                            // is PCI compliant, etc.

    // Constructors, getters/setters, etc.
}

// Each &#39;Order&#39; has 1+ &#39;OrderLineItems&#39;
class OrderLineItem {
    Long id
    Long orderId
    Long productId    // &#39;Product&#39; is yet another entity, etc.
    Integer quantity

    // Constructors, getters/setters, etc.
}
</code></pre><p>The event:</p><pre><code>abstract class BaseEvent&lt;ENTITY&gt; {
    Date occurredOn
    Date recordedOn
    ENTITY entity

    BaseEvent(ENTITY entity) {
        super()

        this.occurredOn = new Date() // now
        this.entity = entity
    }
}

class OrderEvent extends BaseEvent&lt;Order&gt; {
    // Perhaps some other metadata about order events

    OrderEvent(Order order) {
        super(order)
    }
}
</code></pre><p>OK so this is a good step in the right direction, but still doesn&#39;t help me figure out how the &#34;replay mechanism&#34; will be able to load <code>OrderEvents</code> out of a database, and actually &#34;replay them&#34; to put another database into a particular state representing a single point in time.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>I want to make sure that I understand the main use cases of this pattern.</p></blockquote><p>Another nice use case described by Fowler is distributed storage. A cluster of systems with in-memory databases are kept up to date with each other through a stream of events.</p><blockquote><p>How many databases are there in an event sourcing system? Are there two databases (one for storing main entities, and another for storing the events)? Or is there just one database where all entities are the persisted events themselves?</p></blockquote><p>Main entities and events are separate objects and both are persisted, either in the same or in different databases.</p><blockquote><p>How do you capture events (and persist them!) for things that are totally outside the app&#39;s control?</p></blockquote><p>You&#39;ll need to wrap any external systems with a gateway. The gateway must be able deal with any replay processing that the Event Sourcing system is doing. See <a href="http://martinfowler.com/eaaDev/EventSourcing.html#ExternalUpdates" rel="nofollow noreferrer">sections &#39;External Updates/Queries/Interactions&#39;</a> of Fowler&#39;s description of this pattern.</p><blockquote><p>How does the replay mechanism actually work?</p></blockquote><p>Take Fowler&#39;s most basic example:</p><p><a href="../../../i.stack.imgur.com/rvPcg.jpg" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/rvPcg.jpg" alt="enter image description here"/></a></p><p>Each event object has a &#39;process&#39; method to perform the required update.
A replay works like this:</p><pre><code>for each Shipping Event e, in ascending order of e.occurred:
    e.process();
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../event-sourcing-and-persistence/'>Event sourcing and persistence</a></li><li class="list-group-item"><a href='../database-should-i-really-need-to-implement-event-sourcing-is-this-case/'>Database &#8211; Should I really need to implement event sourcing is this case</a></li><li class="list-group-item"><a href='../architecture-event-sourcing-sagas-bus-and-eventual-consistency/'>Architecture &#8211; Event Sourcing , sagas, bus and eventual consistency</a></li><li class="list-group-item"><a href='../c-event-sourcing-merging-aggregate-root-and-projection/'>C# &#8211; Event sourcing: merging aggregate root and projection</a></li><li class="list-group-item"><a href='../event-sourcing-one-event-state-of-two-aggregates-changed/'>Event sourcing, one event, state of two aggregates changed</a></li><li class="list-group-item"><a href='../is-there-something-dirty-about-using-a-non-linear-store-in-event-sourcing/'>Is there something &#8220;dirty&#8221; about using a non-linear store in Event Sourcing</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>