<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>DDD infrastructure layer: implement service+persistence or just persistence &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073129 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073129" class="post-1073129 software type-software status-publish hentry category-software tag-domain-driven-design tag-entity-framework tag-persistence tag-services"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">DDD infrastructure layer: implement service+persistence or just persistence</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">domain-driven-design</span><span class="mr-2 badge badge-info">entity-framework</span><span class="mr-2 badge badge-warning">persistence</span><span class="mr-2 badge badge-primary">services</span></p><div class="entry-content"><p>Short intro: I build an application, using .NET, Entity Framework (EF) as ORM and an SQL Server for persistence. My knowledge of SQL Server goes far beyond simple requests, and I use it to drastically cut on DB operations. Still I prefer to use EF to cut on writing direct SQL when possible.</p><p>I have an application service, f.e. IDogsService, which I would like to implement in the core. Implementation will have EF context (a repository) injected and should use the injected context for persistence. This is what I believe my architecture should be, according to DDD.</p><p>But I do everything differently. While IDogsService interface is in the core &#8211; implementation is in another project. And that implementation does not have any repository injected- it simply uses an internal db context, defined in the same project. The reason for such decision is simple: while core knows nothing about the repository, the IDogService&#39;s implementation may behave the way it wants, when it comes to persistance. And I believe the core should not care about repositories at all.</p><p>Pros of such approach: my db context is able to use all the benefits of SQL Server, therefore increasing performance. Cons: service&#39;s business logic is moved out of the core (I think it should stay in the core).</p><p>I have a strong feeling all of this is wrong and should be architected a little bit different. But do not know how. I really do not want to turn towards a repository pattern, since it will take away the benefits of SQL Server in favor of other RDBMS&#39;es.</p><p>Any experience to share?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It sounds to me as though you are getting your self twisted around the <a href="https://martinfowler.com/articles/dipInTheWild.html" rel="nofollow noreferrer">dependency inversion principle</a>.</p><p>I&#39;d suggest giving Greg Young&#39;s <a href="http://codebetter.com/gregyoung/2009/01/16/ddd-the-generic-repository/" rel="nofollow noreferrer">2009 essay on Generic Repositories</a> a long read.  The TL;DR is that in the common cases he prefers a contract with explicit definitions.</p><p>Udi Dahan, writing a few years earlier, <a href="http://udidahan.com/2007/03/06/better-domain-driven-design-implementation/" rel="nofollow noreferrer">had similar ideas</a>.</p><p>But the basic plot is that the domain code describes its data needs as explicitly as it can via contract interfaces.  The persistence components provide implementations that meet those contracts as efficiently as possible, and the <a href="http://blog.ploeh.dk/2011/07/28/CompositionRoot/" rel="nofollow noreferrer">composition roots</a> wire everything together.</p><blockquote><p>Cons: service&#39;s business logic is moved out of the core</p></blockquote><p>I agree that would be a negative, but that shouldn&#39;t be happening -- unless you are trying to specify the implementation of the persistence solution in the business module.</p><blockquote><p>Of course, I can revert to repository pattern, to become DB agnostic, but I will loose in performance</p></blockquote><p>No no no; DB agnostic is OK -- it&#39;s (probably) the vague contracts that fail to give the implementations enough information get you into trouble.</p><p>Keep the concerns separate; but make the contract explicit enough that the implementations that recognize that a use case is a perfect fit for some feature can take advantage.</p><p>Often, this pattern looks like an interface that describes what is needed by the core domain, an optimized implementation that can do the job well, and a thin adapter in the middle that understands how to negotiate between the two.</p><p>Mark Seemann&#39;s blog also includes a <a href="http://blog.ploeh.dk/2013/12/03/layers-onions-ports-adapters-its-all-the-same/" rel="nofollow noreferrer">good overview on dependencies</a>.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../should-i-use-the-repository-in-the-domain-object-or-push-the-domain-object-back-to-the-service-layer/'>Should I use the repository in the Domain Object or push the Domain Object back to the Service Layer</a></li><li class="list-group-item"><a href='../c-separation-of-concerns-between-repository-and-service-in-ddd-with-complex-entities/'>C# &#8211; Separation of concerns between repository and service in DDD with complex entities</a></li><li class="list-group-item"><a href='../php-ddd-creating-reusable-modules-and-service-type-distinctions-domain-infrastructure-application/'>Php &#8211; DDD: Creating reusable modules and service type distinctions (Domain, Infrastructure, Application)</a></li><li class="list-group-item"><a href='../architecture-should-i-use-a-layer-between-service-and-repository-for-a-clean-architecture-spring/'>Architecture &#8211; Should I use a layer between service and repository for a clean architecture &#8211; Spring</a></li><li class="list-group-item"><a href='../ddd-how-to-avoid-breaking-encapsulation-and-leaking-technical-concerns-to-the-domain-during-model-rehydration/'>DDD: How to avoid breaking encapsulation and leaking technical concerns to the domain during model rehydration</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>