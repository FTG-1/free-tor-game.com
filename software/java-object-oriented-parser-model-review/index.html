<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Object oriented parser model review &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1083315 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1083315" class="post-1083315 software type-software status-publish hentry category-software tag-android tag-java tag-parsing tag-regular-expressions"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Object oriented parser model review</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">android</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">parsing</span><span class="mr-2 badge badge-primary">regular expressions</span></p><div class="entry-content"><p>First time I make use of Code Review. At the moment I&#39;m creating an Android application and the company I&#39;m developing it for, has a specific file format that can be used to give text based data specific formatting rules. See it as an rich text format especially build and designed for their use.</p><h1><strong>The File format to work with</strong></h1><p>The file format was or at least is in my opinion designed to be used for pure formatting reasons and is actually not very well designed for data access. The Android application I&#39;m writing depends very strongly on data access, that being said I had to design a smart parser which is capable of transforming the formatted text to some kind of data model which could still have the formatting included.</p><p>A typical file could exist out of 600 lines of text having a total of 60000 characters. And could look like this:</p><pre><code>\id sit amet
\ide UTF-8
\rem File version: 2013-06-18
\rem Copyright 1995-2012
\t Lorem ipsum
\h 1
\st Nunc at urna
\p
\v 1 Lorem ipsum dolor sit amet, consectetur adipiscing elit.
\v 2 Suspendisse ac turpis quis diam elementum cursus sit amet non urna.
\pq Vestibulum vulputate \nd dui\nd* eget pharetra adipiscing.
\pq Suspendisse viverra metus quis feugiat rutrum.
\v 3 Nunc at urna vehicula, luctus quam convallis, adipiscing metus.
\v 4 Integer sit amet neque condimentum, laoreet neque ut, feugiat tellus.
\h 2
\v 1 Nam commodo orci et magna eleifend imperdiet.
\v 2 Cras a lorem ac nunc interdum lacinia.
\v 3 Integer vestibulum mauris id scelerisque lacinia.
\st Ut molestie nibh
\p
\v 4 Duis aliquam \nd diam\nd* nec nisl hendrerit posuere.
\v 5 Donec eget sapien id purus sollicitudin elementum non eget arcu.
\b
\v 6 Fusce auctor justo vitae aliquam luctus.
\v 7 Phasellus eget nisl at dui dignissim pharetra.
\v 8 Mauris iaculis mi at augue mattis, eu bibendum nunc placerat.
</code></pre><p>The <code>\h</code> marker and the <code>\v</code> marker are the most important markers they are used to identify the data using the integer behind it. The other makers are mostly irrelevant (like the <code>\id, \ide, \rem</code> markers), and some like <code>\pq</code> are used to append their data to the line above it but with some formatting applied to it. And some markers are &#34;in-text&#34; like the <code>\nd</code> marker.</p><p>Of course there are a lot of rules how the tags can be used in a valid file, but it&#39;s totally irrelevant for the review I think. (Or is there someone willing to read 90 pages?)</p><h1><strong>The structure of the parser</strong></h1><p>So I came up with the following (Object oriented) parsing model:</p><p>The parser has to be:</p><ul><li><strong>Able to separate DATA from FORMATTING</strong></li><li>Fast</li><li>separate the data and the formatting so both can be easily accessed</li><li>Able to parse a subset of data or a specific range of data from a file</li></ul><p>A selection of data is often referred as: File &#8211; Level &#8211; Sub-level(actual data)</p><p>Where the <code>file</code> is just a file to parse, the <code>level</code> an integer which can be found in the file by the <code>\h</code> marker and the <code>Sub-level</code> just like Level with the <code>\v</code> maker.</p><p>The parser I wrote returns an object which holds two lists &#8211; one with all the formatting and one with all the data.</p><pre><code>public class ParseResult {
    protected ArrayList&lt;FileData&gt; data = new ArrayList&lt;FileData&gt;();
    protected ArrayList&lt;FileFormat&gt; format = new ArrayList&lt;FileFormat&gt;();
}
</code></pre><p>The <code>FileData</code> object and the <code>FileFormat</code> object can be extended to create numerous different formats and data objects. This is the structure I use in the parser I wrote:</p><p>For data:</p><pre><code>FileData  
    -FileDataLocation extends FileData  
        -FileDataText extends FileDataLocation  
        -FileDataThing extends FileDataLocation  
    -FileDataAnotherThing extends FileData  
</code></pre><p>For formatting:</p><pre><code>FileFormat  
    -FileFormatLevel extends FileFormat  
    -FileFormatTitle extends FileFormat  
    -FileFormatSubLevel extends FileFormat  
    -FileFormatSpecialTokens extends FileFormat 
</code></pre><p>To use data from the parsed file I use the data <code>ArrayList</code>. To print the data formatted I loop trough the format <code>ArrayList</code> which is sorted so that the beginning of the file would be at the 0 index of the list and the end of the parsed file the last index of the list.</p><p><strong>Each formatting object has a reference to a data object in the data list. So that when using the formatting objects the data is always accessible. The formatting objects only hold information what peace of data the format should be applied to and what kind of formatting.</strong></p><h1><strong>Parsing method</strong></h1><p>When parsing a file the parser reads the file line by line and constantly keeps track of the <code>\h</code> and <code>\v</code> markers, and starts capturing data in the <code>ParseResult</code> object when a specific combination of the markers is found (Lets call that a location).</p><p>To check what type of marker the parser is dealing with I scan the line until I find the first whitespace. When a whitespace has been found a substring can be made from the start of the line to the location of the whitespace.</p><p>Comparing the substring with a list of known makers tells the parser what to do with the line.</p><p>After the marker is found the line is processed using regex. This is an example regex for a line with the <code>\v</code> marker:</p><pre><code>\v\s(([0-9]{1,3})(?:-([0-9]{1,3}))?)\s{1}(.+)[\n\r$]*
</code></pre><h1><strong>Review?</strong></h1><p>The performance of the parser is not bad at all, the largest files take about 600ms to process completely (9000 lines, 280000 characters).</p><p>Things I would like to know</p><ul><li>Data is now (after parsing) stored in just a list, searching for a specific peace of data is not very well optimized. Are there other structures I could use, which I can search using <code>file(string) - level(integer) - sub-level(integer)</code> so I can quickly get a specific data object.</li><li>When looping trough the formatting list I must check what instance an object belongs to, and then cast the object so I can use the specific methods and functions. Is there a better, other, alternative method?</li><li>The file format is pretty basic, should I consider removing all regex functions and parse it whole by just regular code?</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p><em>Data is now (after parsing) stored in just a list, searching for a specific peace of data is not very well optimized. Are there other structures I could use, which I can search using file(string) - level(integer) - sub-level(integer) so I can quickly get a specific data object.</em></p><p>Assuming that you want to search by <strong>File, Level, Sub-Level</strong> only, you have a clear hierarchical structure in that description, it sounds like you can divide one <code>ArrayList</code> into multiple steps. You could even make each hierarchy level a class itself to make it more clear, for example:</p><pre><code>class SomeFileData {
   List&lt;LevelData&gt; levels;
}

class LevelData {
   List&lt;SubLevelData&gt; sublevels;
}

class SubLevelData {
   // Probably similar to your current `FileData` implementation
}
</code></pre><p>And if you need to save multiple files at once, you can use a <code>Map</code> with the file name as key.</p><pre><code>class LotsOfFileData {
    Map&lt;String, SomeFileData&gt; files; 
}
</code></pre><p>Using this hierarchy, you can easily get file &#34;mydata.dat&#34;, level 3, sublevel 4.</p><pre><code>LotsOfFileData allData;
allData.getFile(&#34;mydata.dat&#34;).getLevel(3).getSublevel(4)
</code></pre><p>Each step in the <code>get</code> process looks at the current class&#39; list or map to retrieve the data.</p><p>By the way, <a href="https://stackoverflow.com/questions/1484445/why-are-variables-declared-with-their-interface-name-in-java">declare variables according to their interface, not their implementation</a>. Declare your <code>ArrayList</code>s as <code>List</code> to allow for easy change of implementation.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../python-parsing-scripts-that-use-curly-braces/'>Python &#8211; Parsing scripts that use curly braces</a></li><li class="list-group-item"><a href='../any-good-reason-to-open-files-in-text-mode/'>Any good reason to open files in text mode</a></li><li class="list-group-item"><a href='../java-storing-object-graphs-with-class-evolution-in-java-with-transformation-long-time-archiving/'>Java &#8211; Storing object-graphs with class-evolution in Java with transformation (long time archiving)</a></li><li class="list-group-item"><a href='../approach-for-parsing-and-indexing-very-large-files/'>Approach for parsing and indexing very large files</a></li><li class="list-group-item"><a href='../c-exception-hierarchy-and-use-of-what-message-for-parsing-strings/'>C++ &#8211; Exception Hierarchy and Use of What Message for Parsing Strings</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>