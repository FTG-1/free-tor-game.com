<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to make complex objects immutable &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086335 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086335" class="post-1086335 software type-software status-publish hentry category-software tag-immutability"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to make complex objects immutable</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">immutability</span></p><div class="entry-content"><blockquote><p>The example I&#39;m about to give is for the PHP language, but I think this scenario applies to most languages.</p></blockquote><p>Let&#39;s say I have an object called <code>Response</code> and I want it to be immutable. Every method should return a new instance rather than modifying the state of the current instance. <code>Response</code>s have headers, so I create a method called <code>withHeader($name, $value)</code> that makes a copy of my response object, sets the header, and returns the new instance. It&#39;s pretty simple to use:</p><pre><code>$newResponse = $oldResponse-&gt;withHeader(&#39;Content-Type&#39;, &#39;application/json&#39;);
</code></pre><p>Then I decide the headers actually have quite a few properties and I&#39;d rather separate this out into a separate object called a <code>HeaderBag</code>. Now I want my <code>Response</code> to hold a <code>HeaderBag</code> but I still want it to be immutable.</p><p>I can&#39;t make the the bag a public property, like <code>$response-&gt;headers</code> because even if the <code>$headers</code> object is immutable, the property can still be reassigned. So maybe I add something like <code>$response-&gt;getHeaders()</code> which returns my <code>HeaderBag</code> object, but now how do I manipulate it?</p><p>If I move my <code>withHeader</code> method into this sub-object, then I wind up with something like <code>$response-&gt;getHeaders()-&gt;withHeader(...)</code>. The <code>withHeader</code> method would presumably return a new <code>HeaderBag</code> since it too is immutable, but then what? I guess I&#39;d end up with something like this:</p><pre><code>$newResponse = $oldResponse-&gt;withHeaders($oldResponse-&gt;getHeaders()-&gt;withHeader($name, $value));
</code></pre><p>Which seems a bit ridiculous; to add a single value we have to clone two objects and write this abomination of a line. Sure, we can write a helper method on the <code>Response</code> object to shorten it, but the whole idea was to move all the header-related methods into the <code>HeaderBag</code> class.</p><p>Questions:</p><ol><li>Is there a better way to do this?</li><li>If there isn&#39;t, is it even worth the effort/cost to make objects immutable?</li><li>If we could design a new language with immutability in mind, what would this look like?</li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>An http response can naturally be thought of as immutable, but only from the moment that it has been fully constructed and <em>issued</em>.  Before that moment, various implementations of &#34;response&#34; classes in various environments are generally used as builders (see <em>Builder Pattern</em>) which get passed around in order for various routines to add to them piecemeal all the information that constitutes the final response.  So, during the lifetime of the response as a builder, it is by its very nature <em>mutable</em>.</p><p>Now, it is still possible to take a class which is mutable by nature and turn it into an immutable class, but what I would like to suggest to you is that although doing so might be a fabulous exercise on paper, (the entire series of Erik Lippert&#39;s articles on immutability was nothing short of fascinating,) it is not really something that you would want to be doing in practice with any non-trivial class, because you end up with abominations precisely like the one you discovered.  Plus, it is clearly not worth the effort, and it is stupendously wasteful in terms of computing resources.</p><p>So, my suggestion would be that if you really like the idea of an immutable response, (I like it too,) then rename your current response to <code>ResponseBuilder</code>, let it be mutable, and when it is complete, create an immutable response out of it and discard the builder.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-what-are-the-drawbacks-of-immutable-types/'>C# &#8211; What are the drawbacks of immutable types</a></li><li class="list-group-item"><a href='../java-why-doesnt-java-8-include-immutable-collections/'>Java &#8211; Why doesn&#8217;t Java 8 include immutable collections</a></li><li class="list-group-item"><a href='../changing-immutable-objects-how-does-this-work/'>Changing immutable objects how does this work</a></li><li class="list-group-item"><a href='../c-immutable-struct/'>C++ immutable struct</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>