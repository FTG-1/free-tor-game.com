<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; Fine-grained data level permissions on a laravel RESTful API &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081833 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081833" class="post-1081833 software type-software status-publish hentry category-software tag-laravel tag-permissions tag-php tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; Fine-grained data level permissions on a laravel RESTful API</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">laravel</span><span class="mr-2 badge badge-info">permissions</span><span class="mr-2 badge badge-warning">PHP</span><span class="mr-2 badge badge-primary">rest</span></p><div class="entry-content"><p><strong>The problem:</strong></p><p>We want to restrict access to properties returned from our services.</p><p><strong>Details:</strong></p><p>We have route level permissions working with no issue.</p><p>For a user that can view <code>/product/{id}</code> for example, that user may or may not have permission to view the <code>purchasePrice</code> property. (if they don&#39;t have permission it would either be empty or not exist in the JSON response) It seems by default laravel returns the entire record when you load the model.</p><p><strong>What we&#39;ve tried:</strong></p><p>We are currently dynamically populating <code>$visible[]</code> based on permissions and we have a list of every field and what permission is required to read/write.</p><p><strong>My Question:</strong></p><p>Is there a better way to do this? Are we reinventing the wheel or does this seem like a reasonable approach?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Separate your entities from your API response model. This is a case of SRP (Single Responsibility Principle): the job of your entities is to make DB access convenient. Your are adding two more responsibilities to that, violating the SRP:</p><ul><li>enforcing permissions</li><li>Serve as a public interface</li></ul><p>That means that there are two parts to this answer.</p><h2>having a public API</h2><p>A public API must be stable and backwards compatible unless stated to your users <strong>in the most explicit way possible</strong>. That means any change in your codebase that changes the public API should be carefully checked for backwards compatibility before releasing it to production. With your current approach, you&#39;ll have a very hard time doing so: say you want to rename a property of your entity. Fine, you did so, your IDE caught all the usages and renamed them. But what about other code that uses your API? It will break because it is still looking for the old name.
What you really want here is that you can change your entities and not affect the public API as long as all the information is still there. The solution: have separate classes for the API. For each Entity, have another class that (right  now) mirrors the Entity. When receiving input from the API, convert the JSON into these intermediate instances. Do validation and stuff <strong>and only then</strong> cop data to your entities. When giving data out, first convert your entities to those intermediate classes and then convert those to JSON.
Yes, that means more work. But it gives you flexibilities that you <strong>will 100% definitely need</strong> as soon as you have published your API. That work is now easier done than 30 features later.</p><h2>enforcing permissions</h2><p>You can now decide whether you want to include this responsibility in the API representation classes or whether you want it separately. You could also include this in the process of copying data from the entity to the representation class. It really depends on your codebase, team and preference. Just make sure that, wherever you place that code, the SRP is not violated.</p><h2>performance</h2><p>As has been said, you can go as far as to not even fetch fields from the DB that are not visible due to permissions. For regular fields the performance impact should be ignorable (except when we&#39;re talking about BLOB fields with several KB). 
But where this really matters is with related entities. If you can avoid three joins because they won&#39;t be used anyways, that&#39;s a definitive and huge speedup. See iipavlov&#39;s answer on that issue.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-api-wrapper-class-design-for-lite-object-responses/'>REST API wrapper &#8211; class design for &#8216;lite&#8217; object responses</a></li><li class="list-group-item"><a href='../rest-levels-of-user-permissions-in-a-restful-api/'>Rest &#8211; Levels of user permissions in a RESTful API</a></li><li class="list-group-item"><a href='../rest-how-to-handle-fine-grained-field-based-acl-permissions-in-a-restful-service/'>Rest &#8211; How to handle fine grained field-based ACL permissions in a RESTful service</a></li><li class="list-group-item"><a href='../rest-single-page-app-permissions-represented-through-restful-apis/'>Rest &#8211; Single page app permissions represented through RESTful APIs</a></li><li class="list-group-item"><a href='../javascript-permission-system-using-php-and-js/'>Javascript &#8211; Permission system using PHP and JS</a></li><li class="list-group-item"><a href='../how-to-efficiently-pass-permissions-that-control-view-and-access-of-specific-front-end-elements-from-backend-to-the-spa-using-jwt/'>How to efficiently pass permissions that control view and access of specific front-end elements from backend to the SPA using JWT</a></li><li class="list-group-item"><a href='../complex-roles-permissions-and-hierarchical-group-management-in-laravel/'>Complex roles, permissions and hierarchical group management in Laravel</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>