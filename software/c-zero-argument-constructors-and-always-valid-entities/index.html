<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Zero argument constructors and Always Valid entities &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078023 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078023" class="post-1078023 software type-software status-publish hentry category-software tag-c tag-cqrs tag-domain-driven-design tag-microservices"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Zero argument constructors and Always Valid entities</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">cqrs</span><span class="mr-2 badge badge-warning">domain-driven-design</span><span class="mr-2 badge badge-primary">microservices</span></p><div class="entry-content"><p>I have done a lot of reading recently about Always Valid domain entities.  I have come to believe that in order to ensure the entities are always valid I need to:</p><p>1) Remove primitive obsession and put validation/domain rules in the value object constructors as explained here: <a href="https://enterprisecraftsmanship.com/2016/09/13/validation-and-ddd/" rel="noreferrer">https://enterprisecraftsmanship.com/2016/09/13/validation-and-ddd/</a>.<br /> 2) Put validation/domain rules in the constuctor of entities or the property setters as explained here: <a href="http://gorodinski.com/blog/2012/05/19/validation-in-domain-driven-design-ddd/" rel="noreferrer">http://gorodinski.com/blog/2012/05/19/validation-in-domain-driven-design-ddd/</a>.</p><p>However, I then look at some Open Source projects such as this one: <a href="https://github.com/gregoryyoung/m-r" rel="noreferrer">https://github.com/gregoryyoung/m-r</a>.  From what I understand the author of this project is an advocate of the always valid domain model and yet I look here at the InventoryItem class: <a href="https://github.com/gregoryyoung/m-r/blob/master/SimpleCQRS/Domain.cs" rel="noreferrer">https://github.com/gregoryyoung/m-r/blob/master/SimpleCQRS/Domain.cs</a>.  I notice that I am able to do this:</p><pre><code>InventoryItem inventoryItem = new InventoryItem();
</code></pre><p>or this:</p><pre><code>InventoryItem inventoryItem2 = new InventoryItem(Guid.Empty,null);
</code></pre><p>In my mind this means the entity is initialised in an invalid state.  This seems to be the case in all of the other Open Source projects I have looked at recently as well e.g. this one: <a href="https://github.com/dcomartin/DDD-CQRS-ES-Example/blob/master/src/Domain/Customer.cs" rel="noreferrer">https://github.com/dcomartin/DDD-CQRS-ES-Example/blob/master/src/Domain/Customer.cs</a>.</p><p>I realise there is Contextual validation in these open source project (<a href="https://martinfowler.com/bliki/ContextualValidation.html" rel="noreferrer">https://martinfowler.com/bliki/ContextualValidation.html</a>).  I also realise that ORMs need a default empty constructor if mapped to the domain model.</p><p>Is a domain object in a valid state if it is initialised with default values using a zero arguement constructor/initialised with empty/null values?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Before I address the kinds of considerations that go into object creation, let&#39;s first address the motivation behind your question: the phrase &#34;Always Valid Domain Entities&#34;. This phrase is, at best, misleading, and makes little sense in the context of DDD. This should be apparent for two related reasons:</p><p>The first is that it implicitly shifts your focus away from the behavior of the system, instead, asking you to consider validation only in terms of state. While superficially this may seem to make sense (of course validation is in terms of state!), you must remember that the fundamental principal of DDD is that a system is modeled according to <em>behavior</em>. The motivation for this is quite simply that the context, or the <em>business process</em> itself, is often an important consideration when determining whether or not some piece of state is valid. Modeling a system in this way can <em>greatly</em> reduce it&#39;s complexity.</p><p>This brings us to the second reason, which is in regard to the practical requirements such a system would entail. In order to create a system of &#34;Always Valid Domain Entities&#34;, it would require one to model every single permutation of state according to the business processes in which the state is used. A simple example can illustrate the limitations of this:</p><p>Rules:</p><ul><li><code>Customer</code> must be over 18 to register</li><li><code>Customer</code> must be under 25 to qualify for discount on registration</li><li><code>Customer</code> must be over 25 to make reservation</li></ul><p>The first thing you should notice is that all of these rules (like nearly all rules) apply to some business process. They don&#39;t exist in a vacuum. These rules would be validated on <code>customer.Register()</code> and <code>customer.Reserve()</code>. This results in a much more descriptive and declarative paradigm because it&#39;s clear where rules are executing.</p><p>If we wanted to model these rules such that it results in system of &#34;Always Valid Domain Entities&#34; we would need to partition our <code>Customer</code> into <code>Registrar</code> and <code>Reserver</code> entities. And while that might not seem so bad for this example, as rules become more complex and abundant you will end up with an explosion classes like this that represent state &#34;within&#34; some context or process. This is simply unnecessary and will inevitably create issues when two such objects are dependent on the same slice of state.</p><p>Additionally, something like <code>Customer c = new Customer()</code> is a bad place to throw an exception because it&#39;s unclear what business rules might apply. Which brings us to our final discussion.</p><p>I am just going to come out and go as far to say that there should be <em>zero</em> validation of business rules happening in constructors. Object construction has nothing at all to do with your business domain, and for that reason, in addition to the reasons above concerning context and coherence, all business rules should be enforced within an entity&#39;s method bodies (it&#39;s likely methods are named after business processes right?).</p><p>Furthermore, &#34;newing&#34; up an object is <em>not</em> the same thing as creating a new entity in your domain. Objects don&#39;t come out of nowhere. If there are business rules regarding how a new entity can come into your system, then it should be modeled <em>in your domain</em>. Here is some further discussion on the topic by a true master <a href="http://udidahan.com/2009/06/29/dont-create-aggregate-roots/" rel="noreferrer">http://udidahan.com/2009/06/29/dont-create-aggregate-roots/</a></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-the-best-way-to-apprach-validation-from-the-perspective-of-a-ddd-purist/'>C# &#8211;  the &#8220;best&#8221; way to apprach validation from the perspective of a DDD purist</a></li><li class="list-group-item"><a href='../c-is-it-acceptable-for-a-domain-entity-to-implement-an-interface/'>C# &#8211; Is it acceptable for a Domain Entity to implement an interface</a></li><li class="list-group-item"><a href='../c-should-i-mock-a-domain-service/'>C# &#8211; Should I mock a Domain Service</a></li><li class="list-group-item"><a href='../c-is-it-normal-for-a-domain-model-not-to-have-an-id/'>C# &#8211; Is it normal for a Domain Model not to have an ID</a></li><li class="list-group-item"><a href='../c-use-a-hashset-or-list-for-a-collection-of-entities/'>C# &#8211; Use a HashSet or List for a collection of Entities</a></li><li class="list-group-item"><a href='../message-bus-v-mediator-pattern-v-in-memory-bus/'>Message Bus v Mediator pattern v In Memory Bus</a></li><li class="list-group-item"><a href='../c-ddd-how-to-do-informative-validation-specifically-on-entity-creation/'>C# &#8211; DDD &#8211; How to do informative validation (specifically on entity creation)</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>