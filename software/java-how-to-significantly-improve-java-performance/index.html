<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; How to significantly improve Java performance &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068115 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068115" class="post-1068115 software type-software status-publish hentry category-software tag-architecture tag-java tag-performance"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; How to significantly improve Java performance</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">performance</span></p><div class="entry-content"><p>The team over at LMAX have a presentation about how they were able to do <a href="http://martinfowler.com/articles/lmax.html" rel="noreferrer">100k TPS at less than 1Â ms of latency</a>. They have backed up that presentation with <a href="http://blogs.lmax.com/" rel="noreferrer">a blog</a>, <a href="http://disruptor.googlecode.com/files/Disruptor-1.0.pdf" rel="noreferrer" title="pdf">technical paper (PDF)</a> and <a href="http://code.google.com/p/disruptor/" rel="noreferrer">the source code</a> itself.</p><p>Recently, <a href="http://en.wikipedia.org/wiki/Martin_Fowler" rel="noreferrer">Martin Fowler</a> published an <a href="http://martinfowler.com/articles/lmax.html" rel="noreferrer">excellent paper on the LMAX architecture</a> and mentions that they are now able to handle six million orders per second and highlights a few of the steps that the team took to go up another order of magnitude in performance.</p><blockquote><p>So far I&#39;ve explained that the key to the speed of the Business Logic<br /> Processor is doing everything sequentially, in-memory. Just doing this (and<br /> nothing really stupid) allows developers to write code that can process 10K TPS.</p><p>They then found that concentrating on the simple elements of good code could<br /> bring this up into the 100K TPS range. This just needs well-factored code and<br /> small methods &#8211; essentially this allows Hotspot to do a better job of<br /> optimizing and for CPUs to be more efficient in caching the code as it&#39;s<br /> running.</p><p>It took a bit more cleverness to go up another order of magnitude. There are<br /> several things that the LMAX team found helpful to get there. One was to write<br /> custom implementations of the Java collections that were designed to be<br /> cache-friendly and careful with garbage.</p><p>Another technique to reach that top level of performance is putting attention<br /> into performance testing. I&#39;ve long noticed that people talk a lot about<br /> techniques to improve performance, but the one thing that really makes a<br /> difference is to test it</p></blockquote><p>Fowler mentioned that there are several things that were found, but he only mentioned a couple.</p><p>Are there other architectures, libraries, techniques or &#34;things&#34; that are helpful to reach such levels of performance?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>There are all kinds of techniques for high-performance transaction processing and the one in Fowler&#39;s article is just one of many at the bleeding edge.  Rather than listing a bunch of techniques which may or may not be applicable to anyone&#39;s situation, I think it&#39;s better to discuss the basic principles and how LMAX addresses a large number of them.</p><p>For a high-scale transaction processing system you want to do all of the following as much as possible:</p><ol><li><p>Minimize time spent in the slowest storage tiers.  From fastest to slowest on a modern server you have: CPU/L1 -&gt; L2 -&gt; L3 -&gt; RAM -&gt; Disk/LAN -&gt; WAN.  The jump from even the fastest modern magnetic disk to the slowest RAM is over 1000x for <em>sequential</em> access; random access is even worse.</p></li><li><p>Minimize or eliminate time spent <em>waiting</em>. This means sharing as little state as possible, and, if state <em>must</em> be shared, avoiding explicit locks whenever possible.</p></li><li><p>Spread the workload.  CPUs haven&#39;t gotten much faster in the past several years, but they <em>have</em> gotten smaller, and 8 cores is pretty common on a server.  Beyond that, you can even spread the work over multiple machines, which is Google&#39;s approach; the great thing about this is that it scales <em>everything</em> including I/O.</p></li></ol><p>According to Fowler, LMAX takes the following approach to each of these:</p><ol><li><p>Keep <em>all</em> state in memory at <em>all</em> times.  Most database engines will actually do this anyway, <strong>if</strong> the entire database can fit in memory, but they don&#39;t want to leave anything up to chance, which is understandable on a real-time trading platform.  In order to pull this off without adding a ton of risk, they had to build a bunch of lightweight backup and failover infrastructure.</p></li><li><p>Use a lock-free queue (&#34;disruptor&#34;) for the stream of input events. Contrast to traditional durable <a href="http://en.wikipedia.org/wiki/Message_queue">message queues</a> which are definitively <em>not</em> lock free, and in fact usually involve painfully-slow <a href="http://en.wikipedia.org/wiki/Distributed_transaction">distributed transactions</a>.</p></li><li><p>Not much. LMAX throws this one under the bus on the basis that workloads are interdependent; the outcome of one changes the parameters for the others.  This is a <em>critical</em> caveat, and one which Fowler explicitly calls out. They do make <em>some</em> use of concurrency in order to provide failover capabilities, but all of the business logic is processed on a <em>single thread</em>.</p></li></ol><p>LMAX is <em>not</em> the only approach to high-scale OLTP.  And although it&#39;s quite brilliant in its own right, you do <em>not</em> need to use bleeding-edge techniques in order to pull off that level of performance.</p><p>Of all of the principles above, #3 is probably the most important and the most effective, because, frankly, hardware is cheap.  If you can properly partition the workload across half a dozen cores and several dozen machines, then the sky&#39;s the limit for conventional <a href="../../../en.wikipedia.org/wiki/Parallel_computing.html">Parallel Computing</a> techniques.  You&#39;d be surprised how much throughput you can pull off with nothing but a bunch of message queues and a round-robin distributor.  It&#39;s obviously not as efficient as LMAX - actually not even close - but throughput, latency, and cost-effectiveness are separate concerns, and here we&#39;re talking specifically about throughput.</p><p>If you have the same sort of special needs that LMAX does - in particular, a shared state which corresponds to a business reality as opposed to a hasty design choice - then I&#39;d suggest trying out their component, because I haven&#39;t seen much else that&#39;s suited to those requirements. But if we&#39;re simply talking about high scalability then I&#39;d urge you to do more research into distributed systems, because they are the canonical approach used by most organizations today (Hadoop and related projects, ESB and related architectures, CQRS which Fowler also mentions, and so on).</p><p>SSDs are also going to become a game-changer; arguably, they already are.  You can now have permanent storage with similar access times to RAM, and although server-grade SSDs are still horribly expensive, they will eventually come down in price once adoption rates grow. <a href="http://guyharrison.squarespace.com/blog/2010/10/21/accelerating-oracle-database-performance-with-ssd.html">It&#39;s been researched extensively</a> and the results are pretty mind-boggling and will only get better over time, so the whole &#34;keep everything in memory&#34; concept is a lot less important than it used to be.  So once again, I&#39;d try to focus on concurrency whenever possible.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-when-how-and-why-should-one-upgrade-java-frameworks/'>Java &#8211; When, how and why should one upgrade (Java) frameworks</a></li><li class="list-group-item"><a href='../java-why-did-the-team-at-lmax-use-java-and-design-the-architecture-to-avoid-gc-at-all-cost/'>Java &#8211; Why did the team at LMAX use Java and design the architecture to avoid GC at all cost</a></li><li class="list-group-item"><a href='../database-how-to-handle-foreign-key-constraints-when-migrating-from-monolith-to-microservices/'>Database &#8211; How to handle foreign key constraints when migrating from monolith to microservices</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>