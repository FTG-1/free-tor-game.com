<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211;  the best solution for static memory allocation &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069205 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069205" class="post-1069205 software type-software status-publish hentry category-software tag-allocation tag-c tag-memory"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211;  the best solution for static memory allocation</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">allocation</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">memory</span></p><div class="entry-content"><p>I&#39;m working on image processing and I need to use big Images in a critical system.</p><p>A good practice for critical systems is to avoid dynamic allocation of memory but what is the design/recommendations for static memory allocation?</p><p>If we do a static allocation of a big matrix we get stack overflow.</p><pre><code>class test
{
    public:
        test(){};
        ~test(){};

    private:
        float m_bigMatrix[3000000];
};
</code></pre><p>To solve this problem we can define the matrix as static, but then this matrix will be the same for all the instance of this class.</p><pre><code>static float m_bigMatrix[3000000];
</code></pre><p>The other solution is to have a static object.</p><pre><code>static test t;
</code></pre><p>I&#39;ve got a solution from another forum where it was suggested that the<br /> best approach would be to use a class specific for memory management.</p><p>All the instances of the class are static and are used by other classes throughout the code.</p><p>Here is a sloppy version for this solution (it&#39;s just an example):</p><pre><code>class MemManager
{
public:
    MemManager(){ m_counter = 0u; }
    ~MemManager(){ printf(&#34;Out of MemManager nbr %d\n&#34;, m_counter); }

    uint16_t getCounter() { return m_counter; }
    uint16_t getData(uint32_t pos) { return m_data[pos]; }

    void setCounter(uint16_t val) { m_counter = val; }
    void setData(uint16_t val, uint32_t pos) { m_data[pos] = val; }

private:
    static const uint32_t MEM_SIZE_DATA = 100000000u;
    uint16_t m_counter;
    uint16_t m_data[MEM_SIZE_DATA];

protected:
};

class MemUser
{
public:
    MemUser(){ m_memManager = NULL; }
    ~MemUser(){ printf(&#34;Out of MemUser\n&#34;); }

    void init(MemManager&amp; memManager) { m_memManager = &amp;memManager; };
    uint16_t getCounter() { return m_memManager-&gt;getCounter(); }
    uint16_t getData(uint32_t pos) { return m_memManager-&gt;getData(pos); }

    void setCounter(uint16_t val) { m_memManager-&gt;setCounter(val); }
    void setData(uint16_t val, uint32_t pos) { m_memManager-&gt;setData(val, pos); }

private:
    MemManager *m_memManager;

protected:
};

int main()
{
    static MemManager mManager;
    mManager.setCounter(1);
    {
        MemUser mUser;
        mUser.init(mManager);
        printf(&#34;Exit scope\n&#34;);
    }
    for(uint8_t i = 1u; i&lt;5u; i++)
    {
        static MemManager mManager2;
        printf(&#34;Note that mManager2 is the same: %d\n&#34;, mManager2.getCounter());
        mManager2.setCounter(i);
    }
    printf(&#34;Exit process\n&#34;);
    return 0;
}
</code></pre><p>So, is this correct? What is the best solution?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The whole point of avoiding dynamic memory allocation is that if your program has enough memory to complete initialization, then you know for a certainty you won&#39;t hit an out of memory condition in the middle of your program, under some borderline set of conditions you hadn&#39;t thought of.</p><p>Writing your own memory manager defeats that benefit.  In fact, it makes it <em>less</em> safe. Instead of running out of heap with the built in memory manager that is highly tested, optimized, and used by millions of programmers, you are instead running out of memory on an untested memory manager, written by programmers who probably haven&#39;t written a memory manager before, and used only by you.</p><p>If you&#39;re getting stack overflows from your object being too large, the solution is to not allocate the object on the stack, as in your <code>static test t;</code> or <code>static float m_bigMatrix[3000000];</code>.  Yes, it&#39;s annoying.  Yes, it goes against your instincts from what you&#39;ve been taught are best practices on non-critical systems.  That&#39;s just how it goes.</p><p>One compromise I&#39;ve seen is to only avoid dynamic <em>deallocation</em>, and make sure to perform all your dynamic allocation when the program first starts up.  This makes it feel more natural, but still gives you the benefit of a known memory bound.  However, it&#39;s much more difficult to audit.  When I worked before on critical systems, this was only allowed in very exceptional circumstances.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../manual-memory-allocation-and-purity/'>Manual memory allocation and purity</a></li><li class="list-group-item"><a href='../why-is-the-main-memory-for-object-allocation-called-the-heap/'>Why is the main memory for object allocation called the &#8216;heap&#8217;</a></li><li class="list-group-item"><a href='../c-what-are-the-consequences-of-no-virtual-destructor-for-this-base-class/'>C++ &#8211; What are the consequences of no virtual destructor for this base class</a></li><li class="list-group-item"><a href='../java-why-dont-constructor-return-bool-to-indicate-its-success-or-failure-without-having-to-throw-an-exception/'>Java &#8211; Why don&#8217;t constructor return bool to indicate its success or failure without having to throw an exception</a></li><li class="list-group-item"><a href='../c-why-does-the-base-class-need-to-have-a-virtual-destructor-here-if-the-derived-class-allocates-no-raw-dynamic-memory/'>C++ &#8211; Why does the base class need to have a virtual destructor here if the derived class allocates no raw dynamic memory</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>