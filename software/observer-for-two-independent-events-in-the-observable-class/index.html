<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Observer for two independent events in the observable class &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073991 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073991" class="post-1073991 software type-software status-publish hentry category-software tag-design-patterns tag-observer-pattern"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Observer for two independent events in the observable class</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design-patterns</span><span class="mr-2 badge badge-info">observer-pattern</span></p><div class="entry-content"><p>Observer pattern aim: the observer class responds to the changes of the observable class state.</p><p><strong>Problem.</strong> There are different processes inside observable class that should be observed. Those events are independent and the state is not single value but rather itself is a set of different processes.</p><p>That might be bad design, the observable class is too big and should be split into smaller ones. But what if we cannot refactor that class and we have to observe it.</p><p><strong>Question.</strong> Should we have single Observer for all state changes (processes, events). Or should we create one Observer for each state change (process, event).</p><p>Or maybe applying observer is the bad idea at all and another design pattern should bu used.</p><h1>Example</h1><p>The example might look as artificial for the observer pattern but should be viewed as minimal example.</p><p>Consider search form where user can look for:</p><ul><li>author</li><li>title</li><li>both author and title</li></ul><p>There is the <code>Reader</code> class responsible for getting the parameters.</p><p>There is additional task: store words that the users are looking for in the file (simplified logger). We want to store author values in one file and title values in the another.<br /> We do not want add any responsibilities for the <code>Reader</code> class nor extend it. We want observe its inner state.</p><p>One state change (event) happens when the author parameter is read from the form.<br /> Second state change (event) happens when the title parameter is read from the form.<br /> Those events are independent. We are not interested in whole <code>Reader</code> state (only author, only title, title and author). We are interested only in states of parameter readers (author read or not) (title read or not).</p><h2>One observer for all events</h2><p>When observer is notified, it does not know which event happened. The additional property <code>whichState</code> is introduced. The observer must check its value (<code>SEARCH_BY_AUTHOR</code> or <code>SEARCH_BY_TITLE</code>)  in the <code>update()</code> method.</p><p><a href="../../../i.stack.imgur.com/SJOLA.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/SJOLA.png" alt="enter image description here"/></a></p><p>Code:</p><pre class="lang-php prettyprint-override"><code>&lt;?php
class Reader implements \SplSubject 
{
    private $observers;    
    public $author = null;
    public $title = null;    
    // additional property to determine which state is observed
    public $whichState = null;
    // states
    const SEARCH_BY_AUTHOR = &#39;author&#39;;
    const SEARCH_BY_TITLE  = &#39;title&#39;;

    public function __construct() 
    {
        $this-&gt;observers  = new \SplObjectStorage();
    }

    public function attach(\SplObserver $observer) 
    {
        $this-&gt;observers-&gt;attach($observer);
    }

    public function detach(\SplObserver $observer) 
    {
        $this-&gt;observers-&gt;detach($observer);
    }

    public function notify() 
    {
        foreach ($this-&gt;observers as $observer) {
            $observer-&gt;update($this);
        }
    }

    /* simulates reading from form */
    public function readParams(array $params)
    {
        if (array_key_exists(&#39;author&#39;, $params) === true) {
            $this-&gt;author     = $params[&#39;author&#39;];
            $this-&gt;whichState = Reader::SEARCH_BY_AUTHOR;
            $this-&gt;notify();
        }
        if (array_key_exists(&#39;title&#39;, $params) === true) {
            $this-&gt;title      = $params[&#39;title&#39;];
            $this-&gt;whichState = Reader::SEARCH_BY_TITLE;
            $this-&gt;notify();
        }
    }
}

class BothParamsObserver implements \SplObserver
{
    public function update(\SplSubject $subject) 
    {
        if ($subject-&gt;whichState === Reader::SEARCH_BY_AUTHOR) {
            $author = $subject-&gt;author . &#34;\r\n&#34;;
            file_put_contents(&#34;authors.txt&#34;, $author, FILE_APPEND);
        }
        elseif ($subject-&gt;whichState === Reader::SEARCH_BY_TITLE) {
            $title  = $subject-&gt;title  . &#34;\r\n&#34;;
            file_put_contents(&#34;titles.txt&#34;, $title, FILE_APPEND);
        }
    }
}

$reader = new Reader();
$bothParamsObserver = new BothParamsObserver();
$reader-&gt;attach($bothParamsObserver);

file_put_contents(&#34;authors.txt&#34;, &#34;&#34;);
file_put_contents(&#34;titles.txt&#34;, &#34;&#34;);
// simulate receiving forms 
$reader-&gt;readParams(array(&#34;title&#34; =&gt; &#34;PHP&#34;));
$reader-&gt;readParams(array(&#34;author&#34; =&gt; &#34;Zandstra&#34;));
$reader-&gt;readParams(array(&#34;title&#34; =&gt; &#34;PHP&#34;, &#34;author&#34; =&gt; &#34;Zandstra&#34;));
?&gt;
</code></pre><h2>Two observers, each for one event</h2><p>The observers are duplicated inside the observable class. There is one collections <code>authorObservers</code> and the other <code>titleObservers</code>. There are methods <code>attachAuthorObserver()</code>, <code>detachAuthorObserver()</code>, <code>notifyAuthorObservers()</code> and there are methods <code>attachTitleObserver()</code>, <code>detachTitleObserver()</code>, <code>notifyTitlerObservers()</code>.</p><p><a href="../../../i.stack.imgur.com/D8Bxh.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/D8Bxh.png" alt="enter image description here"/></a></p><p>Code</p><pre class="lang-php prettyprint-override"><code>&lt;?php
class Reader
{
    private $authorObservers;
    private $titleObservers;
    public $author = null;
    public $title = null;    

    public function __construct() 
    {
        $this-&gt;authorObservers = new \SplObjectStorage();
        $this-&gt;titleObservers  = new \SplObjectStorage();
    }

    public function attachAuthorObserver($observer) 
    {
        $this-&gt;authorObservers-&gt;attach($observer);
    }

    public function attachTitleObserver($observer) 
    {
        $this-&gt;titleObservers-&gt;attach($observer);
    }

    public function detachAuthorObserver($observer) 
    {
        $this-&gt;authorObservers-&gt;detach($observer);
    }

    public function detachTitleObserver($observer) 
    {
        $this-&gt;titleObservers-&gt;detach($observer);
    }

    public function notifyAuthorObservers() 
    {
        foreach ($this-&gt;authorObservers as $observer) {
            $observer-&gt;update($this);
        }
    }

    public function notifyTitleObservers() 
    {
        foreach ($this-&gt;titleObservers as $observer) {
            $observer-&gt;update($this);
        }
    }

    /* simulates reading from form */
    public function readParams(array $params)
    {
        if (array_key_exists(&#39;author&#39;, $params) === true) {
            $this-&gt;author     = $params[&#39;author&#39;];
            $this-&gt;notifyAuthorObservers();
        }
        if (array_key_exists(&#39;title&#39;, $params) === true) {
            $this-&gt;title      = $params[&#39;title&#39;];
            $this-&gt;notifyTitleObservers();
        }
    }
}

class AuthorObserver
{
    public function update($subject) 
    {
        $author = $subject-&gt;author . &#34;\r\n&#34;;
        file_put_contents(&#34;authors.txt&#34;, $author, FILE_APPEND);
    }
}

class TitleObserver
{
    public function update($subject) 
    {
        $title  = $subject-&gt;title  . &#34;\r\n&#34;;
        file_put_contents(&#34;titles.txt&#34;, $title, FILE_APPEND);
    }
}

$reader = new Reader();
$authorObserver = new AuthorObserver();
$titleObserver = new TitleObserver();
$reader-&gt;attachAuthorObserver($authorObserver);
$reader-&gt;attachTitleObserver($titleObserver);

file_put_contents(&#34;authors.txt&#34;, &#34;&#34;);
file_put_contents(&#34;titles.txt&#34;, &#34;&#34;);
// simulate receiving forms
$reader-&gt;readParams(array(&#34;title&#34; =&gt; &#34;PHP&#34;));
$reader-&gt;readParams(array(&#34;author&#34; =&gt; &#34;Zandstra&#34;));
$reader-&gt;readParams(array(&#34;title&#34; =&gt; &#34;PHP&#34;, &#34;author&#34; =&gt; &#34;Zandstra&#34;));
</code></pre><h1>Update: solution</h1><p>Specific solution based on Robert Harvey&#39;s answer.</p><p><a href="../../../i.stack.imgur.com/qxPs0.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/qxPs0.png" alt="enter image description here"/></a></p><p>Code</p><pre class="lang-php prettyprint-override"><code>&lt;?php
class Reader implements \SplSubject 
{
    private $observers;    
    public $author = null;
    public $title = null;    
    // additional property to determine which state is observed
    public $whichState = null;
    // states
    const SEARCH_BY_AUTHOR = &#39;author&#39;;
    const SEARCH_BY_TITLE  = &#39;title&#39;;

    public function __construct() 
    {
        $this-&gt;observers  = new \SplObjectStorage();
    }

    public function attach(\SplObserver $observer) 
    {
        $this-&gt;observers-&gt;attach($observer);
    }

    public function detach(\SplObserver $observer) 
    {
        $this-&gt;observers-&gt;detach($observer);
    }

    public function notify() 
    {
        foreach ($this-&gt;observers as $observer) {
            $observer-&gt;update($this);
        }
    }

    /* simulates reading from form */
    public function readParams(array $params)
    {
        if (array_key_exists(&#39;author&#39;, $params) === true) {
            $this-&gt;author     = $params[&#39;author&#39;];
            $this-&gt;whichState = Reader::SEARCH_BY_AUTHOR;
            $this-&gt;notify();
        }
        if (array_key_exists(&#39;title&#39;, $params) === true) {
            $this-&gt;title      = $params[&#39;title&#39;];
            $this-&gt;whichState = Reader::SEARCH_BY_TITLE;
            $this-&gt;notify();
        }
    }
}

class AuthorObserver implements \SplObserver
{
    public function update(\SplSubject $subject) 
    {
        if ($subject-&gt;whichState === Reader::SEARCH_BY_AUTHOR) {
            $author = $subject-&gt;author . &#34;\r\n&#34;;
            file_put_contents(&#34;authors.txt&#34;, $author, FILE_APPEND);
        }
    }
}

class TitleObserver implements \SplObserver
{
    public function update(\SplSubject $subject) 
    {
        if ($subject-&gt;whichState === Reader::SEARCH_BY_TITLE) {
            $title  = $subject-&gt;title  . &#34;\r\n&#34;;
            file_put_contents(&#34;titles.txt&#34;, $title, FILE_APPEND);
        }
    }
}


$reader = new Reader();
$authorObserver = new AuthorObserver();
$titleObserver = new TitleObserver();
$reader-&gt;attach($authorObserver);
$reader-&gt;attach($titleObserver);

file_put_contents(&#34;authors.txt&#34;, &#34;&#34;);
file_put_contents(&#34;titles.txt&#34;, &#34;&#34;);
// simulate receiving forms 
$reader-&gt;readParams(array(&#34;title&#34; =&gt; &#34;PHP&#34;));
$reader-&gt;readParams(array(&#34;author&#34; =&gt; &#34;Zandstra&#34;));
$reader-&gt;readParams(array(&#34;title&#34; =&gt; &#34;PHP&#34;, &#34;author&#34; =&gt; &#34;Zandstra&#34;));
?&gt;
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It should be <em>two</em> observers.</p><p>Your Reader object should <em>not</em> have observer-specific attach and detach methods.  Rather, it should have two methods for registering and de-registering concrete observer objects in a single observer collection.</p><p><a href="../../../i.stack.imgur.com/DeiEI.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/DeiEI.png" alt="Observer Pattern illustration from Wikipedia"/></a></p><p><sub><a href="https://en.wikipedia.org/wiki/Observer_pattern" rel="nofollow noreferrer">Wikipedia</a></sub></p><p>You can still use <code>Reader:WhichState</code> in your concrete observers to determine whether or not each concrete observer should take any action.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../object-oriented-implementation-of-observer-pattern-with-one-observer-multiple-publishers-and-multiple-events/'>Object-oriented &#8211; Implementation of observer pattern with one observer/multiple publishers and multiple events</a></li><li class="list-group-item"><a href='../using-observer-pattern-to-selectively-act-on-events/'>Using Observer Pattern to selectively act on events</a></li><li class="list-group-item"><a href='../architecture-is-using-observer-pattern-a-good-idea-while-building-a-chess-game/'>Architecture &#8211; Is using Observer pattern a good idea while building a Chess Game</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>