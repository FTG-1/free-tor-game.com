<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Domain Driven Design &#8211; updating part of aggregate &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084113 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084113" class="post-1084113 software type-software status-publish hentry category-software tag-domain-driven-design tag-node-js tag-repository-pattern"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Domain Driven Design &#8211; updating part of aggregate</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">domain-driven-design</span><span class="mr-2 badge badge-info">node.js</span><span class="mr-2 badge badge-warning">repository-pattern</span></p><div class="entry-content"><p>I&#39;m playing around with DDD in a node.js project and struggling with updates to child entities from the aggregate root.</p><p>For the sake of example, let&#39;s say I have two domain objects where <code>Event</code> is my aggregate root:</p><pre><code>class Event {
  _id
  _date
  _comments = []
}

class Comment {
  _id
  _name
  _content
}
</code></pre><p>I understand that DDD dictates that an <code>EventRepository</code> is in charge of saving any changes to the AR and child entities and hides all the persistence details. So I should call something like <code>EventRepository.save(event)</code> at this point and be done.</p><p>Let&#39;s say that an event currently has 3 comments and a user has edited the content of the second comment. The implication now is that my repository needs to fetch my event and comments and compare with my domain objects to figure out which need to be persisted. That&#39;s doable but seems inefficient when the reality is I know that only one comment needs to be updated. It would also be simple to add another repository for comments but now I&#39;ve veered away from pure DDD. I&#39;ve seen discussions of the <a href="https://martinfowler.com/eaaCatalog/unitOfWork.html" rel="nofollow noreferrer">Unit of Work</a> pattern but I&#39;m not sure how this ties into my repository. It would also be simple enough to just have some sort of <code>_isDirty</code> on all my domain objects but now I&#39;ve polluted them with persistence information.</p><p>I&#39;m not sure it&#39;s relevant to the design pattern I&#39;m struggling with but I&#39;m doing this POC with objection.js and Postgres. Appreciate any feedback.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your fears are perfectly valid, and they are an everyday part of DDD.</p><p>You can design your domain in many ways. For one thing, always keep in mind that the aggregate is the boundary of transactional consistency. That means that a single aggregate <em>must be</em> saved atomically, while several aggregates may be saved in distinct transactions. Updates lost on one aggregate should not affect the other aggregates. I am sure you&#39;re well aware of these considerations, but very often people loose them from sight when modeling a demanding domain.</p><p>The second issue you are mentioning, the cost of fetching the entire aggregate, is also perfectly valid and it happens all the time. However, the question comes: Did you really prove by measuring that performance is poor? If there is evidence backing your fears, then you should take some action. Otherwise, you might consider doing nothing, too.</p><p>So, finally, to some practical advice. I don&#39;t know your domain and this might not be applicable, but did you consider promoting comment to be the aggregate, too? If one element of the aggregate is adding disproportionate cost compared to everything else, then it often makes sense to design around it and turn it into its own boss.</p><p>The second observation is purely practical. Since we are all programming for the real world, and performance is a realistic metric, I don&#39;t think that stepping aside from &#34;pure DDD&#34; and updating only one entity from an aggregate without truly materializing the entire aggregate is a crime. As long as that aggregate&#39;s consistency rules are observed, you won&#39;t make a mistake. This has a downside that some operations are treated special compared to other operations on the same aggregate, possibly leading to certain duplication of logic, but again - that is not a crime.</p><p>Note that on purely topological grounds, these two pieces of advice are isomorphic. Either you promote the comment to become an aggregate and then update one of them at a time, or you simply turn the blind eye and update one entity from an aggregate at a time... From point of view of the database, it will update one object inside a transaction. Therefore, these two approaches have the same end.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../domain-services-vs-factories-vs-aggregate-roots/'>Domain Services vs. Factories vs. Aggregate Roots</a></li><li class="list-group-item"><a href='../should-i-use-the-repository-in-the-domain-object-or-push-the-domain-object-back-to-the-service-layer/'>Should I use the repository in the Domain Object or push the Domain Object back to the Service Layer</a></li><li class="list-group-item"><a href='../domain-driven-design-with-eventual-consistency/'>Domain driven design with eventual consistency</a></li><li class="list-group-item"><a href='../c-ddd-identifying-aggregate-root-in-a-simple-example-application-domain/'>C# &#8211; DDD: Identifying aggregate root in a simple example application domain</a></li><li class="list-group-item"><a href='../ddd-is-an-aggregate-root-responsible-for-deleting-its-child-entities-from-their-repository/'>DDD: Is an aggregate root responsible for deleting its child entities from their repository</a></li><li class="list-group-item"><a href='../c-pitfalls-of-domain-driven-design-with-entity-framework/'>C# &#8211; Pitfalls of Domain Driven Design with Entity Framework</a></li><li class="list-group-item"><a href='../c-domain-driven-design-navigation-properties-and-aggregate/'>C# &#8211; Domain Driven Design // Navigation Properties and Aggregate</a></li><li class="list-group-item"><a href='../domain-driven-design-updating-and-persisting-aggregates/'>Domain Driven Design &#8211; Updating and persisting aggregates</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>