<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; A design decision in composition or aggregation &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1088007 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1088007" class="post-1088007 software type-software status-publish hentry category-software tag-design-patterns tag-domain-driven-design tag-java"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; A design decision in composition or aggregation</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design-patterns</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">java</span></p><div class="entry-content"><p>I&#39;ve recently had doubts about some design decisions that I frequently make, so this time I decided to take some time and try to analyze it to find the best solution. I will describe a simple scenario where the design decision can be easily understood. ðŸ™‚</p><p>Suppose we are developing a game in Java where players can have any number of many different types of items.</p><pre><code>/** Class that represent an item type existing in the game */
// you may prefer to call this ItemType,
// but for me appending the word &#34;Type&#34; is not necessary
class Item {
    private String descrip;
    private Image icon;
}
</code></pre><p>In this situation I need to keep track of how many of each item the player has in his bag, so I keep a collection of them, in each element of which I have item type and quantity. Additionally one can think of other attributes that belong to that relation (perhaps a max capacity), but the question is: how do I model this scenario in general but with a practical implementation in Java? Here are two approaches I&#39;ve come up with:</p><h3>Using a List</h3><pre><code>class Slot {
    private Item item;
    private int quantity;

    /** Auto generated */
    public int hashCode()
    {
        int hash = 7;
        hash = 13 * hash + (this.item != null ? this.item.hashCode() : 0);
        return hash;
    }

    /** This method is also auto generated and just compares the Item, 
        independent of quantity */
    public boolean equals(Object object) 
    {
        if (!(object instanceof Slot))
        {
            return false;
        }
        Slot other = (Slot) object;
        if ((this.item == null &amp;&amp; other.item != null) 
             || (this.item != null &amp;&amp; !this.item.equals(other.item)))
        {
            return false;
        }

        return true;
    }
}
</code></pre><p>The above class relates one item with a quantity, and a collection of <code>Slot</code>s is the primary attribute of the <code>Inventory</code> class. The disadvantages of this appear as soon I design the <code>Inventory</code> interface to not expose <code>Slot</code> to the client (making <code>Slot</code> private or hiding it in some other way): in creating a simple interface but providing access to all the standard collection methods. In my humble opinion there is nothing wrong with this:</p><pre><code>/** Class that represent the bag that holds the player&#39;s items */
class Inventory {
   // this collection holds only one element for each type of item
   private ArrayList&lt;Slot&gt; slots; 

    public Inventory()
    {
        slots = new ArrayList&lt;Slot&gt;(10);
    }

    public void add(Item item, int quantity)
    {
        Slot slot = new Slot(item, quantity);
        // if we don&#39;t already have a Slot for the added Item, add it
        if (!slots.contains(slot))
        {
            slots.addElement(slot);
        }
        // if we already have a Slot for the added Item, increase the quantity
        else
        {
            Slot _slot = slots.elementAt(slots.indexOf(slot));
            _slot.addQuantity(quantity);
        }
    }

    public void subtract(Item item, int quantity)
    {
        Slot slot = new Slot(item, 0); 
        int index = slots.indexOf(slot);

        // only if we actually have this item
        if (index != -1) 
        {
            Slot _slot = (Slot) slots.elementAt(index);
            _slot.quantity -= quantity;

            // if we have fewer of the Item than the number to remove, 
            // remove the slot from the collection
            if (_slot.quantity &lt;= 0)
            {
                slots.removeElementAt(index);
            }
        }
    }

    public void remove(Item item)
    {
        Slot slot = new Slot(item,0);
        slots.removeElement(slot);
    }

    public boolean hasItem(Item item)
    {
        Slot slot = new Slot(item,0);
        return slots.contains(slot);
    }
}
</code></pre><p>As you see, we have to jump through some hoops to implement certain collection methods: in <code>hasItem</code> we have to create a <code>Slot</code> element just for that operation. In the add and subtract methods, we have to create the <code>Slot</code> object just to check if it&#39;s there.<br /> I wonder if this really necessary. I suppose that it is if we desire to provide an interface to the standard collection methods. Perhaps we can move all this logic to another class (for example: <code>Slots</code>), exposing a cleaner interface that lets us search by item without the need of creating a Slot, but we are just moving the same problem to another class. We will face the same problem there, besides the fact that <code>Inventory</code> is basically a set of <code>Slot</code>s, we&#39;re really just creating another class to be exactly the same thing, which doesn&#39;t make a lot of sense to me.</p><p>Would it be more correct to change the interface of this class to work directly with <code>Slot</code> class instead? This implies moving from composition (having <code>Slot</code>s created within Inventory) to an aggregation (having <code>Slot</code> creation outside of Inventory). The result might look like:</p><pre><code>/** Class that represent the bag that holds the player&#39;s items */
class Inventory {
   private ArrayList&lt;Slot&gt; slots;

    public Inventory()
    {
        slots = new ArrayList&lt;Slot&gt;(10);
    }

    public void add(Slot slot)
    {
        if (!slots.contains(slot))
        {
            slots.addElement(slot);
        }
        else
        {
            Slot _slot = slots.elementAt(slots.indexOf(slot));
            _slot.addQuantity(slot.getQuantity());
        }
    }

    public void subtract(Slot slot, int quantity) // how would the client get the Slot?
    {
        int index = slots.indexOf(slot);

        // only if we actually have this item
        if (index != -1) 
        {
            Slot _slot = (Slot) slots.elementAt(index);
            _slot.quantity -= quantity;

            // if we have fewer of the Item than the number to remove, 
            // remove the slot from the collection
            if (_slot.quantity &lt;= 0)
            {
                slots.removeElementAt(index);
            }
        }
    }

    public void remove(Slot slot) // again, how would the client get the Slot?
    {
        slots.removeElement(slot);
    }

    // Hard to change a parameter type here. This strongly suggest there is
    // a flaw in the design. I only keep this here to communicate the observation
    public boolean hasItem(Item item) 
    {
        Slot slot = new Slot(item, 0); // here we have no choice but to create it
        return slots.contains(slot);
    }
}
</code></pre><p>But again, is this convenient? I don&#39;t often put this approach into practice, so I&#39;m not sure.</p><h3>Using a lookup</h3><p>Another approach is to use something like a Hashtable with <code>Item</code> objects as keys quantities as values, so only quantity is associated with Items, without the need for a <code>Slot</code> class. An <code>Inventory</code> implementation using Hashtable might look like:</p><pre><code>public class Inventory
{
    private Hashtable items;

    public Inventory()
    {
        items = new Hashtable(10);
    }

    public void add(Item item, int amount)
    {
        int stock = amount;
        if (items.containsKey(item))
        {
            stock += ((Integer) items.get(item)).intValue();
        }
        items.put(item, new Integer(stock));
    }

    public void subtract(Item item, int amount)
    {
        if (items.containsKey(item))
        {
            int stock = ((Integer) items.get(item)).intValue();
            stock -= amount;
            if (stock &gt; 0)
            {
                items.put(item, new Integer(stock));
            }
            else
            {
                items.remove(item);
            }
        }
    }

    public void remove(Item item)
    {
        this.items.remove(item);
    }

    public boolean hasItem(Item item)
    {
        return this.items.containsKey(item);
    }
}
</code></pre><p>To me this seems much better than using a List because there is no need of the <code>Slot</code> class, and all interactions with the <code>Item</code> collection are much simpler, but I&#39;m not sure if I&#39;m right.</p><p>The same type of problem is also evident in this scenario:<br /> Suppose that we are implementing an order application for a pizza shop; every order consists of types of pizzas and quantities.</p><pre><code>/** Type of pizza */
class Pizza {
    private String descrip;
    private Image icon;
}

/** Customer request for pizza */
class Request {
    // for each type of pizza we have to keep a count of how many the customer ordered
}

/** A pizza order */
class Order {
    private Pizza pizza;
    private int   amount;
    privete BigDecimal price;
}
</code></pre><p>Knowing how to solve the first problem, I have a pattern to use for this similar situation; so the question is, what solution is best?</p><p>I try to convince myself that I&#39;m not the only person with this concern, that ordinary people like me face this problem on a regular basis, so I hope to find how other people solve this problem. On the other hand, I know that this question is quite big and maybe a little elaborate, so maybe I need to split it into several more specific questions. Maybe the answer to this problem is simple I&#39;m over-complicating things, or even worse, my doubts about how to handle this situation arise because I really don&#39;t understand some basic design principle, like a captain on a ship using a spyglass in order to sight land but doesn&#39;t realize that his ship has been beached on solid ground that was close at the moment he draw his spyglass to look. Okay, enough cheap poetry (but it was hard to describe my feelings without it hehehe).</p><p>I apologize for the length of the question, and would very much appreciate anyone&#39;s help with this problem.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>There&#39;s a lot to say here.</p><ol><li><code>Inventory</code>&#39;s api looks like a <a href="http://www.infoq.com/presentations/Value-Objects-Dan-Bergh-Johnsson" rel="nofollow">value object</a> (since it has no identity, on its own, I suppose that it belongs to a <code>Player</code>). If so, it should be immutable, returning a new instance each time you add or remove an <code>Item</code>.</li><li>Your <code>Item</code> class looks like a <a href="http://epic.tesio.it/doc/manual/shared_identifiers.html" rel="nofollow">shared identifier</a>, thus it should override <code>equals</code> and <code>hashcode</code> and (strictly speaking, in DDD term) it should not hold any reference to the <code>icon</code> since it&#39;s not useful for its own invariants. You <strong>should</strong> use a <a href="http://domainlanguage.com/ddd/patterns/DDD_Reference_2011-01-31.pdf" rel="nofollow">domain service</a> that take the Item and provide the proper icon instead (probably wrapping a statically defined Hashtable). However, be pragmatic with this: if you <strong>measure</strong> actual performance issues with such (formally correct) approach, keep the field there.</li><li>The <code>Slot</code>, as it stands, cannot be considered a domain object, because it does not implement equality in a domain relevant way (it ignores the quantity). This is perfecly correct for a <strong>private</strong> class internally used by the <code>Inventory</code>, but should not be exposed to clients (as in the second <code>Inventory</code>&#39;s implementation of the first solution you proposed). This because the clients could compare for equality two <code>Slot</code>s from two different players, obtaining unreliable results.</li><li>To get rid of most boilerplate code, I would code<ul><li>a supporting functor interface like <code>ItemQuantityChanger</code> (below)</li><li>a &#34;functional&#34; immutable collection, say <code>ItemsSet</code>, with a metod of signature <code>ItemsSet set(Item item, ItemQuantityChanger transformation)</code> that iterates over a simple array for the item to change. Such method would always create a new ItemsSet to return, without the Item (if the trasformation returns zero), with a new Item if the item is not found (with the quantity returned by applying the transformation to zero) or simply with the previous item coupled with the result of the trasformation.</li></ul></li></ol><p>However, concretely, I would just use an <code>ImmutableList.Builder</code>, since the functional design described in 4 adds few value in this case. A single <strong>if</strong>, in a method, is not that huge smell.</p><pre><code>public interface ItemQuantityChanger {
   /**
    * Accept the current quantity of an Item and return the new one.
    */
   int applyTo(int currentQuantity);
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-generics-how-to-strike-a-balance-between-expressiveness-and-simplicity/'>Java Generics &#8211; how to strike a balance between expressiveness and simplicity</a></li><li class="list-group-item"><a href='../java-structuring-a-storage-system-for-a-game/'>Java &#8211; Structuring a storage system for a game</a></li><li class="list-group-item"><a href='../mvc-when-to-create-an-in-memory-object-to-manage-repository-records/'>Mvc &#8211; When to create an in-memory object to manage repository records</a></li><li class="list-group-item"><a href='../java-should-set-have-a-get-method/'>Java &#8211; Should &#8220;Set&#8221; have a Get method</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>