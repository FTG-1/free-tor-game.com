<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Reconciling the Boy Scout Rule and Opportunistic Refactoring with code reviews &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070568 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070568" class="post-1070568 software type-software status-publish hentry category-software tag-code-reviews tag-refactoring"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Reconciling the Boy Scout Rule and Opportunistic Refactoring with code reviews</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">code-reviews</span><span class="mr-2 badge badge-info">refactoring</span></p><div class="entry-content"><p>I am a great believer in the <a href="http://programmer.97things.oreilly.com/wiki/index.php/The_Boy_Scout_Rule">Boy Scout Rule</a>:</p><blockquote><p>Always check a module in cleaner than when you checked it out.&#34; No<br /> matter who the original author was, what if we always made some<br /> effort, no matter how small, to improve the module. What would be the<br /> result? I think if we all followed that simple rule, we&#39;d see the end<br /> of the relentless deterioration of our software systems. Instead, our<br /> systems would gradually get better and better as they evolved. We&#39;d<br /> also see teams caring for the system as a whole, rather than just<br /> individuals caring for their own small little part.</p></blockquote><p>I am also a great believer in the related idea of <a href="http://martinfowler.com/bliki/OpportunisticRefactoring.html">Opportunistic Refactoring</a>:</p><blockquote><p>Although there are places for some scheduled refactoring efforts, I<br /> prefer to encourage refactoring as an opportunistic activity, done<br /> whenever and wherever code needs to cleaned up &#8211; by whoever.<br /> What this means is that at any time someone sees some code that isn&#39;t<br /> as clear as it should be, they should take the opportunity to fix it<br /> right there and then &#8211; or at least within a few minutes</p></blockquote><p>Particularly note the following excerpt from the refactoring article:</p><blockquote><p>I&#39;m wary of any development practices that cause friction for<br /> opportunistic refactoring &#8230; My sense is that most teams don&#39;t do<br /> enough refactoring, so it&#39;s important to pay attention to anything<br /> that is discouraging people from doing it. To help flush this out be<br /> aware of any time you feel discouraged from doing a small refactoring,<br /> one that you&#39;re sure will only take a minute or two. Any such barrier<br /> is a smell that should prompt a conversation. So make a note of the<br /> discouragement and bring it up with the team. At the very least it<br /> should be discussed during your next retrospective.</p></blockquote><p>Where I work, there is one development practice that causes <strong>heavy</strong> friction &#8211; Code Review (CR). Whenever I change anything that&#39;s not in the scope of my &#34;assignment&#34; I&#39;m being rebuked by my reviewers that I&#39;m making the change harder to review. This is especially true when refactoring is involved, since it makes &#34;line by line&#34; diff comparison difficult. This approach is the standard here, which means opportunistic refactoring is seldom done, and only &#34;planned&#34; refactoring (which is usually too little, too late) takes place, if at all.</p><p>I claim that the benefits are worth it, and that 3 reviewers will work a little harder (to actually understand the code before and after, rather than look at the narrow scope of which lines changed &#8211; the review itself would be better due to that alone) so that the next 100 developers reading and maintaining the code will benefit. When I present this argument my reviewers, they say they have no problem with my refactoring, as long as it&#39;s not in the same CR. However I claim this is a myth:</p><p>(1) Most of the times you only realize what and how you want to refactor when you&#39;re in the midst of your assignment. As Martin Fowler puts it:</p><blockquote><p>As you add the functionality, you realize that some code you&#39;re adding<br /> contains some duplication with some existing code, so you need to<br /> refactor the existing code to clean things up&#8230; You may get something<br /> working, but realize that it would be better if the interaction with<br /> existing classes was changed. Take that opportunity to do that before<br /> you consider yourself done.</p></blockquote><p>(2) Nobody is going to look favorably at you releasing &#34;refactoring&#34; CRs you were not supposed to do. A CR has a certain overhead and your manager doesn&#39;t want you to &#34;waste your time&#34; on refactoring. When it&#39;s bundled with the change you&#39;re supposed to do, this issue is minimized.</p><p>The issue is exacerbated by Resharper, as each new file I add to the change (and I can&#39;t know in advance exactly which files would end up changed) is usually <em>littered</em> with errors and suggestions &#8211; most of which are spot on and totally deserve fixing.</p><p>The end result is that I see horrible code, and I just leave it there. Ironically, I feel that fixing such code not only will not improve my standings, but actually lower them and paint me as the &#34;unfocused&#34; guy who wastes time fixing things nobody cares about instead of doing his job. I feel bad about it because I truly despise bad code and can&#39;t stand watching it, let alone call it from my methods!</p><p>Any thoughts on how I can remedy this situation ?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>OK, so there are now more things here than are suitable for a comment.</p><h2>tl;dr</h2><p>Your intuition about what you <em>ought</em> to do (refactoring as you go) is correct.</p><p>Your difficulty implementing this - given that you have to work around a poor code review system - comes down to your difficulty manipulating your source code and VCS. Multiple people have said that you <em>can</em> and <em>should</em> split your changes (yes, even within files) into multiple commits, but you seem to have difficulty believing this.</p><p>You <em>really can</em> do this. That <em>really is</em> what we&#39;re suggesting. You <em>really should</em> learn to get the most out of your editing, source manipulation and version control tools. If you invest the time in learning how to use them well, it makes life much easier.</p><hr/><h2>Workflow/office politics issues</h2><p>I&#39;d make essentially the same recommendation as GlenH7 that you create two commits - one with only refactorings and (demonstrably or obviously) no functional changes, and one with the functional changes in question.</p><p>It may be useful though, if you&#39;re finding <em>lots</em> of errors, to pick a single category of error to fix within a single CR. Then you have one commit with a comment like &#34;dedupe code&#34;, &#34;fix type-X errors&#34;, or whatever. Because this makes a single type of change, presumably in multiple places, it should be <em>trivial</em> to review. It does mean you can&#39;t fix every error you find, but may make it less painful to smuggle through.</p><hr/><h2>VCS issues</h2><p>Splitting the changes made to your working source into multiple commits shouldn&#39;t be a challenge.
You haven&#39;t said what you&#39;re using, but possible workflows are:</p><ol><li><p>if you&#39;re using git, you have excellent tools for this</p><ul><li>you can use <code>git add -i</code> for interactive staging from the command line</li><li>you can use <code>git gui</code> and select individual hunks and lines to stage (this is one of the few VCS related GUI tools I actually prefer to the command line, the other being a good 3-way merge editor)</li><li>you can make lots of tiny commits (individual changes, or fixing the same class of bug in multiple places) and then reorder them, merge them or split them with <code>rebase -i</code></li></ul></li><li><p>if you&#39;re not using git, your VCS may still have tooling for this sort of thing, but I can&#39;t advise without knowing what system you use</p><p>You mentioned you&#39;re using TFS - which I believe is compatible with git since TFS2013. It may be worth experimenting with using a local git clone of the repo to work in. If this is disabled or doesn&#39;t work for you, you can still import the source into a local git repo, work in there, and use it to export your final commits.</p></li><li><p>you can do it manually in any VCS if you have access to basic tools like <code>diff</code> and <code>patch</code>. It&#39;s more painful, but certainly possible. The basic workflow would be:</p><ol><li>make all your changes, test, etc.</li><li>use <code>diff</code> to make a (context or unified) patch file with all changes since the last commit</li><li>partition that into two files: you&#39;ll end up with one patch file containing refactorings, and one with functional changes<ul><li>this isn&#39;t entirely trivial - tools such as emacs diff mode may help</li></ul></li><li>back everything up</li><li>revert to the last commit, use <code>patch</code> to replay one of the patch files, commit those changes<ul><li>NB. if the patch didn&#39;t apply cleanly, you may need to fix up the failed hunks manually</li></ul></li><li>repeat 5 for the second patch file</li></ol></li></ol><p>Now you have two commits, with your changes partitioned appropriately.</p><p>Note there are probably tools to make this patch management easier - I just don&#39;t use them since git does it for me.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../best-practices-for-renaming-refactoring-and-breaking-changes-with-teams/'>Best Practices for Renaming, Refactoring, and Breaking Changes with Teams</a></li><li class="list-group-item"><a href='../how-to-be-better-at-reviewing-code/'>How to be better at reviewing code</a></li><li class="list-group-item"><a href='../how-to-reject-a-code-review-that-you-believe-is-unnecessary/'>How to reject a code review that you believe is unnecessary</a></li><li class="list-group-item"><a href='../how-to-deal-with-no-code-reviews-in-the-new-place-when-i-come-from-that-practice/'>How to deal with no code reviews in the new place when I come from that practice</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>