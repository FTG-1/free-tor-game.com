<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>The alternative design pattern of a state machine that may have recursive state change &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076061 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076061" class="post-1076061 software type-software status-publish hentry category-software tag-design-patterns tag-finite-state-machine"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">The alternative design pattern of a state machine that may have recursive state change</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design-patterns</span><span class="mr-2 badge badge-info">finite-state machine</span></p><div class="entry-content"><p>I have a state machine like code, which has state A,B and C, with a function changeState(char i) which can change the state of a system, and each state can also call changeState(char i) to switch the system to another state:</p><pre><code>struct State{
    State(char aName){
        this-&gt;name=aName;
    }
    char name;
};

void changeState(char i);

struct A : public State{
    A():State(&#39;A&#39;){
        changeState(&#39;B&#39;);
    }
};

struct B : public State{
    B():State(&#39;B&#39;){
    changeState(&#39;C&#39;);
    }
};

struct C : public State{
    C():State(&#39;C&#39;){
    }
};

State* state;
void changeState(char i){
    switch(i){
        case &#39;A&#39;:
            state=new A();
            break;
        case &#39;B&#39;:
            state=new B();
            break;
        case &#39;C&#39;:
            state=new C();
            break;
    }
}
</code></pre><p>Now this code has at least 2 problems:</p><ol><li><p>if I do not set the state as global, I need to handle the memory management of each states, which increases the complexity of the code</p></li><li><p>if recursive state change occurs, the final state is not as I expected:</p></li></ol><p>Suppose I want to trigger state change, start from A to C (to simplify the code now the state change occurs in constructor only, but in real code it is in other method which calls after constructor):</p><pre><code>int main(){
    changeState(&#39;A&#39;);
    printf(&#34;%c\n&#34;,state-&gt;name);
    return 0;
}
</code></pre><p>the flow is : changeState(&#39;A&#39;)-&gt;new A()-&gt;changeState(&#39;B&#39;)-&gt;new B()-&gt;changeState(C)-&gt;new C(), I want the last state be C, but now is A.</p><p>My question is, what is the alternative software architecture or design pattern if my state machine may change state recursively? or, if possible, how to modify current code to overcome the problem?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>First of all, I&#39;d always avoid global state unless it is absolutely necessary. It makes extended your code hard, testing your code hard, and debugging your code hard. For the expense of having a state machine object that is passed to each state when it&#39;s created? Definitely not.</p><p>But I don&#39;t think it&#39;s necessary anyway. Your code has another antipattern that you haven&#39;t highlighted: your State objects cause side-effects in their constructors, which is a seriously bad idea. I&#39;d fix both problems with a single change: have a class StateMachine with a method:</p><pre><code>void changeState(State * requested)
{
    State * alternative;
    while (alternative = requested-&gt; getAlternative ())
        requested = alternative;
    currentState = requested;
}
</code></pre><p>Where getAlternative is a virtual method in State that returns null, and can be overridden by each subclass to return a different state if necessary.</p><p>Once this is done, you can allocate a single instance of each State subclass and use those rather than calling &#34;new&#34; all the time, which will save the possibility of memory leaks (which look like they could have been a problem in your design).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-passing-data-between-concrete-states/'>C# &#8211; Passing data between concrete states</a></li><li class="list-group-item"><a href='../how-to-a-child-state-machine-relinquish-control-back-to-the-parent-state-machine/'>How to a child state machine relinquish control back to the parent state machine</a></li><li class="list-group-item"><a href='../does-this-implementation-of-the-state-pattern-make-sense/'>Does this implementation of the state pattern make sense</a></li><li class="list-group-item"><a href='../object-oriented-finite-state-machine-menu-design/'>Object-oriented &#8211; Finite state machine menu design</a></li><li class="list-group-item"><a href='../state-machine-with-additional-variable/'>State machine with additional variable</a></li><li class="list-group-item"><a href='../can-a-state-machine-transition-depend-on-the-previous-state/'>Can a state machine transition depend on the previous state</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>