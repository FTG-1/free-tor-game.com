<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Entity Framework Entities &#8211; Some Data From Web Service &#8211; Best Architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072062 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072062" class="post-1072062 software type-software status-publish hentry category-software tag-asp-net-mvc tag-entity tag-entity-framework tag-web-services"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Entity Framework Entities &#8211; Some Data From Web Service &#8211; Best Architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-mvc</span><span class="mr-2 badge badge-info">entity</span><span class="mr-2 badge badge-warning">entity-framework</span><span class="mr-2 badge badge-primary">web services</span></p><div class="entry-content"><p>We are currently using Entity Framework as an ORM across a few web applications, and until now, it has suited us well as all our data is stored in a single database. We are using the repository pattern, and have services (the domain layer) which use these, and return the EF entities directly to the ASP.NET MVC controllers.</p><p>However, a requirement has come up to utilise a 3rd party API (through a web service) which will give us extra information that relates to the user in our database. In our local User database, we will store an external ID which we can provide the to API to get additional information. There is quite a bit of information available, but for the sake of simplicity, one of them relates to the user&#39;s company (name, manager, room, job title, location etc). This information will be used in various places throughout our web apps &#8211; as opposed to being used in a single place.</p><p>So my question is, where is the best place to populate and access this information? As it is used in various places, it&#39;s not really sensible to fetch it on an ad-hoc basis wherever we use in the web application &#8211; so it makes sense to return this additional data from the domain layer.</p><p>My initial thought was just to create a wrapper model class which would contain the EF entity (EFUser), and a new &#39;ApiUser&#39; class containing the new information &#8211; and when we get a user, we get the EFUser, and then get the additional info from the API, and populate the ApiUser object. However, whilst this would be fine for getting single users, it falls over when getting multiple users. We can&#39;t hit the API when getting a list of users.</p><p>My second thought was just to add a singleton method to the EFUser entity which returns the ApiUser, and just populate it when needed. This solves the above problem as we only access it when we need it.</p><p>Or the final thought was to keep a local copy of the data in our database, and synchronise it with the API when the user logs in. This is minimal work as it&#39;s just a synchronisation process &#8211; and we don&#39;t have the overhead of hitting the DB and API every time we want to get user information. However, these means storing the data in two places, and also means the data is out of date for any user that hasn&#39;t logged in for a while.</p><p>Does anyone have any advice or suggestions on how best to handle this kind of scenario?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h2>Your case</h2><p>In your case all three options are viable. I think that the best option is probably to sync your data sources someplace the asp.net application is not even aware of. That is, avoid the two fetches in the foreground every time, sync the API with the db silently). So if that&#39;s a viable option in your case - I say do it.</p><p>A solution where you make the fetch &#39;once&#39; like the other answer suggests doesn&#39;t seem very viable since it doesn&#39;t persist the response anywhere and ASP.NET MVC will just make the fetch for every request over and over.</p><p>I&#39;d avoid the singleton, I don&#39;t think it&#39;s a good idea at all for plenty of the usual reasons.</p><p>If the third option is <em>not</em> viable - one option is to lazy load it . That is, have a class extend the entity, and have it hit the API on a <em>need to</em> basis. That&#39;s a very dangerous abstraction though since it&#39;s even more magic and non-obvious state.</p><p>I guess it really boils down to several questions:</p><ul><li><strong>How often does the API call data change?</strong> Not often? Third option. Often? Suddenly the third option is not too viable. I&#39;m not sure I&#39;m as against ad-hoc calls as you.</li><li><strong>How expensive is an API call?</strong> Do you pay per call? Are they fast? Free? If they&#39;re fast, making a call each time might work, if they&#39;re slow you need to have some sort of prediction in place and make the calls. If they cost money - that&#39;s a big incentive for caching.</li><li><strong>How fast does the response time have to be?</strong> Obviously faster is better, but sacrificing speed for simplicity might be worth it in some cases, especially if it&#39;s not directly facing a user.</li><li><strong>How different is the API data from your data?</strong> Are they two conceptually different things? If so, it might be even better to just expose the API outside rather than return the API result with the result directly and let the other side make the second call and handle managing it.</li></ul><h2>A word or two about separation of concerns</h2><p>Allow me to argue against what Bobson is saying about separation of concerns here. At the end of the day - putting that logic in the entities like that violates separation of concerns just as bad.</p><p><strong>Having such a repository violates separation of concerns just as bad</strong> by putting presentation centric logic in the business logic layer. Your repository is now suddenly aware of the  presentation related things like how you display the user in your asp.net mvc controllers.</p><p>In <a href="https://stackoverflow.com/q/17556967/1348195">this related question</a> I&#39;ve asked about accessing entities directly from a controller. Allow me to quote one of the answers there:</p><blockquote><p>&#34;Welcome to BigPizza, the custom Pizza shop, may I take your order?&#34; &#34;Well, I&#39;d like to have a Pizza with olives, but tomato sauce on top and cheese at the bottom and bake it in the oven for 90 minutes until it&#39;s black and hard like a flat rock of granite.&#34; &#34;OK, Sir, custom Pizzas are our profession, we&#39;ll make it.&#34;</p><p>The cashier goes to the kitchen. &#34;There is a psycho at the counter, he wants to have a Pizza with... it&#39;s a rock of granite with ... wait ... we need to have a name first&#34;, he tells the cook.</p><p>&#34;No!&#34;, the cook screams, &#34;not again! You know we tried that already.&#34; He takes a stack of paper with 400 pages, &#34;here we have rock of granite from 2005, but... it didn&#39;t have olives, but paprica instead... or here is top tomato ... but the customer wanted it baked only half a minute.&#34; &#34;Maybe we should call it TopTomatoGraniteRockSpecial?&#34; &#34;But it doesn&#39;t take the cheese at the bottom into account...&#34; The cashier: &#34;That&#39;s what Special is supposed to express.&#34; &#34;But having the Pizza rock formed like a pyramid would be special as well&#34;, the cook replies. &#34;Hmmm ... it is difficult...&#34;, the desparate cashier says.</p><p>&#34;IS MY PIZZA ALREADY IN THE OVEN?&#34;, suddenly it shouts through the kitchen door. &#34;Let&#39;s stop this discussion, just tell me how to make this Pizza, we are not going to have such a Pizza a second time&#34;, the cook decides. &#34;OK, it&#39;s a Pizza with olives, but tomato sauce on top and cheese at the bottom and bake it in the oven for 90 minutes until it&#39;s black and hard like a flat rock of granite.&#34;</p></blockquote><p>(Read the rest of the answer, it&#39;s really nice imo).</p><p><strong>It&#39;s naive to ignore the fact there is a database</strong> - there is a database, and no matter how hard you want to abstract that, it&#39;s not going anywhere. Your application <em>will</em> be aware of the data source. You won&#39;t be able to &#39;hot swap it&#39;. <a href="http://martinfowler.com/bliki/OrmHate.html" rel="nofollow noreferrer">ORMs are useful</a> but they leak because of how complicated the problem they solve is and for plenty of performance reasons (Like Select n+1 for example).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../is-moving-entity-framework-objects-over-a-webservice-really-the-best-way/'>Is Moving Entity Framework objects over a webservice really the best way</a></li><li class="list-group-item"><a href='../web-api-vs-entity-framework-with-repository-pattern-using-xamarin/'>Web API vs Entity Framework with Repository Pattern using Xamarin</a></li><li class="list-group-item"><a href='../data-encryption-in-data-layer-with-asp-net-core-entity-framework/'>Data Encryption in Data Layer with ASP.NET Core Entity Framework</a></li><li class="list-group-item"><a href='../c-best-practice-for-transaction-handling-using-entity-framework/'>C# &#8211; Best practice for transaction handling using Entity Framework</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>