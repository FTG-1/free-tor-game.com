<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>DDD, Saga &#038; Event-sourcing: Can a Compensate Action simply be a delete on the event store &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067287 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067287" class="post-1067287 software type-software status-publish hentry category-software tag-cqrs tag-domain-driven-design tag-event-sourcing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">DDD, Saga &#038; Event-sourcing: Can a Compensate Action simply be a delete on the event store</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">cqrs</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">event-sourcing</span></p><div class="entry-content"><p>I realize the above question probably raises a few &#39;what??&#39;s, but let me try to explain :</p><p>I&#39;m trying to wrap my head on a couple of related concepts, basically the Saga-pattern ( <a href="http://www.rgoarchitects.com/Files/SOAPatterns/Saga.pdf" rel="noreferrer">http://www.rgoarchitects.com/Files/SOAPatterns/Saga.pdf</a>) in combination with Event-sourcing (A DDD-concept: <a href="http://en.wikipedia.org/wiki/Domain-driven_design" rel="noreferrer">http://en.wikipedia.org/wiki/Domain-driven_design</a>)</p><p>A good post that wraps it together:<br /> <a href="https://blog.jonathanoliver.com/cqrs-sagas-with-event-sourcing-part-ii-of-ii/" rel="noreferrer">https://blog.jonathanoliver.com/cqrs-sagas-with-event-sourcing-part-ii-of-ii/</a></p><p>I&#39;m getting to the question in a minute, but I think I have to try to summarize what I understand of it first (which might well be wrong, so please correct if that&#39;s the case) since this might well impact why I&#39;m asking the question to begin with:</p><ol><li>The Saga pattern is a sort of broker that given an action (end-user, automated, etc. essentially anything that is going to change data) divides that action up in business activities and sends each of these activities as messages to a Message Bus which in turn sends it to the respective aggregate roots to be taken care of.</li><li>These aggregate roots can operate completely autonomously (nice separation of concerns, great scalability, etc. )</li><li>A Saga-instance itself doesn&#39;t contain any business logic, that is contained in the aggregate roots it sends activities to. The only &#39;logic&#39; contained in the Saga is &#39;process&#39;-logic, (often implemented as a Statemachine), which determines based on actions received (as well as follow-up events) what to do (i.e: what activities to send)</li><li>The Saga-patterns implements a kind of distributed transaction pattern. I.e: when one of the aggregate roots (which again work autonomously, without knowing of eachothers existense) fails, the entire action might have to be rolled back.</li><li>This is implemented by having all aggregate roots, upon completion of their activity report back to the Saga. (In case of success as well as error)</li><li>In case all aggregate roots return a success, the internal statemachine if the Saga determines what to do next (or decides it&#39;s  done)</li><li>In case of failure, the Saga issues to all aggregate roots that took part in the last action a so called Compensation Action, i.e: an action to undo the last action each of the aggregate roots did.</li><li>This might be simply doing a &#39;Minus 1 vote&#39; if the action was &#34;plus 1 vote&#39; but it could be more complicated like restoring a blogpost to it&#39;s previous version.</li><li>Event-sourcing (see the blogpost combining the two) aims to externalize saving the results of each of the activities that each of the aggregate roots undertake to a centralized Event Store (the changes are called &#39;events&#39; in this context)</li><li>This Event store is the &#39;single version of the truth&#39; and can be use to replay the state of all entities simply by iterating the events stored (essentially like an event log)</li><li>Combining the two (i.e: letting aggregate roots use Event-sourcing to outsource saving their changes before reporting back to the Saga) enables lots of nice possibilities, one of which concerns my question&#8230;</li></ol><p>I felt I needed to get this off of my shoulder, since it&#39;s a lot to grasp in one go. Given this context/mindset (again, please correct if wrong)</p><p><strong>the question:</strong> When an aggregate root receives a Compensate Action and if that aggregate root has outsourced it&#39;s state-changes using Event-sourcing, wouldn&#39;t the Compensate Action in all situations just be a delete of the last event in the Event Store for that given Aggregate Root? (Assuming the persist-implementation allows deletes)</p><p>That would make sense to me a lot (and would be another great benefit of this combination) but as I said I might be making these assumptions based on a incorrect/incomplete understanding of these concepts.</p><p>I hope this didn&#39;t get too long-winded.</p><p>Thanks.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You shouldn&#39;t delete the events from your event store. These represent something that happened. 
If something happens now, then you should know it too, therefore add an event that will force your aggregate to go back to some previous state. That&#39;s a pity to delete information from your database.</p><p>think about the example of the cart from greg young and the removed items. May be tomorrow the information of compensating action might be of any value..</p><p>As for the saga, every thing is correct, as far as I know myself. You should think of the saga as of a state machine. It does only that.</p><p>It is a Command the saga is issuing to tell the aggregate to do something. Of this action there will be an event. 
This event might be the corrective action you need, or might need to be  denormalised in a view so that some user will see it to decide what to do.</p><p>It depends on your business rules. Either, there is an easy fix : the aggregate root knows that in such case , you do that, or the choice is too complex to be done programmatically ( development cost are too high) and therefore, you might propose this to some user, who might choose between different action.
Everything depend on the context of the compensating action. This is pure business rules. What should we do in this case or that case. This is something to ask your domain expert, and then choose with him, if it is better to develop an automatic solution or if the solution is to ask the user Ronald R., because he is the one to answer this question usually.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../cqrs-event-sourcing-is-it-correct-that-commands-are-generally-communicated-point-to-point-while-domain-events-are-communicated-through-pub-sub/'>CQRS + Event Sourcing: (is it correct that) Commands are generally communicated point-to-point, while Domain Events are communicated through pub/sub</a></li><li class="list-group-item"><a href='../sharing-of-event-source-stream-between-aggregates/'>Sharing of event source stream between aggregates</a></li><li class="list-group-item"><a href='../how-to-create-new-aggregate-root-in-cqrs/'>How to create new aggregate root in CQRS</a></li><li class="list-group-item"><a href='../how-to-store-sagas-with-event-sourcing/'>How to store Sagas with Event Sourcing</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>