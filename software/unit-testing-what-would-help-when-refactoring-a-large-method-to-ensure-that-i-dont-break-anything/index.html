<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; What would help when refactoring a large method to ensure that I don&#8217;t break anything &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081843 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081843" class="post-1081843 software type-software status-publish hentry category-software tag-formal-methods tag-legacy tag-refactoring tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; What would help when refactoring a large method to ensure that I don&#8217;t break anything</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">formal-methods</span><span class="mr-2 badge badge-info">legacy</span><span class="mr-2 badge badge-warning">refactoring</span><span class="mr-2 badge badge-primary">unit testing</span></p><div class="entry-content"><p>I&#39;m currently refactoring a part of a large codebase with no unit tests whatsoever. I tried to refactor code the brute way, i.e. by trying to guess what the code is doing and what changes wouldn&#39;t change it meaning, but without success: it randomly breaks features all around the codebase.</p><p>Note that refactoring includes moving legacy C# code to a more functional style (the legacy code doesn&#39;t use any of the features of .NET Framework 3 and later, including LINQ), adding generics where the code may benefit from them, etc.</p><p>I can&#39;t use <a href="http://en.wikipedia.org/wiki/Formal_methods" rel="nofollow noreferrer">formal methods</a>, given how much would they cost.</p><p>On the other hand, I presume that at least <a href="https://softwareengineering.stackexchange.com/a/155505/6605">&#34;Any refactored legacy code shall come with unit tests&#34;</a> rule should be strictly followed, no matter how much would it cost. The problem is that when I refactor a tiny part of a 500 LOC private method, adding unit tests appears to be a difficult task.</p><p>What can help me in knowing which unit tests are relevant for a given piece of code? I&#39;m guessing that static analysis of the code would somehow be helpful, but what are the tools and techniques I can use to:</p><ul><li><p>Know exactly what unit tests should I create,</p></li><li><p>And/or know if the change I&#39;ve done affected the original code in a way that it is executing differently from now?</p></li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I have had similar challenges.  The <em>Working with Legacy Code</em> book is a great resource, but there&#39;s an assumption that you can shoe-horn in unit tests to support your work.  Sometimes that&#39;s just not possible.</p><p>In my archeology work (my term for maintenance on legacy code like this), I follow a similar approach as to what you outlined.</p><ul><li>Start with a solid understanding of what the routine is currently doing.</li><li>At the same time, identify what the routine was <em>supposed</em> to be doing. Many think this bullet and the previous are the same, but there is a subtle difference.  Often times, if the routine was doing what it was supposed to be doing then you wouldn&#39;t be applying maintenance changes.</li><li>Run some samples through routine and make sure you hit the boundary cases, relevant error paths, along with the mainline path.  My experience is that the collateral damage (feature breakage) comes from boundary conditions not being implemented in exactly the same way.</li><li>After those sample cases, identify what&#39;s being persisted that doesn&#39;t necessarily need to be persisted.  Again, I have found that it&#39;s side-effects like this that lead to collateral damage elsewhere.</li></ul><p>At this point, you should have a candidate list of what&#39;s been exposed and / or manipulated by that routine.  Some of those manipulations are likely to be inadvertent.  Now I use <code>findstr</code> and the IDE to understand what other areas might reference the items in the candidate list.  I&#39;ll spend some time understanding how those references are working and what their nature is.</p><p>Finally, once I&#39;ve deluded myself into thinking I understand the impacts of the original routine, I&#39;ll make my changes one-at-a-time and rerun the analysis steps I outlined above to verify that the change is working as I expect it to work.  I specifically try to avoid changing multiple things at once as I have found this blows up on me when I try and verify the impact.  Sometimes you can get away with multiple changes, but if I can follow a one-at-a-time route, that&#39;s my preference.</p><p>In short, my approach is similar to what you laid out.  It&#39;s a lot of prep work; then make circumspect, individual changes; and then verify, verify, verify.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-have-unit-test-generators-helped-you-when-working-with-legacy-code/'>Unit-testing &#8211; Have unit test generators helped you when working with legacy code</a></li><li class="list-group-item"><a href='../unit-testing-adding-unit-tests-to-a-legacy-plain-c-project/'>Unit-testing &#8211; Adding unit tests to a legacy, plain C project</a></li><li class="list-group-item"><a href='../why-write-tests-for-code-that-i-will-refactor/'>Why write tests for code that I will refactor</a></li><li class="list-group-item"><a href='../unit-testing-how-to-write-unit-tests-before-refactoring/'>Unit-testing &#8211; How to write unit tests before refactoring</a></li><li class="list-group-item"><a href='../unit-testing-in-tdd-should-i-add-unit-tests-to-refactored-code/'>Unit-testing &#8211; In TDD, should I add unit tests to refactored code</a></li><li class="list-group-item"><a href='../is-it-the-correct-practice-to-keep-more-than-10-years-old-spaghetti-legacy-code-untouched-without-refactoring-at-all-in-big-product-development/'>Is it the correct practice to keep more than 10 years old spaghetti legacy code untouched without refactoring at all in big product development</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>