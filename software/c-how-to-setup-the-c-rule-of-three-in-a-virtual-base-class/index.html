<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; How to setup the c++ rule of three in a virtual base class &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070225 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070225" class="post-1070225 software type-software status-publish hentry category-software tag-c tag-c11 tag-polymorphism tag-rule-of-three"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; How to setup the c++ rule of three in a virtual base class</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">c++11</span><span class="mr-2 badge badge-warning">polymorphism</span><span class="mr-2 badge badge-primary">rule-of-three</span></p><div class="entry-content"><p>I am trying to create a pure virtual base class (or simulated pure virtual)</p><p>my goal:</p><ol><li>User can&#39;t create instances of BaseClass.</li><li>Derived classes have to implement default constructor, copy constructor, copy assignment operator and destructor.</li></ol><p>My attempt:</p><pre><code>class Base
{
public:
    virtual ~Base() {};
    /* some pure virtual functions */
private:
    Base() = default;
    Base(const Base&amp; base) = default;
    Base&amp; operator=(const Base&amp; base) = default;
}
</code></pre><p>This gives some errors complaining that (for one) the copy constructor is private. But i don&#39;t want this mimicked constructor to be called.<br /> Can anyone give me the correct construction to do this if this is at all possible?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The requirement looks wrong. The reason is that virtual methods and copy constructors don&#39;t work together. Virtual methods are useful if you use the object polymorphically, that is via reference/pointer to a base class. But copy constructor always constructs object of the static type it is written as, so if you give it polymorphic object, it will <em>only</em> create the base class, not the subclass you wanted. This is called <a href="https://stackoverflow.com/questions/274626/what-is-the-slicing-problem-in-c">slicing</a>.</p><p>So you want to either:</p><ul><li><p>Have a templated framework that knows the type at compile time and uses copy-constructor. But this does not need any virtual methods, nor for that matter a common base type, since the code will be compiled with the specific template parameter. Compiler will complain if the type substituted does not support the operations the template tries to use, but you can slightly improve diagnostics by using some explicit checks, e.g. from <a href="http://www.boost.org/libs/concept_check/concept_check.htm" rel="nofollow noreferrer">Boost.Concept Check</a>.</p></li><li><p>Have a framework using polymorphic objects with base class, but that can&#39;t create copies with copy constructor, because it does not know the type to construct. There are three ways out:</p><ol><li>Have a pure virtual <code>Base *clone()</code> method, that will be implemented to do <code>return new Derived(this)</code> in each concrete subclass. You should probably wrap that in <code>unique_ptr</code> or <code>shared_ptr</code> immediately to avoid leaking the copies.</li><li>Instead of copies, hand out references or smart pointers, probably <code>shared_ptr</code> in this case. It would probably be either const references/smart pointers or typed with interface that only contains methods that can&#39;t affect invariants in the framework.</li><li>Make the method that inserts the objects a template, that would construct a cloner and store it along with the object. Cloner is a function <code>template&lt;typename T&gt; Base *clone(const Base *obj) { return new T(dynamic_cast&lt;const T &amp;&gt;(*obj); }</code> (you can have a functor or a class with multiple helper methods like this). To ensure you really have correct type, the insert method should probably wrap the call to <code>new</code> as well similar to e.g. <code>make_shared</code>.</li></ol></li></ul><p>By the way, nothing of this has anything to do with rule of three. Because rule of three says that <strong>if</strong> default copy constructor, default assignment operator or default destructor are not good enough for the class, than none of them is. But not because compiler would require it, but because the logic <em>probably</em> does. But for most classes that want to be copyable they <em>are</em> good enough. Because in most cases you hide the resource handling in some smart pointer and just let the default copy/assignment/destructor call to it.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-abstract-base-classes-and-copy-construction-rules-of-thumb/'>C++ &#8211; Abstract base classes and copy construction, rules of thumb</a></li><li class="list-group-item"><a href='../c-good-design-pattern-for-a-c-wrapper-around-a-c-object/'>C++ &#8211; Good design pattern for a c++ wrapper around a c object</a></li><li class="list-group-item"><a href='../c-the-pattern-for-a-safe-interface-in-c/'>C++ &#8211;  the pattern for a safe interface in C++</a></li><li class="list-group-item"><a href='../c-what-are-the-consequences-of-no-virtual-destructor-for-this-base-class/'>C++ &#8211; What are the consequences of no virtual destructor for this base class</a></li><li class="list-group-item"><a href='../c-how-to-improve-a-pattern-enum-class-with-methods/'>C++ &#8211; How to improve a pattern &#8216;enum class with methods&#8217;</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>