<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Should I mock a Domain Service &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084539 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084539" class="post-1084539 software type-software status-publish hentry category-software tag-c tag-domain-driven-design tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Should I mock a Domain Service</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">unit testing</span></p><div class="entry-content"><p>I am trying to decide whether to introduce mocks in my isolated Domain Model tests.  I have a class method similar to this:</p><pre><code>public Offer AssignOffer(OfferType offerType, IOfferValueCalculator valueCalculator) 
        { 
            DateTime dateExpiring = offerType.CalculateExpirationDate(); 
            int value = valueCalculator.CalculateValue(this, offerType); 
            var offer = new Offer(this, offerType, dateExpiring, value); 
            _assignedOffers.Add(offer); 
            NumberOfActiveOffers++; 
            return offer; 
        } 
</code></pre><p>which I took from here: <a href="https://github.com/jbogard/presentations/blob/master/WickedDomainModels/After/Model/Member.cs" rel="nofollow noreferrer">https://github.com/jbogard/presentations/blob/master/WickedDomainModels/After/Model/Member.cs</a></p><p>I have now read this article: <a href="http://enterprisecraftsmanship.com/2016/06/15/pragmatic-unit-testing/" rel="nofollow noreferrer">http://enterprisecraftsmanship.com/2016/06/15/pragmatic-unit-testing/</a> and this article: <a href="http://www.taimila.com/blog/ddd-and-testing-strategy/" rel="nofollow noreferrer">http://www.taimila.com/blog/ddd-and-testing-strategy/</a>.  They both seem to suggest that I should not mock OfferType (as it is a Value Object).  However my question is: should I be mocking IOfferValueCalculator (a Domain Service)?  IOfferValueCalculator does not sit in the innermost layer of the Onion, however it does sit in the Domain Model (second most inner layer of the Onion).</p><p>The reason I ask is because all these articles specifically reference Entities and Value Objects (advising against mocking them), however they do not reference Domain Services.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Should I mock a Domain Service?</p></blockquote><p>Short answers</p><ol><li>It depends.</li><li>Providing test doubles that stand in for domain services will <em>often</em> be a good idea.</li><li>Providing mocks that stand in for domain services may be a good idea.</li></ol><p>What follows will make more sense if you are familiar with the different flavors of test doubles; <a href="https://martinfowler.com/articles/mocksArentStubs.html" rel="nofollow noreferrer">Mocks Aren&#39;t Stubs</a> is an accessible starting point.</p><p>Longer answers:</p><p>Using test doubles is a trade off.  There are risks associated with the fact that the system under test isn&#39;t talking to a real collaborator, and there are benefits.  Part of our craft is understanding the trade we are making.</p><p>There are properties that we want our tests to have.</p><ul><li>We want the tests to be fast, so that running them is less of a distraction.</li><li>We want the tests to be isolated, so that we can run them in parallel, and save even more wall clock time.</li><li>We want the tests to be simple -- fewer lines of code in the test suite means fewer bugs in the test suite</li><li>We want the tests to be comprehensible -- we want most of the code to be describing the <em>test</em>, rather than describing a bunch of scaffolding</li><li>We want the tests to be stable -- if we don&#39;t make any changes, a second run of a test should always give us the same result as the first</li><li>We want the tests to be accurate -- a failing test should always indicate a mistake.</li></ul><p>But all of those are just bikewash unless</p><ul><li>The tests call our attention to mistakes that we make.</li></ul><p>Replacing real collaborators (which tend to be messy) with fake collaborators (which tend to be simple) increases the probability that we miss certain categories of mistakes; so we had better be sure when we do that that the benefits we gain offset the increased risks.</p><p>We derive almost no additional benefit from mocking a value.  Well designed value objects are already well isolated, side effect free, and tend to express the semantics of a test better than a substitute would.  They live entirely within the <a href="https://www.destroyallsoftware.com/talks/boundaries" rel="nofollow noreferrer">functional core</a> of your application.</p><p>If you run that same math on entities, you will see that it doesn&#39;t make much sense to mock an entity either.</p><p>With <em>domain services</em>, however, the trade offs start to look really interesting.  Domain services are the mechanism by which an encapsulated part of the domain model communicates with its collaborators; those collaborators might be other parts of the same model, or they may be further away.</p><p>When Evans described domain services in the blue book, he included among the motivating examples needing to access application and infrastructure services -- code that lives outside of the abstraction boundary of the domain model.  Domain services are often proxies for communicating side effects, which may even cross process boundaries.</p><blockquote><p>Mock across architecturally significant boundaries, but not within those boundaries.</p></blockquote><p>Domain services are <em>often</em> proxies for code across an architecturally significant boundary.</p><p>So if you&#39;ve got a domain service that is an in memory abstraction -- Orders needs access to an in memory tax calculator service, then the test double doesn&#39;t provide nearly as much marginal benefit as a test double that stands in for a domain service that needs to talk to a database....</p><p>Put another way, there are a lot of different things under the umbrella term &#34;domain service&#34;, and they have different trade offs.</p><p>You are much more likely to use a test double when the actual behavior of the service is hard to predict, or hard to constrain.</p><blockquote><p>IOfferCalculator.CalculateValue is a simple method in this case - it does not connect to a database and it does not call any other methods.</p></blockquote><p>That sounds like the marginal advantage of introducing a mock is small; so I would recommend using the real implementation in this circumstance.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-domain-driven-design-in-net-project-structure/'>C# &#8211; Domain Driven Design in Net &#8211; Project Structure</a></li><li class="list-group-item"><a href='../c-using-a-guid-as-a-primary-key/'>C# &#8211; Using a GUID as a Primary Key</a></li><li class="list-group-item"><a href='../c-using-automapper-to-map-dtos-to-domain-objects/'>C# &#8211; Using Automapper to map DTOs to Domain Objects</a></li><li class="list-group-item"><a href='../c-the-best-way-to-apprach-validation-from-the-perspective-of-a-ddd-purist/'>C# &#8211;  the &#8220;best&#8221; way to apprach validation from the perspective of a DDD purist</a></li><li class="list-group-item"><a href='../c-is-it-normal-for-a-domain-model-not-to-have-an-id/'>C# &#8211; Is it normal for a Domain Model not to have an ID</a></li><li class="list-group-item"><a href='../c-zero-argument-constructors-and-always-valid-entities/'>C# &#8211; Zero argument constructors and Always Valid entities</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>