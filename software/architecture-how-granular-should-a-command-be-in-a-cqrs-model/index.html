<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; How granular should a command be in a CQ[R]S model &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080962 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080962" class="post-1080962 software type-software status-publish hentry category-software tag-architecture tag-enterprise-architecture tag-service-bus"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; How granular should a command be in a CQ[R]S model</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">enterprise-architecture</span><span class="mr-2 badge badge-warning">service-bus</span></p><div class="entry-content"><p>I&#39;m considering a project to migrate part of our WCF-based SOA over to a service bus model (probably nServiceBus) and using some basic pub-sub to achieve <a href="http://en.wikipedia.org/wiki/Command-query_separation" rel="noreferrer">Command-Query Separation</a>.</p><p>I&#39;m not new to SOA, or even to service bus models, but I confess that until recently my concept of &#34;separation&#34; was limited to run-of-the-mill database mirroring and replication.  Still, I&#39;m attracted to the idea because it seems to provide all the benefits of an <a href="http://en.wikipedia.org/wiki/Eventual_consistency" rel="noreferrer">eventually-consistent</a> system while sidestepping many of the obvious drawbacks (most notably the lack of proper transactional support).</p><p>I&#39;ve read a lot on the subject from Udi Dahan who is basically <em>the</em> guru on ESB architectures (at least in the Microsoft world), but one thing he says really puzzles me:</p><blockquote><p>As we get larger entities with more fields on them, we also get more actors working with those same entities, and the higher the likelihood that something will touch some attribute of them at any given time, increasing the number of concurrency conflicts.</p><p>[&#8230;]</p><p>A core element of CQRS is rethinking the design of the user interface to enable us to capture our users’ intent such that making a customer preferred is a different unit of work for the user than indicating that the customer has moved or that they’ve gotten married. Using an Excel-like UI for data changes doesn’t capture intent, as we saw above.</p><p>&#8212; Udi Dahan, <a href="http://www.udidahan.com/2009/12/09/clarified-cqrs/" rel="noreferrer">Clarified CQRS</a></p></blockquote><p>From the perspective described in the quotation, it&#39;s hard to argue with that logic.  But it seems to go against the grain with respect to SOAs.  An SOA (and really services in general) are supposed to deal with <em>coarse-grained messages</em> so as to minimize network chatter &#8211; among many other benefits.</p><p>I realize that network chatter is less of an issue when you&#39;ve got highly-distributed systems with good message queuing and none of the baggage of RPC, but it doesn&#39;t seem wise to dismiss the issue entirely.  Udi almost seems to be saying that <em>every attribute change</em> (i.e. field update) ought to be its own command, which is hard to imagine in the context of one user potentially updating hundreds or thousands of combined entities and attributes as it often is with a traditional web service.</p><p>One batch update in SQL Server may take a fraction of a second given a good highly-parameterized query, table-valued parameter or bulk insert to a staging table; processing all of these updates one at a time is slow, slow, <em>slow</em>, and OLTP database hardware is the most expensive of all to scale up/out.</p><p>Is there some way to reconcile these competing concerns?  Am I thinking about it the wrong way?  Does this problem have a well-known solution in the CQS/ESB world?</p><p>If not, then how does one decide what the &#34;right level&#34; of granularity in a Command should be?  Is there some &#34;standard&#34; one can use as a starting point &#8211; sort of like 3NF in databases &#8211; and only deviate when careful profiling suggests a potentially significant performance benefit?</p><p>Or is this possibly one of those things that, despite several strong opinions being expressed by various experts, is really just a matter of opinion?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h2>On the topic of &#34;every attribute change&#34;</h2><p>I think you missed the point. Mr. Udi Dahan is saying you should capture the user&#39;s intent as a command. An end-user is concerned with being able to indicate that a customer has moved. Depending on the context that command could contain a customer identification, the new address (split up into street, streetnumber, zipcode, ...), optionally a new phone number (not uncommon when you move - maybe less so with all these cellphones). That&#39;s hardly one attribute.
A better question is &#34;how do I design commands?&#34;. You design them from a behavioral perspective. Each use-case, flow, task an end-user is trying to complete, will be captured in one or more commands. What data goes with those commands comes naturally, as you start reasoning about them in more detail. The thing to watch out for is data that gets interpreted as &#34;logic flow control&#34; on the server side. That <em>might</em> be an indication that you need to split up the command. I hope you never find that <em>standard</em> with regard to command granularity. Good question though!</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-determine-if-a-message-should-be-a-command-message-or-event-message/'>How to determine if a message should be a command message or event message</a></li><li class="list-group-item"><a href='../how-many-topics-queues-to-practically-use-in-an-esb/'>How many Topics (queues) to practically use in an ESB</a></li><li class="list-group-item"><a href='../single-source-of-truth-within-an-enterprise-distributed-system/'>Single source of truth within an enterprise distributed system</a></li><li class="list-group-item"><a href='../architecture-difference-between-esb-and-etl/'>Architecture &#8211; Difference between ESB and ETL</a></li><li class="list-group-item"><a href='../should-i-use-a-command-or-an-event/'>Should I use a command or an event</a></li><li class="list-group-item"><a href='../really-different-between-soa-and-microservices/'>Really different between SOA and Microservices</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>