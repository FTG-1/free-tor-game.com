<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; modifier &#8216;static&#8217; is only allowed in constant variable declarations; WHY &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067261 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067261" class="post-1067261 software type-software status-publish hentry category-software tag-java tag-language-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; modifier &#8216;static&#8217; is only allowed in constant variable declarations; WHY</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">java</span><span class="mr-2 badge badge-info">language-design</span></p><div class="entry-content"><p>Again and again I find myself in situations where I want to do this:</p><pre><code>class Outer
{
    private static final Runnable Inner = new Runnable() 
    {
        private static final String CONSTANT1 = &#34;foo&#34;;
        private static final int CONSTANT2 = CONSTANT1.length(); //&#39;static&#39; gives error
        private static final int CONSTANT3 = f(); //&#39;static&#39; gives error

        private static int f() //&#39;static&#39; gives error
        {
            return CONSTANT1.length();
        }

        @Override public void run() {}
    };

    private static final String CONSTANT1 = &#34;foo&#34;;
    private static final int CONSTANT2 = CONSTANT1.length(); //this is fine!
    private static final int CONSTANT3 = f(); //this is fine!

    private static int f() //this is fine!
    {
        return CONSTANT1.length();
    }
}
</code></pre><p>In the editor of the IDE (IntelliJ IDEA) the error reads &#34;Inner classes cannot have static declarations&#34;, which is misleading, because if that was the case, then <code>CONSTANT1</code> would also have an error, but it does not.</p><p>Outside of the editor, the compiler reports the error as follows: <code>java: Illegal static declaration in inner class &lt;anonymous bla bla bla&gt; modifier &#39;static&#39; is only allowed in constant variable declarations</code>.</p><p>So, does anyone know the technical reasons behind this limitation imposed by the java compiler?  Why is modifier &#39;static&#39; only allowed in constant variable declarations in anonymous class instances?  What is the difficulty with allowing &#39;static&#39; in these cases?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Java tries to behave sensibly, but since it is a quite complex language, it does occasionally fail. You have found an interesting edge case where a guard against invalid behaviour creates a false negative.</p><p>Usually, <code>static</code> fields can be initialized with arbitrary expressions, as long as they do not reference instance variables.</p><p>Inner classes belong to an instance of the outer class, not to the outer class itself. While the inner classes are logically distinct, they share the same physical class. This means that <code>static</code> fields are shared amongst all inner classes. This breaks the logical separation, <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-8.html#jls-8.1.3" rel="nofollow">unless the <code>static</code> fields are constants (see JLS ยง8.1.3)</a> and cannot be mutated, that is: they cannot be reassigned, and cannot change their value. I believe this restriction is sensible, given the implementation of inner classes.</p><p>Reassignment can be prevented with <code>final</code>, but Java has no mechanism to track mutating and non-mutating operations. C++ has such a mechanism and can mark methods as <code>const</code> and even <code>constexpr</code> for compile-time computable operations. All Java has is a concept of <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.28" rel="nofollow">constant expressions (JLS ยง15.28)</a>: basically just literals and arithmetic.</p><p>So an inner class can contain the constant <code>static final String CONSTANT1 = &#34;foo&#34;</code>. However, <code>CONSTANT1.length()</code> is not a constant expression because you are invoking a method. In practice this should not be a problem because the <code>String</code> class is immutable, but the JLS does not special-case the <code>String</code> class. Likewise, <code>f()</code> is not a constant expression.</p><p>Now the really sad thing is that your <code>new Runnable() { ... }</code> inner class is created in a static context, so the logically-separate inner class problem does not exist. It would be reasonably possible for anonymous classes in a static context to be declared <code>static</code>, as <code>static</code> inner classes do not have any of the restrictions of inner classes. However, the JLS requires that anonymous classes are never static (<a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.9.5" rel="nofollow">JLS ยง15.9.5</a>).</p><p>So a complex system such as Java has slight inconsistencies, which is annoying but not surprising. This inconsistency could be resolved by either tracking constant operations for all methods (which would be a huge change to the language), or by removing non-static inner classes, which IMHO would have been sensible because it is trivial to implement them yourself. However, that is not the Java we have.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-why-is-an-interface-in-java-not-allowed-to-have-state/'>Java &#8211; Why is an interface in Java not allowed to have state</a></li><li class="list-group-item"><a href='../java-static-vs-dynamic-memory-allocation-lots-of-constant-objects-only-small-part-of-them-used-at-runtime/'>Java &#8211; Static vs. dynamic memory allocation &#8211; lots of constant objects, only small part of them used at runtime</a></li><li class="list-group-item"><a href='../java-why-can-static-methods-only-use-static-data/'>Java &#8211; Why can static methods only use static data</a></li><li class="list-group-item"><a href='../java-why-is-there-no-subclasses-only-access-modifier-in-java/'>Java &#8211; Why is there no &#8216;subclasses-only&#8217; access modifier in Java</a></li><li class="list-group-item"><a href='../why-is-declaration-of-data-and-functions-necessary-in-c-language-when-the-definition-is-written-at-the-end-of-the-source-code/'>Why is *declaration* of data and functions necessary in C language, when the definition is written at the end of the source code</a></li><li class="list-group-item"><a href='../why-is-overflow-silently-allowed-in-ada/'>Why is overflow silently allowed in Ada</a></li><li class="list-group-item"><a href='../why-is-there-no-static-keyword-in-kotlin/'>Why is there no static keyword in Kotlin</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>