<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Are there alternatives to using an optional type in a multithreaded environment &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086236 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086236" class="post-1086236 software type-software status-publish hentry category-software tag-c tag-interfaces tag-multithreading"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Are there alternatives to using an optional type in a multithreaded environment</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">interfaces</span><span class="mr-2 badge badge-warning">multithreading</span></p><div class="entry-content"><p>I&#39;m making an MPMC queue in C++, and I would like to find out what the best interface for a <code>try_dequeue</code> method would be (I&#39;m <strong>not</strong> concerned about its implementation). I&#39;d like to provide a method which does not block if the queue is empty (like my <code>dequeue()</code> method does), but somehow notifies this to the caller.</p><p>While I provide a <code>bool empty() const</code> method as well, this unfortunately does no good because for a multithreaded queue doing something along the lines of <code>if(!queue.empty()) queue.dequeue();</code> provides no guarantees.</p><p>What I currently have is <code>T try_dequeue()</code>, which throws an exception if the queue is empty. This seems to offer the most intuitive interface, but an empty queue is hardly an exceptional situation, and that seems an awful lot like using exceptions for control flow.</p><p>Another option would be <code>bool try_dequeue(T* t)</code>, which would write to <code>t</code> only if the queue was not empty and return if <code>t</code> was written to. After using the exception method above, this seems probably least intrusive, but it would require that <code>T</code> is both default-constructible (or in some manner trivially constructible, so the caller can do <code>T t; queue.try_dequeue(&amp;t);</code>) and assignable.</p><p>I wouldn&#39;t want to force those requirements on <code>T</code>, though, so perhaps a Java-like approach such as <code>optional&lt;T&gt; try_dequeue()</code> is in order. One of the minor issues with this is that I&#39;d have to implement my own (can&#39;t use boost). Perhaps more importantly, it makes the interface seem bloated, in the sense that now I&#39;m now dragging another type in where it would (hopefully) be avoidable, and, much like the situation with STL&#39;s <code>set::insert</code> requires us to copy a pair, then &#34;unfold&#34; its arguments, it forces the user into clumsy, long ritual that has to be repeated every time he or she uses the function.</p><p>Perhaps I&#39;m worrying too much about <code>optional&lt;T&gt;</code>&#39;s usability, given that it doesn&#39;t have any of the more serious problems that the other two approaches do, but I&#39;m wondering, what would be the best approach here? Is it the <code>optional</code> one?</p><p><em>Edit</em>: It occurred to me that there&#39;s also a bit of an outlandish <code>bool try_dequeue(std::function&lt;void(T&amp;)&gt;)</code> option which actually seems pretty nice (in fact this one will actually have the most minimal interface you can have, where there&#39;s no need for any external logic setting a local <code>T</code> to the returned value). Unfortunately I&#39;d prefer to avoid the overhead incurred by calling an actual <code>std::function</code>, and using a template function <code>template&lt;class F&gt; bool try_deque(const F&amp;)</code> isn&#39;t an option either since this is a derived class (from a generic <code>queue</code> interface).</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>As long as the task is not to design a 100% generic lib for each and every case, only a queue for types &#34;T&#34; under your teams control, I would prefer the <code>bool try_dequeue(T* t)</code> approach, or even better <code>bool try_dequeue(T&amp; t)</code> (since <code>T* t</code> must never be NULL). By this design, the usage will typically look like this:</p><pre><code>  T t;
  if(try_dequeue(t))
  {
     // do something  with t;
  }
</code></pre><p>and the implementation will look like this:</p><pre><code>  bool try_dequeue(Type &amp;t)
  {
      // ... make things thread-safe
      // ... return false if queue is empty
      // ... find index to your storage array
      t=queueStorage[foundIndex];
      // ... remove element at &#34;foundIndex&#34; from &#34;queueStorage&#34;
      return true;
  }
</code></pre><p>This imposes some requirements on your type <code>T</code>: it will need a &#34;simple&#34; (probably parameterless) ctor, and it needs a &#34;copy assignment operator&#34;. A copy constructor won&#39;t be enough. For many real-world types, these requirements are easy to fulfill (especially when they are under your control). Note, that according to the <a href="http://en.wikipedia.org/wiki/Rule_of_three_(C++_programming)" rel="nofollow">rule of three</a> it is most times good idea to implement not only a user defined copy ctor alone, so if your current type T has only such a copy ctor, consider to add a copy assignment operator as well.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-how-to-keep-track-of-thread-safe-code-in-a-mostly-thread-unsafe-legacy-rich-c-code-base/'>C++ &#8211; How to Keep Track of Thread Safe Code in a mostly Thread Unsafe Legacy Rich C++ Code Base</a></li><li class="list-group-item"><a href='../should-a-lockfree-queue-use-a-condition-variable/'>Should a lockfree queue use a condition variable</a></li><li class="list-group-item"><a href='../c-const-c-dry-strategies/'>C++ &#8211; Const C++ DRY Strategies</a></li><li class="list-group-item"><a href='../c-passing-a-serial-port-instance/'>C# &#8211; Passing a Serial Port Instance</a></li><li class="list-group-item"><a href='../c-when-should-i-use-string_view-in-an-interface/'>C++ &#8211; When should I use string_view in an interface</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>