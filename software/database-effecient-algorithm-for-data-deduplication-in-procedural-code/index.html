<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Database &#8211; Effecient algorithm for data deduplication in procedural code &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074231 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074231" class="post-1074231 software type-software status-publish hentry category-software tag-algorithm-analysis tag-algorithms tag-database tag-efficiency tag-speed"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Database &#8211; Effecient algorithm for data deduplication in procedural code</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">algorithm-analysis</span><span class="mr-2 badge badge-info">algorithms</span><span class="mr-2 badge badge-warning">database</span><span class="mr-2 badge badge-primary">efficiency</span><span class="mr-2 badge badge-danger">speed</span></p><div class="entry-content"><p>I have written a data cleansing application which, for the most part, works well. It is not designed to handle large volumes of data: nothing more than about half a million rows. So early on in the design process, a decision was made to try and do as much of the work in-memory as possible. The thought was that writing to database or disk would slow things down.</p><p>For most of the various cleaning operations the application offers, this has proved true. When it comes to deduplication, however it is absurdly slow. Running on a fairly powerful server, it takes about a full 24 hours to dedupe half a million rows of data.</p><p>My algorithm runs along these steps in pseudocode:</p><pre><code>List&lt;FileRow&gt; originalData;
List&lt;FileRow&gt; copiedData = originalData.Copy;

foreach(FileRow original in originalData)
{
    foreach(FileRow copy in copiedData)
    {
        //don&#39;t compare rows against themselves
        if(original.Id != copy.Id) 
        {
            // if it&#39;s a perfect match, don&#39;t waste time with slow fuzzy algorithm
            if(original.NameData == copy.NameData)
            {
                original.IsDupe = true;
                break;
            }

            // if it&#39;s not a perfect match, try Jaro-Winkler
            if(_fuzzyMatcher.DataMatch(original.NameData, copy,NameData))
            {
                original.IsDupe = true;
                break;
            }
        }
    }
}
</code></pre><p>Look at this, it&#39;s obvious why it&#39;s so slow: where other operations can cycle through each row, this has to go through the whole file again for each row. So the processing time increases exponentially.</p><p>I have also used threading elsewhere to speed things up, but my attemtps to thread this have failed. In the real-world code we don&#39;t just make duplicates as &#34;true&#34; but group them, so that all instances of a given match get a unique Id. But the procedure has no way of knowing whether another thread has found and marked a duplicate, so threading leads to errors in the grouping Id assignment.</p><p>To try and improve matters we added a db-based cache of common Jaro-Winkler matches to try and eliminate the need for that relatively slow method. It didn&#39;t make a significant difference.</p><p>Is there another approach I can try, or improvements I can make to this algorithm to make it faster? Or am I better off giving up trying to do this in memory and writing it to a database to do the job there?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It seems to me that the only way you can really change the time complexity is to start to turn the Jaro-Winkler algorithm &#39;inside-out&#39; by collecting statistics on each value that are relevant to the algorithm.  I&#39;ll be honest and admit that I&#39;d never heard of this algorithm prior to reading your post (thanks!).  As such I am going to start typing out some vague ideas and hope the formulate into a coherent approach.  Hopefully these ideas with either work or give you some other ideas that do.</p><p>So looking at the wiki page it seems there are only three things you need to figure out:</p><ul><li>length of the strings: <code>s</code></li><li>transpositions: <code>t</code></li><li>matching characters: <code>m</code></li></ul><p>Getting the length of each string is beyond easy.  It&#39;s always the same for each string: done.  But transpositions and matches are specific to each comparison.  But we don&#39;t necessarily have to know exact values for these in order to determine whether two strings are a candidate pair.  I think you can probably create tests that will help narrow things down.</p><p>The first thing that comes to mind is inspired by <a href="https://en.wikipedia.org/wiki/Bloom_filter" rel="noreferrer">bloom filter</a>: simply index each string by the characters it contains.  Literally take all the letters and put a reference to the strings that contains it.</p><p>Then I can take a string like CAT and find all the other words that contain a &#39;C&#39;, &#39;A&#39;, and &#39;T&#39;.  I&#39;ll denote that as [C,A,T].  I can then look for [C,A],[C,T],and [A,T].  I&#39;ll presume for a moment that anything with less than two of &#39;C&#39;, A&#39;, or &#39;T&#39; would not meet the threshold i.e. you know that m/s1 must be less than 1/3.  You can take this a bit further and start calculating a upper-bound value for the comparison.  This need not be very precise.  For example with the strings in [C,A,T] you might have these upper-bounds:</p><pre><code>cattywampus: (3/3 + 3/11 + 1)/3 = 0.758
tack: (3/3 + 3/4 + 1)/3 = 0.917
thwack: (3/6 + 2)/3 = 0.833
tachometer: (3/10 + 2)/3 = 0.767
</code></pre><p>If your threshold is .8, you can eliminate two of these because you know the best they could do is under your minimum.  For the two letter index, you know that the first factor m/s1 can never be more than 2/3 and you can do the same analysis.  Any string that has none of &#39;C&#39;, &#39;A&#39;, and &#39;T&#39; has a result of 0, by definition</p><p>I think this is a start to getting away from quadratic time.  You can probably do better with some more interesting data structures or heuristics.  I&#39;m sure someone can suggest some of these techniques.  One not well formulated idea is to extend this to index to not only the characters but also to a character-position index.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-how-to-go-about-data-deduplication-at-scale/'>Database &#8211; How to go about data deduplication at scale</a></li><li class="list-group-item"><a href='../database-what-are-the-important-factors-for-database-table-design-and-object-design/'>Database &#8211; What are the important factors for database table design and object design</a></li><li class="list-group-item"><a href='../data-structure-for-pattern-matching/'>Data structure for pattern matching</a></li><li class="list-group-item"><a href='../generate-a-unique-random-4-digit-number-from-another-4-digit-number/'>Generate a unique random 4 digit number from another 4 digit number</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>