<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; How to force &#8220;program to an interface&#8221; without using a java Interface in java 1.6 &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072672 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072672" class="post-1072672 software type-software status-publish hentry category-software tag-design tag-design-patterns tag-interfaces tag-java tag-object-oriented"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; How to force &#8220;program to an interface&#8221; without using a java Interface in java 1.6</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">interfaces</span><span class="mr-2 badge badge-primary">java</span><span class="mr-2 badge badge-danger">object-oriented</span></p><div class="entry-content"><p>In java 1.8 they have wonderful new &#34;default interface methods&#34;.  In 1.6 how close can we come?  The goal: use code to keep clients from being able to tell that a class is not a java interface.  If we <strong>preserve the right to refactor the class name into a Java Interface</strong> we don&#39;t need to create a Java <code>interface</code> now.  We just provide the <code>class</code>.  Later, refactoring so the class name becomes an interface wont even touch client code.</p><p>From Telastyn&#39;s answer in <a href="https://softwareengineering.stackexchange.com/questions/232359/understanding-programming-to-an-interface">Understanding &#34;programming to an interface&#34;</a>:</p><ul><li>The &#34;Dependency Inversion Principle&#34; says that an object shouldn&#39;t control the creation  of its dependencies, it should just advertise what dependency it needs and let the caller provide it. But it doesn&#39;t specify whether the dependency should be a concrete type or an interface.</li></ul><p>I want to take advantage of this lack of distinction. I also want to interpret the principle &#34;program to an interface&#34; to mean, &#34;I shouldn&#39;t be able to tell if any client code is working with a java Interface or a java Class&#34;.  So much so, that later someone could swap out the class for a java interface with the same name and no client code would need to be touched.  That may seem overly strict and not exactly what was meant by these design principles (which try to be ignorant of java&#39;s particular quirks) but I&#39;d love to pull it off.</p><p>Here&#39;s why:  Our development environment doesn&#39;t use continuous integration.  Releases that force everyone to integrate their code happen once every&#8230; well it hasn&#39;t happened in all the years I&#39;ve been working there.  Worse than that, testing is hugely manual for reasons I wont even attempt to justify.  This means: writing a class that will get used by other people is essentially published because changing it will break someones stream or tested code that is closed and closed hard.  This means: no refactoring the signature of anything public on a shared class.  It feels the same as I expect writing an API for a library must feel.</p><p>I believe in YAGNI.  I don&#39;t want to do a BDUF.  But this situation tempts me to do silly things like put a Java Interface (big I) on every shared class even though, for now, they only have one implementation.  This is against YAGNI, it annoys developers who consider an unneeded interface to be clutter.</p><p>What I really want is the freedom to add that Interface, and maybe alternate implementations, later if needed.  I want to be 100% sure I can do this even when I can&#39;t even see all the code that might be written against my widely shared class.  I can only be that sure if I use the compiler to FORCE users to program to my interface (little i).</p><p>The question: Can you break this protection w/o using reflection from outside the trusted package?  Is the following the right way to achieve this?  In this environment you only get one shot at getting this right.  I want to know if there is anyway to lock me down to the old implementation from outside the trusted package.  All the commented code is &#34;future&#34; code. Except for the errors in main, which should always be errors.</p><p>Here we see someone trying their best to lock us down to an implementation:</p><pre><code>package untrusted;

import trusted.AmIAnInterfaceWithDefaultImplementation;
import trusted.WhoKnowsWhatImplementation;

public class Activate {

    public static void main(String[] args) {
        System.out.println( WhoKnowsWhatImplementation.thisProvides().letsFindOut() );

        AmIAnInterfaceWithDefaultImplementation i =                             
            WhoKnowsWhatImplementation.thisProvides();

        System.out.println( i.letsFindOut() );

        //Error: AmIAnInterfaceWithDefaultImplementation i = new AmIAnInterfaceWithDefaultImplementation();
        //Error: The constructor AmIAnInterfaceWithDefaultImplementation() is not visible
    }
    //Error: public class ImGonnaForceYouToBeAClass extends AmIAnInterfaceWithDefaultImplementation {}
    //Error: The type ImGonnaForceYouToBeAClass cannot subclass the final class AmIAnInterfaceWithDefaultImplementation
}
</code></pre><p>Prints: <code>Default implementation</code> twice.</p><p>Here we choose the implementation to provide in a static factory method.  It&#39;s only because we&#39;re in the same package that the constructor works.</p><pre><code>package trusted;

public class WhoKnowsWhatImplementation {
     public static AmIAnInterfaceWithDefaultImplementation thisProvides() {
        return new AmIAnInterfaceWithDefaultImplementation();
        //return new IAintNoInterfaceNoMore();
    }
}
</code></pre><p>The class below provides both the interface (small i) and the implementation but because the only constructor is protected and the class is final nothing outside the trusted package can force the interface and implementation to stay together.</p><pre><code>package trusted;

/** 
 *  Please don&#39;t instantiate directly as this may become an Interface.
 *  Use WhoKnowsWhatImplementation 
 */ 
public final class AmIAnInterfaceWithDefaultImplementation {

    protected AmIAnInterfaceWithDefaultImplementation(){}

    public String letsFindOut() {
        return &#34;Default implementation&#34;;
    }
}

//public interface AmIAnInterfaceWithDefaultImplementation{
//  public String letsFindOut();
//}
</code></pre><p>We&#39;re free to switch to being an interface and push the implementation out to a new class</p><pre><code>package trusted;

//public class IAintNoInterfaceNoMore implements AmIAnInterfaceWithDefaultImplementation {
//
//  @Override
//  public String letsFindOut() {
//      return &#34;Shiny new implementation&#34;;
//  }
//}
</code></pre><p>The need for the &#39;trusted&#39; package comes from a desire not to have the static factory method live on the same class it&#39;s instantiating.  It would have to move when we switched to a Java Interface which would impact client code.  That is why the constructor had to be package accessible.</p><p>Can you lock this down as a class from outside the trusted package without using reflection?  Is your way of locking it down something that is reasonable to protect against?  What else would you do to protect against getting locked down?  Is there a better approach in java 1.6?</p><p>I&#39;d also be interested to know if there is anyway to protect against reflection beyond the java doc begging you not to instantiate it directly but I suspect there isn&#39;t.</p><p>Many designs fail to adhere to all the design principles. This one violates the open closed principle: classes should be open to extension but closed to modification.  However, this is an attempt to ensure that the classes clients can stay closed even if it changes into a Java Interface.</p><p>The example refactoring shown here switches to an <code>interface</code> and implementation <code>class</code>.  It&#39;s worth noting that instead it might be decided that the class should actually be <code>abstract</code>.  When we switch to java 1.8, it might even end up as an <strong>interface with default methods</strong> on it.  The whole point is to preserve the right to make this decision later so we don&#39;t have to make it now when we don&#39;t know which to do and don&#39;t really care.</p><p>EDIT: I appreciate all these answers.  Before I accept one, what I&#39;m waiting for is analysis of how vulnerable this approach is to getting locked down to being a class.  I&#39;m willing to accept one that shoots down this whole idea by showing me code that dooms it to forever be a class.  Accepting one that claims it&#39;s a sound idea is a nice ego boost but I&#39;d really rather fail here than in the code base.  So convincing me that it&#39;s a sound idea is the harder job.</p><p>What I&#39;ve learned from these responses:</p><ul><li>Converting from the class to the java interface requires that clients recompile</li><li>The class must not expose any more than the java interface could (e.g., no static methods)</li><li>Some will insist classes implement Java Interfaces upfront regardless of when they are needed, <a href="http://www.symphonious.net/2011/06/18/the-single-implementation-fallacy/" rel="nofollow noreferrer">sigh</a></li></ul><p>The need to recompile the client code strikes me as the most significant issue to be aware of so I&#39;m accepting Maarten Winkels answer.  Thank you all and happy coding.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I don&#39;t see any way to &#34;lock down the interface to a class&#34; in your code,  but I do think you need to consider two things:</p><ol><li>Your clients would still need to re-compile their code, even though the client source code doesn&#39;t have to change: invoking a method on an interface uses a different bytecode operation then invoking a method on an instance.</li><li>What would prevent your coworkers from creating a class in the trusted package and invoking the constructor there?</li></ol></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-is-using-protected-inheritance-to-hide-but-exploit-implemented-interface-from-the-public-ok/'>C++ &#8211; Is using protected inheritance to hide (but exploit) implemented interface from the public ok</a></li><li class="list-group-item"><a href='../c-interface-extension-method-returning-the-interface-type-in-c/'>C# &#8211; Interface extension method returning the interface type in C#</a></li><li class="list-group-item"><a href='../java-interface-design-of-java-library-with-interdependent-yet-decoupled-packages/'>Java &#8211; Interface design of Java library with interdependent yet decoupled packages</a></li><li class="list-group-item"><a href='../java-how-to-minimize-a-java-librarys-exposed-interface-surface-while-breaking-down-the-library-into-subpackages/'>Java &#8211; How to minimize a Java library&#8217;s exposed interface surface while breaking down the library into subpackages</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>