<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture : am I doing things right &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085962 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085962" class="post-1085962 software type-software status-publish hentry category-software tag-architecture tag-entity-framework tag-net"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture : am I doing things right</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">entity-framework</span><span class="mr-2 badge badge-warning">net</span></p><div class="entry-content"><p>I&#39;m trying to use a &#39;~classic&#39; layered arch using .NET and Entity Framework. We are starting from a legacy database which is a little bit crappy:</p><ul><li>Inconsistent naming</li><li>Unneeded views (view referencing other views, <code>select *</code> views etc&#8230;)</li><li>Aggregated columns</li><li>Potatoes and Carrots in the same table</li><li>etc&#8230;</li></ul><p>So I ended with fully isolating my database structure from my domain model. To do so EF entities are hidden from presentation layer. The goal is to permit an easier database refactoring while lowering the impact of it on applications.</p><p><img src="../../../i.stack.imgur.com/5wjcD.png" alt="Assemblies are drawn as components"/></p><p>I&#39;m now facing a lot of challenges and I&#39;m starting to ask myself if I&#39;m doing things right.</p><ol><li><p>My Domain Model is highly volatile, it keeps evolving with apps as new fields needs are arising. Complexity of it keeps raising and class it contains start to get a lot of properties.</p></li><li><p>Creating include strategy and reprojecting to EF is very tricky (my domain objects don&#39;t have any kind of lazy/eager loading relationship properties):</p><pre><code>DomainInclude&lt;Domain.Model.Bar&gt;.Include(&#34;Customers&#34;).Include(&#34;Customers.Friends&#34;)
// To...
IFooContext.Bars.Include(...).Include(...).Where(...)
</code></pre></li><li><p>Some framework are raping the isolation levels (Devexpress Grids which needs either XPO or <code>IQueryable</code> for filtering and paging large data sets)</p></li></ol><p>I&#39;m starting to ask myself if :</p><ul><li>the isolation of EF auto-generated entities is an unneeded cost.</li><li>I should allow frameworks to hit <code>IQueryable</code>? Slow slope to hell? (it&#39;s really hard to isolate DevExpress framework, any successful experience?)</li><li>How can I lower the volatility of my domain model?</li></ul><h2>Precisions</h2><p><strong>EF Isolation and fields that should or should not be included on service calls</strong></p><p>Here is how I isolate EF Entities. Presentation layer is an isolation layer as no presentation can access to repositories class.</p><pre><code>// Inside a service class. For this sample Customer is defined in the service model
// And Person is autogenerated by Entity Framework
/// Get the customers who bought an item ///
IEnumerable&lt;Customer&gt; GetCustomers(Item item){
    var query = from person in _personRepository.GetItemBuyers(item.Id)
                select new Customer {
                  Id = person.CustomerId
                  , FirstName = person.FirstName
                  , LastName = person.LastName
                  , Sex = person.Sex == &#39;M&#39; ? Sex.Male : Sex.Female};
    return query;
}
</code></pre><p>It can get time consuming especially when you need to include (or not) some relationship properties.<br /> There is multiple solutions for including:</p><pre><code> 1. GetCustomersWithOrders(Item item); 
 2. GetCustomers(Item item, IncludeStrategy&lt;Customer&gt; include);
 3. GetCustomers(Item item, params string[] fieldsIncluded);
</code></pre><ol><li>Will obvioulsy result in service class containing thousands of GetCustomersWith&#8230;With&#8230;</li><li>Will create a lot of IncludeStrategy inherited class. I&#39;m still working on a dynamic fluent approach <code>DomainInclude&lt;Customer&gt;.Include(&#34;Orders&#34;).Include(&#34;Friends&#34;)</code></li><li>Will need the creation of some mapping dictionnary &#34;Orders&#34; =&gt; &#34;CustomerAccount.PayedOrders&#34;</li></ol><p><strong>Framework hitting IQueryable</strong></p><p>Repositories don&#39;t expose IQueryable, the goal is to hide entity framework.<br /> Devexpress datagrids need an IQueryable to allow paging/filtering without loading the whole table in memory.</p><p>Finding a workaround is nearly impossible as it will be really time consuming and the portability of the workaround is not assured with new devexpress releases.</p><p>My question here is: Is it a big deal to allow devexpress going through the layers up to the EF context class. Should I drop Devexpress instead and use a more flexible datagrids (Sencha ExtJs, &#8230;)</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You&#39;ve got a number of questions in your overall question.  I&#39;ll try to touch upon each of them.</p><p>Overall, the answer is:</p><h3>&#34;Yes, you&#39;re doing things right.&#34;</h3><p></p><p>Rarely are we given a clean and ideal architecture to work from.  Heck, rarely are we even given an architecture, period.  Small consolation, I realize.  But you&#39;re asking the right questions and taking the right approach.</p><p>One thing you may not have realized is that isolating the EF layer and the database access is a step towards encapsulating the changes the application is seeing.  Juval Lowy of <a href="http://www.idesign.net/" rel="nofollow">iDesign</a> is a huge advocate of encapsulating the <em>change</em>.  Change is good because it keeps us employed and keeps our applications alive, but we want to limit the impact any change can have upon the rest of the application.  So we encapsulate it.</p><p>You can&#39;t lower the volatility of your <em>domain</em> (note, I didn&#39;t say <em>domain model</em>) and you wouldn&#39;t want to even if you could.  All you can do is encapsulate that volatility.  Once you isolate the volatility of your domain, then your domain model will fall in line.</p><p>Identify the areas of your database that seem prone to most frequent change.  Isolate out those aspects so you can more easily make the changes while minimizing downstream impact.  Using a data access layer is a good start.  It might be time to consider a sub-layer for data access that allows you to create a composite of those for the main DA layer.</p><p>Some people love EF, some people really don&#39;t see much advantage to it when weighed against the costs.  Of those who use EF, they tend to work with the latest release of that toolset.  The recent (v4.5?) updates have made EF more usable / workable.  Wether or not it&#39;s a good technological decision for <em>you</em> is something that only <em>you</em> can decide.  Look at your alternatives; examine the cost to switch to those; and move forward.  As a suggestion, create a test branch in your repository, migrate away from EF on that branch and work through some of the challenges.  Then you&#39;ll know.</p><p>The performance issues within your database imply that you need to consider some restructuring. <a href="http://en.wikipedia.org/wiki/Database_normalization" rel="nofollow">Normalization</a>, in moderation, is a good thing.  It&#39;s easy to go overboard with it, but restructuring your tables so that they are more easily indexed will likely help with the performance issues.  This could also help with encapsulating some of the change you&#39;re seeing from updates to the applications.</p><p>For example, you may have a table <code>CustomerInfo</code> with a primary key of <code>CustomerID</code>.  If App1 is adding / changing ancillary columns off of <code>CustomerInfo</code> then you can give App1 it&#39;s own subtable <code>CustomerInfoExtensions</code> keyed back to <code>CustomerInfo</code> with the <code>CustomerID</code>.</p><p>I don&#39;t know of any data access approach that will fix bad structure within the database tables.  So you may be &#34;blaming&#34; EF in this case when the root issue lies in the DB.  And there are no silver bullets when it comes to crunching huge data sets.  If <code>DomainInclude&lt;Customer&gt;.Include(&#34;Orders&#34;).Include(&#34;Friends&#34;)</code> creates a cartesian product across your largest tables, well, then that will simply be your least performant query.  Fix the query before worrying about the data access method.</p><p>Exposing an IQueryable isn&#39;t necessarily a bad thing.  If you need (want) a more concrete expression of that Interface, then pick an appropriate generic container.  We pass collections around like that all the time, and it makes using the <a href="http://en.wikipedia.org/wiki/MVVM" rel="nofollow">MVVM pattern</a> a lot simpler to implement when displaying the data.  I think your concern here is that you feel there should be something &#34;more&#34; to what the EF layer is returning.  If an IQueryable is sufficient, then use one.  If you need a first class data object on the return, then create one.  But don&#39;t create a first class data object just to have one if the IQueryable is good enough.  That would be extra work.</p><p>The question of DevExpress vs. other datagrids leads me to an answer of &#34;meh.&#34;  You&#39;ve got bigger challenges to resolve first before worrying about that one.  Consider the UI (View) as an area that will change.  Encapsulate it.  When you decide you hate <code>FooBar-Grid</code> (or whatever is your current flavor of UI) then you can get rid of it more easily.  Personally, I would worry about enhancing the DB and data access layers first, but I&#39;m an engineer who appreciates the simple elegance of the command line.  Call me biased.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../should-we-bind-view-to-a-model-property-or-viewmodel-should-have-its-own/'>Should we bind view to a model property or ViewModel should have it&#8217;s own..</a></li><li class="list-group-item"><a href='../architecture-repository-pattern-with-service-layer-too-much-separation/'>Architecture &#8211; Repository pattern with service layer &#8211; too much separation</a></li><li class="list-group-item"><a href='../c-architecture-how-to-pass-models-between-controllers-services-and-repositories/'>C# &#8211; Architecture: How to pass models between controllers, services and repositories</a></li><li class="list-group-item"><a href='../c-entity-framework-and-avoiding-the-anemic-domain-model/'>C# &#8211; Entity Framework and avoiding the Anemic Domain Model</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>