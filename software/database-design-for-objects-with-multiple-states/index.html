<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Database design for objects with multiple states &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068494 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068494" class="post-1068494 software type-software status-publish hentry category-software tag-architectural-patterns tag-architecture tag-database tag-database-design tag-enterprise-architecture"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Database design for objects with multiple states</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">architectural-patterns</span><span class="mr-2 badge badge-info">Architecture</span><span class="mr-2 badge badge-warning">database</span><span class="mr-2 badge badge-primary">database-design</span><span class="mr-2 badge badge-danger">enterprise-architecture</span></p><div class="entry-content"><p><strong>Context</strong></p><p>I&#39;m designing a database which, simplified, should be able to handle users sending job requests to each other, and after that a job can be started, finished, and reviewed. The design should be scalable (think millions of users).</p><p><strong>Approaches I&#39;ve considered:</strong></p><p><em>Gargantuan table</em></p><p>One approach, probably not the best one, would be to simply store ALL jobs in one, huge table <code>jobs</code>. This table would need a <code>state</code> column to represent which state the job is currently in (e.g. <code>ACCEPTED</code>, <code>STARTED</code>, <code>FINISHED</code>, <code>REVIEWED</code> e.t.c.). The biggest problem with this approach that I can see is that jobs in different states have different types of data that are relevant to them. For example, a job request has a preliminary agreed upon price, but that could change before the job is started, and change again before the job is finished. This could of course be solved by just adding more columns to the table and naming them properly, but it will probably become a huge bottleneck performance-wise very early to have one table containing all the different types of possible data for all the different possible states of a job.</p><p><em>Different tables for different states</em></p><p>This approach would be to have multiple tables, for example <code>job_requests</code>, <code>jobs_started</code>, <code>jobs_finished</code>, tables who in turn can have substates, e.g. <code>job_requests</code> could have the sub-states <code>PENDING</code>, <code>ACCEPTED</code>, while the <code>jobs_finished</code> table would have the substates <code>COMPLETED</code>, <code>CANCELLED</code>, <code>REVIEWED</code>.</p><p>With this approach each table only contains data which is relevant to the current job state, but on the other hand some data might be duplicated (for example the user ids of the job requester, and job receiver &#8212; on the other hand this information could be stored in yet another table?).<br /> The problem with this approach is that I can&#39;t think of a good solution on how to archive all the information when transitioning between states. For example, once a job request has been accepted, and then started, it should be deleted from the <code>job_requests</code> table and moved into the <code>jobs_started</code> table, but it&#39;s just a matter of time before a stakeholder wants to know for example how long the average time is between a job request being created, until it&#39;s been started, at which point I&#39;d need the data from the job_requests table to be able to calculate it.</p><p>It feels like this type of problem should be easy to solve, but I really can&#39;t think of any good solution which &#34;feels right&#34;, any solution I come up with feels ugly and I can immediately think of a number of things which makes the solution bad.</p><p>Very grateful for any feedback or tips on approaches I could take. Thanks in advance!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Sounds like you have 3 major categories of data you are trying to store:</p><ol><li>General job data (job id, job requester id, job receiver id etc)</li><li>State transitions (job started, job finished)</li><li>State-specific job data</li><li>(optional) job-related events (price changed, job receiver user reassigned etc)</li></ol><p><em>The key is to separate event-like data from everything else.</em></p><h2>Schema design</h2><p>Here are some details:</p><h3>1. General jobs table</h3><p>All of the information that&#39;s NOT state-specific goes into the (let&#39;s say) &#34;jobs&#34; table. Auto-generated primary key: job_id</p><h3>2. State transitions table</h3><p>All information about state transitions goes into &#34;job_state_transitions&#34; table, which might have the following columns:</p><ul><li>job_transition_id</li><li>job_id</li><li>created_at</li><li>from_state</li><li>to_state</li></ul><p>Ideally this table is append-only. Nothing is every updated or removed here.</p><p>Using such a table, you can find out the latest status of any particular job by selecting the latest row for a given job_id from the job_transitions table. You can further denormalize that and introduce a &#34;job_state&#34; column, the contents of which are updated every time a new row is inserted in job_transition table (stored procedures might help here if that&#39;s your thing).</p><p>You can also do all sorts of analysis on state transitions, because the timing data is preserved (created_at is a date/time field that can help with that)</p><h3>3. State-specific job data</h3><p>All of the state-specific data goes into &#34;[state]-jobs&#34; tables. Primary key: some sequence id. Main index: job_transition_id</p><h3>4. Optional event data</h3><p>You can also introduce an &#34;audit trail&#34; table that allows you to keep track of various changes that users might request for each job, like your &#34;change agreed upon price&#34;. This is a generalization of the state transition table: one main table that contains events and a one supplemental table for each event type (for example, price_changes table with job_id, created_at, from_price and to_price columns).</p><h2>Scaling to millions of users</h2><p>If the main &#34;jobs&#34; table grows to be unwieldy, you can shard it by job_id or requesting_user_id or something like that.</p><p>Likewise, events table should be append-only and can be rotated or purged of events related to jobs that have been finished.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-design-pattern-for-modelling-job-execution-flow/'>Design &#8211;  design pattern for modelling job execution flow</a></li><li class="list-group-item"><a href='../database-design-for-polymorphic-data/'>Database design for polymorphic data</a></li><li class="list-group-item"><a href='../database-efficient-way-to-search-data-based-on-multiple-attributes/'>Database &#8211; Efficient way to search data based on multiple attributes</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>