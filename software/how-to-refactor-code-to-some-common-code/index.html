<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to refactor code to some common code &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069991 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069991" class="post-1069991 software type-software status-publish hentry category-software tag-maintainability tag-refactoring tag-self-improvement"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to refactor code to some common code</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">maintainability</span><span class="mr-2 badge badge-info">refactoring</span><span class="mr-2 badge badge-warning">self-improvement</span></p><div class="entry-content"><p><strong>Background</strong></p><p>I&#39;m working on an ongoing C# project. I&#39;m not a C# programmer, primarily a C++ programmer. So I was assigned basically easy and refactoring tasks.</p><p>The code is a mess. It&#39;s a huge project. As our customer demanded frequent releases with new features and bug fixes, all other developers were forced to take brute force approach while coding. The code is highly unmaintainable and all other developers agree with it.</p><p>I&#39;m not here to debate whether they did it right. As I&#39;m refactoring, I&#39;m wondering if I&#39;m doing it in the right way as my refactored code seems complex! Here is my task as simple example.</p><p><strong>Problem</strong></p><p>There are six classes: <code>A</code>, <code>B</code>, <code>C</code>, <code>D</code>, <code>E</code> and <code>F</code>. All of the classes have a function <code>ExecJob()</code>. All six implementations are very similar. Basically, at first <code>A::ExecJob()</code> was written. Then a slightly different version was required which was implemented in <code>B::ExecJob()</code> by copy-paste-modification of <code>A::ExecJob()</code>. When another slightly different version was required, <code>C::ExecJob()</code> was written and so on. All six implementations have some common code, then some different lines of code, then again some common code and so on. Here is a simple example of the implementations:</p><pre><code>A::ExecJob()
{
    S1;
    S2;
    S3;
    S4;
    S5;
}

B::ExecJob()
{
    S1;
    S3;
    S4;
    S5;
}

C::ExecJob()
{
    S1;
    S3;
    S4;
}
</code></pre><p>Where <code>SN</code> is a group of exact same statements.</p><p>To make them common, I&#39;ve created another class and moved the common code in a function. Using parameter to control which group of statements should be executed:</p><pre><code>Base::CommonTask(param)
{
    S1;
    if (param.s2) S2;
    S3;
    S4;
    if (param.s5) S5;
}

A::ExecJob() // A inherits Base
{
    param.s2 = true;
    param.s5 = true;
    CommonTask(param);
}

B::ExecJob() // B inherits Base
{
    param.s2 = false;
    param.s5 = true;
    CommonTask(param);
}

C::ExecJob() // C inherits Base
{
    param.s2 = false;
    param.s5 = false;
    CommonTask(param);
}
</code></pre><p><strong>Note that, this example only employs three classes and oversimplified statements. In practice, the <code>CommonTask()</code> function looks very complex with all those parameter checking and there are many more statements. Also, in real code, there are several <code>CommonTask()</code>-looking functions.</strong></p><p>Though all the implementations are sharing common code and <code>ExecJob()</code> functions are looking cuter, there exists two problems that are bothering me:</p><ul><li>For any change in <code>CommonTask()</code>, all six (and may be more in the future) features are needed to be tested.</li><li><code>CommonTask()</code> is already complex. It will get more complex over time.</li></ul><p>Am I doing it in the right way?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Yes, you are absolutely in the right path!</p><p>In my experience, I noticed that when things are complicated, the changes happen in small steps. What you have done is the <strong>step 1</strong> in the evolution process (or refactoring process). Here is step 2 and step 3:</p><p><strong>Step 2</strong></p><pre><code>class Base {
  method ExecJob() {
    S1();
    S2();
    S3();
    S4();
    S5();
  }
  method S1() { //concrete implementation }
  method S3() { //concrete implementation }
  method S4() { //concrete implementation}
  abstract method S2();
  abstract method S5();
}

class A::Base {
  method S2() {//concrete implementation}
  method S5() {//concrete implementation}
}

class B::Base {
  method S2() { // empty implementation}
  method S5() {//concrete implementation}
}

class C::Base {
  method S2() { // empty implementation}
  method S5() { // empty implementation}
}
</code></pre><p>This is the &#39;Template Design Pattern&#39; and it is one step ahead in the refactoring process. If the base class changes, the subclasses (A,B,C) don&#39;t need to get affected. You can add new subclasses relatively easily. However, right away from the picture above you can see that
the abstraction is broken. The need for &#39;empty implementation&#39; is a good indicator; it shows that there is something wrong with your abstraction. It might have been an acceptable solution for short-term, but there seems to be a better one.</p><p><strong>Step 3</strong></p><pre><code>interface JobExecuter {
  void executeJob();
}
class A::JobExecuter {
  void executeJob(){
     helper = new Helper();
     helper-&gt;S1();
     helper-&gt;S2();
     helper-&gt;S3();
     helper-&gt;S4();
     helper-&gt;S5();
  }
}

class B::JobExecuter {
  void executeJob(){
     helper = new Helper();
     helper-&gt;S1();
     helper-&gt;S3();
     helper-&gt;S4();
     helper-&gt;S5();
  }
}

class C::JobExecuter {
  void executeJob(){
     helper = new Helper();
     helper-&gt;S1();
     helper-&gt;S3();
     helper-&gt;S4();
  }
}

class Base{
   void ExecJob(JobExecuter executer){
       executer-&gt;executeJob();
   }
}

class Helper{
    void S1(){//Implementation} 
    void S2(){//Implementation}
    void S3(){//Implementation}
    void S4(){//Implementation} 
    void S5(){//Implementation}
}
</code></pre><p>This is the &#39;Strategy Design Pattern&#39; and seems as a good fit for your case. There are different strategies to execute the job and each class (A,B,C) implements it differently.</p><p>I am sure there is a step 4 or step 5 in this process or a lot better refactoring approaches. However, this one will let you eliminate duplicate code and make sure that the changes are localized.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/object-oriented-how-should-i-refactor-switch-statements-like-this-switching-on-type-to-be-more-oo/'>Object-oriented &#8211; How should I refactor switch statements like this (Switching on type) to be more OO</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/how-to-dry-refactor-several-similar-functions/'>How to DRY refactor several similar functions</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>