<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; How to design an efficient moderation system for comments &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082923 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082923" class="post-1082923 software type-software status-publish hentry category-software tag-ajax tag-async tag-database-design tag-jquery tag-php"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; How to design an efficient moderation system for comments</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">ajax</span><span class="mr-2 badge badge-info">async</span><span class="mr-2 badge badge-warning">database-design</span><span class="mr-2 badge badge-primary">jquery</span><span class="mr-2 badge badge-danger">PHP</span></p><div class="entry-content"><p>Here&#39;s the job I want to do:</p><p>My project is a website where there will be a <strong>lot</strong> of comments.<br /> Those comments will be moderated: a moderator will connect, see comments and accept or refuse them.</p><p>I need those things:</p><ul><li>the comments won&#39;t have any &#34;moderator&#34; associated. Which implies that when a moderator connects, the system &#34;assigns&#34; the 20 first comments to this moderator then sends them via an AJAX/JSON request</li><li>of course, this implies that those comments musn&#39;t be assigned to other moderators</li></ul><p>How can I make a design so that I&#39;ll be sure &#34;getting the 20 first comments for a moderator&#34; can be an atomic operation?<br /> And there&#39;s another thing to think of (I don&#39;t know if it may have an impact or not on my problem): if there are say 10 moderators connected, one of them has 20 comments to validate, and this guy leaves his PC for the whole day. I may implement kindof a &#34;timeout&#34; for this moderator, then, when he tries to validate, a message will tell him &#34;sorry this comment has already been moderated by another moderator&#34;, and the AJAX script will get a &#34;fresh new 20 comments).</p><p>My first idea was the simplest idea:</p><ul><li>a moderator connects</li><li>a jQuery AJAX script asks the server for 20 comments</li><li>the server (1) makes immediately a request of the 20 first free comments to the database</li><li>the server (2) &#34;freezes&#34; the 20 free comments</li><li>the server (3) makes up a JSON response and sends it</li></ul><p>But the operations (2) and (3) are not atomic, what happens if, in-between, another operator asks for the 20 first free comments? They both will get the 20 first free comments. That&#39;s not a good solution. I think this is a classical problem of atomic operation on db. Any idea how to design this (or where to look)?</p><p>Thank you very much indeed!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You&#39;re planning to deal with much concurrent activity, so that means you&#39;ve got to think in terms of atomic operations. That means using transactions.</p><p>Now, you don&#39;t want to hold a transaction for a long time as it blocks other transactions, so you have to think about using the transactions to protect minimal state changes and putting guards on the UPDATE operations so that only the things that are supposed to change actually do so.</p><p>What would you be wanting to UPDATE? Well, the first step has got to be to introduce an association between the comment and the moderator to whom it is assigned, but you&#39;ve also got to set a time after which the moderation becomes invalid (so that a separate cleanup job can know to reset the association and let some other moderator have a go). Conceptually then, you&#39;re doing:</p><h2>For the start of moderation:</h2><ul><li>In one transaction:<ul><li>Pick 20 comments that are not assigned to a moderator.</li><li>For each of those, assign them to the “current” moderator and set an expiry time (e.g., in 15 minutes).</li></ul></li></ul><h2>On performance of a moderation action for one comment:</h2><ul><li>In one transaction:<ul><li>See whether the comment is still assigned to the “current” moderator.</li><li>See whether the expiry time has been reached.</li><li>If both conditions are true, update the comment with its new moderation status and remove the association with the moderator.</li><li>If either is false, moan!</li></ul></li></ul><h2>As a separate cleanup task (performed every <em>X</em> seconds):</h2><ul><li>In one transaction:<ul><li>Go through the table of assigned comments, and if the expiry time on an entry is in the past, remove the assignment.</li></ul></li></ul><p>Given the above, you&#39;ll probably want to have the relation between comment IDs, moderators and the expiry times in a separate table that is indexed by comment ID (which might even be reasonably the primary key).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../php-handling-recurring-curl-post-request/'>Php &#8211; Handling recurring cURL POST request</a></li><li class="list-group-item"><a href='../php-im-thinking-to-csrf-protect-all-public-ajax-requests-that-return-json-but-i-have-some-concerns/'>Php &#8211; I&#8217;m thinking to CSRF protect all public AJAX requests that return JSON, but I have some concerns</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>