<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; Multi-Layered Architecture: where I should implement the error logging \ handling &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067813 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067813" class="post-1067813 software type-software status-publish hentry category-software tag-design tag-error-handling"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; Multi-Layered Architecture: where I should implement the error logging \ handling</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">error handling</span></p><div class="entry-content"><p>I&#39;m currently refactoring a large subsystem with a multi layered architecture, and I&#39;m struggling to design an effective error logging \ handling strategy.</p><p>Let&#39;s say that my architecture consists of the following three layers:</p><ul><li>Public Interface (I.E an MVC Controller)</li><li>Domain Layer</li><li>Data Access Layer</li></ul><p>My source of confusion is where I should implement the error logging \ handling:</p><ol><li><p>The easiest solution would be to implement the logging at the top level (I.E the Public Interface \ MVC Controller). However this feels wrong because it means bubbling up the exception through the different layers, and then logging it; rather than logging the exception at it&#39;s source.</p></li><li><p>Logging the exception at it&#39;s source is obviously the best solution because I have the most information. My problem with this is that I can&#39;t catch every exception at source without catching ALL exceptions, and in the domain / public interface layer, this will lead to catching exceptions that have already been caught, logged and re-thrown by the layer below.</p></li><li><p>Another possible strategy is a mix of #1 and #2; whereby I catch specific exceptions at the layer they are most likely to be thrown (I.E Catching, logging and re-throwing <code>SqlExceptions</code> in the Data Access Layer) and then log any further uncaught exceptions at the top level. However this would also require me to catch and relog every exception at the top level, because I can&#39;t distinguish between errors that have already been logged \ handled vs those that have not.</p></li></ol><p>Now, obviously this is an issue in most software applications, so there must be a standard solution to this problem that results in exceptions being caught at source, and logged once; however I just can&#39;t see how to do this myself.</p><p>Note, the title of this question is very similar to &#39;<a href="https://softwareengineering.stackexchange.com/questions/255372/logging-exception-in-multi-tier-application">Logging exceptions in a multi tier application&#34;</a>&#39;, however the answers in that post are lacking detail and are not sufficient to answer my question.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>To your questions:</p><blockquote><p>The easiest solution would be to implement the logging at the top
 level</p></blockquote><p>Having the exception bubble up to the top level is an absolutely correct and plausible approach. None of the higher layer methods tries to continue some process after the failure, which typically can&#39;t succeed. And a well-equipped exception contains all the information necessary for logging. And doing nothing about exceptions helps you keep your code clean and focussed on the main task instead of the failures.</p><blockquote><p>Logging the exception at it&#39;s source is obviously the best solution
 because I have the most information.</p></blockquote><p>That&#39;s half correct. Yes, most useful information is available there. But I&#39;d recommend to put all this into the exception object (if it isn&#39;t already there) instead of immediately logging it. If you log at a low level, you still need to throw an exception up to tell your callers that you didn&#39;t complete your job. This ends up in multiple logs of the same event.</p><h2>Exceptions</h2><p>My main guideline is to catch and log exceptions at the top level only. And all the layers below should make sure that all necessary failure information gets transported up to the top level. Within a single-process application e.g. in Java, this mostly means not to try/catch or log at all outside the top level.</p><p>Sometimes, you want some context information included in the exception log that&#39;s not available in the original exception, e.g. the SQL statement and parameters that were executed when the exception was thrown. Then you can catch the original exception and re-throw a new one, containing the original one plus the context.</p><p>Of course, real life sometimes interferes:</p><ul><li><p>In Java, sometimes you have to catch an exception and wrap it into a different exception type just to obey some fixed method signatures. But if you re-throw an exception, make sure the re-thrown one contains all information needed for later logging.</p></li><li><p>If you are crossing an inter-process border, often you technically can&#39;t transfer the full exception object including the stack trace. And of course the connection might get lost. So here&#39;s a point where a service should log exceptions and then try its best to transmit as much of the failure information as possible across the line to its client. The service must make sure the client gets a failure notice, either by receiving a failure response or by running into a timeout in case of a broken connection. This will typically result in the same failure to be logged twice, once inside the service (with more detail) and once in the client&#39;s top level.</p></li></ul><h2>Logging</h2><p>I&#39;m adding some sentences about logging in general, not only exception-logging.</p><p>Besides exceptional situations, you want important activities of your application to get recorded in the log as well. So, use a logging framework.</p><p>Be careful about log levels (reading logs where debug information and serious errors are not flagged with different accordingly is a pain!). Typical log levels are:</p><ul><li>ERROR: Some function failed irrecoverably. That doesn&#39;t necessarily mean your whole program crashed, but some task couldn&#39;t be completed. Typically, you have an exception object describing the failure.</li><li>WARNING: Something strange happened, but didn&#39;t cause any task to fail (strange configuration detected, temporary connection breakdown causing some retries, etc.)</li><li>INFO: You want to communicate some significant program action to the local system administrator (starting some service with its configuration and software version, importing data files into the database, users logging into the system, you get the idea...).</li><li>DEBUG: Things you as the developer want to see when you are debugging some issue (but you&#39;ll never know in advance what you really need in case of this or that specific bug - if you can foresee it, you&#39;ll fix the bug). One thing that&#39;s always useful is to log activities on external interfaces.</li></ul><p>In production, set the log level to INFO. The results should be useful to a system administrator so he knows what&#39;s going on. Expect him to call you for assistance or bug-fixing for every ERROR in the log and half of the WARNINGs.</p><p>Enable the DEBUG level only during real debugging sessions.</p><p>Group the log entries into appropriate categories (e.g. by the fully-qualified classname of the code that generates the entry), allowing you to switch on debug logs for specific parts of your program.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../design-the-modern-way-to-perform-error-handling/'>Design &#8211; The modern way to perform error handling&#8230;</a></li><li class="list-group-item"><a href='../c-is-catching-general-exceptions-really-a-bad-thing/'>C# &#8211; Is catching general exceptions really a bad thing</a></li><li class="list-group-item"><a href='../java-passing-multiple-errors-back-from-service-layer/'>Java &#8211; Passing multiple errors back from service layer</a></li><li class="list-group-item"><a href='../global-try-catch-in-presentation-layer/'>Global try-catch in presentation layer</a></li><li class="list-group-item"><a href='../c-mapping-exceptions-to-error-response/'>C# &#8211; Mapping exceptions to error response</a></li><li class="list-group-item"><a href='../handling-domain-errors-in-the-api/'>Handling domain errors in the API</a></li><li class="list-group-item"><a href='../javascript-node-js-error-handling-through-each-layer/'>Javascript &#8211; Node.js error handling through each layer</a></li><li class="list-group-item"><a href='../error-handling-in-nest-service-layer/'>Error handling in Nest service layer</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>