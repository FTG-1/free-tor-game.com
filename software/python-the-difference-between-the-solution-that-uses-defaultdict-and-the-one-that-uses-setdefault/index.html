<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python &#8211;  the difference between the solution that uses defaultdict and the one that uses setdefault &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079180 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079180" class="post-1079180 software type-software status-publish hentry category-software tag-dictionary tag-python tag-python-3-x"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python &#8211;  the difference between the solution that uses defaultdict and the one that uses setdefault</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">dictionary</span><span class="mr-2 badge badge-info">python</span><span class="mr-2 badge badge-warning">python-3.x</span></p><div class="entry-content"><p>In <em>Think Python</em> the author introduces <em>defaultdict</em>. The following is an excerpt from the book regarding <em>defaultdict</em>:</p><blockquote><p>If you are making a dictionary of lists, you can often write simpler<br /> code using defaultdict. In my solution to Exercise 12-2, which you can<br /> get from <a href="http://thinkpython2.com/code/anagram_sets.py" rel="nofollow noreferrer">http://thinkpython2.com/code/anagram_sets.py</a>, I make a<br /> dictionary that maps from a sorted string of letters to the list of<br /> words that can be spelled with those letters. For example, &#39;opst&#39; maps<br /> to the list [&#39;opts&#39;, &#39;post&#39;, &#39;pots&#39;, &#39;spot&#39;, &#39;stop&#39;, &#39;tops&#39;]. Here’s<br /> the original code:</p><pre><code> def all_anagrams(filename):
     d = {}
     for line in open(filename):
         word = line.strip().lower()
         t = signature(word)
         if t not in d:
             d[t] = [word]
         else:
             d[t].append(word) return d
</code></pre><p>This can be simplified using setdefault, which you might have used in Exercise 11-2:</p><pre><code> def all_anagrams(filename):
     d = {}
     for line in open(filename):
         word = line.strip().lower()
         t = signature(word)
         d.setdefault(t, []).append(word) return d
</code></pre><p>This solution has the drawback that it makes a new list every time, regardless of whether it is needed. For lists, that’s no big deal, but if the factory function is complicated, it might be. We can avoid this problem and simplify<br /> the code using a defaultdict:</p><pre><code>def all_anagrams(filename):
    d = defaultdict(list)
    for line in open(filename):             
        word = line.strip().lower() 
        t = signature(word)
        d[t].append(word)
    return d
</code></pre></blockquote><p>Here&#39;s the definition of <code>signature</code> function:</p><pre><code>def signature(s):
    &#34;&#34;&#34;Returns the signature of this string.

    Signature is a string that contains all of the letters in order.

    s: string
    &#34;&#34;&#34;
    # TODO: rewrite using sorted()
    t = list(s)
    t.sort()
    t = &#39;&#39;.join(t)
    return t 
</code></pre><p>What I understand regarding the second solution is that <code>setdefault</code> checks whether <code>t</code> (the signature of the word) exists as a key, if not, it sets it as a key and sets an empty list as its value, then <code>append</code> appends the word to it. If <code>t</code> exists, <code>setdefault</code> returns its value (a list with at least one item, which is a string representing a word), and <code>append</code> appends the word to this list.</p><p>What I understand regarding the third solution is that <code>d</code>, which represents a <em>defaultdict</em>, makes <code>t</code> a key andsets an empty list as its value (if <code>t</code> doesn&#39;t already exist as a key), then the word is appended to the list. If <code>t</code> does already exist, its value (the list) is returned, and to which the word is appended.</p><p>What is the difference between the second and third solutions? I What it means that the code in the second solution makes a new list every time, regardless of whether it&#39;s needed? How is <code>setdefault</code> responsible for that? How does using <em>defaultdict</em> make us avoid this problem? How are the second and third solutions different?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The key line is this one:</p><pre><code>d.setdefault(t, []).append(word) return d
</code></pre><p><code>d.setdefault</code> is just a function.  That function is receiving two arguments: t, and a new list.  Both of those arguments are evaluated before setdefault is called, which means the list is constructed, then setdefault is called, and might immediately discard the new list.</p><p>The internal implementation of <code>setdefault</code> might look like:</p><pre><code>def setdefault(self, key, default):
    try:
        return self[key]
    except KeyError:
        self[key] = default
        return self[key]
</code></pre><p>Note that if <code>key</code> exists, <code>default</code> is never used!  In the case of <code>defaultdict</code>, it only constructs a new object when you need it.  An implementation could look something like:</p><pre><code>class defaultdict(dict):

    def __init__(self, factory):
        self.factory = factory

    def __missing__(self, key):
        self[key] = self.factory()
        return self[key]
</code></pre><p><code>__missing__</code> is called by dictionaries when an item is not in the dictionary.  In this case, an object is only created in that case.</p><p>As the author points out, lists are relatively cheap, but what if the object being constructed opened a file?  Or a network socket?  Then you have that overhead, only to throw it away immediately afterwards.</p><p>The downside of defaultdict, of course, is that all items in your dictionary get the same initial value.  (The return value of whatever callable is provided to the defaultdict constructor.)   Of course, you could always use the above as a sample to have different behavior if all you need is the key.</p><p>Note that the real implementations of both <code>setdefault</code> and <code>defaultdict</code> are probably significantly more complex -- I&#39;ve glossed over many details and there are likely both performance enhancements and code to handle edge cases I haven&#39;t thought of.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/the-difference-between-a-hash-and-a-dictionary/'>The difference between a hash and a dictionary</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/python-the-difference-between-proxy-class-and-delegation-in-python/'>Python &#8211;  the difference between proxy class and delegation in Python</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/object-oriented-what-is-the-difference-between-object-and-value-in-python/'>Object-oriented &#8211; what is the difference between Object and Value in Python</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>