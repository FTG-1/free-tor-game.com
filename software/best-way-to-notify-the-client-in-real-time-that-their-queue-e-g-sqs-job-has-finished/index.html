<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Best way to notify the client in real time that their queue (e.g. SQS) job has finished &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069829 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069829" class="post-1069829 software type-software status-publish hentry category-software tag-aws tag-message-queue tag-pubsub"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Best way to notify the client in real time that their queue (e.g. SQS) job has finished</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aws</span><span class="mr-2 badge badge-info">message-queue</span><span class="mr-2 badge badge-warning">pubsub</span></p><div class="entry-content"><p><strong>Current Scenario</strong></p><p>Our application allows users to upload (Amazon S3) and manage their files through our interface. Currently those users can download the files directly from S3/Cloudfront through our application.</p><p><strong>Adding a Zip feature</strong></p><p>We would like to add a feature to the system that allows users to select multiple files at once and download them as a zip file.</p><p>We would like the process to work in real time, so that when the user clicks the button to download a zip file, the system processes the request, compiles the zip, and returns the zip to the end user.   While the process is running, the front-end will tell the user their request is processing, and when it is complete, it will prompt them to download the file.</p><p><strong>Proposed Strategy</strong></p><p>Our application is AWS cloud based, so my first instinct is to use <a href="http://aws.amazon.com/sqs/" rel="noreferrer">Amazon SQS</a> (but am open to other suggestions) to build a queue system to handle these requests.  The flow would work like this:</p><ol><li>User selects files and requests a zip file to be created.</li><li>Front-end sends a request to SQS with the files to be zipped, and the destination (on S3) where the final zip file will be stored.</li><li>The queue worker uses <a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-long-polling.html" rel="noreferrer">long polling</a> to check for new SQS jobs. When a job is found, the worker downloads the files from S3, zips them up, and returns the finished zip file to the specified location on S3.</li><li>Now that the queue has finished processing, alert the client that their job is done and their file is ready for download.</li></ol><p><strong>Best Way to Handle Step 4?</strong></p><p>This process appears to be a solid approach, and everything makes sense up until step 4.  We are struggling with the best way to notify the end user in real-time that their job has finished and their file is ready for download.</p><p>From my research I have seen three ways that people suggest:</p><ol><li><p>Use pub/sub to create a socket for the job, and return the response when complete.</p><ul><li>From everything I have read, it is not best practice (and sometimes not possible) to create a large number of open pub/sub sockets/channels. In addition, how does SQS notify the open socket that the job is complete? <a href="http://docs.aws.amazon.com/sns/latest/dg/SendMessageToSQS.html" rel="noreferrer">This article regarding Amazon SNS</a> looked promising at first, but they seem to infer that it is best practice to use a single SNS topic for the entire queue, not an SNS topic per job.  This seems like a great approach if we were simply wanting to send an email to the user, letting them know their job has finished.  However, I want to be able to update the user interface inside the web browser.</li></ul></li><li><p>Continuous polling by the front-end server for the finished zip file on S3.</p><ul><li>If there are thousands of simultaneous jobs, this would create thousands of requests.  This approach doesn&#39;t seem very scaleable, and could potentially cost money by extra S3 api calls.</li></ul></li><li><p>Leave an open long-running request</p><ul><li>Due to the fact that if there are many jobs in the queue, the time taken to deliver the response could cause the request to time out.  In addition this creates a lot of strain/wasted resources on the front-end web server.  Again, not very scaleable.</li></ul></li></ol><p><strong>My Question</strong></p><p>Taking into account the points that I mentioned above, what is the best way to notify the front-end client that their job queue has finished and their file is ready to download?</p><p>A great example of what I am trying to do is YouTube.  When you upload a video to YouTube, their queue processes your video, and when it is complete, it notifies you that the video processing has finished.  I am trying to replicate the same concept, except that in my scenario, I just want to the client to know when the zip file has been prepared and uploaded to S3.</p><p>I&#39;m aware of theoretical solutions, so please be specific.  I am open to any suggestions, regardless if they use SQS or any of the technologies/methodologies I have listed. Pointing to any real-world code examples of this sort of thing would be a big bonus.</p><p>Thank you in advance for your great help!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>My thinking is your front-end establishes a server sent event (<a href="https://developer.mozilla.org/en-US/docs/Server-sent_events/Using_server-sent_events" rel="nofollow">https://developer.mozilla.org/en-US/docs/Server-sent_events/Using_server-sent_events</a>) with a web server which issues the do job message via SQS to the worker. When the worker completes it adds a message back to the web server on a separate queue which is being polled for batches of messages at a time, for each one sending the event back down to the client.</p><p>You do not need to use web sockets as your client and server will not be chatting back and forth.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-cache-invalidation-on-multiple-servers/'>Architecture &#8211; Cache invalidation on multiple servers</a></li><li class="list-group-item"><a href='../messaging-between-microservices-on-aws/'>Messaging between microservices on AWS</a></li><li class="list-group-item"><a href='../python-how-to-create-a-python-microservice-on-aws-that-both-accepts-rest-connections-and-processes-sqs-messages/'>Python &#8211; How to create a Python microservice on AWS that both accepts REST connections and processes SQS messages</a></li><li class="list-group-item"><a href='../invoking-lambda-directly-from-s3-vs-going-via-sqs/'>Invoking lambda directly from S3 vs going via SQS</a></li><li class="list-group-item"><a href='../architecture-net-core-microservice-messaging-with-amazon-sns-and-sqs/'>Architecture &#8211; .NET Core Microservice messaging with Amazon SNS and SQS</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>