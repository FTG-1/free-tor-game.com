<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; How much mocking is &#8220;just right?&#8221; &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087865 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087865" class="post-1087865 software type-software status-publish hentry category-software tag-mocking tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; How much mocking is &#8220;just right?&#8221;</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">mocking</span><span class="mr-2 badge badge-info">unit testing</span></p><div class="entry-content"><p>I titled the question jokingly because I&#39;m sure that &#34;it depends,&#34; but I have some specific questions.</p><p>Working in software that has many deep layers of dependency, my team has become accustomed using mocking fairly extensively to separate each code module from the dependencies beneath it.</p><p>Therefore I was surprised that <a href="http://rads.stackoverflow.com/amzn/click/1933988274" rel="nofollow noreferrer">Roy Osherove</a> suggested in <a href="http://www.youtube.com/watch?v=9ZSbuwCmwuc" rel="nofollow noreferrer">this video</a> that you should be using mocking only something like 5% of the time. I&#39;d guess that we&#39;re sitting somewhere between 70-90%.  I&#39;ve seen other <a href="http://codebetter.com/sebastienlambla/2013/07/11/unit-testing-is-out-vertical-slice-testing-is-in/" rel="nofollow noreferrer">similar guidance</a> from time to time as well.</p><p>I should define what I consider to be two categories of &#34;integration tests&#34; which are so distinct that they really should be given different names:  1) In-process tests which integrate multiple code modules and 2) Out-of-process tests which talk to databases, file systems, web services, etc.  It is type #1 that I am concerned with, tests which integrate multiple code modules all in-process.</p><p>Much of the community guidance I have read suggests that you should prefer a large number of isolated, fine-grained unit tests and a small number of coarse-grained end-to-end integration tests, because unit tests give you precise feedback on exactly where regressions might have been created, but the coarse tests, which are cumbersome to set up, actually verify more end-to-end functionality of the system.</p><p>Given this, it seems necessary to make rather frequent use of mocking to isolate these separate units of code.</p><p>Given an object model as follows:</p><p><img src="../../../i.stack.imgur.com/SIvbe.png" alt="enter image description here"/></p><p>&#8230; Also consider that our application&#39;s dependency depth goes much deeper than I could fit in this image, so that there are multiple layers N between the 2-4 layer and the 5-13 layer.</p><p>If I want to test some simple logical decision being made in unit #1, and if every dependency is constructor-injected into the code module that depends on it such that, say, 2, 3, and 4 are constructor injected into module 1 in the image, I would much rather inject mocks of 2, 3, and 4 into 1.</p><p>Otherwise, I would need to construct concrete instances of 2, 3, and 4.  This can be more difficult than just some extra typing.  Often 2, 3, and 4 will have constructor requirements which can be challenging to satisfy and according to the graph (and according to the reality of our project), I&#39;ll need to construct concrete instances of N through 13 to satisfy the constructors of 2, 3, and 4.</p><p>This situation becomes more challenging when I need 2, 3, or 4 to behave in some certain way so that I can test the simple logical decision in #1.  I might need to understand and &#34;mentally reason about&#34; the entire object graph/tree all at once to get 2, 3, or 4 to behave in the necessary way.  It often seems much easier to do myMockOfModule2.Setup(x=&gt; x.GoLeftOrRight()).Returns(new Right()); to test that module 1 responds as expected when module 2 tells it to go right.</p><p>If I were to test concrete instances of 2 &#8230; N &#8230; 13 all together, the test setups would be very large and mostly duplicated.  Test failures might not do a very good job of pinpointing the locations of regressions failures.  Tests would not be <a href="https://stackoverflow.com/questions/61400/what-makes-a-good-unit-test">independent</a> (<a href="http://blog.stevensanderson.com/2009/08/24/writing-great-unit-tests-best-and-worst-practises/" rel="nofollow noreferrer">another supporting link</a>).</p><p>Granted, it is often reasonable to do state-based, rather than interaction-based, testing of the bottom layer, since those modules seldom have any further dependency.  But it seems that mocking is almost necessary by definition to isolate any modules above the bottom-most.</p><p>Given all of this, can anyone tell me what I might be missing?  Is our team overusing mocks?  Or is there perhaps some assumption in typical unit testing guidance that the layers of dependency in most applications will be shallow enough that it is indeed reasonable to test all of the code modules integrated together (making our case &#34;special&#34;)?  Or perhaps differently, is our team not bounding our bounded contexts adequately?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Is our team overusing mocks?</p></blockquote><p>Not at first glance.</p><p>If you have 1..13 modules, then each should have its own unit tests, and all (non-trivial, untrusted) dependencies should be replaced by test versions. That <em>can</em> mean mocks, but some people are pedantic with naming, so fakes, shims, null objects... some people refer to all test implementations as &#34;mocks&#34;. This might be the source of the confusion about how much is &#34;right&#34;.</p><p>Personally, I just call all test objects &#34;mocks&#34; because distinguishing between the variety of them isn&#39;t often useful. As long as they keep my unit tests fast, isolated and resilient... I don&#39;t care what they&#39;re named.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-how-do-functional-languages-handle-a-mocking-situation-when-using-interface-based-design/'>Unit-testing &#8211; How do functional languages handle a mocking situation when using Interface based design</a></li><li class="list-group-item"><a href='../tdd-mocking-out-tightly-coupled-objects/'>TDD: Mocking out tightly coupled objects</a></li><li class="list-group-item"><a href='../unit-testing-from-a-tdd-perspective-am-i-a-bad-person-if-i-test-against-a-live-endpoint-instead-of-a-mock/'>Unit-testing &#8211; From a TDD perspective, am I a bad person if I test against a live endpoint instead of a mock</a></li><li class="list-group-item"><a href='../how-does-functional-style-helps-with-mocking-dependencies/'>How does functional style helps with mocking dependencies</a></li><li class="list-group-item"><a href='../unit-testing-how-exactly-should-unit-tests-be-written-without-mocking-extensively/'>Unit-testing &#8211; How exactly should unit tests be written without mocking extensively</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>