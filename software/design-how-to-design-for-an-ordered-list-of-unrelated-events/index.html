<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; How to design for an ordered list of unrelated events &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075442 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075442" class="post-1075442 software type-software status-publish hentry category-software tag-api-design tag-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; How to design for an ordered list of unrelated events</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api-design</span><span class="mr-2 badge badge-info">design</span></p><div class="entry-content"><p>This is a bit of an invented example but I think it best illustrates my question: Say I&#39;m creating a chess replay event API. Say I have a lot of different &#34;events&#34; I want to keep track of, in a specified order. Here might be some examples:</p><ol><li><p>A move event — this contains the <code>previous</code> and <code>new</code> square.</p></li><li><p>A timer event — this contains the <code>timestamp</code> that the timer was toggled between players</p></li><li><p>A chat message event — this contains the <code>player ID</code>, the <code>message</code> and <code>time sent</code></p></li></ol><p>&#8230;etc. The point is that the data model for each event is very different — there isn&#39;t much of a common interface.</p><p>I want to design an API that can store and expose essentially a <code>List&lt;Event&gt;</code> to a client who can choose to process these different events as they wish. We don&#39;t know what clients will do with this information: Perhaps one client may need to do text analysis on the <code>ChatMessageEvent</code>s, and one may consume and replays these events in the UI. The challenge is that ordering between events must be preserved, so I can&#39;t separate by methods like <code>getMoveEvents</code> and <code>getTimerEvents</code> since a <code>TimerEvent</code> can happen between move events and the client may need that information.</p><p>I could expose a visitor to allow clients to handle each event type differently in the list, but I&#39;m wondering if there&#39;s a better way to handle a situation like this.</p><p><strong>Edit:</strong> I want to design this with one main priority: provide clients with an easy and flexible way to iterate through these events. In an ideal scenario, I would envision the end user writing handlers to the event types they care about, and then be able to iterate through without casting based on the runtime type.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I am under the strong impression you are overthinking this.</p><blockquote><p>The challenge is that ordering between events must be preserved, so I can&#39;t separate by methods like getMoveEvents and getTimerEvents</p></blockquote><p>Then simply don&#39;t offer such methods in your API. Let the client filter out the events they need, and do not implement anything in your API which could become error prone.</p><blockquote><p>I could expose a visitor to allow clients to handle each event type differently in the list</p></blockquote><p>This sounds overengineered. You described the requirement as getting something like a <code>List&lt;Event&gt;</code>, containing recorded events. For this, a simple method <code>List&lt;Event&gt; getEvents()</code> would be totally sufficient (maybe an <code>IEnumerable&lt;Event&gt;</code> would be enough). For reasons of efficiency, it may be necessary to offer some methods for restricting the result set to certain conditions.</p><blockquote><p>but I&#39;m wondering if there&#39;s a better way to handle a situation like this</p></blockquote><p>Asking for a <a href="https://softwareengineering.meta.stackexchange.com/questions/8965/why-questions-about-the-correct-way-are-too-broad">&#34;better&#34; (or &#34;best&#34;, or &#34;correct&#34;) approach</a> is way too unspecific when you don&#39;t know any criteria for what you actually mean by &#34;better&#34;. But how do find criteria for what is &#34;better&#34;? The only reliable way I know for this problem is:</p><h2>Define some typical use cases for your API!</h2><ul><li><p>Do this in code. Write down a short function which tries to <strong>use</strong> your API, solving a real problem you know for sure the clients will encounter (even if the API does not exists or is not implemented yet).</p><p>It may turn out the client will need something like a property to distinguish event types. It may turn out the client needs something to get only the events from the last hour, or the last 100 events, since providing him always a full copy of all former events may not be effcient enough. It may turn out the client needs to get a notification whenever a new event is created.</p><p>You will only be able to decide this when you develop a clear idea of the context in which your API will be used.</p></li><li><p>If you add some code to this function which verifies the API&#39;s result, and place this code into a the context of a unit testing framework, then you are doing &#34;Test Driven Development&#34;</p></li><li><p>But even if you don&#39;t want to use TDD or don&#39;t like TDD, it is best to approach this <strong>from the client&#39;s perspective</strong>.</p></li><li><p>Don&#39;t add anything to your API where you have doubts if there will ever be a use case for. Chances are high noone will ever need that kind of function.</p></li></ul><p>If you don&#39;t know enough about the use cases of the API to use this approach, you will probably do some more requirements analysis first - and that is something we cannot do for you.</p><p><strong>Let me write something to your final edit, where you wrote</strong></p><blockquote><p>and then be able to iterate through without casting based on the runtime type.</p></blockquote><p>Casting based on the runtime type isn&#39;t necessarily an issue. It becomes only a problem when it makes extensions to the <code>Event</code> class hierarchy harder, because existing Client code would be forced to change with each extension.</p><p>For example, let&#39;s say there is client code handling all chat events by a type test  plus a cast for <code>ChatEvent</code>. If a new event type is added which is not a chat event, existing code will still work. If a new chat-like event is added, as a derivation of <code>ChatEvent</code>, existing code will <em>also</em> still work as long as the <code>ChatEvent</code> type conforms to the LSP. For specific chat events, polymorphism can be used inside the <code>ChatEvent</code> part of the inheritance tree.</p><p>So instead of avoiding type tests and casts superstitiously under all circumstances, because you have read in a text book &#34;this is generally bad&#34;, <strong>reflect why and when this really causes any problems</strong>. And as I wrote above, writing some client code for some real use cases will help you to get a better understanding  for this. This will allow you also to validate what will happen when your list of events get extended afterwards.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-how-chose-a-design-for-an-event-system/'>C++ &#8211; How chose a design for an event system</a></li><li class="list-group-item"><a href='../design-for-client-server-synchronisation/'>Design for client-server synchronisation</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>