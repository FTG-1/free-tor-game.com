<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Sharing buffer between multiple threads &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067298 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067298" class="post-1067298 software type-software status-publish hentry category-software tag-io tag-java tag-multithreading"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Sharing buffer between multiple threads</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">io</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">multithreading</span></p><div class="entry-content"><p>I had a job process that was executing a lot of IO to read and write  temporary files.<br /> Now I want to (need to) reduce the quantity of IO executions.</p><p>So I want to create  a sort of circular buffer that is going to be filled up with a data from a text file within first thread.</p><p>The consumer (reading) thread will fetch data from this buffer.</p><p>The problem is that there could be multiple consumers that need to read from same one buffer.</p><p>For buffer implementation I prefer not to use any existing wrappers (simple  array, where i just &#34;play&#34;  with indices is enough).</p><p>I also don&#39;t want to create a separate buffer for every reader.<br /> And ofcourse I want to avoid any deadlocks and unnecessary  blockings.</p><p><strong>UPDATE</strong><br /> Right now I am using circular buffer (an array and 2 indices)</p><p>The question is how to implement such buffer that can be accessed by  multiple consumers where each consumer can read from it interdependently from other consumers (one costumer may read faster than the other one).</p><p><strong>IMPORTANT UPDATE</strong><br /> The first thread don&#39;t know (and should not know) about it&#39;s consumers!!!<br /> It should write data to a buffer, when data ends it should raise a flag.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Using a bare array is forcing you to do more work than you need to. People have spent a lot of time coming up with data structures to make your life easier, so use them.</p><p>It sounds like you are trying to implement a <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Queue.html" rel="nofollow">Queue</a>. This is a data structure that allows you to add things to the collection and then remove them later. This is done in a first in first out order. Java even has a <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html" rel="nofollow">Thread-Safe Queue</a> built in. You can simply make an instance of that class and give each of your threads a reference to it. The producer will add items to the queue and the consumer(s) will remove items from the queue or perform another action if the queue is empty.</p><p>If you really have your heart set on implementing everything yourself, you will need to <a href="http://docs.oracle.com/javase/tutorial/essential/concurrency/locksync.html" rel="nofollow">synchronize</a> all access to your array so that two threads can&#39;t access the buffer at the same time.</p><p><strong>EDIT:</strong></p><p>It wasn&#39;t clear before that you wanted every consumer to read every bit of data. You can extend the Queue implementation so it keeps track of the count of items (making <code>size()</code> constant time) and then throw an exception if the queue is full.</p><p>To solve the popping issue is a little trickier. You need to keep track of the index that each consumer is at, a map would do this. Then when all of the consumers have moved passed an item, it can be popped and update all the indexes in the map. When a consumer calls <code>pop()</code> and the item needs to be retained you can re-route it to a <code>peek()</code>.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-scheduling-a-few-cpu-intensive-tasks/'>Java &#8211; Scheduling a few CPU-intensive tasks</a></li><li class="list-group-item"><a href='../design-how-does-the-consumer-producer-solution-work/'>Design &#8211; How does the consumer-producer solution work</a></li><li class="list-group-item"><a href='../c-net-multithreaded-application-design/'>C#/.NET multithreaded application design</a></li><li class="list-group-item"><a href='../java-collect-and-prcess-data-from-multiple-threads-in-java/'>Java &#8211; Collect and prcess data from multiple threads in Java</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>