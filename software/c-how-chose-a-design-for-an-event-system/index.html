<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; How chose a design for an event system &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084315 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084315" class="post-1084315 software type-software status-publish hentry category-software tag-c tag-design tag-entity tag-event tag-performance"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; How chose a design for an event system</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">entity</span><span class="mr-2 badge badge-primary">event</span><span class="mr-2 badge badge-danger">performance</span></p><div class="entry-content"><p>I&#39;m working on a Entity Component System for learning purpose. I made major changes with my design so I was wondering if I could pick a better design for my event system.</p><blockquote><p>The purpose of the event system (if you don&#39;t know ECS), is to allow<br /> communication between process. For example, in a video game (that&#39;s<br /> always more easy to understand with video games) your collision system<br /> may want to tell to other system when there is a collision and with<br /> which entities.</p></blockquote><hr/><p>With this little context, my current design for the event system was more :</p><ul><li>When an event is emit -&gt; save it into event manager (shared ptr)</li><li>Then call every subscribers and send them a <strong>shared ptr</strong> of the data (<strong>thanks to Bart van Ingen Schenau</strong>)</li><li>Inside the callback, save the event into a queue to consume it on the<br /> next update call</li></ul><hr/><p>But events are read only, so I wonder if something like that won&#39;t be better:</p><ul><li>When an event is emit -&gt; call every subscribers and send them a copy of the event</li><li>Inside the callback, move the event into a queue to consume it on the<br /> next update call</li></ul><hr/><p><strong>The systems will be multithreading (which  mean at least than events can be emit on any thread).</strong></p><p>One of the most important part of my new design, is that system are &#34;split&#34; in blocs (you can see that like several update function). But events are for the whole system. So copies will mean that I&#39;ll need some garbage collector function for each system to free events which where consume. Well in fact I still need that with shared ptr.</p><p>There is probably a lot of other designs. So if you think of something good for an ECS generic (not only for video games), where events subscriber tend to regroup, give me your thought please.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In my case I don&#39;t bother with copying events or anything like that and there&#39;s no concern about thread-safety at the event processing level since it&#39;s all done by a single thread. :-D</p><p>That said, it still utilizes a concurrent queue since different threads could want to concurrently <em>push</em> events, but there is only one central handler <em>popping</em> events and invoking a <code>process_events</code> callback on systems that specify it (non-null function pointer on registering the system -- my SDK uses a C API). That central event handler also spends most of its time sleeping while waiting to be notified since I don&#39;t spam the system so much with events.</p><p>The systems then just loop through the read-only array of read-only events popped off by central event handler and do whatever they need to do, and all of that is happening inside the event-handling thread. By design it&#39;s encouraged that systems don&#39;t do any heavy work in the event processing callbacks. Instead if they have interesting and complex work to do, they can queue it themselves to process in their main processing loops which could be running in a different thread from the event handling callbacks or spawn off a new thread specifically in response to that one event.</p><p>I find this the simplest solution to reason about. I also try to take it easy on event-handling and minimize its use since I find it the most uncomfortable type of &#34;inter-system communication&#34; possible. Personally I always disliked event-driven programming, finding it a necessity but not something I want to lean on too much, and always trying to avoid it when possible. I like more easily-predictable control flows whenever possible where I&#39;m never surprised about &#34;when&#34; something happens. I also dogmatically made it a superficial error (even though the system can handle it) to try to push events from the event handling callbacks. :-D I hate cascading events where one event triggers another recursively and so I deliberately made that painful to do with my system in hopes that anyone tempted to do it will think up something else with a &#34;flatter, not deeper&#34; design that doesn&#39;t cascade events throughout the system.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/design-are-there-any-design-pattern-to-data-binding-in-event-driven-architecture/'>Design &#8211; Are there any design pattern to data binding in event driven architecture</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>