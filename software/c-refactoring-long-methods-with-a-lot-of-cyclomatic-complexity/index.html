<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Refactoring long methods with a lot of cyclomatic complexity &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078076 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078076" class="post-1078076 software type-software status-publish hentry category-software tag-c tag-design tag-design-patterns tag-refactoring tag-separation-of-concerns"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Refactoring long methods with a lot of cyclomatic complexity</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">design-patterns</span><span class="mr-2 badge badge-primary">refactoring</span><span class="mr-2 badge badge-danger">separation-of-concerns</span></p><div class="entry-content"><p>I&#39;m attempting to refactor what is becoming a very large method &#8212; currently 350 or so lines &#8212; that contains a high degree of <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity" rel="nofollow noreferrer">cyclomatic complexity</a>.</p><p>I understand and ascribe to the theories that methods should be short and that concerns should be separated, and I&#39;ve been reading over things like <a href="https://softwareengineering.stackexchange.com/questions/169925/are-long-methods-always-bad">this</a> and <a href="https://stackoverflow.com/questions/475675/when-is-a-function-too-long">this</a> among others.  I&#39;m struggling to refactor my method, though, for a couple of reasons.  To help illustrate these, first here is a simplified example of what the method looks like before refactoring:</p><pre><code>private static void ProcessMessage(Message toProcess)
{
    var processingIssues = new StringBuilder();
    var transformedAttachments = new List&lt;TransformedAttachmentData&gt;();

    foreach (var attach in toProcess.Attachments)
    {
        //in reality there is quite a bit of nested logic here,
        //but I&#39;ll represent it as a single if-else block.
        if (true)
        {
            //in reality, a third-party library is used in multiple
            //levels of this logic hierarchy to produce the transformed data.
            transformedAttachments.Add(new TransformedAttachmentData(attach));
        }
        else
        {
            processingIssues.AppendLine(
                string.Format(@&#34;Issue &#34;&#34;{0}&#34;&#34; occurred with &#34; +
                @&#34;attachment &#34;&#34;{1}&#34;&#34;.&#34;, &#34;blah blah problem&#34;, attach.Name));
        }
    }

    /*
     * do something else complex here with 
     * processingIssues and validResults
     */
}
</code></pre><p>First, the very cyclomatic complexity which is concerning to me is born of a complicated set of business rules that need to be applied which together sum up to a couple shared sets of data (represented here as <code>processingIssues</code> and <code>transformedAttachments</code>).  Basically what this means to me is that not only should I break the <code>foreach</code> out into its own method, but I should also further consider breaking the logic tree contained within it into additional methods in the interest of keeping my methods &#34;short&#34;.  In other words, it would seem as though it&#39;s not enough just to break my current method into its two obvious outer-most parts: &#34;pre-processing&#34; and &#34;post-processing&#34; of the attachments, if you will.  How far do I need to go with this given that I am dealing with a complicated logic tree with concerns that are not so &#34;separate&#34; from one another.  In other words, if &#34;separation of concerns&#34; is one reason to refactor to smaller methods, but so is &#34;cyclomatic complexity&#34; &#8212; both of which seem to be orthogonal concepts &#8212; which is the &#34;right&#34; reason to refactor, and how should I do it in the latter case?</p><p>Second, in order to separate out some of the concerns to separate methods, those separate methods will have to return multiple variables (again, <code>processingIssues</code> and <code>transformedAttachments</code>), both of which are only needed within the separate methods themselves, so I&#39;m faced with the choice: use output parameters, or create a small class to wrap the return values.  Which is better?</p><p>Any guidance on this topic and my specific hang-ups would be much appreciated.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your scenario seems like you have placed an entire &#34;message processing subsystem&#34; inside a single function.  In order to simplify the function, you will need to come up with an actual message processing subsystem consisting of several classes.  Some, if not all, of these classes will need to be instantiated, allowed to run, and discarded on each invocation of your method.</p><p>This will be a subsystem which will have some state and some classes implementing <em>operators</em> (the actual rules.)  The issue of returning multiple results is transformed into the task of modifying more than one item of state of the subsystem, and the issue of various rules interacting with each other is also transformed into having some rules modifying the state of the subsystem while other rules look at this modified state in order to figure out what to do.</p><p>Essentially, there would be a pretty close correlation between the set of local variables of your function and the set of member variables of the message processing subsystem class, though the subsystem might need to contain more member variables in order to capture information which is currently encoded in conditional branching (<code>if</code> statements) in your existing method.</p><p>Needless to say, the total number of lines in such a subsystem might easily exceed your current 350 lines by a factor of 2 or 3, so, before you embark on such a refactoring, consider whether you really need it.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-var-args-constructors-methods-vs-lists/'>Java &#8211; var args constructors/methods vs lists</a></li><li class="list-group-item"><a href='../java-avoid-too-complex-method-cyclomatic-complexity/'>Java &#8211; Avoid too complex method &#8211; Cyclomatic Complexity</a></li><li class="list-group-item"><a href='../c-how-does-breaking-up-a-big-method-into-smaller-methods-improve-unit-testability-when-the-methods-are-all-private/'>C# &#8211; How does breaking up a big method into smaller methods improve unit testability when the methods are all private</a></li><li class="list-group-item"><a href='../c-long-method-refactoring-leaving-as-is-vs-separating-into-methods-vs-using-local-functions/'>C# &#8211; Long method refactoring: leaving as is vs separating into methods vs using local functions</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>