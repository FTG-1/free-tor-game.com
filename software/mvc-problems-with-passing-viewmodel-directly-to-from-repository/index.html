<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>MVC &#8211; Problems with passing ViewModel directly to / from repository &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068004 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068004" class="post-1068004 software type-software status-publish hentry category-software tag-asp-net-mvc tag-asp-net-mvc5"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">MVC &#8211; Problems with passing ViewModel directly to / from repository</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-mvc</span><span class="mr-2 badge badge-info">asp.net-mvc5</span></p><div class="entry-content"><p>I have an ASP.NET MVC 5 site.</p><p>I have several complex view models &#8211; usually subsets of a far larger model. Should I create items in the repository that take the ViewModels &#8211; then just use Dapper.net to map them to some SQL?</p><p>If not I would have to map the ViewModel to the Model somewhere. I can then use the standard Model Insert or Update. This causes two problems &#8211; how and where to map from ViewModel to Model (I don&#39;t want to create lots of work).</p><p>Also, where I am updating a subset of fields of a larger model &#8211; I want to avoid setting the fields that aren&#39;t in the ViewModel to NULL. If I just map a ViewModel to a Model &#8211; I will lose data.</p><p>It seems the simplest easiest solution is just to pass ViewModels in and out of Repositories. But is this bad practice? If so how can I make my other option (or a third option) work better?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>I have several complex view models - usually subsets of a far larger
 model. Should I create items in the repository that take the
 ViewModels - then just use Dapper.net to map them to some SQL?</p></blockquote><p>This wouldn&#39;t necessarily be wrong for a very small, trivial app, or a quick&#39;n&#39;dirty KISS/YAGNI solution just to get something out of the door with minimal time or effort, but doesn&#39;t really fit with the spirit of the MVC pattern so I would caution against that as a general approach.</p><p>A few notes on MVC:</p><ul><li>A <strong>ViewModel</strong> (<em>A <strong>model</strong> of the <strong>view</strong></em>) belongs exclusively to your UI layer; not to your business layer or data layer.</li><li>The aim of the MVC pattern is to encapsulate all UI-specific concerns;  decoupling the UI from the app.   This allows the rest of the app to remain wholly agnostic to the UI; freed of any UI-specific constructs or concerns.</li><li>ViewModels can be reasonably expected to contain View-specific properties, and maybe custom logic describing how to display an item of data, as well as Data Annotations on top of the displayed properties.</li><li>Changes to a View are often facilitated by changes in the corresponding ViewModel; this indicates a very close dependency between the two.</li></ul><p>By pushing ViewModels directly into your Repository, you risk introducing technical debt in a number of ways:</p><ol><li><p>If anything about your View changes, it can affect the ViewModel, which means it potentially affects the <code>Repository</code> too;  this exposes you to the risk of future changes cascading and being &#34;snowballed&#34; across the app  unnecessarily.</p></li><li><p>Other views needing to re-use the same repository method would also need to know about the ViewModel used by the repository; even if those Views have their own separate ViewModels - that adds further danger to the cascading/snowballing effect of changes to the ViewModel.</p></li><li><p>Using the ViewModel in this way implies direct interaction between the <code>Controller</code> and a <code>Repository</code> - that&#39;s all good in simple cases, but for anything nontrivial it involves additional logic which doesn&#39;t strictly belong in either class:</p><ul><li>The responsibility of a <code>Controller</code> should ideally be limited to Creating a <code>ViewModel</code> from the service/business layer and injecting it into a <code>View</code> (or conversely, receiving an HTTP Request and using the request data to call into the service/business layer).</li><li>The responsibility of a <code>Repository</code> should ideally be limited to object persistence.</li></ul></li><li><p>Arguably, using a ViewModel in this way means it ceases to be a real ViewModel because you would need to move it into your Business layer or service layer to work; the result is having that layer effectively &#39;contaminated&#39; by UI-specific concerns</p></li></ol><p>When a simple call into your repository isn&#39;t enough and you need additional business logic to pull down the right kind of data into your controller, consider putting that logic into a separate <code>Service</code> class to ensure that neither your controllers nor repositories have that burden, for example:</p><pre><code>public class MyLittleController : Controller
{
    // Service uses the Repositor(y/ies) internally and does a lot of work 
    // to fulfil a request
    private IMyLittleService _service;
    public MyLittleController(IMyLittleService s) { _service = s; }

    // By using a service for the veryComplexQueryString, the only logic 
    // in the controller is for deciding between a 404 or a ViewModel...
    public ActionResult MyLittleWebpage(string veryComplexQueryString)
    {
        var adventurer = _service.QueryAdventurer(veryComplexQueryString);
        var quest = _service.GetQuest(adventurer?.Id);

        if (quest == null)
        {
            return HttpNotFound();
        }

        var model = new MyLittleViewModel 
        { 
            Name = adventurer.Name,
            Quest = quest.Name,
            FavouriteColour = adventurer.FavouriteColour,
        };

        return View(model);
    }
}
</code></pre><blockquote><p>If not I would have to map the ViewModel to the Model somewhere. I can
 then use the standard Model Insert or Update. This causes two problems
 - how and where to map from ViewModel to Model (I don&#39;t want to create lots of work).</p></blockquote><p>Bridging the divide between your Business Layer and your Presentation Layer is the responsibility of your Controller, which includes mapping to/from your ViewModels.  You could consider doing the actual work within Helper methods or use a library such as <a href="https://github.com/AutoMapper/AutoMapper" rel="nofollow noreferrer">AutoMapper</a>. (<a href="https://stackoverflow.com/questions/16527921/mapping-domain-model-to-view-model-via-automapper-or-not">Related question on SO</a>)</p><blockquote><p>Also, where I am updating a subset of fields of a larger model - I
 want to avoid setting the fields that aren&#39;t in the ViewModel to NULL.
 If I just map a ViewModel to a Model - I will lose data.</p></blockquote><p>Sometimes its easier to use a different model for your POST and PUT requests.   A ViewModel is for your UI state, so it&#39;s only real purpose is to be used in an action which returns a <code>View()</code>.</p><p>POST/PUT requests are about issuing commands, and a POST/PUT action usually isn&#39;t expected to <code>return View(model);</code> (usually a <code>RedirectToAction</code> instead).    A POST/PUT action usually only needs to be a &#39;pass through&#39; to some service class, in which case the domain models could be used for the request instead.</p><hr/><p><em>Update in response to the comment about Data Annotations:</em></p><p>Luckily, Dapper itself ignores Data Annotations so that shouldn&#39;t cause you any problems.  Most of the time each framework uses it&#39;s own Data Annotations in fact;  the real danger of using across many layers is not really a <em>technical</em> one and more of a &#39;code cleanliness&#39; issue, and conceptually it starts to feel like a violation of SRP (a single model which serves different purpose depending where it&#39;s used).</p><p>As an aside, I once reviewed some code whereby somebody had managed to reuse the same Model for a whole bunch of different libraries and tools - it had various properties and attributes which were used in different frameworks in it.  The reality of reusing Models in too many places can often look a bit like this:</p><pre><code>[XmlElement(&#34;Album&#34;)]
public class Album
{
    [DisplayName(&#34;Album ID&#34;)]
    [ScaffoldColumn(false)]
    [Key(&#34;Id&#34;)]
    [XmlAttribute(&#34;id&#34;)]
    public int AlbumId { get; set; }

    [DisplayName(&#34;Genre ID&#34;)]
    [ForeignKey(&#34;Genre&#34;)]
    [XmlIgnore]
    public int GenreId { get; set; }

    [DisplayName(&#34;Artist ID&#34;)]
    [ForeignKey(&#34;Artist&#34;)]
    [XmlIgnore]
    public int ArtistId { get; set; }

    [DisplayName(&#34;Album Title&#34;)]
    [Required]
    [StringLength(80)]
    [XmlAttribute(&#34;albumTitle&#34;)]
    public string Title { get; set; }

    [NotMapped]
    [DisplayName(&#34;Album&#34;)]
    [XmlAttribute(&#34;AlbumName&#34;)]
    public string AlbumName { get; set; }

}
</code></pre><p>As somebody trying to read a model like this and figure out which attributes or properties are used at which layer it becomes a lot to think about; and all in the name of merely &#34;saving&#34; a few lines of code to map between models.</p><p>Furthermore, you do run the risk that some of the annotations <strong><em>could</em></strong> end up having an effect in the wrong place;  again this is more of a risk with an ORM such as EntityFramework which also uses some of those same attributes as ASP.NET</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-split-out-a-service-layer/'>How to split out a service layer</a></li><li class="list-group-item"><a href='../mvc-partial-model-updates-from-view/'>Mvc &#8211; Partial Model Updates From View</a></li><li class="list-group-item"><a href='../mapping-domain-models-to-viewmodel/'>Mapping Domain models to ViewModel</a></li><li class="list-group-item"><a href='../architecture-how-to-refactor-services-into-api-repository-and-caching-net/'>Architecture &#8211; How to refactor services into API, repository and caching (.NET)</a></li><li class="list-group-item"><a href='../how-to-design-bll-in-asp-net-mvc/'>How To Design BLL in ASP.NET MVC</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>