<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; Designing unit tests for a stateful system &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068632 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068632" class="post-1068632 software type-software status-publish hentry category-software tag-design tag-tdd tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; Designing unit tests for a stateful system</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">tdd</span><span class="mr-2 badge badge-warning">unit testing</span></p><div class="entry-content"><h2>Background</h2><p><a href="https://en.wikipedia.org/wiki/Test-driven_development" rel="noreferrer">Test Driven Development</a> was popularized after I already finished school and in the industry. I am trying to learn it, but some major things still escape me. TDD proponents say lots of things like (hereafter referred to as the &#34;single assertion principle&#34; or <strong>SAP</strong>):</p><blockquote><p>For some time I&#39;ve been thinking about how TDD tests can be as simple, as expressive, and as elegant as possible. This article explores a bit about what it&#39;s like to make tests as simple and decomposed as possible: aiming for a single assertion in each test.</p></blockquote><p>Source: <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=35578" rel="noreferrer">http://www.artima.com/weblogs/viewpost.jsp?thread=35578</a></p><p>They also say things like this (hereafter referred to as the &#34;private method principle&#34; or <strong>PMP</strong>):</p><blockquote><p>You generally don&#39;t unit test private methods directly. Since they are private, consider them an implementation detail. Nobody is ever going to call one of them and expect it to work a particular way.</p><p>You should instead test your public interface. If the methods that call your private methods are working as you expect, you then assume by extension that your private methods are working correctly.</p></blockquote><p>Source: <a href="https://softwareengineering.stackexchange.com/questions/100959/how-do-you-unit-test-private-methods">How do you unit test private methods?</a></p><h2>Situation</h2><p>I am trying to test a stateful data processing system. The system can do different things for the exact same piece of data given what it&#39;s state was prior to receiving that data. Consider a straightforward test that builds up state in the system, then tests the behavior that the given method is intended to test.</p><ul><li><p>SAP suggests that I should not be testing the &#34;state build up procedure&#34;, I should assume that the state is what I expect from the build up code and then test the one state change I&#39;m trying to test</p></li><li><p>PMP suggests that I can&#39;t skip this &#34;state build up&#34; step and just test the methods that govern that functionality independently.</p></li></ul><p>The result in my actual code has been tests that are bloated, complicated, long, and difficult to write. And if the state transitions change, the tests have to be changed&#8230; which would be fine with small, efficient tests but extremely time consuming and confusing with these long bloated tests. How is this normally done?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h3>Perspective:</h3><p>So let&#39;s take a step back and ask what TDD is trying to help us with.  TDD is trying to help us determine if our code is correct or not.  And by correct, I mean &#34;does the code meet the business requirements?&#34;  The selling point is that we know changes will be required in the future, and we want to make sure that our code remains correct after we make those changes.</p><p>I bring that perspective up because I think it&#39;s easy to get lost in the details and lose sight of what we&#39;re trying to achieve.</p><h3>Principles - SAP:</h3><p>While I&#39;m not an expert in TDD, I think you&#39;re missing part of what Single Assertion Principle (SAP) is trying to teach.  SAP can be restated as &#34;test one thing at a time.&#34;  But TOTAT doesn&#39;t roll off the tongue as easily as SAP does.</p><p>Testing one thing at a time means that you focus on one case; one path; one boundary condition; one error case; one <em>whatever</em> per test.  And the driving idea behind that is you need to know what broke when the test case fails, so you can resolve the issue more quickly.  If you test multiple conditions (ie. more than one thing) within a test and the test fails, then you have a lot more work on your hands.  You first have to identify which of the multiple cases failed and then figure out why <em>that</em> case failed.</p><p>If you test one thing at a time, your search scope is a lot smaller and the defect is identified more quickly.  Keep in mind that &#34;test one thing at a time&#34; doesn&#39;t necessarily exclude you from looking at more than one process output at a time.  For example, when testing a &#34;known good path&#34;, I may expect to see a specific, resulting value in <code>foo</code> as well as another value in <code>bar</code> and I may verify that <code>foo != bar</code> as part of my test.  The key is to logically group the output checks based upon the case being tested.</p><h3>Principles - PMP:</h3><p>Likewise, I think you&#39;re missing a bit about what Private Method Principle (PMP) has to teach us.  PMP encourages us to treat the system like a black box.  For a given input, you should get a given output.  You don&#39;t care how the black box generates the output.  You only care that your outputs align with your inputs.</p><p>PMP is really good perspective for looking at the API aspects of your code.  It can also help you scope what you have to test.  Identify your interface points and verify that they meet the terms of their contracts.  You don&#39;t need to care about how the behind-the-interface (aka private) methods do their job.  You just need to verify they did what they were supposed to do.</p><hr/><h3>Applied TDD (<em>for you</em>)</h3><p>So your situation presents a bit of a wrinkle beyond an ordinary application.  Your app&#39;s methods are stateful, so their output is contingent upon not only the input but also what&#39;s been previously done.  I&#39;m sure I should <code>&lt;insert some lecture&gt;</code> here about state being horrible and blah blah blah, but that really doesn&#39;t help solve your problem.</p><p>I&#39;m going to assume you have some sort of state diagram table that shows the various potential states and what needs to be done in order to trigger a transition.  If you don&#39;t, you&#39;re going to need it as it will help express the business requirements for this system.</p><p><strong>The Tests:</strong> First, you&#39;re going to end up with a set of tests that enact state change.  Ideally, you&#39;ll have tests that exercise the full range of state changes that can occur but I can see a few scenarios where you may not need to go that full extent.</p><p>Next, you need to build tests to validate the data processing.  Some of those state tests will be reused when you create the data processing tests.  For example, suppose you have a method <code>Foo()</code> that has different outputs based upon an <code>Init</code> and <code>State1</code> states.  You&#39;ll want to use your <code>ChangeFooToState1</code> test as a setup step in order to test the output when &#34;<code>Foo()</code> is in <code>State1</code>&#34;.</p><p>There&#39;s some implications behind that approach that I want to mention. <em>Spoiler, this is where I&#39;ll infuriate the purists</em></p><p>First off, you have to accept that you using something as a test in one situation and a setup in another situation.  On the one hand, this seems to be a direct violation of SAP.  But if you logically frame <code>ChangeFooToState1</code> as having two purposes then you&#39;re still meeting the spirit of what SAP is teaching us.  When you need to make sure <code>Foo()</code> changes states, then you use <code>ChangeFooToState1</code> as a test.  And when need to validate &#34;<code>Foo()</code>&#39;s output when in <code>State1</code>&#34; then you&#39;re using <code>ChangeFooToState1</code> as a setup.</p><p>The second item is that from a practical point of view, you&#39;re not going to want fully randomized unit testing for your system.  You ought to run all of the state change tests prior to running the output validation tests.  SAP is kind of the guiding principle behind that ordering.  To state what should be obvious - you can&#39;t use something as setup if it fails as a test.</p><h3>Putting it together:</h3><p>Using your state diagram, you&#39;ll generate tests to cover the transitions.  Again, using your diagram, you generate tests to cover all of the input / output data processing cases driven by state.</p><p>If you follow that approach, the <code>bloated, complicated, long, and difficult to write</code> tests should get a little bit easier to manage.  In general, they should end up smaller and they should be more concise (ie less complicated).  You should notice that the tests are more decoupled or modular as well.</p><p>Now, I&#39;m not saying the process will be completely pain free because writing good tests does take some effort.  And some of them will still be difficult because you&#39;re mapping a second parameter (state) over quite a few of your cases.  And as an  aside, it should be a little more apparent why a stateless system is a easier to build tests for.  But if you adapt this approach for your application, you should find that you are able to prove your application is working correctly.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-cant-make-the-unit-test-fail-in-red-green-refactor-of-tdd/'>Unit-testing &#8211;  can&#8217;t make the unit test fail in &#8220;Red, Green, Refactor&#8221; of TDD</a></li><li class="list-group-item"><a href='../c-how-does-breaking-up-a-big-method-into-smaller-methods-improve-unit-testability-when-the-methods-are-all-private/'>C# &#8211; How does breaking up a big method into smaller methods improve unit testability when the methods are all private</a></li><li class="list-group-item"><a href='../unit-testing-should-every-method-return-a-value-for-unit-testing/'>Unit-testing &#8211; Should every method return a value for Unit Testing</a></li><li class="list-group-item"><a href='../unit-testing-struggling-with-cyclical-dependencies-in-unit-tests/'>Unit-testing &#8211; Struggling with cyclical dependencies in unit tests</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>