<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>What are the consequences of immutable classes with references to mutable classes &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1075179 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1075179" class="post-1075179 software type-software status-publish hentry category-software tag-concurrency tag-immutability"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">What are the consequences of immutable classes with references to mutable classes</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">concurrency</span><span class="mr-2 badge badge-info">immutability</span></p><div class="entry-content"><p>I&#39;ve recently begun adopting the best practice of designing my classes to be immutable per Effective Java [Bloch2008].  I have a series of interrelated questions about degrees of mutability and their consequences.</p><p>I have run into situations where a (Java) class I implemented is only &#34;internally immutable&#34; because it is immutable except that it uses (immutable) references to other mutable classes.  To clarify, if the object were constructed with its references set to immutable classes, the class would be immutable.</p><ol><li><p>Do any of the benefits (see below) of immutable classes hold true even by only &#34;internally immutable&#34; classes?</p></li><li><p>Is there an accepted term for the<br /> aforementioned &#34;internal mutability&#34;?<br /> Wikipedia&#39;s <a href="http://en.wikipedia.org/wiki/Immutable_object#Java" rel="nofollow">immutable object<br /> page</a> uses the unsourced term<br /> &#34;deep immutability&#34; to describe an<br /> object whose references are also<br /> immutable.</p></li><li><p>Is the distinction between mutability and<br /> side-effect-ness/state important?</p></li></ol><hr/><p>The &#34;Java Practices&#34; site lists the following <a href="http://www.javapractices.com/topic/TopicAction.do?Id=29" rel="nofollow">benefits of immutable classes</a>:</p><ul><li><p>are simple to construct, test, and<br /> use</p></li><li><p>are automatically thread-safe and<br /> have no synchronization issues</p></li><li><p>do not need a copy constructor</p></li><li><p>do not need an implementation of<br /> clone</p></li><li><p>allow hashCode to use lazy<br /> initialization, and to cache its<br /> return value</p></li><li><p>do not need to be copied defensively<br /> when used as a field</p></li><li><p>make good Map keys and Set elements<br /> (these objects must not change state<br /> while in the collection)</p></li><li><p>have their class invariant<br /> established once upon construction,<br /> and it never needs to be checked<br /> again</p></li><li><p>always have &#34;failure atomicity&#34; (a<br /> term used by Joshua Bloch) : if an<br /> immutable object throws an exception,<br /> it&#39;s never left in an undesirable or<br /> indeterminate state</p></li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>A <code>Class</code> isn&#39;t truly <strong>immutable</strong> if any of this children references aren&#39;t <strong>immutable</strong> as well.
If your root <code>Class</code> has <code>final</code> references to all its instance variables and all those instance variables are <strong>immutable</strong> as well as all their children following this same <strong>restriction</strong> then you can say the root <code>Class</code> is <strong>immutable</strong>.</p><p>If any of the children references are non-<code>final</code> or any of the children instances are <strong>mutable</strong> then the containing <code>Class</code> is <strong>not immutable</strong>.</p><p>It doesn&#39;t matter about the <em>internal immutablity</em> whatever that means is anyone&#39;s guess, all that matters is that the public contract to the class <strong>immutability</strong> is kept. You can&#39;t have partial immutability anymore than you can be partially dead. Your class is either <strong>immutable</strong> or it isn&#39;t. And it isn&#39;t if any of its referred to classes or their classes, etc. are <strong>mutable</strong>.</p><p>If you have a graph and any of the members of the graph are <strong>mutable</strong> you can&#39;t deterministically say that you have an <strong>immutable</strong> state. Concurrency guarantees go out the window, <code>.equals()</code> and <code>.hashCode()</code> become non-deterministic and simple to test cloning and serializing go out the window as well.</p><p><strong>If anything breaks this immutability contract you lose all the benefits of trying to maintain this immutability contract.</strong></p><p>Simpler concurrency issues is a main motivational force of immutability.</p><p>Having side effect free code helps with predictability and maintainability. Since you don&#39;t have to wonder where things are getting mutated in the call tree because you know they can&#39;t be mutated.</p><p>Performance is another less important factor, in Java the JVM can make some highly optimized decisions about caching and other factors if it knows data can&#39;t change state. It does provide important hints to the compiler at compile time and the JIT algorithms at runtime.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-do-not-declare-interfaces-for-immutable-objects/'>C# &#8211; Do not declare interfaces for immutable objects</a></li><li class="list-group-item"><a href='../c-what-are-the-drawbacks-of-immutable-types/'>C# &#8211; What are the drawbacks of immutable types</a></li><li class="list-group-item"><a href='../java-understanding-the-difference-between-mutable-and-immutable-classes/'>Java &#8211; Understanding the difference between mutable and immutable classes</a></li><li class="list-group-item"><a href='../object-oriented-can-we-really-use-immutability-in-oop-without-losing-all-key-oop-features/'>Object-oriented &#8211; Can we really use immutability in OOP without losing all key OOP features</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>