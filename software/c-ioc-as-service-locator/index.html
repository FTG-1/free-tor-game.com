<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; IoC as service locator &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086011 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086011" class="post-1086011 software type-software status-publish hentry category-software tag-c tag-dependency-injection tag-design-patterns tag-factory tag-service-locator"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; IoC as service locator</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">dependency-injection</span><span class="mr-2 badge badge-warning">design-patterns</span><span class="mr-2 badge badge-primary">factory</span><span class="mr-2 badge badge-danger">service-locator</span></p><div class="entry-content"><p>I have been wondering for quite some time on some issues while using dependency injection:</p><p>In a layered application, I normally inject repositories into the application service using constructor injection:</p><pre><code>public class SomeService
{
    private IRepositoryA _repoA;
    private IRepositoryB _repoB;
    private IRepositoryC _repoC;

    public SomeService(IRepositoryA repositoryA, 
                       IRepositoryB repositoryB, 
                       IRepositoryC repositoryC
                       /* Other dependencies*/)
    {
        _repoA = repositoryA;
        _repoB = repositoryB;
        _repoC = repositoryC;
    }

    public void SomeMethod1()
    {
        //Do something with repo A and B
    }

    public void SomeMethod2()
    {
        //Do something with repo C
    }

    //Other methods
}
</code></pre><p>The problems with this are:</p><ul><li><p>When the service becomes complicated, the number of dependencies will grow more and more, and soon the constructor will become ugly with lots of parameters. It might be the service is doing too many things (violate SRP) and better be separated into several classes, but I think this situation is not uncommon so I&#39;m curious how others solve this</p></li><li><p>SomeMethod1() only uses repo A and B, but when client calls it, the service is created with all repositories, meaning it has more dependencies than it needs.</p></li></ul><p>To address those 2 issues, I see some people have another abstraction, which is repository factory</p><pre><code>public interface IRepositoryFactory
{
    T GetRepository&lt;T&gt;() where T : IRepository;
}

public class RepositoryFactory
{
    public T GetRepository&lt;T&gt;()
    {
        //Use IoC to return correct IRepository
    }
}
</code></pre><p>and inject factory into service class:</p><pre><code>public class SomeService
{
    private IRepositoryFactory _factory;
    public SomeService(IRepositoryFactory factory)
    {
        _factory = factory;
    }

    public void SomeMethod1()
    {
        IRepositoryA repoA = _factory.GetRepository&lt;IRepositoryA&gt;();
        IRepositoryB repoB = _factory.GetRepository&lt;IRepositoryB&gt;();
        //Use repo A and B
    }

    public void SomeMethod2()
    {
        IRepositoryC repoC = _factory.GetRepository&lt;IRepositoryC&gt;();
        //Use repo C
    }

    //Other methods
}
</code></pre><p>This does solve the 2 problems above, but there are a few other issues:</p><ul><li>RepositoryFactory is using IoC as a service locator, which is considered as anti-pattern by many people</li><li>RepositoryFactory has a dependency on IoC framework now, which might be undesirable in dependency injection (because as I understand, the application should have as little understanding about the IoC as they can, except for composition root, which is at the top of the application)</li></ul><p>So is this a good approach to use?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Good Question!</p><blockquote><p>When the service becomes complicated, the number of dependencies will grow more and more</p></blockquote><p>In that case your dependencies are maybe not standalone dependencies but can be grouped into simple dependency-holding classes that can be used to pass into the constructor.</p><p>A good sign would be if more than one of your classes use both <code>IRepositoryA</code> an <code>IRepositoryB</code> in the constructor and also in some of their methods like in your <code>SomeMethod1</code> method.
You should be able to find a good name for the class that groups <code>IRepositoryA</code> and <code>IRepositoryB</code>. If not, consider going to tell us the real example so we can analyse better.</p><blockquote><p>SomeMethod1() only uses repo A and B, but when client calls it, the service is created with all repositories, meaning it has more dependencies than it needs.</p></blockquote><p>But that is okay because normally you want to make sure that at the time when the class is created you don&#39;t want the IRepositories to be changed anymore. They should be declared as immutable. That is a good practice.</p><p>If that&#39;s not the case and they shall be mutable, then you could make the <code>IRepositoryC</code> dependency beeing passed into <code>SomeMethod2</code> as parameter. Currying / partial applying can help you to prevent code-duplication here when you call the method many times with the same <code>IRepositoryC</code> argument.</p><p>A different approach would be passing option-types into the constructor. Your class would then however have the responsibility to check in their methods if a given <code>IRepository</code> has already been provided or is still empty at the time of the method call.</p><p>So it depends a little on what you really want to do. There is imho no general answer to this problem.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../ioc-containers-and-service-locator-pattern/'>IoC containers and service locator pattern</a></li><li class="list-group-item"><a href='../c-how-to-deal-with-dependency-when-you-have-separate-projects/'>C# &#8211; How to deal with dependency when you have separate projects</a></li><li class="list-group-item"><a href='../c-only-use-a-dependency-injection-container-at-the-root-of-an-application/'>C# &#8211; Only use a dependency injection container at the root of an application</a></li><li class="list-group-item"><a href='../c-service-locator-anti-pattern-alternative/'>C# &#8211; Service-locator anti-pattern alternative</a></li><li class="list-group-item"><a href='../c-ambient-dependency-injection-through-static-service-locator/'>C# &#8211; Ambient dependency injection through static service locator</a></li><li class="list-group-item"><a href='../dependencyinjection-constructor-over-injection-smell-vs-service-locator-where-is-the-proper-approach/'>DependencyInjection &#8211; Constructor over-injection smell vs service locator &#8211; where is the proper approach</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>