<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How is stack and heap are assigned to each processes &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067723 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067723" class="post-1067723 software type-software status-publish hentry category-software tag-heap tag-memory tag-operating-systems tag-recursion tag-stack"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How is stack and heap are assigned to each processes</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">heap</span><span class="mr-2 badge badge-info">memory</span><span class="mr-2 badge badge-warning">operating systems</span><span class="mr-2 badge badge-primary">recursion</span><span class="mr-2 badge badge-danger">stack</span></p><div class="entry-content"><p>How multiples processes are stored in the main memory , i understand every process will be divided into the equal size pages and will be stored in the frames of main memory. if whole main memory is divided into the pages then how are stack area, heap area, code section given to the process?</p><p>my understanding is there is common stack area and heap area.</p><p>next question is :- when a method executes it is allocated in the stack area and a activation record is pushed into the stack.</p><p>I am also considering here contex switching.<br /> eg:</p><pre><code>---------------
| process: p1 |
---------------
fun(int a)
{
if (a=0)
return 0;

fun(a--);
}

main()
{
 fun(5);
}

---------------
| process: p2 |
---------------

NoFun(int a)
{
if (a=0);
return 0;

NoFun(a--);
}
main()
{
 fun(3)
}
</code></pre><p>now processes p1 and p2 will be loaded into the main memory , now assume p1 started its execution so its first method main will be called and its activation records will be pushed into the stack now main calls  fun() method and it started executing and after sometime this process gets preempted and context switch takes place (stack pointer of p1 will save the address of p1.fun(3) ) . so calls will look something like this.:-</p><p>p1.main()  -&gt;  p1.fun(5)  -&gt;  p1.fun(4) -&gt;  p1.fun(3)</p><p>so main is in the bottom of stack and fun(3) is in the top of the stack , now p2 gets chance for the execution so, main method of process p2 will get executed and will be pushed on the top of the stack i.e on the top of activation record of fun(3). so now it will look like this</p><p>p1.main()  -&gt;  p1.fun(5)  -&gt;  p1.fun(4) -&gt;  p1.fun(3)  -&gt;  p2.main()</p><p>its time for p2 to get preempted, P1 again gets CPU and starts execution now p1 resumes back its context and go to the address of stack pointer and starts execution of remaining code.</p><p>so after execution of p1 , stack will look like this:-</p><p>p1.main()  -&gt;  p1.fun(5)  -&gt;  p1.fun(4) -&gt;  p1.fun(3)  -&gt;  p2.main() -&gt;p1.fun(2) -&gt;fun(1)-&gt; fun(0)</p><p>now p1 will start popping records:-</p><p>p1.fun(0) is popped out .<br /> p1.main()  -&gt;  p1.fun(5)  -&gt;  p1.fun(4) -&gt;  p1.fun(3)  -&gt;  p2.main() -&gt;p1.fun(2) -&gt;fun(1)</p><hr/><p>p1.fun(1) is popped out .<br /> p1.main()  -&gt;  p1.fun(5)  -&gt;  p1.fun(4) -&gt;  p1.fun(3)  -&gt;  p2.main() -&gt;p1.fun(2)</p><hr/><p>p1.fun(2) is popped out .<br /> p1.main()  -&gt;  p1.fun(5)  -&gt;  p1.fun(4) -&gt;  p1.fun(3)  -&gt;  p2.main()</p><p>now p1 is in the CPU and it wont be able to execute it beacause stack top is of process 2.</p><p>I know my understanding is wrong, please correct me and give some refrences.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>What you&#39;re fundamentally missing is that P1 and P2 each get their own stack. So the resulting pictures are much cleaner than you are imagining.</p><p>You have two stacks, one for P1 and one for P2.  They are completely separated.  All activation frames for P1 go on P1&#39;s stack, and all activation frames for P2 go on P2&#39;s stack.  They operate completely independently, and on a multi-cpu processor, can even operate concurrently.</p><p>A single processor (whether on a multi-cpu processor or not) can alternate between P1 and P2.  When a processor stops running P1 and starts running P2, this one form of the <a href="https://en.wikipedia.org/wiki/Context_switch" rel="nofollow">context switch</a>.  The state of P1 is saved, and the state P2 is loaded.  This save/restore operation will effectively switch stacks by updating the CPU registers that refer to the stack.</p><p>Other terms you might want to differentiate:</p><p>A <a href="https://en.wikipedia.org/wiki/Process_(computing)" rel="nofollow">process</a> usually reflects an <a href="https://en.wikipedia.org/wiki/Address_space" rel="nofollow">address space</a>.  An address space is like memory as an array.  It gets more complicated than this because of memory that is shared between processes (each other) and the kernel, and various protection mechanisms; however, conceptually, you can think of an address space as a big array of bytes starting at index 0.  Each process is given its own address space, which allows each process to have its own stack and heap independent of the other processes, without worry of conflicting indexes (i.e. of conflicting addresses).</p><p>Now, a single process can also run multiple <a href="https://en.wikipedia.org/wiki/Thread_(computing)" rel="nofollow">threads</a>.  Your thought exercise involving P1 and P2 could be also be replicated using T1 and T2, two threads in one process.  With multiple threads in one process, the threads are all sharing the same address space, though T1 and T2 <em>still each have their own stack</em>.  T1, the process&#39;s first thread, will start at <code>main</code>, but T2 will start wherever directed to do so (by T1 firing up a new thread, T2, so T2 is unlikely to start at <code>main</code>).  Otherwise the scenarios are very similar between P1, P2 and T1, T2.</p><p>Note that a context switch between P1 and P2 involves also changing the address space (more cpu registers that here refer to the address space), whereas between T1 and T2 only the stack state needs to be switched and not the address space.  T1 and T2 will also share a common heap (though may each be directed toward different areas of that heap for their allocations) whereas P1 and P2 will have independent heaps (though they still may establish some shared memory).</p><p>Address spaces are supported by cpu hardware feature called <a href="https://en.wikipedia.org/wiki/Virtual_memory" rel="nofollow">virtual memory</a>. This enables separate address spaces, and protects one process from potentially erratic behaviors of another, in that one process is prevented from touching the memory of another (modulo debuggers, etc..).</p><p>You might also find interesting: <a href="http://duartes.org/gustavo/blog/post/anatomy-of-a-program-in-memory/" rel="nofollow">http://duartes.org/gustavo/blog/post/anatomy-of-a-program-in-memory/</a></p><p>Fundamentally, the cpu has registers that refer to the context of its current execution state.  These registers in some way define, among other things:</p><ul><li>the address space (out of which the stack(s) and heap are allocated)</li><li>the stack (and thus the existing activation frames, and where new ones go)</li><li>the instruction pointer, which identifies the current instruction stream</li></ul><p>A context switch saves and restores these things.  By saving the current context, that thread (of a process) context is suspended for later resumption.  By restoring some other context, that other thread (of a process) is resumed.</p><p>Note that not all of the context needs to be saved every time, for example, the address space is probably already saved for the process, so it just needs to be reloaded on resumption instead of both save and reloaded.  However, the stack and instruction pointer move during execution, of course, so these do need to be saved so they can be restored later.</p><p>When multiple CPUs are present and concurrently executing, they each have their own full notion of context, of referring to address space, activation stack and instruction stream using their own registers.</p><p>It is then up to the operating system and managing run-times to properly allocate new stack within a process when a new thread is requested, or to allocate a new address space when a new process is requested.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-stack-and-heap-memory-in-java/'>Java &#8211; Stack and Heap memory in Java</a></li><li class="list-group-item"><a href='../c-understanding-stack-frame-of-function-call-in-c-c/'>C++ &#8211; Understanding stack frame of function call in C/C++</a></li><li class="list-group-item"><a href='../how-are-the-size-of-the-stack-and-heap-limited-by-the-os/'>How are the size of the stack and heap limited by the OS</a></li><li class="list-group-item"><a href='../instance-methods-stack-or-heap/'>Instance methods, stack or heap</a></li><li class="list-group-item"><a href='../c-memory-segmentation-stack-heap-etc/'>C++ &#8211; Memory segmentation &#8211; stack, heap, etc.</a></li><li class="list-group-item"><a href='../does-each-process-have-its-own-section-of-data-text-stack-and-heap-in-the-memory/'>Does each process have it&#8217;s own section of data, text , stack and heap in the memory</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>