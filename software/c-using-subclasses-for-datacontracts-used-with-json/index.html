<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Using subclasses for DataContracts used with JSON &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070255 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070255" class="post-1070255 software type-software status-publish hentry category-software tag-c tag-json"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Using subclasses for DataContracts used with JSON</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">json</span></p><div class="entry-content"><p>I have a RESTful call that can modify the state of an instance. My problem is that the JSON  is different based on the type of action the user is taking, it could be a <code>SetProperty</code> action or a <code>SetState</code> action (among others).</p><p>For example, a <code>POST /api/sample/</code> _would send the following JSON</p><pre><code>{ 
  instanceId: 12312,      
  actionId: 12345, // Maps to a SetState action
  desiredState: &#39;CURATION&#39;
}
</code></pre><p>But when calling the same URL for a <em>SetProperty</em>, the JSON would look like</p><pre><code>{ 
  instanceId: 12312,      
  actionId: 25354, // Maps to a SetProperty action
  propName: &#34;PropA&#34;,
  propValue: &#34;user-input&#34; 
}
</code></pre><p>I use the following data contract</p><pre><code>[DataContract]
class PostInstanceRequest {
    [DataMember]
    int instanceId;
    [DataMember]
    int actionId;
    [DataMember]
    string desiredState;  // Only used for SetState
    [DataMember]
    string propName;   // Only used for SetProperty
    [DataMember]
    string propValue;  // Only used for SetProperty
    // Many more action specific properties here...
}
</code></pre><p>I don&#39;t really like this because it feels like I should have a base class for the common properties, and then I should define more base classes with the specific properties.</p><ul><li><code>SetStatePostInstanceRequest</code>, that adds <code>desiredState</code></li><li><code>SetPropertyPostInstanceRequest</code>, that adds <code>propName</code> and <code>propValue</code></li></ul><p>However, if I do that, I don&#39;t know what class to deserialize it into. I would have to first deserialize as a <code>PostInstanceRequest</code>, check the <code>actionId</code> property, and then deserialize it to the correct subclass.</p><p>A possible compromise is to use composition</p><pre><code>[DataContract]
class SetStateAction {
    [DataMember]
    string desiredState;
}

[DataContract]
class SetPropAction {
    [DataMember]
    string propName;
    [DataMember]
    string propValue;
}

[DataContract]
class PostInstanceRequest {
    [DataMember]
    int instanceId;
    [DataMember]
    int actionId;
    [DataMember]
    SetPropAction setPropParams;
    [DataMember]
    SetStateAction setActionParams;
    // More references to action specific classes down here
}
</code></pre><p>Which of the options is going to cause me less trouble? Or is there an even better way that I didn&#39;t think of?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Did you author the service which you are posting to? If so, I would recommend changing it, so that you post SetState data to something like <code>/api/sample/State</code>, and post SetProperty data to <code>/api/sample/Property</code>. Then you would have separate controller actions for each service method, with each receiving only the desired parameters. If the service isn&#39;t yours and you can&#39;t modify it however, then obviously you&#39;re a bit stuffed. Otherwise, read this: <a href="http://www.asp.net/web-api/overview/web-api-routing-and-actions/routing-and-action-selection" rel="nofollow">http://www.asp.net/web-api/overview/web-api-routing-and-actions/routing-and-action-selection</a></p><p><strong>Update</strong></p><p>If you definitely want to retain a single action, at the same address, there is something you can do. You can define your controller action to take an interface / base class-typed parameter, and have the json deserializer use type information which you provide in your json to determine which class to rehydrate with your data, for example:</p><pre class="lang-cs prettyprint-override"><code>public abstract class ThingBase
{
    public int instanceId { get ; set; }
    public int actionId { get; set; }
}

public class SetStateThing : ThingBase
{
    public string desiredState { get; set; }
}

public class SetPropertyThing : ThingBase
{
    public string propName { get; set; }
    public string propValue { get; set; }
}

public class MyController
{
    public HttpResponseMessage Post([FromBody]ThingBase thing)
    {
        //use thing
    }
}
</code></pre><p>Your json would become, for example:</p><pre><code>{
$type: &#34;MyAssembly.SetStateThing, MyAssembly&#34;,
instanceId: 12312,      
actionId: 12345, // Maps to a SetState action
desiredState: &#34;CURATION&#34;
}

{
$type: &#34;MyAssembly.SetPropertyThing, MyAssembly&#34;,
instanceId: 12312,      
actionId: 25354, // Maps to a SetProperty action
propName: &#34;PropA&#34;,
propValue: &#34;user-input&#34; 
}
</code></pre><p>The trick is to set up the serializer settings correctly (in your <code>WebApiConfig.cs</code> <code>Register(HttpConfiguration config)</code> method for example):</p><p><code>config.Formatters.JsonFormatter.SerializerSettings.TypeNameHandling = TypeNameHandling.Objects;</code></p><p>I used this with an interface, but an abstract base class seems a better fit for your scenario.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-get-around-the-circular-reference-issue-with-json-and-entity/'>How to get around the Circular Reference issue with JSON and Entity</a></li><li class="list-group-item"><a href='../c-suggest-structure-for-classes-that-maps-to-json-with-dynamic-data-without-using-dynamic-or-object-reference/'>C# &#8211; suggest structure for classes that maps to json with dynamic data without using dynamic or object reference</a></li><li class="list-group-item"><a href='../c-implementing-a-generic-dynamic-custom-property-system-in-c/'>C# &#8211; Implementing a generic/dynamic custom property system in C#</a></li><li class="list-group-item"><a href='../json-without-quotes-for-keys/'>JSON without quotes for keys</a></li><li class="list-group-item"><a href='../c-is-creating-viewmodels-in-web-api-a-bad-practice/'>C# &#8211; Is creating ViewModels in Web API a bad practice</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>