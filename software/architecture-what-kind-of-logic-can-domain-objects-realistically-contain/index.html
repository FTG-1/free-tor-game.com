<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; What kind of logic can Domain Objects realistically contain &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087952 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087952" class="post-1087952 software type-software status-publish hentry category-software tag-architecture tag-design-patterns tag-domain-driven-design tag-domain-model tag-repository"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; What kind of logic can Domain Objects realistically contain</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">domain-driven-design</span><span class="mr-2 badge badge-primary">domain-model</span><span class="mr-2 badge badge-danger">repository</span></p><div class="entry-content"><p>I have been struggling with this concept in the context of web applications ever since I first read about it. The theory states that the domain objects should encapsulate their behaviour and business logic. A model which contains only data and has its logic somewhere outside is called an &#34;anemic domain model&#34;, which is a bad thing. Also, the domain should not perform data access.</p><p>If for instance I had a social app which had a bunch of objects of type <em>User</em>, and users should be able to add other users as their friends, the User class should contain a method named <em>Befriend(User user)</em> so that I could do something like <strong>userA.Befriend(userB)</strong>.</p><pre><code>class User {

    Friends[] friends;

    void Befriend(User user) { ... }
}
</code></pre><p>However, the act of befriending might contain some restrictions and so I would have to do some validation in my Befriend method. Here are some purely theoretical restrictions:</p><ol><li>The user must not already be your friend</li><li>You and the other user must not have common friends</li><li>In Bucharest it must be raining</li></ol><p>Now let&#39;s imagine that the friends lists might be huge, <em>userA</em> might have 50.000 friends, <em>userB</em> might have 100.000 friends.<br /> So, for validating 1 and 2 it wouldn&#39;t be efficient to eagerly pull the entire friends lists from the database when constructing the user object and then doing those checks in my <em>Befriend</em> method iterating the <em>friends</em> list. In the database I have indexes and checks like these would be trivial (and fast). So naturally I would prefer to put these queries somewhere in my Data Access Layer and use them whenever needed.</p><pre><code>class FriendsRepository: IFriendsRepository {

    bool HasFriend(User user, User friend);
    bool HasCommonFriends(User userA, User userB);

}
</code></pre><p>But how am I supposed to use this object inside my <em>Befriend</em> method from my <em>User</em> object? People say domain objects must not use repositories (even through abstractions such as interfaces), though there seems to be some disagreement here. Say I violated this rule. Domain objects don&#39;t benefit from Dependency Injection so I would have to change my <em>Befriend</em> method to:</p><pre><code>void Befriend(User user, IFriendsRepository friendsRepository) { ... }
</code></pre><p>Alright. Now what about the weather? That&#39;s something completely unrelated to our entity and that information comes from an IWeatherService. Again, I need it in my Befriend method.</p><pre><code>void Befriend(User user, IFriendsRepository friendsRepository, IWeatherService weatherService) { ... }
</code></pre><p>This already makes me feel like this method does not belong inside the User class. I have a lot of external dependencies and I don&#39;t get Dependency Injection which sucks. But pulling this out from the <em>User</em> to a service (or whatever) inside my Application Layer makes my domain model anemic. I very rarely encountered methods which could either be executed without validation or contain only extremely simple validation rules, only depending on the immediately available properties on the said entity (like primitive fields for instance, such as Username string, ActiveUntil date etc.).</p><p>So I&#39;m left asking: what kind of methods could naturally fit in the domain objects? Let&#39;s be honest, real apps often deal with huge amounts of data, many object relations and very complex validation logic. Rarely you only have to do trivial checks like &#34;is this user over 12 years old?&#34;.</p><p>P.S.: I used that example purely for demonstration purposes. Please don&#39;t cling on it.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Arguably, the smallest method of encapsulation is a <em>function.</em></p><pre><code>float harmonic(int n) 
{ 
    float h = 1.0; 

    for (int i = 2; i &lt;= n; i++) { 
        h += 1.0 / i; 
    } 

    return h; 
}
</code></pre><p>This function contains both code and data.  When the function completes, it returns the data that it contains.</p><p>Classes encapsulate code and data in a similar manner.  The only real difference is that you can have multiple functions (called &#34;methods&#34; in a class) operating on the same data, and multiple instances of that data.</p><p>Consider this partial code listing of a Complex Number class, obtained from <a href="https://introcs.cs.princeton.edu/java/97data/Complex.java.html" rel="noreferrer">here</a>:</p><pre><code>public class Complex {
    private final double re;   // the real part
    private final double im;   // the imaginary part

    // create a new object with the given real and imaginary parts
    public Complex(double real, double imag) {
        re = real;
        im = imag;
    }

    // return a new Complex object whose value is (this + b)
    public Complex plus(Complex b) {
        Complex a = this;             // invoking object
        double real = a.re + b.re;
        double imag = a.im + b.im;
        return new Complex(real, imag);
    }

    // return a new Complex object whose value is (this * b)
    public Complex times(Complex b) {
        Complex a = this;
        double real = a.re * b.re - a.im * b.im;
        double imag = a.re * b.im + a.im * b.re;
        return new Complex(real, imag);
    }
}
</code></pre><p>Both of these examples of encapsulation are, shall we say, &#34;self-contained.&#34;  They don&#39;t rely on any external dependencies to function.</p><p>The problem of encapsulating code and data gets a bit more thorny when you start designing business applications.  The reason this is true is because <strong>business applications concern themselves  primarily with <em>collections of entities and the relationships between those entities.</em></strong> While there can and are operations that can be performed atomically on individual entities, this is rare.  It is more common to perform operations that affect the relationships between entities or the state or number of entities within a collection.  Consequently, most of the business logic is more likely to be found in <em>object aggregates.</em></p><p>To illustrate, consider an ordinary business like Amazon.  There&#39;s no particular reason to pick Amazon, other than it is unremarkably similar to other businesses in many ways: it has customers, inventory, orders, invoices, payments, credits: the usual suspects.</p><p>What can you encapsulate within a Customer entity that can be atomically executed, divorced from other entities?  Well, maybe you can change their last name.  That&#39;s a data change in the database that can happen automatically in a repository somewhere, using an anemic data model.  Perhaps you can change their password hash.  That requires some logic, but it&#39;s unlikely to live in the Customer entity.  It&#39;s more likely to exist in some security module.</p><p><strong>All of the interesting business logic lives outside of the fundamental entities.</strong> Consider an Invoice, which is not an individual entity, but rather an aggregate of several entities.   What can you do inside an Invoice class, divorced from the rest of the system?  Well, you can change the shipping address.  That&#39;s simply a change to a foreign key in the Invoice entity.  You can calculate a Total (the sum of the line item quantities and costs), and finally we get to some non-trivial logic that can be encapsulated in the entity itself.  Maybe the line items have a line-item total property on them, so there&#39;s a bit of logic there.</p><p>But what if you want to calculate a balance?  Now you have to go somewhere else besides the Invoice to make that calculation, because the Invoice doesn&#39;t know anything about all of the other invoices (by design).  That could happen in the Customer entity, but it&#39;s just as likely to occur in some Accounting module elsewhere.</p><p>And then you have linking entities, entities whose sole purpose is to provide connections between entities at the data level.  There&#39;s generally no logic in those whatsoever.</p><p>So at the bottom of your data hierarchy are simple data transfer objects.  When combined into aggregate objects, they become useful from a logic standpoint, and any or all of them are subject to processing by any number of software modules, treated as simply data.  When you think about it, it doesn&#39;t really make much sense to bake a lot of business logic into something like a Customer object, because now you&#39;re tightly binding that object to your specific way of doing business.</p><p>Should classes encapsulate data and logic?  Of course, when it is appropriate and useful to do so. <strong>The core idea in software design is suitability.</strong> There are no absolute principles; software design techniques must always be evaluated in the context of your specific system to determine if they are appropriate for your specific functional and non-functional requirements.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../with-all-of-these-services-how-can-i-not-be-anemic/'>With all of these services, how can I not be anemic</a></li><li class="list-group-item"><a href='../c-the-purpose-of-domain-business-logic-in-classes-when-having-repositories/'>C# &#8211;  the purpose of domain/business logic in classes when having repositories</a></li><li class="list-group-item"><a href='../architecture-domain-model-design-best-practices-for-robust-fluency-encapsulation-and-extensibility/'>Architecture &#8211; Domain Model Design &#8211; Best Practices for Robust Fluency, Encapsulation, and Extensibility</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>