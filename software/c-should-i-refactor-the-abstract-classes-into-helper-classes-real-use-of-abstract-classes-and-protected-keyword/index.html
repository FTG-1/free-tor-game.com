<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Should I refactor the abstract classes into Helper classes? Real use of abstract classes and protected keyword &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081295 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081295" class="post-1081295 software type-software status-publish hentry category-software tag-abstract-class tag-c"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Should I refactor the abstract classes into Helper classes? Real use of abstract classes and protected keyword</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">abstract class</span><span class="mr-2 badge badge-info">c</span></p><div class="entry-content"><p>A lot of my code seems to be going through the following evolution &#8211;</p><p><strong>Iteration 1</strong></p><pre><code>interface IAccountManager {
    void Import(string importData);
}
class SalesAccountManager : IAccountManager {
    private int GetAccountId(string data) { 
        //Some data conversions, database references, calculations etc
        return accountId;
    }
    private int GetAccountName(string data) { 
        //Some data conversions, database references, calculations etc
        return name;
    }
    public void Import(string importData) {
        SalesAccount a = new SalesAccount();
        a.Id = GetAccountId(importData.Substring(11, 55); //hardcoding just to keep this example simple
        a.Name = GetAccountName(importData);
        a.Save();
    }
}
</code></pre><p>It all works well, everyone is happy but then I find I need to add a <code>BusinessAccountManager</code>. Upon further inspection, it seems that the <code>GetAccountId</code> and <code>GetAccountName</code> methods are not going to change. So, what seems like a natural solution? We just make an Abstract base class that inherits from <code>IAccountManager</code> and make those methods protected and make <code>Import</code> abstract. Now, we have &#8211;</p><p><strong>Iteration 2</strong></p><pre><code>abstract class AbstractAccountManage : IAccountManager {
    protected int GetAccountId(string data) {...No change here...}
    protected int GetAccountName(string data) {...No change here...}
    public abstract void Import(string importData);
}

class SalesAccountManager : AbstractAccountManager {
    public void Import(string importData) {...No change here...}
}
class BusinessAccountManager : AbstractAccountManager {
    public void Import(string importData) {
        BusinessAccount a = new BusinessAccount();
        a.Id = GetAccountId(importData.Substring(11, 55); //hardcoding just to keep this example simple
        a.Name = GetAccountName(importData);
        a.Save();
    }
}
</code></pre><p>But it seems this abstract class is basically a helper class, so I could&#39;ve done the following &#8211;</p><p><strong>Iteration 3</strong></p><pre><code>interface IAccountManagerStrategy {
    public int GetAccountId(string data);
    public int GetAccountName(string data);
}
class AccountManagerStrategy : IAccountManagerStrategy {
    public int GetAccountId(string data) {...No change here...}
    public int GetAccountName(string data) {...No change here...}
}
interface IAccountManager {
    void Import(string importData);
}

class SalesAccountManager : IAccountManager {
    private IAccountManagerStrategy accountManagerStrategy {get;}
    public SalesAccountManager(IAccountManagerStrategy accountManagerStrategy) {
        this.accountManagerStrategy = accountManagerStrategy;
    }
    public void Import(string importData) {
        SalesAccount a = new SalesAccount();
        a.Id = accountManagerStrategy.GetAccountId(importData.Substring(11, 55); //hardcoding just to keep this example simple
        a.Name = accountManagerStrategy.GetAccountName(importData);
        a.Save();
    }
}

class BusinessAccountManager : AbstractAccountManager {
    //Similar to above but for a BusinessAccount        
}
</code></pre><p>Note: The implementation of <code>GetAccountId</code> and <code>GetAccountName</code> methods is not very likely to change (but one never knows).</p><p>With the above background &#8211;</p><p><strong>Questions</strong></p><ol><li><p>From a software architecture perspective, is it a good approach to refactor such abstract classes that act as repositories of shared private methods (similar to above) into helper classes (or strategy pattern, if we want to call it that) as seen in Iteration 3? This question is not for this specific case but in general.</p></li><li><p>If it is a good approach to do that refactoring, then what is the <em>real</em> use of abstract classes and the <code>protected</code> keyword as far as software design/architecture is concerned?</p></li><li><p>Would an abstract class like <code>AbstractAccountManager</code> above be violating SRP after the methods were changed from private to protected (I suppose it can be argued that its no longer doing only one thing, but difficult to say when to stop identifying what a single responsibility should be)?</p></li></ol><p>Note: This question is not about composition vs polymorphism. It is about understand the correct usage of <code>abstract</code> and understanding why or why not refactor concrete methods of an abstract class into helper/utility classes.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>From a software architecture perspective, is it a good approach to refactor such abstract classes that act as repositories of shared private methods (similar to above) into helper classes (or strategy pattern, if we want to call it that) as seen in Iteration 3? This question is not for this specific case but in general.</p></blockquote><p>In general this is a reasonably good idea. Both helper classes and an abstract base class take the burden of knowing how to implement a certain bundle of functionality from a class, and hence allow us to consolidate shared functionality. The advantage of a helper class is that it allows us to change that functionality more dynamically and independently, we can replace the helper with a mock/stub during testing, inject different implementations of the helper and change two different dependents on the helper independently without changing their interfaces.</p><p>An abstract class has the advantage of convenience: it requires fewer keypresses to delegate functionality to a base class than a helper class. This is not a significant benefit. And when the abstract base class is just providing some private methods, its main advantages -- essentially serving as a template or transformation from interface to interface -- are not leveraged. So I think overall this is a solid idea.</p><blockquote><p>If it is a good approach to do that refactoring, then what is the real use of abstract classes and the <code>protected</code> keyword as far as software design/architecture is concerned?</p></blockquote><p>There are frequently cases where some functionality can be defined as a wrapper around some smaller set of functionality. There are a few subcases of this:</p><ol><li><p>Checks around unsafe operations. Suppose I have a stack that should throw a <code>IllegalOperationException</code> when it is empty and pop is called. I can use an abstract class to abstract away these safety checks -- thus ensuring that child classes cannot forget to implement them. This can look like</p><pre><code>public abstract class SafeStack&lt;T&gt; {
    protected abstract T UnsafePop();
    protected abstract int Size { get; }

    public T Pop() {
        if (this.Size &lt;= 0) {
            throw new IllegalOperationException(&#34;Cannot pop an empty stack.&#34;);
        }
        return this.UnsafePop();
    }
}
</code></pre></li><li><p>&#34;Template classes&#34;. Sometimes you get into cases where you have a number of classes that implement some common functionality by the same recipe. So I might have</p><pre><code>public class ExcelReportGenerator {
    private void SaveToExcelFile(Summary summary){}

    public void SaveReport(ReportData data) {
        CleanReportData cleaned = data.Clean();
        Summary summary = cleaned.Summary();
        SaveToExcelFile(summary);
    }
}

public class HtmlReportGenerator {
    private void SaveToHtmlFile(Summary summary){}

    public void SaveReport(ReportData data) {
        CleanReportData cleaned = data.Clean();
        Summary summary = cleaned.Summary();
        SaveToHtmlFile(summary);
    }
}
</code></pre><p>You can remove the duplication by making an abstract <code>ReportGenerator</code> with a <code>protected abstract</code> <code>SaveToFile(Summary)</code> method.</p></li><li><p>Lots of delegation. Suppose you have classes implementing some <code>ComplicatedMethod(ComplicatedParameters parameters)</code> where the parameters have many optional parameters / reasonable defaults. If you want to define methods that delegate to the <code>ComplicatedMethod(ComplicatedParameters)</code> with various defaults set, an abstract base class with <code>abstract ComplicatedMethod(ComplicatedParameters)</code> with the delegating methods defined there is a reasonably nice way to accomplish this.</p></li></ol><p>Now, you do not have to use abstract classes for any of these. You can always simulate an abstract class by defining an interface for the child class and taking that interface as a constructor parameter. And over the last decade or so mainstream languages have defined other nice ways for accomplishing the same thing, such as generic classes, extension methods or interface defaults.</p><p>I think there are still cases where you&#39;re trying to accomplish some mix of the above three where the niceties of using an abstract base class can overpower the downsides of inheritance to make it worthwhile.</p><blockquote><p>Would an abstract class like AbstractAccountManager above be violating SRP after the methods were changed from private to protected (I suppose it can be argued that its no longer doing only one thing, but difficult to say when to stop identifying what a single responsibility should be)?</p></blockquote><p>This is an interesting thought, and maybe? As you note, &#34;responsibility&#34; is a hard thing to really pin down, but in general going from <code>private</code> to <code>protected</code> is adding to your interface. A non-sealed class has three interfaces: the one it shows to the world (<code>public</code>) the one it shows to its its children (<code>public</code> and <code>protected</code>) and the one it shows to its overriders (<code>virtual</code>). If you think of responsibility as being tied to a class&#39;s interface, which is about right, then adding a protected member is growing the responsibility.</p><hr/><p>Bonus, unasked question. It looks to me like your example is crying out for a generic implementation. Something like</p><pre><code>class AccountManager&lt;TAccount&gt; : IAccountManager where T : IAccount, new() {
    private int GetAccountId(string data) { 
        //Some data conversions, database references, calculations etc
        return accountId;
    }
    private int GetAccountName(string data) { 
        //Some data conversions, database references, calculations etc
        return name;
    }
    public void Import(string importData) {
        TAccount a = new TAccount();
        a.Id = GetAccountId(importData.Substring(11, 55); //hardcoding just to keep this example simple
        a.Name = GetAccountName(importData);
        a.Save();
    }
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-class-architecture-for-rest-services/'>C# class architecture for REST services</a></li><li class="list-group-item"><a href='../c-should-all-public-methods-in-an-abstract-class-be-marked-virtual/'>C# &#8211; Should all public methods in an abstract class be marked virtual</a></li><li class="list-group-item"><a href='../c-single-responsibility-principle-how-to-avoid-code-fragmentation/'>C# &#8211; Single Responsibility Principle &#8211; How to Avoid Code Fragmentation</a></li><li class="list-group-item"><a href='../what-are-the-differences-between-abstract-classes-interfaces-and-when-to-use-them/'>What are the differences between abstract classes, interfaces, and when to use them</a></li><li class="list-group-item"><a href='../c-force-derived-class-to-implement-static-method-c/'>C# &#8211; Force Derived Class to Implement Static Method C#</a></li><li class="list-group-item"><a href='../c-properly-designing-an-abstract-class-how-to-retrieve-data/'>C# &#8211; Properly designing an abstract class: How to retrieve data</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>