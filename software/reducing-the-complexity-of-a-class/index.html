<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Reducing the complexity of a class &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1077076 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1077076" class="post-1077076 software type-software status-publish hentry category-software tag-complexity tag-design-patterns tag-refactoring"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Reducing the complexity of a class</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">complexity</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">refactoring</span></p><div class="entry-content"><p>I have looked at some <a href="https://softwareengineering.stackexchange.com/questions/274567/reducing-the-complexity-of-over-designed-code">answers</a> and searched on Google, but I could not find anything helpful (i.e., that wouldn&#39;t have awkward side effects).</p><p>My problem, in abstract, is that I have an object and need to perform a <em>long</em> sequence of operations on it; I think of it as a sort of assembly line, like building a car.</p><p>I believe these objects would be called <a href="https://softwareengineering.stackexchange.com/questions/258188/what-are-classes-that-produce-a-result-but-are-necessarily-classes-because-of-t">Method Objects</a>.</p><p>So in this example at some point I would have a CarWithoutUpholstery on which I would then need to run installBackSeat, installFrontSeat, installWoodenInserts (the operations do not interfere with one another, and might even be done in parallel). These operations are performed by CarWithoutUpholstery.worker() and yield a new object which would be a CarWithUpholstery, on which I would then run maybe cleanInsides(), verifyNoUpholsteryDefects(), and so on.</p><p>The operations in a single phase are already independent, i.e., I am already grappling with a subset of them that may be executed in any order (front and rear seats may be installed in any order).</p><p>My logic currently uses Reflection for simplicity of implementation.</p><p>That is, once I have a CarWithoutUpholstery, the object inspects itself for methods called performSomething(). At that point it executes all these methods:</p><pre><code>myObject.perform001SomeOperation();
myObject.perform002SomeOtherOperation();
...
</code></pre><p>while checking errors and stuff. While order of operation <em>is</em> unimportant, I have assigned a lexicographic order in case I ever discover some order is important after all. <sup><sub>This contradicts <a href="https://it.wikipedia.org/wiki/You_aren't_gonna_need_it" rel="nofollow noreferrer">YAGNI</a>, but it costed very little &#8211; a simple sort() &#8211; and it could save a massive method renaming (or introducing some other method of performing tests, e.g. an array of methods) down the line.</sub></sup></p><h1>A different example</h1><p>Let us say that instead of building a car I have to compile a Secret Police report on somebody, and submit it to my <a href="http://www.eviloverlord.com/lists/overlord.html" rel="nofollow noreferrer">Evil Overlord</a>. My final object will be a ReadyReport. To construct it I start by gathering basic information (name, surname, spouse&#8230;). This is my Phase A. Depending on whether there is a spouse or not, I may then have to proceed to phases B1 or B2, and gather sexuality data on one or two people. This is made of several different queries to different Evil Minions controlling night life, street cams, sex shop sales receipts and what not. And so on and so forth.</p><p>If the victim has no family, I will not even enter the GetInformationAboutFamily phase, but if I do, then it&#39;s irrelevant whether I first target the father or the mother or the siblings (if any). But I cannot do that if I haven&#39;t performed a FamilyStatusCheck, which therefore belongs to an earlier phase.</p><h1>It all works wonderfully&#8230;</h1><ul><li>if I need some additional operation I only need to add a private method,</li><li>if the operation is common to several phases I can have it inherited from a superclass,</li><li>operations are simple and self-contained. No value from one operation is ever required by any of the others (operations that <em>do</em> are performed in a different phase),</li><li>objects down the line do not need to perform many tests since they could not even <em>exist</em> if their creator objects hadn&#39;t verified those conditions in the first place. I.e., when placing inserts in the dashboard, cleaning the dashboard and verifying the dashboard, I needn&#39;t verify that a dashboard is actually <em>there</em>.</li><li>it allows for easy testing. I can easily mock a partial object and run any method on it, and all operations are deterministic black boxes.</li></ul><h1>&#8230;but&#8230;</h1><p>The problem arose when I added <em>one last operation</em> in one of my method objects, which caused the overall module to exceed a mandatory complexity index (&#34;less than N private methods&#34;).</p><p>I have already taken the matter upstairs and suggested that in this case, the wealth of private methods is not a telltale of disaster. The complexity <strong>is</strong> there, but it&#39;s there because the operation <em>is</em> complex, and actually it&#39;s not all that complex &#8211; it&#39;s just <em>long</em>.</p><p>Using the Evil Overlord example, my problem is that the Evil Overlord (aka <em>He Who Shall Not Be Denied</em>) having requested <strong>all</strong> dietary information, my Dietary Minions telling me that I need to query restaurants, kitchenettes, street vendors, unlicensed street vendors, greenhouse owners etc., and the Evil (sub)Overlord &#8211; familiarly known as <em>He Who Also Shall Not Be Denied</em> &#8211; complaining that I&#39;m performing too many queries in the GetDietaryInformation phase.</p><p><strong>Note</strong>: I am aware that from several points of view this is not a problem at all (ignoring possible performance issues etc.). All that&#39;s happening is that a specific metric is unhappy, and there is justification for that.</p><h1>What <em>I think</em> I could do</h1><p>Apart from the first, all these options are doable and, I think, defensible.</p><ul><li>I have verified that I can be sneaky and declare half my methods <code>protected</code>. But I&#39;d be exploiting a weakness in the testing procedure, and apart from justifying myself when caught, I don&#39;t like this. Also, it&#39;s a stopgap measure. What if the number of required operations doubles? Unlikely, but what then?</li><li>I can split arbitrarily this phase into AnnealedObjectAlpha, AnnealedObjectBravo and AnnealedObjectCharlie, and have one third the operations being performed at each stage. I am under the impression that this actually <em>adds</em> complexity (N-1 more classes), with no benefit except for passing a test. I can of course hold that a CarWithFrontSeatsInstalled and a CarWithAllSeatsInstalled are <em>logically successive</em> stages. The risk of a Bravo method being later required by Alpha is small, and even smaller if I play it well. But still.</li><li>I can bunch different operations, remotely similar, in a single one. <code>performAllSeatsInstallation()</code>. This is only a stopgap measure and it does increase the complexity of the single operation. If I ever need to do operations A and B in a different order, and I have packed them inside E = (A+C) and F (B+D), I&#39;ll have to unbundle E and F and shuffle the code around.</li><li>I can use an array of lambda functions and neatly sidestep the check altogether, but I find that clunky. This is however the best alternative so far. It would get rid of reflection. The two problems I have is that I would probably be asked to rewrite <em>all</em> method objects, not only the hypothetic <code>CarWithEngineInstalled</code>, and while that would be very good job security, it really doesn&#39;t appeal all that much; and that the code coverage checker has <em>issues</em> with lambdas (which are solvable, but <em>still</em>).</li></ul><h1>So&#8230;</h1><ul><li>Which, you think, is my best option?</li><li>Is there a better way I haven&#39;t considered? (<sup><sub>perhaps I&#39;d better come clean and ask directly <em>what is it?</em></sub></sup>)</li><li>Is this design hopelessly flawed, and I&#39;d better admit defeat and ditch &#8211; this architecture altogether? <sup><sub>Not good for my career, but would writing ill-designed code be any better in the long term?</sub></sup></li><li>Is my current choice actually the One True Way, and I need to fight to get better quality metrics (and/or instrumentation) installed? For this last option I&#39;d need references&#8230; I can&#39;t just wave my hand at the @PHB while murmuring <em>These aren&#39;t the metrics you&#39;re looking for</em>. <sup><sub>No matter how much I&#39;d like to be able to</sub></sup></li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The long sequence of operations seems like it should be its own class, which then needs additional objects to perform its duties. It sounds like you are close to this solution. This long procedure can be broken down into multiple steps or phases. Each step or phase could be its own class that exposes a public method. You would want each phase to implement the same interface. Then your assembly line keeps track of a list of phases.</p><p>To build on your car assembly example, imagine the <code>Car</code> class:</p><pre class="lang-cs prettyprint-override"><code>public class Car
{
    public IChassis Chassis { get; private set; }
    public Dashboard { get; private set; }
    public IList&lt;Seat&gt; Seats { get; private set; }

    public Car()
    {
        Seats = new List&lt;Seat&gt;();
    }

    public void AddChassis(IChassis chassis)
    {
        Chassis = chassis;
    }

    public void AddDashboard(Dashboard dashboard)
    {
        Dashboard = dashboard;
    }
}
</code></pre><p>I&#39;m going to leave out the implementations of some of the components, like <code>IChassis</code>, <code>Seat</code> and <code>Dashboard</code> for the sake of brevity.</p><p>The <code>Car</code> is not responsible for building itself. The assembly line is, so let&#39;s encapsulate that in a class:</p><pre class="lang-cs prettyprint-override"><code>public class CarAssembler
{
    protected List&lt;IAssemblyPhase&gt; Phases { get; private set; }

    public CarAssembler()
    {
        Phases = new List&lt;IAssemblyPhase&gt;()
        {
            new ChassisAssemblyPhase(),
            new DashboardAssemblyPhase(),
            new SeatAssemblyPhase()
        };
    }

    public void Assemble(Car car)
    {
        foreach (IAssemblyPhase phase in Phases)
        {
            phase.Assemble(car);
        }
    }
}
</code></pre><p>The important distinction here is that the CarAssembler has a list of assembly phase objects that implement <code>IAssemblyPhase</code>. You now are dealing explicitly with public methods, meaning each phase can be tested by itself, and your code quality tool is happier because you aren&#39;t stuffing so much into one single class. The assembly process is dead simple too. Just loop over the phases and call <code>Assemble</code> passing in the car. Done. The <code>IAssemblyPhase</code> interface is also dead simple with just a single public method that takes a Car object:</p><pre class="lang-cs prettyprint-override"><code>public interface IAssemblyPhase
{
    void Assemble(Car car);
}
</code></pre><p>Now we need our concrete classes implementing this interface for each specific phase:</p><pre class="lang-cs prettyprint-override"><code>public class ChassisAssemblyPhase : IAssemblyPhase
{
    public void Assemble(Car car)
    {
        car.AddChassis(new UnibodyChassis());
    }
}

public class DashboardAssemblyPhase : IAssemblyPhase
{
    public void Assemble(Car car)
    {
        Dashboard dashboard = new Dashboard();

        dashboard.AddComponent(new Speedometer());
        dashboard.AddComponent(new FuelGuage());
        dashboard.Trim = DashboardTrimType.Aluminum;

        car.AddDashboard(dashboard);
    }
}

public class SeatAssemblyPhase : IAssemblyPhase
{
    public void Assemble(Car car)
    {
        car.Seats.Add(new Seat());
        car.Seats.Add(new Seat());
        car.Seats.Add(new Seat());
        car.Seats.Add(new Seat());
    }
}
</code></pre><p>Each phase individually can be pretty simple. Some are just one liners. Some might be just blinding adding four seats, and another has to configure the dashboard before adding it to the car. The complexity of this long drawn out process is split into multiple, reusable classes that are easily testable.</p><p>Even though you said the order doesn&#39;t matter right now, it might in the future.</p><p>To finish this off, let&#39;s look at the process for assembling a car:</p><pre class="lang-cs prettyprint-override"><code>Car car = new Car();
CarAssembler assemblyLine = new CarAssembler();

assemblyLine.Assemble(car);
</code></pre><p>You can sub class CarAssembler to assemble a specific kind of car, or truck. Each phase is one unit within a larger whole, making it easier to reuse code.</p><hr/><blockquote><p>Is this design hopelessly flawed, and I&#39;d better admit defeat and ditch - this architecture altogether? Not good for my career, but would writing ill-designed code be any better in the long term?</p></blockquote><p>If deciding what I wrote needs to be rewritten was a black mark on my career, then I would be working as a ditch digger right now, and you shouldn&#39;t take any of my advice. :)</p><p>Software engineering is an eternal process of learning, applying, and then re-learning. Just because you decide to rewrite your code doesn&#39;t mean you&#39;re going to get fired. If that were the case, there would be no software engineers.</p><blockquote><p>Is my current choice actually the One True Way, and I need to fight to get better quality metrics (and/or instrumentation) installed?</p></blockquote><p>What you have outlined is not the One True Way, however bear in mind that code metrics are <em>also</em> not the One True Way. Code metrics should be viewed as warnings. They can point to maintenance problems in the future. They are guidelines, not laws. When your code metrics tool points something out, I would first investigate the code to see if it properly implements the <a href="https://scotch.io/bar-talk/s-o-l-i-d-the-first-five-principles-of-object-oriented-design">SOLID</a> principals. Many times refactoring code to make it more SOLID will satisfy the code metrics tools. Sometimes it doesn&#39;t. You have to take these metrics on a case by case basis.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-using-visitor-pattern-with-large-object-hierarchy/'>C# &#8211; Using visitor pattern with large object hierarchy</a></li><li class="list-group-item"><a href='../how-to-avoid-duplication-of-code-related-to-shared-entities-in-the-repository-pattern/'>How to avoid duplication of code related to shared entities in the repository pattern</a></li><li class="list-group-item"><a href='../java-design-a-queuing-solution-with-clustering-and-multiple-consumers/'>Java &#8211; Design a Queuing Solution with Clustering and Multiple Consumers</a></li><li class="list-group-item"><a href='../c-refactoring-long-methods-with-a-lot-of-cyclomatic-complexity/'>C# &#8211; Refactoring long methods with a lot of cyclomatic complexity</a></li><li class="list-group-item"><a href='../object-oriented-avoiding-instanceof-vs-abstract-god-class-do-i-have-an-alternative/'>Object-oriented &#8211; Avoiding instanceof vs abstract God Class. Do I have an alternative</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>