<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python &#8211; How should I unit test an impure function that calls a series of methods &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085565 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085565" class="post-1085565 software type-software status-publish hentry category-software tag-python tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python &#8211; How should I unit test an impure function that calls a series of methods</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">python</span><span class="mr-2 badge badge-info">unit testing</span></p><div class="entry-content"><p>I wish to test the following method:</p><pre><code>class MyClass(object):
    ...
    def my_method(self, args):
        ...  # Code which transforms args into arg1, arg2, ..., argN
        self.A.other_method1(arg1, arg2)
        self.A.other_method2(arg1, arg2, arg3)
        self.A.other_method3(arg1)
        self.B.other_method4(arg1, arg2)
        self.B.other_method5(arg1, arg2, arg4)
        self.B.other_method6(arg1, arg2, arg5, arg6)
</code></pre><p>Obviously this is an artificial example. I have created this example to focus on what I believe are the essential points:</p><ul><li><code>my_method</code> first does some straightforward work to transform the values it is given. I am not concerned with how to test this aspect.</li><li><code>my_method</code> then calls a sequence of methods on other attributes <code>A</code> and <code>B</code> of the class. I am not concerned with how to test those other methods.</li><li>The sequence of method calls mutates <code>A</code> and <code>B</code>. So <code>my_method</code> is very much a non-pure function. I don&#39;t believe I can redesign to make the function pure, as the other methods all do I/O.</li></ul><p>My current approach is to mock out <code>A</code> and <code>B</code> using <code>unittest.mock.MagicMock</code>, and then assert that these methods were called in the required order, with the expected arguments. My test code therefore looks like this:</p><pre><code>from unittest.mock import MagicMock, call

class MyTest(unittest.TestCase):
    def test_MyClass_my_method(self):
        x = MyClass()  # Instantiation details omitted
        x.A = MagicMock()
        x.B = MagicMock()
        x.my_method(0)
        result_A = x.A.method_calls
        result_B = x.B.method_calls
        expected_result_A = [call.other_method1(1, 2),
                             call.other_method2(1, 2, 3),
                             call.other_method2(1)]
        expected_result_B = [call.other_method4(1, 2),
                             call.other_method5(1, 2, 4),
                             call.other_method6(1, 2, 5, 6)]

        self.assertEquals(result_A, expected_result_A)
        self.assertEquals(result_B, expected_result_B)
</code></pre><p>This works. But I can&#39;t help feel I have simply rewritten <code>my_method</code> &#8211; and, worse, tightly coupled the test to the inner working of the method.</p><p>Is there a better way to test this method? Is the method actually poorly designed?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>This indeed seems to be an improvable design. Here are a few things that I&#39;d consider looking at:</p><ul><li><p>You said you cannot make it pure due to I/O. But separating the calculation of what is to be output and the actual output allows you to keep most of it pure.</p></li><li><p>The test doesn&#39;t make any sense. It does not verify anything useful, but as you mentioned, it only tightly couples to the inner working. Again, this begs the question on what it is the whole method should verifiably do?</p></li><li><p>Output testing seems to be missing somewhere around here. You may have tested these <code>other_method</code>s and what they output, but testing a method call order is still different from testing the actual output resulting from them. You hope that the composition of these works correctly, but that&#39;s really what higher-order integration tests are for. Given an integration test that verifies the whole output created by <code>my_method</code> there seems to be little benefit left for the test in question.</p></li><li><p>Finally, <code>A</code> and <code>B</code> might be worth to look at as well. Given that the method call order is so important, I would consider looking at these methods and question if there is an actual temporal coupling between them. If that&#39;s the case, a redesign of <code>A</code> and/or <code>B</code> seems to be a good idea as well.</p></li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-unit-testing-methods-that-call-suppliers-webservices/'>Unit-testing &#8211; Unit testing methods that call suppliers webservices</a></li><li class="list-group-item"><a href='../c-best-way-to-unit-test-methods-that-call-other-methods-inside-same-class/'>C# &#8211; Best way to unit test methods that call other methods inside same class</a></li><li class="list-group-item"><a href='../unit-testing-how-to-unit-test-a-class-which-is-just-an-adapter-that-logs-input-and-output-to-a-third-party-library/'>Unit-testing &#8211; How to unit test a class which is just an adapter that logs input and output to a third-party library</a></li><li class="list-group-item"><a href='../unit-testing-how-to-unit-test-logic-in-crud-app/'>Unit-testing &#8211; How to unit test logic in crud app</a></li><li class="list-group-item"><a href='../java-should-i-unit-test-the-subclasses-or-the-abstract-parent-class/'>Java &#8211; Should I unit test the subclasses or the abstract parent class</a></li><li class="list-group-item"><a href='../unit-testing-should-you-indirectly-test-private-methods-from-within-public-method-tests/'>Unit-testing &#8211; Should you indirectly test private methods from within public method tests</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>