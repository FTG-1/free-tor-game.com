<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; How to improve a pattern &#8216;enum class with methods&#8217; &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070850 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070850" class="post-1070850 software type-software status-publish hentry category-software tag-c tag-code-smell tag-design-patterns tag-enum"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; How to improve a pattern &#8216;enum class with methods&#8217;</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">code smell</span><span class="mr-2 badge badge-warning">design-patterns</span><span class="mr-2 badge badge-primary">enum</span></p><div class="entry-content"><p>Over many years, I always find myself reconsidering this design, so I wanted to get some feedback on my solution to it.</p><h3><strong>Problem:</strong></h3><p>I need a limited amount of <strong>objects = instances</strong> from a class, and I don&#39;t want to expose the option to create more. I also want easy access to them from everywhere, and operators like equal / not equal.<br /> They need to be class instances, as they need to have methods, so a <strong>enum</strong> doesn&#39;t work.</p><h3><strong>(Simplified) Example:</strong></h3><p>Consider for example any chess-like game.</p><ol><li>There are three tile colors for the board needed, Lighter and Darker, and a different size tile where taken pieces are put. Also,</li><li>the pieces have a color, typically White or Black; and I use NoColor for empty fields.</li></ol><p>Both examples, each instance should know how to draw and serialize itself.</p><h3><strong>Obvious Option:</strong></h3><p>If I make a simple enum, the values cannot carry methods, so I end up with Draw and Serialize methods in some other class, which are basically an ugly switch/case.</p><h3><strong>My Solution:</strong></h3><p>I like to</p><ol><li>protect the constructor, and,</li><li>create (public) static instances inside the class (C++17 now allows that even directly with <code>inline</code>).</li></ol><p>&#39;Each instance gets created with a <strong>const &#39;type&#39;</strong> in it (basically a <strong>enum</strong>), set through the constructor.<br /> Wherever I need the information, I use the <strong>const pointer</strong> to that <strong>static instance</strong>. This allows to easily <strong>_compare</strong> and <strong>assign</strong> them, and also allows calling their <strong>member functions</strong> as needed.<br /> It even allows other games to derive from the class and add new static instances, for example, a three-player chess could add a Red instance inside a derived class. Because I hand around pointers to the base class everywhere, it is polymorphic, and the code doesn&#39;t have to handle the new color special in any way&#8230;</p><pre><code>class Color
{
protected:
  Color(char c) : color{c} {}
public:
  void Serialize(Archive&amp; ar) const { ar &lt;&lt; color; }

private:
  const char color;

public:  // the only instances ever to exists; handed around by pointer
  inline const static Color NoColor{&#39;X&#39;};   // C++17 syntax, otherwise
  inline const static Color White{&#39;W&#39;};     // separate line in .cpp needed
  inline const static Color Black{&#39;B&#39;};
};

class Chess3Color : public Color
{
protected:
  Chess3Color(char c) : Color{c} {}

public:
  inline const static Chess3Color Red{&#39;R&#39;};
};
</code></pre><p>Example Usage:</p><pre><code>...
// create a White King
Piece* p = new WhiteKing{&amp;Type::King, &amp;Color::White, IDB_W_K_BMP};
...
if (p-&gt;IsColor(&amp;Color::White)) { ... }
...
p-&gt;Serialize(ar);
...
class Piece
{
  ...
  // Piece member function for serialization
  void Serialize(Archive&amp; ar)
  {
    type-&gt;Serialize(ar);
    color-&gt;Serialize(ar);
  }
  ...
  // check if this piece is of a certain color
  // note that pointer compare is good enough!
  bool IsColor(const Color* c) { return color == c; }
  ...
}
</code></pre><h3><strong>Question:</strong></h3><p>I go back and forth in my mind between this being a code smell or a pretty good and clean solution. So is it a code smell?<br /> <em><strong>How else would this be better designed?</strong></em></p><p>I have read a lot about Singletons, and I don&#39;t think they would do me any good (aside from the fact that some people think they are a code smell too).</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>I need a limited amount of objects = instances from a class, and I don&#39;t want to expose the option to create more. I also want easy access to them from everywhere</p></blockquote><p>That is an unnecessary constraint that seems motivated by apriori notions of how you can design and implement a game of chess -- be it a two player chess game or a three player chess game.</p><p>What are the main objects (not the objective of the game) in a game of chess?</p><ol><li>A game -- the main object. Everything in the game stems from this object.</li><li>Two (or three) players.</li><li>A board.</li><li>Chesss pieces.</li></ol><p>Every object has state. Every object has behavior associated with it. In addition the rules of the game dictate how they can interact with one another and how the states of the objects change.</p><p>There is nothing to be gained by saying:</p><ol><li><p>One may not create more than two (or three) players. That&#39;s up to the game object. If a game chooses to create two players or ten players does not impact the state of a player or its behavior.</p></li><li><p>One may not create more than one board. Once again, let the game object decide how many boards it wants to create.</p></li><li><p>One may not create more than 32 pieces. Once again, that&#39;s up to the game object. One can easily create variations of the main game of chess by using  different board sizes and different number of pieces.</p></li></ol><p>The variations of chess are interesting. See <a href="https://en.wikipedia.org/wiki/List_of_chess_variants" rel="nofollow noreferrer">https://en.wikipedia.org/wiki/List_of_chess_variants</a>. There is no reason to constrain your classes the way you want to.</p><blockquote><p>Both examples, each instance should know how to draw and serialize itself.</p></blockquote><p>That&#39;s not a good design, IMHO.</p><p>The board and the pieces can be drawn in many different ways. Take a look at the <a href="https://www.google.com/search?q=chess+king&amp;rlz=1C1GCEA_enUS816US816&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=0ahUKEwin7qDP7v7iAhXRB80KHW4FBFsQ_AUIECgB&amp;biw=1536&amp;bih=722" rel="nofollow noreferrer">images of king</a> that one can find on the net. The board and the pieces can be drawn using many different methods.</p><p>A game, and its constituent objects, can be serialized in different way too.</p><p>It will be better to use <a href="https://en.wikipedia.org/wiki/Strategy_pattern" rel="nofollow noreferrer">The Strategy Pattern</a> for both of those operations.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-manager-container-class-vs-static-class-methods/'>C# &#8211; Manager/Container class vs static class methods</a></li><li class="list-group-item"><a href='../python-whats-the-best-way-to-create-a-static-utility-class-in-python-is-using-metaclasses-code-smell/'>Python &#8211; What&#8217;s the best way to create a static utility class in python? Is using metaclasses code smell</a></li><li class="list-group-item"><a href='../c-is-using-protected-inheritance-to-hide-but-exploit-implemented-interface-from-the-public-ok/'>C++ &#8211; Is using protected inheritance to hide (but exploit) implemented interface from the public ok</a></li><li class="list-group-item"><a href='../php-design-pattern-a-single-class-with-multiple-purposes-or-multiple-extended-classes-each-with-their-own-purpose-in-php/'>Php &#8211; Design Pattern: A single class with multiple purposes, or multiple extended classes each with their own purpose in PHP</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>