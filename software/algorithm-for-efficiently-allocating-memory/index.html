<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Algorithm for efficiently allocating memory &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086976 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086976" class="post-1086976 software type-software status-publish hentry category-software tag-malloc tag-memory"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Algorithm for efficiently allocating memory</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">malloc</span><span class="mr-2 badge badge-info">memory</span></p><div class="entry-content"><p>Given the following constraints:</p><ol><li>No multithreading.</li><li>No care about hardware cache utilization.</li></ol><p>Wondering what a reasonably optimal memory allocation scheme would look like.</p><p>From my limited knowledge, one implementation is <a href="https://en.wikipedia.org/wiki/Free_list" rel="nofollow noreferrer">Free Lists</a>, but it says they have some issues. Then there is buddy management and dynamic allocation.</p><p>Overall, the procedure seems to be like:</p><ol><li>Allocate block<ol><li>Find available free space</li><li>If some exists, then use it.</li><li>Otherwise<ol><li>Calculate the changes you would have to make to the memory blocks to satisfy the request. This results in a set of movements of blocks to open up an appropriately sized gap to fulfill the request.</li><li>Given you know how to shuffle the blocks around, do that.</li><li>Then allocate the memory.</li><li>Potentially shift around some other blocks if you have time, to get rid of some of the fragmentation.</li></ol></li><li>Return</li></ol></li></ol><p>The middle part of that is where it starts to get difficult. There must be some <em>data structure</em> associated with the free/used blocks perhaps, to make it efficient to navigate around in them. Then wondering how much time can we spend looking for an ideal location. It&#39;s like you have to calculate and predict what the best case scenario is, but that would require computing a lot of stuff. Then there&#39;s the issue of doing sort of GC, and clean up the memory organization. All of this on top of balancing copying memory which is a small performance hit. Who would&#39;ve thought it is so complex.</p><p>To summarize, wondering what a standard memory allocation procedure looks like that is pretty optimal. I have seen the C implementations of malloc variations but it is hard to gather all of the pieces from how large and complex it is.</p><p>For reference, I am thinking along the lines of how if a memory was organized like this:</p><pre><code>type 1
type 2
type 3
</code></pre><p>If they are packed together then if <code>type 1</code> needs more space, wondering does it append to the end:</p><pre><code>[empty]
type 2
type 3
type 1
</code></pre><p>Or if it would give more space by shifting:</p><pre><code>type 1
[empty]
type 2
type 3
</code></pre><p>But then it starts to get complicated. You might mitigate this <em>a little bit</em> by preallocating slightly more space than necessary, but eventually it will outgrow its location, so then how to balance it out. That&#39;s where I get confused. I&#39;m coming from JavaScript land.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Let&#39;s imagine for a moment all of your <code>Item</code>s have the same size.
A simple scheme would then be to have a pool of items, plus a bit for each one to mark whether it is allocated or not.
Then the algorithm is simply &#34;loop through the pool until you find an empty <code>Item</code>&#34;.</p><p>This is a bitmap allocation scheme.</p><p>A faster variation of this scheme is to have the free <code>Item</code>s form a linked list.
Then to allocate you remove a block from the free list (and you could even use the space for the pointer as data, since it isn&#39;t used when the block is allocated). To free you add it back to the linked list.</p><p>This is the free lists approach you mentioned.</p><p>Expanding that to variable-sized allocation, you have the entire memory area you&#39;re working with be a single &#34;Item&#34;. When you need a smaller-sized space, you split it in half and run the algorithm recursively. When you have a fitting size, mark it as &#34;allocated&#34; and return it. To free, mark it as &#34;unallocated&#34; and merge the areas back as needed.</p><p>This is the buddy allocation scheme.</p><p>Most allocation algorithms don&#39;t do compaction, i.e. moving memory blocks around to make more space. They avoid fragmentation instead. And when their pool is full, they ask the system for more memory (the system normally allocates memory in whole pages (normally 4KB each), so they have to be subdivided).</p><p>Also, normally garbage collection is performed at a higher level (see <a href="http://journal.stuffwithstuff.com/2013/12/08/babys-first-garbage-collector" rel="nofollow noreferrer">munificent&#39;s garbage collector &#34;tutorial&#34;</a> for more details).</p><p>A good representative of a &#34;common&#34; allocation scheme is <a href="http://g.oswego.edu/dl/html/malloc.html" rel="nofollow noreferrer">Doug Lea&#39;s <code>malloc</code></a>. It is used by glibc and in several other places. It includes a little overview of the algorithm in its page.</p><p>The thing is that you need the right allocation scheme for the problem at hand. For example, Doug Lea&#39;s <code>malloc</code> is tailored and optimized to be reasonably fast, compact and safe (it can detect some usage errors), but if all you&#39;re doing is fixed block allocation, a linked list approach is probably going to be much more performant.</p><p>The <a href="https://en.wikipedia.org/wiki/Memory_management" rel="nofollow noreferrer">wikipedia page on memory management</a> has an overview of a few allocation schemes, but if you want all the details I really recommend Knuth&#39;s The Art of Computer Programming, which has a whole section of the second chapter (vol. 1) dedicated to this problem (considering the sheer size of the book, this really means something).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/c-confused-about-virtual-memory-for-all-processes/'>C++ &#8211; Confused About Virtual Memory for All Processes</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-increase-the-size-of-a-memory-mapped-file/'>C++ &#8211; Increase the size of a memory mapped file</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/java-memory-management-thunks-lazyness/'>Java memory management (thunks/lazyness)</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>