<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to get around the Circular Reference issue with JSON and Entity &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1063556 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1063556" class="post-1063556 software type-software status-publish hentry category-software tag-asp-net-mvc tag-entity-framework tag-json tag-orm"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to get around the Circular Reference issue with JSON and Entity</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-mvc</span><span class="mr-2 badge badge-info">entity-framework</span><span class="mr-2 badge badge-warning">json</span><span class="mr-2 badge badge-primary">orm</span></p><div class="entry-content"><p>I have been experimenting with creating a website that leverages MVC with JSON for my presentation layer and Entity framework for data model/database. My Issue comes into play with serializing my Model objects into JSON.</p><p>I am using the code first method to create my database.  When doing the code first method a one to many relationship (parent/child) requires the child to have a reference back to the parent. (Example code my be a typo but you get the picture)</p><pre><code>class parent
{
   public List&lt;child&gt; Children{get;set;}
   public int Id{get;set;}

}
class child
{
    public int ParentId{get;set;}
    [ForeignKey(&#34;ParentId&#34;)]
    public parent MyParent{get;set;}
    public string name{get;set;}
 }
</code></pre><p>When returning a &#34;parent&#34; object via a JsonResult a circular reference error is thrown because &#34;child&#34; has a property of class parent.</p><p>I have tried the ScriptIgnore attribute but I lose the ability to look at the child objects. I will need to display information in a parent child view at some point.</p><p>I have tried to make base classes for both parent and child that do not have a circular reference. Unfortunately when I attempt to send the baseParent and baseChild these are read by the JSON Parser as their derived classes (I am pretty sure this concept is escaping me).</p><pre><code>Base.baseParent basep = (Base.baseParent)parent;
return Json(basep, JsonRequestBehavior.AllowGet);
</code></pre><p>The one solution I have come up with is to create &#34;View&#34; Models. I create simple versions of the database models that do not include the reference to the parent class. These view models each have method to return the Database Version and a constructor that takes the database model as a parameter (viewmodel.name = databasemodel.name).  This method seems forced although it works.</p><p>NOTE:I am posting here because I think this is more discussion worthy. I could leverage a different design pattern to over come this issue or it could be as simple as using a different attribute on my model.  In my searching I have not seen a good method to overcome this problem.</p><p>My end goal would be to have a nice MVC application that heavily leverages JSON for communicating with the server and displaying data.  While maintaining a consistant model across layers (or as best as I can come up with).</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I see two distinct subjects in your question:</p><ul><li>How to manage circular references when serializing to JSON?</li><li>How safe is it to use EF entities as model entities in you views?</li></ul><p>Concerning circular references I&#39;m sorry to say that there is no simple solution. First because JSON cannot be used to represent circular references, the following code:</p><pre><code>var aParent = {Children : []}, aChild  = {Parent : aParent};
aParent.Children.push(aChild);
JSON.stringify(aParent);
</code></pre><p>Results in: <code>TypeError: Converting circular structure to JSON</code></p><p>The only choice you have is to keep only the composite --&gt; component part of the composition and discard the &#34;back navigation&#34; component --&gt; composite, thus in you example:</p><pre><code>class parent
{
    public List&lt;child&gt; Children{get;set;}
    public int Id{get;set;}
}
class child
{
    public int ParentId{get;set;}
    [ForeignKey(&#34;ParentId&#34;), ScriptIgnore]
    public parent MyParent{get;set;}
    public string name{get;set;}
}
</code></pre><p>Nothing prevents you from recomposing this navigation property on your client side, here using jQuery:</p><pre><code>$.each(parent.Children, function(i, child) {
  child.Parent = parent;  
})
</code></pre><p>But then you will need to discard it again before sending it back to the server, for JSON.stringify won&#39;t be able to serialize the circular reference:</p><pre><code>$.each(parent.Children, function(i, child) {
  delete child.Parent;  
})
</code></pre><p>Now there is the issue of using EF entities as your view model entities.</p><p>First EF is likely to using Dynamic Proxies of your class to implement behaviors such as change detection or lazy loading, you have to disable those if you want to serialize the EF entities.</p><p>Moreover using EF entities in the UI can be at risk since all the default binder will mapping every field from the request to entities fields including those you did not want the user to set.</p><p>Thus, if you want you MVC app to be properly designed I would recommended to use a dedicated view model to prevent the &#34;guts&#34; of your internal business model from being exposed to the client, thus I would recommend you a specific view model.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../is-entity-framework-the-way-to-go-for-our-situation/'>Is Entity Framework the way to go for our situation</a></li><li class="list-group-item"><a href='../entity-framework-with-large-systems-how-to-divide-models/'>Entity Framework with large systems &#8211; how to divide models</a></li><li class="list-group-item"><a href='../what-are-the-tradeoffs-for-using-partial-view-models/'>What are the tradeoffs for using &#8216;partial view models&#8217;</a></li><li class="list-group-item"><a href='../architecture-where-view-models-inside-web-project-of-n-tier-application-should-be-placed/'>Architecture &#8211; Where view models inside Web project of n-tier application should be placed</a></li><li class="list-group-item"><a href='../c-class-with-navigation-property-and-with-or-without-foreign-key/'>C# &#8211; Class with navigation property and with or without foreign key</a></li><li class="list-group-item"><a href='../java-best-way-to-deal-with-hibernate-1-many-relationship-over-rest-json-service/'>Java &#8211; Best way to deal with Hibernate 1->Many relationship over REST/JSON service</a></li><li class="list-group-item"><a href='../entity-framework-in-n-tier-application-confusion/'>Entity Framework in n-tier application confusion</a></li><li class="list-group-item"><a href='../reusing-a-top-level-dto-as-a-child-in-another-dto/'>Reusing a top-level DTO as a child in another DTO</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>