<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; DDD &#8211; Factory or Service &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080244 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080244" class="post-1080244 software type-software status-publish hentry category-software tag-c tag-design-patterns tag-domain-driven-design tag-factory tag-service"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; DDD &#8211; Factory or Service</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">domain-driven-design</span><span class="mr-2 badge badge-primary">factory</span><span class="mr-2 badge badge-danger">service</span></p><div class="entry-content"><p>I&#39;m new to DDD, and I&#39;m confused at the very start of my DDD project. To setup a context, I&#39;m building the user management part of my app, so I&#39;m building my Account entity, which contains an Id, a username and a password.</p><pre><code>public class Account: IEntity&lt;string&gt;
{
    public string Id { get; }
    public string Username { get; }
    public string Password { get; }

    public Account(string id, string username, string password)
    {
        Id = id;
        Username = username;
        Password = password;
    }
}
</code></pre><p>The IEntity interface just forces a type as id, like this:</p><pre><code>public interface IEntity&lt;out T&gt;
{
    T Id { get; }
}
</code></pre><p>Now here comes my problem, when creating the account, stuff like checking the username to be unique which requires to hit the repository, and hashing the password, which uses a domain service IHashingPassword, comes up to my mind so creating the entity just by putting the logic in it doesn&#39;t seem right.</p><p>From what I&#39;ve read, creating object with complexity goes into a factory, but the creation of this object isn&#39;t quite complex, it&#39;s just that some logic is there that isn&#39;t checkable by the entity itself ( I&#39;m not injecting my repo into my entity ).</p><p>So I tend to think that checking for the username ( repo ) and hashing the password ( hashing service ) should be done in my domain service instead of in the factory, or is it OK to do that in my factory, like I do now:</p><pre><code>public class AccountFactory: IAccountFactory
{
    private readonly IHashingService _hashingService;

    public AccountFactory(IHashingService hashingService)
    {
        _hashingService = hashingService;
    }

    public Entities.Account Create(string username, string password)
    {
        var id = IdentityBuilder.Build();
        var hashedPassword = _hashingService.HashPassword(password);

        return new Entities.Account(id, username, hashedPassword);
    }
}
</code></pre><p>I&#39;m not checking the username yet, it&#39;s just to show my current situation. Should this ( the checking of the username &amp; hashing the password ) be done in a domain service and should I scratch the factory, or should I do this in the factory?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I suggest you actually attempt to model the actions to which you are alluding above in your application layer. Namely <code>RegisterAccount</code> and <code>Login</code>, because I think it can help bring clarity to your situation. That is, by working backwards from the public surface you would like your domain to expose to your application layer, it can help inform us where responsibilities should (and <em>should not</em>) be given.</p><p>For example, you may have a <code>RegisterAccount</code> command handler that <em>boils down</em> to the following:</p><pre><code>accountRepository.Add( new Account(cmd.UserName, cmd.Password) )

accountRepository.Save() // throws DuplicateUserName
</code></pre><p>and a <code>Login</code> command handler that <em>boils down</em> to:</p><pre><code>account = accountRepository.FindByUserName( cmd.UserName ) // throws NotFound

account.Login( cmd.Password ) // throws InvalidPassword
</code></pre><p>The above represents just about the most declarative way to model each process. This is a good thing. It&#39;s important that your application can present a clear and concise &#34;view&#34; of each business process in terms of behavior. Of course, this is precisely what the application layer is for: coordinating your domain with as little logic as possible (i.e. rules) in a way to provide this view. So with the above in mind, let us move on to your specific questions.</p><p>Set validation is tricky. If there is a rule mandating that a <code>UserName</code> must be unique within a set of <code>Account</code>, it should be enforced by the set of <code>Account</code>. Is there a piece of your application which represents a collection of <code>Account</code>? Often, set validation belongs on your <code>Repository</code>. This is especially convenient because a <code>Repository</code> &#34;knows&#34; the single critical piece of infrastructure necessary to enforce this kind of invariant (the data store). In your case (and many others like it), I would recommend enforcing this as a constraint in your data store and let your <code>AccountRepository</code> throw an exception on <code>Save</code> if an <code>Account</code> with a duplicate <code>UserName</code> is added. Simple. Declarative.</p><p>I cannot recommend creating a separate service to check that adding an <code>Account</code> will succeed before it is added, because this represents a separation of data and behavior. The idea of validating that some process will succeed before it is attempted is a fundamentally procedural approach, not OOP, and certainly not DDD. This practice can also lead to all sorts of duplication and gotchas down the road when applied liberally to a system. Let the rules exits <em>with</em> the data, not <em>around</em> the data.</p><p>Moving on, we can see that your <code>Account</code> entity certainly requires a dependency on a hashing cohesive mechanism, as it must be able to internally hash and check hashes to allow for both the account registration and login processes. The question is whether or not this should exist as a domain service or something else. Truthfully, it doesn&#39;t really matter. The inner workings of an Entity are not important (hence the abstraction). What is important is that we focus on the <em>behavior</em> we would like to achieve, and let the data that supports this behavior be an implementation detail. This is the perspective that DDD seeks to provide.</p><p>That said, I understand hashing to be a cross-cutting concern. Unless your algorithm is specific to your domain, it would seem to me that hashing belongs as part of infrastructure. Don&#39;t let your domain become concerned with things that aren&#39;t truly business rules (hashing is more of a technical concern in most industries).</p><p>With regard to factories: A factory should be used when the creation of an Entity is so verbose that your model starts to lose focus. Importantly, NOT when you want to encapsulate rules. Whether or not a factory should be employed is up to you to decide.</p><p><strong>EDIT</strong>: I&#39;d like to touch on another idea which I kind of danced around in my answer above, but didn&#39;t explicitly state: the idea of <em>delaying</em> implementation until absolutely necessary. This can be an incredibly useful tactic when designing and implementing a system. In the book <em>Clean Architecture</em> by Robert Martin, he brings this idea up specifically in relation high-level decisions like data storage, but it is useful even in microcosms (such as modeling a workflow).</p><p>At it&#39;s core, it means to push rules (implementation) down the road as far as possible. In terms of the above system, it means enforcing a unique constraint at the lowest level it can be enforced or engaging in hashing where absolutely necessary. Simply being cognizant of this practice will lead you to naturally implement rules as close as possible to the behavior of which they govern. Of course, this is the core principal of OOP.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../ddd-a-rookies-unanswered-questions/'>DDD – A rookie’s unanswered questions</a></li><li class="list-group-item"><a href='../c-separation-of-concerns-between-repository-and-service-in-ddd-with-complex-entities/'>C# &#8211; Separation of concerns between repository and service in DDD with complex entities</a></li><li class="list-group-item"><a href='../architecture-how-should-an-entity-that-abstracts-an-external-service-do-its-operations/'>Architecture &#8211; How should an entity that abstracts an external service do its operations</a></li><li class="list-group-item"><a href='../php-ddd-creating-reusable-modules-and-service-type-distinctions-domain-infrastructure-application/'>Php &#8211; DDD: Creating reusable modules and service type distinctions (Domain, Infrastructure, Application)</a></li><li class="list-group-item"><a href='../where-to-put-code-related-to-invariants/'>Where to put code related to invariants</a></li><li class="list-group-item"><a href='../ddd-how-and-where-change-password-for-user-entity/'>DDD &#8211; how and where change password for user entity</a></li><li class="list-group-item"><a href='../ending-up-with-too-many-services-in-ddd/'>Ending up with too many services in DDD</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>