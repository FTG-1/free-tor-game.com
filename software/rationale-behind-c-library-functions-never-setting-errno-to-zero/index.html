<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Rationale behind C library functions never setting errno to zero &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072963 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072963" class="post-1072963 software type-software status-publish hentry category-software tag-c tag-standards"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Rationale behind C library functions never setting errno to zero</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">standards</span></p><div class="entry-content"><p>The C standard mandates that no C standard library functions shall set <code>errno</code> to zero. Why exactly is this?</p><p>I could understand it being useful for calling several functions, and only checking <code>errno</code> after the last one &#8211; for example:</p><pre><code>errno = 0;
double x = strtod(str1, NULL);
long y = strtol(str2, NULL);
if (errno)
    // either &#34;strtod&#34; or &#34;strtol&#34; failed
else
    // both succeeded
</code></pre><p>However, is this not considered &#34;bad practice&#34;? Since you&#39;re only checking <code>errno</code> at the very end, you only know that one of the functions <em>did</em> fail, but not <em>which</em> function failed. Is simply knowing that <em>something</em> failed good enough for most practical programs?</p><p>I tried looking for various C Rationale documents, but many of them don&#39;t have much detail for <code>&lt;errno.h&gt;</code>.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The C library does not set <code>errno</code> to 0 for historical reasons<sup>1</sup>. POSIX no longer claims its libraries will not alter the value in case of success, and <a href="http://linux.die.net/man/3/errno">the new Linux man page for <code>errno.h</code></a> reflects this:</p><blockquote><p>The <code>&lt;errno.h&gt;</code> header file defines the integer variable <code>errno</code>, which is set by system calls and some library functions in the event of an error to indicate what went wrong. Its value is significant only when the return value of the call indicated an error (i.e., <code>-1</code> from most system calls; <code>-1</code> or <code>NULL</code> from most library functions); <strong>a function that succeeds <em>is</em> allowed to change <code>errno</code>.</strong></p></blockquote><p>The <a href="http://www.lysator.liu.se/c/rat/d1.html#errno-4-1-3">ANSI C Rationale</a> states that the committee felt it was more practical to adopt and standardize the existing practice of using <code>errno</code>.</p><blockquote><p>The error reporting machinery centered about the setting of <code>errno</code> is generally regarded with tolerance at best.  It requires a ``pathological coupling&#39;&#39; between library functions and makes use of a static writable memory cell, which interferes with the construction of shareable libraries.  Nevertheless, the Committee preferred to standardize this existing, however deficient, machinery rather than invent something more ambitious.</p></blockquote><p>There is almost always a way to check for error outside of checking if <code>errno</code> got set. Checking if <code>errno</code> got set is not always reliable, since some calls require calling a separate API to get the error reason. For instance, <code>ferror()</code> is used to check for an error if you get a short result from <code>fread()</code> or <code>fwrite()</code>.</p><p>Interestingly enough, your example of using <code>strtod()</code> is one of the cases where setting <code>errno</code> to 0 before the call is <strong>required</strong> to correctly detect if an error has occurred. All the <code>strto*()</code> string to number functions have this requirement, because a valid return value is returned even in the face of an error.</p><pre><code>errno = 0;
char *endptr;
double x = strtod(str1, &amp;endptr);
if (endptr == str1) {
    /*...parse error */
} else if (errno == ERANGE) {
    if (x == 0) {
        /*...underflow */
    } else if (x == HUGE_VAL) {
        /*...positive overflow */
    } else if (x == -HUGE_VAL) {
        /*...negative overflow */
    } else {
        /*...unknown range error? */
    }
}
</code></pre><p>The above code is based on the behavior of <a href="http://linux.die.net/man/3/strtod"><code>strtod()</code> as documented on Linux</a>. The C standard only stipulates that underflow cannot return a value greater than the smallest positive <code>double</code>, and whether or not <code>errno</code> is set to <code>ERANGE</code> is implementation defined<sup>2</sup>.</p><p>There is actually an extensive <a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=6619179">cert advisory write-up</a> that recommends always setting <code>errno</code> to 0 before a library call and checking its value <em>after the call indicates a failure has occurred</em>. This is because some library calls will set <code>errno</code> even if the call itself was successful<sup>3</sup>.</p><blockquote><p>The value of <code>errno</code> is 0 at program startup, but it is never set to 0 by any library function. The value of <code>errno</code> may be set to nonzero by a library function call whether or not there is an error, provided the use of <code>errno</code> is not documented in the description of the function in the C Standard. It is meaningful for a program to inspect the contents of <code>errno</code> only after an error has been reported. More precisely, <strong><code>errno</code> is meaningful only after a library function that sets <code>errno</code> on error has returned an error code.</strong></p></blockquote><hr/><p><sub>1. Previously I claimed it was to avoid masking an error from an earlier call. I can&#39;t find any evidence to support this claim. I also had a bogus <code>printf()</code> example.</sub><br/> <sub>2. Thanks to @chux for pointing this out. Reference is C.11 §7.22.1.3 ¶10.</sub><br/> <sub>3. Pointed out by @KeithThompson in a comment.</sub><br/></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../should-functions-of-a-c-library-always-expect-a-strings-length/'>Should functions of a C library always expect a string&#8217;s length</a></li><li class="list-group-item"><a href='../why-does-the-c-library-use-macros-and-functions-with-same-name/'>Why does the C library use macros and functions with same name</a></li><li class="list-group-item"><a href='../why-would-you-ever-use-malloc0/'>Why would you ever use `malloc(0)`</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>