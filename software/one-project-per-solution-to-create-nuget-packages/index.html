<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>One project per solution to create nuget packages &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084227 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084227" class="post-1084227 software type-software status-publish hentry category-software tag-nuget"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">One project per solution to create nuget packages</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">nuget</span></p><div class="entry-content"><p>I have a solution with 10 projects, I used to distribute this as an SDK with an installer back in the day.</p><p>To change that in VSTS I added the steps to create a package per project, every time I make a change, a build is triggered and a PS script change the version of the nuspec files, in the end the packages are pushed to a feed, if I made a change to just one project the build pushes a new version of every packages even though there are no changes in all of them.</p><p>Someone told me this was wrong, I should not push a new version if there was no change in the package and every package has to be created separately.</p><p>That makes sense, but in my case, I have to create 9 more builds in VSTS, replace the project references for nuget dependencies, and, if I ever need to change two projects I have to modify one, commit the change, then open the second project update the nuget reference and make the change, which seems like a lot of extra work.</p><p>So my question is, is there a best practice or recommendation about the flow in creating a group of nuget packages?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I&#39;m using Azure DevOps (formerly VSTS), and while this question is old, it may have value for others.</p><p>My understanding of best practice is:</p><ul><li>Use semantic versioning</li><li>Separate package groups into distinct repositories where possible</li><li>Don&#39;t update a package version if the package isn&#39;t changed<ul><li>This is tricky with version data coming from a CI build and <code>n</code> package projects in a <code>.sln</code></li></ul></li><li>Organize NuGet feeds such that any feed can be used by any number of projects, but any one project uses only one feed (ie. employ upstream feeds)</li></ul><hr/><h2>Only Version Changed Packages</h2><h3>There are legitimate situations for many projects in a single solution</h3><p><em>This has almost always been true.</em></p><h3>Avoid the build collection balloon</h3><p>For those situations, you <em>CAN</em> do as you have stated in your question and create a build for each <code>.csproj</code> file in the <code>.sln</code> and trigger on the path containing that <code>.csproj</code>, but I might not recommend it.</p><p>Though I like the idea of discrete identification of why a build exists, I don&#39;t like the idea of creating a new build pipeline any time a developer adds a project to the <code>.sln</code>. As I&#39;m wearing 2 hats - one as the primary DevOps Engineer and another as a Sr. Developer - I don&#39;t like setting myself up for loads of new build pipeline requests from my team if I can help it.</p><h2>Powershell to the rescue</h2><p>It&#39;s a common (and accurate) saying:</p><blockquote><p>Just because you CAN do something in Powershell doesn&#39;t mean you should.</p></blockquote><p>However, I don&#39;t believe I&#39;m abusing this tool here.</p><p>I&#39;m opting to let the build chew on the <code>.sln</code> file and build everything, and even create a <strong>new package version</strong> for all the projects based on the build number.</p><p><strong>But...</strong> When it comes time to move the packages into the Build Artifact Staging area, I want Powershell to take the generic <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/utility/copy-files?view=azure-devops&amp;tabs=yaml" rel="nofollow noreferrer">Copy Files task</a> to school and only copy packages produced by a <code>.csproj</code> that has actually been changed.</p><h3>How?</h3><p>By iterating over the commits linked to the build and first using <code>git cat-file -p $commit</code> to make sure that the commit isn&#39;t a Merge (non-merge commits only have 1 parent listed) and then use <code>git diff-tree --no-commit-id --name-only -r $commit</code> to get the files changed for those commits. With that data in hand I can index the direct sub-directories of my build trigger directory (read: the directory containing the <code>.sln</code>), which should be the project directories, and copy the packages where the package name contains the project directory name.</p><p>Because our convention for where projects live under a solution is well developed, I can make certain assumptions about what should be done based on the output of the git commands.</p><h3>Why?</h3><p>Doing this &#34;Dynamic Artifact Composition&#34; allows the <code>.sln</code> to grow or shrink naturally and no additional changes to the CI are required. New projects are detected and their packages included, while removed projects are simply no longer available to produce a package for the script to copy.</p><p>This approach also gives a direct relationship between the artifact produced, which only includes <code>Some.Lib.1.0.1907.302.nupkg</code>, with the commits shown in the build summary, which show changes to <code>src/sln/Some.Lib/logic/ChangedClass.cs</code> for example.</p><h3>Pump the breaks</h3><p>I mentioned our convention. You need to make sure you can actually do this based on what your project and solution directory structure looks like. Solution authoring allows one to have a lot of freedom for adding projects that live outside the solution directory. While this doesn&#39;t remove the option to do it this way, you need to make sure your script is flexible according to your environment.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../should-a-solution-containing-projects-exposed-as-nuget-reference-them-as-package/'>Should a solution containing projects exposed as nuget reference them as package</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>