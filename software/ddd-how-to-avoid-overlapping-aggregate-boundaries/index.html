<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>DDD &#8211; How to avoid overlapping aggregate boundaries &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1079861 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1079861" class="post-1079861 software type-software status-publish hentry category-software tag-aggregate tag-domain-driven-design tag-domain-model"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">DDD &#8211; How to avoid overlapping aggregate boundaries</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aggregate</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">domain-model</span></p><div class="entry-content"><p>I recently started reading Evan&#39;s book about DDD, and I decided to try and apply some of the principles from that book on a bounded context of a project I&#39;ve been working on.</p><p>The context of interest deals with appointment and appointment scheduling.<br /> I will present some of the business requirements, as well as the current model.</p><p>We have Employees, Appointments and Rooms. An appointment can have at most 1 employee per role, for example 1 counselor, 1 doctor. These employees all start and finish their part of the appointment at a different time. For example, a counselor can be present from x1 till y1, and a doctor can be present from x2 till y2 (these can overlap, or be disjointed). The appointment is considered to start at the earliest x, and end at the latest y. An appointment can also have only 1 patient. An appointment must take place in a room. Employees cannot have overlapping appointments (regarding to their own start and finish times). An appointment cannot take place in a room if that room is occupied for a different appointment.</p><p>This is the model I came up with:</p><p><a href="../../../i.stack.imgur.com/2FBwe.jpg" rel="noreferrer"><img src="../../../i.stack.imgur.com/2FBwe.jpg" alt="initial model"/></a></p><p>In addition to the previous invariants, these business rules must be upheld: A patient can have only 1 scheduled appointment at a given time (assume there is a status attribute in Appointment).</p><p>The model should support the following use-cases:</p><ul><li>Scheduling an appointment.</li><li>Updating an appointment schedule&#39;s start/end time</li><li>Assigning a different employee to an appointment</li><li>Adding/removing appointment schedules from an appointment</li></ul><p>I have trouble defining the aggregates, their roots and boundaries. From the given constraints, I think it is pretty obvious that the DailySchedule aggregate needs to encompass the Availability and AppointmentSchedule value objects. However, Appointment also needs to encompass AppointmentSchedule in order to maintain the invariant that there should be only 1 employee role per appointment. Furthermore, Room and Patient both need to encompass Appointment in order to maintain their invariants.</p><p>Supposing that Patient&#39;s invariant can be modeled as a business rule/policy object, that still leaves DailySchedule and Appointment sharing a reference to a value object, without going through its aggregate root.</p><p>It seems to me that this model does not allow for clearly defined aggregate boundaries. I was considering exposing SERVICES for each of the use-cases, that would span between the aggregate boundaries and maintaining the invariants from there. I am interested to know if there is any other, possibly more elegant/simple solution to this problem.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>A good starting point for you would be Yves Reynhout&#39;s <a href="https://www.youtube.com/watch?v=7StN-vNjRSw" rel="noreferrer">Evolving a Model</a>, where he describes the modeling of appointment scheduling for healthcare.</p><p>You might also want to review Greg Young&#39;s discussion of <a href="https://www.youtube.com/watch?v=LDW0QWie21s&amp;t=10m48s" rel="noreferrer">warehouse systems</a>.  The summary is this: if you have a reasonable way to detect and report a scheduling conflict in your data, you may not necessarily need to <em>prevent</em> violations from occurring.</p><p>One insight that helped me to grasp this is that <em>the order that messages arrive is not a guarantee of correctness</em>.  Udi Dahan, in <a href="http://udidahan.com/2010/08/31/race-conditions-dont-exist/" rel="noreferrer">Race Conditions Don&#39;t Exist</a>, observes</p><blockquote><p>A microsecond difference in timing shouldnâ€™t make a difference to core business behaviors.</p></blockquote><p>Here&#39;s a message saying that Dr. Frankenstein should be in room A from 10:00 until 11:00; here&#39;s another message saying that she should be in room B from 10:30 until 11:30.  It&#39;s clear that the two messages are not consistent, but we don&#39;t know which is right - in particular, there might already be a message coming that cancels the &#34;wrong&#34; appointment, we just haven&#39;t seen it yet.</p><p>In many cases, what we are really looking for is something like the solutions Greg Young describes in <a href="https://www.youtube.com/watch?v=GRr4xeMn1uU" rel="noreferrer">Stop Over Engineering</a>; first escalate problems to the human beings, then work on identifying problems that are simple enough that solutions can be automated.</p><p>Systems that overly constrain to prevent conflicts often inflict disappointing experiences on the users.  There was a data entry error, but before we can enter the <em>correct</em> data for this appointment, the system interrupts that tasks and insists that the error be corrected.  Furthermore, correcting that error may be complicated.</p><p>If you keep in mind that the role of a scheduling system is to identify and resolve conflicts, rather than prevent them, you may find that you have a lot more freedom in how you design your aggregates.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-balance-between-aggregate-boundaries-and-domain-consistency-in-ddd/'>Architecture &#8211; Balance between aggregate boundaries and domain consistency in DDD</a></li><li class="list-group-item"><a href='../architecture-rich-domain-model-vs-strategy-pattern-in-ddd/'>Architecture &#8211; Rich domain model vs strategy pattern in DDD</a></li><li class="list-group-item"><a href='../a-problem-with-understanding-aggregates-and-aggregate-roots-in-domain-driven-design-ddd/'>A problem with understanding aggregates and aggregate roots in Domain Driven Design (DDD)</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>