<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Ambient dependency injection through static service locator &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081503 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081503" class="post-1081503 software type-software status-publish hentry category-software tag-asp-net-core tag-c tag-dependency-injection tag-service-locator"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Ambient dependency injection through static service locator</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-core</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">dependency-injection</span><span class="mr-2 badge badge-primary">service-locator</span></p><div class="entry-content"><p>After some googling I found some debates about whether constructor injection or property/field injection is better, but there is yet another alternative that strikes me as more beneficial.</p><p>In most programming environments, there is something called &#34;the call context&#34;, which is information implicitly passed from caller to callee.</p><p>Sometimes this context is simply thread-local storage, sometimes, in the case of cross-thread asynchronous programming, it&#39;s more complex than that.</p><p>In any case, such contexts store information such as culture, user, or, for web applications, the current request.</p><p>These types of information are rarely carried around explicitly but accessed through global methods that are accessing said contexts.</p><p>In the use case of dependency injection, this means a static/global form of service locator (my example is in C#):</p><pre><code>public static Sl
{
    public static Dependency Get&lt;Dependency&gt;();

    public static IDisposable Push&lt;Dependency&gt;(Dependency dependency);
}
</code></pre><p>The usage would be:</p><pre><code>public void SomeFunction()
{
    Sl.Get&lt;Dependency&gt;().UseItSomehow();
}
</code></pre><p>To call <code>SomeFunction</code>, the dependency can be set or changed for the callees like this:</p><pre><code>using (Sl.Push&lt;SomeDependency&gt;(someImplementation)
{
    SomeFunction();
}
</code></pre><p>I think this pattern superior to other types of dependency injection <em>in those cases where a dependency is uniformly required for a large part of a larger call subtree</em>.</p><p>For example, a repository, logger or configuration interface is rarely required only for a single function, but also for all its subsequent nested calls.</p><p>Especially with contructor injection this leads to some clutter that can be completely avoided: <code>SomeFunction</code> above can call other functions that will get the dependency automatically. It can also change the dependency in those cases where it actually is necessary.</p><p>I want to address some of the concerns I think I read somewhere, and my question would then be if anyone can think of others.</p><ul><li><p>There&#39;s a dependency on <code>Sl</code></p><p>This strikes me as a fundamentalist&#39;s objection. Most software also depend on integers, strings and lists, without such things being properly abstracted away and passed around with proper respect to the pure Church of Dependency Injection. Clearly <em>some</em> low-level things one needs to depend on directly &#8211; hopefully they are well-designed and ideally they reside in the runtime library of the respective language. If not, they may still be the lesser evil.</p></li><li><p>Required dependencies should be explicit</p><p>The only really explicit form of DI is contructor injection or passing dependencies directy in method calls. Unfortunately, this is also the most verbose and unflexible way of doing it. Dependencies that are added later change constructor or method signatures, requiring a refactoring of potentially several layers of function calls that do nothing but passing down objects verbatim. In static languages, this is tedious. In dynamic ones, it&#39;s even a source of bugs.</p><p>Furthermore, if the dependency is required, the respective feature will fail whenever it&#39;s used anyway, making it very likely that a missing-dependency bug won&#39;t accidentally go to production.</p><p>So ideally, yes, required dependencies should be explicit. But there&#39;s always a tradeoff, and am I really the only one who thinks that the constructor injection folk don&#39;t have their priorities straight?</p></li><li><p>One shouldn&#39;t rely on magic</p><p>Call contexts and thread-statics are not magic, they are merely advanced and perhaps more technical than what is covered in your typical programming course at university.</p><p>Also, the implementation is hidden behind the static service locator. Users don&#39;t have to know how it works to use it.</p></li></ul><p>Besides this, there&#39;s also a strange hypocrisy among DI-fans. Take ASP.NET Core, for example: These guys literally force a DI-paradigm on their users. The result is a design that makes realizing existing dependencies particularly difficult. It&#39;s as if they are mocking themselves.</p><p>Consider how they allow binding certain configuration for outgoing web requests, such as authentication or setting some custom headers, to the code that is using it: You first do the configuration code (<code>HttpClient</code> and <code>HttpClientFactory</code>) and put them in a global service container. Then whereever the client is needed, it&#39;s fished out of the container. That means that if the configuration code is missing, everything will still compile and you won&#39;t notice until runtime.</p><p>And what if you have different configurations for different use points? ASP.NET Core&#39;s solution: Associate the specially configured <code>HttpClientFactory</code>s with magic strings and use those magic strings to fish out the correct one where it&#39;s needed!</p><p>Are you kidding me? What&#39;s going on here?</p><p>Dependencies used to be <em>more</em> explicit before this insanity was sweeping the minds of coders.</p><p>I&#39;m now asked to make tedious finger excerises (ctor injection) and then throw those types all in one global container with no compile time checking for correct composability whatsoever.</p><p>So my question: Are there any legitimate, real-world reasons why DI with a static/global service locator would be bad, or am I correct in concluding that it is a sensible way to deal with this unfortunate craziness?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Are there any other objections? Are there any legitimate, real-world reasons why DI with a static/global service locator would be bad?</p></blockquote><p>Ugh, yes.</p><p><strong>Statics/globals are horrible.</strong> They assume that the runtime of your application is homogenous - all of your instances require all the same sort of instances all over. That is naive. They interfere with concurrency, since any state in <em>any</em> of these things is inherently shared state. They interfere with testing, since you can&#39;t effectively mock different instances running concurrently or even different instances down the callstack. And then there&#39;s the usual debugging issues with global state.</p><p><strong>Hiding your problems is not fixing your problems.</strong> If you have something that <em>everything</em> needs, then you have widespread coupling. If you have objects that need a bunch of dependencies, then you have widespread coupling. If you have a huge object hierarchy that makes it difficult to pass things around where they need to go, then you probably have a poor design. <em>DI does not fix these things!</em> All you&#39;re doing is hiding it behind some magic that passes dependencies around. You&#39;re not <em>removing</em> the dependencies, just making them less visible and a runtime error rather than a compile time error.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../ioc-containers-and-service-locator-pattern/'>IoC containers and service locator pattern</a></li><li class="list-group-item"><a href='../object-oriented-a-service-locator/'>Object-oriented &#8211;  a Service Locator</a></li><li class="list-group-item"><a href='../c-ioc-as-service-locator/'>C# &#8211; IoC as service locator</a></li><li class="list-group-item"><a href='../c-only-use-a-dependency-injection-container-at-the-root-of-an-application/'>C# &#8211; Only use a dependency injection container at the root of an application</a></li><li class="list-group-item"><a href='../dependencyinjection-constructor-over-injection-smell-vs-service-locator-where-is-the-proper-approach/'>DependencyInjection &#8211; Constructor over-injection smell vs service locator &#8211; where is the proper approach</a></li><li class="list-group-item"><a href='../whats-the-difference-between-using-dependency-injection-with-a-container-and-using-a-service-locator/'>What&#8217;s the difference between using dependency injection with a container and using a service locator</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>