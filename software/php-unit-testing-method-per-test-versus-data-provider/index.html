<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; Unit Testing: Method per test versus data provider &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078267 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078267" class="post-1078267 software type-software status-publish hentry category-software tag-php tag-phpunit tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; Unit Testing: Method per test versus data provider</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">PHP</span><span class="mr-2 badge badge-info">phpunit</span><span class="mr-2 badge badge-warning">unit testing</span></p><div class="entry-content"><p>I&#39;m having a bit of a philosophical argument with one of my colleagues regarding the &#34;right&#34; way to do unit tests (in this case with PHPUnit).  I&#39;m of the opinion that you should write one test method in the unit test per test you want to run.</p><pre><code>// Obviously a very contrived example!
class AdderTest extends TestCase
{
    private $object = NULL;

    protected function setup ()
    {
        $this -&gt; object = new Adder ();
    }

    /**
     * Test that 2 + 2 = 4
     */
    public function testAddTwoTwoFour ()
    {
        $this -&gt; assertEquals ($this -&gt; object -&gt; add (2, 2), 4);
    }

    /**
     * Test that 2 + 3 = 5
     */
    public function testAddTwoThreeFive ()
    {
        $this -&gt; assertEquals ($this -&gt; object -&gt; add (2, 3), 5);
    }

    // and a bunch of other test cases
}
</code></pre><p>My colleague, however, thinks that it&#39;s better to use data providers.</p><pre><code>class AdderTest extends TestCase
{
    private $object = NULL;

    protected function setup ()
    {
        $this -&gt; object = new Adder ();
    }

    /**
     * Test add method
     *
     * @dataProvider addTestDataSource
     */
    public function testAdd ($expected, $a, $b)
    {
        $this -&gt; assertEquals ($this -&gt; object -&gt; add ($a, $b), $expected);
    }

    private function addTestDataSource ()
    {
        return [
            [4, 2, 2], // Equivalent to testAddTwoTwoFour
            [5, 2, 3], // Equivalent to testAddTwoThreeFive
        ];
    }
}
</code></pre><p>My personal opinion is that the former is better because:</p><ul><li>One test method = 1 test, and every unit test should verify one and only one fact about the unit under test is correct.</li><li>Failures are easy to spot because the name of the failed test method is displayed</li><li>I&#39;m of the opinion that unit tests should under no circumstances attempt to be at all &#34;clever&#34; on the grounds that a test failure means that either the code under test is wrong, or the test itself is wrong*, and the cleverer the test is, the more difficult it is to rule the test out as the source of the failure.  You&#39;re supposed to be debugging the code, not its unit tests.</li><li>In the case of PHPUnit it relies on &#34;magic&#34; to work (namely PHPUnit decoding the @dataProvider tag)</li><li>If you want to do different types of assertions you have to write additional test methods anyway.</li></ul><p>My colleague prefers his method because:</p><ul><li>One unit test per case violates Don&#39;t Repeat Yourself</li><li>One unit test per case encourages copy and pasting, which is normally considered bad practice</li><li>If the interface of the unit under test changes then you have to change a lot of test methods (which can be error-prone) whereas you only have to change one test method and one data providing method in the data provider case</li><li>The unit test is a lot more concise and therefore easier to understand.</li></ul><p>While I (naturally) think I&#39;m correct, my colleague does raise some valid points.  Do you consider my approach to be better, or would you prefer his?  What is your reasoning for your choice, especially if that reasoning isn&#39;t in the lists I provided above?</p><p>*assuming no bugs in the unit test framework itself, of course!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It depends.</p><p>You should ask yourself: what property of the code is this particular test testing? What do I know when I know that this test is green?</p><p>I don&#39;t mean this as a philosophical exercise, but in a very practical sense. Take your Adder, for example. You can ask it &#34;Can you add 2 and 2 correctly?&#34; and &#34;Can you add 2 and 3 correctly?&#34; So you would write these tests:</p><pre><code>public function knowsTwoPlusTwoIsFour ()
public function knowsTwoPlusThreeIsFive ()
</code></pre><p>But maybe you don&#39;t want to know that. Maybe what you really want to know is &#34;Can you add two ordinay numbers correctly?&#34; (I&#39;ll explain what &#34;ordinary&#34; means later) Now your test should use a data provider. The test would be</p><pre><code>public function canAddOrdinaryNumbers()
</code></pre><p>and your data source should include the usual &#34;normal&#34; cases, i.e. adding zero, adding negative numbers, adding its complement:</p><pre><code>[4, 2, 2],    // Duh
[-1, 2, -3],  // negative summand
[0, 0, 0],    // just to make sure
[2, 2, 0],    // neutral element
[0, 2, -2],   // inverse
</code></pre><p>Now your test tells you that Adder has no problems with normal numbers. That&#39;s basically one piece of information, hence it should be one test method.</p><p>What about numbers that are not ordinary?</p><pre><code>public function canAddOneToNaN ()
public function knowsWhatInfPlusNegInfIs ()
public function croaksOnFLoatingPointInput ()
public function whatIsOnePlusSqrtOfMinusOneAnyway ()
</code></pre><p>I&#39;ll leave the implementation of these test cases as an exercise to the reader, and would like to focus on this point: All unit test methods in a class should convey about the same amount of information. That is a subjective measure, of course, but I think it&#39;s a good rule: look at the tests and ask yourself: are some of these tests only telling me stuff others already did before? Do some tests seem to have more meaning than others? If so, then you might want to do some refactoring.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-unit-testing-eloquent-outside-of-laravel/'>Unit-testing &#8211; Unit testing Eloquent outside of Laravel</a></li><li class="list-group-item"><a href='../unit-testing-how-to-not-test-implementation-when-method-returns-void/'>Unit-testing &#8211; How to not test implementation when method returns void</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>