<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>So Singletons are bad, then what &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1062886 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1062886" class="post-1062886 software type-software status-publish hentry category-software tag-anti-patterns tag-caching tag-dependency-injection tag-design-patterns tag-singleton"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">So Singletons are bad, then what</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">anti-patterns</span><span class="mr-2 badge badge-info">caching</span><span class="mr-2 badge badge-warning">dependency-injection</span><span class="mr-2 badge badge-primary">design-patterns</span><span class="mr-2 badge badge-danger">singleton</span></p><div class="entry-content"><p>There has been a lot of discussion lately about the problems with using (and overusing) Singletons. I&#39;ve been one of those people earlier in my career too. I can see what the problem is now, and yet, there are still many cases where I can&#39;t see a nice alternative &#8211; and not many of the anti-Singleton discussions really provide one.</p><p>Here is a real example from a major recent project I was involved in:</p><p>The application was a thick client with many separate screens and components which uses huge amounts of data from a server state which isn&#39;t updated too often. This data was basically cached in a Singleton &#34;manager&#34; object &#8211; the dreaded &#34;global state&#34;. The idea was to have this one place in the app which keeps the data stored and synced, and then any new screens that are opened can just query most of what they need from there, without making repetitive requests for various supporting data from the server. Constantly requesting to the server would take too much bandwidth &#8211; and I&#39;m talking thousands of dollars extra Internet bills per week, so that was unacceptable.</p><p>Is there any other approach that could be appropriate here than basically having this kind of global data manager cache object? This object doesn&#39;t officially have to be a &#34;Singleton&#34; of course, but it does conceptually make sense to be one. What is a nice clean alternative here?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It&#39;s important to distinguish here between <em>single instances</em> and the <a href="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton design pattern</a>.</p><p><em>Single instances</em> are simply a reality.  Most apps are only designed to work with one configuration at a time, one UI at a time, one file system at a time, and so on.  If there&#39;s a lot of state or data to be maintained, then certainly you would want to have just one instance and keep it alive as long as possible.</p><p>The Singleton <em>design pattern</em> is a very specific <em>type</em> of single instance, specifically one that is:</p><ul><li>Accessible via a global, static instance field;</li><li>Created either on program initialization or upon first access;</li><li>No public constructor (cannot instantiate directly);</li><li>Never explicitly freed (implicitly freed on program termination).</li></ul><p>It is because of this specific design choice that the pattern introduces several potential long-term problems:</p><ul><li>Inability to use abstract or interface classes;</li><li>Inability to subclass;</li><li>High coupling across the application (difficult to modify);</li><li>Difficult to test (can&#39;t fake/mock in unit tests);</li><li>Difficult to parallelize in the case of mutable state (requires extensive locking);</li><li>and so on.</li></ul><p>None of these symptoms are actually endemic to single instances, just the Singleton pattern.</p><p>What can you do instead?  Simply don&#39;t use the Singleton pattern.</p><p>Quoting from the question:</p><blockquote><p>The idea was to have this one place in the app which keeps the data stored and synced, and then any new screens that are opened can just query most of what they need from there, without making repetitive requests for various supporting data from the server. Constantly requesting to the server would take too much bandwidth - and I&#39;m talking thousands of dollars extra Internet bills per week, so that was unacceptable.</p></blockquote><p>This concept has a name, as you sort of hint at but sound uncertain of.  It&#39;s called a <a href="http://en.wikipedia.org/wiki/Cache">cache</a>.  If you want to get fancy you can call it an &#34;offline cache&#34; or just an offline copy of remote data.</p><p>A cache does not need to be a singleton.  It <em>may</em> need to be a single instance if you want to avoid fetching the same data for multiple cache instances; but that does not mean you actually have to <em>expose everything to everyone</em>.</p><p>The first thing I&#39;d do is separate out the different <em>functional areas</em> of the cache into separate interfaces.  For example, let&#39;s say you were making the world&#39;s worst YouTube clone based on Microsoft Access:</p><pre>                          MSAccessCache
                                â–²
                                |
              +-----------------+-----------------+
              |                 |                 |
         IMediaCache      IProfileCache      IPageCache
              |                 |                 |
              |                 |                 |
          VideoPage       MyAccountPage     MostPopularPage
</pre><p>Here you have several <em>interfaces</em> describing the <em>specific</em> types of data a particular class might need access to - media, user profiles, and static pages (like the front page).  All of that is <em>implemented</em> by one mega-cache, but you design your individual classes to accept the interfaces instead, so they don&#39;t care what kind of an instance they have.  You initialize the physical instance once, when your program starts, and then just start passing around the instances (cast to a particular interface type) via constructors and public properties.</p><p>This is called <a href="http://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection</a>, by the way; you don&#39;t need to use Spring or any special IoC container, just so long as your general class design <em>accepts its dependencies from the caller</em> instead of <em>instantiating them on its own</em> or <em>referencing global state</em>.</p><p>Why should you use the interface-based design?  Three reasons:</p><ol><li><p>It makes the code easier to read; you can clearly understand from the interfaces exactly <em>what data</em> the dependent classes depend on.</p></li><li><p>If and when you realize that Microsoft Access wasn&#39;t the best choice for a data back-end, you can replace it with something better - let&#39;s say SQL Server.</p></li><li><p>If and when you realize that SQL Server isn&#39;t the best choice for media <em>specifically</em>, you can break up your implementation <em>without affecting any other part of the system</em>.  That is where the real power of abstraction comes in.</p></li></ol><p>If you want to take it one step further then you can use an IoC container (DI framework) like Spring (Java) or Unity (.NET).  Almost every DI framework will do its own lifetime management and specifically allow you to define a particular service <strong>as a single instance</strong> (often calling it &#34;singleton&#34;, but that&#39;s only for familiarity).  Basically these frameworks save you most of the monkey work of manually passing around instances, but they are not strictly necessary. <strong>You do not need any special tools in order to implement this design.</strong></p><p>For the sake of completeness, I should point out that the design above is really not ideal either.  When you are dealing with a cache (as you are), you should actually have an entirely separate <em>layer</em>.  In other words, a design like this one:</p><pre>                                                        +--IMediaRepository
                                                        |
                          Cache (Generic)---------------+--IProfileRepository
                                â–²                       |
                                |                       +--IPageRepository
              +-----------------+-----------------+
              |                 |                 |
         IMediaCache      IProfileCache      IPageCache
              |                 |                 |
              |                 |                 |
          VideoPage       MyAccountPage     MostPopularPage
</pre><p>The benefit of this is that you never even need to break up your <code>Cache</code> instance if you decide to refactor; you can change how Media is stored simply by feeding it an alternate implementation of <code>IMediaRepository</code>.  If you think about how this fits together, you will see that it still only ever creates one physical instance of a cache, so you never need to be fetching the same data twice.</p><p>None of this is to say that every single piece of software in the world needs to be architected to these exacting standards of high cohesion and loose coupling; it depends on the size and scope of the project, your team, your budget, deadlines, etc.  But if you&#39;re asking what the best design is (to use in place of a singleton), then this is it.</p><p>P.S. As others have stated, it&#39;s probably not the best idea for the dependent classes to be aware that they are using a <em>cache</em> - that is an implementation detail they simply should never care about.  That being said, the overall architecture would still look very similar to what&#39;s pictured above, you just wouldn&#39;t refer to the individual interfaces as <em>Caches</em>.  Instead you&#39;d name them <em>Services</em> or something similar.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../alternatives-to-the-singleton-pattern/'>Alternatives to the singleton pattern</a></li><li class="list-group-item"><a href='../java-how-to-create-a-manager-class-without-global-variables-nor-singletons/'>Java &#8211; How to create a manager class without global variables nor singletons</a></li><li class="list-group-item"><a href='../a-relation-between-dependency-injection-single-instance-and-singletons/'>A relation between Dependency Injection, single instance, and singletons</a></li><li class="list-group-item"><a href='../architecture-react-native-is-using-a-singleton-the-best-alternative-to-di/'>Architecture &#8211; React Native &#8211; Is using a singleton the best alternative to DI</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>