<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Mvc &#8211; .NET MVC project architecture / layering &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1064784 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1064784" class="post-1064784 software type-software status-publish hentry category-software tag-asp-net-mvc tag-design-patterns tag-mvc tag-n-tier tag-repository"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Mvc &#8211; .NET MVC project architecture / layering</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-mvc</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">mvc</span><span class="mr-2 badge badge-primary">n-tier</span><span class="mr-2 badge badge-danger">repository</span></p><div class="entry-content"><p>When planning the architecture for a mid-large scale MVC web application how do you implement the layers to be as decoupled as possible and easy to test? (basically follow best practices) Let&#39;s say I&#39;m using code first as my data access.</p><p>I struggle with what to define &#34;business logic&#34; as, and how it is meant to interact with the data layer. Taking a vehicle sales application as an example, would business logic be classes that performed tasks such as calculating the tax band for given vehicles, comparing mile per gallon statistics etc? As for the business entities (e.g. Cars, Vans, Motorcycles) I would put these in the data layer along with my <code>DataContext</code> class.</p><p>Also what would constitute application logic as opposed to business &#8211; I&#39;m guessing things like session / user input validations?</p><p>So for example, a car controller might return an action/view result that lists the top ten cars filtered by type and best mpg. So let&#39;s say I have an <code>ICarRepository</code> &#39;carRepo&#39; injected into my controller(using the repository pattern / DI), I filter my cars from an action method parameter e.g. <code>var cars = carRepo.getCarsByType(&#34;hatchback&#34;);</code></p><p>So I&#39;ve kept the data access knowledge out of my controller using a repository, now to keep the business logic out of the controller using a domain model &#8211; var result = new MpgCalculator(cars); &#8211; Let&#39;s say I need the calculator class because it needs to perform additional logic to calculate the best fuel efficiency, more than just loading / filtering entities from the DB. So now I have a data set for my view to render that used a repository to retrieve from the data access layer, and domain specific object to process and perform business related tasks on that data.</p><p>Am I making mistakes here? do we still need to use the repository pattern or can I just code against an interface to decouple the ORM and test? On this topic, as my concrete data access classe(s) dbcontext are in the data layer, should the interface definitions go into the domain/business layer meaning that if the data access technology is ever changed, my other layers aren&#39;t effected?</p><p>From what I have studied thus far my structure looks like this:</p><p><strong>MVC Internet Application</strong> -&gt; The standard internet project &#8211; models in here are ViewModels</p><p><strong>Domain/Business layer</strong> -&gt; business specific classes/models that controllers can use to process domain entities from the data layer before passing on to the relevant views</p><p><strong>Repository abstraction necessary?</strong> -&gt; I hear lots of debate on this, especially when using an ORM</p><p><strong>Data layer</strong> -&gt; Entity classes (Car, Van, Motorcycle), DbContext &#8211; Concrete data access technology layer</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You&#39;ve got a lot of moving parts in your question, touching on a lot of concepts, but here&#39;s my basic advice when it comes to how to think about a mid-to-large scale MVC application:</p><p><strong>Presentation &lt;---&gt; Business Logic &lt;---&gt; Data Access</strong></p><p>Firstly, it&#39;s best to <em>not</em> think of the the app as &#34;an MVC application&#34;. It&#39;s an application that uses the MVC pattern as its presentation component. Thinking about it this way will help you separate out your <em>business logic</em> concerns from your <em>presentation</em> concerns. Perhaps it&#39;s ok for small applications to pile everything down to database access into the MVC structure, but it&#39;ll quickly become untenable for a mid-to-large application.</p><p><strong>MVC (Presentation)</strong></p><p>In your app, the ASP.NET MVC component should deal with transforming business data for display purposes (Models), displaying the user interface (Views), and communication issues such as routing, authentication, authorization, request validation, response handling, and the like (Controllers). If you have code that does something else, then <em>it doesn&#39;t belong in the MVC component</em>.</p><p><strong>Repository/ORM (Data Access)</strong></p><p>Also in your app, the data access layer should be concerned with retrieving and storing persistent data. Commonly that&#39;s in the form of a relational database, but there are many other ways data can be persisted. If you have code that isn&#39;t reading or storing persistent data, <em>then it doesn&#39;t belong in the data layer</em>. I shared <a href="https://stackoverflow.com/questions/13180501/what-specific-issue-does-the-repository-pattern-solve/13189143#13189143">my thoughts on the ORM/Repository discussion</a> previously on SO, but to recap, I don&#39;t consider an ORM to be the same thing as a Repository, for several reasons.</p><p><strong>Business Logic</strong></p><p>So now you have your presentation layer (MVC), and your data layer (repository or ORM) ... Everything else is your business logic layer (BLL). All of your code that decides which data to retrieve, or performs complicated calculations, or makes business decisions, should be here. I usually organize my business logic in the form of &#39;services&#39;, which my presentation layer can call upon to do the work requested. All of my domain models exist here.</p><p><strong>Your Approach</strong></p><p>This is where your approach breaks down a little for me. You describe your <em>MVC controller</em> as the place you would get data from the repository, and call upon the MPGCalculator to do some work, etc. I would not have my controller do any of this, but instead would delegate all of this off to a service in the BLL.</p><p>In other words, I would not inject a repository and MPGCalculator into the controller, that&#39;s giving the controller too much responsibility (it&#39;s already handling all of the <em>controller</em> stuff I mentioned above). Instead, I would have a service in the BLL handle all of that, and pass the results back to the controller. The controller can then transform the results to the correct model, and pass that on to the correct view. The controller doesn&#39;t have any business logic in it, and the only things injected into the controller would be the appropriate BLL services.</p><p>Doing it this way means your business logic (for example, <em>given a set of vehicles, calculate the MPG and sort best to worst</em>) is independent from presentation and persistence concerns. It&#39;ll usually be in a library that doesn&#39;t know or care about the data persistence strategy nor the presentation strategy.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../mvc-mobile-development-project-architecture-model-pattern/'>Mvc &#8211; Mobile development project architecture model/pattern</a></li><li class="list-group-item"><a href='../architecture-where-view-models-inside-web-project-of-n-tier-application-should-be-placed/'>Architecture &#8211; Where view models inside Web project of n-tier application should be placed</a></li><li class="list-group-item"><a href='../architecture-understanding-how-layers-are-separated-in-an-mvc-application/'>Architecture &#8211; Understanding how layers are separated in an MVC application</a></li><li class="list-group-item"><a href='../ddd-architecture-in-a-mvc-web-application/'>DDD Architecture in a MVC web application</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>