<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; What to consider when designing a web application that will be deployed under a load balancer &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076430 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076430" class="post-1076430 software type-software status-publish hentry category-software tag-architecture tag-design tag-java"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; What to consider when designing a web application that will be deployed under a load balancer</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">design</span><span class="mr-2 badge badge-warning">java</span></p><div class="entry-content"><p>I am currently maintaining a Java web application that is initially designed to work only as a single instance (not in a cluster/farm). Now, the client is planning to upgrade their infrastructure and part of their plan is to place our web application behind a load balancer.</p><p>I have already identified several serious design problems:</p><ol><li>Users can upload files and our application store those files in the local filesystem.</li><li>There are scheduled jobs that might cause problems when executed concurrently (i.e. generating files).</li><li>Session variables are heavily used in most modules.</li></ol><p> I need opinion on my proposed solutions below.<br /></p><ol><li> I can solve item 1 by storing all files in an external/shared storage (SAN, etc..)</li><li> With item 2, I can create a locking mechanism in the database so when the scheduled jobs run, the web apps will first check the table and only the first one to update will run the said job.</li><li> Actually, I&#39;m still not sure if item 3 can cause problems. If a user logs in to our application and the load balancer directs him to Server 1, is it possible that the load balancer will point him to Server 2 the next time he click a link? I have no idea yet how the load balancer works in this level.</li></ol><p>Also, what are the other things that I should consider when designing a horizontal-scalable web application [from scratch]?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Users can upload files and our application store those files in the local filesystem.<br/> I can solve item 1 by storing all files in an external/shared storage (SAN, etc..)</p></blockquote><p>Storing the common static resources on an external system that is accessible to all is certainly one way to approach the issue of users uploading files that you then have to save.  This cuts down many problems and completely bypasses the ugly issue of trying to do synchronization of local file systems (don&#39;t go down that route, it only leads to madness).</p><hr/><blockquote><p>There are scheduled jobs that might cause problems when executed concurrently (i.e. generating files).<br/> With item 2, I can create a locking mechanism in the database so when the scheduled jobs run, the web apps will first check the table and only the first one to update will run the said job.</p></blockquote><p>Dealing with scheduled jobs that write &#39;static&#39; data, you get into some other ugly situations.</p><p>The first thing to consider is what are they generating?  If they are generating other smallish files, why not store the generated data in the database instead.  This also solves the &#39;locking&#39; problem to a degree (in that it offloads it to the database).  Then, the application would need to read the data out of the database instead of the file system.</p><p>When you go &#34;ewww&#34; when thinking about a heavy oracle database doing this, you might also consider a lighter nosql database.  Using the file system for locking has other problems that make it a bit less desirable.  Using multiple different systems (database and file system) doesn&#39;t quite have the same race conditions (they are other ones to consider), but it also means the two need to stay properly in sync.  The joys of removing database locks when the application terminates improperly.</p><p>Store the generated content in the database, and you should be good.  It makes several things much easier.  Consider things such as records with timestamps and then you just select the most recent time stamp that is done.</p><p>There are other things to think of here, such as having a service on the application servers that will write a file that comes in from a specific client (so your scheduled job pushes the to the application server which writes it to the common file system), or having some messaging system that notifies the application servers of new content in a certain location that triggers an application to pull the data to a local file system.</p><p>There are lots of different ways to approach this for single updates that get pushed to the content area.  This could be the subject of a whole new question itself depending on the specifics of the problem and the constraints of the system.</p><hr/><blockquote><p>Session variables are heavily used in most modules.<br/> Actually, I&#39;m still not sure if item 3 can cause problems. If a user logs in to our application and the load balancer directs him to Server 1, is it possible that the load balancer will point him to Server 2 the next time he click a link? I have no idea yet how the load balancer works in this level.</p></blockquote><p>The key concept you are looking for there is &#39;sticky session&#39;.  It falls under the area of &#39;load balancer persistance&#39;</p><p>In this, the load balancer also is aware of the sessions created and when a session request comes through for one system it will always keep it &#39;stuck&#39; to the application server that generated it.</p><p>This isn&#39;t without its own set of issues (one system goes down, the sessions switch to the other one (you&#39;ve got failover, right?) and then comes back up, but now all the load is <em>stuck</em> to the other server).</p><p>Realize that the exact nature of this support is dependent on the load balancer being used.  Some have their own cookie, some use JSESSIONID and the like, others use ip (and if you&#39;ve got a firewall/proxy of some sort there, it may look like all the requests come from the same ip).</p><p>You may also want to look at an external cache for sessions so they are shared between both machines rather than doing load balancing between them.  Some frameworks have this, or you might look at other caching solutions to go down this route.  Again, possibly a topic of a new question if there is more information on the environment and the constraints as this is getting reasonably long too.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-how-to-you-make-a-cluster-run-a-task-only-once/'>Architecture &#8211; How to you make a cluster run a task only once</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>