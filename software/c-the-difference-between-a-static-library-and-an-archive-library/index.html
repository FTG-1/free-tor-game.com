<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211;  the difference between a static library and an archive library &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074155 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074155" class="post-1074155 software type-software status-publish hentry category-software tag-c tag-compiler tag-libraries tag-static-linking"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211;  the difference between a static library and an archive library</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">compiler</span><span class="mr-2 badge badge-warning">libraries</span><span class="mr-2 badge badge-primary">static-linking</span></p><div class="entry-content"><p>In the comments of a <a href="https://softwareengineering.stackexchange.com/a/369128/149608">recent answer</a>, I equated a static library with an archive of compiled object files.</p><p>The response was that they are not the same, so what is the difference?</p><p>To clarify &#8211; gcc accepts an archive of object files as a library, as per <a href="https://en.wikipedia.org/wiki/Ar_(Unix)#Example_usage" rel="nofollow noreferrer">Ar_(Unix) #Example_usage</a>.  How does this differ from other forms of static library (if any), and what benefits or negatives are there from using these different library types?</p><p>The specific claim was that compiling the source files directly instead of linking with a static library</p><blockquote><p>will result in faster and better code, especially if you turn on Link Time Optimisation.</p></blockquote><p>and</p><blockquote><p>You can make an archive of .o files that have been compiled with -flto but those aren&#39;t really a static library</p></blockquote><p>however if there are other differences, then I welcome answers addressing those.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>A static library is just an <code>ar</code> archive (like zip but ancient) of object files. An object file is the source code that has been compiled to machine code, but hasn&#39;t been linked yet. You can make a static library like this (on Linux/OSX):</p><pre><code># Create a source file containing the single function in our library.
echo &#34;int answer() { return 42; }&#34; &gt; answer.cpp
# Compile it to machine code.
c++ -c answer.cpp -o answer.o
# Compress it into an ar archive.
ar -r libanswer.a answer.o
</code></pre><p>That&#39;s it. The <code>ar</code> format isn&#39;t specific to static libraries at all. You can use it like Zip if you want (but nobody does because it is old and rubbish). There is also one slight improvement you can make which is to add an index to all the symbols in the library which can give a performance improvement when linking. Like this:</p><pre><code>ar -rs libanswer.a answer.o
</code></pre><p>That&#39;s all <code>ranlib</code> does if you&#39;ve ever wondered.</p><p>Anyway - the point about Link Time Optimisation is that it doesn&#39;t create a &#34;real&#34; object file, in the sense that it doesn&#39;t compile to machine code. Take a look:</p><pre><code>$ c++ -c answer.cpp -o answer.o
$ c++ -c answer.cpp -flto -o answer_lto.o
$ file answer.o
answer.o: Mach-O 64-bit object x86_64
$ file answer_lto.o
answer_lto.o: LLVM bitcode, wrapper x86_64
</code></pre><p><code>answer.o</code> is a native Mach-O object file (because I am on Mac; on Linux it will be ELF). But <code>answer_lto.o</code> is not! It&#39;s LLVM bitcode. That hasn&#39;t been compiled to machine code.</p><p>You can put this in an <code>ar</code> archive if you want:</p><pre><code>ar -r libanswer_lto.a answer_lto.o
</code></pre><p>But this isn&#39;t a real static library, and no tools (except Clang) will be able to link with it. GCC could link with <code>libanswer.a</code> but not with <code>libanswer_lto.a</code>.</p><p>I guess you <em>could</em> call <code>libanswer_lto.a</code> a &#34;static library&#34; if you wanted (definitions can change etc.) but if you said &#34;here is a static library&#34; and gave them <code>libanswer_lto.a</code> most people would say &#34;what, no it isn&#39;t&#34;.</p><p>I would call it an LLVM bitcode library or something like that.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/c-are-nested-static-library-dependencies-possible/'>C++ &#8211; Are Nested Static Library dependencies possible</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/the-difference-between-haxe-nme-and-openfl/'>The difference between HaXe NME and OpenFL</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-the-difference-between-string-c_str-and-string0/'>C++ &#8211;  the difference between string.c_str() and &#038;string[0]</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/actually-the-difference-between-the-gnu-c-library-and-the-c-standard-library/'>Actually the difference between the GNU C Library and the C standard Library</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/the-difference-between-a-library-and-a-dependency/'>The difference between a library and a dependency</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>