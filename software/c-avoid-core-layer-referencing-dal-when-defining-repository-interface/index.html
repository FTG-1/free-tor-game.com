<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Avoid core layer referencing DAL when defining repository interface &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085212 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085212" class="post-1085212 software type-software status-publish hentry category-software tag-architecture tag-c tag-entity-framework tag-repository"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Avoid core layer referencing DAL when defining repository interface</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">entity-framework</span><span class="mr-2 badge badge-primary">repository</span></p><div class="entry-content"><p>I&#39;m trying to learn the N-Layer architecture and several other things, and I have a C# solution where I have the following layers:</p><blockquote><ul><li>Core/Infrastructure (Folder)<ul><li>Core (Project)<ul><li>Service interfaces</li><li>Domain models</li><li>Repository interfaces</li></ul></li></ul></li><li>Business Logic Layer (Folder)<ul><li>Services (Project)<ul><li>Different services</li></ul></li></ul></li><li>Data Access Layer (Folder)<ul><li>DatabaseAccess (Project)<ul><li>Entities generated via Entity Framework from existing database</li><li>Different repositories</li></ul></li></ul></li><li>Presentation Layer (Folder)<ul><li>Shell (Project using Prism)</li><li>Different modules (Multiple projects acting as prism modules)</li></ul></li></ul></blockquote><p>Does this setup seem correct?</p><p>It should pretty much mimic the following image:<br /> <a href="../../../i.stack.imgur.com/IDTIy.jpg" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/IDTIy.jpg" alt="enter image description here"/></a></p><p>When structured like this, it seems very loosely coupled, however, an issue arises when I want to define a repository interface for an entity. The issue obviously being that I would have to reference the DAL project in order to use the entity in the interface&#8230; I can&#39;t figure out where I&#39;ve gone wrong or what steps to take to correct this issue.</p><p>The generic repository interface in Core.Repositories:</p><pre><code>public interface IRepository&lt;TEntity&gt; where TEntity : class
{
    TEntity GetByID(int ID);
    IList&lt;TEntity&gt; GetAll();
    IList&lt;TEntity&gt; Find(Expression&lt;Func&lt;TEntity, bool&gt;&gt; predicate);

    void Add(TEntity entity);
    void AddRange(IList&lt;TEntity&gt; entities);

    void Update(TEntity entity);

    void Remove(TEntity entity);
    void RemoveRange(IList&lt;TEntity&gt; entities);
}
</code></pre><p>An example repository interface where said issue would arise (Also in Core.Repositories):</p><pre><code>interface IChildRepository : IRepository&lt;ChildEntity&gt; //In order to use ChildEntity I would have to add a reference to the DAL project
{
    IList&lt;Child&gt; GetAllChildren();
}
</code></pre><p>So in conclusion, should I not be using the repository pattern in this case, or what steps can I take to rectify the issue?</p><p><strong>UPDATE:</strong></p><p>A video I had seen about the repository pattern was somewhat incorrect and was the reason I had an error in my understanding of the pattern and an error in my code. I figured out what the issue was from finding a very nice blog post about the repository pattern.</p><p>I am creating specific repositories, but I&#39;m using the generic repository as a helper, so that I don&#39;t need to repeat stuff like &#34;GetAll&#34;, &#34;Add&#34;, or &#34;Find&#34;.</p><p>When defining my interface I should have done this:</p><pre><code>interface IChildRepository
{
    IList&lt;Child&gt; GetAllChildren();
}
</code></pre><p>And then in my class:</p><pre><code>class ChildRepository : Repository&lt;ChildEntity&gt;, IChildRepository
{
    IList&lt;Child&gt; IChildRepository.GetAllChildren() =&gt; GetAll().ToModels();
}
</code></pre><p>Obviously I need to repeat some code like &#34;GetAllChildren&#34;, &#34;GetAllParents&#34;, &amp; etc. &#8211; I guess I&#39;ll just have to live with that.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Its correct. but your repositories should return business objects, not database &#39;entities&#39;</p><p>Secondary point. Generic repositories are somewhat frowned upon. Its best to have specific repositories with methods that allow you to make full use of the database to retrieve the exact data you need.</p><p>Simplified diagram</p><ul><li>Models and Interfaces (core) no dependencies</li><li>Repository, references Models</li><li>App (presentation layer?), references Models and Repository</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-is-there-a-real-advantage-to-generic-repository/'>C# &#8211; Is There a Real Advantage to Generic Repository</a></li><li class="list-group-item"><a href='../c-confused-on-how-to-properly-employ-a-repository-pattern-with-service-business-layer-on-top/'>C# &#8211; Confused on how to properly employ a Repository Pattern with Service/Business Layer on top</a></li><li class="list-group-item"><a href='../c-repository-pattern-exposing-data-context-to-underlying-layers/'>C# &#8211; Repository Pattern: Exposing Data Context to Underlying Layers</a></li><li class="list-group-item"><a href='../c-architecture-how-to-pass-models-between-controllers-services-and-repositories/'>C# &#8211; Architecture: How to pass models between controllers, services and repositories</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>