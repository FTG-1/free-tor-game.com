<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Php &#8211; How to define Domain Objects and Repositories, when dealing with multiple database tables &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086203 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086203" class="post-1086203 software type-software status-publish hentry category-software tag-domain-objects tag-dto tag-php tag-repository"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Php &#8211; How to define Domain Objects and Repositories, when dealing with multiple database tables</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">domain-objects</span><span class="mr-2 badge badge-info">dto</span><span class="mr-2 badge badge-warning">PHP</span><span class="mr-2 badge badge-primary">repository</span></p><div class="entry-content"><p>Imagine an application that allows you to add line items to a quote.  The end result is like a sales person giving you a printed sheet with information such as name of the business, name of the sales person, and various service line items printed on the quote along with pricing, description, and quantity.</p><p>To implement this on the database level I have tables <code>Item</code> (holds 0-to-many items per Quote) and <code>QuoteMeta</code> (holds quote meta-information like who created the quote, quote number, revision, status, etc).</p><p><a href="../../../i.stack.imgur.com/lKFoA.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/lKFoA.png" alt="enter image description here"/></a></p><p>Then I have a domain object called <code>Quote</code>, which is not aware of the database layer directly, but receives data from both <code>Item</code> and <code>QuoteMeta</code>.  The <code>Quote</code> is the &#34;quote sheet&#34; described previously.</p><p>My question is how to handle this domain object when I have more than one table representing it internally.  For example, with my <code>Quote</code> domain object I can do something like &#8230;</p><p><strong>Single Repository, Single Domain object</strong></p><pre><code>//Repository populates $quote from both database tables
$quote = (new QuoteRepository())-&gt;getQuoteById($id);

$quote-&gt;getQuoteNumber(); //gets data from quote metadata table
$quote-&gt;getItemByLineNumber(5); //gets an item from items table
</code></pre><p>The above &#34;marries&#34; the tables into the one domain Quote object. <code>QuoteRepository</code> handles queries directed to and from both database tables.  My question is .. can I do this?</p><p>For example, will it be better to keep concepts separate, maybe like so?</p><p><strong>Multiple Repositories, Multiple domain objects</strong></p><pre><code>//repository strictly deals with quote meta data
$quoteMeta = (new QuoteMetaRepository())-&gt;getQuoteMetaById($id);
$quote-&gt;getQuoteNumber();

//repository strictly deals with item handling
$items = (new ItemRepository())-&gt;getItemsByQuoteId($id);
$items-&gt;getItemByLineNumber(5);
</code></pre><p>Here the concerns are more separated, but I have complexity of dealing with multiple objects, when physical Quote representation is typically understood to be the items + quote metadata merged together.  You don&#39;t have just items without metadata, and there is little point in having metadata without service items.</p><p>That said, is preferred to keep repositories separate, or together?  And if separate, how do I handle things like table JOINs that operate on both tables?  Which repository do they go to?</p><p><strong>Dealing with multiple tables</strong></p><p>To shift gears a bit, I have some code purpose of which is to delete an Item.  An item record is deleted from the table.  Then references to other data that are tied to the Item are deleted from 5 other tables (things like graphs, design, etc, and other data that belongs to the item).  Should this &#34;Item Deletion&#34; be a single handler method that deletes data from multiple tables directly in the place of one method, or should each table have their own respective Repository handler class and method, and I can call each handler to delete their portion of the item?</p><p>Also, in the example where I delete the item, I am not really touching much of <code>QuoteMeta</code> table or entity.  Thus I may only use the <code>ItemRepository</code> handler by itself, which makes me lean towards separate repositories in this case.</p><p><strong>Notes on ORM</strong></p><p>In my codebase I am using an ORM, where I have entities, such as <code>Item</code> Entity corresponds to <code>item</code> table, and <code>QuotaMeta</code> corresponds to <code>quote_meta</code>.  The focus of my question though is not on an ORM.  ORM provides a convenient way to populate my entities from tables, but without ORM I&#39;d either be populating Entities anyway (i.e. via <code>mysqli_fetch_object</code>), or I&#39;d be using arrays.  The question still stands &#8212; how do I model my domain objects and corresponding repositories?  Do I &#8230; have one per table, or do I go to a higher level of abstraction, to where I operate on multiple tables per single domain/repository?</p><p><strong>Final Thoughts..</strong></p><p>To be super-specific, do I have a <code>Quote</code> domain object that operates on both tables, or do I have separate <code>ItemGroup</code> and <code>QuoteMeta</code> objects, where one manages items that belong to the Quote but doesn&#39;t care about the metadata, and one manages Quote metadata, without the dealing with items that belong to it?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your first approach is basically creating an ORM. If ORM is what you are after then go with it, but remember that objects from the ORM do not and should not represent your domain - ie. the layer enforcing your business rules presented by the stakeholders. They are objects which understand persistence and as such they should not contain business rules, because that would be breaking of the Single Responsibility Principle, which is not a rule to blindly follow but which greatly increases code readability.</p><p>With that in mind, your domain layer not working with ORM objects, you would need to transform the ORM objects to your domain objects anyway, which seems kind of pointless.</p><p>I greatly favor the direct repository approach, as it very clearly states what each object does:</p><ul><li>a <strong>domain object</strong> represents a domain entity,</li><li>a <strong>repository</strong> is used to provide an abstraction to CRUD operations on a domain object.</li></ul><p>You have a domain object and want more data related to it, then use a service which knows how to communicate with outer world, in this case the persistence layer.</p><hr/><p>Also, completely avoiding ORM when querying the database lifts the constraint that you need to use the ORM objects, which you don&#39;t. Many times you need different representations of the same entity, for different purposes, and for that you can sometimes use even very simple DTOs. This makes it easier to construct such objects, leaves less memory footprint and generally makes the applications faster, because you can specifically craft queries to reduce the number of times you need to go from the application server to the database server and back.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-are-we-using-the-repository-pattern-right/'>C# &#8211; Are we using the repository pattern right</a></li><li class="list-group-item"><a href='../should-a-domain-object-wrap-contain-a-dto-interface/'>Should a domain object wrap/contain a DTO interface</a></li><li class="list-group-item"><a href='../repository-pattern-vs-dao-managing-entities/'>Repository pattern vs DAO managing Entities</a></li><li class="list-group-item"><a href='../mvc-when-to-create-an-in-memory-object-to-manage-repository-records/'>Mvc &#8211; When to create an in-memory object to manage repository records</a></li><li class="list-group-item"><a href='../c-the-purpose-of-domain-business-logic-in-classes-when-having-repositories/'>C# &#8211;  the purpose of domain/business logic in classes when having repositories</a></li><li class="list-group-item"><a href='../what-data-should-a-repository-return/'>What data should a repository return</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>