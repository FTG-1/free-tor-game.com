<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Overall view validation with a datagrid and keeping to MVVM &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071640 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071640" class="post-1071640 software type-software status-publish hentry category-software tag-c tag-mvvm tag-validation tag-wpf"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Overall view validation with a datagrid and keeping to MVVM</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">mvvm</span><span class="mr-2 badge badge-warning">validation</span><span class="mr-2 badge badge-primary">wpf</span></p><div class="entry-content"><p>I am struggling to find a good architecture for what must be a common problem</p><blockquote><p>Enable/Disable a button in a View that contains a datagrid, and has<br /> validation requirements on the cell, row and collection  levels. And to perform this cleanly in a MVVM architecture.</p></blockquote><p>If it wasn&#39;t for the datagrid then this would be easy, I&#39;d just check the overall result of either an <code>INotifyDataErrorInfo</code> or <code>IDataErrorInfo</code> implementation on the ViewModel and use existence of any errors to disable the button via the <code>ICommand</code> interface to the button, that resides in the ViewModel.</p><p>However the data grid complicates things, and I find myself going back and forth between doing data validation in the ViewModel or in the View itself.  EG:</p><ol><li><p>Validation in the ViewModel keeps the validation closer to the datasource and I can implement <code>INotifyDataErrorInfo</code> on each item in the collection.  This enables me to validate on a cell and row level, but there appears to be no support for validating against the overall collection itself &#8211; and I have yet to find a decent solution that can do this (see link below).  (And I don&#39;t want to pollute the items in the collection by adding some reference to an external entity to them).</p></li><li><p>Validation in the View itself (using validation rules on the datagrid) allows me to validate on the cell, row and collection level<sup>1</sup>, but I can&#39;t see how to communicate the presence of errors to the ViewModel as nothing is passed back to the ViewModel unless it <em>is</em> valid.</p></li></ol><p>The closest solution I have seen online that solves all of my problems is this 2014 TechNet one &#8211; <a href="https://social.technet.microsoft.com/wiki/contents/articles/22660.data-validation-in-mvvm.aspx" rel="nofollow noreferrer">Data Validation in MVVM</a></p><p>But it is as ugly as ugly can get<sup>2</sup>.  To quote from that page (emphasis mine):</p><blockquote><p>The Most Important thing is to disable the Save button when the form<br /> is invalid. For this we had a <strong>static property</strong> in our view model named<br /> Errors. When the Error is occurred the Error count is increased by 1.<br /> When the error is corrected the error count is decreased by 1. So when<br /> the Count is 0 the save will be enabled or disabled.</p></blockquote><p>The author&#39;s solution is put a static counter on the ViewModel and set a call back in the View itself. When an error is detected in the ViewModel the <code>IDataErrorInfo</code> interface passes that information up to the View which then increments the counter on the ViewModel, and the value of the counter is use to disable the button.</p><p>In addition, to perform validation on a collection level, they implement another static variable on the ViewModel which is set to the instance of the collection in the current ViewModel.  Thus an item validates itself against the entire collection by finding the collection from this static variable.</p><p>This code makes me cringe.</p><p>So what am I missing?  How can I easily, cleanly, and keeping to strict MVVM guidelines, perform validation of an overall ViewModel that requires validation of a data grid at the cell, row and collection levels?  And communicate the results of that validation back to the ViewModel itself?</p><hr/><p><sup>1 In order to perform validation at the collection level using ValidationRules I created a custom rule as per this SO question <a href="https://stackoverflow.com/a/10555571/31326">https://stackoverflow.com/a/10555571/31326</a> that injects the binding source of the data grid into the rule.  This cleanly allows you to do validation at the collection level.</sup></p><p><sup>2 According to the comments at the bottom of that link, this article won prizes!</sup></p><hr/><p><strong>Update</strong></p><p>I am going with a modified version of Emerson&#39;s answer.  I am going to keep the internal validation within the object view model, but inject in a validation test for doing collection level validation.  The following code lays out my ideas.  This code seems to work (and probably could be optimised), but I am not sure if I am going to hell for it ðŸ˜€</p><pre><code>// Base of all view models 
// Handles property notification and error notification
public abstract class ViewModelBase&lt;T&gt; INotifyPropertyChanged, INotifyDataErrorInfo :  where T : class
{
    // Validate view model against external sources
    // Return a list of errors
    protected Func&lt;T, List&lt;String&gt;&gt; ExternalValidate = null;

    // Rest of INotifyPropertyChanged and INotifyDataErrorInfo implementation etc.
    protected void AddError(string error, [CallerMemberName] string propertyName = null)
    {
      INotifyDataErrorInfo.AddError(error, propertyName);
    }

    protected void AddError(List&lt;string&gt; errors, [CallerMemberName] string propertyName = null)
    {
      foreach(var error in errors)
      {
        INotifyDataErrorInfo.AddError(error, propertyName);
      }
    }
}

// The Product data model
public class Product
{
  public int Number { get; set; }
}

// Adapts a Product Data/Domain model to a view model
// Does all the error checking for the view model both within and external to this one object
public class ProductViewModel : ViewModelBase&lt;ProductViewModel&gt;
{
  public int Number
  {
    get { return _Number; }
    set 
    {
      // Validate &#34;value&#34; against other properties in *this* view model 
      if (value&lt;0) AddError(&#34;can&#39;t be negative&#34;); 

      // Validate against **External** values
      if (ExternalValidate != null)
      {
        var errors = ExternalValidate(this);
        if (errors != null) AddError(errors);
      }
    }
  }
  protected int _Number;

  public ProductViewModel(Func&lt;ProductViewModel,List&lt;string&gt; externalValidate, Product product)
  {
    // The external validation check
    ExternalValidate = externalValidate

    // Initialize PVM from product
    _Number  = product.Number;
  }
}

// Holds the collection of ProductViewModel objects
// Defines the collection level validation rules
// Injects those rules into the ProductViewModel objects
// The key thing is capturing the values in the Func.
public class MainVM()
{
  public int TheAnswer {get; set; } = 42;

  public List&lt;ProductViewModel&gt; PVMS = new List&lt;ProductViewModel&gt;();

  Func&lt;ProductViewModel, List&lt;string&gt;&gt; ExternalTest = (ProductViewModel pvm) =&gt;
  {
    var result = new List&lt;string&gt;();
    foreach(var pvms in PVMS)
    {
      if (!Object.ReferenceEquals(ppm,pvms)
      {
        if (ppm.Number == pvms.Number)
        {
          result.Add(&#34;Can&#39;t have duplicates&#34;);
        }
      }
    }

    if (pvm.Number == TheAnswer) 
    {          
      result.Add(&#34;Can&#39;t equal the answer&#34;);
    }

    return result.Count&gt;0 ? result : null;

  }

  List&lt;Product&gt; products = GetProductsFromSource();

  foreach(var product in products)
  {
    PVMS.Add( new ProductViewModel(ExternalTest, product) );
  }
}
</code></pre><p>In the above code, whenever the <code>Number</code> property of the <code>ProductViewModel</code> is set, the class will validate within itself and then call the external validation.  If the Number is duplicated or set to the current value of <code>TheAnswer</code> then an error message will be generated.</p><p>The jumping through hoops to get to this means that my <code>ProductViewModel</code> does not know that it is a part of a collection and simply validates itself against some externally defined set of conditions. These external conditions could be anything, such as iterating over the collection and looking for duplicate values, or in this case checking that the <code>Number</code> property doesn&#39;t equal some particular value.</p><p>And by placing the conditional check in an generic base class this code is reusable.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Supposing you have a Product class, each product shouldn&#39;t know about other products in the list.</p><p>In your GUI, I suggest you use a ProductViewModel, responsible to validate all info. Therefore, there&#39;s no problem in making the ProductViewModel to have knowledge of other instances of the same type in its parent collection. After all validation succeeds, you could generate a collection of Product if necessary.</p><p>Here&#39;s some code trying to illustrate my suggestion:</p><p><strong>Your data entity class</strong></p><pre class="lang-cs prettyprint-override"><code>public class Product {
    public int Id {get;set;}
    public string Name {get;set;}
}
</code></pre><p><strong>Your view model (responsible to validate everything)</strong></p><pre class="lang-cs prettyprint-override"><code>//Represents the view model for the Product.
//This view model is responsible for validating information of the product.
//As part of  this validation, it is necessary that this instance know
//details of the collection it belongs.
public class ProductViewModel : INotifyDataErrorInfo {

    //This could be injected via constructor or property.
    //Represents the collection of products, that requires validation
    //See its definition below
    private ProductViewModelCollection parentCollection;

    public int Id { 
        get { return _id; }
        set { if (ValidateId(value))) _id = value; }
    }
    public string Name {
        get { return _name; }
        set { if (ValidateName(value)) _name = value; }
    }

    //The methods below validate all info.
    //Alternatively, you could implement the validation somewhere else, 
    //and inject the necessary validators into this viewModel instance.
    private bool ValidateId(int id) { 
        //... validate the id...

        foreach (ProductViewModel otherProduct in parentCollection) {
            //...if necessary, perform additional validations comparing
            //with other products in the parent collection
        }
    }
    private bool ValidateName(string name) { 
        //... validate the name...

        foreach (ProductViewModel otherProduct in parentCollection) {
            //...if necessary, perform additional validations comparing
            //with other products in the parent collection
        }
    }

    //...implementation of INotifyDataErrorInfo...
}
</code></pre><p><strong>Your collection of products, it is the source for the datagrid</strong></p><pre class="lang-cs prettyprint-override"><code>public class ProductViewModelCollection : ObservableCollection&lt;ProductViewModel&gt;, IINotifyDataErrorInfo {
    //...implementation of INotifyDataErrorInfo...
}
</code></pre><p>After this, you won&#39;t need to use built-in validation of UI components; you can implement everything in the view model, being able to unit test it accordingly. The knowledge across collection is implemented in the ViewModel (because your GUI requires it), not within your data entity.</p><p><strong>UPDATE: Second approach (via injection):</strong></p><pre class="lang-cs prettyprint-override"><code>//Represents the view model for the Product.
//This view model is responsible for validating information of the product.
//As part of  this validation, it is necessary that this instance know
//details of the collection it belongs.
public class ProductViewModel : INotifyDataErrorInfo {

    //Injected via constructor or property.
    private IProductValidator validator;

    //String properties, IF YOUR GUI ALLOWS user to type
    //text in the fields
    public string Id { 
        get { return _id; }
        set { if (validator.ValidateId(value))) _id = value; }
    }
    public string Name {
        get { return _name; }
        set { if (validator.ValidateName(value)) _name = value; }
    }

    public Product GetProduct() {
        //...generate Product object with valid info...
    }
}

public class ProductValidator : IProductValidator {

    //This could be injected via constructor or property.
    //Represents the collection of products, that requires validation
    //See its definition below
    private ProductViewModelCollection parentCollection;

    //The methods below validate all info.
    //Alternatively, you could implement the validation somewhere else, 
    //and inject the necessary validators into this viewModel instance.
    private bool ValidateId(string id) { 
        //... validate the id...

        foreach (ProductViewModel otherProduct in parentCollection) {
            //...if necessary, perform additional validations comparing
            //with other products in the parent collection
        }
    }
    private bool ValidateName(string name) { 
        //... validate the name...

        foreach (ProductViewModel otherProduct in parentCollection) {
            //...if necessary, perform additional validations comparing
            //with other products in the parent collection
        }
    }

    //...implementation of INotifyDataErrorInfo...
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-how-to-make-creating-viewmodels-at-runtime-less-painful/'>C# &#8211; How to make creating viewmodels at runtime less painful</a></li><li class="list-group-item"><a href='../mvvm-viewmodel-and-commands/'>MVVM ViewModel and Commands</a></li><li class="list-group-item"><a href='../c-best-way-of-validating-class-properties/'>C# &#8211; Best way of validating Class properties</a></li><li class="list-group-item"><a href='../mvc-usage-of-mvvm-in-ios/'>Mvc &#8211; Usage of MVVM in iOS</a></li><li class="list-group-item"><a href='../c-how-to-avoid-double-data-validation-in-an-application-with-web-interface/'>C# &#8211; How to avoid double data validation in an application with web interface</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>