<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; How to store and validate data between state transitions &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081566 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081566" class="post-1081566 software type-software status-publish hentry category-software tag-architecture tag-finite-state-machine tag-state tag-transition"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; How to store and validate data between state transitions</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">finite-state machine</span><span class="mr-2 badge badge-warning">state</span><span class="mr-2 badge badge-primary">transition</span></p><div class="entry-content"><p>I&#39;m developing a largeish application that will have custom finite state machines. That is, the admin users of the application will be able to create their own state machines, limited by little pieces of code that are pr√© built, lets call those tasks.</p><p>OK that is all fine and we are reaching a place where we think its going to work.</p><p>The big question is, depending on the tasks involved, we will need to force user to input a certain data.</p><p>For example, there is a certain fsm that will merge parcels. For that to happen, we need at least two input parcels and some data on the new resulting parcel.</p><p>How can we:</p><ol><li><p>Store the data we need, which will be different, depending on the fsm and the tasks it will perform? I was thinking a big json blob.</p></li><li><p>Validate it, without going insane.</p></li></ol><p>Background: Django, marionette js, Django rest Framework and PostgreSQL.</p><p>Async tasks and state changes with celery.</p><p>I&#39;m asking this because I dont want to have many many fixed models tied up to a certain validation. That will eventually lead to a high number of tables and it will be harder to maintain. (And that why i suggested a json Field for storing all the data for each state, validate it, and if its all good, transition to the next state).</p><p>PS: Sorry for bad formatting. Using my phone without proper keyboard.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I&#39;d go one of two ways depending on the exact implementation details.</p><p>(Apologies, I&#39;m not familiar with Django, so my answer speaks generically about the architecture and doesn&#39;t have specific suggestions for the language you&#39;re using)</p><p><strong>1. JSON fields for data using Single Table Inheritance</strong></p><p>As you suggested, I&#39;d put the data in JSON(B) fields in Postgres. I&#39;d validate by subclassing (or similar) the Tasks model using Single Table Inheritance (STI).</p><p>A quick google suggests that Django might not do STI natively, but you could get a simple enough version working by adding, say, a <code>type</code> column to your tasks table and use that to dynamically load the class that contains your validations for that type of task.</p><p>Pros</p><ul><li>Expressive - your validation rules are as flexible as the language</li><li>Simple - Easy to get up and running with</li></ul><p>Cons</p><ul><li>Awkward to scale - If you have lots of different types of tasks, this could get out of hand for maintenance.
(This can be mitigated by grouping similar tasks to use the same validation class)</li><li>Developer dependent - any changes to validation or adding new tasks requires a developer</li></ul><p><strong>2. Store validation also in JSON</strong></p><p>Have a second table storing your task types that uses JSON schema to describe the attributes and validation of a task</p><p>Pros</p><ul><li>Standard Tools - If you use JSON schema there&#39;d be standard libraries you could work with to validate the tasks</li><li>Easier to Scale - Just add a new kind of task to your task type table</li></ul><p>Cons</p><ul><li>May be a bit slower - A little bit more involved to develop initially</li><li>Less Expressive - JSON schema is not a programming language, so it&#39;s not as expressive for defining rules (but in practice it would be good enough for most cases)</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../object-oriented-can-an-object-oriented-program-be-seen-as-a-finite-state-machine/'>Object-oriented &#8211; Can an object oriented program be seen as a Finite State Machine</a></li><li class="list-group-item"><a href='../how-to-recover-from-finite-state-machine-breakdown/'>How to recover from finite-state-machine breakdown</a></li><li class="list-group-item"><a href='../communication-between-state-machines-with-hidden-transitions/'>Communication between state machines with hidden transitions</a></li><li class="list-group-item"><a href='../should-i-use-multiple-state-machines-for-a-layered-protocol/'>Should I use multiple state machines for a layered protocol</a></li><li class="list-group-item"><a href='../so-what-exactly-is-a-final-state-of-a-finite-state-machine/'>So what exactly is a final state of a finite state machine</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>