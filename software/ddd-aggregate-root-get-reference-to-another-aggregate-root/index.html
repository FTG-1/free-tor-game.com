<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>DDD &#8211; Aggregate Root get reference to another Aggregate Root &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086775 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086775" class="post-1086775 software type-software status-publish hentry category-software tag-aggregate tag-domain-driven-design tag-invariants"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">DDD &#8211; Aggregate Root get reference to another Aggregate Root</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aggregate</span><span class="mr-2 badge badge-info">domain-driven-design</span><span class="mr-2 badge badge-warning">invariants</span></p><div class="entry-content"><p>I have 3 ARs:</p><ul><li>Student</li><li>Guardian</li></ul><p><strong>Business Rule</strong>:</p><ul><li>Student <strong>should have at least 1</strong> authorized Guardian<br /> Entities should not be in an invalid state right?</li></ul><p>Right now I enforced the invariant in my <code>Student</code> constructor:</p><pre><code>public function __construct(StudentId $id, Name $name, Guardian ...$guardians) {

  if ( $this-&gt;hasNoAuthorizedGuardian(...$guardians) ) {
      throw new NoAuthorizedGuardianException();
  }

  // initialized fields
}
</code></pre><p>However, while creating the repository part for my Student AR,  I encountered a problem of fetching the &#34;required&#34; guardians for it.</p><pre><code>class StudentRepository {
    public function getById(StudentId $id): Student {
        // other lines omitted for brevity
        return new Student($id, $name, ...$guardians);
    }
}
</code></pre><p>I came up with these questions in mind:</p><ul><li><p>Should I reference <code>GuardianRepository</code> inside <code>StudentRepository</code>? I feel like the answer is no, but I&#39;m new to DDD so it might be valid</p></li><li><p>Should ARs be allowed to have reference to Repositories instead? I feel like the answer to this is also no, but like I said I&#39;m new to DDD so this might be valid.</p></li><li><p>Did I enforce my invariant properly? Or should I put it in Domain Service so that I don&#39;t need to fetch the related entities in a single Repository?</p></li></ul><p>Doing the second approach will let me do this:</p><pre><code>class StudentService {

    public function getById(StudentId $id) {
        $student = $this-&gt;studentRepo-&gt;getById($id);
        $guardians = $this-&gt;guardianRepo-&gt;getByStudentId($id);

        $student-&gt;guardians(...$guardians);

        return $student;
    }

}
</code></pre><p>Cons of doing that though is my entities will become an Anemic Domain Entity since I transferred the invariant to another layer.</p><p>Another possible solution I came up with is Lazy Loading but I&#39;m not sure how to do that including when and how to fetch the related entities.</p><p><strong>TL;DR</strong>: If your root entity requires a reference to another root entity, how can you get it?</p><p><strong>EDIT</strong>:</p><p>For clarification, I did not mention that Guardian has its own entities like Contacts and some other Value Objects. I think it&#39;s enough for it to be considered an AR because it should be the one that manage them.</p><p>Student-Guardian reference here is a Bounded Context I guess that I just learned now.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It&#39;s totally fine for Entities to be in an &#39;invalid&#39; state according to business rules such as &#39;Students must register a guardian or we cant legally enrol them&#39;</p><p>These rules are subject to change and exceptional cases. You want to flag such cases as breaking the rules, rather than make it impossible for your program to instantiate an object of that type.</p><p>In this case your application can simply reference both AR repositories, ARs can have a sudentId/guardianId property that you can look up, or you can have the relationship in a separate service.</p><p>Now, if the &#39;invalidness&#39; is not simply a business rule, but inherent to the nature of the Entity, such as, I don&#39;t know, Cats have 0-4 Legs and Cat.Speed depends on the exact number. Then Leg Should be part of the Cat AR.</p><p>If a Cat has 5 Legs then Cat.Speed will cause the program will crash, If I change the number of Legs on a cat then its Speed should automatically update or I will get the wrong output from my program etc.</p><p>Putting Cat and Legs in separate ARs would be problematic, Cat.Speed would have to call the LegRepo before returning a result, I could add a Leg without updating the Cat&#39;s speed etc.</p><p>You will have to decide which case your Student and Guardian fall into. Should you have a single AR so you can have <code>Student.RemoveGuardian(id)</code> and enforce not allowing the removal of the last guardian.</p><p>Or would it be more sensible to have <code>GuardianRemovalService.RemoveGuardian(studentId,guardianId)</code> which can also enforce the rule, but allows the possibility of another application removing the guardian directly from the GuardianRepo without following the business rule?</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../object-oriented-ddd-is-it-correct-for-a-root-aggregate-to-hold-a-reference-to-another-root-aggregate/'>Object-oriented &#8211; DDD: is it correct for a root aggregate to hold a reference to another root aggregate</a></li><li class="list-group-item"><a href='../java-updating-nested-objects-in-ddd-aggregate-by-example-delegation-or-direct-access-from-the-root/'>Java &#8211; Updating nested objects in DDD Aggregate by example: delegation or direct access from the root</a></li><li class="list-group-item"><a href='../architecture-balance-between-aggregate-boundaries-and-domain-consistency-in-ddd/'>Architecture &#8211; Balance between aggregate boundaries and domain consistency in DDD</a></li><li class="list-group-item"><a href='../c-ddd-identifying-aggregate-root-in-a-simple-example-application-domain/'>C# &#8211; DDD: Identifying aggregate root in a simple example application domain</a></li><li class="list-group-item"><a href='../ddd-is-an-aggregate-root-responsible-for-deleting-its-child-entities-from-their-repository/'>DDD: Is an aggregate root responsible for deleting its child entities from their repository</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>