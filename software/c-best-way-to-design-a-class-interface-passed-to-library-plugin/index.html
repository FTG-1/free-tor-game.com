<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Best way to design a class interface passed to library/plugin &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073941 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073941" class="post-1073941 software type-software status-publish hentry category-software tag-c tag-interfaces tag-libraries tag-plugins"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Best way to design a class interface passed to library/plugin</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">interfaces</span><span class="mr-2 badge badge-warning">libraries</span><span class="mr-2 badge badge-primary">plugins</span></p><div class="entry-content"><p>I have an application comprising a bootstrapper executable, a core library and several plugins (shared libraries). The core library is implicitely linked to all components, the plugins get linked/loaded explicitely by the core library. When the plugins functions get called, I pass several objects defined in the core library. Now I ask myself which is the best way to design the interface of these classes.</p><p>There are three ways I can think of.</p><ol><li>Design a simple class and pass it. This is the current approach, but the interface is messy because the core needs additional functions on this object, currently realized with friend relationships and private access modifier so that the clients/plugnis cant access it. I think this is the worst approach since the client interface is really ugly.</li><li>Create an ABC (interface) and add the core functionality in the concrete subclass and pass the object as the ABC to the plugins. This looks fine, but somehow I am not sure if this is good design since on the one hand interfaces are not really a C++ concept and theres only one class that inherts the ABC (seems like a smell to me) and on the other hand the compiler complains about weak vtables emitted in all TUs. (I tried but I dont get this)</li><li>Create a mediator/facade class and hide the interface needed by the core library. The con in this approach beeing the extra indirection.</li></ol><p>Would be nice if somebody could complement this list and elaborate the pros and cons of the approaches. Finally if it is possible I&#39;d appreciate a recommendation. Thank you.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Of those three, number 2 is the way to go: introduce an interface. Classes with pure virtual functions are a legitimate C++ concept. The language supports interfaces even though it has no special syntax for them.</p><p>The problem with your first suggestion (design a simple class) is that any change to the declaration of the class breaks binary compatibility, so all your plugins would have to be recompiled with the new version. In particular, adding, removing, or reordering members could break binary compatibility, even for private members. There are very few changes you can safely make to a <code>.h</code> file. It is therefore important to keep any unnecessary information out of your headers.</p><p>One such technique is to use polymorphism: define an interface that exposes a set of virtual methods, and an implementation that inherits from the interface. Since clients will only depend on the interface, any changes to the implementation are safe. This is basically the solution number 2 you&#39;ve sketched out. The drawback is that polymorphic objects need reference semantics: you must pass them by reference or by pointer, and such types are not copy-constructible or copy-assignable.</p><p>A similar solution is to use incomplete types (pImpl idiom). In a header file, a class is declared with various methods. It only has a single member, which is a pointer to an incomplete type (usually with <code>std::unique_ptr&lt;â€¦&gt;</code>).  In a .cpp file, the incomplete type is declared and defined. This declaration is not accessible outside of the cpp file. This private type contains all implementation details, especially all member fields. Also within this file, we delegate all public methods to the private implementation. Since the private type is known, such types can also be made copy-constructible and copy-assignable.</p><p>In both of these cases, we&#39;ve inverted our dependencies so that client code will not depend on implementation details. As the interface will usually be very stable, the client code will only need to be recompiled when the interface actually changes.</p><pre><code>                 +-----------+
           .---&gt; | Interface | &lt;---.
depends on |     +-----------+     | depends on
           |                       |
   +----------------+         +--------+
   | Implementation |         | Client |
   +----------------+         +--------+
</code></pre><p>For polymorphism, the interface is an abstract base class with pure virtual methods, the implementation another class. For pImpl, the interface is a .h file with an incomplete type, and the implementation is a compilation unit containing the definition of the incomplete type.</p><p>In general, using the pImpl idiom is easier and more flexible than using inheritance.</p><p>But with regards to your goal of making more parts of the implementation visible to your internal code than to the clients, a clear interface will probably be less confusing.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-design-pattern-for-polymorphic-behaviour-while-allowing-library-separation/'>C++ &#8211; Design pattern for polymorphic behaviour while allowing library separation</a></li><li class="list-group-item"><a href='../java-interface-design-of-java-library-with-interdependent-yet-decoupled-packages/'>Java &#8211; Interface design of Java library with interdependent yet decoupled packages</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>