<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Find if certain files have been added or removed in large directory structure &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078164 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078164" class="post-1078164 software type-software status-publish hentry category-software tag-c tag-files tag-qt"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Find if certain files have been added or removed in large directory structure</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">files</span><span class="mr-2 badge badge-warning">qt</span></p><div class="entry-content"><p>I have a larger directory structure (dir + sub directories) with files. It contains files of certain types. For one particular type (let&#39;s say with appendix <code>.foo</code>) I need to figure out if files have been added, changed or <strong>deleted</strong>.</p><p>The first approach was to iterate over all files and check the timestamp of the files. It works pretty ok for local files, but once they reside on a network file system it gets too slow.</p><p>And, in order to detect deleted files I have to create and index anyway. One idea is to create hash values for the relevant files and store them per directory. Unfortunately the normal case is that nothing changes most of the time, yet I still have to recalculate all hash values (slow) just to detect nothing changed.</p><p>Remark: I am coding in Qt 5.6/C++ and code has to work on Windows, Mac, and Linux, but the question`s focus is more the concept and not working code.</p><p>&#8212; edit &#8212;</p><p>Some clarifications (as asked below)</p><ul><li>it is about files for flight simulation. When the user adds or changes files I have to rerun some tasks like parsing those files. The <code>foo</code> files are special files I care about, while the 10000s other flight simulator files can be ignored. My goal is to find out if I have to start the expensive parsing process, which is only required if any <code>foo</code>file changed</li><li>there is indeed something like a monitor watching changed files in Qt <code>QFileSystemWatcher</code> . But I cannot guarantee to monitor all the time, also it would not be needed. When I start my software I need to find out if any <code>foo</code>file changed, if so I start parsing, otherwise skip this step.</li><li>There are some 100 up to 10000 <code>foo</code> files within a directory structure of &gt;50000 files</li><li>The files change because the user installs new features or maybe deletes some. This happens while my software is not running, I already said I cannot monitor all the time. So I need something which works after I have started my software</li><li>There is no client / server and it needs to work on Linux, Mac and Windows (but that was already mentioned in the original post)</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>If possible, have such monitoring happen <em>close</em> to disk. In particular, avoid monitoring remote file systems. Make the monitoring program run on the file server instead. The monitoring thing might not need to have a Qt interface (in other words, if you need a Qt interface, make it a separate executable communicating with the monitor). Perhaps the monitor might be queryable thru HTTP (by using some HTTP server library like libonion in it).</p><p>On Linux with local genuine file systems like Ext4, you could use <a href="http://man7.org/linux/man-pages/man7/inotify.7.html" rel="nofollow">inotify(7)</a> facilities (which don&#39;t work on remote file systems, or on pseudo-file systems Ã  la <code>/proc/</code>)</p><p>You might indeed create and maintain an index, using <a href="http://man7.org/linux/man-pages/man3/nftw.3.html" rel="nofollow">nftw(3)</a>.</p><p>It looks like plain file systems are not optimal for the job as a whole. Perhaps you should think the other way round, and use a genuine database with triggers (instead of file systems) to store the monitored data. Did you consider MariaDB, PostGreSQL, MongoDB?</p><p>See also <a href="http://man7.org/linux/man-pages/man1/locate.1.html" rel="nofollow">locate(1)</a> &amp; <a href="http://man7.org/linux/man-pages/man1/updatedb.1.html" rel="nofollow">updatedb(1)</a></p><blockquote><p>Unfortunately the normal case is that nothing changes most of the time, yet I still have to recalculate all hash values (slow) just to detect nothing changed.</p></blockquote><p>Again (with a Linux perspective, or any OS &amp; filesystem with reliable modification time!) you don&#39;t need to do that. You query the file metadata -size and modification time- with <a href="http://man7.org/linux/man-pages/man2/stat.2.html" rel="nofollow">stat(2)</a> or with <a href="http://doc.qt.io/qt-5/qfileinfo.html" rel="nofollow">QFileInfo</a> and its <code>lastModified()</code> &amp; <code>size()</code> member functions, keep it with the hash value, and you recompute the hash values (so read again the file contents) only when the size or mtime of the file did change (from the previous hash value).</p><p>It looks like you are reinventing <code>make</code> or <a href="http://omake.metaprl.org/" rel="nofollow">omake</a> or some other builder... (some of them work on content checksums, not mtimes).</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-parallel-programming-library-some-features/'>C++ &#8211; Parallel programming library? (+ some features)</a></li><li class="list-group-item"><a href='../python-watching-file-changes-additions-removal-but-with-an-eye-on-partial-transfer/'>Python &#8211; Watching file changes/additions/removal, but with an eye on partial transfer</a></li><li class="list-group-item"><a href='../c-deploying-qt-based-app-on-mac-os-x/'>C++ &#8211; Deploying Qt-based app on Mac OS X</a></li><li class="list-group-item"><a href='../c-how-to-make-a-random-access-archive-of-text-files/'>C++ &#8211; How to make a random-access archive of text files</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>