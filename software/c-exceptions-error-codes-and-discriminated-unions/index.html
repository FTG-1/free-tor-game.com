<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Exceptions, error codes and discriminated unions &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1066094 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1066094" class="post-1066094 software type-software status-publish hentry category-software tag-c tag-exceptions"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Exceptions, error codes and discriminated unions</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">exceptions</span></p><div class="entry-content"><p>I&#39;ve recently started a C# programming job, but I&#39;ve got quite a bit of background in Haskell.</p><p>But I understand C# is an object-orientated language, I don&#39;t want to force a round peg into a square hole.</p><p>I read the article <a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/exception-throwing" rel="noreferrer">Exception Throwing</a> from Microsoft which states:</p><blockquote><p><strong>DO NOT</strong> return error codes.</p></blockquote><p>But being used to Haskell, I&#39;ve been using the C# data type <a href="https://github.com/mcintyre321/OneOf/" rel="noreferrer"><code>OneOf</code></a>, returning the result as the &#34;right&#34; value or the error (most often an Enumeration) as the &#34;left&#34; value.</p><p>This is much like the convention of <a href="http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Either.html" rel="noreferrer"><code>Either</code></a> in Haskell.</p><p>To me, this seems safer than exceptions. In C#, ignoring exceptions does not produce a compile error, and if they are not caught they just bubble up and crash your program. This is perhaps better than ignoring an error code and producing undefined behaviour, but crashing your client&#39;s software is still not a good thing, particularly when it&#39;s performing many other important business tasks in the background.</p><p>With <a href="https://github.com/mcintyre321/OneOf/" rel="noreferrer"><code>OneOf</code></a>, one has to be quite explicit about unpacking it and handling the return value and the error codes. And if one doesn&#39;t know how to handle it at that stage in the call stack, it needs to be put into the return value of the current function, so callers know an error could result.</p><p>But this doesn&#39;t seem to be the approach Microsoft suggests.</p><p>Is using <a href="https://github.com/mcintyre321/OneOf/" rel="noreferrer"><code>OneOf</code></a> instead of exceptions for handling &#34;ordinary&#34; exceptions (like File Not Found etc) a reasonable approach or is it terrible practice?</p><hr/><p>It&#39;s worth noting that I&#39;ve heard that <a href="https://softwareengineering.stackexchange.com/questions/189222/are-exceptions-as-control-flow-considered-a-serious-antipattern-if-so-why">exceptions as control flow are considered a serious antipattern</a>, so if the &#34;exception&#34; is something you would normally handle without ending the program, isn&#39;t that &#34;control flow&#34; in a way? I understand there&#39;s a bit of a grey area here.</p><p>Note I&#39;m not using <a href="https://github.com/mcintyre321/OneOf/" rel="noreferrer"><code>OneOf</code></a> for things like &#34;Out Of Memory&#34;, conditions I don&#39;t expect to recover from will still throw exceptions. But I feel like quite reasonable issues, like user input that doesn&#39;t parse are essentially &#34;control flow&#34; and probably shouldn&#39;t throw exceptions.</p><hr/><p><strong>Subsequent thoughts:</strong></p><p>From this discussion what I&#39;m taking away currently is as follows:</p><ol><li>If you expect the immediate caller to <code>catch</code> and handle the exception most of the time and continue its work, perhaps through another path, it probably should be part of the return type. <code>Optional</code> or <code>OneOf</code> can be useful here.</li><li>If you expect the immediate caller to not catch the exception most of the time, throw an exception, to save the silliness of manually passing it up the stack.</li><li>If you&#39;re not sure what the immediate caller is going to do, maybe provide both, like <code>Parse</code> and <code>TryParse</code>.</li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>but crashing your client&#39;s software is still not a good thing</p></blockquote><p>It most certainly is a good thing.</p><p>You want anything that leaves the system in an undefined state to stop the system because an undefined system can do nasty things like corrupt data, format the hard drive, and send the president threatening emails. If you cannot recover and put the system back into a defined state then crashing is the responsible thing to do. It&#39;s exactly why we build systems that crash rather than quietly tear themselves apart. Now sure, we all want a stable system that never crashes but we only really want that when the system stays in a defined predictable safe state.</p><blockquote><p>I&#39;ve heard that exceptions as control flow are considered a serious antipattern</p></blockquote><p>That&#39;s absolutely true but it&#39;s often misunderstood. When they invented the exception system they were afraid they were breaking structured programming. Structured programming is why we have <code>for</code>, <code>while</code>, <code>until</code>, <code>break</code>, and <code>continue</code> when all we need, to do all of that, is <code>goto</code>.</p><p><a href="https://en.wikipedia.org/wiki/Edsger_W._Dijkstra" rel="noreferrer">Dijkstra</a> taught us that using goto informally (that is, jumping around wherever you like) makes reading code a nightmare. When they gave us the exception system they were afraid they were reinventing goto. So they told us not to &#34;use it for flow control&#34; hoping we&#39;d understand. Unfortunately, many of us didn&#39;t.</p><p>Strangely, we don&#39;t often abuse exceptions to create spaghetti code as we used to with goto. The advice itself seems to have caused more trouble.</p><p>Fundamentally exceptions are about rejecting an assumption. When you ask that a file be saved you assume that the file can and will be saved. The exception you get when it can&#39;t might be about the name being illegal, the HD being full, or because a rat has gnawed through your data cable. You can handle all those errors differently, you can handle them all the same way, or you can let them halt the system. There is a happy path in your code where your assumptions must hold true. One way or another exceptions take you off that happy path. Strictly speaking, yeah that&#39;s a kind of &#34;flow control&#34; but that&#39;s not what they were warning you about. They were talking about <a href="https://xkcd.com/1188/" rel="noreferrer">nonsense like this</a>:</p><p><a href="../../../i.stack.imgur.com/2ip3n.png" rel="noreferrer"><img src="../../../i.stack.imgur.com/2ip3n.png" alt="enter image description here"/></a></p><p>&#34;Exceptions should be exceptional&#34;. This little tautology was born because the exception system designers need time to build stack traces. Compared to jumping around, this is slow. It eats CPU time. But if you&#39;re about to log and halt the system or at least halt the current time intensive processing before starting the next one then you have some time to kill. If people start using exceptions &#34;for flow control&#34; those assumptions about time all go out the window. So &#34;Exceptions should be exceptional&#34; was really given to us as a performance consideration.</p><p>Far more important than that is not confusing us. How long did it take you to spot the infinite loop in the code above?</p><blockquote><p><strong>DO NOT</strong> return error codes.</p></blockquote><p>...is fine advice when you&#39;re in a code base that doesn&#39;t typically use error codes. Why? Because no one&#39;s going to remember to save the return value and check your error codes. It&#39;s still a fine convention when you&#39;re in C.</p><blockquote><p><code>OneOf</code></p></blockquote><p>You&#39;re using yet another convention. That&#39;s fine so long as you&#39;re setting the convention and not simply fighting another one. It&#39;s confusing to have two error conventions in the same code base. If somehow you&#39;ve gotten rid of all code that uses the other convention then go ahead.</p><p>I like the convention myself. One of the best explanations of it I found <a href="https://vimeo.com/97344498" rel="noreferrer">here</a><sup><a href="https://www.slideshare.net/ScottWlaschin/railway-oriented-programming" rel="noreferrer">*</a></sup>:</p><p><a href="../../../i.stack.imgur.com/FDqde.jpg" rel="noreferrer"><img src="../../../i.stack.imgur.com/FDqde.jpg" alt="enter image description here"/></a></p><p>But much as I like it I&#39;m still not going to mix it with the other conventions. Pick one and stick with it.<sup>1</sup></p><p><sub>1 : By which I mean don&#39;t make me think about more than one convention at the same time.</sub></p><hr/><blockquote><p>Subsequent thoughts:</p><p>From this discussion what I&#39;m taking away currently is as follows:</p><ol><li>If you expect the immediate caller to catch and handle the exception most of the time and continue its work, perhaps through another path, it probably should be part of the return type. Optional or OneOf can be useful here.</li><li>If you expect the immediate caller to not catch the exception most of the time, throw an exception, to save the silliness of manually passing it up the stack.</li><li>If you&#39;re not sure what the immediate caller is going to do, maybe provide both, like Parse and TryParse.</li></ol></blockquote><p>It&#39;s really not this simple. One of the fundamental things you need to understand is what a zero is.</p><p>How many days are left in May? 0 (because it&#39;s not May. It&#39;s June already).</p><p>Exceptions are a way to reject an assumption but they are not the only way. If you use exceptions to reject the assumption you leave the happy path. But if you chose values to send down the happy path that signal that things are not as simple as was assumed then you can stay on that path so long as it can deal with those values. Sometimes 0 is already used to mean something so you have to find another value to map your assumption rejecting idea on to. You may recognize this idea from its use in good old <a href="https://math.stackexchange.com/a/1696269/151778">algebra</a>. Monads can help with that but it doesn&#39;t always have to be a monad.</p><p>For example<sup><a href="../../../i.stack.imgur.com/TPoz7.png" rel="noreferrer">2</a></sup>:</p><pre><code>IList&lt;int&gt; ParseAllTheInts(String s) { ... }
</code></pre><p>Can you think of any good reason this must be designed so that it deliberately throws anything ever? Guess what you get when no int can be parsed? I don&#39;t even need to tell you.</p><p>That&#39;s a sign of a good name. Sorry but <a href="https://blogs.msdn.microsoft.com/ericlippert/2008/09/10/vexing-exceptions/" rel="noreferrer">TryParse</a> is not my idea of a good name.</p><p>We often avoid throwing an exception on getting nothing when the answer could be more than one thing at the same time but for some reason if the answer is either one thing or nothing we get obsessed with insisting that it give us one thing or throw:</p><pre><code>IList&lt;Point&gt; Intersection(Line a, Line b) { ... }
</code></pre><p>Do parallel lines really need to cause an exception here? Is it really that bad if this list will never contain more than one point?</p><p>Maybe semantically you just can&#39;t take that. If so, it&#39;s a pity. But Maybe Monads, that don&#39;t have an arbitrary size like <code>List</code> does, will make you feel better about it.</p><pre><code>Maybe&lt;Point&gt; Intersection(Line a, Line b) { ... }
</code></pre><p>The Monads are little special purpose collections that are meant to be used in specific ways that avoid needing to test them. We&#39;re supposed to find ways of dealing with them regardless of what they contain. That way the happy path stays simple. If you crack open and test every Monad you touch you&#39;re using them wrong.</p><p>I know, it&#39;s weird. But it&#39;s a new tool (well, to us). So give it some time. Hammers make more sense when you stop using them on screws.</p><hr/><p>If you&#39;ll indulge me, I&#39;d like to address this comment:</p><blockquote><p>How come none of the answers clarifies that the Either monad is not an error code, and nor is OneOf? They are fundamentally different, and the question consequently seems to be based on a misunderstanding. (Though in a modified form it’s still a valid question.) – <a href="https://softwareengineering.stackexchange.com/users/2366/konrad-rudolph">Konrad Rudolph</a> <a href="https://softwareengineering.stackexchange.com/questions/372034/exceptions-error-codes-and-discriminated-unions/372036#comment816760_372034">Jun 4 `18 at 14:08</a></p></blockquote><p>This is absolutely true. Monads are much closer to collections than exceptions, flags, or error codes. They do make fine containers for such things when used wisely.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../exceptions-or-error-codes/'>Exceptions or Error codes</a></li><li class="list-group-item"><a href='../c-having-error-codes-option-in-c-library-for-performance/'>C++ &#8211; Having error codes option in C++ library for performance</a></li><li class="list-group-item"><a href='../java-better-way-to-define-an-exception-thrown-by-a-method-in-java/'>Java &#8211; better way to define an exception thrown by a method in Java</a></li><li class="list-group-item"><a href='../c-rust-style-error-handling-in-c/'>C++ &#8211; Rust-style error handling in C++</a></li><li class="list-group-item"><a href='../python-are-exceptions-for-flow-control-best-practice-in-python/'>Python &#8211; Are exceptions for flow control best practice in Python</a></li><li class="list-group-item"><a href='../c-mapping-exceptions-to-error-response/'>C# &#8211; Mapping exceptions to error response</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>