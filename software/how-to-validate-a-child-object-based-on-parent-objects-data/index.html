<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How to Validate a Child Object Based on Parent Object&#8217;s Data &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1083348 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1083348" class="post-1083348 software type-software status-publish hentry category-software tag-domain-driven-design tag-separation-of-concerns tag-validation"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How to Validate a Child Object Based on Parent Object&#8217;s Data</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">domain-driven-design</span><span class="mr-2 badge badge-info">separation-of-concerns</span><span class="mr-2 badge badge-warning">validation</span></p><div class="entry-content"><p>Taking into consideration that I&#39;m making an attempt at Domain-Driven Design and overall good separation of concerns when it comes to business logic, data access logic, etc&#8230;</p><blockquote><p><strong>Question</strong>: How do you validate a child object, when validation depends on one or more fields of a parent object? What about when the parent object&#39;s validation depends on the state of child objects?</p></blockquote><p>Let&#39;s use a simple, contrived example: annual employee performance reviews.</p><p>John, a manager at his company, needs to complete a review for each of his subordinates. Collectively, all of the reviews John needs to perform this year are referred to as a Review Process. When John closes all of the reviews in his Review Process, the Review Process itself can be closed.</p><p>He&#39;s using my system to create, update, and close employee reviews. The system defines a <code>ReviewProcess</code> object, and it contains a <code>List(Of Reviews)</code> belonging to that Review Process, as follows:</p><pre><code>Public Class ReviewProcess

    Public Property ReviewProcessID As Integer
    Public Property EmployeeID As Integer
    Public ReadOnly Property Reviews As List(Of Review)
    Public Property CloseDate As Date

    Public Sub Add(review As Review)

        _Reviews.Add(review)

    End Sub

End Class

Public Class Review

    Public Property ReviewID As Integer
    Public Property ReviewProcessID As Integer
    Public Property EmployeeID As Integer
    Public Property Rating As Integer
    Public Property Comments As String
    Public Property CloseDate As Date

End Class
</code></pre><p>John needs to add a new review to his Review Process. In the UI, he clicks Add, selects Steve&#39;s Employee ID, and clicks save:</p><pre><code>Private Sub SaveClickEvent(sender As Object, e As EventArgs) Handles btnSave.Click

        &#39; _reviewProcess is a form-level variable, already instantiated when the form is opened.

        Dim newReview As New Review With {
            .ReviewProcessID = _reviewProcess.ReviewProcessID,
            .EmployeeID = DirectCast(cboEmployees.SelectedItem, Employee).EmployeeID
            }

        Dim service As New ReviewService
        Dim result As New ValidationResult

        result = service.Create(newReview)

        If result.IsValid Then

            _reviewProcess.Add(newReview)

        Else

            &#39; Show the validation errors to the user.

        End If

    End Sub
</code></pre><p>Inside the ReviewService.Create() function, the following code is found. A FluentValidation validator is instantiated to check the that the new Review is valid to save to the database:</p><pre><code>Public Class ReviewService

    Public Function Create(item As Review) As ValidationResult

        Dim validator As New ReviewValidator
        Dim results As ValidationResult = validator.Validate(item, ruleSet:=&#34;OnSave&#34;)

        &#39; SE question: how/where do we validate that the parent ReviewProcess does not have a close date?

        If results.IsValid Then

            Dim repository As New ReviewDataAccess
            repository.Create(item)

        End If

        Return results

    End Function

End Class
</code></pre><p>For completeness, here is the ReviewValidator class:</p><pre><code>Public Class ReviewValidator
    Inherits AbstractValidator(Of Review)

    Public Sub New()

        RuleSet(&#34;OnSave&#34;,
            Sub()
                RuleFor(Function(x) x.ReviewProcessID).NotEmpty
                RuleFor(Function(x) x.EmployeeID).NotEmpty
            End Sub
        )

        RuleSet(&#34;OnClose&#34;,
            Sub()
                RuleFor(Function(x) x.Rating).NotEmpty
                RuleFor(Function(x) x.Comments).NotEmpty
                RuleFor(Function(x) x.CloseDate).NotEmpty
            End Sub
        )

    End Sub

End Class
</code></pre><p>This is where I&#39;m having a breakdown of DDD/OOP understanding. The architecture I have described above is fine, until I hit the business rule that &#34;If a Review Process is closed, new Reviews cannot be added.&#34;</p><p>Repeating the question:</p><blockquote><p><strong>Question</strong>: How do you validate a child object, when validation depends on one or more fields of a parent object? What about when the parent object&#39;s validation depends on the state of child objects?</p></blockquote><p>Sure, I can ensure that the UI doesn&#39;t enable the Add button when the <code>_reviewProcess.CloseDate &lt;&gt; Nothing</code>, but that&#39;s obviously not in line with separation of concerns. I want to ensure this business rule is in the right place. This is where my question lies. There is also a business rule that a Review Process cannot be closed unless all of the Reviews that it owns are also closed. How does this fit into my design, if at all? Maybe I have to rethink and redo the design (with your help)?</p><p>I understand that maybe my design is way off base. Feedback on that is welcome.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Well I don&#39;t know if this will suffice to be a satisfying answer to your question or not, if not I hope that it can still help in some way, shape or form!</p><h2>Answer (sort of??)</h2><p>So I am just going to come right out and espouse my personal opinion <em>(being based off solid design principles)</em> and say that <em><strong>I would STRONGLY recommend against the general design of a component, in which there is ever a child object which must have some direct knowledge of its own parent.</strong></em> I do say this knowing that there are a handful of very esoteric scenarios in which this sort of thing would be acceptable, but for the most part  I think that this would be introducing a level of <strong>complexity</strong> and <strong>coupling</strong> which is antithesis to the whole idea of creating an inheritance structure to begin with.</p><h2>SOLUTION</h2><p>Now that being said, I would propose that in a scenario like you give as an example...</p><blockquote><p>Let&#39;s use a simple, contrived example: <em><strong>Annual Employee Performance Reviews</strong></em>.</p><p>John, a manager at his company, needs to complete a review for each of his subordinates. &gt;Collectively, all of the reviews John needs to perform this year are referred to as a &gt;Review Process. When John closes all of the reviews in his Review Process, the Review &gt;Process itself can be closed.</p></blockquote><p>The proper solution, as far as your software design goes would be to employ the power of Events <em>(assuming c# is used, although you could use some sort of callback for other languages without such first class features)</em>. This solution would look something like the following:</p><ol><li>When the <code>ReviewProcess</code> is created, it should register an event listener to the given event, something such as <code>OnReviewClosed</code>.<ul><li>The <code>ReviewProcess</code> should also be tracking which <code>Review</code> object is raising the event <em>(pass this information via event args)</em>. Just to ensure that you could rule out any edge cases where someone closes the same review several times and counts for all of them, etc.</li></ul></li><li>Add a handler to the <code>Review</code> class so that it knows what information should be included in the event, in other words, what information does the <code>ReviewProcess</code> need to be aware of on the event.</li><li>Wire up the <code>OnClick</code> to trigger the <code>Review.Complete()</code> method which in turn would raise the event.</li></ol><p>This sort of approach offers the following main benefits</p><ul><li>There is no sort of coupling between the child and parents which is oriented in the reverse direction of the natural inheritance. This means in a more ideological sense, that the child object no longer has to concern itself with any business logic that should be <strong>SOLELY</strong> the concern of the parent. Since this is the whole reason to have the parent object in the first place and not just an array of the child objects. This will prevent many, MANY issues in the future when trying to expand on the code as a nice bonus !</li><li>Using the event method will also allow for you to <em><strong>VERY EASILY</strong></em> add additional business logic to the application which depends on the knowledge of when/where a <code>Review</code> object is marked as closed without having to modify any exiting code and run the risk of braking code elsewhere because of the weird backwards coupling.</li><li>Lastly, it will reduce the amount of <em>&#34;bloat logic&#34;</em> inside of the <code>Review</code> class which is not really the responsibility of the <code>Review</code> itself, but rather some tertiary service which it should belong to naturally!</li></ul></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/with-all-of-these-services-how-can-i-not-be-anemic/'>With all of these services, how can I not be anemic</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/validating-best-practices-property-vs-dto-simple-type-vs-object/'>Validating best practices, property vs dto, simple type vs object</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/python-duck-typing-data-validation-and-assertive-programming-in-python/'>Python &#8211; Duck typing, data validation and assertive programming in Python</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-best-way-of-validating-class-properties/'>C# &#8211; Best way of validating Class properties</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/where-should-business-logic-go-in-a-layered-architecture/'>Where should business logic go in a layered architecture</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>