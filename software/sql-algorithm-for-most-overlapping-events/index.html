<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>SQL algorithm for most overlapping events &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072128 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072128" class="post-1072128 software type-software status-publish hentry category-software tag-algorithms tag-sql"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">SQL algorithm for most overlapping events</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">algorithms</span><span class="mr-2 badge badge-info">sql</span></p><div class="entry-content"><h2>The Problem</h2><p>I&#39;m looking for a query to help me solve the following:</p><ul><li>I have a series of events</li><li>Each event has a start and end date.</li><li>Many of these events overlap</li><li>The answer I&#39;m looking for is the maximum number of events that overlap</li></ul><h2>Example</h2><p>Say I have 5 events:</p><ul><li>1 Jan -&gt; 9 Jan</li><li>7 Jan -&gt; 12 Jan</li><li>8 Jan -&gt; 10 Jan</li><li>10 Jan -&gt; 15 Jan</li><li>12 Jan -&gt; 17 Jan</li></ul><p>3 of these events overlap 9th January, which is the maximum overlapping events, so the answer is 3.</p><p>(There are also 3 events overlapping on 10th January, but that&#39;s the same answer)</p><h2>What I&#39;ve Tried</h2><p>If I was doing this in memory, I could do this:</p><ul><li>For each event:<ul><li>Get the start date</li><li>Count the dates that include this event</li></ul></li><li>Pick the event with the highest count.</li></ul><p>But there are 2 issues with this:</p><ul><li>It doesn&#39;t appear to be very efficient</li><li>It isn&#39;t very SQL-y (ie. is procedural rather than set-based)</li></ul><h2>Question</h2><p>How can I implement something like this in SQL?</p><h2>Notes</h2><ul><li>I don&#39;t care to find the start / end dates of the most overlapping events. I just need a count</li><li>I don&#39;t care how often the maximum occurs, I just need the maximum. So, in the example above, I know there are two occasions where 3 events overlap, but I just need the &#34;3&#34;.</li><li>If event A ends on the same day as event B starts, they are considered to be overlapping</li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It might be more performant to write this in code, not sql.</p><p>In code, I would sort the items by start date, then end date. Walk through them and check if it overlaps with the next item. If it does, increment its overlap counter and repeat: check the next item overlaps with your item. If it doesn&#39;t, move on to the next.</p><p>In SQL, you can do it with a self join to list all the overlaps.</p><p>This will show you all overlaps:</p><pre><code>select a.eventid from events a
inner join events b 
on a.end &gt; b.start and a.start &lt; b.end
</code></pre><p>You can then group them by eventid, select the count and take the event with the max count.</p><pre><code>select top 1 eventid, count(*) as c
from 
    (select a.eventid from events a
    inner join events b 
    on a.end &gt; b.start and a.start &lt; b.end)
group by eventid
order by c desc
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../two-database-fields-for-date-and-time-should-they-be-merged/'>Two database fields for date and time &#8211; should they be merged</a></li><li class="list-group-item"><a href='../database-logic-design-question-for-sql-query/'>Database &#8211; Logic design question for SQL query</a></li><li class="list-group-item"><a href='../design-using-a-relational-database-vs-json-objects-for-event-activity-data/'>Design &#8211; Using a relational database vs JSON objects for event/activity data</a></li><li class="list-group-item"><a href='../sql-algorithm-for-finding-availability-of-a-resource/'>SQL &#8211; Algorithm for finding availability of a resource</a></li><li class="list-group-item"><a href='../job-scheduling-algorithm-to-find-the-maximum-number-of-overlapping-jobs/'>Job scheduling: algorithm to find the maximum number of overlapping jobs</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>