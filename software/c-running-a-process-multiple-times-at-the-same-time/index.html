<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C++ &#8211; Running a process multiple times at the same time &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078410 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078410" class="post-1078410 software type-software status-publish hentry category-software tag-c tag-multithreading tag-ubuntu"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C++ &#8211; Running a process multiple times at the same time</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">multithreading</span><span class="mr-2 badge badge-warning">Ubuntu</span></p><div class="entry-content"><p>I have a c++ program with opencv library which takes an image as input and perform pose estimation,color detection,phog. When I run this program from the command line it takes around 4-5sec to complete. It takes around 60%cpu. When I try to run the same program from two different command line windows at the same time the process takes around 10-15 sec to finish and both the process finish in almost the same time. The CPU Usage reaches upto 100%.</p><p>I have a website which calls this c++ exe using exec() command. So when two users try to upload an image and run it takes more time as I explained above in the command line. Is this because the c++ program involves high computation and the CPU reaches 100% it slows down? But I read that the CPU reaching 100% is not a bad thing as the computer is using its full capacity to run the program. So is this because of my c++ program or is it something to do with my server(computer) settings? This is probably not the apache server problem because when I try to run it from the command line also it slows down. I am using a quad core processor and all the 4 CPU reaches 100% when I try to run the same process at the same time so I think that its distributed among all the processor. So I have few more questions:</p><p>1) Can this be solved by using multithreading in my c++ code?As for now I am not using it but will multithreading make the c++ code more computationally expensive and increase the CPU usage(if this is the problem).</p><p>2) What can be the reason of it slowing down? Is the process in a queue and each process is ran only a certain amount of time and it switches between the two process?</p><p>3) If this is because it involves high computation will it help if I change some functions to opencv gpu functions?</p><p>4) Is there a way I can solve this problems any ideas or tips?</p><p>I have inserted the result of top when running one process and running the same process twice at the same time:</p><p>Version5 is the process,running it once<br /> <img src="../../../i.stack.imgur.com/V9KVi.png" alt="enter image description here"/><br /> Two Version5 running at the same time<br /> <img src="../../../i.stack.imgur.com/h6aP4.png" alt="enter image description here"/></p><p>Thanks in advance.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I wasn&#39;t surprised at the numbers you are reporting after I considered what the program seems to be doing.  It is computationally intensive with a lot of memory data fetches.  The file I/O would be slow in comparison and I don&#39;t sense that this is an issue (yet).</p><p>Looking at your numbers, I&#39;m thinking you think that 4-5sec x Two should be 8-10 sec.?  I&#39; say realistically the best you could expect would be 9-12 sec., nothing is ideal.  Using my &#39;mud math&#39; we have 3 sec of CPU more than ~anticipated~.  That&#39;s a lot of CPU.</p><p>I&#39;d be targeting the memory access contention as my first point of investigation.  Shared core CPU-s will use the same memory bus and access to memory.  They also probably use the same on-chip cache(s) too.  But two processes like this will want to both &#39;fill&#39; the data cache.  For example, P01 might so some calculations and use 50% of the data cache; then comes P02 who wants 50% of the resources too.  But there won&#39;t be 50% available because the operating system needs some and there are other (important) processes like your server, etc.</p><p>Anyway the expected outcome is that P02 will evict a significant chunk of P01&#39;s resources.  Meaning that P01 will find that it has to go out to the DRAM for some of the data it wants for subsequent calculations.  If I&#39;m at all close, you will get better linear performance by queuing your transformations and running them in sequence.  You could test that in the command shell by putting P01 and P02 in a script:</p><pre><code>P01
P02
</code></pre><p>If the elapsed time comes out under 12 sec. then there is some resource contention involved (not necessarily memory cache). In that case, I recommend using some kind of queue.</p><p>At present the (best case) elapsed time for Both clients is: 10sec. (each) because both are slowed down.  If you queue, client one waits 5 sec and client two waits 10 sec. Client 2 is no worse off.  Of course that is not really scalable.  However a transformation queue is scalable if you can enlist one or more back-end machines process jobs from the queue.</p><p>Since the transformation is queued the user can do something interesting while the transformation occurs.  That can hold-off a resource contention issue temporarily.</p><p>Your other job is to find out what resources is being thrashed.  That may not be easy depending on your machine and low-level tools available.  I&#39;d also be checking on the source code algorithm and optimisations your C++ build uses for the graphics processing.  Some &#34;speed-ups&#34; work fine for single threaded apps by turning off things that you might want to use in multi-threaded situations.</p><p>Since your machine is a server, it may not have a graphics CPU.  It might be worth considering some specialised iron to process this stuff.  It usually comes down to how much you want performance and how much you want to expend (time, thinking, money, resources) to get it.</p><p>Other things to look at are alternative processing libraries that might be faster or have more suitable configuration options.  Can you re-structure your code to take better advantage of the library&#39;s way of doing things?</p><p>If you can identify one or more bottle-necks in your transformation code -- This can be done with a C++ profiler -- Then you may be able to run the individual transforms in a staggered fashion so that over all through-put is improved.  That&#39;s a big &#34;IF&#34;, but worth mentioning.</p><p>FIRST though, before committing more than a day more on this; check with your &#39;business process owner&#39; and find out exactly what the &#34;OK&#34; number of seconds is.  If they say 17-seconds, you are looking good, just queue things up and let the user get-on with something else on the page.</p><p>I&#39;ll be interested to know if the processes in series is quicker that 2 in parallel.</p><p><em>Good luck</em></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../parallelism-implies-concurrency-but-not-the-other-way-round-right/'>Parallelism implies concurrency but not the other way round right</a></li><li class="list-group-item"><a href='../issues-with-time-slicing/'>Issues with time slicing</a></li><li class="list-group-item"><a href='../should-multi-threading-be-used-for-tasks-which-does-not-involve-io-operation/'>Should multi-threading be used for tasks which does not involve IO operation</a></li><li class="list-group-item"><a href='../context-switching-behavior/'>Context Switching behavior</a></li><li class="list-group-item"><a href='../java-behaviour-of-thread-sleep-in-a-single-core-processor-machine/'>Java &#8211; Behaviour of Thread sleep in a single core processor machine</a></li><li class="list-group-item"><a href='../java-multi-threading-performance-when-cpu-is-maxed-out/'>Java &#8211; multi-threading performance when CPU is maxed out</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>