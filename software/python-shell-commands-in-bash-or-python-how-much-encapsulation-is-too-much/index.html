<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python &#8211; Shell commands in bash or python? How much encapsulation is too much &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087942 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087942" class="post-1087942 software type-software status-publish hentry category-software tag-bash tag-builds tag-dependency-injection tag-python"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python &#8211; Shell commands in bash or python? How much encapsulation is too much</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">bash</span><span class="mr-2 badge badge-info">builds</span><span class="mr-2 badge badge-warning">dependency-injection</span><span class="mr-2 badge badge-primary">python</span></p><div class="entry-content"><p>I&#39;m thinking about how to decide whether it&#39;s better to encapsulate my work behind well-named function names, or to expose it &#8211; which will help developers understand what&#39;s going on more quickly? Is there a name for the study of this sort of problem?</p><p>Specifically, if I&#39;m running a bunch of bash commands ultimately, but I have significantly complex logic around those commands, at what point does it make sense to write this in a high-level language like Python, even though this obfuscates the actual bash commands being run?</p><h2>Detailed problem</h2><p>Currently I&#39;m trying to write a Jenkins build script for my project with roughly the following steps:</p><ul><li>Pull my code from github</li><li>Compile sass files into CSS</li><li>Pull down a sub-folder from a different github project</li><li>Zip up the project</li><li>Upload it to an object store with a unique ID</li></ul><p>I&#39;m thinking about how to write this to be as easy for future developers as possible (this code is never going to be seen by end users). These developers are likely, but not definitely, going to be fairly good at Python. They will definitely have a passing familiarity with the command-line, but are likely to be unfamiliar with more complex bash scripting.</p><p>The first iteration of this build script was just a list of sequential commands, something like:</p><pre><code>git clone git@github.com:username/project.git
git clone git@github.com:username/sub-project.git project/sub-project
sass --update project/css
tar -czf project.tgz project
swift upload my-container project.tgz --object-name=project-`sha1sum project.tgz`.tgz
</code></pre><p>However, this set of commands quickly became more complex as I started to do things like only clone the git project if it wasn&#39;t already there, otherwise update it &#8211; to speed up the build. Before I knew it I had 50 lines and a fair few conditionals.</p><p>So the first thing I did was encapsulate these into bash functions, e.g. <a href="https://gist.github.com/nottrobin/838cab01538742629db6">update_git_dir</a>, so my build script looks more like this:</p><pre><code>#!/usr/bin/env bash

source helper_functions.sh

update_git_dir project git@github.com:username/project.git
build_sass project/css
create_archive project project.tgz
upload_to_swift project.tgz
</code></pre><p>This is one level of encapsulation. Now the developer, who would have understood the <code>git clone</code> etc. commands directly, can&#39;t actually see what&#39;s going on. They have to look in <code>helper_functions.sh</code>.</p><p>However, as time went on I realised that many of my helper functions now consisted of more conditional statements, variable assignments and function calls than actual commands. These conditional statements can be quite opaque to someone not familiar with bash scripting:</p><pre><code>function create_archive {
    project_name=${1}
    archive_filename=${2}

    # Get revision ids
    dependencies_requirements_revision=$(cat ${project_name}/sub-project/requirements-revision.txt)

    requirements_context=${project_name}/${requirements_file}
    requirements_dir=$(dirname ${requirements_context})
    if [ &#34;${requirements_dir}&#34; != &#34;${project_name}&#34; ]; then
        requirements_context=${requirements_dir}
    fi
    latest_revision=$(git-revision-hash ${project_name})

    ...
</code></pre><p>So I started migrating my code into Python. So now my build script looks like this:</p><pre><code>#!/usr/bin/env python

from builders import GitProjectBuilder

builder = GitProjectBuilder(
    project_name=&#39;my-project&#39;,
    swift_container=&#39;my-container&#39;,
    git_repository=&#39;git@github.com:username/project.git&#39;,
    sub_project=&#39;git@github.com:username/sub-project.git&#39;
)

# Compress and upload
builder.build_sass(directory=&#39;css&#39;)
builder.get_sub_project(repo=&#39;git@github.com:username/sub-project.git&#39;)
builder.build_archive(name=&#39;archive.tgz&#39;)
upload_location = builder.upload_archive_to_swift(archive=&#39;archive.tgz&#39;)
print upload_location
</code></pre><p>Now, when you look in <code>builders.py</code>, it&#39;s much easier to understand the logic &#8211; <code>if</code> statements and function calls are much more readable &#8211; but now we&#39;re even further away from the real shell commands. In my python code the closest I get to directly running shell commands looks like this:</p><pre><code>def build_archive(self, archive):
    print subprocess.check_output(
        (
            &#39;tar --exclude-vcs --create --file &#39;
            &#39;{archive_filename}.tar {project_dir}&#39;
        ).format(
            archive_filename=archive_filename,
            project_dir=self.project_name
        ).split()
    )
</code></pre><p>If the developer needs to work out exactly which commands are being run, it&#39;s now much more difficult.</p><h2>Wrap up</h2><p>So how do I decide which is the best architecture to maximise transparency while encapsulating complexity?</p><p>This problem seems similar to when I&#39;m working with dependency injection where the more dependencies I inject rather than encapsulate, the more complex my initialisation code gets &#8211; and I have a similar problem drawing the line.</p><p>Is there a name for this field of study?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I&#39;d give <a href="http://xonsh.org/" rel="nofollow noreferrer">xonsh</a> a go, it&#39;s a clever mix of shell and python.</p><blockquote><p>xonsh is a Python-ish, BASHwards-compatible shell language and command prompt. The language is a superset of Python 3.4 with additional shell primitives that you are used to from BASH and IPython. xonsh is meant for the daily use of experts and novices alike.</p></blockquote><p>Take advantage of Python(3)&#39;s abstraction and package system, coupled with nice conditionals, but write what needs to be in shell as just shell.</p><p>e.g.,</p><pre class="lang-py prettyprint-override"><code>#!/usr/bin/env xonsh

def exists(filename):
    return filename in $(ls)

if exists(&#34;.git&#34;):
    git checkout master
    git pull
else:
    git clone $GITURL
</code></pre><p>Note that only a little bit of ugliness <code>$()</code> is required to in-line shell inside of python, and it Just Works (TM) if you are splitting things clearly by line (eg the <code>if</code> statement lines)</p><p>Lots more detail (including embedding python in shell lines with <code>@()</code> ) in the tutorial <a href="http://xonsh.org/tutorial.html" rel="nofollow noreferrer">http://xonsh.org/tutorial.html</a></p><p>You <em>can</em> use it as your system shell. But just because you <em>can</em> doesn&#39;t mean you <em>should</em> :-)</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/use-a-dockerfile-instead-of-a-batch-script/'>Use a Dockerfile instead of a batch script</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/python-options-to-handle-large-multi-gigabyte-file-uploads/'>Python &#8211; Options to handle large (multi-gigabyte) file uploads</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/python-is-it-pythonic-to-replace-a-bash-script-with-series-of-subprocess-calls/'>Python &#8211; Is it pythonic to replace a bash script with series of subprocess calls</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/python-a-proper-way-to-structure-a-python-project-consisting-of-smaller-packages-that-have-shared-code/'>Python &#8211;  a proper way to structure a Python project consisting of smaller packages that have shared code</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>