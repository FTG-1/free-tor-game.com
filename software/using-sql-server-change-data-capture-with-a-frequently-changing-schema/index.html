<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Using Sql Server Change Data Capture with a frequently changing schema &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074583 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074583" class="post-1074583 software type-software status-publish hentry category-software tag-migration tag-sql-server"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Using Sql Server Change Data Capture with a frequently changing schema</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">migration</span><span class="mr-2 badge badge-info">sql server</span></p><div class="entry-content"><p>We are looking into enabling Sql Server Change Data Capture for a new subsystem we are building.</p><p>It&#39;s not really because we need it, but we are being pushed for having a complete history traceability, and CDC would nicely solve this requirement with minimum effort on our parts.</p><p>We are following an agile development process, which in this case means that we frequently make changes to the database schema, e.g. adding new columns, moving data to other columns, etc.</p><p>We did a small test where we created a table, enabled CDC for that table, and then added a new column to the table. Changes to the new column is not registered in the CDC table.</p><p>Is there a mechanism to update the CDC table to the new schema, and are there any best practices to how you deal with captured data when migrating the database schema?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>We have also recently started looking at CDC.  I&#39;m not an expert on the subject, but I think I have some answers for your questions.</p><p>For the most part, CDC will <em>help</em> you achieve your goal of a completely traceable history, but I don&#39;t think it will get you all of the way there.</p><p>First off:</p><blockquote><p>we frequently make changes to the database schema  ... Is there a mechanism to update the CDC table to the new schema</p></blockquote><p>And this is where I think CDC will fail you.  The <a href="http://msdn.microsoft.com/en-us/library/hh710064.aspx">MSDN documentation</a> under the section &#34;Understanding Change Tracking Overhead&#34; is pretty clear that it won&#39;t track the schema changes for you. For example, with <code>Alter Table Add Column</code>:</p><blockquote><p>If a new column is added to the change tracked table, the addition of the column is not tracked. Only the updates and changes that are made to the new column are tracked.</p></blockquote><p><code>Drop Column</code> is a little bit more complex.</p><p>However, you should be using DB scripts to alter your schema so you don&#39;t necessarily have to rely upon CDC here.  That allows you to have consistency between your QA and Production schemas.  And change to QA should be performed by script so the exact same changes can be applied to Prod.  It shouldn&#39;t be too hard to extract out the schema changes from those scripts.  This may mean that the &#34;time&#34; dimension of your history be driven by version instead of actual time, but the end result will be the same.</p><p>If you don&#39;t have one already, create a table to track the version of your database schema. And then place that database schema version table under CDC so you can align macroscopic changes to the schema against the microscopic changes within a particular table.</p><p>To my understanding, you should still be seeing the data added to the new column(s) regardless of CDC not showing the schema change.  And the data migration from table to table should also be picked up by CDC.</p><blockquote><p>are there any best practices to how you deal with captured data when migrating the database schema?</p></blockquote><p>Treat it like you would treat an audit.  You need to understand what it is you&#39;re examining, why you&#39;re examining it, and how long you need to keep that information around. <strong>Scope</strong> and <strong>retention</strong> are the two biggest bugaboos when it comes to a task like this.</p><p>CDC&#39;s reporting tools are understandably austere, so you have to know the context of the changes.  It&#39;s too easy to say &#34;track <strong><em>everything</em></strong>!&#34; and end up with nothing that&#39;s usable as a result.  Likewise, you could be doubling the size of your database by keeping a copy of every change.  On a high churn table with many inserts and deletes, you&#39;ll end up with astronomical growth.  That&#39;s not bad in and of itself, but you need to budget for that growth and have a means to examine all of the data that&#39;s generated.</p><p>So this gets you back to understanding why you are being pushed to have complete traceability.  There are certainly valid reasons for that requirement.  But you won&#39;t be able to structure your effective auditing of the database until you know why you must meet that requirement.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../database-migration-upgrade-schema-deployed-on-client-machines/'>Database migration: upgrade schema deployed on client machines</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>