<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Proper way of handling EINTR in libraries &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1069079 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1069079" class="post-1069079 software type-software status-publish hentry category-software tag-c tag-libraries tag-posix tag-signals"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Proper way of handling EINTR in libraries</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">libraries</span><span class="mr-2 badge badge-warning">posix</span><span class="mr-2 badge badge-primary">signals</span></p><div class="entry-content"><p><strong>What is the recommended etiquette when it comes to <code>EINTR</code> in libraries?</strong></p><p>I&#39;m currently writing a function that does some file system tasks with the POSIX API, but a lot of the calls I use can potentially return <code>EINTR</code>.  Additionally, the function can block under some circumstances.  (For those interested, it implements a locking mechanism.)</p><p>In the interests of making this as general as possible, I would like to know what is the proper way to deal with an interrupted system call.</p><ul><li><p>From most sources I&#39;ve read, people typically retry the call and continue on with their business.  However, I&#39;m not sure that&#39;s the right thing to do here, since there may be legitimate reasons to interrupt my function given that it can take a significant amount of time.  Furthermore, it means the <code>EINTR</code> would simply get swallowed by the function and the caller would lose any indication that it occurred.</p></li><li><p>My current strategy is to immediately abort the operation if I receive <code>EINTR</code> and notify the caller about it.  This way, the caller can decide if they want to retry my function, right?  (Or perhaps my understanding of signals is flawed?)</p></li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Always leave the decision of how to handle <code>EINTR</code> to the user, and <strong>make it easy to resume the operation</strong> as appropriate.</p><p>Usually the best way to do that is to return from your library function to the caller upon <code>EINTR</code>, but in some cases a callback or some other implemention might be better - which way is best depends on other factors, but always let the user control retry and resume.</p><p>This means that if your library code can <strong>partially succeed</strong> before getting an <code>EINTR</code>, then you should think carefully what the user might need to know about that partial success, or if the user might need to resume the operation from where it failed. You might need to return additional information or provide an interface for resuming from any place where it might be appropriate to.</p><p>This is why system calls like <code>read</code> and <code>write</code> nowadays return partial success - because it is very frustrating as a user to be told:</p><blockquote><p>You tried to write <code>&#34;foo&#34;</code> and we successfully wrote either nothing, or <code>&#34;f&#34;</code>, or <code>&#34;fo&#34;</code>, <em>and you don&#39;t get to know which</em>. Have fun! Hope your system can handle restarting the whole write after any of those!</p></blockquote><p>Of course, in some cases, we <em>should</em> write systems to handle situations exactly like that - for example, perhaps after a partial write you always recreate the file, or reopen the network connection, or you use some byte to mean &#34;starting over&#34; - so it depends on what use cases your library targets.</p><p>If a library function does several operations, and there is no way to know at which of them it failed, and those operations are not all safely and efficiently idempotent, that basically makes a library unusable for code that needs to be robust.</p><p>If all steps in a library function <em>are</em> safely and efficiently idempotent, or the whole thing is atomic - like acquiring a lock - then just letting the user know that an <code>EINTR</code> happened is enough.</p><p>Also, if we retry on <code>EINTR</code>, then <strong>we might break signal handling</strong>. At the low level, signal handlers can only safely use a limited set of features, and so in many cases a signal handler will just set a boolean indicating that the signal was received, and then return, expecting that when the code resumes, it will exit out of whatever it was doing. If we get an <code>EINTR</code> and then we retry instead of returning control to the user, we might be keeping the code from doing that.</p><p>What to do after an <code>EINTR</code> is a <strong>whole program decision</strong> - the right answer cannot be known without knowing what the program is doing and how the program is meant to respond to a signal, and it has effects on the rest of the program.</p><p>Knowing <em>how</em> or <em>if</em> the user might need to resume, and helping the user do so if it is needed, is a library responsibility - the right answer cannot be known without knowing what the library is doing.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/questions-about-linking-libraries-in-c/'>Questions about linking libraries in C</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/differences-between-different-creative-coding-libraries/'>Differences between different creative coding libraries</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/javascript-proper-way-to-compile-a-javascript-project/'>Javascript &#8211; Proper way to &#8220;compile&#8221; a javascript project</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-are-header-only-libraries-more-efficient/'>C++ &#8211; Are header-only libraries more efficient</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/why-develop-internal-libraries-for-internal-applications/'>Why develop internal libraries for internal applications</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>