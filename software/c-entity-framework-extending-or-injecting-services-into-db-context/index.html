<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Entity Framework &#8211; extending OR injecting services into DB Context &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1087995 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1087995" class="post-1087995 software type-software status-publish hentry category-software tag-asp-net tag-asp-net-core tag-c tag-entity-framework tag-single-responsibility"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Entity Framework &#8211; extending OR injecting services into DB Context</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net</span><span class="mr-2 badge badge-info">asp.net-core</span><span class="mr-2 badge badge-warning">c</span><span class="mr-2 badge badge-primary">entity-framework</span><span class="mr-2 badge badge-danger">single-responsibility</span></p><div class="entry-content"><p>I fear I&#39;m asking a somewhat silly question, but I&#39;m now completely lost as to which principle I should follow.</p><p>To my understanding &#8211; in terms of <strong>Single Responsibility Principle</strong> it&#39;s best we don&#39;t <em>tweak</em> OR <em>inject services into</em> OR <em>introduce extra fields in</em> DB Context.</p><p>Simply because the purpose of DB Context is <strong>to provide database access</strong>.</p><blockquote><p>The single responsibility principle is a computer programming principle that states that every module or class should have responsibility over a single part of the functionality provided by the software, and that responsibility should be entirely encapsulated by the class. All its services should be narrowly aligned with that responsibility. Robert C. Martin expresses the principle as, &#34;A class should have only one reason to change.&#34;</p></blockquote><p>The reason why I&#39;m posting this &#8211; I&#39;m trying to refactor Service Layer code and would like to make my app set some fields automatically (e.g. <code>CreatorUserId</code>, <code>ModifierUserId</code>, <code>DeleterUserId</code>) <strong>rather than manually set all of them each time</strong> &#8211; fore more info check <a href="https://stackoverflow.com/q/52124080/5374333">this</a>.</p><p>If you look at the <a href="https://stackoverflow.com/a/52124485/5374333">answer</a> the person says</p><blockquote><p>UserId and TenantId here are just pieces of data that your repository service (here a DbContext) needs. If a service needs data, it should be injected into the service.</p></blockquote><p>also one of the comments</p><blockquote><p>Giving your DbContext open access to the session state or the Http context is clearly wrong. But having your DbContext depend on a small number of fixed parameters is fine. Both the UserId and the TenantId might be necessary to connect to the correct database using the correct identity and record audit data. All well within the single responsibility of the repository.</p></blockquote><p>But I also received different feedback from another person under <a href="https://stackoverflow.com/q/51125868/5374333">this post</a>.</p><p>Here&#39;s the <a href="https://stackoverflow.com/a/51126357/5374333">answer</a></p><blockquote><p>You should really think about whether your database context having a dependency on your tenant provider is the right thing to do. As per SRP, your database should only do a single thing and that is provide database access.</p><p>Depending on how your tenant provider affects your database access, it might make more sense to move this dependency up one level into some service that uses both the database context and the tenant provider to query data in the right way.</p></blockquote><hr/><p>The opinions seem to differ. Does anyone have any recommendations?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>What you are attempting to do, inherit DBContext and add extra logging functionality with overridden methods is architecturally fine, but unusual and potentially over complex, simply because its DBContext rather than one of your own classes.</p><p>I would not advise anyone to try to implement their own DBContext simply because you would need a deep understanding of how the class functions to be able to correctly add your own logic.</p><p>Trivially for example, you might override SaveChangesAsync(), but not SaveChanges()</p><p>It would be far more simple to wrap the DBContext calls in a Repository layer for example and put your audit functionality in there.</p><p>I think this is why you are receiving different advice. If you are confident in your understanding of DBContext then go ahead and sub class it, injecting your UserContext and call it DBContextWithUserAuditing</p><p>If you don&#39;t want to have to understand the workings of DBContext then inject a standard one, along with a UserContext into a RepositoryWithUserAuditing</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../when-following-srp-how-should-i-deal-with-validating-and-saving-entities/'>When following SRP, how should I deal with validating and saving entities</a></li><li class="list-group-item"><a href='../c-dependency-injection-with-n-tier-entity-framework-solution/'>C# &#8211; Dependency injection with n-tier Entity Framework solution</a></li><li class="list-group-item"><a href='../c-entity-framework-and-distributed-systems/'>C# &#8211; Entity Framework and distributed Systems</a></li><li class="list-group-item"><a href='../what-are-the-disconnected-scenarios-in-entity-framework/'>What are the disconnected scenarios in Entity Framework</a></li><li class="list-group-item"><a href='../c-best-practice-for-transaction-handling-using-entity-framework/'>C# &#8211; Best practice for transaction handling using Entity Framework</a></li><li class="list-group-item"><a href='../avoiding-repository-pattern-implementing-onion-architecture-with-dbcontext-only/'>Avoiding Repository pattern &#8211; implementing Onion Architecture with DbContext only</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>