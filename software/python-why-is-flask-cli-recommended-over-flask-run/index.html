<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python &#8211; Why is flask CLI recommended over Flask.run &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067300 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067300" class="post-1067300 software type-software status-publish hentry category-software tag-flask tag-python"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python &#8211; Why is flask CLI recommended over Flask.run</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">flask</span><span class="mr-2 badge badge-info">python</span></p><div class="entry-content"><p>In Flask 0.11 a <code>flask</code> CLI was introduced. Both the docs and the changelog state this is recommended.</p><p><a href="http://flask.pocoo.org/docs/0.11/server/" rel="noreferrer">Development Server docs</a>:</p><blockquote><p>Starting with Flask 0.11 there are multiple built-in ways to run a development server. The best one is the <strong>flask</strong> command line utility but you can also continue using the <code>Flask.run()</code> method.</p><h3>Command Line</h3><p>The <strong>flask</strong> command line script (Command Line Interface) is strongly recommended for development because it provides a superior reload experience due to how it loads the application. The basic usage is like this:</p><pre><code>$ export FLASK_APP=my_application
$ export FLASK_DEBUG=1
$ flask run
</code></pre></blockquote><p><a href="https://github.com/pallets/flask/blob/0.11/CHANGES#L35" rel="noreferrer">Changelog</a>:</p><blockquote><ul><li>Added <code>flask</code> and the <code>flask.cli</code> module to start the local<br /> debug server through the click CLI system. This is recommended over the old <code>flask.run()</code> method as it works faster and more reliable due to a<br /> different design and also replaces <code>Flask-Script</code>.</li></ul></blockquote><p>So far I didn&#39;t notice this &#34;superior reload experience&#34;. I fail to see the point of using the CLI over a custom script.</p><p>If using <code>Flask.run</code>, I would simply write a python file:</p><pre><code>#!/usr/bin/env python3
from my_app import app


if __name__ == &#39;__main__&#39;:
    app.run(debug=True)
</code></pre><p>If using the CLI, one would have to specify environment variables. In the CLI docs is stated that this can be integrated in the <code>activate</code> script of virtualenvwrapper. Personally I consider this to be part of the application and think it should be under version control. Alas, a shell script is needed:</p><pre><code>#!/usr/bin/env bash
export FLASK_APP=my_app:app
export FLASK_DEBUG=1

flask run
</code></pre><p>Of course this will be accompanied by an additional bat script as soon as any Windows users start to collaborate.</p><p>Also the first option allows setup written in Python before starting the actual app.</p><p>This allows for example</p><ul><li>to parse command line arguments in Python</li><li>to setup logging before running the app</li></ul><p>They seem to promote that it&#39;s possible to add custom commands. I fail to see why this is better than writing simple Python scripts, optionally exposed through entry points.</p><p>Example logging output when using a configured logger using the Python run script:</p><pre><code>$ ./run.py 
   DEBUG 21:51:22 main.py:95) Configured logging
    INFO 21:51:22 _internal.py:87)  * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
    INFO 21:51:22 _internal.py:87)  * Restarting with inotify reloader
   DEBUG 21:51:22 main.py:95) Configured logging
 WARNING 21:51:22 _internal.py:87)  * Debugger is active!
    INFO 21:51:22 _internal.py:87)  * Debugger pin code: 263-225-431
   DEBUG 21:51:25 inotify_buffer.py:61) in-event &lt;InotifyEvent: src_path=b&#39;my_app/main.py&#39;, wd=272, mask=IN_MODIFY, cookie=0, name=b&#39;main.py&#39;&gt;
   DEBUG 21:51:25 inotify_buffer.py:61) in-event &lt;InotifyEvent: src_path=b&#39;my_app/main.py&#39;, wd=272, mask=IN_MODIFY, cookie=0, name=b&#39;main.py&#39;&gt;
    INFO 21:51:25 _internal.py:87)  * Detected change in &#39;my_app/main.py&#39;, reloading
    INFO 21:51:26 _internal.py:87)  * Restarting with inotify reloader
   DEBUG 21:51:26 main.py:95) Configured logging
 WARNING 21:51:26 _internal.py:87)  * Debugger is active!
    INFO 21:51:26 _internal.py:87)  * Debugger pin code: 263-225-431
</code></pre><p>Example logging output when using a configured logger using the CLI:, notice that the root logger couldn&#39;t be setup early enough in the process.</p><pre><code>$ ./run.sh 
 * Serving Flask app &#34;appsemble.api.main:app&#34;
 * Forcing debug mode on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with inotify reloader
   DEBUG 21:51:33 main.py:95) Configured logging
 * Debugger is active!
 * Debugger pin code: 187-758-498
   DEBUG 21:51:34 main.py:95) Configured logging
   DEBUG 21:51:37 inotify_buffer.py:61) in-event &lt;InotifyEvent: src_path=b&#39;my_app/main.py&#39;, wd=272, mask=IN_MODIFY, cookie=0, name=b&#39;main.py&#39;&gt;
   DEBUG 21:51:37 inotify_buffer.py:61) in-event &lt;InotifyEvent: src_path=b&#39;my_app/main.py&#39;, wd=272, mask=IN_MODIFY, cookie=0, name=b&#39;main.py&#39;&gt;
 * Detected change in &#39;my_app/main.py&#39;, reloading
    INFO 21:51:37 _internal.py:87)  * Detected change in &#39;my_app/main.py&#39;, reloading
 * Restarting with inotify reloader
    INFO 21:51:38 _internal.py:87)  * Restarting with inotify reloader
 * Debugger is active!
 * Debugger pin code: 187-758-498
   DEBUG 21:51:38 main.py:95) Configured logging
</code></pre><p>My actual question is simply:</p><p><strong><em>Why is flask CLI recommended over <code>Flask.run</code>?</em></strong></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In the development server docs, they state there are issues with calling run() and automatically reloading code:</p><blockquote><p>This works well for the common case but it does not work well for development which is why from Flask 0.11 onwards the flask method is recommended. The reason for this is that due to how the reload mechanism works there are some bizarre side-effects (like executing certain code twice, sometimes crashing without message or dying when a syntax or import error happens).</p></blockquote><p>They claim the CLI doesn&#39;t suffer from this problem.</p><p>The first commit that seems to touch on this issue is this: <a href="https://github.com/pallets/flask/commit/3bdb90f06b9d3167320180d4a5055dcd949bf72f" rel="noreferrer">https://github.com/pallets/flask/commit/3bdb90f06b9d3167320180d4a5055dcd949bf72f</a></p><p>And there Armin Ronacher wrote:</p><blockquote><p>It is not recommended to use this function for development with
automatic reloading as this is badly supported.  Instead you should be
using the <code>flask</code> command line script&#39;s <code>runserver</code> support.</p></blockquote><p>As mentioned by Aaron Hall, it seems like the use of run() could be problematic due to the fact that all objects which are instances of classes defined in the modules being replaced won&#39;t be reinstantiated, and whenever a module is reloaded, the modules it imports aren&#39;t reloaded as well.</p><p>The details about this may be found for Python 3 at: <a href="https://docs.python.org/3/library/importlib.html?highlight=importlib#module-importlib" rel="noreferrer">https://docs.python.org/3/library/importlib.html?highlight=importlib#module-importlib</a></p><p>It states:</p><blockquote><p>As with all other objects in Python the old objects are only reclaimed after their reference counts drop to zero.</p><p>Other references to the old objects (such as names external to the module) are not rebound to refer to the new objects and must be updated in each namespace where they occur if that is desired.</p><p>When a module is reloaded, its dictionary (containing the moduleâ€™s global variables) is retained. Redefinitions of names will override the old definitions, so this is generally not a problem. If the new version of a module does not define a name that was defined by the old version, the old definition remains.</p></blockquote><p>So, by creating a new process and killing the old one, you naturally eliminate all obsolete references.</p><p>Also, Flask&#39;s CLI uses the &#39;click&#39; module, making it very easy to add custom commands, but most importantly, besides fixing the reloading bug, the CLI offers a standardised way to run applications and add custom commands. This sounds like a very good thing, because it makes familiarity with Flask more transferable between different teams and applications, rather than having multiple ways to do the same thing.</p><p>It seems like a genuine way to make Flask more in accordance to the Zen of Python:</p><blockquote><p>There should be one-- and preferably only one --obvious way to do it.</p></blockquote></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../python-how-to-structure-a-larger-flask-application/'>Python &#8211; How to structure a larger Flask application</a></li><li class="list-group-item"><a href='../rest-communication-in-a-microservices-architecture-with-flask-and-rest/'>Rest &#8211; Communication in a microservices architecture with flask and REST</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>