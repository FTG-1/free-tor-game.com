<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Ending up with too many services in DDD &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085926 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085926" class="post-1085926 software type-software status-publish hentry category-software tag-domain-driven-design"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Ending up with too many services in DDD</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">domain-driven-design</span></p><div class="entry-content"><p>I&#39;m working on a project at the moment and I&#39;m using this project to try and apply DDD. However, there are parts of my implementation that I just can&#39;t get my head around or don&#39;t feel right. I&#39;ll try to describe how I currently have my application setup;</p><p>In my domain layer, I have my aggregates, value objects and a service class for each bounded context. As an example, I have a bounded context &#39;Account&#39; with the following;</p><p>Account &#8211; account aggregate root</p><p>Profile &#8211; value object</p><p>EmailAddress &#8211; value object</p><p>AccountValidator &#8211; validates an accounts state</p><p>ProfileValidator &#8211; validates a profiles state</p><p>AccountRepository &#8211; interface describing the methods available on the repository</p><p>AccountService &#8211; at the minute this has a single method createNewAccount(), it accepts a number of primitive values and creates the account and returns it. Before creating the account it first checks to make sure the selected username doesn&#39;t already exist. If the username exists, it throws an Exception. (Should this rule be in the domain service?)</p><p>In my application layer I have;</p><p>AccountRepositoryImp &#8211; an implementation of the accountRepository in the domain class, this is a standard Spring Data interface that implements accountRepository.</p><p>AccountFacade &#8211; basically, another account service that provides methods such as findById(), findByUsername(), createNewAccount(), sendVerificationEmail(), verifyAccount.</p><p>AccountController &#8211; standard Spring controller that handles all account related actions</p><p>I have a number of questions/issues with my approach;</p><ol><li>I have two service classes for each bounded content, one for the domain and one for the application, and while I understand the domain service class should be used only to apply behaviour or business rules that can&#39;t be done on the aggregate itself (i.e. need db access), I&#39;m struggling to determine what&#39;s an application rule and what&#39;s a business rule. For example, an account cannot be created if the username is already in use, I&#39;ve put this in my domain service, but I&#39;m starting to wonder if it should belong in the createNewAccount() method in the application service. Another rule, &#34;An account can only be deleted by an admin or the account hold themselves&#34;, is this application or business?</li><li>As I add more and more methods to my application service, it&#39;s going to grow pretty big. This leads me to thinking about implementing CQRS and having a class/method for each command/query. This breaks things down and makes it easier to manage, but I can&#39;t help but feel this will bring a lot of duplication to it. For example, In the AccountRepository I can retrieve an account by it&#39;s username, and if the account doesn&#39;t exist it returns null. Rather than returning null, I wrote a getByUsername() method in the application service so that it throws an exception if the account doesn&#39;t exist, rather than a null. This means I can use this method from other methods and I don&#39;t need to duplicate throwing the exception. I feel like if I use CQRS, I&#39;m still going to have to keep the application service so it can hold methods that are used by multiple commands/queries to reduce duplicate. I&#39;ll end up with yet another layer controller -&gt; command/query -&gt; applicationservice -&gt; domainservice it feels like I&#39;m making the application more complicated than it needs to be</li><li>If I use CQRS, is the command/query or controller responsible for building ViewModels? I&#39;m inclined to thing the command/query can build them, as they&#39;ll be use case based and can be re-used if I was to add REST endpoints to the system in the future. If I allowed the controller to make multiple command/queries and build the ViewModel, then if I implement REST at a later date, I&#39;ll have to duplicate that code.</li><li><p>Rules &#8211; as mentioned above I&#39;m struggling to assign rules to the application or domain. I&#39;ll list a few rules below and if I could have some pointer on where they might belong, it would be useful to train my brain;</p><ul><li>An account cannot be created without an email, username, firstname and lastname (I&#39;ve put this on the domain)</li><li>An account cannot be created if the username is in use (I&#39;ve put it on the domain)</li><li>A user cannot comment on a project if they are not a project member.</li><li>A comment cannot be left on a closed project</li><li>Only the project owner can edit/manage/administer the project</li></ul></li></ol><p>I do apologise if this question is a little unstructured and my thoughts do appear a bit random. I&#39;ve been so used to using an anemic model that I&#39;ve got so many thoughts in my head that I can&#39;t structure (hence the question).</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Off the top</p><p>1) If you are having trouble modeling your domain, CQRS is unlikely to help.</p><p>2) Your &#34;unique email constraint&#34; is a common example of <a href="http://codebetter.com/gregyoung/2010/08/12/eventual-consistency-and-set-validation/" rel="nofollow noreferrer">Set Validation</a>.  Trying to ensure uniqueness of an element in a <em>distributed</em> set with multiple writers is a Hard Problem.</p><p>In some domains, you can use the email address as the unique identifier for the account itself (either the email address itself, or some hash/uuid value computed from the email address).  That&#39;s easier than set validation, but has implications on use cases where an email address may change.</p><p>Email addresses themselves are something of a special case.  Your domain probably <em>isn&#39;t</em> the authority for an email address; the address was assigned somewhere else, and you are just receiving a copy of it.  So you may want to consider carefully what is really possible with <a href="https://hackernoon.com/the-100-correct-way-to-validate-email-addresses-7c4818f24643" rel="nofollow noreferrer">email validation</a>.</p><p>Domain services don&#39;t normally have domain logic -- computing changes of state belongs in the aggregates, not in the services.  Most domain services are either queries to give the aggregate read access to a cached copy of data that lives somewhere else, or to give the aggregate access to some capability outside of the model (like sending an email).  The domain service itself may be little more than an interface, with all of the details of the implementation defined in the application/infrastructure components that provide the capability.</p><p>Finally - most domains don&#39;t need a bespoke solution for account management.  Are you sure you shouldn&#39;t be using something off the shelf to solve this part of the problem?</p><blockquote><p>am I right in saying that you wouldn&#39;t inject the domain service into the aggregate? i.e., you&#39;d call the domain service first?</p></blockquote><p>No - I pass the domain service to the aggregate as an argument, and let the business logic in the aggregate method determine whether or not to invoke the domain service capabilities.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../ddd-cqrs-per-query-and-per-command-authorization/'>DDD CQRS &#8211; per-query and per-command authorization</a></li><li class="list-group-item"><a href='../implementing-ddd-users-and-permissions/'>Implementing DDD: users and permissions</a></li><li class="list-group-item"><a href='../does-cqrs-need-to-be-fire-and-forget-if-we-need-to-read-guarantee-after-command/'>Does CQRS need to be fire and forget, If we need to read guarantee after command</a></li><li class="list-group-item"><a href='../c-ddd-factory-or-service/'>C# &#8211; DDD &#8211; Factory or Service</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>