<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Design &#8211; Is storing files of up to 50MB in size in a database for use by multiple servers a reasonable idea? Example inside &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080384 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080384" class="post-1080384 software type-software status-publish hentry category-software tag-design tag-file-storage tag-relational-database tag-server"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Design &#8211; Is storing files of up to 50MB in size in a database for use by multiple servers a reasonable idea? Example inside</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">file-storage</span><span class="mr-2 badge badge-warning">relational-database</span><span class="mr-2 badge badge-primary">server</span></p><div class="entry-content"><p>I&#39;m in the process of designing a server responsible for serving files that are between 10MB and 50MB in size.<br /> Initially we will run two instances of the server (lets call them <code>fs1</code> and <code>fs2</code>), with future plans to switch to a micro-service architecture, where the server instances will grow or shrink depending on the load.</p><p>These two instances need to interact with a third server running a scheduler and a file management application, as well as a database (on another server) where some metadata will be saved for clients to use.</p><p>My initial thoughts where to use a rabbitmq to allow the fs1 and fs2 to communicate with each other and the management app. the process would work as follows:</p><ol><li>The management app uploads to fs1 server (could be either fs1 or fs2)</li><li>fs1 notifies fs2 and the management app when upload is complete</li><li>fs2 contacts fs1 and stores a copy of the file</li><li>fs2 notifies the management app when upload is complete</li><li>The management app saves metadata to the external database</li><li>both fs1 and fs2 can now server the files when requested</li></ol><p>This seems OK, if there are only two instances, but once you start adding more it doesn&#39;t work.<br /> Our ops department are very much against the idea of using the database to store files. They are worried that it will slow down the system too much. I agree it might, which is why I want a separate database for the specific purpose of storing the files and metadata.<br /> I want to build something like the following:<br /> <a href="../../../i.stack.imgur.com/ox6r9.png" rel="nofollow noreferrer"><img src="../../../i.stack.imgur.com/ox6r9.png" alt="system diagram"/></a></p><p>My thinking is that the upload service can manage uploading of files and saving of metadata to the database.<br /> When the scheduler schedules a new job, the upload service (badly named, I know, but I&#39;m not making that image again ðŸ™‚ ) can notify the file server instances that they need to cache the required file(s) from the database, which they can access directly.<br /> The file servers won&#39;t need to cache more than 5 or 6 files each at a time.<br /> Also, in the diagram I missed that the file management service will receive download progress messages from both file servers.</p><p>So to my questions:</p><ol><li>Is this a reasonable way to store files of this size for serving?</li><li>Is this the right way to be thinking when considering the move to microservices in the future?</li><li>Are there advantages to storing the files on the file system of each fs instance instead of just caching?</li><li>How can I convince our ops team that storing 50MB files in a database is the way to go? what are the pros and cons?</li><li>Any other thoughts or comments appreciated.</li></ol></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><h1>NO, don&#39;t store files in a relational database</h1><p><em>Trust me, I&#39;ve learned this the <strong>hard way</strong></em>. One problem with applications that deal with files, is as they evolve, the users always want to store more than the application was intended to handle.</p><p>I once created an application with a document storage component meant to store Word and Excel documents. The storage component was useful enough that eventually people started storing <strong>videos</strong> in it.</p><p>I mention this because, the performance implications will be higher than you expect; this leads me to my next point.</p><p>Even if a database can handle files fine (filestream type) scaling a DB is hard, it is always the hardest part to scale. Let the db concentrate on saving and retrieving data, that way you can put off scaling it as long as possible. If your DB is busy serving a large file, those are resources not being used to serve transaction and lookup requests; its bread and butter.</p><h2>Server to Server synchronization does not scale well</h2><p>Your system seems over-complicated to me, I would go with a simpler design. The problem with servers fs1 and fs2 talking to each other is, as you scale, the number of paths increases exponentially.</p><p>With two servers, each server only has to ask make one synch request, for a total of 2 paths. 3 severs, there are a total of 6. With 5 servers there are 20. <code>synchRequests = (n-1)*(n); n = number of servers</code></p><p>I would simply have a dedicated DB server, and a dedicated File server that the FSn servers talk to to.  If you need more complex synchronization behavior, add a dedicated Redis serve in the mix to serve as the single source of truth for non-persistent details.</p><p>The point is, don&#39;t have fs1 talking to fs2, or vice-versa, this will not scale.</p><h2>Graph</h2><pre><code>                             [ fs1 ] [ fs2 ] [ fs3 ] [ ect ]
                                |       |       |       |
                                +-------+---+---+-------+
                                            |
                         +------------------+-------------------+
                         |                  |                   |
                      [ RDB ]           [ Redis ]           [ Files ] 
</code></pre><h2>The best of both worlds?</h2><p>You can head off most of the disadvantages of storing your files in a RDB, and still get most of the advantages by segregating a <em>completely separate</em> DB instance and storing only your files there. This is a viable option if you don;t want to setup and maintain a file server.</p><h2>A quick word about microservices</h2><p>I am not sure why you would want to go the microservices route. The original intent of microservices is to get around <strong>political</strong> problems, not technical problems. For example, the server admin refuses to open any ports other than 80.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-file-storage-for-a-blog-component-database-or-filesystem/'>C# &#8211; File storage for a blog component: database or filesystem</a></li><li class="list-group-item"><a href='../why-not-use-a-rtos-with-microkernel-architecture-for-highly-concurrent-web-servers/'>Why not use a RTOS with microkernel architecture for highly concurrent web servers</a></li><li class="list-group-item"><a href='../database-how-to-track-file-uploads-and-return-upload-status-with-rest/'>Database &#8211; How to Track File Uploads and Return Upload Status with REST</a></li><li class="list-group-item"><a href='../web-development-why-do-many-cms-use-a-database-and-not-local-files/'>Web-development &#8211; Why do many CMS use a database and not local files</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>