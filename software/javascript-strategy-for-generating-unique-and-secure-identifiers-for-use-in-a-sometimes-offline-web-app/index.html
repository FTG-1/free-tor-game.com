<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Javascript &#8211; Strategy for generating unique and secure identifiers for use in a &#8220;sometimes offline&#8221; web app &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1067054 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1067054" class="post-1067054 software type-software status-publish hentry category-software tag-javascript tag-mongodb tag-offline tag-uuid"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Javascript &#8211; Strategy for generating unique and secure identifiers for use in a &#8220;sometimes offline&#8221; web app</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">javascript</span><span class="mr-2 badge badge-info">mongodb</span><span class="mr-2 badge badge-warning">offline</span><span class="mr-2 badge badge-primary">uuid</span></p><div class="entry-content"><p>I have a web based project that allows users to work both online and offline and I&#39;m looking for a way to generate unique ids for records on the client side. I&#39;d like an approach that works while a user is offline (i.e. unable to talk to a server), is guaranteed to be unique, and is secure. By &#34;secure&#34;, I&#39;m specifically worried about clients submitting duplicate id&#39;s (maliciously or otherwise) and thereby wreaking havoc on data integrity.</p><p>I&#39;ve been doing some googling, hoping this was already a solved problem. I haven&#39;t found anything that&#39;s very definitive, especially in terms of approaches that are in use in production systems. I found some examples for systems where users will only access the data that they&#39;ve created (e.g. a Todo list that&#39;s accessed on multiple devices, but only by the user who created it). Unfortunately, I need something a bit more sophisticated. I did find some really good ideas <a href="https://stackoverflow.com/questions/10697975/generate-truly-globally-unique-id-across-many-clients-and-servers">here</a>, which are in line with how I was thinking things might work.</p><p>Below is my proposed solution.</p><h2>Some Requirements</h2><ol><li>IDs should be globally unique (or at least unique within the system)</li><li>Generated on the client (i.e. via javascript in the browser)</li><li>Secure (as outlined above and otherwise)</li><li>Data can be viewed/edited by multiple users, including users who didn&#39;t author it</li><li>Doesn&#39;t cause significant performance issues for backend db&#39;s (such as MongoDB or CouchDB)</li></ol><h2>Proposed Solution</h2><p>When users create an account, they would be given a uuid which was generated by the server and known to be unique within the system. This id must NOT be the same as the users authentication token. Let&#39;s call this id the users &#34;id token&#34;.</p><p>When a user creates a new record, they generate a new uuid in javascript (generated using window.crypto when available. See examples <a href="https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript">here</a>). This id is concatenated with the &#34;id token&#34; the user received when they created their account. This new composite id (server side id token + client side uuid) is now the unique identifier for the record. When the user is online and submits this new record to the backend server, the server would:</p><ol><li>Identify this as an &#34;insert&#34; action (i.e. not an update or a delete)</li><li>Validate both parts of the composite key are valid uuids</li><li>Validate that the provided &#34;id token&#34; part of the composite id is correct for the current user (i.e. it matches the id token the server assigned to the user when they created their account)</li><li>If everything is copasetic, insert the data into the db (being careful to do an insert and not an &#34;upsert&#34; so that if the id <em>does</em> already exists it doesn&#39;t update an existing record by mistake)</li></ol><p>Queries, updates, and deletes wouldn&#39;t require any special logic. They would simply use the id for the record in the same manner as traditional applications.</p><h2>What are the advantages of this approach?</h2><ol><li><p>Client code can create new data while offline and know the id for that record immediately. I considered alternate approaches where a temporary id would be generated on the client which would later be swapped out for a &#34;final&#34; id when the system was online. However, this felt very brittle. Especially when you start thinking about creating child data with foreign keys that would also need to be updated. Not to mention dealing with urls that would change when the id changed.</p></li><li><p>By making ids a composite of a client generated value AND a server generated value, each user is effectively creating ids in a sandbox. This is intended to limit the damage that can be done by a malicious/rogue client. Also, any id collisions are on a per user basis, not global to the entire system.</p></li><li><p>Since a users id token is tied to their account, ids can only be generated in a users sandbox by clients that are authenticated (i.e. where the user successfully logged in). This is intended to keep malicious clients from creating bad ids for a user. Of course if a users auth token were stolen by a malicious client, they could do bad things. But, once an auth token has been stolen the account is compromised anyhow. In the event that this did happened, the damage done would be limited to the compromised account (not the entire system).</p></li></ol><h2>Concerns</h2><p>Here are some of my concerns with this approach</p><ol><li><p>Will this generate sufficiently unique ids for a large scale application? Is there any reason to think this will result in id collisions? Can javascript generate a sufficiently random uuid for this to work? It looks like window.crypto is <a href="https://developer.mozilla.org/en-US/docs/Web/API/window.crypto.getRandomValues" rel="noreferrer">fairly widely available</a> and this project already requires reasonably modern browsers. (<a href="https://stackoverflow.com/questions/23164474/how-unique-and-random-are-javascript-generated-uuids">this question now has a separate SO question of its own</a>)</p></li><li><p>Are there any loopholes that I&#39;m missing which could allow a malicious user to compromise the system?</p></li><li><p>Is there reason to worry about DB performance when querying for a composite key made up of 2 uuids. How should this id be stored for best performance? Two separate fields or a single object field? Would there be a different &#34;best&#34; approach for Mongo vs Couch? I know that having a non-sequential primary key can cause notable performance issues when doing inserts. Would it be smarter to have an auto generated value for the primary key and store this id as a separate field? (<a href="https://stackoverflow.com/questions/23164417/mongodb-and-composite-primary-keys">this question now has a separate SO question of its own</a>)</p></li><li><p>With this strategy, it would be easy to determine that a particular set of records was created by the same user (since they&#39;d all share the same publicly visible id token). While I don&#39;t see any immediate issues with this, it&#39;s always better to not leak more info about internal details than is needed. Another possibility would be to hash the composite key, but that seems like it may be more trouble than it&#39;s worth.</p></li><li><p>In the event that there is an id collision for a user, there&#39;s not a simple way to recover. I suppose the client could generate a new id, but this seems like a lot of work for an edge case that really shouldn&#39;t ever happen. I&#39;m intending to leave this unaddressed.</p></li><li><p>Only authenticated users can view and/or edit data. This is an acceptable limitation for my system.</p></li></ol><h2>Conclusion</h2><p>Is above a reasonable plan? I realize some of this comes down to a judgement call based on a fuller understanding of the application in question.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your approach will work.  A lot of document management systems use this type of approach.</p><p>One thing to consider is that you don&#39;t need to use both the user uuid and the random item id as part of the string.  You can instead hash the concatination of both.  This will give you a shorter identifier, and possibly some other benefits because the resultant id&#39;s will be more evenly distributed (better balanced for indexing, and file storage if you are storing files based on their uuid).</p><p>Another option you have is to generate just a temporary uuid for each item.  Then when you do connect and post them to the server, the server generates (guaranteed) uuid&#39;s for each item and returns that to you.  You then update your local copy.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-to-generate-language-safe-uuids/'>How to generate &#8220;language-safe&#8221; UUIDs</a></li><li class="list-group-item"><a href='../javascript-client-side-authentication-through-signatures-instead-of-passwords/'>Javascript &#8211; Client side authentication through signatures instead of passwords</a></li><li class="list-group-item"><a href='../how-to-create-uuids-in-ddd-entities-aggregates/'>How to create Uuids in DDD Entities/Aggregates</a></li><li class="list-group-item"><a href='../database-should-backend-ids-be-public-or-not-on-a-rest-api/'>Database &#8211; Should backend IDs be public or not on a REST API</a></li><li class="list-group-item"><a href='../javascript-python-and-javascript-integration-for-offline-use/'>Javascript &#8211; Python and JavaScript integration for offline use</a></li><li class="list-group-item"><a href='../c-should-i-generate-guid-uuid-on-client-or-server/'>C# &#8211; Should I generate GUID/UUID on client or server</a></li><li class="list-group-item"><a href='../architecture-for-online-offline-web-application/'>Architecture for Online-Offline Web Application</a></li><li class="list-group-item"><a href='../offline-login-procedure-in-pwa/'>Offline-Login Procedure in PWA</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>