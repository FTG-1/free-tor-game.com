<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Python &#8211; Coming up with tokens for a lexer &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071723 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071723" class="post-1071723 software type-software status-publish hentry category-software tag-lexer tag-parsing tag-python"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Python &#8211; Coming up with tokens for a lexer</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">lexer</span><span class="mr-2 badge badge-info">parsing</span><span class="mr-2 badge badge-warning">python</span></p><div class="entry-content"><p>I&#39;m writing a parser for a markup language that I have created (writing in python, but that&#39;s not really relevant to this question &#8212; in fact if this seems like a bad idea, I&#39;d love a suggestion for a better path).</p><p>I&#39;m reading about parsers here: <a href="http://www.ferg.org/parsing/">http://www.ferg.org/parsing/</a>, and I&#39;m working on writing the lexer which should, if I understand correctly, split the content into tokens.  What I&#39;m having trouble understanding is what token types I should use or how to create them.  For example, the token types in the example I linked to are:</p><ul><li>STRING</li><li>IDENTIFIER</li><li>NUMBER</li><li>WHITESPACE</li><li>COMMENT</li><li>EOF</li><li>Many symbols such as { and ( count as their own token type</li></ul><p>The problem I&#39;m having is that the more general token types seem a bit arbitrary to me.  For example, why is STRING its own separate token type vs. IDENTIFIER.  A string could be represented as STRING_START + (IDENTIFIER | WHITESPACE) + STRING_START.</p><p>This may also have to do with the difficulties of my language.  For example, variable declarations are written as <code>{var-name var value}</code> and deployed with <code>{var-name}</code>.  It seems like <code>&#39;{&#39;</code> and <code>&#39;}&#39;</code> should be their own tokens, but are VAR_NAME and VAR_VALUE eligible token types, or would these both fall under IDENTIFIER?  What&#39;s more is that the VAR_VALUE can actually contain whitespace.  The whitespace after <code>var-name</code> is used to signify the start of the value in the declaration .. any other whitespace is part of the value.  Does this whitespace become its own token?  Whitespace only has that meaning in this context.  Moreover, <code>{</code> may not be the start of a variable declaration .. it depends on the context (there&#39;s that word again!). <code>{:</code> starts a name declaration, and <code>{</code> can even be used as part of some value.</p><p>My language is similar to Python in that blocks are created with indentation.  I was reading about how Python uses the lexer to create INDENT and DEDENT tokens (that serve more or less as what <code>{</code> and <code>}</code> would do in a lot of other languages).  Python claims to be context-free which means to me that at least the lexer shouldn&#39;t care about where it is in the stream while creating tokens.  How does Python&#39;s lexer know it&#39;s building an INDENT token of a specific length without knowing about previous characters (e.g. that the previous line was a newline, so start creating the spaces for INDENT)?  I ask because I need to know this too.</p><p>My final question is the stupidest one: why is a lexer even necessary?  It seems to me that the parser could go character-by-character and figure out where it is and what it expects.  Does the lexer add the benefit of simplicity?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Your question (as your final paragraph hints) is not really about the lexer, it is about the correct design of the interface between the lexer and the parser.  As you might imagine there are many books about the design of lexers and parsers.  I happen to like the <a href="http://dickgrune.com/Books/PTAPG_2nd_Edition/" rel="noreferrer">parser book by Dick Grune</a>, but it may not be a good introductory book.  I happen to intensely dislike the <a href="http://www.cs.princeton.edu/~appel/modern/c/" rel="noreferrer">C-based book by Appel</a>, because the code is not usefully extensible into your own compiler (because of the memory management issues inherent in the decision to pretend C is like ML). My own introduction was <a href="http://www.goodreads.com/book/show/6791434-writing-interactive-compilers-and-interpreters" rel="noreferrer">the book by PJ Brown</a>, but it&#39;s not a good general introduction (though quite good for interpreters specifically).  But back to your question.</p><p>The answer is, do as much as you can in the lexer without needing to use forward- or backward-looking constraints.</p><p>This means that (depending of course on the details of the language) you should recognise a string as a &#34; character followed by a sequence of not-&#34; and then another &#34; character.   Return that to the parser as a single unit.   There are several reasons for this, but the important ones are</p><ol><li>This reduces the amount of state the parser needs to maintain, limiting its memory consumption.</li><li>This allows the lexer implementation to concentrate on recognising the fundamental building blocks and frees the parser up to describe how the individual syntactic elements are used to build a program.</li></ol><p>Very often parsers can take immediate actions on receiving a token from the lexer.   For example, as soon as IDENTIFIER is received, the parser can perform a symbol table lookup to find out if the symbol is already known.    If your parser also parses string constants as QUOTE (IDENTIFIER SPACES)* QUOTE you will perform a lot of irrelevant symbol table lookups, or you will end up hoisting the symbol table lookups higher up the parser&#39;s tree of syntax elements, because you can only do it at the point you&#39;re now sure you are not looking at a string.</p><p>To restate what I&#39;m trying to say, but differently, the lexer should be concerned with the spelling of things, and the parser with the structure of things.</p><p>You might notice that my description of what a string looks like seems a lot like a regular expression.   This is no coincidence.  Lexical analysers are frequently implemented in <a href="http://c2.com/cgi/wiki?LittleLanguage" rel="noreferrer">little languages</a> (in the sense of <a href="http://www.cs.bell-labs.com/cm/cs/pearls/" rel="noreferrer">Jon Bentley&#39;s excellent <em>Programming Pearls</em> book</a>) which use regular expressions.   I&#39;m just used to thinking in terms of regular expressions when recognising text.</p><p>Regarding your question about whitespace, recognise it in the lexer.   If your language is intended to be pretty free-format, don&#39;t return WHITESPACE tokens to the parser, because it will only have to throw them away, so your parser&#39;s production rules will be spammed with noise essentially - things to recognise just to throw them away.</p><p>As for what that means about how you should handle whitespace when it is syntactically significant, I&#39;m not sure I can make a judgment for you that will really work well without knowing more about your language.    My snap judgment is to avoid cases where whitespace is sometimes important and sometimes not, and use some kind of delimiter (like quotes).   But, if you can&#39;t design the language any which way you prefer, this option may not be available to you.</p><p>There are other ways to do design language parsing systems.  Certainly there are compiler construction systems that allow you to specify a combined lexer and parser system (I think the Java version of <a href="http://www.antlr.org/" rel="noreferrer">ANTLR</a> does this) but I have never used one.</p><p>Last a historical note.   Decades ago, it was important for the lexer to do as much as possible before handing over to the parser, because the two programs would not fit in memory at the same time.   Doing more in the lexer left more memory available to make the parser smart.   I used to use the <em><a href="http://en.wikipedia.org/wiki/Whitesmiths" rel="noreferrer">Whitesmiths</a> C Compiler</em> for a number of years, and if I understand correctly, it would operate in only 64KB of RAM (it was a small-model MS-DOS program) and even so it translated a variant of C that was very very close to ANSI C.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../is-it-possible-to-create-a-single-tokenizer-to-parse-this/'>Is it possible to create a single tokenizer to parse this</a></li><li class="list-group-item"><a href='../the-proper-way-to-distinguish-between-keywords-and-identifiers/'>The proper way to distinguish between keywords and identifiers</a></li><li class="list-group-item"><a href='../can-you-apply-the-same-lexer-rules-to-all-programming-languages/'>Can you apply the same lexer rules to all programming languages</a></li><li class="list-group-item"><a href='../what-should-be-the-datatype-of-the-tokens-a-lexer-returns-to-its-parser/'>What should be the datatype of the tokens a lexer returns to its parser</a></li><li class="list-group-item"><a href='../when-to-use-a-parser-combinator-when-to-use-a-parser-generator/'>When to use a Parser Combinator? When to use a Parser Generator</a></li><li class="list-group-item"><a href='../should-the-lexer-allow-what-is-obviously-a-syntax-error/'>Should the lexer allow what is obviously a syntax error</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>