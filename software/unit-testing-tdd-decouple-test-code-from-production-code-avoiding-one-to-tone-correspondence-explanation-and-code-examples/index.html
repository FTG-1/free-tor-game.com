<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; TDD: Decouple test code from production code, avoiding one-to-tone correspondence. Explanation and code examples &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081265 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081265" class="post-1081265 software type-software status-publish hentry category-software tag-tdd tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; TDD: Decouple test code from production code, avoiding one-to-tone correspondence. Explanation and code examples</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">tdd</span><span class="mr-2 badge badge-info">unit testing</span></p><div class="entry-content"><p>I try to understand better under what circumstances one-to-one correspondence between test code and production code is not needed, after reading Uncle Bob&#39;s <a href="http://blog.cleancoder.com/uncle-bob/2017/03/03/TDD-Harms-Architecture.html" rel="nofollow noreferrer">TDD Harms Architecture</a>. For example, first:</p><p>&#34;a one-to-one correspondence implies extremely tight coupling.&#34;</p><p>then below:</p><p>&#34;If you look at part of FitNesse written after 2008 or so, youâ€™ll see that there is a significant drop in the one-to-one correspondence. The tests and code look more like the green design on the right.&#34;</p><p>It does not explain why the one-to-one correspondence is dropped.</p><p>I want to know why, on the assumption that only public method is tested</p><ul><li>Is it because the production class or method are covered by other test class/method INDIRECTLY? or</li><li>Is it because they are so trivial, or the developer is so confident, that the test code is dropped? or</li><li>Are there general design pattern or rules that can help writing code that decouples test from production code?</li><li>Any other reason?</li></ul><p>Could anyone please explain?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>Is it because the production class or method are covered by other test class/method INDIRECTLY?</p></blockquote><p>Basically yes. The tests are there to ensure the system has some property. Usually that the system provides some functionality. (We sometimes write test to reproduce a defective behavior, too, however, for instance when filing a bug report.) So if you write new tests that are less fragile because they are more decoupled from the production code, and also more expressive because they state what functionality the system achieves, and not how the system achieves it; the old <em>direct</em> tests don&#39;t provide any additional value, and should be removed because they are a maintenance burden. Indirection enables you to achieve both decoupling and expressiveness.</p><blockquote><p>Are there general design pattern or rules that can help writing code that decouples test from production code?</p></blockquote><p>Uncle Bob&#39;s green diagram on the right would be and example of the facade pattern because it hides multiple, complicated services behind a single interface.</p><p>To clarify one thing for junior developers do not read Uncle Bob&#39;s UML diagram literally. Services implement the facade in a loose sense.</p><p>See below example to see how application services <em>implement</em> the test facade. Also to see the difference/relationship between and the application facade and the test facade (as per @jonrsharpe&#39;s comment). A tip can be: write your test facade such that it reads like the stories you will demo, or the scenarios in your test plan etc. :</p><pre><code>class SomeTestClass
{
    public void users_cant_register_without_providing_contact_info()
    {
        failsWithMissingContactInfoErrorMessage( 
            () -&gt; user.sendsRegistrationFormWithMissingContactInfo());

        admin.doesntSeeInRegisteredUsers(user);
    }

    private failsWithMissingContactInfoErrorMessage(Runnable r)
    {
        failsWithErrorMentioning(r, MissingContactInfo.class, &#34;missing contact&#34;);
    }
}

class UserFacade // Can be named after roles
{
    CommandInterface handler;
    ViewInterface view;

    String enteredEmail;
    String enteredPhoneNumber;

    void sendsRegistrationFormWithMissingContactInfo()
    {
        fillsTheForm();
        leavesEmailBlank();
        leavesPhoneNumberBlank();
        sendsRegistrationForm();
    }

    void leavesEmailBlank()
    {
        this.enteredEmail = &#34;&#34;;
    }

    void leavesPhoneNumberBlank()
    {
        this.enteredPhoneNumber = &#34;&#34;;
    }

    void entersAValidEmail()
    {
        this.enteredEmail = &#34;valid@example.com&#34;;
    }

    void entersAValidPhoneNumber()
    {
        this.enteredPhoneNumber = &#34;+1-541-754-3010&#34;;
    }

    void entersAnInvalidPhoneNumber()
    {
        this.enteredPhoneNumber = &#34;##123456**&#34;;
    }

    void sendsRegistrationForm()
    {
        handler.handle(new RegisterNewUser(enteredEmail, enteredPhoneNumber));
    }

}

class AdminFacade
{
    BackEnd backEnd;

    void doesntSeeInRegisteredUsers(UserFacade user)
    {
        // ....
    }
}
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/unit-testing-at-what-point-would-you-drop-some-of-your-principles-of-software-development-for-the-sake-of-more-money/'>Unit-testing &#8211; At what point would you drop some of your principles of software development for the sake of more money</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/unit-testing-how-should-you-tdd-a-yahtzee-game/'>Unit-testing &#8211; How should you TDD a Yahtzee game</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/start-with-a-passing-unit-test/'>Start with a passing unit test</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/tdd-red-green-refactor-and-if-how-to-test-methods-that-become-private/'>TDD Red-Green-Refactor and if/how to test methods that become private</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/need-for-an-ioc-container-in-tdd-unit-tests/'>Need for an IoC container in TDD unit tests</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>