<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Rest &#8211; Event sourcing and REST &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070581 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070581" class="post-1070581 software type-software status-publish hentry category-software tag-design tag-event-sourcing tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Rest &#8211; Event sourcing and REST</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design</span><span class="mr-2 badge badge-info">event-sourcing</span><span class="mr-2 badge badge-warning">rest</span></p><div class="entry-content"><p>I came across Event Sourcing design and I would like to use in an application where a REST client is needed (RESTful to be precise). However I fail to connect these together as REST is quite CRUD-like and event sourcing is task based. I was wondering how can you designed the creation of commands based on requests to REST server. Consider this example:</p><p>With REST you can put a new state to the resource called File. In one request you can send new file name, you can change the parent folder and/or change owner of the file and so on.</p><p>How to construct the server so I can use event sourcing. I was thinking about these possibilities:</p><ol><li><p>Determine on server which fields were changed and create appropriate commands (<code>RenameFileCommand</code>, <code>MoveFileCommand</code>, <code>ChangeOwnerCommand</code>, &#8230;) and dispatch these individually. However in this setup, each of the command can fail leaving others out of transaction and thus out of &#34;atomic&#34; change to the resource.</p></li><li><p>Dispatch only one command (<code>UpdateFileCommand</code>) and in the command handler, more precisely in the aggregate, determine which fields were changed and send individual events instead (<code>FileRenamedEvent</code>, <code>FileMovedEvent</code>, <code>OwnerChangedEvent</code>, &#8230;)</p></li><li><p>This one I don&#39;t like at all: In the request to the server I would specify in the headers which command to use, because the UI is still task based (but communication is done via REST). However it will fail in any other use of REST communication (e.g. in external apps) as they are not bound to change only the one field in one request. Also I bring quite a big coupling into the UI, REST, and ES-based backend.</p></li></ol><p>Which one would you prefer or is there any better way to handle this?</p><p>Side note: app written in Java and Axon Framework for event-sourcing.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I think you may have a user-process to implementation mismatch here.</p><p>First: will a user honestly want to perform <em>multiple</em> changes to a file simultaneously?
A rename (which may or may not include a change of path?), change of ownership, and perhaps change of file contents (for sake of argument) seem like separate actions.</p><p>Lets take the case where the answer is &#34;yes&#34; - your users really do want to make these changes simultaneously.</p><p>In that case, I&#39;d strongly recommend against any implementation that sends multiple events - <code>RenameFileCommand</code>, <code>MoveFileCommand</code>, <code>ChangeOwnerCommand</code> - to represent this <strong>single</strong> user intent.</p><p>Why?  Because events can fail.  Maybe its extremely rare, but your user submitted an operation that looked atomic - if a single one of the downstream events fails, then your application state is now invalid.</p><p>You are also inviting race hazards on a resource that is clearly shared between each of the event handlers.  You will need to write &#34;ChangeOwnerCommand&#34; in such a way that the file name and file path do not matter, because they could be out of date by the time the command is received.</p><p>When implementing a non-event driven restful system with moving and renaming files, I prefer to ensure consistency by using something like an eTag system - ensure that the version of the resource being edited is the version that the user last retrieved, and fail if it has been modified since then.  But if you are dispatching multiple commands for this single user operation, you will need to increment your resource version after each command - so you have no way to know that the resource the user is editing really is the same version as the resource they last read.</p><p>What I mean by that is - what if someone else performs another operation on the file at nearly the same time.  The 6 commands could stack up in any order.  If we had just 2 atomic commands, the earlier command could succeed and the later command could fail &#34;resource has been modified since it was last retrieved&#34;.  But there is no protection against this when the commands are not atomic, so system consistency is violated.</p><p>Interestingly there is a movement toward something like event based architecture in REST, called &#34;Rest without PUT&#34;, recommended in the <a href="http://www.thoughtworks.com/radar/techniques/rest-without-put">Thoughtworks technology radar, Jan 2015</a>.   There is a considerably longer blog about <a href="http://www.thoughtworks.com/insights/blog/rest-api-design-resource-modeling">Rest without PUT here</a>.</p><p>Essentially, the idea is that POST, PUT, DELETE and GET are fine for small applications, but when you need to start assuming how put and post and delete might be interpreted at the other end, you introduce coupling. (e.g. &#34;when I DELETE the resource associated with my bank account, the account should be closed&#34;)  And the solution proposed is to treat REST in a more Event sourced way.  i.e. Lets POST the user intent as a single event resource.</p><p>The other case is simpler.  If your users don&#39;t want to do all those operations simultaneously, don&#39;t let them.  POST an event for each user intent.  Now you can use etag versioning on your resources.</p><p>As for the other applications which are using a very different API to your resources.  That smells like trouble.  Can you construct a facade of the old API on top of your RESTful API and point them at the facade?  i.e. expose a service that performs multiple updates to a file in sequence via the REST server?</p><p>If you neither build the RESTful interface on top of the old solution, nor build a facade of the old interface on top of the REST solution, and attempt to maintain both APIs pointing at a shared data resource, you will experience major headaches.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-event-sourcing-sagas-bus-and-eventual-consistency/'>Architecture &#8211; Event Sourcing , sagas, bus and eventual consistency</a></li><li class="list-group-item"><a href='../event-sourcing-replaying-and-versioning/'>Event sourcing, replaying and versioning</a></li><li class="list-group-item"><a href='../how-to-handle-a-web-application-post-request-with-event-sourcing/'>How to handle a web application POST request with event sourcing</a></li><li class="list-group-item"><a href='../confused-about-commands-domain-events-and-external-events-in-event-sourcing/'>Confused about commands, domain events and external events in event sourcing</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>