<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Javascript &#8211; Error handlers inside Promise.all &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074444 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074444" class="post-1074444 software type-software status-publish hentry category-software tag-error-handling tag-javascript tag-promises"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Javascript &#8211; Error handlers inside Promise.all</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">error handling</span><span class="mr-2 badge badge-info">javascript</span><span class="mr-2 badge badge-warning">promises</span></p><div class="entry-content"><p>I&#39;m looking at this piece of code and whilst it works, it feels wrong to me. I&#39;m wondering if I am looking at an anti-pattern?</p><p>The code starts with two promises, <code>getAccounts</code> and <code>getTransactions</code>. On one of the promises there is a <code>catch</code> block that handles and error but returns a resolved promise with an object that looks <em>friendly</em>.</p><pre><code>let accounts = getAccounts()
                   .catch(error =&gt; Promise.resolve({errorCode: M011}));

let transactions = getTransactions();
</code></pre><p>These are then used in a <code>Promise.all</code>.</p><pre><code>Promise.all([accounts, transactions])
       .then(results =&gt; createStatement(results));
</code></pre><p>This looks wrong to me because on a failure of <code>getAccounts</code> I thought the <code>Promise.all</code> should <em>fail fast</em>. However on the other hand the failure of <code>getAccounts</code> is handled as early as possible which, surely, is a good thing? The only thing about it is that it doesn&#39;t return with another <code>Promise.reject</code></p><p>The rationale given was that this way the <code>Promise.all</code> doesn&#39;t choke. Of course another question entirely is why is this piece of code using <code>Promise.all</code> in the first place? That I don&#39;t know, legacy code.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>This is not an anti-pattern. This is a <em>code smell</em>, which is to say that this is the sort of thing you should avoid when it&#39;s feasible to do so, but there may be legitimate cases where nothing else does the job.</p><blockquote><p>I thought the Promise.all should <em>fail fast.</em></p></blockquote><p>Yup. This is exactly why the default behavior of Promise.all is to fail fast.</p><blockquote><p>The rationale given was that this way the Promise.all doesn&#39;t choke.</p></blockquote><p>I assume that means you&#39;re in a situation where even if some of the promises reject, you can still do something useful with the other promises that resolved successfully. This is definitely not an uncommon situation.</p><blockquote><p>Of course another question entirely is why is this piece of code using Promise.all in the first place?</p></blockquote><p>Presumably because that useful thing you can do with however many promises did resolve can only be done...after they&#39;ve all resolved.</p><hr/><p>Let&#39;s pretend for a moment that the promises represent bank transactions and your UI is going to display either green or red text based on whether the transaction succeeds.</p><p>If only some transactions succeed and others fail, you would definitely want to show the successful ones in green and the failed ones in red, rather than &#34;choking&#34; and settling for a single frustratingly uninformative &#34;one or more of your transactions may have failed&#34; message. In that context, I can&#39;t imagine anyone objecting to code like this:</p><pre><code>let resultRowPromise = executeTransactions(desiredTransactions)
           .then(result =&gt; Promise.resolve({ color: &#34;green&#34;, message: &#34;Success =D&#34; }))
           .catch(error =&gt; Promise.resolve({ color: &#34;red&#34;,   message: &#34;Fail ;_;&#34; }));
</code></pre><p>which we might &#34;loop over&#34; with a Promise.all at some point.</p><p>This is a case where it makes sense for the underlying promise to reject, it makes sense to wait for a set of such promises to finish, and it makes sense to handle failures on a per-promise basis instead of treating all failures as a failure for the whole batch.</p><p>But if any of those is not the case in your getAccounts() example, then you should consider alternatives such as making the underlying promise not reject in the first place, reacting to each promise resolution individually instead of waiting on a Promise.all, or simply letting Promise.all fail fast if in your case it is totally okay to ignore the successful ones.</p><p>In fact, even the example I just gave doesn&#39;t necessarily meet those standards. It&#39;s likely you could also handle each transaction promise individually, so the user sees &#34;Transaction 1 succeeded!&#34; and then a few seconds later &#34;Transaction 2 failed!&#34;. You could then do a Promise.all over the promises for rendering these messages (which <em>should</em> always succeed unless there&#39;s a rendering error) so that you can put some additional message like &#34;All transactions succeeded!&#34; or &#34;3/10 transactions failed!&#34; at the very top.</p><hr/><p>When thinking about how promises propagate results and errors, I find it often helps to consider the equivalent &#34;normal&#34;, &#34;synchronous&#34; or &#34;imperative&#34; non-promise code that returns values and throws/catches exceptions. For your example, that would probably be:</p><pre><code>var results = [];
for(let i = 0; i &lt; accountIds.length; ++i) {
    try {
        var account = getAccount(accountIds[i]);
        results.push(account);
    } catch(e) {
        results.push({ errorCode: M011 });
    }
}
</code></pre><p>Everything I said above applies to this code as well, though seeing it like this might make it more obvious why it applies. To summarize: this <em>might</em> be legitimate, but it definitely needs justification, and it&#39;s definitely worth thinking about whether that justification holds up or if there are cleaner alternatives.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../using-a-try-finally-without-catch-vs-enum-state-validation/'>Using a try-finally (without catch) vs enum-state validation</a></li><li class="list-group-item"><a href='../design-the-modern-way-to-perform-error-handling/'>Design &#8211; The modern way to perform error handling&#8230;</a></li><li class="list-group-item"><a href='../javascript-working-with-javascript-classes-the-right-way/'>Javascript &#8211; Working with Javascript classes the right way</a></li><li class="list-group-item"><a href='../javascript-functional-programming-pattern-for-async-javascript-code/'>Javascript &#8211; Functional programming pattern for async JavaScript code</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>