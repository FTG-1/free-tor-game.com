<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Structuring a storage system for a game &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081190 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081190" class="post-1081190 software type-software status-publish hentry category-software tag-java tag-object-oriented"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Structuring a storage system for a game</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">java</span><span class="mr-2 badge badge-info">object-oriented</span></p><div class="entry-content"><p>I am working on a <strong>multiplayer</strong> game, where a player has many storages to store items in.</p><p><strong>Storage</strong></p><p>Storage is the system that allows the user to deposit items, and take them back. Example of storage types:</p><ul><li><strong>Inventory</strong>: Same as WoW inventory, you can add items, drop items, move items from slot to slot.</li><li><strong>Bank</strong>: Bank is what you can call, a super-inventory, which has around 300 items limit <strong>per tab</strong> Bank can have maximum of 10 tabs which will store items. total items allowed in the bank is 3000 <em>(10 tabs multiplied by 300 items per tab)</em>. How ever, in the bank, all items are stackable.</li><li><strong>Equipment</strong>: Equipment is the same as Inventory, just with sorted slots, i.e Helm, Body, Legs and there are total of 8 slots.</li><li><strong>Chests and other</strong>: Same as Bank just without tabs.</li></ul><p><strong>An item in-game</strong></p><p>Each item has it&#39;s own item id. <strong>Only certain</strong> items can be stackable, unless the storage type is Bank or chest.</p><p>I have created a system which will make it easier for me to manage storages, and there&#39;s the abstract class, that each storage type class will extend it:</p><pre><code>public abstract class PlayerItemStorage {

    private int size;

    /**
     * The items
     */
    private PlayerItem[] items;

    /**
     * Sometimes, by default, the storage items are id + 1, due to
     * the client&#39;s interfaces. No exact explanation on it, but the only
     * feature that doesn&#39;t do that is equipment and possible BoB
     */
    private boolean increasedItem = true;

    public PlayerItemStorage(int storageSize) {
        this.items = new PlayerItem[storageSize];
        this.size = storageSize;
    }

    public PlayerItemStorage(PlayerItem[] items) {
        this.items  = items;
        this.size = items.length;
    }

    /**
     * Resets the storage
     */
    public void resetStorage() {
        this.items = new PlayerItem[this.size];
    }

    /**
     * Gets the item list
     * @return PlayerItem list
     */
    public PlayerItem[] getItems() {
        return this.items;
    }

    /**
     * Counts how many items there are with the same id.
     * @param id Item id
     * @return count
     */
    public int count(int id) {
        int count = 0;
        for (PlayerItem item : this.items) {
            if (this.getId(item) == id) {
                count++;
            }
        }
        return count;
    }

    /**
     * Counts how many items there are in the inventory
     * not including amount, just the item objects themself.
     * @return amount
     */
    public int countItems() {
        int count = 0;
        for (PlayerItem item : this.items) {
            if (this.getId(item) &gt; 0 &amp;&amp; item.getAmount() &gt; 0) {
                count++;
            }
        }
        return count;       
    }

    /**
     * Gets the length of the storage
     * @return
     */
    public int getLength() {
        return this.items.length;
    }

    /**
     * Checks how many free slots the storage has
     * @return
     */
    public int freeSlots() {
        int slots = 0;
        for (PlayerItem item : this.items) {
            if (this.getId(item) &lt;= 0) {
                slots++;
            }
        }       
        return slots;
    }

    /**
     * Finds an item id in the earliest slot.
     * @param id Item ID
     * @return Slot id
     */
    public int find(int id) {
        for (int i = 0; i &lt; this.items.length; i++) {
            PlayerItem item = this.items[i];
            if ( this.getId(item) == id &amp;&amp; item.getAmount() &gt; 0) {
                return i;
            }
        }
        return -1;      
    }

    /**
     * Gets the earliest free slot
     * @return slot id
     */
    public int getFreeSlot() {
        for (int i = 0; i &lt; this.items.length; i++) {
            if (this.getId(i) &lt;= 0) {
                return i;
            }
        }
        return -1;
    }

    /**
     * Checks if item is existing in the given slot, with the given amount and 
     * item id.
     * @param id Item ID
     * @param amount Item Amount
     * @param slot Slot id
     * @return boolean
     */
    public boolean containsInSlot(int id, int amount, int slot) {
        int found = 0;
        if (this.items[slot].getAlpha() == id) {
            for (int i = 0; i &lt; this.items.length; i++) {
                PlayerItem item = this.items[i];
                if (this.getId(item) == id) {
                    if (item.getAmount() &gt;= amount) {
                        return true;
                    } else {
                        found++;
                    }
                }
            }
            if (found &gt;= amount) {
                return true;
            }
            return false;
        }
        return false;
    }

    /**
     * Checks if item exists in the storage
     */
    public boolean contains(int id) {
        for (PlayerItem item : this.items) {
            if (this.getId(item) == id) {
                return true;
            }
        }
        return false;
    }

    /**
     * {@link #increasedItem}
     * @param i Index
     * @return real item id
     */
    private int getId(int i) {
        if (this.increasedItem) {
            return this.items[i].getAlpha();
        }
        return this.items[i].getId();
    }

    /**
     * {@link #increasedItem}
     * @param item PlayerItem object
     * @return real item id
     */
    private int getId(PlayerItem item) {
        if (this.increasedItem) {
            return item.getAlpha();
        }
        return item.getId();    
    }

    public abstract boolean add(int id, int amount);
    public abstract boolean remove(int id, int amount, int fromSlot);
}
</code></pre><p>I also have a container class which is in charge to control all storages:</p><pre><code>/**
 * Container class for all storages of a player
 * @author Ben
 */
public class PlayerStorageContainer {

    /**
     * Player object (Client extends Player extends Entity)
     */
    public Player player;

    /**
     * boolCatach: If enabled, when removing/adding item to ALL of the storages,
     * it will check if the action returned false, if yes it will stop right away and
     * return false.
     */
    private boolean boolCatch;

    /**
     * All of the storages the player will contain
     */
    private Map&lt;String, PlayerItemStorage&gt; storages = 
            new HashMap&lt;String, PlayerItemStorage&gt;();

    public PlayerStorageContainer(Player p) {
        this.player = p;
        this.initializePlayerStorages();
    }

    /**
     * Initializes the existing storage for player.
     */
    private void initializePlayerStorages() {
        this.storages.put(&#34;inventory&#34;, new Inventory(this.player));
    }

    /**
     * Gets the required PlayerItemStorage implementation
     * @param name Name of the implementing object
     * @return The object that extends PlayerItemStorage
     */
    public PlayerItemStorage getStorage(String name) {
        return this.storages.get(name);
    }

    /**
     * Removes an item from ALL storages
     * @param id        The Item ID
     * @param amount    The amount of the item
     * @return Returns a boolean if action was successful without any falses in the
     * middle of the execution, will return always true if {!boolCatch}
     */
    public boolean remove(int id, int amount) {
        for (PlayerItemStorage storage : this.storages.values()) {
            if (!storage.remove(id, amount) &amp;&amp; this.boolCatch) {
                return false;
            }
        }
        return true;
    }

    /**
     * Adds an item to ALL storages
     * @param id        The Item ID
     * @param amount    The amount of the item
     * @return Returns a boolean if action was successful without any falses in the
     * middle of the execution, will return always true if {!boolCatch}
     */
    public boolean add(int id, int amount) {
        for (PlayerItemStorage storage : this.storages.values()) {
            if (!storage.add(id, amount) &amp;&amp; this.boolCatch) {
                return false;
            }
        }
        return true;
    }

    /**
     * Resets all storages
     */
    public void reset() {
        for (PlayerItemStorage storage : this.storages.values()) {
            storage.resetStorage();
        }
    }

    /**
     * Toogles {@link PlayerItemContainer#boolCatch} for errors
     * @param b
     */
    public void setErrorCatch(boolean b) {
        this.boolCatch = b;
    }
}
</code></pre><h1>The problem</h1><p>This system works fine for inventory, and equipment &#8211; however, this will be a problem and cause some big algorithm code duplicating for the bank type.</p><p>Since bank type storage can have multiple tabs up to 10, we will either need to create class named Tab and make it implement PlayerItemStorage, and put the same algorithm over the two classes (Bank and Tab) or have one method in Bank, and then have a variable named &#34;focusedTab&#34; which will hold the selected tab id, and make the add method accept 3 arguements <em>(itemId, amount, tabId)</em>.</p><p>But making it accept 3 arguments will make a problem, I&#39;ll have to either ignore the abstract method add, and make own method for it, or create 2 abstract adds method, one with 2 parameters, one with 3 which I find too messy.</p><p>Did I design this whole thing incorrectly that I am having these problems?<br /> How can I design a proper structure for this whole storage feature so it works with all kind of storages I can think of?</p><p>If you cannot understand the problem, <a href="https://codereview.stackexchange.com/questions/55555/inventory-how-to-handle-items">you might find my code review thread helpful</a></p><p><strong>Background about how the server handles items</strong></p><p>When the client clicks on any item, in any game interface that supports item storage, it sends the slot id the player clicked on, due to security reasons. The server uses the slot id as the index of the PlayerItem[] array to get the information about the item.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I think you&#39;ve confused having an interface for your program to call to add/remove items for a particular player and being able to manage all individual cases.  The interface to the rest of your program should remain simple.  By simple I mean it should be single-purpose and the only methods public will be those that will be called.</p><p>As I understand it, it is <code>PlayerItemStorage</code> that handles the logic about fitting and physical layout of those items.  This sort of complication should <em>remain</em> within PlayerItemStorage.  For the callers of <code>PlayerItemStorage</code>, they should only care about what items are present, if an item has been removed or added.  When this happens, through a <code>PlayerItemStorageChangeHandler</code> interface, any instance in your program that wants to know about this event can register.  Your <code>PlayerStorageContainer</code> would use this as a means to get this information and act consequently.</p><p>Any validation about whether or not they can fit it in storage should be entirely managed by <code>PlayerItemStorage</code>.  Notice that I said that <em>whether or not an item has been removed or added</em> should be handled by <code>PlayerItemStorage</code>.  Do not be tempted to put the logic in <code>PlayerStorageContainer</code> since it should not know whether or not it is <em>possible</em>.</p><p>Granted, I still think adding and removing items from <code>PlayerStorageContainer</code> should be possible, however you should allow the possibility of failure.  Anything that you would want to happen as a consequence of adding it to <code>PlayerItemStorage</code> should be put in the same place as your <code>PlayerItemStorageChangeHandler</code> listener for new adds/removes (again, avoiding to duplicate your code).  Also, I presume that the main interface to be called when a player adds/removes items to his storage should be <code>PlayerItemStorage</code> and not <code>PlayerStorageContainer</code> for most operations, however I suppose if you say wanted to add a gift item to a player&#39;s storage, it would be preferable not to care which storage it is (just throw it anywhere where there&#39;s room).</p><p>Once you&#39;ve established this relationship, you&#39;ll see that a bank concept with tabs is nothing more than a collection of <code>PlayerItemStorage</code>.  I would therefore create a special type of <code>PlayerItemStorage</code> called <code>PlayerBankItemStorage</code>.  It would override the same operations called by <code>PlayerStorageContainer</code>, but it could also maintain open tab state.  Try to keep the logic simple though.  You should forward most calls to <code>PlayerItemStorage</code>. <code>PlayerBankItemStorage</code> would listen to <code>PlayerItemStorageChangeHandler</code> and then throw the event itself (if it should handle events at least, otherwise adding a new listener should simply forward to each individual <code>PlayerItemStorage</code>.</p><p>The key thing to remember is to avoid duplicating logic.  Keep class roles clear in your mind, and you&#39;ll find that it is easier to delegate tasks to your classes and keep logic in one place only.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-a-design-decision-in-composition-or-aggregation/'>Java &#8211; A design decision in composition or aggregation</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>