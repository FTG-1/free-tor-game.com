<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Object-oriented &#8211; Classic inheritance problem &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078597 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078597" class="post-1078597 software type-software status-publish hentry category-software tag-inheritance tag-object-oriented tag-polymorphism"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Object-oriented &#8211; Classic inheritance problem</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">inheritance</span><span class="mr-2 badge badge-info">object-oriented</span><span class="mr-2 badge badge-warning">polymorphism</span></p><div class="entry-content"><p>I keep seeing the following pattern when people learn about OOP:</p><p>Problem: How do I put objects of different but related types into a container?</p><p>Solution: Inherit from a common base class.</p><p>New problem: I have a bunch of base class objects, how do I get the real type?</p><p>Solution: ???</p><p>The classic inheritance example is to make a graphics program that deals with geometric objects. We have <code>Circle</code>s, <code>Ellipse</code>s and <code>Triangle</code>s. All these objects have a common base <code>Drawable</code>.</p><p><img src="../../../i.stack.imgur.com/LuLXm.png" alt="Drawable"/></p><p>In C++ this might look something like this:</p><pre><code>struct Drawable{
    virtual ~Drawable(){}
    virtual void draw() const = 0;
};

struct Triangle : Drawable{
    Point p1, p2, p3;
    void draw() const override;
    void stretch(double xfactor, double yfactor);
    std::touple&lt;double, double, double&gt; getAngles() const;
    //...
};

struct Circle : Drawable{
    double radius;
    void draw() const override;
    //...
};

struct Ellipse : Drawable{
    double radius;
    void draw() const override;
    //...
};

std::vector&lt;Drawable *&gt; drawables = {new Circle, new Triangle, new Ellipse};
for (const auto &amp;d : drawables)
    d-&gt;draw();
</code></pre><p>So far so good. Now I want to increase the radius of my <code>Circle</code>s and <code>Ellipse</code>s. As far as I know there are 4 ways to do that:</p><p>1: Put everything into the base class. The base class gets the virtual functions <code>getAngles</code>, <code>getRadius</code>, <code>stretch</code> and <code>getEccentricity</code>. There is a default implementation for each so that for example <code>getRadius</code> returns some dummy value when you are dealing with a <code>Triangle</code>. After this is done you can easily iterate over the <code>Drawable</code>s and increase their radius. This makes the base class ridiculously huge and working on a <code>vector&lt;Drawable *&gt;</code> becomes inefficient because the functions do nothing for most elements.</p><p>2: Use <code>dynamic_cast</code> hacks.</p><pre><code>for (const auto &amp;d : drawables){
    if (dynamic_cast&lt;Circle *&gt;(d))
        ((Circle *)d)-&gt;radius++;
    else if (dynamic_cast&lt;Ellipse *&gt;(d))
        ((Ellipse *)d)-&gt;radius++;
}
</code></pre><p>Unfortunately you need to repeat this ugly syntax every time you need to do something like this. You cannot put it in a function or macro. Every time a new <code>Drawable</code> is added you have to go through the whole code base and add it where appropriate. Also the <code>if</code>/<code>else</code>-chain is fairly inefficient.</p><p>3: Add a Tag as the first member variable and cast accordingly.</p><pre><code>for (const auto &amp;d : drawables){
    switch(d-&gt;tag){
        case Tag::Circle:
            ((Circle *)d)-&gt;radius++;
            break;
        case Tag::Ellipse:
            ((Ellipse *)d)-&gt;radius++;
            break;
    }
}
</code></pre><p>Slightly more efficient due to a switch instead of an <code>if</code>/<code>else</code>-chain, but there is already a kind of tag that shows the dynamic type, so the tag is redundant. Also it has the same problem as 2: since you need to change the whole code base whenever a new <code>Drawable</code> comes along.</p><p>4: Just keep the objects in separate containers.</p><pre><code>vector&lt;Circle&gt; circles;
vector&lt;Triangle&gt; triangles;
vector&lt;Ellipse&gt; ellipses;
for (auto &amp;c : circles)
    c.radius++;
for (auto &amp;e : ellipses)
    e.radius++;
</code></pre><p>This is very efficient memory layout wise and you only iterate over objects that matter. It is my favorite, but unfortunately it breaks the first solution in that you do not keep differently typed objects in a single container.</p><p>I tried to solve the problem by creating a variadic template that internally has a <code>vector</code> per type and forwards insertions to the right container. Ideally it would completely hide the fact that there are different containers under the hood. Usage would look something like this:</p><pre><code>MultiVector&lt;Triangle, Circle, Ellipse&gt; mv;
mv.push_back(Triangle());
mv.push_back(Circle());
mv.push_back(Ellipse());
for (auto &amp;d : mv.get&lt;Circle, Ellipse&gt;())
    d.radius++;
</code></pre><p>The solution is not perfect, for example different types do not keep their order and implementing the iteration is tricky.</p><p>I presented this problem and solution attempt to my (university) research group and got the reactions &#34;<em>If you design your classes right this is not a problem</em>&#34; and &#34;<em>The proposed solution is a very specific tool to solve a very specific problem and it is questionable at best to add even more complexity to c++ for such a minor detail</em>&#34;. In my opinion this is a very basic problem that needs fixing and the usual solution of better class design only tries to find the least evil of the 4 workarounds in the specific case without actually solving the problem. The problem comes up almost every time inheritance is used.</p><p>So finally here is the question: Did you run into this problem too / is this a real problem? Do you know of another workaround/solution? Do other languages deal better with the problem? I want to simulate a poll using 2 comments below so feel free to upvote either &#34;<em>I never had this problem / The problem is easily solved.</em>&#34; or &#34;<em>I also had this problem and never solved it to my satisfaction.</em>&#34;</p><p>Edit: To prevent a close due to primarily opinion based / discussion: I want a clear answer that solves the problem or some resource that says that there is none.</p><p>Edit: Related: <a href="https://stackoverflow.com/questions/24883075/do-i-really-have-a-car-in-my-garage">Do I really have a car in my garage?</a></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>This is a classic OOP issue, not that it signals that anything is wrong with the object oriented way of thinking, but it does require one to carefully consider the design.</p><p>When you wish to iterate over a container of objects, and alter some property that only a part of the objects have, <em>and more importantly: only makes sense for a part of the objects</em>, it is in my opinion the design that is the problem. The question here is, why do you want to alter some class specific property in a generic list? I am sure it make good sense in your situation, but think about it for a while.</p><p>You have a list of figures, this can be squares, rectangles, triangles, circles, polygons, etc. And now you wish to perform some action on them, which is fine, if they all support the action. But it does not make sense to alter a property on an object that would clearly not support it. It is counter-intuitive to iterate a list of figures, setting the radius, it is <em>not</em> however counter-intuitive to iterate a list of circles, setting the radius.</p><p>That does not mean, that some complicated, or let&#39;s just say smart design choice, can enable you to achieve this, but it goes against the concept of object orientation, by somehow trying to circumvent the encapsulation. I would argue, that this goes against the idea of polymorphism.</p><p>How to do it instead however is something different, which I am afraid I cannot produce an answer for at this moment. I do believe however, that you should do your utmost to try to avoid putting yourself in that situation.</p><p>One possible alternative you could look into is using a visitor pattern, where you have a visitor that accepts an object type that allows changing the radius. For instance:</p><pre><code>class Visitor {
public:
  void Visit(Circle&amp; circle) { /* Do something circle specific */ )
  void Visit(Square&amp; square) { /* Do something square specific */ )
  // ...
};
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../object-oriented-is-it-good-to-have-an-interface-plenty-of-methods-which-belong-to-different-concepts-just-to-preserve-the-liskovs-principle/'>Object-oriented &#8211; Is it good to have an interface plenty of methods which belong to different concepts, just to preserve the Liskov&#8217;s Principle</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>