<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>SOA/Microservices: How to handle authorization in inter-services communications &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071374 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071374" class="post-1071374 software type-software status-publish hentry category-software tag-api tag-authorization tag-microservices tag-soa"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">SOA/Microservices: How to handle authorization in inter-services communications</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api</span><span class="mr-2 badge badge-info">authorization</span><span class="mr-2 badge badge-warning">microservices</span><span class="mr-2 badge badge-primary">soa</span></p><div class="entry-content"><p><strong>Foreground</strong></p><p>We are moving from a monolithic platform to a more Service Oriented Architecture. We are applying very basic DDD principles and splitting our domain across different bounded contexts. Each domain is distributed and exposes a service via a web API (REST).</p><p>Due to the nature of our business, we have services such as <em>Bookings</em>, <em>Services</em>, <em>Customers</em>, <em>Products</em>, etc.</p><p>We have also set up an Identity Server (based on Thinktecture Identity Server 3) whose main role is to:</p><ul><li>Centralize authentication (given credentials it issues tokens)</li><li>Add claims in the tokens such as: the scopes of the client (as per client I mean the application doing the request), customer identifier (as per customer I mean the person using the application)</li></ul><p>We also introduced the role of an <em>API Gateway</em> which centralizes external access to our services. API Gateway provides functionalities which do not require deep knowledge of the internal domains such as:</p><ul><li>Reverse proxy: routes incoming requests into the appropriate internal service</li><li>Versioning: a version of the API Gateway maps to different versions of the internal services</li><li>Authentication: client requests include the token issued by the Identity Server and the API Gateway validates the token (make sure user is who says she is)</li><li>Throttling: limit number of requests per client</li></ul><p><strong>Authorization</strong></p><p>What concerns authorization, this is not managed in the API Gateway but in the internal services itself. We are currently doing 2 main types of authorizations:</p><ul><li>Authorization based on client scopes. Example: a client (external application consuming our APIs) requires the scope &#34;bookings&#34; to access the <em>Bookings</em> service API endpoints</li><li>Authorization based on the customer. Example: only if a customer (physical person using the application) is a participant of a booking can access the endpoint GET /bookings from the <em>Bookings</em> service</li></ul><p>To be able to handle authorization in the internal services, the API Gateway simply forwards the token (when routing the request to the internal service) which includes both information about the client (the application doing the request) and the customer as a claim (in those cases where a person is logged in the client application).</p><p><strong>Problem description</strong></p><p>So far so good until we introduced inter-service communication (some services can communicate with other services to obtain some data).</p><p><strong>Question</strong></p><p>How should we approach the authorization in inter-services communications?</p><p><strong>Options considered</strong></p><p>To discuss the different options I will use the following sample scenario:</p><ul><li>We have an external application called <em>ExternalApp</em> that accesses our API (<em>ExternalApp</em> can be seen as <em>the client</em>) in order to build the booking flow</li><li><em>ExternalApp</em> needs access to the <em>Bookings</em> service, hence we grant the <em>ExternalApp</em> the scope &#34;bookings&#34;</li><li>Internally (this is something completely transparent for the <em>ExternalApp</em>) the <em>Bookings</em> service acesses the <em>Services</em> service to obtain the default services of a booking such as the flights, the insurances or a car rental</li></ul><p>When discussing this issue internally several options popped up, but we are not sure which option is best:</p><ol><li>When <em>Bookings</em> communicates with <em>Services</em>, it should simply forward the original token he received from the API Gateway (indicating that the client is the <em>ExternalApp</em>)<ul><li>Implications: We might need to grant scopes to the <em>ExternalApp</em> that should not have been granted. Example: <em>ExternalApp</em> might need to have both the scope &#34;bookings&#34; and &#34;services&#34; while only the &#34;bookings&#34; scope could have sufficed</li></ul></li><li>When <em>Bookings</em> communicates with <em>Services</em>, it forwards a token indicating the client now has become <em>Bookings</em> (instead of the <em>ExternalApp</em>) + it adds a claim indicating <em>Bookings</em> is impersonating the original client <em>ExternalApp</em><ul><li>By also including the information that the original client is the <em>ExternalApp</em> the <em>Services</em> service could also do logic such as filtering out some services depending on the original caller (e.g. for internal apps we should return all fights, for external apps only some)</li></ul></li><li>Services should not communicate with each other (so we should not be even be facing this question)</li></ol><p>Thanks in advance for your input.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I advise you to have an <strong>internal</strong> channel of communication between the microservices.</p><p>For example to use some <strong>message broker like RabbitMQ internally</strong> to <strong>send/receive</strong> or <strong>publish/subscribe</strong> the messages between microservices.</p><p>Then your first end user facing service &#34;in your example the Booking service&#34; will be responsible for validating the token and authorize the customer to do this specific operation may be by communicating with IdentityServer.</p><p>Then it will communicate with Services service through Message broker and in that case, there is no need to validate the token again.</p><p><strong>I guess this model will be simpler and give you better performance.</strong></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../microservices-and-authorization/'>Microservices and authorization</a></li><li class="list-group-item"><a href='../authorization-and-authentication-system-for-microservices-and-consumers/'>Authorization and authentication system for microservices and consumers</a></li><li class="list-group-item"><a href='../setting-up-development-environment-in-micro-services-architecture/'>Setting up development environment in micro-services architecture</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>