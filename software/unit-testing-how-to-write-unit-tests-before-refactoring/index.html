<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; How to write unit tests before refactoring &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1068026 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1068026" class="post-1068026 software type-software status-publish hentry category-software tag-refactoring tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; How to write unit tests before refactoring</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">refactoring</span><span class="mr-2 badge badge-info">unit testing</span></p><div class="entry-content"><p>I&#39;ve read some answers to questions along a similar line such as &#34;How do you keep your unit tests working when refactoring?&#34;. In my case the scenario is slightly different in that<br /> I&#39;ve been given a project to review and bring in line with some standards we have, currently there are no tests at all for the project!</p><p>I&#39;ve identified a number of things I think could have been done better such as NOT mixing DAO type code in a service layer.</p><p>Before refactoring it seemed like a good idea to write tests for the existing code. The problem it appears to me is that when I do refactor then those tests will break as I&#39;m changing<br /> where certain logic is done and the tests will be written with the previous structure in mind (mocked dependencies etc.)</p><p>In my case, what would be the best way to procede? I&#39;m tempted to write the tests around the refactored code but I&#39;m aware there is a risk I may refactor things incorrectly that could<br /> change the desired behaviour.</p><p>Whether this is a refactor or a redesign I&#39;m happy for my understanding of those terms to be corrected, currently I&#39;m working on the following definition for refactoring &#34;With refactoring, by definition, you don&#39;t change what your software does, you change how it does it.&#34;. So I&#39;m not changing what the software does I&#39;d be changing how/where it does it.</p><p>Equally I can see the argument that if I&#39;m changing the signature of methods that could be considered a redesign.</p><p>Here&#39;s a brief example</p><p><code>MyDocumentService.java</code> (current)</p><pre class="lang-java prettyprint-override"><code>public class MyDocumentService {
   ...
   public List&lt;Document&gt; findAllDocuments() {
      DataResultSet rs = documentDAO.findAllDocuments();
      List&lt;Document&gt; documents = new ArrayList&lt;&gt;();
      for(DataObject do: rs.getRows()) {
         //get row data create new document add it to 
         //documents list
      }

      return documents;
   }
}
</code></pre><p><code>MyDocumentService.java</code> (refactored/redesigned whatever)</p><pre class="lang-java prettyprint-override"><code>public class MyDocumentService {
   ...
   public List&lt;Document&gt; findAllDocuments() {
      //Code dealing with DataResultSet moved back up to DAO
      //DAO now returns a List&lt;Document&gt; instead of a DataResultSet
      return documentDAO.findAllDocuments();
   }
}
</code></pre></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>You&#39;re looking for tests that check for <em>regressions</em>. i.e. breaking some existing behaviour. I would start by identifying at what level that behaviour will remain the same, and that the interface driving that behaviour will remain the same, and start putting in tests at that point.</p><p>You now have some tests that will assert that whatever you do <em>below</em> this level, your behaviour remains the same.</p><p>You&#39;re quite right to question how the tests and code can remain in sync. If your <em>interface</em> to a component remains the same, then you can write a test around this and assert the same conditions for both implementations (as you create the new implementation). If it doesn&#39;t, then you have to accept that a test for a redundant component is a redundant test.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../how-far-can-i-push-refactoring-without-changing-external-behavior/'>How far can I push refactoring without changing external behavior</a></li><li class="list-group-item"><a href='../unit-testing-what-would-help-when-refactoring-a-large-method-to-ensure-that-i-dont-break-anything/'>Unit-testing &#8211; What would help when refactoring a large method to ensure that I don&#8217;t break anything</a></li><li class="list-group-item"><a href='../java-should-i-unit-test-the-subclasses-or-the-abstract-parent-class/'>Java &#8211; Should I unit test the subclasses or the abstract parent class</a></li><li class="list-group-item"><a href='../c-how-does-breaking-up-a-big-method-into-smaller-methods-improve-unit-testability-when-the-methods-are-all-private/'>C# &#8211; How does breaking up a big method into smaller methods improve unit testability when the methods are all private</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>