<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>How accurate is &#8220;Business logic should be in a service, not in a model&#8221; &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1062946 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1062946" class="post-1062946 software type-software status-publish hentry category-software tag-design-patterns tag-layers"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">How accurate is &#8220;Business logic should be in a service, not in a model&#8221;</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design-patterns</span><span class="mr-2 badge badge-info">layers</span></p><div class="entry-content"><p><strong>Situation</strong></p><p>Earlier this evening I gave an <a href="https://stackoverflow.com/questions/19881435/editing-of-an-existing-object-should-be-done-in-repository-layer-or-in-service">answer</a> to a question on StackOverflow.</p><p><em>The question:</em></p><blockquote><p>Editing of an existing object should be done in repository layer or in service?</p><p>For example if I have a User that has debt. I want to change his debt. Should I do it in UserRepository or in service for example BuyingService by getting an object, editing it and saving it ?</p></blockquote><p><em>My answer:</em></p><blockquote><p>You should leave the responsibility of mutating an object to that same object and use the repository to retrieve this object.</p></blockquote><p><em>Example situation:</em></p><pre class="lang-cs prettyprint-override"><code>class User {
    private int debt; // debt in cents
    private string name;

    // getters

    public void makePayment(int cents){
        debt -= cents;
    }
}

class UserRepository {
    public User GetUserByName(string name){
        // Get appropriate user from database
    }
}
</code></pre><p><em>A comment I received:</em></p><blockquote><p>Business logic should really be in a service. Not in a model.</p></blockquote><p><strong>What does the internet say?</strong></p><p>So, this got me searching since I&#39;ve never really (consciously) used a service layer.<br /> I started reading up on the Service Layer pattern and the Unit Of Work pattern but so far I can&#39;t say I&#39;m convinced a service layer has to be used.</p><p>Take for example <a href="http://martinfowler.com/bliki/AnemicDomainModel.html" rel="noreferrer">this article</a> by Martin Fowler on the anti-pattern of an Anemic Domain Model:</p><blockquote><p>There are objects, many named after the nouns in the domain space, and these objects are connected with the rich relationships and structure that true domain models have. The catch comes when you look at the behavior, and you realize that there is hardly any behavior on these objects, making them little more than bags of getters and setters. Indeed often these models come with design rules that say that you are not to put any domain logic in the the domain objects. Instead there are a set of service objects which capture all the domain logic. These services live on top of the domain model and use the domain model for data.</p><p>(&#8230;)  The logic that should be in a domain object is domain logic &#8211; validations, calculations, business rules &#8211; whatever you like to call it.</p></blockquote><p>To me, this seemed exactly what the situation was about: I advocated the manipulation of an object&#39;s data by introducing methods inside that class that do just that. However I realize that this should be a given either way, and it probably has more to do with how these methods are invoked (using a repository).</p><p>I also had the feeling that in that article (see below), a Service Layer is more considered as a <a href="http://en.wikipedia.org/wiki/Facade_pattern" rel="noreferrer">façade</a> that delegates work to the underlying model, than an actual work-intensive layer.</p><blockquote><p>Application Layer [his name for Service Layer]: Defines the jobs the software is supposed to do and directs the expressive domain objects to work out problems. The tasks this layer is responsible for are meaningful to the business or necessary for interaction with the application layers of other systems. This layer is kept thin. It does not contain business rules or knowledge, but only coordinates tasks and delegates work to collaborations of domain objects in the next layer down. It does not have state reflecting the business situation, but it can have state that reflects the progress of a task for the user or the program.</p></blockquote><p>Which is reinforced <a href="http://msdn.microsoft.com/en-us/library/ee658090.aspx" rel="noreferrer">here</a>:</p><blockquote><p>Service interfaces. Services expose a service interface to which all inbound messages are sent. You can think of a service interface as a façade that exposes the business logic implemented in the application (typically, logic in the business layer) to potential consumers.</p></blockquote><p>And <a href="https://softwareengineering.stackexchange.com/questions/168517/recovering-an-anemic-domain-model-into-a-multitier-architecture">here</a>:</p><blockquote><p>The service layer should be devoid of any application or business logic and should focus primarily on a few concerns. It should wrap Business Layer calls, translate your Domain in a common language that your clients can understand, and handle the communication medium between server and requesting client.</p></blockquote><p>This is a serious contrast to <a href="https://stackoverflow.com/questions/9010088/on-properly-implementing-complex-service-layers?rq=1">other resources</a> that talk about the Service Layer:</p><blockquote><p>The service layer should consist of classes with methods that are units of work with actions that belong in the same transaction.</p></blockquote><p>Or the <a href="https://stackoverflow.com/questions/4270461/service-layer-in-java-swing-application?rq=1">second answer</a> to a question I&#39;ve already linked:</p><blockquote><p>At some point, your application will want some business logic. Also, you might want to validate the input to make sure that there isn&#39;t something evil or nonperforming being requested. This logic belongs in your service layer.</p></blockquote><p><strong>&#34;Solution&#34;?</strong></p><p>Following the guidelines in <a href="https://softwareengineering.stackexchange.com/questions/211688/use-a-service-layer-with-mvc">this answer</a>, I came up with the following approach that uses a Service Layer:</p><pre class="lang-cs prettyprint-override"><code>class UserController : Controller {
    private UserService _userService;

    public UserController(UserService userService){
        _userService = userService;
    } 

    public ActionResult MakeHimPay(string username, int amount) {
        _userService.MakeHimPay(username, amount);
        return RedirectToAction(&#34;ShowUserOverview&#34;);
    }

    public ActionResult ShowUserOverview() {
        return View();
    }
}

class UserService {
    private IUserRepository _userRepository;

    public UserService(IUserRepository userRepository) {
        _userRepository = userRepository;
    }

    public void MakeHimPay(username, amount) {
        _userRepository.GetUserByName(username).makePayment(amount);
    }
}

class UserRepository {
    public User GetUserByName(string name){
        // Get appropriate user from database
    }
}

class User {
    private int debt; // debt in cents
    private string name;

    // getters

    public void makePayment(int cents){
        debt -= cents;
    }
}
</code></pre><p><strong>Conclusion</strong></p><p>All together not much has changed here: code from the controller has moved to the service layer (which is a good thing, so there is an upside to this approach). However this doesn&#39;t look like it had anything to do with my original answer.</p><p>I realize design patterns are guidelines, not rules set in stone to be implemented whenever possible. Yet I have not found a definitive explanation of the service layer and how it should be regarded.</p><ul><li><p>Is it a means to simply extract logic from the controller and put it inside a service instead?</p></li><li><p>Is it supposed to form a contract between the controller and the domain?</p></li><li><p>Should there be a layer between the domain and the service layer?</p></li></ul><p>And, last but not least: following the original comment</p><blockquote><p>Business logic should really be in a service. Not in a model.</p></blockquote><ul><li><p>Is this correct?</p><ul><li>How would I introduce my business logic in a service instead of the model?</li></ul></li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In order to define what a <em>service&#39;s</em> responsibilities are, you first need to define what a <em>service</em> is.</p><p><em>Service</em> is not a canonical or generic software term. In fact, the suffix <code>Service</code> on a class name is a lot like the much-maligned <a href="http://www.codinghorror.com/blog/2006/03/i-shall-call-it-somethingmanager.html">Manager</a>: It tells you almost nothing about what the object actually <em>does</em>.</p><p>In reality, what a service ought to do is highly architecture-specific:</p><ol><li><p>In a traditional layered architecture, <em>service</em> is literally synonymous with <em>business logic layer</em>. It&#39;s the layer between UI and Data. Therefore, <strong>all</strong> business rules go into services. The data layer should only understand basic CRUD operations, and the UI layer should deal only with the mapping of presentation DTOs to and from the business objects.</p></li><li><p>In an RPC-style distributed architecture (SOAP, UDDI, BPEL, etc.), the <em>service</em> is the logical version of a physical <em>endpoint</em>. It is essentially a collection of operations that the maintainer wishes to provide as a public API. Various best practices guides explain that a service <em>operation</em> should in fact be a business-level operation and not CRUD, and I tend to agree.</p><p>However, because routing <em>everything</em> through an actual remote service can seriously hurt performance, it&#39;s normally best <em>not</em> to have these services actually implement the business logic themselves; instead, they should wrap an &#34;internal&#34; set of business objects. A single service might involve one or several business objects.</p></li><li><p>In an MVP/MVC/MVVM/MV* architecture, <em>services</em> don&#39;t exist at all. Or if they do, the term is used to refer to any generic object that can be injected into a controller or view model. The business logic is in your <em>model</em>. If you want to create &#34;service objects&#34; to orchestrate complicated operations, that&#39;s seen as an implementation detail. A lot of people, sadly, implement MVC like this, but it&#39;s considered an anti-pattern (<a href="http://en.wikipedia.org/wiki/Anemic_domain_model">Anemic Domain Model</a>) because the model itself does nothing, it&#39;s just a bunch of properties for the UI.</p><p>Some people mistakenly think that taking a 100-line controller method and shoving it all into a service somehow makes for a better architecture. It really doesn&#39;t; all it does is add another, probably unnecessary layer of indirection. <em>Practically</em> speaking, the controller is still doing the work, it&#39;s just doing so through a poorly named &#34;helper&#34; object. I highly recommend Jimmy Bogard&#39;s <a href="http://vimeo.com/43598193">Wicked Domain Models</a> presentation for a clear example of how to turn an anemic domain model into a useful one. It involves careful examination of the models you&#39;re exposing and which operations are actually valid in a <em>business</em> context.</p><p>For example, if your database contains Orders, and you have a column for Total Amount, your application <em>probably</em> shouldn&#39;t be allowed to actually change that field to an arbitrary value, because (a) it&#39;s history and (b) it&#39;s supposed to be determined by what&#39;s <em>in</em> the order as well as perhaps some other time-sensitive data/rules. Creating a service to manage Orders does not necessarily solve this problem, because user code can <em>still</em> grab the actual Order object and change the amount on it. Instead, the order <em>itself</em> should be responsible for ensuring that it can only be altered in safe and consistent ways.</p></li><li><p>In DDD, services are meant specifically for the situation <a href="http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/">when you have an operation that doesn&#39;t properly belong to any aggregate root</a>. You have to be careful here, because often the need for a service can imply that you didn&#39;t use the correct roots. But assuming you did, a service is used to coordinate operations across multiple roots, or sometimes to handle concerns that don&#39;t involve the domain model at all (such as, perhaps, writing information to a BI/OLAP database).</p><p>One notable aspect of the DDD service is that it is allowed to use <a href="http://martinfowler.com/eaaCatalog/transactionScript.html">transaction scripts</a>. When working on large applications, you&#39;re very likely to eventually run into instances where it&#39;s just way easier to accomplish something with a T-SQL or PL/SQL procedure than it is to fuss with the domain model. This is OK, and it belongs in a Service.</p><p>This is a radical departure from the layered-architecture definition of services. A service layer encapsulates domain objects; a DDD service encapsulates whatever <strong>isn&#39;t</strong> in the domain objects and doesn&#39;t make sense to be.</p></li><li><p>In a Service-Oriented Architecture, a <em>service</em> is considered to be the technical authority for a business capability. That means that it is the <em>exclusive</em> owner of a certain subset of the business data and nothing else is allowed to touch that data - not even to just <em>read</em> it.</p><p>By necessity, services are actually an end-to-end proposition in an SOA. Meaning, a service isn&#39;t so much a specific <em>component</em> as an entire <em>stack</em>, and your entire application (or your entire business) is a set of these services running side-by-side with no intersection except at the messaging and UI layers. Each service has its own data, its own business rules, and its own UI. They don&#39;t need to orchestrate with each other because they are supposed to be business-aligned - and, like the business itself, each service has its own set of responsibilities and operates more or less independently of the others.</p><p>So, by the SOA definition, every piece of business logic <em>anywhere</em> is contained within the service, but then again, so is the entire <em>system</em>. Services in an SOA can have <em>components</em>, and they can have <em>endpoints</em>, but it&#39;s fairly dangerous to call any piece of code a <em>service</em> because it conflicts with what the original &#34;S&#34; is supposed to mean.</p><p>Since SOA is generally pretty keen on messaging, the operations that you might have packaged in a <em>service</em> before are generally encapsulated in <em>handlers</em>, but the multiplicity is different. Each handler handles <em>one</em> message type, <em>one</em> operation. It&#39;s a strict interpretation of the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility Principle</a>, but makes for great maintainability because every possible operation is in its own class. So you don&#39;t really <em>need</em> centralized business logic, because commands represents business operations rather than technical ones.</p></li></ol><p>Ultimately, in any architecture you choose, there is going to be some component or layer that has most of the business logic. After all, if business logic is scattered all over the place then you just have spaghetti code. But whether or not you call that component a <em>service</em>, and how it&#39;s designed in terms of things like number or size of operations, depends on your architectural goals.</p><p>There&#39;s no right or wrong answer, only what applies to your situation.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../php-anemic-domain-model-business-logic-and-datamapper-php/'>Php &#8211; Anemic Domain Model, Business Logic and DataMapper (PHP)</a></li><li class="list-group-item"><a href='../object-oriented-project-structure-where-to-put-business-logic/'>Object-oriented &#8211; Project structure: where to put business logic</a></li><li class="list-group-item"><a href='../where-should-business-logic-go-in-a-layered-architecture/'>Where should business logic go in a layered architecture</a></li><li class="list-group-item"><a href='../php-ddd-creating-reusable-modules-and-service-type-distinctions-domain-infrastructure-application/'>Php &#8211; DDD: Creating reusable modules and service type distinctions (Domain, Infrastructure, Application)</a></li><li class="list-group-item"><a href='../how-acceptable-is-to-keep-business-logic-outside-entities-in-separate-service-classes/'>How acceptable is to keep business logic outside entities (in separate service classes)</a></li><li class="list-group-item"><a href='../c-should-an-mvp-mvc-model-contain-behaviour/'>C# &#8211; Should an MVP/MVC Model contain behaviour</a></li><li class="list-group-item"><a href='../domain-model-vs-service-in-a-mvc-context/'>Domain Model vs Service in a MVC context</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>