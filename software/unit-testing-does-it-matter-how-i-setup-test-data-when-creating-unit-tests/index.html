<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; Does it matter how I setup test data when creating unit tests &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081356 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081356" class="post-1081356 software type-software status-publish hentry category-software tag-tdd tag-testing tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; Does it matter how I setup test data when creating unit tests</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">tdd</span><span class="mr-2 badge badge-info">testing</span><span class="mr-2 badge badge-warning">unit testing</span></p><div class="entry-content"><p>I have a unit test similar to the code snippet below, it should check that the AddUser method only allows unique emails.</p><p>My question is around the <code>Arrange</code> part of this unit test, I use existing system code to setup the first user (class <code>UserLogic</code>), this is so that I have a user in context to perform the next parts of the test (<code>Act</code> and <code>Arrange</code>).</p><pre><code>[Fact]
public void CheckUniqueEmail()
{
    var context = new DbContext(); //EF Core in memory db

    //Arrange
    UserLogic userlogic = new UserLogic(context);
    User user = new User(&#39;test@test.com&#39;);

    userlogic.AddUser(user);

    //Act
    UserLogic userlogicNew = new UserLogic(context);
    User userNew = new User(&#39;test@test.com&#39;);

    bool result = userlogicNew.AddUser(userNew); //result should be false since this email has already been used

    //Assert
    Assert.False(result);
}
</code></pre><p>However, I have seen this done in two ways: The first is as I have done above. The second would be to insert data directly into context, as in the next example</p><pre><code>[Fact]
public void CheckUniqueEmail()
{
var context = new DbContext(); //EF Core in memory db

//Arrange
context.Users.Add(new User({Email=&#39;test@test.com&#39;}))
context.SaveChanges();    

//Act
UserLogic userlogicNew = new UserLogic(context);
User userNew = new User(&#39;test@test.com&#39;);

bool result = userlogicNew.AddUser(userNew); //result should be false since this email has already been used

//Assert
Assert.False(result);
}
</code></pre><p>Based on the foregoing, <strong>does matter the way I arrange the data for the unit tests? Which one of the two approaches do you think is appropriated for unit tests?</strong></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>How you set up test data is important, and I&#39;d argue both versions are suboptimal.</p><p>Every method or class you write has a contract, whether explicit (by documentation for instance) or implicit (by what the code actually does). This contract is important, because it describes what the clients, i.e. the code that uses your class, should expect when it uses it. Unit testing is a method to programmatically document the contract of the code under test, in a way that it ensures that the behaviour is the same even if the implementation changes.</p><p>An important characteristic of unit tests is that they want the code under test (CUT) to be <strong>isolated</strong> from other code. This means you have to be very careful when the CUT has dependencies. If it uses a dependency which has a different reason to change than itself (this is what <em>responsibility</em> means in the single responsibility principle), you&#39;ll usually have an abstraction to isolate these two. This abstraction itself has a contract, and in unit testing, you assume that the abstraction on which you depend will behave according to its contract. In unit tests, this generally means that this dependency will be <em>mocked</em>, and you will pilot the mock to behave in a certain way.</p><p>Back to your example now. You are unit testing the <code>UserLogic</code> class. It has two dependencies that I can see: <code>User</code> and <code>DbContext</code>. I don&#39;t have enough context to know what <code>User</code> is, but I&#39;ll assume it is some sort of value object. In that case, it is fine to use it directly.<br/> <code>DbContext</code> is a different beast. It seems to be an implementation of some sort of persistence. It definitely has a different reason to change than <code>UserLogic</code>, which means it should be abstracted by an interface of some sort. I&#39;ll assume you already have one which is called <code>Context</code>.</p><p>Therefore, I can assume the implementation of <code>UserLogic.AddUser</code> looks like something like this:</p><pre><code>public boolean AddUser(User user) {
  if (context.HasUser(user)) {
    return false;
  }

  context.AddUser(user);
  context.SaveChanges();
  return true;
}
</code></pre><p>The outcome that you want to unit test is as follow: If the <code>User</code> has already been added to the <code>context</code>, you want to ensure the <code>Context</code> hasn&#39;t changed (no new users were added, nor were the changes saved).</p><p>The description of the outcome described pretty much exactly how the unit test should look. What you want to arrange is that the <code>context</code> already has a specific <code>User</code>. What you want to act on is <code>AddUser</code>. What you want to assert is that the <code>User</code> was not added, and the <code>Context</code> was not saved. Therefore, your unit test looks like this (in Java, I&#39;m not too familiar with C# testing libraries):</p><pre><code>@Test
public void givenContextAlreadyHasTheUser_whenAddUser_thenTheUserIsNotAddedASecondTime() {
  // Arrange
  Context context = mock(Context.class);
  User user = new User(&#34;test@test.com&#34;);
  UserLogic userLogic = new UserLogic(context);
  given(context.HasUser(user)).willReturn(true);

  // Act
  userLogic.AddUser(user);

  // Assert
  verify(context, never()).AddUser(any());
  verify(context, never()).SaveChanges();
}
</code></pre><p>As a user of the <code>UserLogic</code> class, I can refer to this test to know exactly what the contract of <code>AddUser</code> describes in the case where the <code>User</code> is already added to the context, which is what I&#39;m looking for in unit tests.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../use-of-fixtures-in-unit-testing/'>Use of fixtures in unit testing</a></li><li class="list-group-item"><a href='../unit-testing-how-should-i-test-boolean-function-with-many-possible-permutations/'>Unit-testing &#8211; How should I test boolean function with many possible permutations</a></li><li class="list-group-item"><a href='../unit-testing-where-is-the-line-between-unit-testing-application-logic-and-distrusting-language-constructs/'>Unit-testing &#8211; Where is the line between unit testing application logic and distrusting language constructs</a></li><li class="list-group-item"><a href='../object-oriented-why-is-white-box-testing-discouraged-in-oop/'>Object-oriented &#8211; Why is white box testing discouraged in OOP</a></li><li class="list-group-item"><a href='../unit-testing-how-to-write-unit-tests-for-code-with-difficult-to-predict-results/'>Unit-testing &#8211; How to write unit tests for code with difficult to predict results</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>