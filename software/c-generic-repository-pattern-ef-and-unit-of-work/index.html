<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Generic repository pattern +EF and unit of work &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1066654 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1066654" class="post-1066654 software type-software status-publish hentry category-software tag-c tag-design-patterns tag-entity-framework tag-object-oriented tag-repository-pattern"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Generic repository pattern +EF and unit of work</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">design-patterns</span><span class="mr-2 badge badge-warning">entity-framework</span><span class="mr-2 badge badge-primary">object-oriented</span><span class="mr-2 badge badge-danger">repository-pattern</span></p><div class="entry-content"><p>I&#39;m new to this Repository pattern and  have seen lot of repository pattern + UoW implementations all over the internet and I&#39;m not able to reach to a conclusion as to which of them is correct . After going through many links I&#39;ve been able to implement one .</p><p>Considering the following points in mind</p><ul><li>It should satisfy SOLID principles</li><li>Be testable</li><li>Be independent<br /> of framework</li><li>Be independent of DB</li></ul><p>Here is the code of the implementation</p><p><strong>Generic IRepository</strong></p><pre><code> public interface IRepository&lt;T&gt; where T : class
    {

        void Add(T entity);

        void Update(T entity);

        void Delete(T entity);

        T GetByKey(object id);

    }
</code></pre><p><strong>RepositoryBase</strong></p><pre><code>public abstract class RepositoryBase&lt;D, T&gt; : IRepository&lt;T&gt; where T : class where D : BaseDbContext
{


    private D dataContext;
    private readonly IDbSet&lt;T&gt; dbSet;

    protected IDbFactory&lt;D&gt; DbFactory
    {
        get;
        private set;
    }

    protected D DbContext
    {
        get { return dataContext ?? (dataContext = DbFactory.Init()); }
    }


    protected RepositoryBase(IDbFactory&lt;D&gt; dbFactory)
    {

        DbFactory = dbFactory;
        dbSet = DbContext.Set&lt;T&gt;();

    }


    #region Implementation
    public virtual void Add(T entity)
    {
        dbSet.Add(entity);
    }

    public virtual void Update(T entity)
    {
        dbSet.Attach(entity);
        DbContext.Entry(entity).State = EntityState.Modified;
    }

    public virtual void Delete(T entity)
    {
        dbSet.Remove(entity);
    }


    public T GetByKey(object id)
    {
        return dbSet.Find(id);
    }


    #endregion

}
</code></pre><p><strong>IUnitofWork , UnitOfWork</strong></p><pre><code>public interface IUnitOfWork&lt;D&gt; where D : BaseDbContext
    {
        void Commit();
    }



public class UnitOfWork&lt;D&gt; : IUnitOfWork&lt;D&gt; where D : BaseDbContext, new()
{
    private readonly IDbFactory&lt;D&gt; dbFactory;
    private D dbContext;

    public UnitOfWork(IDbFactory&lt;D&gt; dbFactory)
    {
        this.dbFactory = dbFactory;
    }

    public D DbContext
    {
        get { return dbContext ?? (dbContext = dbFactory.Init()); }
    }

    public void Commit()
    {
        DbContext.SaveChanges();
    }
}
</code></pre><p><strong>IDBFactory ,DBFactory</strong></p><pre><code>public interface IDbFactory&lt;D&gt; where D : BaseDbContext
{
    D Init();
}




public class DbFactory&lt;D&gt; : Disposable, IDbFactory&lt;D&gt; where D : BaseDbContext, new()
        {
            D dbContext;
            public D Init()
            {
                return dbContext ?? (dbContext = new D());
            }
            protected override void DisposeCore()
            {
                if (dbContext != null)
                    dbContext.Dispose();
            }
        }
</code></pre><p><strong>BaseDbContext</strong></p><pre><code>public abstract class BaseDbContext : DbContext
{
public BaseDbContext(string nameOrConnectionString) : base(nameOrConnectionString)
        {

        }

}
</code></pre><p><strong>ProjectDbContext</strong></p><pre><code> public partial class ProjectDbContext : BaseDbContext
    {
        public ProjectDbContext()
            : base(&#34;name=ProjectDbContext&#34;)
        {
            Database.SetInitializer&lt;ProjectDbContext&gt;(null);
        }


    }
</code></pre><p><strong><em>EXAMPLE USAGE</em></strong></p><p><strong>Controller</strong></p><pre><code> public class StudentsController : BaseController
    {

        private IStudentBusiness objstudentbusiness;
        public StudentsController(IStudentBusiness rstudentbusiness)
        {
            objstudentbusiness = rstudentbusiness;
        }


        public JsonResult LoadStudents()
        {

                var data = objstudentbusiness.ListStudents();
                var jsonResult = Json(data, JsonRequestBehavior.AllowGet);
                return jsonResult;

        }

    }
</code></pre><p><strong>IStudentBAL,StudentBAL</strong></p><pre><code> public interface IStudentBAL
    {
        void SaveStudent(StudentDto student);
        List&lt;StudentDto&gt; ListStudents();
    }


public class StudentBAL : BusinessBase, IStudentBAL
{

    private readonly IStudentRepository objStudentRepository;
    private readonly IUnitOfWork&lt;ProjectDbContext&gt; objIUnitOfWork;

    public StudentBAL(IStudentRepository rIStudentRepository, IUnitOfWork&lt;ProjectDbContext&gt; rIUnitOfWork)
    {
        try
        {
            objStudentRepository = rIStudentRepository;
            objIUnitOfWork = rIUnitOfWork;
        }
        catch (Exception ex)
        {

            Log.Error(ex);
        }

    }

    public List&lt;StudentDto&gt; ListStudents()
    {
        try
        {
            var tusrs = objStudentRepository.ListStudents() ?? new List&lt;StudentDto&gt;();
            return tusrs;
        }
        catch (Exception ex)
        {
            Log.Error(ex);

        }
        return new List&lt;StudentDto&gt;();
    }
}
</code></pre><p><strong>IStudentRepository,StudentRepository</strong></p><pre><code> public interface IStudentRepository
    {
        void SaveStudent(Student Student);
        StudentDto GetStudentByName(StudentDto Studentname);
        Student GetStudentByID(int Studentid);
        List&lt;StudentDto&gt; ListStudents();
    }

public class StudentRepository : RepositoryBase&lt;ProjectDbContext, Student&gt;, IStudentRepository
{
    public StudentRepository(IDbFactory&lt;ProjectDbContext&gt; dbFactory) : base(dbFactory)
    {
    }
    public List&lt;StudentDto&gt; ListStudents()
    {

            var students = (from t in DbContext.Students

                        select new StudentDto
                        {
                           // all the required properties
                        }).ToList();


            return students;

    }
}
</code></pre><ul><li>Dependency Injection is done using AutoFac</li><li>Code for logging is omitted</li></ul><p>I am asking if this seems like a good implementation or am I missing anything?</p><p>I would appreciate any feedback on my implementation you can offer regarding correctness, efficiency, and any suggestions. So here are my questions</p><ul><li>Is this loosely coupled ?</li><li>Is it having any leaky abstraction and why ?</li><li>What needs to be done to switch from EF to MySQL db and how much effort would it require to implement the changes?</li><li>Is this pattern breaking any of the SOLID princples ,Law or Demeter or any Object Oriented laws?</li><li>Does this pattern have any code redundancies which are not required ?</li><li>How this architecture using EF would scale with a project containing more than 100+ domain entities and with each entity having  at least more than 10 fields . Is it going to be maintenance nightmare later on?</li></ul><p><strong>-All criticisms greatly appreciated !!</strong></p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>It should satisfy SOLID principles</p></blockquote><p>A laudable goal, but does it help you satisfy any of your software&#39;s functional and non-functional requirements?</p><p>The purpose of the SOLID principles is to help you write better code; not to be a goal, requirement, or metric in its own right.  If you&#39;re spending you&#39;re time measuring your project&#39;s progress by observing and categorizing your code&#39;s strict adherence to SOLID principles, you&#39;re doing it wrong.</p><blockquote><p>Be testable</p></blockquote><p>Also a laudable goal.  But frankly, most of this code is just plumbing, and it&#39;s not particularly interesting from a unit testing perspective.  Simplifying the code would make it easier to test, and most of the testing would be integration testing anyway.</p><blockquote><p>Be independent of the framework/db</p></blockquote><p>The value of this requirement is debatable unless you know you&#39;re going to change frameworks later on.  As you&#39;ve already noticed, having this kind of flexibility requires a lot of discipline to decouple your implementations, and sometimes this level of rigor is not worth the cost.</p><p>The vast majority of software projects never change their framework or DB decisions.  Though to be fair, at my last job, the ORM was changed out two or three times (the database was never changed; it remained SQL Server throughout the project&#39;s lifetime).</p><blockquote><p>Dependency Injection uses AutoFac</p></blockquote><p>Have you included an <code>Interface</code> for your DI container so that you can change that out later, if you wish?  Note that this possibility is more likely than changing the framework or DB.</p><blockquote><p>Logging code is omitted</p></blockquote><p>Have you included an <code>Interface</code> for your logging implementation so that you can change that out later, if you wish?   Note that this possibility is more likely than changing the framework or DB.</p><p>Have you considered the cross-cutting implications of logging?  Does every class take a reference to your <code>ILogger</code> interface, or have you adopted an exception-handling strategy?</p><blockquote><p>Is this loosely coupled?</p></blockquote><p>Yes and no.  Everywhere you&#39;ve used an Interface? Yes.  Everywhere you&#39;ve inherited a base class or taken a concrete reference?  No.  I assume that <code>RepositoryBase</code> is where you implement your provider-specific generic repository; it&#39;s a perfectly valid technique, so long as you don&#39;t mind rewriting it when you change your DB/ORM.</p><blockquote><p>Is it having any leaky abstraction and why?</p></blockquote><p>EF is itself a leaky abstraction.  The Entities you&#39;re passing to and from EF in your <code>BaseRepository</code> implementation contain all sorts of leaks, but the only way to avoid that is to decouple it by providing your own set of entities that map to the EF Entities.  Managing the resulting change tracking problems is going to be complicated; it&#39;s probably not worth the trouble.</p><blockquote><p>What needs to be done to switch from EF to MySQL db and how much effort would it require to implement the changes?</p></blockquote><p>EF and MySQL are not comparable.  EF is an Object-Relational Mapper and Unit of Work implementation; MySQL is a relational database system.  MySQL is a replacement for SQL Server, not EF.  EF is normally used in conjunction with SQL server, though providers are available for other databases, so the option is there.</p><p>However, to achieve true database-independence, you&#39;ll need to conform to ANSI SQL, which means you&#39;ll sacrifice any vendor-specific features of your chosen database such as SQL-specific performance improvements.  You&#39;ll probably want to avoid stored procedures altogether.</p><blockquote><p>Is this pattern breaking any of the SOLID principles, Law or Demeter or any Object Oriented laws?</p></blockquote><p>I didn&#39;t evaluate your code on this basis.  Suffice it to say that, based on your design goals, your design approach (and your code) seems reasonably sound.</p><blockquote><p>Does this pattern have any code redundancies which are not required?</p></blockquote><p>Not that I can see, based on your design requirements.</p><blockquote><p>How this architecture using EF would scale with a project containing more than 100+ domain entities and with each entity having at least more than 10 fields. Is it going to be maintenance nightmare later on?</p></blockquote><p>I&#39;ve used EF successfully with this many entities.  EF offers help creating the necessary entity classes from the database, assuming you do database-first design.  Keeping things straight in an environment with multiple software developers (and multiple environments: development, staging, production) can be tricky; one slip in the nullability of a field can take down an entire production system if you&#39;re not careful, and the compiler won&#39;t catch it because it&#39;s perfectly valid C#.</p><h3>Some other thoughts</h3><p>The code you posted only supports CRUD operations.  Eighty percent of your application might work fine using merely Create, Read, Update and Delete methods, but the other 20 percent will require custom SQL if you expect it to perform adequately and be a good fit for your use cases.  Have you accounted for this possibility?</p><p>Consider using a micro-ORM like Dapper instead of one of the heavyweights like EF or nHibernate.  Dapper will give you all of the CRUD operations you want, offers an Execute SQL method that is virtually identical to EF&#39;s Execute SQL method for those occasions where custom SQL is indicated, and has much better performance than EF out of the box.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-is-there-a-real-advantage-to-generic-repository/'>C# &#8211; Is There a Real Advantage to Generic Repository</a></li><li class="list-group-item"><a href='../c-repository-pattern-and-joined-queries/'>C# &#8211; Repository Pattern and Joined Queries</a></li><li class="list-group-item"><a href='../c-is-unit-of-work-pattern-really-needed-with-repository-pattern/'>C# &#8211; Is unit of work pattern really needed with repository pattern</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>