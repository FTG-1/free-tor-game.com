<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; TDD: Create a Game logic using Test-First Programming &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080253 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080253" class="post-1080253 software type-software status-publish hentry category-software tag-architecture tag-tdd tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; TDD: Create a Game logic using Test-First Programming</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">tdd</span><span class="mr-2 badge badge-warning">unit testing</span></p><div class="entry-content"><p>I&#39;m implementing a simple command line game using TDD principles and Unit Testing. My goal is to implement the whole game using Test-First Programming, so every behaviour/class is created from a test.<br /> I&#39;ve already implemented things like a Player (the game needs a player), the Enemy (the player fights the enemy) and other stuff but now that I have to implement the Game logic itself, which actually takes all these classes and combines them together to achieve the functionality, I&#39;m stuck.<br /> The problem is that the Game itself should just expose a Run() method and nothing more. This is because it&#39;s the game itself that runs its logic and not someone else from the outside that tells it what to do.</p><p>Here is some pseudo-code,</p><pre><code>class Game
{
    Game(Player p, EnemyFactory f)
    {
       this._player = p;
       //and so on...
    }

    public void Run()
    {
       // All the game logic goes here
       // In example:
       int totalEnemies = 5;
       while(_player.IsAlive &amp;&amp; totalEnemies &gt; 0)
       {
           Enemy enemy = _enemyFactory.CreateEnemy();
           _player.Fight(enemy);
           // other stuff
           totalEnemies--;
       }

       GameOver();
    }

    private GameOver()
    {
       //other stuff
    }
}
</code></pre><p>As you can see, the main logic is inside the Run function, which makes sense to expose as public, so that the Main() function that creates a Game class also calls Run(), but since all the logic will be a bunch of private functions, how do I create it from the tests first?<br /> The only thing that comes to my mind is or to use Mock, which I really don&#39;t want to do, or to expose some public functionality, but I don&#39;t want to create public behaviours that will be called only from the tests, because it&#39;s not a good practice.</p><p>Any idea please?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>I&#39;m implementing a simple command line game</p></blockquote><p>I frequently use this as a starting point for TDD exercises.  It&#39;s a really good choice, as it forces you to discover important distinctions between logic and effects.</p><blockquote><p>As you can see, the main logic it&#39;s inside the Run function, which makes sense to expose as public, so that the Main() function that creates a Game class also calls Run(), but since all the logic will be a bunch of private functions, how do I create it from the tests first?</p></blockquote><p>Your program is going to have a natural break between two parts - I/O and logic.  Testing I/O is harder - it lives higher up the <a href="https://martinfowler.com/articles/practical-test-pyramid.html" rel="nofollow noreferrer">test pyramid</a> than the logic tests.  This is in part because the IO system tends to be shared; you can&#39;t as easily run two tests concurrently without them interfering with each other.</p><p>So you are likely to end up with some tests that look like</p><pre><code>cat input | my-game &gt; actualOutput
diff actualOutput expectedOutput
</code></pre><p>If you read <em>Growing Object Oriented Software, Guided By Tests</em>, you find that Freeman and Price will talk about dedicating their initial work to a test like this run as part of their build/deploy pipeline.  It won&#39;t be a fancy implementation of the game yet (think hello world), but it will be enough to demonstrate that the project delivery system works.</p><p>Moving down the pyramid, we&#39;re going to find some tests that use <a href="https://martinfowler.com/bliki/TestDouble.html" rel="nofollow noreferrer">test doubles</a>; in this case, a &#34;stub&#34; or a &#34;fake&#34; for STDIN and a &#34;mock&#34; or &#34;spy&#34; for STDOUT.  So imagining an implementation of <code>Game.main</code>, it might look like:</p><pre><code>void main (String [] args) {
    Game.run(System.in, System.out);
}
</code></pre><p>or</p><pre><code>void main (String [] args) {
    Game g = new Game(System.in, System.out);
    g.run();
}
</code></pre><p>You don&#39;t normally try to &#34;unit test&#34; this <code>main</code> method, because it is directly coupled to the shared instances of STDIN and STDOUT.  Instead, the unit tests will measure the behavior of <code>run</code> using test doubles.  We&#39;ll be asserting on information collected by the implementation of STDOUT that we provide during the test.</p><p>This is an important idea in TDD - we&#39;ve deliberately designed the interface of game such that it can be tested in a more cost effective way.</p><p><a href="https://blog.thecodewhisperer.com/permalink/beyond-mock-objects" rel="nofollow noreferrer">JB Rainsberger wrote</a>:</p><blockquote><p>If we want to introduce indirection, then we ought to introduce the smallest indirection possible. And we absolutely must try to introduce better abstraction.</p></blockquote><p>What we&#39;ve done here is introduce a <em>seam</em>, which is the indirection that gives us control of the subject in the test environment.  What we want to be discovering as we iterate on the internal design is better abstractions.</p><p>Note that, to this point, we haven&#39;t really done anything to introduce <code>Player</code>, <code>Enemy</code>, or any of the other domain abstractions that we expect to use.  Those concepts are things that we expect to discover and extract during the refactoring step.  Once you have discovered them, and feel that their API is sufficiently stable, you can start writing tests that specifically measure those elements.</p><p>Which is to say, the tests of the Game, working seam to seam, tend to be too big, in this sense: they span a lot of distinct behaviors.  Because there are so many behaviors within the scope of the test, those tests tend to be &#34;brittle&#34;; we decide one little bit of behavior should be slightly different, and the entire test falls over.</p><blockquote><p>The only thing that comes to my mind is or to use Mock, which I really don&#39;t want to</p></blockquote><p>Well, then lets go a level deeper; STDIN and STDOUT are sources of <em>messages</em> to and from the IO System.  From a very high level, we have some thing like</p><pre><code>String [] lines = read(this.stdin)
String [] output = this.gameLogic(lines)
writeTo(this.stdout, output)
</code></pre><p><code>gameLogic</code> here doesn&#39;t depend on the IO system at all; it only cares about the data structure passed to it.  So you can test everything that is interesting and unique about your game in memory, without needing to worry about the IO system at all.</p><p>You probably wouldn&#39;t choose this API, because we like to think of games being interactive.  Instead, you&#39;d probably end up with something like a state machine</p><pre><code>while(game.running) {
    String line = nextLine(this.stdin)

    game.onLine(line)
    String output = game.output()

    writeTo(this.stdout, output)
}
</code></pre><p>Again, that middle section is just passing in memory data structures into and out of the game logic that you actually care about.  You &#34;discover&#34; this sort of API while iterating on the design that uses the mocks, but once this API is stable you can start writing tests directly against the API.</p><p>Gary Bernhardt&#39;s <a href="https://www.destroyallsoftware.com/talks/boundaries" rel="nofollow noreferrer">Boundaries</a> talk is a great introduction to this concept.</p><p>From this point, it&#39;s turtles all the way down; you continue to add new tests for desired behavior, and iterate on your internal design, and as concepts like <code>Player</code> and <code>Enemy</code> begin to stabilize, you start writing even smaller tests directly against those elements.</p><blockquote><p>you are saying that I started from the &#34;smaller&#34; classes that are composing the Game, instead of starting from the Game itself. I agree, I did that because I was stuck with this Run() problem.</p></blockquote><p>Right.  And to be fair, a <em>lot</em> of TDD literature starts from the inside and works outwards -- the members of the &#34;Detroit school&#34; already had the habits to separate the domain model from the plumbing, so they had a tendency to start from the middle.</p><blockquote><p>The other thing you are suggesting is basically use an external logic passed through the game (that can be mocked) to see if the game behaves in a certain way based on what is set on that logic.</p></blockquote><p>No, I&#39;m not suggesting that; although I will admit that it <em>works</em>.  What I&#39;m actually suggesting is slightly different -- that if you have the right arrangement of tests, you can iterate on your internal design until you have a &#34;CLI Framework&#34; component and a core game logic component.  The framework will be something that you can re-use for your next CLI app; the game logic will be something you can re-use when you decide your game should be accessible via a web api.</p><p>What I have found, in practice, is that as you become familiar with the basic isolation patterns, you tend to start &#34;closer&#34; to the interesting bits.  So, for instance, if I&#39;m writing an interactive CLI game, or a pipes-and-filters component, then I will just jump right past all of the plumbing tests and write the API signature straight from my head.</p><p>On the other hand, as soon as you introduce something like &#34;we also need to be able to save and load games from the file system&#34;, I need to zoom out a few layers and work my way back inwards more slowly, with more tests to reach my confidence threshold.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../unit-testing-do-you-really-have-to-do-bdd-tdd-in-a-test-first-manner/'>Unit-testing &#8211; Do you really have to do BDD/TDD in a test first manner</a></li><li class="list-group-item"><a href='../tdd-red-green-refactor-and-if-how-to-test-methods-that-become-private/'>TDD Red-Green-Refactor and if/how to test methods that become private</a></li><li class="list-group-item"><a href='../unit-testing-how-to-unit-test-logic-in-crud-app/'>Unit-testing &#8211; How to unit test logic in crud app</a></li><li class="list-group-item"><a href='../unit-testing-how-to-not-test-implementation-when-method-returns-void/'>Unit-testing &#8211; How to not test implementation when method returns void</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>