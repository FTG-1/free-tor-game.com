<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Object-oriented &#8211; continuous integration for scientific software &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1084226 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1084226" class="post-1084226 software type-software status-publish hentry category-software tag-c tag-continuous-integration tag-object-oriented tag-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Object-oriented &#8211; continuous integration for scientific software</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">continuous integration</span><span class="mr-2 badge badge-warning">object-oriented</span><span class="mr-2 badge badge-primary">testing</span></p><div class="entry-content"><p>I&#39;m no software engineer.<br /> I&#39;m a phd student in the field of geoscience.</p><p>Almost two years ago I started programming a scientific software. I never used continuous integration (CI), mainly because at first I didn&#39;t know it exists and I was the only person working on this software.</p><p>Now since the base of the software is running other people start to get interested in it and want to contribute to the software. The plan is that other persons at other universities are implementing additions to the core software. (I&#39;m scared they could introduce bugs). Additionally, the software got quite complex and became harder and harder to test and I also plan to continue working on it.</p><p>Because of this two reasons, I&#39;m now more and more thinking about using CI.<br /> Since I never had a software engineer education and nobody around me has ever heard about CI (we are scientists, no programmers) I find it hard to get started for my project.</p><p>I have a couple of questions where I would like to get some advice:</p><p>First of all a short explanation of how the software works:</p><ul><li><p>The software is controlled by one .xml file containing all required settings. You start the software by simply passing the path to the .xml file as an input argument and it runs and creates a couple of files with the results. One single run can take ~ 30 seconds.</p></li><li><p>It is a scientific software. Almost all of the functions have multiple input parameters, whose types are mostly classes which are quite complex. I have multiple .txt files with big catalogs which are used to create instances of these classes.</p></li></ul><p>Now let&#39;s come to my questions:</p><ol><li><p><strong>unit tests, integration tests, end-to-end tests?</strong>:<br /> My software is now around 30.000 lines of code with hundreds of functions and ~80 classes.<br /> It feels kind of strange to me to start writing unit tests for hundreds of functions which are already implemented.<br /> So I thought about simply creating some test cases. Prepare 10-20 different .xml files and let the software run. I guess this is what is called end-to-end tests? I often read that you should not do this, but maybe it is ok as a start if you already have a working software? Or is it simply a dumb idea to try to add CI to an already working software.</p></li><li><p><strong>How do you write unit tests if the function parameters are difficult to create?</strong><br /> assume I have a function <code>double fun(vector&lt;Class_A&gt; a, vector&lt;Class_B&gt;)</code> and usually, I would need to first read in multiple text files to create objects of type <code>Class_A</code>and <code>Class_B</code>. I thought about creating some dummy functions like <code>Class_A create_dummy_object()</code> without reading in the text files. I also thought about implementing some kind of <a href="https://www.boost.org/doc/libs/1_68_0/libs/serialization/doc/" rel="noreferrer">serialization</a>. (I do not plan to test the creation of the class objects since they only depend on multiple text files)</p></li><li><p><strong>How to write tests if results are highly variable?</strong> My software makes use of big monte-carlo simulations and works iteratively. Usually, you have ~1000 iterations and at every iteration, you are creating ~500-20.000 instances of objects based on monte-carlo simulations. If only one result of one iteration is a bit different the whole upcoming iterations are completely different. How do you deal with this situation? I guess this a big point against end-to-end tests, since the end result is highly variable?</p></li></ol><p>Any other advice with CI is highly appreciated.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Testing scientific software is difficult, both because of the complex subject matter and because of typical scientific development processes (aka. hack it until it works, which doesn&#39;t usually result in a testable design). This is a bit ironic considering that science should be reproducible. What changes compared to “normal” software is not whether tests are useful (yes!), but which kinds of test are appropriate.</p><p><strong>Handling randomness:</strong> all runs of your software MUST be reproducible. If you use Monte Carlo techniques, you must make it possible to provide a specific seed for the random number generator.</p><ul><li>It is easy to forget this e.g. when using C&#39;s <code>rand()</code> function which depends on global state.</li><li>Ideally, a random number generator is passed as an explicit object through your functions. C++11&#39;s <code>random</code> standard library header makes this a lot easier.</li><li>Instead of sharing random state across modules of the software, I&#39;ve found it useful to create a second RNG which is seeded by a random number from the first RNG. Then, if the number of requests to the RNG by the other module changes, the sequence generated by the first RNG stays the same.</li></ul><p><strong>Integration tests</strong> are perfectly fine. They are good at verifying that different parts of your software play together correctly, and for running concrete scenarios.</p><ul><li>As a minimum quality level “it doesn&#39;t crash” can already be a good test result.</li><li>For stronger results, you will also have to check the results against some baseline. However, these checks will have to be somewhat tolerant, e.g. account for rounding errors. It can also be helpful to compare summary statistics instead of full data rows.</li><li>If checking against a baseline would be too fragile, check that the outputs are valid and satisfy some general properties. These can be general (“selected locations must be at least 2km apart”) or scenario-specific, e.g. “a selected location must be within this area”.</li></ul><p>When running integration tests, it is a good idea to write a test runner as a separate program or script. This test runner performs necessary setup, runs the executable to be tested, checks any results, and cleans up afterwards.</p><p><strong>Unit test</strong> style checks can be quite difficult to insert into scientific software because the software has not been designed for that. In particular, unit tests get difficult when the system under test has many external dependencies/interactions. If the software is not purely object-oriented, it is not generally possible to mock/stub those dependencies. I&#39;ve found it best to largely avoid unit tests for such software, except for pure math functions and utility functions.</p><p>Even a few tests are better than no tests. Combined with the check “it has to compile” that&#39;s already a good start into continuous integration. You can always come back and add more tests later. You can then prioritize areas of the code that are more likely to break, e.g. because they get more development activity. To see which parts of your code are not covered by unit tests, you can use code coverage tools.</p><p><strong>Manual testing:</strong> Especially for complex problem domains, you will not be able to test everything automatically. E.g. I&#39;m currently working on a stochastic search problem. If I test that my software always produces the <em>same</em> result, I can&#39;t improve it without breaking the tests. Instead, I&#39;ve made it easier to do <em>manual</em> tests: I run the software with a fixed seed and get a <em>visualization</em> of the result (depending on your preferences, R, Python/Pyplot, and Matlab all make it easy to get high-quality visualizations of your data sets). I can use this visualization to verify that things did not go terribly wrong. Similarly, tracing the progress of your software via logging output can be a viable manual testing technique, at least if I can select the type of events to be logged.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../patterns-for-continuous-integration-and-dvcs/'>Patterns for Continuous Integration and DVCS</a></li><li class="list-group-item"><a href='../how-to-continuous-delivery-work-in-practice/'>How to Continuous Delivery work in practice</a></li><li class="list-group-item"><a href='../a-good-integration-test-strategy/'>A good integration test strategy</a></li><li class="list-group-item"><a href='../how-to-scale-your-integration-testing/'>How to scale your integration testing</a></li><li class="list-group-item"><a href='../unit-testing-how-to-write-tests-that-make-sense-for-visualization-software/'>Unit-testing &#8211; How to write tests that make sense for visualization software</a></li><li class="list-group-item"><a href='../c-using-vectors-of-shared-pointers-to-objects-in-the-c-code-to-prevent-object-duplication/'>C++ &#8211; Using vectors of shared pointers to objects in the C++ code to prevent object duplication</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>