<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; API Design &#8211; Observable vs Callback &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1076869 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1076869" class="post-1076869 software type-software status-publish hentry category-software tag-api-design tag-c tag-observer-pattern"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; API Design &#8211; Observable vs Callback</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">api-design</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">observer-pattern</span></p><div class="entry-content"><p>We as a team are writing an C# SDK which communicates with a Server endpoint. All our API&#39;s till now have been Task based. Like</p><p>Task DoOperationAsync()</p><p>Recently we across a need for API which gets an intermediate update (file location) before the final one if the user opts for it.</p><p>DoSomething(bool interestedInIntermediateFile)</p><p>There are two option which came on the table</p><ol><li><p>Rx.IObservable &lt; OpResult &gt; DoSomething(bool interestedInIntermediateFile)</p></li><li><p>Task &lt; OpResult &gt; DoSomething(Action &lt; string &gt; intermediateFile)</p></li></ol><p>Where OpResult { Enum CompletionReason, enum FileType, string FileLoc }</p><p>FileType &#8211; Intermediate, Final</p><p>CompletionReason &#8211; Reason (only applicable when FileType is final)</p><p>Wanted to know from the experts which would be a good API design.</p><p><strong>Notes : We do see that some of the new future API would be observable based. So it will not be case that this is only observable API.</strong></p><hr/><p>Adding a additional note &#8211; since it might not be so obvious from above.</p><blockquote><p>CompletionReason contains a value only in the final update the intermediate update will have this as null. As the intermediate update, final result though related but not exact (in terms of populating fields) has been raised as a downside to observable. Is it a genuine downside.</p></blockquote><p>Thanks in advance.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The decision on what technology to use is largely going to be about the skills in your team, and the audience to which your SDK is aimed, and to some extent whether or not your API will in the longer term benefit from being a provider of observable streams.</p><p>Rx.NET is a very powerful and flexible way of doing things, and I would recommend any .NET developer who needs to handle concurrency and/or streams of events to look into it.</p><p>(I assume that by &#34;IObservable&#34; you mean Rx.Net. Or are you looking into Akka Streams or some such?)</p><p>However, getting into the IObservable way of thinking can be a steep learning curve.</p><p>There is a lot of overlap between Task and Rx.NET. One explanation of the overlap is <a href="https://blogs.msdn.microsoft.com/flaviencharlon/2012/08/06/taskt-vs-iobservablet-when-to-use-what/" rel="nofollow noreferrer">here</a> but in my opinion is biased in favour of Task.</p><p>If you anticipate that your API will be dealing with asynchronous streams, such as returning long lists of data, or driving a push model, or wanting to combine multiple streams, then look into Rx.NET</p><p>If you anticipate that your API will benefit from LINQ over streams (with Rx.NET you can easily query IObservables as they are the &#39;push&#39; version of IEnumerable, the &#39;pull&#39; version), then look into Rx.NET. For example, look into .Where .Select .SelectMany .Buffer .Zip .Scan operators in Rx.NET and decide if you will have many uses for them.</p><p>If you see that your API will eventually become a push-model stream service and if you have the skills on hand, you might want to seriously consider Rx.NET</p><p>If it&#39;s just the small problem you described in your original post, it might not be worth the overhead of learning the Rx way unless you already have skills on hand. In essence, your chain of tasks (see Attached child tasks <a href="https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/attached-and-detached-child-tasks" rel="nofollow noreferrer">here</a> ) is a dumbed down Rx IObservable. The advantage is that this code is intuitive for many developers. You don&#39;t need to view it as IObservable vs Callback, a Task is not a callback, and your child tasks (intermediate steps) can be returned as a collection of tasks (eg: you could compose your tasks as a list like final task + intermediate task, and then wait for When Any or some such, maybe attach the intermediate as child tasks).</p><hr/><p>Update: The concern you raise in your update that the operation completion message will be raised with a null value during intermediate steps makes no sense. Whichever approach you take, intermediate steps will not describe the operation completion reason, unless of course that intermediate step is post-hoc actualized as the final step.
In the 1st scenario (Tasks): your intermediate action will not raise a completion reason (null).
In the 2nd scenario (Observables): your intermediate actions will not raise a completion reason.
What is the difference?
What you should do in the case of the Observable is declare it an observable of &#34;action results&#34;. This is semantically equivalent to Task (a <em>future</em> result). Declare X types of result message. Eg:</p><pre><code>public class ResultMessage

public class FinalResultMessage: ResultMessage

etc
</code></pre><p>You can then implement Task or IObservable as you wish.</p><p>If you go the route of Observable. You can offer <code>.Finally</code> either in the subscriber or the observable to handle the FinalResultMessage.</p><p>In short, do not make the API an IObservable but IObservable if you go that route, and apply the same thinking for Task too.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-difference-between-consumer-producer-and-observer-observable/'>Java &#8211; Difference between Consumer/Producer and Observer/Observable</a></li><li class="list-group-item"><a href='../mvc-should-you-write-your-back-end-as-an-api/'>Mvc &#8211; Should you write your back-end as an API</a></li><li class="list-group-item"><a href='../observer-for-two-independent-events-in-the-observable-class/'>Observer for two independent events in the observable class</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>