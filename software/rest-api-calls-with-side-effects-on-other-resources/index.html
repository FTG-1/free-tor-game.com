<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Rest API calls with side effects on other resources &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1074957 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1074957" class="post-1074957 software type-software status-publish hentry category-software tag-aggregate tag-api tag-mobile tag-resources tag-rest"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Rest API calls with side effects on other resources</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">aggregate</span><span class="mr-2 badge badge-info">api</span><span class="mr-2 badge badge-warning">mobile</span><span class="mr-2 badge badge-primary">resources</span><span class="mr-2 badge badge-danger">rest</span></p><div class="entry-content"><p>Let&#39;s say I have a mobile app, android/iOS and a java Spring back end. Given the mobile connectivity, the number of network round trips must be limited, ideally, 1 or less per screen.</p><p>Now, let&#39;s say I want to add/rewrite some messaging capabilities when 2+ app users can send each other messages.</p><p>There are 2 tables / resources (simplified here). &#39;Conversation&#39; and &#39;Message&#39;. Each conversation contain multiple messages.</p><pre><code>conversation 
-----------------
id 
type 
last_message_test
last_message_username
message_count
etc

message
------------
id
conversation_id 
user_id
user name 
text
timestamp 
</code></pre><p>The conversation records contain some information about the latest message that took place in it so that a screen listing just the header of many conversations can show its latest content without having to query the actual message table (also the message count).</p><p>ideally there would be calls like this:</p><pre><code>POST /api/conversation                                 =&gt; create a new conversation 
POST /api/conversation/1234/message                    =&gt; post a new message in conversation 1234
GET  /api/conversation?searchparam1=1&amp;searchparam2=2   =&gt; retrieve certain conversation without their full actual content
GET  /api/converstaion/1234/message                    =&gt; retrieve all the messages of a given conversation, 1234
</code></pre><p>Here are the problems though:</p><p><strong>problem A)</strong><br /> When positing a new message, this creates a new message resource but their is also the side effect of an (async / messaging) update on the corresponding &#39;conversation&#39; record. So POSTing a new resource of typeA triggers a PATCHing of another resource of typeB. Is that OK?</p><p><strong>problem B)</strong><br /> When positing the first message, there isn&#39;t yet a conversation record. Both must be created, first the &#39;conversation&#39; record, then the &#39;message&#39; record that will contain the new conversation ID (ideally in a transaction). How to do that in a rest way without having to do 2 api calls?</p><p>Basically trying to find the right compromise between:</p><ul><li>number of rest calls</li><li>duplicated db fields and queries</li><li>rest style of resource-oriented API</li></ul><p>Maybe it&#39;s not really possible without adding some sort of artificial new resources or &#39;batch / bundle / aggregate&#39; operations / end points? any recommendations appreciated, thanks!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Problem A) Yes, that&#39;s fine. <code>REST</code>ful <code>POST</code>s are permitted to generate side effects on other resources. I&#39;d suggest breaking out messages from conversations in your URI hierarchy in this case, or allowing clients to POST a message resource to <code>/conversations</code> to create a new conversation. It could respond with a <code>Conversation Message</code> with a &#34;self&#34; URI pointing to the newly created conversation and message.</p><p>Problem B) When you <code>POST</code> a new message, if it doesn&#39;t contain a conversation ID, have your service layer start a transaction that creates a new conversation, then creates the message with the conversation id. Your response from that <code>POST</code> can contain the conversation id for future calls.</p><p>I think that part of your problem is conflating a database table with a resource. It&#39;s often the case that the database model and resource model should be different, and I think this is a good example.</p><p>If you want to be able to update the screen in one call, figure out what information needs to be in the response to that call. Make that your resource. Clients can <code>POST</code> to <code>/messages</code> and get a response back containing something that isn&#39;t a message.</p><p>What <code>REST</code> is trying to push you towards is a state machine, where the resources are states, the requests are the inputs that determine which transition you make, and the response contains the new state after you complete the transition.</p><p>Unrelated but maybe helpful - it is a (loose) standard to use plurals for collection resources, so I would expect to see <code>/conversations</code> and <code>/messages</code>.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../rest-proper-response-for-a-rest-insert-full-new-record-or-just-the-record-id-value/'>Rest &#8211; Proper response for a REST insert &#8211; full new record, or just the record id value</a></li><li class="list-group-item"><a href='../rest-api-design-multiple-resources-and-authorization/'>REST API Design: Multiple resources and authorization</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>