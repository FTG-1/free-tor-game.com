<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; ny practical way for a linked node structure to be immutable &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070118 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070118" class="post-1070118 software type-software status-publish hentry category-software tag-immutability tag-java tag-linked-list"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; ny practical way for a linked node structure to be immutable</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">immutability</span><span class="mr-2 badge badge-info">java</span><span class="mr-2 badge badge-warning">linked list</span></p><div class="entry-content"><p>I decided to write a singly-linked list, and had the plan going in to make the internal linked node structure immutable.</p><p>I ran into a snag though. Say I have the following linked nodes (from previous <code>add</code> operations):</p><pre><code>1 -&gt; 2 -&gt; 3 -&gt; 4
</code></pre><p>and say I want to append a <code>5</code>.</p><p>To do this, since node <code>4</code> is immutable, I need to create a new copy of <code>4</code>, but replace its <code>next</code> field with a new node containing a <code>5</code>. The problem is now, <code>3</code> is referencing the old <code>4</code>; the one without the appended <code>5</code>. Now I need to copy <code>3</code>, and replace its <code>next</code> field to reference the <code>4</code> copy, but now <code>2</code> is referencing the old <code>3</code>&#8230;</p><p>Or in other words, to do an append, the entire list seems to need to be copied.</p><p>My questions:</p><ul><li><p>Is my thinking correct? Is there any way to do an append without copying the entire structure?</p></li><li><p>Apparently &#34;Effective Java&#34; contains the reccomendation:</p><blockquote><p>Classes should be immutable unless there&#39;s a very good reason to make them mutable&#8230;</p></blockquote><p>Is this a good case for mutability?</p></li></ul><p>I don&#39;t think this is a duplicate of the suggested answer since I&#39;m not talking about the list itself; that obviously has to be mutable to conform to the interface (without doing something like keeping the new list internally and retrieving it via a getter. On second thought though, even that would require some mutation; it would just be kept to a minimum). I&#39;m talking about whether or not the internals of the list must be immutable.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>With lists in functional languages, you nearly always work with a head and tail, the first element and the remainder of the list.  Prepending is much more common because, as you surmised, appending requires copying the entire list (or other lazy data structures that don&#39;t precisely resemble a linked list).</p><p>In imperative languages, appending is much more common, because it tends to feel more natural semantically, and you don&#39;t care about invalidating references to previous versions of the list.</p><p>As an example of why prepending doesn&#39;t require copying the entire list, consider you have:</p><pre><code>2 -&gt; 3 -&gt; 4
</code></pre><p>Prepending a <code>1</code> gives you:</p><pre><code>1 -&gt; 2 -&gt; 3 -&gt; 4
</code></pre><p>But note that it doesn&#39;t matter if someone else is still holding a reference to <code>2</code> as the head of their list, because the list is immutable and the links only go one way.  There&#39;s no way to tell the <code>1</code> is even there if you only have a reference to <code>2</code>.  Now, if you appended a <code>5</code> onto either list, you&#39;d have to make a copy of the entire list, because otherwise it would appear on the other list as well.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../immutable-structures-and-deep-composition-hierarchy/'>Immutable structures and deep composition hierarchy</a></li><li class="list-group-item"><a href='../internal-mutation-of-persistent-data-structures/'>Internal Mutation of Persistent Data Structures</a></li><li class="list-group-item"><a href='../java-thoughts-on-a-custom-data-structure-for-a-node-chain-implementation/'>Java &#8211; Thoughts on a custom data structure for a node/chain implementation</a></li><li class="list-group-item"><a href='../java-storing-object-graphs-with-class-evolution-in-java-with-transformation-long-time-archiving/'>Java &#8211; Storing object-graphs with class-evolution in Java with transformation (long time archiving)</a></li><li class="list-group-item"><a href='../java-why-doesnt-java-8-include-immutable-collections/'>Java &#8211; Why doesn&#8217;t Java 8 include immutable collections</a></li><li class="list-group-item"><a href='../c-linked-list-implementation-pointer-vs-pointer-to-pointer-consistency/'>C Linked List Implementation Pointer vs. Pointer-to-Pointer Consistency</a></li><li class="list-group-item"><a href='../workaround-for-implementing-operations-on-doubly-linked-or-circular-data-structures-in-languages-with-immutable-data/'>Workaround for implementing operations on doubly linked or circular data structures in languages with immutable data</a></li><li class="list-group-item"><a href='../object-oriented-can-we-really-use-immutability-in-oop-without-losing-all-key-oop-features/'>Object-oriented &#8211; Can we really use immutability in OOP without losing all key OOP features</a></li><li class="list-group-item"><a href='../changing-immutable-objects-how-does-this-work/'>Changing immutable objects how does this work</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>