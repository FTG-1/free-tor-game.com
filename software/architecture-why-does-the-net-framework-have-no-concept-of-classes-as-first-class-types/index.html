<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; Why does the .NET framework have no concept of classes as first-class types &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1082437 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1082437" class="post-1082437 software type-software status-publish hentry category-software tag-architecture tag-delphi tag-history tag-net"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; Why does the .NET framework have no concept of classes as first-class types</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">delphi</span><span class="mr-2 badge badge-warning">history</span><span class="mr-2 badge badge-primary">net</span></p><div class="entry-content"><p>It&#39;s well known to those familiar with the history that C# and the .NET framework started out as essentially &#34;Delphi rewritten to feel like Java,&#34; architected by the chief developer behind Delphi, Anders Hejlsberg.  Things have diverged quite a bit since then, but early on the similarities were so obvious that there was even some <a href="http://delphi.about.com/od/delphifornet/a/conspiracydnet.htm" rel="noreferrer">serious speculation that .NET was actually originally Borland&#39;s product.</a></p><p>But I&#39;ve been looking at some .NET stuff lately, and one of the most interesting and useful features from Delphi seems to be missing entirely: the concept of classes as a first-class data type.  For those not familiar with it, the type <code>TClass</code> represents a reference to a class, similar to the <code>Type</code> type in .NET.  But where .NET uses <code>Type</code> for reflection, Delphi uses <code>TClass</code> as a very important built-in part of the language.  It allows for various useful idioms that simply don&#39;t and can&#39;t exist without it, such as class subtype variables and virtual class methods.</p><p>Every OO language has virtual methods, in which different classes implement the same fundamental concept of a method in different ways, and then the right method gets called at runtime based on the actual type of the object instance it&#39;s called on.  Delphi extends this concept to classes: if you have a TClass reference defined as a specific class subtype (ie <code>class of TMyClass</code> means that the variable can accept any class reference that inherits from <code>TMyClass</code>, but not anything outside the heirarchy) that has class-scope virtual methods attached to it, they can be called without an instance by using the actual type of the class.  Applying this pattern to constructors makes a Factory implementation trivial, for example.</p><p>There doesn&#39;t seem to be anything equivalent in .NET.  With as useful as class references (and especially virtual constructors and other virtual class methods!) are, has anyone said anything about why they were left out?</p><h2>Specific Examples</h2><h3>Form Deserialization</h3><p>The Delphi VCL saves forms in <code>DFM</code> format, a DSL for describing a component hierarchy.  When the form reader parses DFM data, it runs across objects that are described like this:</p><pre><code>object Name: ClassName
   property = value
   property = value
   ...
   object SubObjectName: ClassName
      ...
   end
end
</code></pre><p>The interesting thing here is the <code>ClassName</code> part.  Each component class registers its <code>TClass</code> with the component streaming system at <code>initialization</code> time (think static constructors, only slightly different, guaranteed to happen immediately on startup.)  This registers each class in a string-&gt;TClass hashmap with the class name as the key.</p><p>Each component descends from <code>TComponent</code>, which has a virtual constructor that takes a single argument, <code>Owner: TComponent</code>. Any component can override this constructor to provide for its own initialization.  When the DFM reader reads a class name, it looks up the name in the aforementioned hashmap and retrieves the corresponding class reference (or raises an exception if it&#39;s not there), then calls the virtual TComponent constructor on it, which is known to be good because the registration function takes a class reference that is required to descend from TComponent, and you end up with an object of the proper type.</p><p>Lacking this, the WinForms equivalent is&#8230; well&#8230; a big mess to put it bluntly, requiring any new .NET language to completely re-implement its own form (de)serialization.  This is a bit shocking when you think about it; since the whole point of having a CLR is to let multiple languages use the same basic infrastructure, a DFM-style system would have made perfect sense.</p><h3>Extensibility</h3><p><a href="https://code.google.com/p/turbu/source/browse/trunk/classes/sdl custom/SDL_ImageManager.pas" rel="noreferrer">An image manager class I wrote</a> can be provided with a data source (such as a path to your image files) and then load new image objects automatically if you attempt to retrieve a name that&#39;s not in the collection but is available in the data source.  It has a class variable typed as <code>class of</code> the base image class, representing the class of any new objects to be created.  It comes with a default, but there are some points, when creating new images with special purposes, that the images should be set up in different ways.  (Creating it without an alpha channel, retrieving special metadata from a PNG file to specify sprite size, etc.)</p><p>This could be done by writing extensive amounts of configuration code and passing in special options to all of the methods that might end up creating a new object&#8230; or you could just make a subclass of the base image class that overrides a virtual method where the aspect in question gets configured, and then use a try/finally block to temporarily replace the &#34;default class&#34; property as needed and then restore it.  Doing it with class reference variables is far simpler, and is not something that could be done with generics instead.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>.NET (the CLR) was the third generation of Microsoft&#39;s Component Object Model (COM), which in the early days referred to as the &#34;COM+ runtime&#34;.   Microsoft Visual Basic and the COM/ActiveX controls market has had much more influence on the specific CLR architectural compatability choices than Borland Delphi.    (Admittedly the fact that that Delphi had adopted ActiveX controls certainly helped grow the ActiveX ecosystem,  but COM/ActiveX existed before Delphi)</p><p>COM&#39;s architecture was worked out in C (not C++) and focused on interfaces, rather than classes.   Furthermore supported object composition, meaning that a COM object could in fact be made up of several different objects, with the IUnknown interface linking them together.  But IUnknown had no role in COM object creation, which was designed to be as language-independent as possible.   Object creation was generally handled by IClassFactory, and reflection by ITypeLibrary and related interfaces.   This separation of concerns was independent of implementation language, and the features of each core COM interface were kept minimal and orthogonal.</p><p>So as a result of the popularity of COM and ActiveX controls, .NET architecture was built to support on the COM IUnknown, IClassFactory, and ITypeLibrary.   In COM, these interfaces were not necessarily on the same object, so lumping these together didn&#39;t necessarily make sense.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-why-all-classes-in-net-globally-inherits-from-object-class/'>Architecture &#8211; Why all classes in .NET globally inherits from Object class</a></li><li class="list-group-item"><a href='../c-why-does-the-net-world-seem-to-embrace-magic-strings-instead-of-staticly-typed-alternatives/'>C# &#8211; Why does the .Net world seem to embrace magic strings instead of staticly typed alternatives</a></li><li class="list-group-item"><a href='../architecture-separation-of-construction-and-initialization/'>Architecture &#8211; Separation of construction and initialization</a></li><li class="list-group-item"><a href='../c-when-to-use-pure-on-a-constructor/'>C# &#8211; When to use [Pure] on a constructor</a></li><li class="list-group-item"><a href='../c-why-arent-all-method-virtual-or-why-doesnt-have-each-class-at-least-one-interface/'>C# &#8211; Why aren&#8217;t all method virtual or why doesn&#8217;t have each class at least one interface</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>