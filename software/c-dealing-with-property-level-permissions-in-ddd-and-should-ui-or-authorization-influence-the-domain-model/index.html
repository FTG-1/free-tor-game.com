<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; Dealing with property-level permissions in DDD and should UI or authorization influence the domain model &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1086395 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1086395" class="post-1086395 software type-software status-publish hentry category-software tag-authorization tag-c tag-cqrs tag-domain-driven-design tag-permissions"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; Dealing with property-level permissions in DDD and should UI or authorization influence the domain model</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">authorization</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">cqrs</span><span class="mr-2 badge badge-primary">domain-driven-design</span><span class="mr-2 badge badge-danger">permissions</span></p><div class="entry-content"><p>Suppose I have a command like below:</p><pre><code>public sealed class UpdateExampleCommand
{
    public int Field1 { get; set; }
    public string Field2 { get; set; }
    public bool Field3 { get; set; }
    public double Field4 { get; set; }
    public DateTime Field5 { get; set; }
}
</code></pre><p>There is a permission that determines whether the user can perform the <code>UpdateExampleCommand</code>. This form of authorization is very simple and can be treated as a cross-cutting concern by checking the user&#39;s permissions in a decorator before rejecting or accepting the command.</p><p>However, there are also permissions that determine whether a user can edit particular fields that&#39;s modified by the <code>UpdateExampleCommand</code>.</p><p>e.g. A user requires the <code>Can_Edit_Field_3</code> permission to make changes to <code>Field3</code>&#39;s value, <code>Can_Edit_Field_4</code> permission to make changes to <code>Field4</code>, and <code>Can_Edit_Field_5</code> permission to make changes to <code>Field5</code>.</p><p><strong>Solution 1</strong><br /> Would this qualify as business logic and belong in the aggregate root like below?</p><pre><code>public void UpdateExample(int field1, string field2, bool field3, double field4, DateTime field5, Editor editor)
{
    // Protect invariants
    // ...

    // Perform updates
    Field1 = field1;
    Field2 = field2;

    // Editor is a value object encapsulating the user permissions.
    // It is created in the command handler based on the user context
    // and passed into the aggregate root&#39;s method.
    //
    // There are several other permissions like this that aren&#39;t strictly
    // bound to roles, so I can&#39;t use an approach like the &#34;CollaboratorService&#34;
    // from the IDDD book which performs an implicit permission check
    // by creating a Moderator, Author, etc. role object if the current
    // user has that role.
    if (editor.CanEditField3) Field3 = field3;
    if (editor.CanEditField4) Field4 = field4;
    if (editor.CanEditField5) Field5 = field5;
}
</code></pre><p><strong>Solution 2</strong><br /> Or would it be preferable to create separate methods in the aggregate root and check permissions in the command handler before calling the appropriate method?</p><pre><code>public async Task&lt;Unit&gt; Handle(UpdateExampleCommand request, CancellationToken cancellationToken)
{
    // Load aggregate
    // ...

    entity.UpdateExample(request.Field1, request.Field2);

    if (user.HasPermission(&#34;Can_Edit_Field_3&#34;))
    {
       entity.UpdateField3(request.Field3);
    }

    if (user.HasPermission(&#34;Can_Edit_Field_4&#34;))
    {
       entity.UpdateField4(request.Field4);
    }

    if (user.HasPermission(&#34;Can_Edit_Field_5&#34;))
    {
       entity.UpdateField5(request.Field5);
    }

    // Save aggregate
    // ...
}
</code></pre><p><strong>Solution 3</strong><br /> Or should I create multiple different commands each with their own authorization decorators?</p><p>e.g. <code>UpdateExampleCommand</code>, <code>UpdateField3Command</code>, <code>UpdateField4Command</code>, <code>UpdateField5Command</code></p><p>This would extract all authorization concerns from the handlers and models, so the code would be cleaner and easier to reason with, but it would come at a performance cost because the aggregate would be loaded multiple times for a single process (it might be loaded 8 times in this example if the authorization decorators need to check the state of the aggregate as well), and the responsibility to issue the right commands would be shifted to the application client.</p><p><strong>Conclusion</strong><br /> Ultimately, I&#39;m not sure what should influence the business processes modeled by the domain.</p><p>The command was initially made into a single command because that&#39;s how the UI is laid out and it&#39;s how the business works in general. However, allowing the UI to influence the domain model causes authorization logic to leak into the domain model.</p><p>Allowing authorization concerns to influence the domain model (so that the single command is split into multiple) allows the code to be cleaner, but it may make the business process less expressive, as the application client is charged with calling the commands in the correct order.</p><p>Is there a general rule of thumb for these situations or is there another way to do this that I&#39;m missing?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The main focus of Domain Driven Design is to put the business first. The rest of the application (database, rest, input-output) has to depend on business.</p><p>It would be good if you design this based on your business. So you could ask the business people which statement (1 or 2) sounds more natural to them. I would put the question to the UX expert as well. Not to the UI developer however.</p><p>Statement 1: User requests for change of 5 items together in one short. And we inform him which part of the changes were successful.</p><p>Statement 2: User has the ability to make 5 different requests for change. And we inform him about the result</p><p>If statement 1 sounds natural, I would choose solution 1 or 2. (Choice between 1 and 2 is depending on how your code is organized)
If statement 2 sounds natural, I would choose solution 3</p><p>There are few minor questions that comes to my mind. They are</p><p>Question 1:
If you user requests for something to be done, it would be fair to let him know the status of his request. If the user request for some operation (update 5), and part of the operation succeeded, how are we going to tell him about the status?
(It is possible to inform about partial success of a request in REST, but its complicated)</p><p>Question 2:
If you decide based on your business that &#34;these are better organized as separate operations (commands)&#34;. Then you would have 5 different commands, and have 5 commanding mechanisms in your UI. May be at this stage you could inform the user if he has the rights to perform each of the command or not (probably by disabling/enabling the command). There is a possibility of doing this by a read model</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../ddd-cqrs-per-query-and-per-command-authorization/'>DDD CQRS &#8211; per-query and per-command authorization</a></li><li class="list-group-item"><a href='../how-exactly-should-a-cqrs-command-be-validated-and-transformed-to-a-domain-object/'>How exactly should a CQRS Command be validated and transformed to a domain object</a></li><li class="list-group-item"><a href='../implementing-ddd-users-and-permissions/'>Implementing DDD: users and permissions</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>