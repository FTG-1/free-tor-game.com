<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Monorepo vs multi repo for large project with multiple partial deliveries &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1073533 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1073533" class="post-1073533 software type-software status-publish hentry category-software tag-delivery tag-source-code tag-version-control"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Monorepo vs multi repo for large project with multiple partial deliveries</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">delivery</span><span class="mr-2 badge badge-info">source code</span><span class="mr-2 badge badge-warning">version control</span></p><div class="entry-content"><p>I am looking into options for smoothing out our deliver and release pipeline, and would appreciate some advice on the best way to structure the source code.</p><p>This is a pretty large project, which consists of about 30 microservices. Microservices here is a very loose term, but for the sake of the question is it close enough. Currently all of this is stored in one repo.</p><p>The internal workflow is structured as follows:</p><p>1 month sprints where all code is committed to a dev branch.<br /> At the end of the month all tasks that should be moved into testing are merged into the «next major release» branch and all tasks which are critical/bugs are merged into the «active delivery» branch and tested before being selectively rolled out to customers.</p><p>Not all customers want the latest and greatest, as they want as few changes as possible to mitigate risk associated with change.</p><p>So at the end of the month we have the following:<br /> 1 up to date dev branch<br /> 1 partly up to date test/next delivery branch<br /> 1 production branch</p><p>and this is then rolled out to customers like this:<br /> Customer A<br /> &#8211;   Installed production branched version 11<br /> *      overvridden microservice 3 from production branch 11.4<br /> *      overvridden microservice 5 from production branch 11.1<br /> *      &#8230;</p><p>Customer B<br /> &#8211;   Installed production branched version 11.6<br /> *      overvridden microservice 7 from production branch 11.14<br /> *      overvridden microservice 15 from production branch 11.7</p><p>Customer C<br /> &#8211;   Installed production branched version 11.3</p><p>Would changing to a multi repo setup better cater to our clearly insane delivery pipeline?<br /> I am considering one repo for each service, and then one repo for each customer.</p><p>Code repo:<br /> -MicroService 1<br /> -MicroService 2<br /> -MicroService 3</p><p>Customer repos:<br /> -Link to MicroService 1  &#8211; version 1.5<br /> -Link to MicroService 2  &#8211; version 2.5<br /> -Link to MicroService 3  &#8211; version 1.7<br /> -Customer specific data files (they are not under version control at all now&#8230;)</p><p>I think this would greatly improve our workflow, and move us back to the sanety of just having one  branch. It should give us better control of what is actually released to an customer, gives us the ability to actually reproduce their enviroment and most importantly it should remove the need for merge day once a month.</p><p>I would greatly appreachiate some feedback on this.</p><p>Edit:<br /> The api is pretty stable between services, but the shared libs are a bit of a mixed bag. The product roughly 25 years old, so the core is stable, but as you can image in great need of some clean up as technical dept slowly has been building up.</p><p>I basically have two issues which I am trying to solve/improve</p><ol><li><p>Merge day is hell, the production branch can be up to a year older then the dev branch, with only a subset of what is in the dev branched merge into it. If a new feature is added in dev, which should not be in the current version, this is not moved to production. All fixes in dev which uses code from this will then cause huge issues if they need to be moved.  My idea is that having multiple smaller repos will make this easier.</p></li><li><p>Say there is a bug in a server for getting customer data. The bug is in some shared lib and I fix it, build the CustDataServer and all other servers which I THINK might be influenced by this, then deploy then on the customer/customers system. This means that next time someone does a bug fix, which happens to use my last bug fix, then they basically unintentionally release that into production without meaning to. Most of the time this is fine, but I feel like we have no control over what is actually running in production. ServerA is build with SharedLibA and SharedLibB, while ServerB is build with the same shared libs, but other versions. I am under impression that a multi repo approach would at least give more control in this case.</p></li></ol><p>I am open for all kinds of ideas on how to clean up this mess.</p><p><strong>Edit:</strong><br /> I appreciate all the though out responsens so far. I agree that selecting repo style is not the issue here.</p><p>Your summary is pretty spot on, appart from the layout repos. That was  something I was considering to introduce. Currently client spesific files (db and config files mostly) are stored on the client server and are not under any form of source control.</p><p>Regarding the release cycle, I agree with you that releasing more often is the best idea. Also, dont do partial releases. All or nothing. The problem is that the release cycle is outside of my control. I can influence many things, but only things which are within the company. Externaly it is hard to make changes. The reason for the partial and infreqent releases is to mittigate the risk for clients. The idea is that the less that is changes, the smaller is the chance of new bugs. The software is very critical, and bugs could litteraly cost millions per day in damages.</p><p>What if we tried doing this the other way, I if I describe the system as something to be created with the contraints that exist, what would be the ideal way to structure it?</p><ul><li>Large code base which is logically split up in several units, but are<br /> (tightly) coupled</li><li>Yearly release of new features.</li><li>Features are a mix between local changes and system wide new features</li><li>Bugs need to be fixed asap, if critical within hours.</li><li>Customers to not want full releases, they want as little change as<br /> possible. In fact, they often dont want the yearly release and drag<br /> it out as much as possible</li><li>Critical software, bug are expensive</li></ul><p>What would be the best way to structure the internal workflow to limit the number of pain points?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>It seems to me that one vs many repos is not the root of your problem.</p><p>It&#39;s your branching strategy.</p><ul><li><p>If you can, switch to a recognised branching strategy such as gitflow.</p></li><li><p>If you are writing a bug fix for a problem in production. Make a (hotfix) branch from production. Not your develop or next release branch.</p></li><li><p>If your &#39;next release&#39; branch hasn&#39;t been merged for a year. Don&#39;t even attempt to merge it. Just let it become the new &#39;production&#39; branch.</p></li><li><p>Stop cherry picking merges. Merge a whole branch or not at all. If your various branches have diverged as much as you imply then you probably need to write that bug fix separately for each branch.</p></li></ul><p>In regards to customers deploying different versions of the micro-services. This should not be a problem and it certainly shouldn&#39;t be related to your source control.</p><p>Save your versioned deployments separately from your source control. Even if you don&#39;t compile to binaries, you need to distinguish between the source code and the product.</p><p>Don&#39;t deploy by checking out code from source control. Make a zip file with the software + config and a deployment script of some kind. Imagine you have to post it on a cd.</p><p>I would expect live environments to have multiple versions deployed to enable zero downtime deployments and the like.</p><p>As long as each version is tested and you state which other versions it is compatible with this should not be an issue.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/branching-strategy-for-test-environment/'>Branching Strategy for Test Environment</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/git-in-git-is-it-a-bad-idea-to-create-a-tag-with-the-same-name-as-a-deleted-branch/'>Git &#8211; In git, is it a bad idea to create a tag with the same name as a deleted branch</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/introducing-a-version-control-branching-policy-to-a-small-team/'>Introducing a version control branching policy to a small team</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/source-control-branch-design-for-deployed-environments/'>Source control branch design for deployed environments</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/web-development-version-control-of-a-website-dev-production-front-end-files/'>Web-development &#8211; Version control of a website : dev/production front-end files</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>