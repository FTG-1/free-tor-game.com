<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Architecture &#8211; MVVM and service pattern &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1065378 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1065378" class="post-1065378 software type-software status-publish hentry category-software tag-architecture tag-dependency-injection tag-mvvm"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Architecture &#8211; MVVM and service pattern</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">Architecture</span><span class="mr-2 badge badge-info">dependency-injection</span><span class="mr-2 badge badge-warning">mvvm</span></p><div class="entry-content"><p>I&#39;m building a WPF application using the MVVM pattern. Right now, my viewmodels calls the service layer to retrieve models (how is not relevant to the viewmodel) and convert them to viewmodels. I&#39;m using constructor injection to pass the service required to the viewmodel.</p><p>It&#39;s easily testable and works well for viewmodels with few dependencies, but as soon as I try to create viewModels for complex models, I have a constructor with a LOT of services injected in it (one to retrieve each dependencies and a list of all available values to bind to an itemsSource for example). I&#39;m wondering how to handle multiple services like that and still have a viewmodel that I can unit test easily.</p><p>I&#39;m thinking of a few solutions:</p><ol><li><p>Creating a services singleton (IServices) containing all the available services as interfaces. Example: Services.Current.XXXService.Retrieve(), Services.Current.YYYService.Retrieve(). That way, I don&#39;t have a huge constructor with a ton of services parameters in them.</p></li><li><p>Creating a facade for the services used by the viewModel and passing this object in the ctor of my viewmodel. But then, I&#39;ll have to create a facade for each of my complexe viewmodels, and it might be a bit much&#8230;</p></li></ol><p>What do you think is the &#34;right&#34; way to implement this kind of architecture ?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In fact, both of these solutions are bad.</p><blockquote><p>Creating a services singleton (IServices) containing all the available services as interfaces. Example: Services.Current.XXXService.Retrieve(), Services.Current.YYYService.Retrieve(). That way, I don&#39;t have a huge constructor with a ton of services parameters in them.</p></blockquote><p>This is essentially the <a href="http://en.wikipedia.org/wiki/Service_locator_pattern">Service Locator Pattern</a>, which is an anti-pattern. If you do this, you will no longer be able to understand what the view model actually depends on without looking at its private implementation, which will make it very difficult to test or refactor.</p><blockquote><p>Creating a facade for the services used by the viewModel and passing this object in the ctor of my viewmodel. But then, I&#39;ll have to create a facade for each of my complexe viewmodels, and it might be a bit much...</p></blockquote><p>This isn&#39;t so much an anti-pattern but it is a code smell. Essentially you&#39;re creating a <a href="http://www.refactoring.com/catalog/introduceParameterObject.html">parameter object</a>, but the point of the PO refactoring pattern is to deal with parameter sets that <em>are used frequently and in a lot of different places</em>, whereas this parameter would only ever be used once. As you mention, it would create a lot of code bloat for no real benefit, and wouldn&#39;t play nice with a lot of IoC containers.</p><p>In fact, both of the above strategies are overlooking the overall issue, which is that <strong>coupling is too high between view models and services</strong>. Simply <em>hiding</em> these dependencies in a service locator or parameter object does not actually <em>change</em> how many other objects the view model depends on.</p><p>Think of how you would unit-test one of these view models. How big is your setup code going to be? How many things need to be initialized in order for it to work?</p><p>A lot of people starting out with MVVM try to create view models for an <em>entire screen</em>, which is fundamentally the wrong approach. MVVM is all about <strong>composition</strong>, and a screen with many functions should be composed of several different view models, each of which depends on only one or a few internal models/services. If they need to communicate with each other, you do so via pub/sub (message broker, event bus, etc.)</p><p>What you actually need to do is refactor your view models so that they have <em>fewer dependencies</em>. Then, if you need to have an aggregate &#34;screen&#34;, you create another view model to aggregate the smaller view models. This aggregate view model doesn&#39;t have to do very much by itself, so it in turn is also fairly easy to understand and test.</p><p>If you&#39;ve done this properly, it should be obvious just from looking at the code, because you&#39;ll have short, succinct, specific, and testable view models.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../architecture-silverlight-5-and-mvvm-do-i-really-need-other-frameworks-what-is-the-best-way-for-rapid-development/'>Architecture &#8211; Silverlight 5 and MVVM. Do I really need other frameworks? What is the best way for rapid development</a></li><li class="list-group-item"><a href='../architecture-wpf-mvvm-ef-poco-guidance-required-on-simple-architecture/'>Architecture &#8211; WPF, MVVM, EF, POCO guidance required on simple architecture</a></li><li class="list-group-item"><a href='../c-how-to-make-creating-viewmodels-at-runtime-less-painful/'>C# &#8211; How to make creating viewmodels at runtime less painful</a></li><li class="list-group-item"><a href='../c-net-mvvm-software-architecture-and-naming-conventions/'>C# .NET MVVM software architecture and naming conventions</a></li><li class="list-group-item"><a href='../design-multi-screen-mvvm-architecture-design-should-the-screen-viewmodels-contain-sub-viewmodels/'>Design &#8211; Multi-screen MVVM architecture/design &#8211; Should the &#8220;screen&#8221; ViewModels contain sub-ViewModels</a></li><li class="list-group-item"><a href='../good-formal-pattern-to-manage-state-in-mvvm/'>Good formal pattern to manage state in MVVM</a></li><li class="list-group-item"><a href='../design-mvvm-best-practices-with-wpf-client-and-wcf-duplex-service/'>Design &#8211; MVVM best practices with WPF client and WCF duplex service</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>