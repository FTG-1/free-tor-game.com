<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; Why would a type be coupled with its builder &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1080171 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1080171" class="post-1080171 software type-software status-publish hentry category-software tag-builder-pattern tag-coupling tag-design-patterns tag-java"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; Why would a type be coupled with its builder</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">builder-pattern</span><span class="mr-2 badge badge-info">coupling</span><span class="mr-2 badge badge-warning">design-patterns</span><span class="mr-2 badge badge-primary">java</span></p><div class="entry-content"><p>I&#39;ve recently deleted a <a href="../../questions/tagged/java.html" class="post-tag" title="show questions tagged &#39;java&#39;" rel="tag">java</a> answer of mine on <a href="http://www.codereview.stackexchange.com/" rel="nofollow noreferrer">Code Review</a>, that started like this:</p><blockquote><pre><code>private Person(PersonBuilder builder) {
</code></pre><p>Stop. Red flag. A PersonBuilder would build a Person; it knows about a Person. The Person class shouldn&#39;t know anything about a PersonBuilder &#8211; it&#39;s just an immutable type. You&#39;ve created a circular coupling here, where A depends on B which depends on A.</p><p>The Person should just intake its parameters; a client that&#39;s willing to create a Person without building it should be able to do that.</p></blockquote><p>I was slapped with a downvote, and told that (quoting) <em>Red flag, why? The implementation here has the same shape that which Joshua Bloch&#39;s demonstrated in his &#34;Effective Java&#34; book(item #2).</em></p><p>So, it appears that the One Right Way of implementing a <em>Builder Pattern</em> in Java is to <a href="https://softwareengineering.stackexchange.com/q/225207/68834">make the builder a nested type</a> (this isn&#39;t what this question is about though), and then make the <em>product</em> (the class of the object being built) <strong>take a dependency on the builder</strong>, like this:</p><blockquote><pre><code>private StreetMap(Builder builder) {
    // Required parameters
    origin      = builder.origin;
    destination = builder.destination;

    // Optional parameters
    waterColor         = builder.waterColor;
    landColor          = builder.landColor;
    highTrafficColor   = builder.highTrafficColor;
    mediumTrafficColor = builder.mediumTrafficColor;
    lowTrafficColor    = builder.lowTrafficColor;
}
</code></pre><p><sub><sup><a href="https://en.wikipedia.org/wiki/Builder_pattern#Java_example" rel="nofollow noreferrer">https://en.wikipedia.org/wiki/Builder_pattern#Java_example</a></sup></sub></p></blockquote><p>The same Wikipedia page for the same Builder pattern has a wildly different (and much more flexible) implementation for C#:</p><blockquote><pre><code>//Represents a product created by the builder
public class Car
{
    public Car()
    {
    }

    public int Wheels { get; set; }

    public string Colour { get; set; }
}
</code></pre></blockquote><p>As you can see, the <em>product</em> here does not know anything about a <code>Builder</code> class, and for all it cares it could be instantiated by a direct constructor call, an abstract factory, &#8230;or a builder &#8211; as far as I understand it, the <em>product</em> of a creational pattern <strong>never</strong> needs to know anything about what&#39;s creating it.</p><p>I&#39;ve been served the counter-argument (which is apparently explicitly defended in Bloch&#39;s book) that a builder pattern could be used to rework a type that would have a constructor bloated with dozens of optional arguments. So instead of sticking to what I <em>thought</em> I knew I researched a bit on this site, and found that as I suspected, <a href="https://softwareengineering.stackexchange.com/a/311322/68834">this argument does not hold water</a>.</p><p>So what&#39;s the deal? Why come up with <a href="https://softwareengineering.stackexchange.com/a/228942/68834">over-engineered solutions</a> to a problem that shouldn&#39;t even exist in the first place? If we take Joshua Bloch off his pedestal for a minute, can we come up with one single good, valid reason for coupling two concrete types and calling it a best practice?</p><p>This all reeks of <a href="https://en.wikipedia.org/wiki/Cargo_cult_programming" rel="nofollow noreferrer">cargo-cult programming</a> to me.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>I disagree with your assertion that it is a red flag. I also disagree with your representation of the counterpoint, that there is One Right Way of representing a Builder pattern.</p><p>To me there&#39;s one question: <em>Is the Builder a necessary part of the type&#39;s API?</em> Here, <em>is the PersonBuilder a necessary part of the Person API?</em></p><p>It is entirely reasonable that a validity-checked, immutable, and/or tightly-encapsulated Person class will <em>necessarily</em> be created through a Builder it provides (regardless of whether that builder is nested or adjacent). In doing so, the Person can keep all of its fields private or package-private and final, and also leave the class open for modification if it is a work in progress. (It may <em>end up</em> closed for modification and open for extension, but that&#39;s not important right now, and is especially controversial for immutable data objects.)</p><p>If it is the case that a Person is necessarily created through a supplied PersonBuilder as part of a single package-level API design, then a circular coupling is just fine and a red flag isn&#39;t warranted here. Notably, you stated it as an incontrovertible fact and not an API design opinion or choice, so that may have contributed to a bad response. I wouldn&#39;t have downvoted you, but I don&#39;t blame someone else for doing so, and I&#39;ll leave the rest of the discussion of &#34;what warrants a downvote&#34; to the <a href="https://codereview.stackexchange.com/help/privileges/vote-down">Code Review help center</a> and <a href="https://codereview.meta.stackexchange.com/">meta</a>. Downvotes happen; it&#39;s no &#34;slap&#34;.</p><p>Of course, if you want to leave a lot of ways open to build a Person object, then the PersonBuilder could become a <em>consumer</em> or <em>utility</em> of the Person class, on which the Person should not directly depend. This choice seems more flexible—who wouldn&#39;t want more object creation options?—but in order to hold to guarantees (like immutability or serializability) suddenly the Person has to expose a different kind of public creation technique, such as a very long constructor. If the Builder is meant to represent or replace a constructor with a lot of optional fields or a constructor open to modification, then the class&#39;s long constructor may be an implementation detail better left hidden. (Also bear in mind that an official and necessary Builder doesn&#39;t preclude you from writing your own construction utility, just that your construction utility may consume the Builder as an API as in my original question above.)</p><hr/><p>p.s.: I note that the code review sample you listed has an immutable Person, but the counterexample from Wikipedia lists a mutable Car with getters and setters. It may be easier to see the necessary machinery omitted from the Car if you keep the language and invariants consistent between them.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-improvements-to-joshua-blochs-builder-design-pattern/'>Java &#8211; Improvements to Joshua Bloch&#8217;s Builder Design Pattern</a></li><li class="list-group-item"><a href='../java-benefit-of-using-static-inner-builder-class/'>Java &#8211; Benefit of using static inner builder class</a></li><li class="list-group-item"><a href='../java-design-for-object-with-optional-and-modifiable-attributtes/'>Java &#8211; Design for object with optional and modifiable attributtes</a></li><li class="list-group-item"><a href='../constructor-with-tons-of-parameters-vs-builder-pattern/'>Constructor with tons of parameters vs builder pattern</a></li><li class="list-group-item"><a href='../java-how-to-implement-a-step-builder-for-which-the-order-of-setters-doesnt-matter/'>Java: How to implement a step builder for which the order of setters doesn&#8217;t matter</a></li><li class="list-group-item"><a href='../why-is-the-builder-pattern-often-implemented-like-this/'>Why is the builder-pattern often implemented like this</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>