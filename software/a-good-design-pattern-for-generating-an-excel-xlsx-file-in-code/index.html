<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>A good design pattern for generating an Excel (xlsx) file in code &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1072411 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1072411" class="post-1072411 software type-software status-publish hentry category-software tag-design-patterns tag-excel tag-xml tag-xslt"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">A good design pattern for generating an Excel (xlsx) file in code</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">design-patterns</span><span class="mr-2 badge badge-info">excel</span><span class="mr-2 badge badge-warning">xml</span><span class="mr-2 badge badge-primary">xslt</span></p><div class="entry-content"><p><em>See my Update at the bottom for more.</em></p><hr/><p>I occasionally have projects where I have to output some data as an Excel file (xlsx format).  The process is usually:</p><ol><li><p>User clicks some buttons in my application</p></li><li><p>My code runs a DB query and processes the results somehow</p></li><li><p>My code generates an *.xlsx file using either the Excel com interop libraries or some third-party library (e.g., Aspose.Cells)</p></li></ol><p>I can easily find code examples for how to do this online, but I am looking for a more robust way to do this.  I&#39;d like my code to follow some design principles to ensure that my code is maintainable and easily understandable.</p><hr/><p>Here is what my initial attempt to generate an xlsx file looked like:</p><pre><code>var wb = new Workbook();
var ws = wb.Worksheets[0];
ws.Cells[0, 0].Value = &#34;Header&#34;;
ws.Cells[1, 0].Value = &#34;Row 1&#34;;
ws.Cells[2, 0].Value = &#34;Row 2&#34;;
ws.Cells[3, 0].Value = &#34;Row 3&#34;;
wb.Save(path);
</code></pre><p>Pros: Not much.  It works, so that&#39;s good.</p><p>Cons:</p><ul><li>Cell references are hardcoded, so I have magic numbers littered throughout my code.</li><li>It&#39;s difficult to add or remove columns and rows without updating many cell references.</li><li>I need to learn some third-party library.  Some libraries are used like other libraries, but there can still be problems.  I had a problem where the com interop libraries use 1-based cell referencing whereas Aspose.Cells uses 0-based cell referencing.</li></ul><hr/><p>Here is one solution that addresses some of the cons I listed above.  I wanted to treat a table of data as its own object that can be moved around and changed without digging into cell manipulation and disturbing other cell references.  Here is some pseudocode:</p><pre><code>var headers = new Block(new string[] { &#34;Col 1&#34;, &#34;Col 2&#34;, &#34;Col 3&#34; });
var body = new Block(new string[,]
    {
        { &#34;Row 1&#34;, &#34;Row 1&#34;, &#34;Row 1&#34; },
        { &#34;Row 2&#34;, &#34;Row 2&#34;, &#34;Row 2&#34; },
        { &#34;Row 3&#34;, &#34;Row 3&#34;, &#34;Row 3&#34; }
    });

body.PutBelow(headers);
</code></pre><p>As a part of this solution, I&#39;ll have some BlockEngine object that takes a container of Blocks and performs the cell manipulations required to output the data as an *.xlsx file.  A Block object can have formatting attached to it.</p><p>Pros:</p><ul><li>This removes most of the magic numbers that my initial code had.</li><li>This hides a lot of cell manipulation code, although cell manipulation is still required in the BlockEngine object that I mentioned.</li><li>It&#39;s much easier to add and remove rows without effecting other parts of the spreadsheet.</li></ul><p>Cons:</p><ul><li>It&#39;s still difficult to add or remove columns.  If I wanted to swap the position of columns two and three, I&#39;d have to directly swap the cell contents.  In this case that&#39;d be eight edits, and thus eight opportunities to make a mistake.<ul><li>If I have any formatting in place for those two columns, I have to update that as well.</li></ul></li><li>This solution doesn&#39;t support horizontal block placement; I can only place one block below another.  Sure I could have <code>tableRight.PutToRightOf(tableLeft)</code>, but that would cause problems if tableRight and tableLeft had different numbers of rows.  To place tables, the engine would have to be aware of every other table.  This seems unnecessarily complicated to me.</li><li>I still need to learn third-party code, though through a layer of abstraction via Block objects and a BlockEngine the code will be less tightly-coupled to the third-party library than my initial attempt.  If I wanted to support lots of different formatting options in a loosely-coupled way, I&#39;d probably have to write a lot of code; my BlockEngine would be a huge mess.</li></ul><hr/><p>Here is a solution that takes a different route.  Here&#39;s the process:</p><ol><li><p>I take my report data and generate an xml file in some format that I choose.</p></li><li><p>I then use an xsl transformation to convert the xml file to an Excel 2003 XML Spreadsheet file.</p></li><li><p>From there I simply convert the xml Spreadsheet to an xlsx file using a third party library.</p></li></ol><p>I found <a href="http://www.codeproject.com/Articles/21373/Excel-Report-Generation-Using-XMLSS?msg=2392400#xx2392400xx" rel="nofollow">this page</a> that describes a similar process and includes code examples.</p><p>Pros:</p><ul><li>This solution requires almost no cell manipulation.  You instead use xsl/xpath to do your manipulations.  In order to swap two columns in a table, you move the whole columns in the xsl file unlike my other solutions which would require cell-swapping.</li><li>While you still need a third-party library that can convert an Excel 2003 XML Spreadsheet to an xlsx file, that&#39;s about all you&#39;ll need the library for.  The amount of code you need to write that would call into the third-party library is tiny.</li><li>I think this solution is the easiest to understand and requires the least amount of code.<ul><li>The code that creates the data in my own xml format will be simple.</li><li>The xsl file will be complicated only because the Excel 2003 XML Spreadsheet is complicated.  However it&#39;s easy to check the output of the xsl file: just open the output in Excel and check for error messages.</li><li>It&#39;s easy to generate sample Excel 2003 XML Spreadsheet files: just create a spreadsheet that looks like your desired xlsx file, and then save it as an Excel 2003 XML Spreadsheet.</li></ul></li></ul><p>Cons:</p><ul><li>Excel 2003 XML Spreadsheets don&#39;t support certain features.  You can&#39;t autofit column widths for instance.  You can&#39;t include images in headers or footers.  If you&#39;re going to export the resultant xlsx file to pdf, you can&#39;t set pdf bookmarks.  (I hacked together a fix for this using cell comments.).  You have to do this using your third-party library.</li><li>Requires a library that supports Excel 2003 XML Spreadsheets.</li><li>Uses an 11-year old MS Office file format.</li></ul><p>Note: I realize that xlsx files are actually zip files containing xml files, but the xml formatting seems too complicated for my purposes.</p><hr/><p>Finally, I&#39;ve looked into solutions involving SSRS, but it seems too bloated for my purposes.</p><hr/><p>Back to my initial question, what is a good design-pattern for generating Excel files in code?.  I can think of a few solutions, but none seem to stick out as ideal.  Each has drawbacks.</p><hr/><p><strong>Update:</strong> So I tried both my BlockEngine solution and my XML Spreadsheet solution for generating similar XLSX files.  Here are my opinions of them:</p><ul><li><p>The BlockEngine solution:</p><ul><li>This simply requires too much code considering the alternatives.</li><li>I found it too easy to overwrite one block with another if I had an offset wrong.</li><li>I originally stated that formatting could be attached at the block level.  I found this to be not much better than doing the formatting separately from the block content.  I can&#39;t think of a good way to combine the content and the formatting.  Nor can I find a good way to keep them separate.  It&#39;s just a mess.</li></ul></li><li><p>The XML Spreadsheet solution:</p><ul><li>I&#39;m going with this solution for now.</li><li>It bears repeating that this solution requires much less code.  I&#39;m effectively replacing the BlockEngine with Excel itself.  I still do need a hack for features like bookmarks and page breaks.</li><li>The XML Spreadsheet format is finicky, but it&#39;s easy to make a small change and compare the results to an existing file in your favorite Diff program.  And once you figure out some idiosyncrasy, you can put it in place and forget about it from there.</li><li>I&#39;m still concerned that this solution relies on an older Excel file format.</li><li>The XSLT file I created is easy to work with.  Dealing with formatting is much simpler here than it is with the BlockEngine solution.</li></ul></li></ul></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>If you really want something that works well for you, then I suggest you get used to the idea of &#34;unnecessarily complex&#34;... that&#39;s the nature of dealing with Microsoft Office file formats.</p><p>I (sort of) like your idea of &#34;blocks&#34;... I would make sub-classed block objects, like Table, with Columns and Rows independent of the notion of cells. Then use your block engine to convert these to XSLS files.</p><p>I&#39;ve used the <a href="http://msdn.microsoft.com/en-us/library/office/bb448854(v=office.15).aspx">OpenXML SDK</a> successfully in the past, but don&#39;t try to read the documentation and start from scratch. Instead, create an exact copy in Excel of what you want, save it, and inspect it using the provided Document Reflector tool. It will give you the C# code you need to create the document, which you can then learn from and modify.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../java-are-xml-schemas-bad-for-constantly-evolving-file-formats/'>Java &#8211; Are XML Schemas bad for constantly evolving file formats</a></li><li class="list-group-item"><a href='../java-generic-file-parser-design-in-java-using-the-strategy-pattern/'>Java &#8211; Generic file parser design in Java using the Strategy pattern</a></li><li class="list-group-item"><a href='../managing-sets-of-configuration-data-for-an-excel-vba-program/'>Managing sets of configuration data for an Excel/VBA program</a></li><li class="list-group-item"><a href='../c-how-to-design-configurable-validations-to-import-excel-files/'>C# &#8211; How to design configurable validations to import Excel files</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>