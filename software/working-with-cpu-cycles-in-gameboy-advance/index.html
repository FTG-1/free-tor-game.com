<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Working with CPU cycles in Gameboy Advance &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085812 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085812" class="post-1085812 software type-software status-publish hentry category-software tag-cpu tag-game-development tag-process"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Working with CPU cycles in Gameboy Advance</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">cpu</span><span class="mr-2 badge badge-info">game development</span><span class="mr-2 badge badge-warning">process</span></p><div class="entry-content"><p>I am working on an GBA emulator and stuck at implementing CPU cycles.<br /> I just know the basic knowledge about it, each instruction of ARM and<br /> THUMB mode as each different set of cycles for each instructions.<br /> Currently I am simply saying every ARM instructions cost 4 cycles and<br /> THUMB instructions cost 2 cycles. But how do you implement it like the<br /> CPU documentation says? Does instruction cycles vary depending on which<br /> section of the memory it&#39;s currently accessing to?<br /> <a href="http://nocash.emubase.de/gbatek.htm#cpuinstructioncycletimes" rel="nofollow">http://nocash.emubase.de/gbatek.htm#cpuinstructioncycletimes</a><br /> According to the above specification, it says different memory areas have<br /> different waitstates but I don&#39;t know what it exactly mean. Furthermore,<br /> what are Non-sequential cycle, Sequential cycle, Internal Cycle,  Coprocessor Cycle for?<br /> I saw in some GBA source code that they are using PC to figure out how many cycles each<br /> instruction takes to complete, but how are they doing it?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>This is only a partial response, so it may be disallowed:</p><blockquote><p>Currently I am simply saying every ARM instructions cost 4 cycles and
 THUMB instructions cost 2 cycles.</p></blockquote><p>Actually, if I&#39;m remembering ARM correctly, what&#39;s actually happening is that, in a single memory cycle, you can either fetch a single 32-bit ARM instruction, or two 16-bit THUMB instructions.  Execution time is, of course, instruction-dependent.</p><blockquote><p>Does instruction cycles vary depending on
 which section of the memory it&#39;s currently accessing to? <a href="http://nocash.emubase.de/gbatek.htm#cpuinstructioncycletimes" rel="nofollow">http://nocash.emubase.de/gbatek.htm#cpuinstructioncycletimes</a> According
 to the above specification, it says different memory areas have
 different waitstates but I don&#39;t know what it exactly mean.</p></blockquote><p>Different regions of memory may have more data clients than just the CPU.  This is particularly true in graphics/video memory where pixels need to be pulled out of RAM to send off to the display.  Unless you use faster (read: more expensive) memory, the CPU and graphics hardware will have to take turns accessing RAM.  Thus, depending on how many other RAM clients there are, it may take several cycles before the CPU&#39;s turn at RAM arrives.</p><p>It may not even be this noble -- the manufacturer may have simply decided that they could get away with slower (read: cheaper) RAM for most of program and data space, and used a smaller block of fast memory only for those things that absolutely needed it.</p><blockquote><p>Furthermore, what are Non-sequential cycle, Sequential cycle, Internal
 Cycle, Coprocessor Cycle for?</p></blockquote><p>Sequential versus non-sequential refers to reading memory locations in order versus out-of-order.  RAM is arranged as a two-dimensional array of memory cells indexed by row and column address.  If you access memory locations in ascending address order (e.g. 0, 1, 2, 3, 4, 5, etc.), then all you need to change (most of the time) is the column address, and each successive read can be satisfied more quickly than if you accessed addresses non-sequentially.  Judging from the doc you linked to, it looks like you get a CAS increment for free, but a full RAS+CAS costs an extra cycle.</p><p>Internal Cycle means the CPU is going, &#34;Wow, this is complicated; gimme some extra time to figure this out.&#34;  (The MUL instructions are sharp examples of this.)</p><p>Coprocessor Cycle refers to the time required to talk to an ARM coprocessor.  I don&#39;t know what, if any, ARM coprocessors are in the GBA.</p><p>As for implementation: That doesn&#39;t lend itself to a single answer.  If it were me, I&#39;d model RAM access times independently from instruction execution times.  When the CPU reads/writes memory, compare the memory address accessed with the previous memory address the CPU accessed.  If they&#39;re adjacent (M(current) == M(previous) + 4), then it&#39;s free; otherwise add a one-cycle penalty.  Then add the delays imposed by the memory region you&#39;re accessing.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/architecture-what-does-issue-or-start-an-instruction-mean/'>Architecture &#8211; What does &#8220;issue or start an instruction&#8221; mean</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/operation-excution-in-terms-of-clock-cycles/'>Operation excution in terms of clock cycles</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/python-how-to-maximize-the-cpu-usage-of-a-python-subprocess/'>Python &#8211; How to maximize the CPU usage of a Python subprocess</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/how-is-it-possible-for-a-process-to-use-less-than-100-cpu/'>How is it possible for a process to use less than 100% CPU</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>