<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; How to test the data access layer &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1063836 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1063836" class="post-1063836 software type-software status-publish hentry category-software tag-java tag-programming-practices tag-tdd tag-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; How to test the data access layer</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">java</span><span class="mr-2 badge badge-info">programming practices</span><span class="mr-2 badge badge-warning">tdd</span><span class="mr-2 badge badge-primary">testing</span></p><div class="entry-content"><p>I have a DAO method that utilizes Spring for JDBC access. It calculates a seller&#39;s success rate of selling an item.</p><p>Here is the code:</p><pre><code>public BigDecimal getSellingSuccessRate(long seller_id) {
    String sql = &#34;SELECT SUM(IF(sold_price IS NOT NULL, 1, 0))/SUM(1) 
                  FROM transaction WHERE seller_id = ?&#34;;
    Object[] args = {seller_id};
    return getJdbcTemplate().queryForObject(sql, args, BigDecimal.class);
}
</code></pre><p>How should I go about testing this method or any DAO method with JUnit? What are some best practices to test the data access logic? I am thinking of testing it against an embeddable database loaded with some data, but shouldn&#39;t we do integration tests similar to a production environment in terms of RDBMS and the schema?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>The problem with using a &#39;real&#39; database for unit testing is the setup, take down, and isolation of the tests.  You don&#39;t want to have to spin up an entirely new MySQL database and create tables and data just for one unit test.  The problems with this have to do with the external nature of the database and your test database is down, your unit tests fail.  There are also issues with making sure you have a unique database for testing with.  They can be overcome, but there is a simpler answer.</p><p>Mocking the database is one option <em>however</em> it doesn&#39;t test the actual queries that are run.  It can be used as a much simpler solution when you want to make sure the data from the DAO goes through the system properly.  But for testing the DAO itself you need something behind the DAO has the data and the queries run properly.</p><p>The first thing to do is use a in memory database. <a href="http://hsqldb.org/">HyperSQL</a> is an excellent choice for this because it has the ability to emulate the dialect of another database - so that the minor differences between databases stays the same (data types, functions and the like).  hsqldb also has some nice features for unit testing.</p><pre><code>db.url=jdbc:hsqldb:file:src/test/resources/testData;shutdown=true;
</code></pre><p>This loads the state of the database (the tables, initial data) from the <code>testData</code> file. <code>shutdown=true</code> will automatically shut down the database when the last connection closes.</p><p>Using <a href="http://en.wikipedia.org/wiki/Dependency_injection">dependency injection</a>, have the unit tests select a <em>different</em> database than what the production (or test, or local) builds use.</p><p>Your DAO then uses the injected database for which you can launch tests against the database.</p><p>The unit tests will then look something like (bunch of boring stuff not included for brevity):</p><pre><code>    @Before
    public void setUpDB() {
        DBConnection connection = new DBConnection();
        try {
            conn = connection.getDBConnection();
            insert = conn.prepareStatement(&#34;INSERT INTO data (txt, ts, active) VALUES (?, ?, ?)&#34;);
        } catch (SQLException e) {
            e.printStackTrace();
            fail(&#34;Error instantiating database table: &#34; + e.getMessage());
        }
    }

    @After
    public void tearDown() {
        try {
            conn.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    private void addData(String txt, Timestamp ts, boolean active) throws Exception {
        insert.setString(1, txt);
        insert.setTimestamp(2, ts);
        insert.setBoolean(3, active);
        insert.execute();
    }

    @Test
    public void testGetData() throws Exception {
        // load data
        Calendar time = Calendar.getInstance();
        long now = time.getTimeInMillis();
        long then1h = now - (60 * 60 * 1000);  // one hour ago
        long then2m = now - (60 * 1000 * 2);   // two minutes ago
        addData(&#34;active_foo&#34;, new Timestamp(then1h), true);     // active but old
        addData(&#34;inactive_bar&#34;, new Timestamp(then1h), false);  // inactive and old
        addData(&#34;active_quz&#34;, new Timestamp(then2m), true);     // active and new
        addData(&#34;inactive_baz&#34;, new Timestamp(then2m), false);  // inactive and new

        DataAccess dao = new DataAccess();
        int count = 0;
        for (Data data : dao.getData()) {
            count++;
            assertTrue(data.getTxt().startsWith(&#34;active&#34;));
        }

        assertEquals(&#34;got back &#34; + count + &#34; rows instead of 1&#34;, count, 1);
    }
</code></pre><p>And thus, you&#39;ve got a unit test that calls the DAO and is using the data that was set up in an on the fly database that exists for the duration of the test.  You don&#39;t have to worry about external resources or the state of the database before the run, or restoring to a known state (well, the &#39;known state&#39; is &#39;does not exist&#39; which is trivial to revert to).</p><p><a href="http://dbunit.sourceforge.net/">DBUnit</a> can make much of what I described a simpler process in setting up the database, creating the tables and loading the data.  If you were going to need to use the actual database for some reason, this is by far the better tool to use.</p><p><sup>The above code is part of a maven project I wrote for proof of concept <a href="https://github.com/shagie/TestingWithHsqldb">TestingWithHsqldb on github</a></sup></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/how-to-test-a-data-load/'>How to test a data load</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/java-effective-programming-of-data-layer-management-access/'>Java &#8211; Effective programming of data layer management/access</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/java-how-to-test-state-of-the-object/'>Java &#8211; How to test state of the object</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/unit-testing-does-it-matter-how-i-setup-test-data-when-creating-unit-tests/'>Unit-testing &#8211; Does it matter how I setup test data when creating unit tests</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>