<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>C# &#8211; MVC + 3 tier; where ViewModels come into play &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1070444 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1070444" class="post-1070444 software type-software status-publish hentry category-software tag-asp-net-mvc tag-c tag-design-patterns"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">C# &#8211; MVC + 3 tier; where ViewModels come into play</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">asp.net-mvc</span><span class="mr-2 badge badge-info">c</span><span class="mr-2 badge badge-warning">design-patterns</span></p><div class="entry-content"><p>I&#39;m designing a 3-tiered application using ASP.NET MVC 4. I used the following resources as a reference.</p><ul><li><a href="http://www.codeproject.com/Articles/70061/Architecture-Guide-ASP-NET-MVC-Framework-N-tier-En" rel="nofollow noreferrer">CodeProject: MVC + N-tier + Entity Framework</a></li><li><a href="https://softwareengineering.stackexchange.com/questions/135724/separating-data-access-in-asp-net-mvc">Separating data access in ASP.NET MVC</a></li></ul><p>I have the following desingn so far.</p><p><strong>Presentation Layer (PL)</strong> (main MVC project, where <strong>M</strong> of <strong>MVC</strong> was moved to Data Access Layer):</p><pre><code>MyProjectName.Main
    Views/
    Controllers/
    ...
</code></pre><p><strong>Business Logic Layer (BLL)</strong>:</p><pre><code>MyProjectName.BLL
    ViewModels/
    ProjectServices/
    ...
</code></pre><p><strong>Data Access Layer (DAL)</strong>:</p><pre><code>MyProjectName.DAL
    Models/
    Repositories.EF/
    Repositories.Dapper/
    ...
</code></pre><p>Now, PL references BLL and BLL references DAL. This way lower layer does not depend on the one above it.</p><p>In this design PL invokes a service of the BLL. PL can pass a View Model to BLL and BLL can pass a View Model back to PL.</p><p>Also, BLL invokes  DAL layer and DAL layer can return a Model back to BLL. BLL can in turn build a View Model and return it to PL.</p><p>Up to now this pattern was working for me. However, I&#39;ve ran into a problem where some of my ViewModels require joins on several entities. In the plain MVC approach, in the controller I used a LINQ query to do <code>join</code>s and then <code>select new MyViewModel(){ ... }</code>. But now, in the DAL I do not have access to where ViewModels are defined (in the BLL).</p><p>This means I cannot do joins in DAL and return it to BLL. It seems I have to do separate queries in DAL (instead of joins in one query) and BLL would then use the result of these to build a ViewModel. This is very inconvenient, but I don&#39;t think I should be exposing DAL to ViewModels.</p><p>Any ideas how I can solve this dilemma? Thanks.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><blockquote><p>main MVC project, where M of MVC was moved to Data Access Layer</p></blockquote><p>Common misconception. The <code>M</code> of <code>MVC</code> has nothing to do with data, despite the many examples and tutorials that claim so.</p><p><code>M</code> is your ViewModel and should reside in your MVC project. The ViewModels you have in your BLL are actually to be named DataContracts or BusinessModels.</p><p>In your controller you have something comparable to this:</p><pre><code>Get(id):
    dataContract = _service.Get(id);
    viewModel = Map(dataContract);
    return viewModel
</code></pre><p>In your service, something like this:</p><pre><code>Get(id):
    dataModel = _dataAccess.Get(id);
    dataContract = Map(dataModel);
    return dataContract;
</code></pre><p>And in the DataAccess, you perform the proper joins according to the object requested. You are however of course free to add custom methods to your DataAccess when required, so your service can call those methods:</p><pre><code>GetWithBars():
    dataModels = _repository.Query(&#34;select from foos join bars&#34;);
    return dataModels;
</code></pre></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-asp-net-mvc-should-i-reference-the-dal-from-the-ui/'>C# &#8211; ASP.NET MVC should I reference the DAL from the UI</a></li><li class="list-group-item"><a href='../architecture-where-view-models-inside-web-project-of-n-tier-application-should-be-placed/'>Architecture &#8211; Where view models inside Web project of n-tier application should be placed</a></li><li class="list-group-item"><a href='../c-relaxed-architecture-dal-or-anemic-bll/'>C# &#8211; Relaxed architecture DAL or anemic BLL</a></li><li class="list-group-item"><a href='../c-in-a-multi-tier-project-where-should-interfaces-be-defined/'>C# &#8211; In a multi tier project where should interfaces be defined</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>