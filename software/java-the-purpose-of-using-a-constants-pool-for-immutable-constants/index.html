<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="https://free-tor-game.com/wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; The purpose of using a constants pool for immutable constants &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js?ver=11.2.0' id='highlight-js'></script>     <script>( function( w, d, s, l, i ) {
				w[l] = w[l] || [];
				w[l].push( {'gtm.start': new Date().getTime(), event: 'gtm.js'} );
				var f = d.getElementsByTagName( s )[0],
					j = d.createElement( s ), dl = l != 'dataLayer' ? '&l=' + l : '';
				j.async = true;
				j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
				f.parentNode.insertBefore( j, f );
			} )( window, document, 'script', 'dataLayer', ' ' );</script>      <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1085076 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="https://free-tor-game.com/3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="https://free-tor-game.com/contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1085076" class="post-1085076 software type-software status-publish hentry category-software tag-coding-style tag-java"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; The purpose of using a constants pool for immutable constants</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">coding-style</span><span class="mr-2 badge badge-info">java</span></p><div class="entry-content"><p>I come across the following code with a lot of frequency:</p><pre><code>if (myArray.length == Constants.ZERO_INT) 
</code></pre><p>or</p><pre><code>if (myString != null &amp;&amp; !myString.equals(Constants.EMPTY_STRING)) 
</code></pre><p>Neither of these makes much sense to me. Isn&#39;t the point of having a constant pool for ease of code appearance and to allow for modularity? In both of the above cases, it just looks like needless noise that accomplishes neither objective.</p><p>My question: what is the purpose of using a constants pool for variables like this which will never change? Or is this just <a href="http://en.wikipedia.org/wiki/Cargo_cult_programming" rel="nofollow">cargo cult programming</a>? If so, then why does it seem to be prevalent in the industry? (I&#39;ve noticed it with at least two different employers I&#39;ve worked with).</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>There are two options that one has for dealing with specific, frequently occurring immutable objects.  You can either instantiate them each time, or you can use a constant that is probably stuck in a <code>final static</code> in some class.</p><p><code>BigInteger</code> for example has <code>ZERO</code>, <code>ONE</code>, and <code>TEN</code>.</p><p>However, this is an attempt to avoid <em>instantation</em> of new objects.  Say you&#39;re adding the sum of some BigIntegers.  You&#39;ve got the choice of:</p><pre><code>BigInteger sum = BigInteger.ZERO;
for(int i = 0; i &lt; array.length; i++) {
  sum = sum.add(BigInteger.valueOf(array[i]));
}
</code></pre><p>vs</p><pre><code>BigInteger sum = BigInteger.valueOf(0);
for(int i = 0; i &lt; array.length; i++) {
  sum = sum.add(BigInteger.valueOf(array[i]));
}
</code></pre><p>vs</p><pre><code>BigInteger sum = null;
for(int i = 0; i &lt; array.length; i++) {
  if(sum == null) { sum = BigInteger.valueOf(array[i]); }
  else { sum = sum.add(BigInteger.valueOf(array[i])); }
}
</code></pre><p>The first code is simpler to understand and less error prone.</p><p>The second creates another object when its not needed - do this several times and you&#39;ve got several <code>BigInteger.valueOf(0)</code> objects that need to get collected at some point.</p><p>The third is error prone - if the array is empty, sum comes out with a <code>null</code>.</p><p><strong>However</strong> this should be remembered that this is trying to <em>avoid</em> instatiation of objects.  Using it for things such as comparisons doesn&#39;t help.</p><pre><code>if (myArray.length == Constants.ZERO_INT) 
</code></pre><p>This is some dangerous code.  Sure, ZERO_INT is an <code>Integer</code> and it will get unboxed back to a 0.  But if the myArray ever becomes something that returns an Integer?  It may break depending on how ZERO_INT was defined (<code>Integer ZERO_INT = 0</code> is less likely to, <code>Integer ZERO_INT = new Integer(0)</code> is more likely to).  And things you get back from ORMs and the like are rarely boxed.</p><p>At a former employer, I had <code>BigDecimal KM_IN_MI = BigDecimal.valueOf(&#34;1.60934&#34;);</code> defined because it was a value that kept getting used and removed code that would create it a few dozen times otherwise.  That&#39;s a <em>good</em> constant - and its not one that would get auto boxed for you.  Its also one that needs to stay consistent through multiple calculations.</p><p>Defining <code>Integer.valueOf(0)</code> fails at this test because it is one that would get auto boxed for you, is more likely to be buggy (the <code>==</code> works sometimes), and is already a constant <code>0</code>.</p><hr/><p>The empty string is... kind of useless, other than its name. <code>&#34;&#34;</code> is easier to type and probably more convenient.  That said, some tools will <a href="http://pmd.sourceforge.net/pmd-4.3/rules/strings.html" rel="nofollow noreferrer">yell at you</a> for having a string constant used multiple times as string constants - set up your static analysis to put <code>&#34;&#34;</code> into its exception list.</p><p>This is because Java does <a href="http://en.wikipedia.org/wiki/String_interning" rel="nofollow noreferrer">String interning</a>. <s>They take strings out of college and put them to work.</s> At compile time, all the string literals are put into a specific pool of strings that are pre-defined.  This can save memory and speed things up - and make things referentially equal (<code>&#34;foo&#34; == &#34;foo&#34;</code> is true, while <code>&#34;foo&#34; == new String(&#34;foo&#34;)</code> is false, but <code>&#34;foo&#34; == (new String(&#34;foo&#34;)).intern()</code> is true -- got all that?).</p><p>Defining <em>some</em> strings as constants means that you are not violating <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself" rel="nofollow noreferrer">DRY</a>.  But for <code>&#34;&#34;</code>, this is probably overkill, unnecessary and, frankly, a pain.</p><hr/><p>For <code>final static</code> primitives (<code>byte</code>, <code>short</code>, <code>int</code>, <code>float</code>, <code>double</code>, <code>char</code>, <code>long</code>, <code>boolean</code>), these are translated to literals at compile time (<code>String</code> also has this behavior though it is complicated with the interning pool). They do have uses, as can seen in the code for <a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/6-b14/java/util/Calendar.java#368" rel="nofollow noreferrer">java.util.Calendar</a>. However, <em>extreme</em> caution must be taken with this.</p><p>If your code looks like:</p><pre><code>class A {
   final static int FOO = 1;
}

class B {
    private int field;
    public B { field = A.FOO; }
}
</code></pre><p>when it gets compiled, class B effectively becomes:</p><pre><code>class B {
    private int field;
    public B { field = 1; }
}
</code></pre><p>There is no reference to <code>A.FOO</code> in the code.  This is mentioned in <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/classvars.html" rel="nofollow noreferrer">Understanding Class Members</a>:</p><blockquote><p>If a primitive type or a string is defined as a constant and the value is known at compile time, the compiler replaces the constant name everywhere in the code with its value. This is called a <em>compile-time constant</em>. If the value of the constant in the outside world changes (for example, if it is legislated that pi actually should be 3.975), you will need to recompile any classes that use this constant to get the current value.</p></blockquote><p>As these numbers get compiled into any class that uses them (rather than referencing the constant), it means if the value changes for some reason <strong><em>everything</em></strong> that uses it must be recompiled. Failing to do that means that you <em>think</em> you are using a given value from the new .jar but you are still using the old one.</p><p>There are a couple of ways to make sure you don&#39;t have this problem of mismatched constants.</p><p>The easiest (and hardest to enforce) is to say &#34;once something is a <code>public final static int answer = 42</code> it <strong><em>never</em></strong> changes.&#34;  If you need a new <code>answer</code>, you make a new constant.  If you need to change this value some day, too bad.</p><p>One is to make sure that the values don&#39;t get out of the package as a <code><i>public</i> final static</code> and instead make it package level. This means that it isn&#39;t likely to be used in another .jar and changing it means recompiling the current .jar.</p><p>Another approach is to make the constant accessed via a getter. The getter doesn&#39;t get inlined at compile time, but <em>can</em> get inlined at JIT time. This means that you don&#39;t have to worry about if the constant in the other class changes because you are accessing it via a getter at runtime rather than compile time inlining.</p><p>As this is a bit complex and has been the source of at least one bug that I&#39;ve fought (and oh, what an epic fight it was - it works on my machine, doesn&#39;t work in the dev environment, works on test, but not on production (but differently than how it didn&#39;t work in dev); because different versions of a .jar were present on each one and the final static int was different) -- one should be wary of these values if they have at all a chance to change with future versions.  There is also some more esoteric breaking of case statements where two of them could have the same value.  There are some idioms to avoid this mentioned at the end of section <a href="http://docs.oracle.com/javase/specs/jls/se8/html/jls-13.html#jls-13.4.9" rel="nofollow noreferrer">13.4.9</a> of the JLS though it has the caveat of &#34;We note, but do not recommend...&#34;</p><p>I should point out that <code>final static {primitive}</code> is not a <em>pool</em> at all in the language of patterns. It is a way of invoking a compiler optimization for DRY at the cost of closer coupling between the classes and the possibility of errors if that coupling doesn&#39;t mean all the classes are recompiled at the same time when the &#39;constant&#39; changes.</p><hr/><p>Constant pools of objects are there for performance issues.  Look at the IntegerCache in the Integer class (its a Flyweight Pattern).  Or the proper use of String interning.</p><p>But that speed performance gain is unlikely of any use if the code that is written is harder to understand and more likely to have a bug introduced in it.</p><p>When dealing with non-mathematical constants and primitive types, make sure that these values are constant to avoid some rather hard to track down bugs (see <a href="https://stackoverflow.com/a/4607720">this explanation of one such &#39;bug&#39;</a>).</p><p><strong>Write what is understandable.  Unless demonstrated otherwise, programmer time is more valuable than cpu time.</strong></p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='https://free-tor-game.com/software/java-the-accepted-style-for-using-the-this-keyword-in-java/'>Java &#8211;  the accepted style for using the `this` keyword in Java</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/java-using-nested-public-classes-to-organize-constants/'>Java &#8211; Using nested public classes to organize constants</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/c-prevent-developers-from-using-constants/'>C# &#8211; Prevent developers from using constants</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/java-is-storing-the-connection-pool-in-a-singleton-a-bad-practice/'>Java &#8211; Is storing the connection pool in a singleton a bad practice</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/python-should-i-really-use-all-uppercase-for-the-constants/'>Python &#8211; Should I really use all uppercase for the constants</a></li><li class="list-group-item"><a href='https://free-tor-game.com/software/java-using-the-same-name-for-setter-and-gettter-methods-for-a-boolean-member-variable/'>Java &#8211; Using the same name for setter and gettter methods for a boolean member variable</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="https://free-tor-game.com/wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>