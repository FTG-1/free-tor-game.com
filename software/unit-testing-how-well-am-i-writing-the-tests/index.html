<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Unit-testing &#8211; How well am I writing the tests &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1083247 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1083247" class="post-1083247 software type-software status-publish hentry category-software tag-mocking tag-phpunit tag-testing tag-unit-testing"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Unit-testing &#8211; How well am I writing the tests</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">mocking</span><span class="mr-2 badge badge-info">phpunit</span><span class="mr-2 badge badge-warning">testing</span><span class="mr-2 badge badge-primary">unit testing</span></p><div class="entry-content"><p>I&#39;ve been coding as a career for about 2 years now but am just now writing my first &#34;real&#34; tests for a non-trivial application. I&#39;ve been trying to follow best practices I&#39;ve picked up from the internet here and there but I would like some feedback on whether I am heading in the right direction with what I am doing and what I can do to correct/improve my process.</p><hr/><p>The application is a headless API that will be seeing public (aka clients who want to integrate with our API, not totally public) consumption in a few months.</p><p>From top to bottom the stack and layers look like this:</p><ul><li>RESTful API (JSON)</li><li>Oauth 2.0 authentication</li><li>(Mostly) CRUD controllers (PHP, <a href="http://laravel.com/" rel="noreferrer">Laravel 5</a>)</li><li><a href="http://www.doctrine-project.org/" rel="noreferrer">Doctrine ORM</a> for DAL</li><li>MySQL DB</li></ul><p>I wanted to design my tests to be as simple but thorough as possible. However I don&#39;t have eternity and a day to write really fundamental test (unit tests I guess) for all controllers and all business logic so I decided to take advantage of <a href="http://laravel.com/docs/5.0/testing#calling-routes-from-tests" rel="noreferrer">laravel&#39;s built in mocking for routes</a> and test all endpoints for our API.</p><p>My line of thinking is that, since we have standard data structures and formats for request/response (JSON, defined json schemas for objects, etc.) I could emulate requests knowing what the response should look like and compare the two.</p><p>EX. <code>GET api/user/1</code> should return <code>user 1</code> as a json object that I can compare for equality with the serialized json the actual object gives me.</p><hr/><p>So the actual testing looks like this (using PHPunit):</p><ol><li>On application start Laravel sets the app environment to &#34;testing&#34; which changes the default DB connection to a SQLite file</li><li>On PHPunit boot Doctrine gets model metadata and creates tables for my domain in the DB, some extra scripts for extra-domain stuff (oauth tables) create those as well</li><li><a href="https://github.com/nelmio/alice" rel="noreferrer">Alice</a>, an object generator for doctrine, creates a decently diverse set of domain entities with random data from <a href="https://github.com/fzaninotto/Faker" rel="noreferrer">Faker</a> and hydrates the SQLite DB. All created entities are returned and I store these in a global variable for later use.</li><li><a href="http://sgoettschkes.blogspot.com/2012/06/symfony2-test-database-best-pratice.html" rel="noreferrer">I make a copy of the hydrated, untouched DB</a> to use in tests that involve write operations so I can reset the db after each test.</li><li>Oauth clients get generated for users with different roles so I can test oauth scopes and permissions across different users for each test</li><li>I use <a href="http://laravel.com/docs/5.0/testing#calling-routes-from-tests" rel="noreferrer">Laravel&#39;s route mocking</a> to call each API endpoint and</li><li>For read-only tests (GETs) I use the json serialized form of objects stored earlier (step 3) to test the equality of responses,</li><li>For write tests I construct requests from our object json schemas, then build a real object that should equate it, make the request and then check the response for equality with the serialized form of the object (like step 7). After each write test the DB is overwritten with the original hydrated DB from step 4 for the next test.</li></ol><hr/><p>So that&#39;s the gist of it. Using this approach has given me fantastic performance &#8212; running 26 tests with 87 assertions takes ~12 seconds.</p><p>My questions/concerns</p><ul><li>I don&#39;t mock anything. I feel like I&#39;m doing something wrong because of this but at the same time I am actually providing a &#34;real&#34; environment for the whole application so nothing seems like it needs to be mocked. Is this okay?</li><li>Am I trying to do too much with each test? I&#39;ve read articles that warn against having too many dependencies in a test because it makes the test fragile and less effective, but all of the &#34;dependencies&#34; in my tests are actual code &#8212; so if a test breaks it means my actual code is broken which I feel I would want to know.</li></ul><p>What else can you tell me? Suggestions? How can I improve this? Thanks!</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>Concept is good enough!</p><p>Now, you must decide on what did you build - integration or acceptance tests and support/enhance them for single purpose. Here is the difference:</p><p>Integration tests are used by developers to verify that application is basically working and run often from dev machine. TDD tests and bug reproduction tests goes this way. Integration tests should be fast enough to do not bore developer.</p><p>Acceptance tests are used mainly by QA to ensure that application build is ready for production. They cover all application functionality including error conditions and tend to run for a while because of large number of tests</p><p>Also, you should automate them as most as possible so they can be run in single click - including database setup/restore.</p><p>Then you can add them to your Continuous Integration tool so they will run after each commit and have fun!</p><p>Regarding your concerns.</p><p>Actually concern - that you are testing too much in a single test. Do you have anything complex enough to be tested in isolation? DAL is good candidate since fast tests on DAL can really help when db schema changes. General rule when writing scoped tests is writing them when you believe this code can be broken/will break. Usually that falls to single functions or large isolated module. Tests will large amount of mocks tend to be a) fragile b) expensive to write and c) testing glue code that has no complexity and no value</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../php-ive-unit-tested-the-class-now-how-to-get-started-with-an-integration-test/'>Php &#8211; I&#8217;ve unit tested the class, now how to get started with an integration test</a></li><li class="list-group-item"><a href='../unit-testing-unit-testing-eloquent-outside-of-laravel/'>Unit-testing &#8211; Unit testing Eloquent outside of Laravel</a></li><li class="list-group-item"><a href='../unit-testing-are-integration-tests-meant-to-repeat-all-unit-tests/'>Unit-testing &#8211; Are integration tests meant to repeat all unit tests</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>