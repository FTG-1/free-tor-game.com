<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Where should business logic go in a layered architecture &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1078383 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1078383" class="post-1078383 software type-software status-publish hentry category-software tag-domain-driven-design tag-layers tag-services tag-validation"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Where should business logic go in a layered architecture</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">domain-driven-design</span><span class="mr-2 badge badge-info">layers</span><span class="mr-2 badge badge-warning">services</span><span class="mr-2 badge badge-primary">validation</span></p><div class="entry-content"><p>First of all, i&#39;m not talking about validation in the sense of the nullability or length of a field like in <a href="https://stackoverflow.com/questions/23352872/where-should-validation-take-place">this</a> and <a href="https://stackoverflow.com/questions/2427366/where-should-i-put-validation-code">this</a> questions where we can use isValid() methods in business classes or an external Validator. However, my question is related to validate or not in business classes.<br /> I&#39;m using a layered architecture style with services consuming the datasource layer and interacting with the domain model.</p><p>Simplyfing the domain requirements, suppose I have Movies and Reviews, and Users can make only one Review per Movie.<br /> So, a second Review is a valid object but the business rules should not allow the review to be completed.</p><p>So, i could do:</p><pre><code>ReviewService &gt;&gt; addReview(review,movie)
  loggedUser = getLoggedUser()
  review = reviewRepository.searchReviewFrom(loggedUser,movie)
  if (review == null)
    reviewRepository.save(review)
  else
    // some mechanism to inform the error, it could be NotificationPattern
</code></pre><p>Or:</p><pre><code>Movie &gt;&gt; addReview(review)
   for r in this.reviews
     if r.user = review.user
       throw ReviewAlreadyUploaded
   // if no expcetion is thrown
   this.reviews.add(review)
</code></pre><p>I think this oneReviewPerUser validation is a pure business rule, and should go in the business classes, in this case the Movie class. Thus the business rules are contained whitin the domain and no scattered between the layers.<br /> However, if the lists of Reviews of the Movies are big in almost every case, this option implies query and instantiate a big number of Review object and iterate over all elements.</p><p>So assume that I choose option 1, I have to assure that every client that wants to create a review for a Movie must use the Service, because it may break the business constraint of 1 review per user if, for example, use directly the ReviewRepository.<br /> This starts to sound like a layer of Services with all the business logic and an AnemicModel with Domain Classes being bags of attributes for carry data to and from the database.</p><p>Where is the line that separates the business logic that should be on Services from the one that should be on Domain Classes.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>In a DDD (Domain Driven Design) application using a conventional layered architecture, business logic goes into the <em>domain</em> layer. Now, please note this layer does not only contain the domain entities (<code>Movie</code>, <code>Review</code>), but <em>also</em> domain services (like a <code>ReviewService</code> class) and repositories. So, <code>ReviewService</code> is a business class as well.</p><p>Your concern about every client <em>having</em> to use the appropriate business method (<code>addReview</code>) is not realistic. There is just no practical way to avoid a poorly written client class from violating business rules, if the developers don&#39;t stick to the rules of the chosen architecture. For example, if <code>Movie</code> has a <code>getReviews()</code> method (or a <code>reviews</code> property) which exposes a mutable collection of reviews, client code can always add an arbitrary review. And even if it&#39;s immutable, client code can always create the invalid <code>Review</code> in the database by directly using a repository.</p><p>In my opinion, it&#39;s best to have only relatively simple business methods in domain entities, and usually only for read-only operations. More complex business logic is best assigned to cohesive domain service classes. Otherwise, your entity classes will quickly become too big and complex. So, for example, a business operation that adds a movie review subject to business validation rules would be best put in a <code>ReviewMaintenance</code> domain service class, or even a <code>ReviewCreation</code> class if the &#34;add review&#34; operation is sufficiently complex.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../validation-and-authorization-in-layered-architecture/'>Validation and authorization in layered architecture</a></li><li class="list-group-item"><a href='../how-accurate-is-business-logic-should-be-in-a-service-not-in-a-model/'>How accurate is &#8220;Business logic should be in a service, not in a model&#8221;</a></li><li class="list-group-item"><a href='../domain-model-validation-and-pushing-errors-to-the-model/'>Domain Model, validation, and pushing errors to the model</a></li><li class="list-group-item"><a href='../n-elegant-way-to-check-unique-contraints-on-domain-object-attributes-without-moving-business-logic-into-service-layer/'>N elegant way to check unique contraints on domain object attributes without moving business logic into service layer</a></li><li class="list-group-item"><a href='../ddd-domain-models-and-business-logic/'>DDD Domain Models and Business Logic</a></li><li class="list-group-item"><a href='../c-validation-inside-constructor/'>C# &#8211; Validation inside Constructor</a></li><li class="list-group-item"><a href='../unit-testing-tdd-with-layered-architecture-while-only-unit-testing-domain-logic/'>Unit-testing &#8211; TDD with layered architecture, while only unit testing domain logic</a></li><li class="list-group-item"><a href='../ddd-and-mediatr-where-the-validation-and-business-logic-go/'>DDD and MediatR &#8211; where the Validation and Business Logic go</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>