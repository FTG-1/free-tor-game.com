<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Java &#8211; How bad is it calling println() often than concatenating strings together and calling it once &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1071228 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1071228" class="post-1071228 software type-software status-publish hentry category-software tag-c tag-io tag-java tag-performance"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Java &#8211; How bad is it calling println() often than concatenating strings together and calling it once</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">io</span><span class="mr-2 badge badge-warning">java</span><span class="mr-2 badge badge-primary">performance</span></p><div class="entry-content"><p>I know output to the console is a costly operation. In the interest of code readability sometimes it is nice to call a function to output text twice, rather than having a long string of text as an argument.</p><p>For example how much less efficient is it to have</p><pre><code>System.out.println(&#34;Good morning.&#34;);
System.out.println(&#34;Please enter your name&#34;);
</code></pre><p>vs.</p><pre><code>System.out.println(&#34;Good morning.\nPlease enter your name&#34;);
</code></pre><p>In the example the difference is only one call to <code>println()</code> but what if it&#39;s more?</p><p>On a related note, statements involving printing text can look strange while viewing the source code if the text to print is long. Assuming the text itself can&#39;t be made shorter, what can be done? Should this be a case where multiple <code>println()</code>calls be made? Someone once told me a line of code shouldn&#39;t be more than 80 characters (IIRC) so what would you do with</p><pre><code>System.out.println(&#34;Good morning everyone. I am here today to present you with a very, very lengthy sentence in order to prove a point about how it looks strange amongst other code.&#34;);
</code></pre><p>Is the same true for languages such as C/C++ since each time data is written to an output stream a system call must be made and the process must go to kernel mode (which is very costly)?</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>There are two &#39;forces&#39; here, in tension: Performance vs. Readability.</p><p>Let&#39;s tackle the third problem first though, long lines:</p><blockquote><pre><code>System.out.println(&#34;Good morning everyone. I am here today to present you with a very, very lengthy sentence in order to prove a point about how it looks strange amongst other code.&#34;);
</code></pre></blockquote><p>The best way to implement this and keep readibility, is to use string concatenation:</p><pre><code>System.out.println(&#34;Good morning everyone. I am here today to present you &#34;
                 + &#34;with a very, very lengthy sentence in order to prove a &#34;
                 + &#34;point about how it looks strange amongst other code.&#34;);
</code></pre><p>The String-constant concatenation will happen at compile time, and will have no effect on performance at all. The lines are readable, and you can just move on.</p><p>Now, about the:</p><blockquote><pre><code>System.out.println(&#34;Good morning.&#34;);
System.out.println(&#34;Please enter your name&#34;);
</code></pre></blockquote><p>vs.</p><blockquote><pre><code>System.out.println(&#34;Good morning.\nPlease enter your name&#34;);
</code></pre></blockquote><p>The second option is significantly faster. I will suggest about 2X as fast.... why?</p><p>Because 90% (with a wide margin of error) of the work is not related to dumping the characters to the output, but is overhead needed to secure the output to write to it.</p><h3>Synchronization</h3><p><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/System.html#out" rel="noreferrer"><code>System.out</code></a> is a <a href="http://docs.oracle.com/javase/8/docs/api/java/io/PrintStream.html" rel="noreferrer"><code>PrintStream</code></a>. All Java implementations that I know of, internally synchronize the PrintStream: <a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/java/io/PrintStream.java?av=f#804" rel="noreferrer">See the code on GrepCode!</a>.</p><p>What does this mean for your code?</p><p>It means that each time you call <code>System.out.println(...)</code> you are synchronizing your memory model, you are checking and waiting for a lock. Any other threads calling System.out will also be locked.</p><p>In single-threaded applications the impact of <code>System.out.println()</code> is often limited by the IO performance of your system, how fast can you write out to file. In multithreaded applications, the locking can be more of an issue than the IO.</p><h3>Flushing</h3><p><a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/java/io/PrintStream.java#PrintStream.newLine%28%29" rel="noreferrer">Each println is flushed</a>. This causes the buffers to be cleared and triggers a Console-level write to the buffers. The amount of effort done here is implementation dependant, but, it is generally understood that the performance of the flush is only in small part related to the size of the buffer being flushed. There is a significant overhead related to the flush, where memory buffers are marked as dirty, the Virtual machine is performing IO, and so on. Incurring that overhead once, instead of twice, is an obvious optimization.</p><h2>Some numbers</h2><p>I put together the following little test:</p><pre><code>public class ConsolePerf {

    public static void main(String[] args) {
        for (int i = 0; i &lt; 100; i++) {
            benchmark(&#34;Warm &#34; + i);
        }
        benchmark(&#34;real&#34;);
    }

    private static void benchmark(String string) {
        benchString(string + &#34;short&#34;, &#34;This is a short String&#34;);
        benchString(string + &#34;long&#34;, &#34;This is a long String with a number of newlines\n&#34;
                  + &#34;in it, that should simulate\n&#34;
                  + &#34;printing some long sentences and log\n&#34;
                  + &#34;messages.&#34;);
        
    }
    
    private static final int REPS = 1000;

    private static void benchString(String name, String value) {
        long time = System.nanoTime();
        for (int i = 0; i &lt; REPS; i++) {
            System.out.println(value);
        }
        double ms = (System.nanoTime() - time) / 1000000.0;
        System.err.printf(&#34;%s run in%n    %12.3fms%n    %12.3f lines per ms%n    %12.3f chars per ms%n&#34;,
                name, ms, REPS/ms, REPS * (value.length() + 1) / ms);
        
    }

    
}
</code></pre><p>The code is relatively simple, it repeatedly prints either a short, or a long string to output. The long String has multiple newlines in it. It measures how long it takes to print 1000 iterations of each.</p><p>If I run it at the unix (Linux) command-prompt, and redirect the <code>STDOUT</code> to <code>/dev/null</code>, and print the actual results to <code>STDERR</code>, I can do the following:</p><blockquote><pre><code>java -cp . ConsolePerf &gt; /dev/null 2&gt; ../errlog
</code></pre></blockquote><p>The output (in errlog) looks like:</p><blockquote><pre><code>Warm 0short run in
           7.264ms
         137.667 lines per ms
        3166.345 chars per ms
Warm 0long run in
           1.661ms
         602.051 lines per ms
       74654.317 chars per ms
Warm 1short run in
           1.615ms
         619.327 lines per ms
       14244.511 chars per ms
Warm 1long run in
           2.524ms
         396.238 lines per ms
       49133.487 chars per ms
.......
Warm 99short run in
           1.159ms
         862.569 lines per ms
       19839.079 chars per ms
Warm 99long run in
           1.213ms
         824.393 lines per ms
      102224.706 chars per ms
realshort run in
           1.204ms
         830.520 lines per ms
       19101.959 chars per ms
reallong run in
           1.215ms
         823.160 lines per ms
      102071.811 chars per ms
</code></pre></blockquote><p>What does this mean? Let me repeat the last &#39;stanza&#39;:</p><blockquote><pre><code>realshort run in
           1.204ms
         830.520 lines per ms
       19101.959 chars per ms
reallong run in
           1.215ms
         823.160 lines per ms
      102071.811 chars per ms
</code></pre></blockquote><p>It means that, for all intents and purposes, even though the &#39;long&#39; line is about 5-times longer, and contains multiple newlines, it takes just about as long to output as the short line.</p><p>The number of characters-per-second for the long run is 5 times as much, and the elapsed time is about the same.....</p><p>In other words, your performance scales relative to the <em>number</em> of printlns you have, not <em>what</em> they print.</p><p><strong>Update:</strong> What happens if you redirect to a file, instead of to /dev/null?</p><blockquote><pre><code>realshort run in
           2.592ms
         385.815 lines per ms
        8873.755 chars per ms
reallong run in
           2.686ms
         372.306 lines per ms
       46165.955 chars per ms
</code></pre></blockquote><p>It is a whole lot slower, but the proportions are about the same....</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../c-i-believe-i-have-mixed-c-and-c-code-when-i-shouldnt-have-is-this-a-problem-and-how-to-rectify/'>C++ &#8211; I believe I have mixed C and C++ code when I shouldn&#8217;t have; Is this a problem and how to rectify</a></li><li class="list-group-item"><a href='../java-how-many-strings-are-created-in-memory-when-concatenating-strings-in-java/'>Java &#8211; How many strings are created in memory when concatenating strings in Java</a></li><li class="list-group-item"><a href='../c-should-a-c-program-catch-all-exceptions-and-prevent-exceptions-from-bubbling-up-past-main/'>C++ &#8211; Should a C++ program catch all exceptions and prevent exceptions from bubbling up past main()</a></li><li class="list-group-item"><a href='../java-pattern-for-a-method-call-outcome/'>Java &#8211; Pattern for a method call outcome</a></li><li class="list-group-item"><a href='../java-how-to-represent-a-long-if-else-tree-in-a-concise-manner/'>Java &#8211; How to represent a long if-else tree in a concise manner</a></li><li class="list-group-item"><a href='../why-would-you-ever-use-malloc0/'>Why would you ever use `malloc(0)`</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>