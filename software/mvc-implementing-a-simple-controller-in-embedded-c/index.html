<!doctype html><html lang="en-US"><!--  --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- / -->
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">  <link media="all" href="../../wp-content/cache/autoptimize/4/css/autoptimize_dc56928889f08ceb40a4520f8ece953b.css" rel="stylesheet" /><title>Mvc &#8211; Implementing a simple controller in embedded C &#8211; free-tor-game.com</title> <script>MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};</script> <link rel='dns-prefetch' href='http://cdn.jsdelivr.net/' /><link rel='dns-prefetch' href='http://cdnjs.cloudflare.com/' /><link rel='dns-prefetch' href='http://stackpath.bootstrapcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><link rel='stylesheet' id='highlight-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/vs2015.min40df.css?ver=5.6' type='text/css' media='all' /><link rel='stylesheet' id='bootstrap-css'  href='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.mina352.css?ver=4.1.3' type='text/css' media='all' /><link rel='stylesheet' id='icons-css'  href='../../../stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min40df.css?ver=5.6' type='text/css' media='all' /> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.minb8ff.js?ver=1.12.4' id='jquery-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.minc9a3.js?ver=11.2.0' id='highlight-js'></script>            <script>hljs.highlightAll();</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1731162805004860" crossorigin="anonymous"></script></head><body class="software-template-default single single-software postid-1081452 no-sidebar"><div id="page" class="site"> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><header id="topnav" class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light" role="navigation"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-primary" aria-controls="navbar-primary" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="#">free-tor-game.com</a><div id="navbar-primary" class="collapse navbar-collapse"><ul id="menu-primary-top-menu" class="nav navbar-nav"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-192" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children dropdown menu-item-192 nav-item"><a title="Tools" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle nav-link" id="menu-item-dropdown-192">Tools</a><ul class="dropdown-menu" aria-labelledby="menu-item-dropdown-192" role="menu"><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-193" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-193 nav-item"><a title="ARFCN-Frequency Converter" href="../../3gpp-arfcn-frequency-converter/" class="dropdown-item">ARFCN-Frequency Converter</a></li></ul></li><li itemscope="itemscope" itemtype="https://www.schema.org/SiteNavigationElement" id="menu-item-2301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2301 nav-item"><a title="Contact Us" href="../../contact/" class="nav-link">Contact Us</a></li></ul></div></nav></header><div id="content" class="site-content"><div id="primary" class="content-area"><main id="main" class="site-main"><div id="main-container" class="container"><div id="main-row" class="row"><div id="main-col" class="col-12"><article id="post-1081452" class="post-1081452 software type-software status-publish hentry category-software tag-c tag-embedded-systems tag-mvc"><div class="row"><div class="col-12 col-md-8"><header class="entry-header"><h1 class="entry-title text-danger">Mvc &#8211; Implementing a simple controller in embedded C</h1></header><p style='font-size:1.2em'><span class="mr-2 badge badge-success">c</span><span class="mr-2 badge badge-info">embedded-systems</span><span class="mr-2 badge badge-warning">mvc</span></p><div class="entry-content"><p>Is there a known method or pattern to implement a simple controller for an MVC design in pure C or the switch case approach is the standard?</p><p><strong>Background :</strong></p><p>I have an embedded application and I&#39;m pleased with how the business logic turned out. I also finished the UI which boils down to basically 2 functions:</p><pre><code>uint8_t getInput(void);
void display(logger toDestination, char* message, ...)
</code></pre><p>Inputs can come from multiple sources and outputs can be sent to several destinations. All of that is taken care of so the application has no idea if its run by a PC on on the device. It also has no idea if the events come from humans or are faked by unit tests.</p><p>Where I struggle is with the application logic. My views are in charge of where and how to display the outputs. My drivers, regrouped into behavioral models providing clear features, know <em>how</em> to do their jobs very well but not <em>when</em>.</p><p>Here&#39;s my functional rough draft, which in my opinion violates principles like DRY, cohesion, flexibility and may present scalability problems:</p><p><strong>Rough draft :</strong> (I faked the names and reduced the size but you get the idea)</p><p><em>menu.h</em></p><pre><code>void goToMainMenu(void); // This is the entry point of the application after everything was setup correctly

    void goToFirstSubMenu(void);
        void firstFunctionality(void); //The last levels are the ones doing the calls to the business logic
        void secondFunctionality(void);
        //Other functionality or nested sub-sub-menus

    void goToSecondSubMenu(void);
        void thirdFunctionality(void);

    int doSomethingWithTheBusinessLogic(int arg1, char arg2, void* arg3);

    //Other sub-menus and options

    /* And so on, the function prototype are indented to reflect the logical level of the menus.*/
</code></pre><p>Then most of the functions will roughly look like this:</p><p><em>menu.c</em></p><pre><code>void goToMainMenu(void)
{
  uint8_t choice = 0;
  resetDefaultState(); 

  do
  {
    display(toTerminal, &#34;Press 1 to go to sub-menu 1&#34; ENDL);
    display(toTerminal, &#34;Press 2 to go to sub-menu 2&#34; ENDL);
    display(toTerminal, &#34;Press 3 to do something with the drivers&#34; ENDL);
    display(toTerminal, &#34;Press z to go back.&#34; ENDL);

    choice = getChar(); /* Blocking thread waiting for events to pop from the other threads */

    if     (choice == &#39;1&#39;){ goToFirstSubMenu(); }
    else if(choice == &#39;2&#39;){ goToSecondSubMenu(); }
    else if(choice == &#39;3&#39;){ doSomethingWithTheBusinessLogic(); }

  }while(choice != &#39;z&#39;);

  resetDefaultState(); 
  /* When a submenu returns we&#39;re taken to the parent menu&#39;s do-while loop */
}
</code></pre><ul><li>Is it a good way to do things for small-medium systems?</li><li>How could this be improved considering the limits of C and embedded environnements?</li></ul><p><strong>What has been tried :</strong></p><p>I tried a n-ary tree approach where nodes are menus and leaves are functionality but without polymorphism it&#39;s hard to define elegently how both should behave to inputs. The strongly typed system also makes it hard to do a simple callbacks system because I end up needing tons of wrappers around the drivers to unifiy a single callback signature (<code>void myCallback(void*)</code>).</p><p>It also seem to be overkill for this simple state-flow; I feel like I&#39;m working against KISS and productivity only because I&#39;ve been hammered with &#34;chains of if-elses is the devil&#34;.</p><p><strong>What I would like :</strong></p><p>With higher level languages usually you can bind events and callbacks. Something along the lines of <code>bind(myMenu, thisInput, theCallback)</code> so whenever <code>myMenu</code> is focused and an event <code>thisInput</code> it raised <code>theCallback</code> is called.</p><p>I&#39;m unsure how to do this in C without going way overboard.</p></div>     <div id="comments" class="comments-area"><div class="row"><div class="col-12"><div class="mt-3 border-bottom border-success"><h4 class="text-success"><i class='fa fa-check-circle text-success mr-3'></i><span>Best Answer</span></h4></div><div class='bg-transparent mb-3'><p>There is a development process question which should be understood and answered <em>before</em> worrying too much about the code.</p><p>IMHO, any organisation which employes more than one software developer, and especially one using interns to develop code, should have sane, rational, understood, shared development processes. There is a tremendous amount of evidence that reviewing code helps a lot. They help all developers to get onto the same page about coding techniques, style, libraries, tools, etc.</p><p>Recommendation 1: Ask your supervisor about doing a review of your code or design as soon as practical. It&#39;ll give you some feedback from people who&#39;s views are much more relevant than ours. Also it&#39;ll provide a way for your supervisor to understand your code well in advance of you leaving, with a clear invitation to direct you to fix things they don&#39;t like.</p><p>Let&#39;s try to look at it from some other persons position. They have to change the code, without breaking it, or fix a bug. They might be the next intern, with less knowledge than you. They want life to be straightforward. Ideally they will look at your code and say to their supervisor &#34;this code is great, I can understand it really easily, and I am confident the set of test cases they built will catch most of the types of errors that I might make.&#34;</p><p>When I have to read other peoples code, I like it &#39;as simple as possible, but no simpler&#39;.</p><p>The less code I have to read, the fewer ideas, and the less &#39;stacking&#39; or &#39;cross-referencing&#39; (I wonder how that works, I&#39;ll have to go and read that before I can progress), the better. So callbacks are unwelcome unless they reduce the total amount of effort a lot. Big libraries, with lots of extra features mainly obscure the code. Good unit tests and test cases help me to understand what the developer intended.</p><p>Your code seems like a model of how this might be done. 
My only slight criticism is:</p><pre><code>    display(toTerminal, &#34;Press 2 to go to sub-menu 2&#34; ENDL);
</code></pre><p>then later</p><pre><code>    else if(choice == &#39;2&#39;){ goToSecondSubMenu(); }
</code></pre><p>requires someone to ensure the text of the terminal message, and the value in the if test matches. If the program really is that level of complexity. I wouldn&#39;t worry. Hoever if it is significantly larger, then I might be tempted to create some named constants, and write something like:</p><pre><code>#define SUB_MENU_2 &#39;2&#39;  
...

    display(toTerminal, &#34;Press &#34; SUB_MENU_2 &#34; to go to sub-menu 2&#34; ENDL);

    else if(choice == SUB_MENU_2){ goToSecondSubMenu(); }
</code></pre><p>You might be tempted to put the message and choice character into an array of structs, so that the choice value and message are kept together. That is making the reader of your code have to think a bit harder, but you might find it helps if there are some other requirements. For example, it might help to identify values explicitly, so that more ways of  navigation can be made to work, e.g. driving up and down the menu with cursor keys, or pressing the digit. However, resist the temptation to write &#39;clever&#39; code; it causes a new reader to have to move around the code, rather than simply read it in sequence.</p><p>MVC is useful when you need to separate concerns when one or more parts are complex, or there is a lot of value in reusing solutions to part of the overall problem.</p><p>For example, the code to manage a view, menus, mouse clicks, and keyboard input in a windowing system is complex to write and test. It is worth reusing that. Your &#39;view library&#39; is <code>display()</code> and <code>getchar()</code>. That&#39;s it. The rest is your code to do more view stuff.</p><p>There seems to be very little control state. In the example you&#39;ve shown, the view isn&#39;t changing what is offered to the user depending on the state of the model or rules managed by the controller. Further, the actions seem to be straightforward too. So the controller seems very simple, and the model encapsulated.</p><p>If that changes, and the view must dynamically respond to reflect the state of the model, or their are several ways to get at the model, or more &#39;input validation&#39; of data, their may be a need for a more explicit implementation of MVC.</p><p>The stuff you have been taught is typically designed for very large systems (or is just another new fad). Unfortunately, when it is taught, the reasoning or rationale might be poorly explained.</p><p>IMHO, some of that complexity comes from people trying to implement things in a language which is not a good fit. For example, SmallTalk, the original home of MVC, makes some things easy because it is so dynamic and rich, however some of its mechanisms are ugly to implement in other languages. Hence we end up with a lot of complication, to address complex and very general situations.</p><p>Also, there is quite a lot of money, marketing and ego tied up in offering very clever solutions designed for extremely complex problems, then selling the skills capable of applying those clever solutions. It is unlikely you&#39;ll hear a large system integrator say &#34;no, you don&#39;t need anything this clever and expensive, you just need that very simple, straightforward approach that any competent developer will use successfully&#34;. Just my $0.02.</p></div></div><div class="col-4"></div></div></div></div><div class="col-12 col-md-4"> <ins class="adsbygoogle"
 style="display:block"
 data-ad-client="ca-pub-1731162805004860"
 data-ad-slot="1340983829"
 data-ad-format="auto"
 data-full-width-responsive="true"></ins>   <div class='mt-3 ml-4 border-bottom border-success'><h6><span>Related Question</span></h6></div><ul class='list-group list-group-flush'><li class="list-group-item"><a href='../mvc-decoupling-ui-code/'>Mvc &#8211; Decoupling UI code</a></li><li class="list-group-item"><a href='../how-to-do-tdd-on-embedded-devices/'>How to do TDD on embedded devices</a></li><li class="list-group-item"><a href='../handling-leaves-in-tree-based-menus/'>Handling leaves in tree-based menus</a></li><li class="list-group-item"><a href='../object-oriented-is-mvc-controller-an-use-case-controller/'>Object-oriented &#8211; Is MVC controller an use case controller</a></li><li class="list-group-item"><a href='../documenting-embedded-c-code/'>Documenting embedded C code</a></li></ul></div></div><footer class="entry-footer"></footer></article></div></div></div></main></div></div><footer id="colophon" class="site-footer"><div class="site-info"></div></footer></div>    <script type='text/javascript' src='../../../cdn.jsdelivr.net/npm/mathjax%403/es5/tex-chtml40df.js?ver=5.6' id='mathjax-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/esm/popper.min43d3.js?ver=1.14.7' id='popper-js'></script> <script type='text/javascript' src='../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min5b31.js?ver=4.3.1' id='bootstrap4-js'></script> <script type='text/javascript' id='itectec-common-js-extra'>var globalObject = {"homeUrl":"https:\/\/free-tor-game.com\/"};</script> <script defer src="../../wp-content/cache/autoptimize/4/js/autoptimize_63b39f43631847816e6b0e70ea726624.js"></script></body></html>